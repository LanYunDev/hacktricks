<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>macOS - AMFI - AppleMobileFileIntegrity</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="macos---amfi---applemobilefileintegrity"><a class="header" href="#macos---amfi---applemobilefileintegrity">macOS - AMFI - AppleMobileFileIntegrity</a></h1>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>åœ¨</strong> <strong>Twitter</strong> ğŸ¦ <strong>ä¸Šå…³æ³¨æˆ‘ä»¬</strong> <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<h2 id="applemobilefileintegritykext-å’Œ-amfid"><a class="header" href="#applemobilefileintegritykext-å’Œ-amfid">AppleMobileFileIntegrity.kext å’Œ amfid</a></h2>
<p>å®ƒä¸“æ³¨äºå¼ºåˆ¶æ‰§è¡Œç³»ç»Ÿä¸Šè¿è¡Œä»£ç çš„å®Œæ•´æ€§ï¼Œæä¾› XNU ä»£ç ç­¾åéªŒè¯èƒŒåçš„é€»è¾‘ã€‚å®ƒè¿˜èƒ½å¤Ÿæ£€æŸ¥æƒé™å¹¶å¤„ç†å…¶ä»–æ•æ„Ÿä»»åŠ¡ï¼Œä¾‹å¦‚å…è®¸è°ƒè¯•æˆ–è·å–ä»»åŠ¡ç«¯å£ã€‚</p>
<p>æ­¤å¤–ï¼Œå¯¹äºæŸäº›æ“ä½œï¼Œkext æ›´å€¾å‘äºè”ç³»ç”¨æˆ·ç©ºé—´è¿è¡Œçš„å®ˆæŠ¤è¿›ç¨‹ <code>/usr/libexec/amfid</code>ã€‚è¿™ç§ä¿¡ä»»å…³ç³»åœ¨å¤šä¸ªè¶Šç‹±ä¸­è¢«æ»¥ç”¨ã€‚</p>
<p>AMFI ä½¿ç”¨ <strong>MACF</strong> ç­–ç•¥ï¼Œå¹¶åœ¨å¯åŠ¨æ—¶æ³¨å†Œå…¶é’©å­ã€‚æ­¤å¤–ï¼Œé˜²æ­¢å…¶åŠ è½½æˆ–å¸è½½å¯èƒ½ä¼šè§¦å‘å†…æ ¸å´©æºƒã€‚ç„¶è€Œï¼Œæœ‰ä¸€äº›å¯åŠ¨å‚æ•°å¯ä»¥å‰Šå¼± AMFIï¼š</p>
<ul>
<li><code>amfi_unrestricted_task_for_pid</code>: å…è®¸åœ¨æ²¡æœ‰æ‰€éœ€æƒé™çš„æƒ…å†µä¸‹ä½¿ç”¨ task_for_pid</li>
<li><code>amfi_allow_any_signature</code>: å…è®¸ä»»ä½•ä»£ç ç­¾å</li>
<li><code>cs_enforcement_disable</code>: ç”¨äºç¦ç”¨ä»£ç ç­¾åå¼ºåˆ¶æ‰§è¡Œçš„ç³»ç»ŸèŒƒå›´å‚æ•°</li>
<li><code>amfi_prevent_old_entitled_platform_binaries</code>: ä½œåºŸå…·æœ‰æƒé™çš„å¹³å°äºŒè¿›åˆ¶æ–‡ä»¶</li>
<li><code>amfi_get_out_of_my_way</code>: å®Œå…¨ç¦ç”¨ amfi</li>
</ul>
<p>ä»¥ä¸‹æ˜¯å®ƒæ³¨å†Œçš„ä¸€äº› MACF ç­–ç•¥ï¼š</p>
<ul>
<li><strong><code>cred_check_label_update_execve:</code></strong> æ ‡ç­¾æ›´æ–°å°†è¢«æ‰§è¡Œå¹¶è¿”å› 1</li>
<li><strong><code>cred_label_associate</code></strong>: ç”¨æ ‡ç­¾æ›´æ–° AMFI çš„ mac æ ‡ç­¾æ§½</li>
<li><strong><code>cred_label_destroy</code></strong>: ç§»é™¤ AMFI çš„ mac æ ‡ç­¾æ§½</li>
<li><strong><code>cred_label_init</code></strong>: åœ¨ AMFI çš„ mac æ ‡ç­¾æ§½ä¸­ç§»åŠ¨ 0</li>
<li><strong><code>cred_label_update_execve</code>:</strong> å®ƒæ£€æŸ¥è¿›ç¨‹çš„æƒé™ä»¥æŸ¥çœ‹æ˜¯å¦åº”å…è®¸ä¿®æ”¹æ ‡ç­¾ã€‚</li>
<li><strong><code>file_check_mmap</code>:</strong> å®ƒæ£€æŸ¥ mmap æ˜¯å¦è·å–å†…å­˜å¹¶å°†å…¶è®¾ç½®ä¸ºå¯æ‰§è¡Œã€‚å¦‚æœæ˜¯è¿™ç§æƒ…å†µï¼Œå®ƒä¼šæ£€æŸ¥æ˜¯å¦éœ€è¦åº“éªŒè¯ï¼Œå¦‚æœéœ€è¦ï¼Œåˆ™è°ƒç”¨åº“éªŒè¯å‡½æ•°ã€‚</li>
<li><strong><code>file_check_library_validation</code></strong>: è°ƒç”¨åº“éªŒè¯å‡½æ•°ï¼Œè¯¥å‡½æ•°æ£€æŸ¥å…¶ä»–å†…å®¹æ˜¯å¦å¹³å°äºŒè¿›åˆ¶æ–‡ä»¶æ­£åœ¨åŠ è½½å¦ä¸€ä¸ªå¹³å°äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ–è€…è¿›ç¨‹å’Œæ–°åŠ è½½çš„æ–‡ä»¶æ˜¯å¦å…·æœ‰ç›¸åŒçš„ TeamIDã€‚æŸäº›æƒé™ä¹Ÿå°†å…è®¸åŠ è½½ä»»ä½•åº“ã€‚</li>
<li><strong><code>policy_initbsd</code></strong>: è®¾ç½®å—ä¿¡ä»»çš„ NVRAM å¯†é’¥</li>
<li><strong><code>policy_syscall</code></strong>: å®ƒæ£€æŸ¥ DYLD ç­–ç•¥ï¼Œä¾‹å¦‚äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦å…·æœ‰ä¸å—é™åˆ¶çš„æ®µï¼Œæ˜¯å¦åº”å…è®¸ç¯å¢ƒå˜é‡â€¦â€¦å½“é€šè¿‡ <code>amfi_check_dyld_policy_self()</code> å¯åŠ¨è¿›ç¨‹æ—¶ä¹Ÿä¼šè°ƒç”¨æ­¤å‡½æ•°ã€‚</li>
<li><strong><code>proc_check_inherit_ipc_ports</code></strong>: å®ƒæ£€æŸ¥å½“è¿›ç¨‹æ‰§è¡Œæ–°äºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œæ˜¯å¦åº”ä¿ç•™å…¶ä»–å…·æœ‰å‘é€æƒé™çš„è¿›ç¨‹å¯¹è¯¥è¿›ç¨‹çš„ä»»åŠ¡ç«¯å£ã€‚å¹³å°äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å…è®¸çš„ï¼Œ<code>get-task-allow</code> æƒé™å…è®¸å®ƒï¼Œ<code>task_for_pid-allow</code> æƒé™æ˜¯å…è®¸çš„ï¼Œå…·æœ‰ç›¸åŒ TeamID çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</li>
<li><strong><code>proc_check_expose_task</code></strong>: å¼ºåˆ¶æ‰§è¡Œæƒé™</li>
<li><strong><code>amfi_exc_action_check_exception_send</code></strong>: å‘è°ƒè¯•å™¨å‘é€å¼‚å¸¸æ¶ˆæ¯</li>
<li><strong><code>amfi_exc_action_label_associate &amp; amfi_exc_action_label_copy/populate &amp; amfi_exc_action_label_destroy &amp; amfi_exc_action_label_init &amp; amfi_exc_action_label_update</code></strong>: å¼‚å¸¸å¤„ç†ï¼ˆè°ƒè¯•ï¼‰æœŸé—´çš„æ ‡ç­¾ç”Ÿå‘½å‘¨æœŸ</li>
<li><strong><code>proc_check_get_task</code></strong>: æ£€æŸ¥æƒé™ï¼Œå¦‚ <code>get-task-allow</code>ï¼Œå…è®¸å…¶ä»–è¿›ç¨‹è·å–ä»»åŠ¡ç«¯å£ï¼Œä»¥åŠ <code>task_for_pid-allow</code>ï¼Œå…è®¸è¿›ç¨‹è·å–å…¶ä»–è¿›ç¨‹çš„ä»»åŠ¡ç«¯å£ã€‚å¦‚æœéƒ½æ²¡æœ‰ï¼Œå®ƒä¼šè°ƒç”¨ <code>amfid permitunrestricteddebugging</code> æ¥æ£€æŸ¥æ˜¯å¦è¢«å…è®¸ã€‚</li>
<li><strong><code>proc_check_mprotect</code></strong>: å¦‚æœ <code>mprotect</code> è¢«è°ƒç”¨å¹¶å¸¦æœ‰ <code>VM_PROT_TRUSTED</code> æ ‡å¿—ï¼Œåˆ™æ‹’ç»ï¼Œè¯¥æ ‡å¿—è¡¨ç¤ºè¯¥åŒºåŸŸå¿…é¡»è¢«è§†ä¸ºå…·æœ‰æœ‰æ•ˆçš„ä»£ç ç­¾åã€‚</li>
<li><strong><code>vnode_check_exec</code></strong>: å½“å¯æ‰§è¡Œæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­æ—¶è¢«è°ƒç”¨ï¼Œå¹¶è®¾ç½® <code>cs_hard | cs_kill</code>ï¼Œå¦‚æœä»»ä½•é¡µé¢å˜ä¸ºæ— æ•ˆï¼Œå°†ç»ˆæ­¢è¯¥è¿›ç¨‹</li>
<li><strong><code>vnode_check_getextattr</code></strong>: MacOS: æ£€æŸ¥ <code>com.apple.root.installed</code> å’Œ <code>isVnodeQuarantined()</code></li>
<li><strong><code>vnode_check_setextattr</code></strong>: ä½œä¸ºè·å– + com.apple.private.allow-bless å’Œå†…éƒ¨å®‰è£…ç¨‹åºç­‰æ•ˆæƒé™</li>
<li> <strong><code>vnode_check_signature</code></strong>: è°ƒç”¨ XNU æ£€æŸ¥ä»£ç ç­¾åçš„ä»£ç ï¼Œä½¿ç”¨æƒé™ã€ä¿¡ä»»ç¼“å­˜å’Œ <code>amfid</code></li>
<li> <strong><code>proc_check_run_cs_invalid</code></strong>: æ‹¦æˆª <code>ptrace()</code> è°ƒç”¨ï¼ˆ<code>PT_ATTACH</code> å’Œ <code>PT_TRACE_ME</code>ï¼‰ã€‚å®ƒæ£€æŸ¥ä»»ä½•æƒé™ <code>get-task-allow</code>ã€<code>run-invalid-allow</code> å’Œ <code>run-unsigned-code</code>ï¼Œå¦‚æœéƒ½æ²¡æœ‰ï¼Œå®ƒä¼šæ£€æŸ¥æ˜¯å¦å…è®¸è°ƒè¯•ã€‚</li>
<li><strong><code>proc_check_map_anon</code></strong>: å¦‚æœ mmap è¢«è°ƒç”¨å¹¶å¸¦æœ‰ <strong><code>MAP_JIT</code></strong> æ ‡å¿—ï¼ŒAMFI å°†æ£€æŸ¥ <code>dynamic-codesigning</code> æƒé™ã€‚</li>
</ul>
<p><code>AMFI.kext</code> è¿˜ä¸ºå…¶ä»–å†…æ ¸æ‰©å±•å…¬å¼€äº†ä¸€ä¸ª APIï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ‰¾åˆ°å…¶ä¾èµ–é¡¹ï¼š</p>
<pre><code class="language-bash">kextstat | grep " 19 " | cut -c2-5,50- | cut -d '(' -f1
Executing: /usr/bin/kmutil showloaded
No variant specified, falling back to release
8   com.apple.kec.corecrypto
19   com.apple.driver.AppleMobileFileIntegrity
22   com.apple.security.sandbox
24   com.apple.AppleSystemPolicy
67   com.apple.iokit.IOUSBHostFamily
70   com.apple.driver.AppleUSBTDM
71   com.apple.driver.AppleSEPKeyStore
74   com.apple.iokit.EndpointSecurity
81   com.apple.iokit.IOUserEthernet
101   com.apple.iokit.IO80211Family
102   com.apple.driver.AppleBCMWLANCore
118   com.apple.driver.AppleEmbeddedUSBHost
134   com.apple.iokit.IOGPUFamily
135   com.apple.AGXG13X
137   com.apple.iokit.IOMobileGraphicsFamily
138   com.apple.iokit.IOMobileGraphicsFamily-DCP
162   com.apple.iokit.IONVMeFamily
</code></pre>
<h2 id="amfid"><a class="header" href="#amfid">amfid</a></h2>
<p>è¿™æ˜¯ç”¨æˆ·æ¨¡å¼ä¸‹è¿è¡Œçš„å®ˆæŠ¤è¿›ç¨‹ï¼Œ<code>AMFI.kext</code> å°†ä½¿ç”¨å®ƒæ¥æ£€æŸ¥ç”¨æˆ·æ¨¡å¼ä¸­çš„ä»£ç ç­¾åã€‚<br />
ä¸ºäº†è®© <code>AMFI.kext</code> ä¸å®ˆæŠ¤è¿›ç¨‹é€šä¿¡ï¼Œå®ƒä½¿ç”¨é€šè¿‡ç«¯å£ <code>HOST_AMFID_PORT</code> çš„ mach æ¶ˆæ¯ï¼Œè¯¥ç«¯å£æ˜¯ç‰¹æ®Šç«¯å£ <code>18</code>ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œåœ¨ macOS ä¸­ï¼Œæ ¹è¿›ç¨‹ä¸å†èƒ½å¤ŸåŠ«æŒç‰¹æ®Šç«¯å£ï¼Œå› ä¸ºå®ƒä»¬å—åˆ° <code>SIP</code> çš„ä¿æŠ¤ï¼Œåªæœ‰ launchd å¯ä»¥è·å–å®ƒä»¬ã€‚åœ¨ iOS ä¸­ï¼Œä¼šæ£€æŸ¥å‘é€å“åº”çš„è¿›ç¨‹æ˜¯å¦å…·æœ‰ç¡¬ç¼–ç çš„ <code>amfid</code> çš„ CDHashã€‚</p>
<p>å¯ä»¥é€šè¿‡è°ƒè¯• <code>amfid</code> å¹¶åœ¨ <code>mach_msg</code> ä¸­è®¾ç½®æ–­ç‚¹æ¥æŸ¥çœ‹ä½•æ—¶è¯·æ±‚ <code>amfid</code> æ£€æŸ¥äºŒè¿›åˆ¶æ–‡ä»¶åŠå…¶å“åº”ã€‚</p>
<p>ä¸€æ—¦é€šè¿‡ç‰¹æ®Šç«¯å£æ¥æ”¶åˆ°æ¶ˆæ¯ï¼Œ<strong>MIG</strong> å°†ç”¨äºå°†æ¯ä¸ªå‡½æ•°å‘é€åˆ°å®ƒæ‰€è°ƒç”¨çš„å‡½æ•°ã€‚ä¸»è¦å‡½æ•°å·²è¢«é€†å‘å¹¶åœ¨ä¹¦ä¸­è¿›è¡Œäº†è¯´æ˜ã€‚</p>
<h2 id="provisioning-profiles"><a class="header" href="#provisioning-profiles">Provisioning Profiles</a></h2>
<p>é…ç½®æ–‡ä»¶å¯ç”¨äºç­¾ç½²ä»£ç ã€‚æœ‰ <strong>Developer</strong> é…ç½®æ–‡ä»¶å¯ç”¨äºç­¾ç½²ä»£ç å¹¶è¿›è¡Œæµ‹è¯•ï¼Œè¿˜æœ‰ <strong>Enterprise</strong> é…ç½®æ–‡ä»¶å¯ç”¨äºæ‰€æœ‰è®¾å¤‡ã€‚</p>
<p>åœ¨åº”ç”¨æäº¤åˆ° Apple Store åï¼Œå¦‚æœè·å¾—æ‰¹å‡†ï¼Œå®ƒå°†ç”± Apple ç­¾ç½²ï¼Œå¹¶ä¸”ä¸å†éœ€è¦é…ç½®æ–‡ä»¶ã€‚</p>
<p>é…ç½®æ–‡ä»¶é€šå¸¸ä½¿ç”¨æ‰©å±•å <code>.mobileprovision</code> æˆ– <code>.provisionprofile</code>ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è½¬å‚¨ï¼š</p>
<pre><code class="language-bash">openssl asn1parse -inform der -in /path/to/profile

# Or

security cms -D -i /path/to/profile
</code></pre>
<p>è™½ç„¶æœ‰æ—¶è¢«ç§°ä¸ºè¯ä¹¦ï¼Œè¿™äº›é…ç½®æ–‡ä»¶ä¸ä»…ä»…æ˜¯ä¸€ä¸ªè¯ä¹¦ï¼š</p>
<ul>
<li><strong>AppIDName:</strong> åº”ç”¨ç¨‹åºæ ‡è¯†ç¬¦</li>
<li><strong>AppleInternalProfile</strong>: æŒ‡å®šä¸ºè‹¹æœå†…éƒ¨é…ç½®æ–‡ä»¶</li>
<li><strong>ApplicationIdentifierPrefix</strong>: é¢„åŠ åˆ° AppIDNameï¼ˆä¸ TeamIdentifier ç›¸åŒï¼‰</li>
<li><strong>CreationDate</strong>: æ—¥æœŸæ ¼å¼ä¸º <code>YYYY-MM-DDTHH:mm:ssZ</code></li>
<li><strong>DeveloperCertificates</strong>: ä¸€ä¸ªï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªï¼‰è¯ä¹¦çš„æ•°ç»„ï¼Œç¼–ç ä¸º Base64 æ•°æ®</li>
<li><strong>Entitlements</strong>: æ­¤é…ç½®æ–‡ä»¶å…è®¸çš„æƒé™</li>
<li><strong>ExpirationDate</strong>: è¿‡æœŸæ—¥æœŸæ ¼å¼ä¸º <code>YYYY-MM-DDTHH:mm:ssZ</code></li>
<li><strong>Name</strong>: åº”ç”¨ç¨‹åºåç§°ï¼Œä¸ AppIDName ç›¸åŒ</li>
<li><strong>ProvisionedDevices</strong>: ä¸€ä¸ªï¼ˆé’ˆå¯¹å¼€å‘è€…è¯ä¹¦ï¼‰æ­¤é…ç½®æ–‡ä»¶æœ‰æ•ˆçš„ UDID æ•°ç»„</li>
<li><strong>ProvisionsAllDevices</strong>: å¸ƒå°”å€¼ï¼ˆä¼ä¸šè¯ä¹¦ä¸º trueï¼‰</li>
<li><strong>TeamIdentifier</strong>: ä¸€ä¸ªï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªï¼‰å­—æ¯æ•°å­—å­—ç¬¦ä¸²çš„æ•°ç»„ï¼Œç”¨äºè¯†åˆ«å¼€å‘è€…ä»¥ä¾¿è¿›è¡Œåº”ç”¨é—´äº¤äº’</li>
<li><strong>TeamName</strong>: ç”¨äºè¯†åˆ«å¼€å‘è€…çš„äººç±»å¯è¯»åç§°</li>
<li><strong>TimeToLive</strong>: è¯ä¹¦çš„æœ‰æ•ˆæœŸï¼ˆä»¥å¤©ä¸ºå•ä½ï¼‰</li>
<li><strong>UUID</strong>: æ­¤é…ç½®æ–‡ä»¶çš„é€šç”¨å”¯ä¸€æ ‡è¯†ç¬¦</li>
<li><strong>Version</strong>: å½“å‰è®¾ç½®ä¸º 1</li>
</ul>
<p>è¯·æ³¨æ„ï¼Œæƒé™æ¡ç›®å°†åŒ…å«ä¸€ç»„å—é™çš„æƒé™ï¼Œé…ç½®æ–‡ä»¶åªèƒ½æä¾›è¿™äº›ç‰¹å®šçš„æƒé™ï¼Œä»¥é˜²æ­¢æä¾›è‹¹æœçš„ç§æœ‰æƒé™ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œé…ç½®æ–‡ä»¶é€šå¸¸ä½äº <code>/var/MobileDeviceProvisioningProfiles</code>ï¼Œå¯ä»¥ä½¿ç”¨ <strong><code>security cms -D -i /path/to/profile</code></strong> æ£€æŸ¥å®ƒä»¬ã€‚</p>
<h2 id="libmisdyld"><a class="header" href="#libmisdyld"><strong>libmis.dyld</strong></a></h2>
<p>è¿™æ˜¯ <code>amfid</code> è°ƒç”¨çš„å¤–éƒ¨åº“ï¼Œç”¨äºè¯¢é—®æ˜¯å¦åº”è¯¥å…è®¸æŸäº›æ“ä½œã€‚å†å²ä¸Šï¼Œè¿™åœ¨è¶Šç‹±ä¸­è¢«æ»¥ç”¨ï¼Œé€šè¿‡è¿è¡Œä¸€ä¸ªåé—¨ç‰ˆæœ¬æ¥å…è®¸æ‰€æœ‰æ“ä½œã€‚</p>
<p>åœ¨ macOS ä¸­ï¼Œè¿™åœ¨ <code>MobileDevice.framework</code> å†…éƒ¨ã€‚</p>
<h2 id="amfi-ä¿¡ä»»ç¼“å­˜"><a class="header" href="#amfi-ä¿¡ä»»ç¼“å­˜">AMFI ä¿¡ä»»ç¼“å­˜</a></h2>
<p>iOS AMFI ç»´æŠ¤ä¸€ä¸ªå·²çŸ¥å“ˆå¸Œçš„åˆ—è¡¨ï¼Œè¿™äº›å“ˆå¸Œæ˜¯ä¸´æ—¶ç­¾åçš„ï¼Œç§°ä¸º <strong>ä¿¡ä»»ç¼“å­˜</strong>ï¼Œä½äº kext çš„ <code>__TEXT.__const</code> éƒ¨åˆ†ã€‚è¯·æ³¨æ„ï¼Œåœ¨éå¸¸ç‰¹å®šå’Œæ•æ„Ÿçš„æ“ä½œä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¤–éƒ¨æ–‡ä»¶æ‰©å±•æ­¤ä¿¡ä»»ç¼“å­˜ã€‚</p>
<h2 id="å‚è€ƒæ–‡çŒ®"><a class="header" href="#å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</a></h2>
<ul>
<li><a href="https://newosxbook.com/home.html"><strong>*OS Internals Volume III</strong></a></li>
</ul>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks Training AWS Red Team Expert (ARTE)</strong></a><img src="../../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks Training GCP Red Team Expert (GRTE)</strong><img src="../../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>åœ¨ Twitter ä¸Šå…³æ³¨</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../macos-hardening/macos-security-and-privilege-escalation/macos-security-protections/macos-dangerous-entitlements.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../macos-hardening/macos-security-and-privilege-escalation/macos-security-protections/macos-macf-mandatory-access-control-framework.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../macos-hardening/macos-security-and-privilege-escalation/macos-security-protections/macos-dangerous-entitlements.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../macos-hardening/macos-security-and-privilege-escalation/macos-security-protections/macos-macf-mandatory-access-control-framework.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
