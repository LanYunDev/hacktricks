<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>macOS MACF - Mandatory Access Control Framework</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="macos-macf"><a class="header" href="#macos-macf">macOS MACF</a></h1>
<p>{% hint style="success" %}
学习与实践 AWS 黑客技术：<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="../../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习与实践 GCP 黑客技术：<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="../../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>Telegram 群组</strong></a> 或 <strong>关注</strong> 我们的 <strong>Twitter</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub 仓库提交 PR 分享黑客技巧。</li>
</ul>
</details>
{% endhint %}
<h2 id="基本信息"><a class="header" href="#基本信息">基本信息</a></h2>
<p><strong>MACF</strong> 代表 <strong>强制访问控制框架</strong>，这是一个内置于操作系统的安全系统，旨在帮助保护您的计算机。它通过设置 <strong>关于谁或什么可以访问系统某些部分的严格规则</strong>（例如文件、应用程序和系统资源）来工作。通过自动执行这些规则，MACF 确保只有授权用户和进程可以执行特定操作，从而降低未经授权访问或恶意活动的风险。</p>
<p>请注意，MACF 并不真正做出任何决策，因为它只是 <strong>拦截</strong> 操作，它将决策留给它调用的 <strong>策略模块</strong>（内核扩展），如 <code>AppleMobileFileIntegrity.kext</code>、<code>Quarantine.kext</code>、<code>Sandbox.kext</code>、<code>TMSafetyNet.kext</code> 和 <code>mcxalr.kext</code>。</p>
<h3 id="流程"><a class="header" href="#流程">流程</a></h3>
<ol>
<li>进程执行系统调用/mach trap</li>
<li>内核内部调用相关函数</li>
<li>函数调用 MACF</li>
<li>MACF 检查请求在其策略中挂钩该函数的策略模块</li>
<li>MACF 调用相关策略</li>
<li>策略指示是否允许或拒绝该操作</li>
</ol>
<p>{% hint style="danger" %}
苹果是唯一可以使用 MAC 框架 KPI 的公司。
{% endhint %}</p>
<h3 id="标签"><a class="header" href="#标签">标签</a></h3>
<p>MACF 使用 <strong>标签</strong>，然后策略检查是否应授予某些访问权限。标签结构声明的代码可以在 <a href="https://github.com/apple-oss-distributions/xnu/blob/94d3b452840153a99b38a3a9659680b2a006908e/security/_label.h">这里</a> 找到，该代码随后在 <strong><code>struct ucred</code></strong> 中使用，见 <a href="https://github.com/apple-oss-distributions/xnu/blob/94d3b452840153a99b38a3a9659680b2a006908e/bsd/sys/ucred.h#L86"><strong>这里</strong></a> 的 <strong><code>cr_label</code></strong> 部分。标签包含标志和可由 <strong>MACF 策略分配指针</strong> 的多个 <strong>槽</strong>。例如，Sandbox 将指向容器配置文件。</p>
<h2 id="macf-策略"><a class="header" href="#macf-策略">MACF 策略</a></h2>
<p>MACF 策略定义了 <strong>在某些内核操作中应用的规则和条件</strong>。 </p>
<p>内核扩展可以配置 <code>mac_policy_conf</code> 结构，然后通过调用 <code>mac_policy_register</code> 注册它。从 <a href="https://opensource.apple.com/source/xnu/xnu-2050.18.24/security/mac_policy.h.auto.html">这里</a>：</p>
<pre><code class="language-c">#define mpc_t	struct mac_policy_conf *

/**
@brief Mac policy configuration

This structure specifies the configuration information for a
MAC policy module.  A policy module developer must supply
a short unique policy name, a more descriptive full name, a list of label
namespaces and count, a pointer to the registered enty point operations,
any load time flags, and optionally, a pointer to a label slot identifier.

The Framework will update the runtime flags (mpc_runtime_flags) to
indicate that the module has been registered.

If the label slot identifier (mpc_field_off) is NULL, the Framework
will not provide label storage for the policy.  Otherwise, the
Framework will store the label location (slot) in this field.

The mpc_list field is used by the Framework and should not be
modified by policies.
*/
/* XXX - reorder these for better aligment on 64bit platforms */
struct mac_policy_conf {
const char		*mpc_name;		/** policy name */
const char		*mpc_fullname;		/** full name */
const char		**mpc_labelnames;	/** managed label namespaces */
unsigned int		 mpc_labelname_count;	/** number of managed label namespaces */
struct mac_policy_ops	*mpc_ops;		/** operation vector */
int			 mpc_loadtime_flags;	/** load time flags */
int			*mpc_field_off;		/** label slot */
int			 mpc_runtime_flags;	/** run time flags */
mpc_t			 mpc_list;		/** List reference */
void			*mpc_data;		/** module data */
};
</code></pre>
<p>很容易通过检查对 <code>mac_policy_register</code> 的调用来识别配置这些策略的内核扩展。此外，通过检查扩展的反汇编，也可以找到使用的 <code>mac_policy_conf</code> 结构。</p>
<p>请注意，MACF 策略也可以<strong>动态</strong>注册和注销。</p>
<p><code>mac_policy_conf</code> 的主要字段之一是 <strong><code>mpc_ops</code></strong>。该字段指定了策略感兴趣的操作。请注意，它们有数百个，因此可以将所有操作置为零，然后仅选择策略感兴趣的操作。从 <a href="https://opensource.apple.com/source/xnu/xnu-2050.18.24/security/mac_policy.h.auto.html">这里</a>:</p>
<pre><code class="language-c">struct mac_policy_ops {
mpo_audit_check_postselect_t		*mpo_audit_check_postselect;
mpo_audit_check_preselect_t		*mpo_audit_check_preselect;
mpo_bpfdesc_label_associate_t		*mpo_bpfdesc_label_associate;
mpo_bpfdesc_label_destroy_t		*mpo_bpfdesc_label_destroy;
mpo_bpfdesc_label_init_t		*mpo_bpfdesc_label_init;
mpo_bpfdesc_check_receive_t		*mpo_bpfdesc_check_receive;
mpo_cred_check_label_update_execve_t	*mpo_cred_check_label_update_execve;
mpo_cred_check_label_update_t		*mpo_cred_check_label_update;
[...]
</code></pre>
<p>几乎所有的钩子在拦截这些操作时都会被 MACF 回调。然而，<strong><code>mpo_policy_*</code></strong> 钩子是一个例外，因为 <code>mpo_hook_policy_init()</code> 是在注册时调用的回调（即在 <code>mac_policy_register()</code> 之后），而 <code>mpo_hook_policy_initbsd()</code> 是在 BSD 子系统正确初始化后进行晚期注册时调用的。</p>
<p>此外，<strong><code>mpo_policy_syscall</code></strong> 钩子可以被任何 kext 注册，以暴露一个私有的 <strong>ioctl</strong> 风格调用 <strong>接口</strong>。然后，用户客户端将能够调用 <code>mac_syscall</code> (#381)，并指定 <strong>策略名称</strong>、一个整数 <strong>代码</strong> 和可选的 <strong>参数</strong> 作为参数。<br />
例如，<strong><code>Sandbox.kext</code></strong> 经常使用这个。</p>
<p>检查 kext 的 <strong><code>__DATA.__const*</code></strong> 可以识别在注册策略时使用的 <code>mac_policy_ops</code> 结构。可以找到它，因为它的指针在 <code>mpo_policy_conf</code> 内部的一个偏移量处，并且因为该区域将有许多 NULL 指针。</p>
<p>此外，还可以通过从内存中转储结构 <strong><code>_mac_policy_list</code></strong> 来获取已配置策略的 kext 列表，该结构会随着每个注册的策略而更新。</p>
<h2 id="macf-初始化"><a class="header" href="#macf-初始化">MACF 初始化</a></h2>
<p>MACF 很快就会初始化。它在 XNU 的 <code>bootstrap_thread</code> 中设置：在 <code>ipc_bootstrap</code> 之后调用 <code>mac_policy_init()</code>，该函数初始化 <code>mac_policy_list</code>，随后调用 <code>mac_policy_initmach()</code>。除了其他功能外，该函数将获取所有在其 Info.plist 中具有 <code>AppleSecurityExtension</code> 键的 Apple kext，如 <code>ALF.kext</code>、<code>AppleMobileFileIntegrity.kext</code>、<code>Quarantine.kext</code>、<code>Sandbox.kext</code> 和 <code>TMSafetyNet.kext</code> 并加载它们。</p>
<h2 id="macf-回调"><a class="header" href="#macf-回调">MACF 回调</a></h2>
<p>在代码中常常可以找到对 MACF 的回调定义，例如：<strong><code>#if CONFIG_MAC</code></strong> 条件块。此外，在这些块内可以找到对 <code>mac_proc_check*</code> 的调用，该调用会调用 MACF 来 <strong>检查权限</strong> 以执行某些操作。此外，MACF 回调的格式为：<strong><code>mac_&lt;object&gt;_&lt;opType&gt;_opName</code></strong>。</p>
<p>对象是以下之一：<code>bpfdesc</code>、<code>cred</code>、<code>file</code>、<code>proc</code>、<code>vnode</code>、<code>mount</code>、<code>devfs</code>、<code>ifnet</code>、<code>inpcb</code>、<code>mbuf</code>、<code>ipq</code>、<code>pipe</code>、<code>sysv[msg/msq/shm/sem]</code>、<code>posix[shm/sem]</code>、<code>socket</code>、<code>kext</code>。<br />
<code>opType</code> 通常是 check，用于允许或拒绝该操作。然而，也可以找到 notify，这将允许 kext 对给定操作做出反应。</p>
<p>您可以在 <a href="https://github.com/apple-oss-distributions/xnu/blob/94d3b452840153a99b38a3a9659680b2a006908e/bsd/kern/kern_mman.c#L621">https://github.com/apple-oss-distributions/xnu/blob/94d3b452840153a99b38a3a9659680b2a006908e/bsd/kern/kern_mman.c#L621</a> 中找到一个示例：</p>
<pre class="language-c"><code class="lang-c">int
mmap(proc_t p, struct mmap_args *uap, user_addr_t *retval)
{
[...]
#if CONFIG_MACF
<strong>			error = mac_file_check_mmap(vfs_context_ucred(ctx),
</strong>			    fp->fp_glob, prot, flags, file_pos + pageoff,
&#x26;maxprot);
if (error) {
(void)vnode_put(vp);
goto bad;
}
#endif /* MAC */
[...]
</code></pre>
<p>然后，可以在 <a href="https://github.com/apple-oss-distributions/xnu/blob/94d3b452840153a99b38a3a9659680b2a006908e/security/mac_file.c#L174">https://github.com/apple-oss-distributions/xnu/blob/94d3b452840153a99b38a3a9659680b2a006908e/security/mac_file.c#L174</a> 中找到 <code>mac_file_check_mmap</code> 的代码。</p>
<pre><code class="language-c">mac_file_check_mmap(struct ucred *cred, struct fileglob *fg, int prot,
int flags, uint64_t offset, int *maxprot)
{
int error;
int maxp;

maxp = *maxprot;
MAC_CHECK(file_check_mmap, cred, fg, NULL, prot, flags, offset, &amp;maxp);
if ((maxp | *maxprot) != *maxprot) {
panic("file_check_mmap increased max protections");
}
*maxprot = maxp;
return error;
}
</code></pre>
<p>调用 <code>MAC_CHECK</code> 宏的代码可以在 <a href="https://github.com/apple-oss-distributions/xnu/blob/94d3b452840153a99b38a3a9659680b2a006908e/security/mac_internal.h#L261">https://github.com/apple-oss-distributions/xnu/blob/94d3b452840153a99b38a3a9659680b2a006908e/security/mac_internal.h#L261</a> 找到。</p>
<pre><code class="language-c">/*
* MAC_CHECK performs the designated check by walking the policy
* module list and checking with each as to how it feels about the
* request.  Note that it returns its value via 'error' in the scope
* of the caller.
*/
#define MAC_CHECK(check, args...) do {                              \
error = 0;                                                      \
MAC_POLICY_ITERATE({                                            \
if (mpc-&gt;mpc_ops-&gt;mpo_ ## check != NULL) {              \
DTRACE_MACF3(mac__call__ ## check, void *, mpc, int, error, int, MAC_ITERATE_CHECK); \
int __step_err = mpc-&gt;mpc_ops-&gt;mpo_ ## check (args); \
DTRACE_MACF2(mac__rslt__ ## check, void *, mpc, int, __step_err); \
error = mac_error_select(__step_err, error);         \
}                                                           \
});                                                             \
} while (0)
</code></pre>
<p>将遍历所有注册的 mac 策略，调用它们的函数并将输出存储在 error 变量中，该变量仅可通过成功代码的 <code>mac_error_select</code> 进行覆盖，因此如果任何检查失败，整个检查将失败，操作将不被允许。</p>
<p>{% hint style="success" %}
然而，请记住，并非所有 MACF 调用仅用于拒绝操作。例如，<code>mac_priv_grant</code> 调用宏 <a href="https://github.com/apple-oss-distributions/xnu/blob/94d3b452840153a99b38a3a9659680b2a006908e/security/mac_internal.h#L274"><strong>MAC_GRANT</strong></a>，如果任何策略以 0 响应，将授予请求的特权：</p>
<pre><code class="language-c">/*
* MAC_GRANT performs the designated check by walking the policy
* module list and checking with each as to how it feels about the
* request.  Unlike MAC_CHECK, it grants if any policies return '0',
* and otherwise returns EPERM.  Note that it returns its value via
* 'error' in the scope of the caller.
*/
#define MAC_GRANT(check, args...) do {                              \
error = EPERM;                                                  \
MAC_POLICY_ITERATE({                                            \
if (mpc-&gt;mpc_ops-&gt;mpo_ ## check != NULL) {                  \
DTRACE_MACF3(mac__call__ ## check, void *, mpc, int, error, int, MAC_ITERATE_GRANT); \
int __step_res = mpc-&gt;mpc_ops-&gt;mpo_ ## check (args); \
if (__step_res == 0) {                              \
error = 0;                                  \
}                                                   \
DTRACE_MACF2(mac__rslt__ ## check, void *, mpc, int, __step_res); \
}                                                           \
});                                                             \
} while (0)
</code></pre>
<p>{% endhint %}</p>
<h3 id="priv_check--priv_grant"><a class="header" href="#priv_check--priv_grant">priv_check &amp; priv_grant</a></h3>
<p>这些调用旨在检查和提供在 <a href="https://github.com/apple-oss-distributions/xnu/blob/94d3b452840153a99b38a3a9659680b2a006908e/bsd/sys/priv.h"><strong>bsd/sys/priv.h</strong></a> 中定义的（数十个）<strong>权限</strong>。<br />
一些内核代码会从 <a href="https://github.com/apple-oss-distributions/xnu/blob/94d3b452840153a99b38a3a9659680b2a006908e/bsd/kern/kern_priv.c"><strong>bsd/kern/kern_priv.c</strong></a> 调用 <code>priv_check_cred()</code>，使用进程的 KAuth 凭据和一个权限代码，这将调用 <code>mac_priv_check</code> 来查看是否有任何策略<strong>拒绝</strong>授予该权限，然后调用 <code>mac_priv_grant</code> 来查看是否有任何策略授予该 <code>privilege</code>。</p>
<h3 id="proc_check_syscall_unix"><a class="header" href="#proc_check_syscall_unix">proc_check_syscall_unix</a></h3>
<p>此钩子允许拦截所有系统调用。在 <code>bsd/dev/[i386|arm]/systemcalls.c</code> 中，可以看到声明的函数 <a href="https://github.com/apple-oss-distributions/xnu/blob/94d3b452840153a99b38a3a9659680b2a006908e/bsd/dev/arm/systemcalls.c#L160C1-L167C25"><code>unix_syscall</code></a>，其中包含以下代码：</p>
<pre><code class="language-c">#if CONFIG_MACF
if (__improbable(proc_syscall_filter_mask(proc) != NULL &amp;&amp; !bitstr_test(proc_syscall_filter_mask(proc), syscode))) {
error = mac_proc_check_syscall_unix(proc, syscode);
if (error) {
goto skip_syscall;
}
}
#endif /* CONFIG_MACF */
</code></pre>
<p>将检查调用进程的 <strong>bitmask</strong>，以确定当前的系统调用是否应该调用 <code>mac_proc_check_syscall_unix</code>。这是因为系统调用的频率很高，因此避免每次都调用 <code>mac_proc_check_syscall_unix</code> 是很有意义的。</p>
<p>请注意，函数 <code>proc_set_syscall_filter_mask()</code>，用于设置进程中的 bitmask 系统调用，是由 Sandbox 调用以在沙箱进程上设置掩码的。</p>
<h2 id="暴露的-macf-系统调用"><a class="header" href="#暴露的-macf-系统调用">暴露的 MACF 系统调用</a></h2>
<p>可以通过在 <a href="https://github.com/apple-oss-distributions/xnu/blob/94d3b452840153a99b38a3a9659680b2a006908e/security/mac.h#L151">security/mac.h</a> 中定义的一些系统调用与 MACF 进行交互：</p>
<pre><code class="language-c">/*
* Extended non-POSIX.1e interfaces that offer additional services
* available from the userland and kernel MAC frameworks.
*/
#ifdef __APPLE_API_PRIVATE
__BEGIN_DECLS
int      __mac_execve(char *fname, char **argv, char **envv, mac_t _label);
int      __mac_get_fd(int _fd, mac_t _label);
int      __mac_get_file(const char *_path, mac_t _label);
int      __mac_get_link(const char *_path, mac_t _label);
int      __mac_get_pid(pid_t _pid, mac_t _label);
int      __mac_get_proc(mac_t _label);
int      __mac_set_fd(int _fildes, const mac_t _label);
int      __mac_set_file(const char *_path, mac_t _label);
int      __mac_set_link(const char *_path, mac_t _label);
int      __mac_mount(const char *type, const char *path, int flags, void *data,
struct mac *label);
int      __mac_get_mount(const char *path, struct mac *label);
int      __mac_set_proc(const mac_t _label);
int      __mac_syscall(const char *_policyname, int _call, void *_arg);
__END_DECLS
#endif /*__APPLE_API_PRIVATE*/
</code></pre>
<h2 id="参考文献"><a class="header" href="#参考文献">参考文献</a></h2>
<ul>
<li><a href="https://newosxbook.com/home.html"><strong>*OS 内部结构 第三卷</strong></a></li>
</ul>
<p>{% hint style="success" %}
学习与实践 AWS 黑客技术：<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="../../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习与实践 GCP 黑客技术：<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="../../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>电报群组</strong></a> 或 <strong>在</strong> <strong>Twitter</strong> 🐦 <strong>上关注我们</strong> <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github 仓库提交 PR 分享黑客技巧。</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../macos-hardening/macos-security-and-privilege-escalation/macos-security-protections/macos-amfi-applemobilefileintegrity.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../macos-hardening/macos-security-and-privilege-escalation/macos-security-protections/macos-code-signing.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../macos-hardening/macos-security-and-privilege-escalation/macos-security-protections/macos-amfi-applemobilefileintegrity.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../macos-hardening/macos-security-and-privilege-escalation/macos-security-protections/macos-code-signing.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
