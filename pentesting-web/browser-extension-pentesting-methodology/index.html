<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Browser Extension Pentesting Methodology</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="æµè§ˆå™¨æ‰©å±•æ¸—é€æµ‹è¯•æ–¹æ³•è®º"><a class="header" href="#æµè§ˆå™¨æ‰©å±•æ¸—é€æµ‹è¯•æ–¹æ³•è®º">æµè§ˆå™¨æ‰©å±•æ¸—é€æµ‹è¯•æ–¹æ³•è®º</a></h1>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>å…³æ³¨</strong> æˆ‘ä»¬çš„ <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<h2 id="åŸºæœ¬ä¿¡æ¯"><a class="header" href="#åŸºæœ¬ä¿¡æ¯">åŸºæœ¬ä¿¡æ¯</a></h2>
<p>æµè§ˆå™¨æ‰©å±•æ˜¯ç”¨ JavaScript ç¼–å†™çš„ï¼Œå¹¶åœ¨åå°ç”±æµè§ˆå™¨åŠ è½½ã€‚å®ƒæœ‰è‡ªå·±çš„ <a href="https://www.w3schools.com/js/js_htmldom.asp">DOM</a>ï¼Œä½†å¯ä»¥ä¸å…¶ä»–ç½‘ç«™çš„ DOM è¿›è¡Œäº¤äº’ã€‚è¿™æ„å‘³ç€å®ƒå¯èƒ½ä¼šå±å®³å…¶ä»–ç½‘ç«™çš„æœºå¯†æ€§ã€å®Œæ•´æ€§å’Œå¯ç”¨æ€§ (CIA)ã€‚</p>
<h2 id="ä¸»è¦ç»„ä»¶"><a class="header" href="#ä¸»è¦ç»„ä»¶">ä¸»è¦ç»„ä»¶</a></h2>
<p>æ‰©å±•å¸ƒå±€åœ¨å¯è§†åŒ–æ—¶æ•ˆæœæœ€ä½³ï¼Œç”±ä¸‰ä¸ªç»„ä»¶ç»„æˆã€‚è®©æˆ‘ä»¬æ·±å…¥äº†è§£æ¯ä¸ªç»„ä»¶ã€‚</p>
<figure><img src="../../.gitbook/assets/image (16) (1) (1).png" alt=""><figcaption><p><a href="http://webblaze.cs.berkeley.edu/papers/Extensions.pdf">http://webblaze.cs.berkeley.edu/papers/Extensions.pdf</a></p></figcaption></figure>
<h3 id="å†…å®¹è„šæœ¬"><a class="header" href="#å†…å®¹è„šæœ¬"><strong>å†…å®¹è„šæœ¬</strong></a></h3>
<p>æ¯ä¸ªå†…å®¹è„šæœ¬å¯ä»¥ç›´æ¥è®¿é—® <strong>å•ä¸ªç½‘é¡µ</strong> çš„ DOMï¼Œå› æ­¤æš´éœ²äº <strong>æ½œåœ¨æ¶æ„è¾“å…¥</strong>ã€‚ç„¶è€Œï¼Œå†…å®¹è„šæœ¬é™¤äº†èƒ½å¤Ÿå‘æ‰©å±•æ ¸å¿ƒå‘é€æ¶ˆæ¯å¤–ï¼Œæ²¡æœ‰å…¶ä»–æƒé™ã€‚</p>
<h3 id="æ‰©å±•æ ¸å¿ƒ"><a class="header" href="#æ‰©å±•æ ¸å¿ƒ"><strong>æ‰©å±•æ ¸å¿ƒ</strong></a></h3>
<p>æ‰©å±•æ ¸å¿ƒåŒ…å«å¤§éƒ¨åˆ†æ‰©å±•æƒé™/è®¿é—®ï¼Œä½†æ‰©å±•æ ¸å¿ƒåªèƒ½é€šè¿‡ <a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a> å’Œå†…å®¹è„šæœ¬ä¸ç½‘é¡µå†…å®¹è¿›è¡Œäº¤äº’ã€‚æ­¤å¤–ï¼Œæ‰©å±•æ ¸å¿ƒæ— æ³•ç›´æ¥è®¿é—®ä¸»æœºæœºå™¨ã€‚</p>
<h3 id="æœ¬åœ°äºŒè¿›åˆ¶æ–‡ä»¶"><a class="header" href="#æœ¬åœ°äºŒè¿›åˆ¶æ–‡ä»¶"><strong>æœ¬åœ°äºŒè¿›åˆ¶æ–‡ä»¶</strong></a></h3>
<p>æ‰©å±•å…è®¸ä¸€ä¸ªæœ¬åœ°äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¯ä»¥ <strong>ä»¥ç”¨æˆ·çš„å…¨éƒ¨æƒé™è®¿é—®ä¸»æœºæœºå™¨ã€‚</strong> æœ¬åœ°äºŒè¿›åˆ¶æ–‡ä»¶é€šè¿‡ Flash å’Œå…¶ä»–æµè§ˆå™¨æ’ä»¶ä½¿ç”¨çš„æ ‡å‡† Netscape æ’ä»¶åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ (<a href="https://en.wikipedia.org/wiki/NPAPI">NPAPI</a>) ä¸æ‰©å±•æ ¸å¿ƒè¿›è¡Œäº¤äº’ã€‚</p>
<h3 id="è¾¹ç•Œ"><a class="header" href="#è¾¹ç•Œ">è¾¹ç•Œ</a></h3>
<p>{% hint style="danger" %}
ä¸ºäº†è·å¾—ç”¨æˆ·çš„å…¨éƒ¨æƒé™ï¼Œæ”»å‡»è€…å¿…é¡»è¯´æœæ‰©å±•å°†æ¶æ„è¾“å…¥ä»å†…å®¹è„šæœ¬ä¼ é€’åˆ°æ‰©å±•æ ¸å¿ƒï¼Œå†ä»æ‰©å±•æ ¸å¿ƒä¼ é€’åˆ°æœ¬åœ°äºŒè¿›åˆ¶æ–‡ä»¶ã€‚
{% endhint %}</p>
<p>æ‰©å±•çš„æ¯ä¸ªç»„ä»¶ä¹‹é—´ç”± <strong>å¼ºä¿æŠ¤è¾¹ç•Œ</strong> éš”å¼€ã€‚æ¯ä¸ªç»„ä»¶åœ¨ <strong>å•ç‹¬çš„æ“ä½œç³»ç»Ÿè¿›ç¨‹</strong> ä¸­è¿è¡Œã€‚å†…å®¹è„šæœ¬å’Œæ‰©å±•æ ¸å¿ƒåœ¨ <strong>æ²™ç®±è¿›ç¨‹</strong> ä¸­è¿è¡Œï¼Œè¿™äº›è¿›ç¨‹å¯¹å¤§å¤šæ•°æ“ä½œç³»ç»ŸæœåŠ¡ä¸å¯ç”¨ã€‚</p>
<p>æ­¤å¤–ï¼Œå†…å®¹è„šæœ¬é€šè¿‡ <strong>åœ¨å•ç‹¬çš„ JavaScript å †ä¸­è¿è¡Œ</strong> ä¸å…¶å…³è”çš„ç½‘é¡µåˆ†å¼€ã€‚å†…å®¹è„šæœ¬å’Œç½‘é¡µå¯ä»¥ <strong>è®¿é—®ç›¸åŒçš„åº•å±‚ DOM</strong>ï¼Œä½†ä¸¤è€… <strong>ä»ä¸äº¤æ¢ JavaScript æŒ‡é’ˆ</strong>ï¼Œé˜²æ­¢ JavaScript åŠŸèƒ½çš„æ³„éœ²ã€‚</p>
<h2 id="manifestjson"><a class="header" href="#manifestjson"><strong><code>manifest.json</code></strong></a></h2>
<p>Chrome æ‰©å±•åªæ˜¯ä¸€ä¸ªå¸¦æœ‰ <a href="https://www.lifewire.com/crx-file-2620391">.crx æ–‡ä»¶æ‰©å±•å</a> çš„ ZIP æ–‡ä»¶å¤¹ã€‚æ‰©å±•çš„æ ¸å¿ƒæ˜¯ä½äºæ–‡ä»¶å¤¹æ ¹ç›®å½•çš„ <strong><code>manifest.json</code></strong> æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æŒ‡å®šå¸ƒå±€ã€æƒé™å’Œå…¶ä»–é…ç½®é€‰é¡¹ã€‚</p>
<p>ç¤ºä¾‹ï¼š</p>
<pre><code class="language-json">{
"manifest_version": 2,
"name": "My extension",
"version": "1.0",
"permissions": [
"storage"
],
"content_scripts": [
{
"js": [
"script.js"
],
"matches": [
"https://example.com/*",
"https://www.example.com/*"
],
"exclude_matches": ["*://*/*business*"],
}
],
"background": {
"scripts": [
"background.js"
]
},
"options_ui": {
"page": "options.html"
}
}
</code></pre>
<h3 id="content_scripts"><a class="header" href="#content_scripts"><code>content_scripts</code></a></h3>
<p>å†…å®¹è„šæœ¬åœ¨ç”¨æˆ·<strong>å¯¼èˆªåˆ°åŒ¹é…é¡µé¢</strong>æ—¶<strong>åŠ è½½</strong>ï¼Œåœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œä»»ä½•åŒ¹é…**<code>https://example.com/*</code><strong>è¡¨è¾¾å¼ä¸”ä¸åŒ¹é…</strong><code>*://*/*/business*</code><strong>æ­£åˆ™è¡¨è¾¾å¼çš„é¡µé¢ã€‚å®ƒä»¬</strong>åƒé¡µé¢è‡ªå·±çš„è„šæœ¬**ä¸€æ ·æ‰§è¡Œï¼Œå¹¶ä¸”å¯¹é¡µé¢çš„<a href="https://developer.mozilla.org/en-US/docs/Web/API/Document_Object_Model">æ–‡æ¡£å¯¹è±¡æ¨¡å‹ (DOM)</a>å…·æœ‰ä»»æ„è®¿é—®æƒé™ã€‚</p>
<pre><code class="language-json">"content_scripts": [
{
"js": [
"script.js"
],
"matches": [
"https://example.com/*",
"https://www.example.com/*"
],
"exclude_matches": ["*://*/*business*"],
}
],
</code></pre>
<p>ä¸ºäº†åŒ…å«æˆ–æ’é™¤æ›´å¤šçš„ URLï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <strong><code>include_globs</code></strong> å’Œ <strong><code>exclude_globs</code></strong>ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹å†…å®¹è„šæœ¬ï¼Œå½“ä½¿ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage">å­˜å‚¨ API</a> ä»æ‰©å±•çš„å­˜å‚¨ä¸­æ£€ç´¢ <code>message</code> å€¼æ—¶ï¼Œå°†å‘é¡µé¢æ·»åŠ ä¸€ä¸ªè§£é‡ŠæŒ‰é’®ã€‚</p>
<pre><code class="language-js">chrome.storage.local.get("message", result =&gt;
{
let div = document.createElement("div");
div.innerHTML = result.message + " &lt;button&gt;Explain&lt;/button&gt;";
div.querySelector("button").addEventListener("click", () =&gt;
{
chrome.runtime.sendMessage("explain");
});
document.body.appendChild(div);
});
</code></pre>
<figure><img src="../../.gitbook/assets/image (23).png" alt=""><figcaption></figcaption></figure>
<p>å½“ç‚¹å‡»æ­¤æŒ‰é’®æ—¶ï¼Œé€šè¿‡åˆ©ç”¨<a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/sendMessage"><strong>runtime.sendMessage() API</strong></a>ï¼Œå†…å®¹è„šæœ¬å‘æ‰©å±•é¡µé¢å‘é€æ¶ˆæ¯ã€‚è¿™æ˜¯ç”±äºå†…å®¹è„šæœ¬åœ¨ç›´æ¥è®¿é—®APIæ–¹é¢çš„é™åˆ¶ï¼Œ<code>storage</code>æ˜¯å°‘æ•°ä¾‹å¤–ä¹‹ä¸€ã€‚å¯¹äºè¶…å‡ºè¿™äº›ä¾‹å¤–çš„åŠŸèƒ½ï¼Œæ¶ˆæ¯è¢«å‘é€åˆ°æ‰©å±•é¡µé¢ï¼Œå†…å®¹è„šæœ¬å¯ä»¥ä¸ä¹‹é€šä¿¡ã€‚</p>
<p>{% hint style="warning" %}
æ ¹æ®æµè§ˆå™¨çš„ä¸åŒï¼Œå†…å®¹è„šæœ¬çš„èƒ½åŠ›å¯èƒ½ä¼šç•¥æœ‰ä¸åŒã€‚å¯¹äºåŸºäºChromiumçš„æµè§ˆå™¨ï¼Œèƒ½åŠ›åˆ—è¡¨å¯åœ¨<a href="https://developer.chrome.com/docs/extensions/mv3/content_scripts/#capabilities">Chrome Developers documentation</a>ä¸­æ‰¾åˆ°ï¼Œè€Œå¯¹äºFirefoxï¼Œ<a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_scripts#webextension_apis">MDN</a>æ˜¯ä¸»è¦æ¥æºã€‚<br />
å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå†…å®¹è„šæœ¬èƒ½å¤Ÿä¸åå°è„šæœ¬è¿›è¡Œé€šä¿¡ï¼Œä½¿å…¶èƒ½å¤Ÿæ‰§è¡Œæ“ä½œå¹¶ä¼ é€’å“åº”ã€‚
{% endhint %}</p>
<p>è¦åœ¨Chromeä¸­æŸ¥çœ‹å’Œè°ƒè¯•å†…å®¹è„šæœ¬ï¼Œå¯ä»¥é€šè¿‡é€‰é¡¹ &gt; æ›´å¤šå·¥å…· &gt; å¼€å‘è€…å·¥å…·è®¿é—®Chromeå¼€å‘è€…å·¥å…·èœå•ï¼Œæˆ–æŒ‰Ctrl + Shift + Iã€‚</p>
<p>å½“å¼€å‘è€…å·¥å…·æ˜¾ç¤ºåï¼Œç‚¹å‡»<strong>æº</strong>é€‰é¡¹å¡ï¼Œç„¶åç‚¹å‡»<strong>å†…å®¹è„šæœ¬</strong>é€‰é¡¹å¡ã€‚è¿™å…è®¸è§‚å¯Ÿæ¥è‡ªå„ç§æ‰©å±•çš„è¿è¡Œå†…å®¹è„šæœ¬ï¼Œå¹¶è®¾ç½®æ–­ç‚¹ä»¥è·Ÿè¸ªæ‰§è¡Œæµç¨‹ã€‚</p>
<h3 id="æ³¨å…¥çš„å†…å®¹è„šæœ¬"><a class="header" href="#æ³¨å…¥çš„å†…å®¹è„šæœ¬">æ³¨å…¥çš„å†…å®¹è„šæœ¬</a></h3>
<p>{% hint style="success" %}
è¯·æ³¨æ„ï¼Œ<strong>å†…å®¹è„šæœ¬ä¸æ˜¯å¼ºåˆ¶æ€§çš„</strong>ï¼Œå› ä¸ºä¹Ÿå¯ä»¥<strong>åŠ¨æ€</strong> <strong>æ³¨å…¥</strong>è„šæœ¬ï¼Œå¹¶é€šè¿‡**<code>tabs.executeScript</code><strong>åœ¨ç½‘é¡µä¸­</strong>ç¨‹åºåŒ–åœ°æ³¨å…¥<strong>å®ƒä»¬ã€‚è¿™å®é™…ä¸Šæä¾›äº†æ›´</strong>ç»†ç²’åº¦çš„æ§åˆ¶**ã€‚
{% endhint %}</p>
<p>å¯¹äºå†…å®¹è„šæœ¬çš„ç¨‹åºåŒ–æ³¨å…¥ï¼Œæ‰©å±•éœ€è¦å¯¹è¦æ³¨å…¥è„šæœ¬çš„é¡µé¢å…·æœ‰<a href="https://developer.chrome.com/docs/extensions/reference/permissions">ä¸»æœºæƒé™</a>ã€‚è¿™äº›æƒé™å¯ä»¥é€šè¿‡åœ¨æ‰©å±•çš„æ¸…å•ä¸­<strong>è¯·æ±‚å®ƒä»¬</strong>æˆ–é€šè¿‡<a href="https://developer.chrome.com/docs/extensions/reference/manifest/activeTab"><strong>activeTab</strong></a>ä¸´æ—¶è·å¾—ã€‚</p>
<h4 id="ç¤ºä¾‹-activetab-åŸºç¡€æ‰©å±•"><a class="header" href="#ç¤ºä¾‹-activetab-åŸºç¡€æ‰©å±•">ç¤ºä¾‹ activeTab åŸºç¡€æ‰©å±•</a></h4>
<p>{% code title="manifest.json" %}</p>
<pre><code class="language-json">{
"name": "My extension",
...
"permissions": [
"activeTab",
"scripting"
],
"background": {
"service_worker": "background.js"
},
"action": {
"default_title": "Action Button"
}
}
</code></pre>
<p>{% endcode %}</p>
<ul>
<li><strong>ç‚¹å‡»æ—¶æ³¨å…¥ä¸€ä¸ªJSæ–‡ä»¶ï¼š</strong></li>
</ul>
<pre><code class="language-javascript">// content-script.js
document.body.style.backgroundColor = "orange";

//service-worker.js - Inject the JS file
chrome.action.onClicked.addListener((tab) =&gt; {
chrome.scripting.executeScript({
target: { tabId: tab.id },
files: ["content-script.js"]
});
});
</code></pre>
<ul>
<li><strong>åœ¨ç‚¹å‡»æ—¶æ³¨å…¥ä¸€ä¸ªå‡½æ•°</strong>:</li>
</ul>
<pre><code class="language-javascript">//service-worker.js - Inject a function
function injectedFunction() {
document.body.style.backgroundColor = "orange";
}

chrome.action.onClicked.addListener((tab) =&gt; {
chrome.scripting.executeScript({
target : {tabId : tab.id},
func : injectedFunction,
});
});
</code></pre>
<h4 id="ç¤ºä¾‹ä¸è„šæœ¬æƒé™"><a class="header" href="#ç¤ºä¾‹ä¸è„šæœ¬æƒé™">ç¤ºä¾‹ä¸è„šæœ¬æƒé™</a></h4>
<pre><code class="language-javascript">// service-workser.js
chrome.scripting.registerContentScripts([{
id : "test",
matches : [ "https://*.example.com/*" ],
excludeMatches : [ "*://*/*business*" ],
js : [ "contentScript.js" ],
}]);

// Another example
chrome.tabs.executeScript(tabId, { file: "content_script.js" });
</code></pre>
<p>ä¸ºäº†åŒ…å«æˆ–æ’é™¤æ›´å¤šçš„ URLï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <strong><code>include_globs</code></strong> å’Œ <strong><code>exclude_globs</code></strong>ã€‚</p>
<h3 id="å†…å®¹è„šæœ¬-run_at"><a class="header" href="#å†…å®¹è„šæœ¬-run_at">å†…å®¹è„šæœ¬ <code>run_at</code></a></h3>
<p><code>run_at</code> å­—æ®µæ§åˆ¶ <strong>JavaScript æ–‡ä»¶ä½•æ—¶æ³¨å…¥åˆ°ç½‘é¡µä¸­</strong>ã€‚é¦–é€‰å’Œé»˜è®¤å€¼æ˜¯ <code>"document_idle"</code>ã€‚</p>
<p>å¯èƒ½çš„å€¼æœ‰ï¼š</p>
<ul>
<li><strong><code>document_idle</code></strong>ï¼šå°½å¯èƒ½åœ°</li>
<li><strong><code>document_start</code></strong>ï¼šåœ¨ä»»ä½• <code>css</code> æ–‡ä»¶ä¹‹åï¼Œä½†åœ¨æ„å»ºä»»ä½•å…¶ä»– DOM æˆ–è¿è¡Œä»»ä½•å…¶ä»–è„šæœ¬ä¹‹å‰ã€‚</li>
<li><strong><code>document_end</code></strong>ï¼šåœ¨ DOM å®Œæˆåç«‹å³ï¼Œä½†åœ¨å›¾åƒå’Œæ¡†æ¶ç­‰å­èµ„æºåŠ è½½ä¹‹å‰ã€‚</li>
</ul>
<h4 id="é€šè¿‡-manifestjson"><a class="header" href="#é€šè¿‡-manifestjson">é€šè¿‡ <code>manifest.json</code></a></h4>
<pre><code class="language-json">{
"name": "My extension",
...
"content_scripts": [
{
"matches": ["https://*.example.com/*"],
"run_at": "document_idle",
"js": ["contentScript.js"]
}
],
...
}

</code></pre>
<p>é€šè¿‡ <strong><code>service-worker.js</code></strong></p>
<pre><code class="language-javascript">chrome.scripting.registerContentScripts([{
id : "test",
matches : [ "https://*.example.com/*" ],
runAt : "document_idle",
js : [ "contentScript.js" ],
}]);
</code></pre>
<h3 id="background"><a class="header" href="#background"><code>background</code></a></h3>
<p>ç”±å†…å®¹è„šæœ¬å‘é€çš„æ¶ˆæ¯ç”±<strong>åå°é¡µé¢</strong>æ¥æ”¶ï¼Œåå°é¡µé¢åœ¨åè°ƒæ‰©å±•çš„ç»„ä»¶ä¸­å‘æŒ¥ç€æ ¸å¿ƒä½œç”¨ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œåå°é¡µé¢åœ¨æ‰©å±•çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­æŒç»­å­˜åœ¨ï¼Œé»˜é»˜è¿è¡Œè€Œæ— éœ€ç›´æ¥ç”¨æˆ·äº¤äº’ã€‚å®ƒæ‹¥æœ‰è‡ªå·±çš„æ–‡æ¡£å¯¹è±¡æ¨¡å‹ï¼ˆDOMï¼‰ï¼Œèƒ½å¤Ÿå®ç°å¤æ‚çš„äº¤äº’å’ŒçŠ¶æ€ç®¡ç†ã€‚</p>
<p><strong>å…³é”®ç‚¹</strong>ï¼š</p>
<ul>
<li><strong>åå°é¡µé¢è§’è‰²ï¼š</strong> ä½œä¸ºæ‰©å±•çš„ç¥ç»ä¸­æ¢ï¼Œç¡®ä¿æ‰©å±•å„éƒ¨åˆ†ä¹‹é—´çš„é€šä¿¡å’Œåè°ƒã€‚</li>
<li><strong>æŒä¹…æ€§ï¼š</strong> å®ƒæ˜¯ä¸€ä¸ªå§‹ç»ˆå­˜åœ¨çš„å®ä½“ï¼Œå¯¹ç”¨æˆ·ä¸å¯è§ï¼Œä½†å¯¹æ‰©å±•çš„åŠŸèƒ½è‡³å…³é‡è¦ã€‚</li>
<li><strong>è‡ªåŠ¨ç”Ÿæˆï¼š</strong> å¦‚æœæœªæ˜ç¡®å®šä¹‰ï¼Œæµè§ˆå™¨å°†è‡ªåŠ¨åˆ›å»ºä¸€ä¸ªåå°é¡µé¢ã€‚è¿™ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„é¡µé¢å°†åŒ…å«æ‰©å±•æ¸…å•ä¸­æŒ‡å®šçš„æ‰€æœ‰åå°è„šæœ¬ï¼Œç¡®ä¿æ‰©å±•åå°ä»»åŠ¡çš„æ— ç¼è¿è¡Œã€‚</li>
</ul>
<p>{% hint style="success" %}
æµè§ˆå™¨åœ¨è‡ªåŠ¨ç”Ÿæˆåå°é¡µé¢ï¼ˆæœªæ˜ç¡®å£°æ˜æ—¶ï¼‰æ‰€æä¾›çš„ä¾¿åˆ©ï¼Œç¡®ä¿æ‰€æœ‰å¿…è¦çš„åå°è„šæœ¬éƒ½è¢«é›†æˆå¹¶æ­£å¸¸è¿è¡Œï¼Œä»è€Œç®€åŒ–äº†æ‰©å±•çš„è®¾ç½®è¿‡ç¨‹ã€‚
{% endhint %}</p>
<p>ç¤ºä¾‹åå°è„šæœ¬ï¼š</p>
<pre><code class="language-js">chrome.runtime.onMessage.addListener((request, sender, sendResponse) =&gt;
{
if (request == "explain")
{
chrome.tabs.create({ url: "https://example.net/explanation" });
}
})
</code></pre>
<p>å®ƒä½¿ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage">runtime.onMessage API</a> æ¥ç›‘å¬æ¶ˆæ¯ã€‚å½“æ¥æ”¶åˆ° <code>"explain"</code> æ¶ˆæ¯æ—¶ï¼Œå®ƒä½¿ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs">tabs API</a> åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€ä¸€ä¸ªé¡µé¢ã€‚</p>
<p>è¦è°ƒè¯•åå°è„šæœ¬ï¼Œæ‚¨å¯ä»¥è½¬åˆ° <strong>æ‰©å±•è¯¦ç»†ä¿¡æ¯å¹¶æ£€æŸ¥æœåŠ¡å·¥ä½œè€…ï¼Œ</strong> è¿™å°†æ‰“å¼€å¸¦æœ‰åå°è„šæœ¬çš„å¼€å‘è€…å·¥å…·ï¼š</p>
<figure><img src="https://github.com/carlospolop/hacktricks/blob/master/pentesting-web/browser-extension-pentesting-methodology/broken-reference" alt=""><figcaption></figcaption></figure>
<h3 id="é€‰é¡¹é¡µé¢å’Œå…¶ä»–"><a class="header" href="#é€‰é¡¹é¡µé¢å’Œå…¶ä»–">é€‰é¡¹é¡µé¢å’Œå…¶ä»–</a></h3>
<p>æµè§ˆå™¨æ‰©å±•å¯ä»¥åŒ…å«å„ç§ç±»å‹çš„é¡µé¢ï¼š</p>
<ul>
<li><strong>æ“ä½œé¡µé¢</strong> åœ¨ç‚¹å‡»æ‰©å±•å›¾æ ‡æ—¶æ˜¾ç¤ºåœ¨ <strong>ä¸‹æ‹‰èœå•ä¸­</strong>ã€‚</li>
<li>æ‰©å±•å°† <strong>åœ¨æ–°æ ‡ç­¾é¡µä¸­åŠ è½½çš„é¡µé¢</strong>ã€‚</li>
<li><strong>é€‰é¡¹é¡µé¢</strong>ï¼šæ­¤é¡µé¢åœ¨ç‚¹å‡»æ—¶æ˜¾ç¤ºåœ¨æ‰©å±•é¡¶éƒ¨ã€‚åœ¨ä¹‹å‰çš„æ¸…å•ä¸­ï¼Œæˆ‘èƒ½å¤Ÿé€šè¿‡ <code>chrome://extensions/?options=fadlhnelkbeojnebcbkacjilhnbjfjca</code> è®¿é—®æ­¤é¡µé¢æˆ–ç‚¹å‡»ï¼š</li>
</ul>
<figure><img src="../../.gitbook/assets/image (24).png" alt="" width="375"><figcaption></figcaption></figure>
<p>è¯·æ³¨æ„ï¼Œè¿™äº›é¡µé¢ä¸åƒåå°é¡µé¢é‚£æ ·æŒä¹…ï¼Œå› ä¸ºå®ƒä»¬æ ¹æ®éœ€è¦åŠ¨æ€åŠ è½½å†…å®¹ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒä»¬ä¸åå°é¡µé¢å…±äº«æŸäº›åŠŸèƒ½ï¼š</p>
<ul>
<li><strong>ä¸å†…å®¹è„šæœ¬çš„é€šä¿¡ï¼š</strong> ç±»ä¼¼äºåå°é¡µé¢ï¼Œè¿™äº›é¡µé¢å¯ä»¥æ¥æ”¶æ¥è‡ªå†…å®¹è„šæœ¬çš„æ¶ˆæ¯ï¼Œä¿ƒè¿›æ‰©å±•å†…çš„äº¤äº’ã€‚</li>
<li><strong>è®¿é—®æ‰©å±•ç‰¹å®šçš„ APIï¼š</strong> è¿™äº›é¡µé¢äº«æœ‰å¯¹æ‰©å±•ç‰¹å®š API çš„å…¨é¢è®¿é—®ï¼Œå—æ‰©å±•å®šä¹‰çš„æƒé™é™åˆ¶ã€‚</li>
</ul>
<h3 id="permissions--host_permissions"><a class="header" href="#permissions--host_permissions"><code>permissions</code> &amp; <code>host_permissions</code></a></h3>
<p><strong><code>permissions</code></strong> å’Œ <strong><code>host_permissions</code></strong> æ˜¯ <code>manifest.json</code> ä¸­çš„æ¡ç›®ï¼ŒæŒ‡ç¤º <strong>æµè§ˆå™¨æ‰©å±•å…·æœ‰å“ªäº›æƒé™</strong>ï¼ˆå­˜å‚¨ã€ä½ç½®ç­‰ï¼‰ä»¥åŠ <strong>åœ¨å“ªäº›ç½‘é¡µä¸Š</strong>ã€‚</p>
<p>ç”±äºæµè§ˆå™¨æ‰©å±•å¯èƒ½å…·æœ‰å¦‚æ­¤ <strong>ç‰¹æƒ</strong>ï¼Œæ¶æ„æ‰©å±•æˆ–è¢«æ”»ç ´çš„æ‰©å±•å¯èƒ½å…è®¸æ”»å‡»è€… <strong>ä»¥ä¸åŒæ–¹å¼çªƒå–æ•æ„Ÿä¿¡æ¯å¹¶ç›‘è§†ç”¨æˆ·</strong>ã€‚</p>
<p>æ£€æŸ¥è¿™äº›è®¾ç½®å¦‚ä½•å·¥ä½œä»¥åŠå®ƒä»¬å¦‚ä½•è¢«æ»¥ç”¨ï¼š</p>
<p>{% content-ref url="browext-permissions-and-host_permissions.md" %}
<a href="browext-permissions-and-host_permissions.html">browext-permissions-and-host_permissions.md</a>
{% endcontent-ref %}</p>
<h3 id="content_security_policy"><a class="header" href="#content_security_policy"><code>content_security_policy</code></a></h3>
<p><strong>å†…å®¹å®‰å…¨ç­–ç•¥</strong> ä¹Ÿå¯ä»¥åœ¨ <code>manifest.json</code> ä¸­å£°æ˜ã€‚å¦‚æœå®šä¹‰äº†å†…å®¹å®‰å…¨ç­–ç•¥ï¼Œå®ƒå¯èƒ½æ˜¯ <strong>è„†å¼±çš„</strong>ã€‚</p>
<p>æµè§ˆå™¨æ‰©å±•é¡µé¢çš„é»˜è®¤è®¾ç½®ç›¸å½“ä¸¥æ ¼ï¼š</p>
<pre><code class="language-bash">script-src 'self'; object-src 'self';
</code></pre>
<p>æœ‰å…³CSPå’Œæ½œåœ¨ç»•è¿‡çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š</p>
<p>{% content-ref url="../content-security-policy-csp-bypass/" %}
<a href="../content-security-policy-csp-bypass/">content-security-policy-csp-bypass</a>
{% endcontent-ref %}</p>
<h3 id="web_accessible_resources"><a class="header" href="#web_accessible_resources"><code>web_accessible_resources</code></a></h3>
<p>ä¸ºäº†è®©ç½‘é¡µè®¿é—®æµè§ˆå™¨æ‰©å±•çš„é¡µé¢ï¼Œä¾‹å¦‚ä¸€ä¸ª<code>.html</code>é¡µé¢ï¼Œè¯¥é¡µé¢éœ€è¦åœ¨<code>manifest.json</code>çš„**<code>web_accessible_resources</code>**å­—æ®µä¸­æåˆ°ã€‚<br />
ä¾‹å¦‚ï¼š</p>
<pre><code class="language-javascript">{
...
"web_accessible_resources": [
{
"resources": [ "images/*.png" ],
"matches": [ "https://example.com/*" ]
},
{
"resources": [ "fonts/*.woff" ],
"matches": [ "https://example.com/*" ]
}
],
...
}
</code></pre>
<p>è¿™äº›é¡µé¢å¯ä»¥é€šè¿‡ä»¥ä¸‹URLè®¿é—®ï¼š</p>
<pre><code>chrome-extension://&lt;extension-id&gt;/message.html
</code></pre>
<p>åœ¨å…¬å…±æ‰©å±•ä¸­ï¼Œ<strong>extension-id æ˜¯å¯è®¿é—®çš„</strong>ï¼š</p>
<figure><img src="../../.gitbook/assets/image (1194).png" alt="" width="375"><figcaption></figcaption></figure>
<p>ä¸è¿‡ï¼Œå¦‚æœä½¿ç”¨ <code>manifest.json</code> å‚æ•° <strong><code>use_dynamic_url</code></strong>ï¼Œåˆ™è¯¥ <strong>id å¯èƒ½æ˜¯åŠ¨æ€çš„</strong>ã€‚</p>
<p>{% hint style="success" %}
è¯·æ³¨æ„ï¼Œå³ä½¿æ­¤å¤„æåˆ°æŸä¸ªé¡µé¢ï¼Œå®ƒä¹Ÿå¯èƒ½ç”±äº <strong>å†…å®¹å®‰å…¨ç­–ç•¥</strong> è€Œ <strong>å—åˆ° ClickJacking ä¿æŠ¤</strong>ã€‚å› æ­¤ï¼Œåœ¨ç¡®è®¤ ClickJacking æ”»å‡»æ˜¯å¦å¯èƒ½ä¹‹å‰ï¼Œæ‚¨è¿˜éœ€è¦æ£€æŸ¥å®ƒï¼ˆframe-ancestors éƒ¨åˆ†ï¼‰ã€‚
{% endhint %}</p>
<p>å…è®¸è®¿é—®è¿™äº›é¡µé¢ä½¿è¿™äº›é¡µé¢ <strong>å¯èƒ½å®¹æ˜“å—åˆ° ClickJacking æ”»å‡»</strong>ï¼š</p>
<p>{% content-ref url="browext-clickjacking.md" %}
<a href="browext-clickjacking.html">browext-clickjacking.md</a>
{% endcontent-ref %}</p>
<p>{% hint style="success" %}
ä»…å…è®¸è¿™äº›é¡µé¢ç”±æ‰©å±•åŠ è½½ï¼Œè€Œä¸æ˜¯ç”±éšæœº URL åŠ è½½ï¼Œå¯ä»¥é˜²æ­¢ ClickJacking æ”»å‡»ã€‚
{% endhint %}</p>
<p>{% hint style="danger" %}
è¯·æ³¨æ„ï¼Œ<strong><code>web_accessible_resources</code></strong> ä¸­çš„é¡µé¢å’Œæ‰©å±•çš„å…¶ä»–é¡µé¢ä¹Ÿèƒ½å¤Ÿ <strong>è”ç³»åå°è„šæœ¬</strong>ã€‚å› æ­¤ï¼Œå¦‚æœè¿™äº›é¡µé¢ä¸­çš„ä¸€ä¸ªå®¹æ˜“å—åˆ° <strong>XSS</strong> æ”»å‡»ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ›´å¤§çš„æ¼æ´ã€‚</p>
<p>æ­¤å¤–ï¼Œè¯·æ³¨æ„ï¼Œæ‚¨åªèƒ½åœ¨ iframe ä¸­æ‰“å¼€ <strong><code>web_accessible_resources</code></strong> ä¸­æŒ‡ç¤ºçš„é¡µé¢ï¼Œä½†ä»æ–°æ ‡ç­¾é¡µå¯ä»¥è®¿é—®æ‰©å±•ä¸­çš„ä»»ä½•é¡µé¢ï¼Œåªéœ€çŸ¥é“æ‰©å±• IDã€‚å› æ­¤ï¼Œå¦‚æœå‘ç° XSS åˆ©ç”¨ç›¸åŒçš„å‚æ•°ï¼Œå³ä½¿é¡µé¢æœªåœ¨ <strong><code>web_accessible_resources</code></strong> ä¸­é…ç½®ï¼Œä¹Ÿå¯èƒ½è¢«åˆ©ç”¨ã€‚
{% endhint %}</p>
<h3 id="externally_connectable"><a class="header" href="#externally_connectable"><code>externally_connectable</code></a></h3>
<p>æ ¹æ® <a href="https://developer.chrome.com/docs/extensions/reference/manifest/externally-connectable"><strong>æ–‡æ¡£</strong></a>ï¼Œ<code>"externally_connectable"</code> æ¸…å•å±æ€§å£°æ˜ <strong>å“ªäº›æ‰©å±•å’Œç½‘é¡µå¯ä»¥é€šè¿‡</strong> <a href="https://developer.chrome.com/docs/extensions/reference/runtime#method-connect">runtime.connect</a> å’Œ <a href="https://developer.chrome.com/docs/extensions/reference/runtime#method-sendMessage">runtime.sendMessage</a> è¿æ¥åˆ°æ‚¨çš„æ‰©å±•ã€‚</p>
<ul>
<li>å¦‚æœåœ¨æ‰©å±•çš„æ¸…å•ä¸­ <strong>æœªå£°æ˜ <code>externally_connectable</code></strong> é”®æˆ–å£°æ˜ä¸º <strong><code>"ids": ["*"]</code></strong>ï¼Œ<strong>æ‰€æœ‰æ‰©å±•éƒ½å¯ä»¥è¿æ¥ï¼Œä½†æ²¡æœ‰ç½‘é¡µå¯ä»¥è¿æ¥</strong>ã€‚</li>
<li>å¦‚æœæŒ‡å®šäº† <strong>ç‰¹å®š ID</strong>ï¼Œå¦‚ <code>"ids": ["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"]</code>ï¼Œ<strong>åªæœ‰è¿™äº›åº”ç”¨ç¨‹åº</strong>å¯ä»¥è¿æ¥ã€‚</li>
<li>å¦‚æœæŒ‡å®šäº† <strong>åŒ¹é…é¡¹</strong>ï¼Œè¿™äº›ç½‘é¡µåº”ç”¨ç¨‹åºå°†èƒ½å¤Ÿè¿æ¥ï¼š</li>
</ul>
<pre><code class="language-json">"matches": [
"https://*.google.com/*",
"*://*.chromium.org/*",
</code></pre>
<ul>
<li>å¦‚æœæŒ‡å®šä¸ºç©ºï¼š<strong><code>"externally_connectable": {}</code></strong>ï¼Œåˆ™æ²¡æœ‰åº”ç”¨ç¨‹åºæˆ–ç½‘é¡µèƒ½å¤Ÿè¿æ¥ã€‚</li>
</ul>
<p>è¿™é‡ŒæŒ‡ç¤ºçš„<strong>æ‰©å±•å’Œç½‘å€è¶Šå°‘</strong>ï¼Œ<strong>æ”»å‡»é¢å°±è¶Šå°</strong>ã€‚</p>
<p>{% hint style="danger" %}
å¦‚æœåœ¨**<code>externally_connectable</code><strong>ä¸­æŒ‡ç¤ºäº†</strong>æ˜“å—XSSæˆ–æ¥ç®¡æ”»å‡»çš„ç½‘é¡µ**ï¼Œæ”»å‡»è€…å°†èƒ½å¤Ÿ<strong>ç›´æ¥å‘åå°è„šæœ¬å‘é€æ¶ˆæ¯</strong>ï¼Œå®Œå…¨ç»•è¿‡å†…å®¹è„šæœ¬åŠå…¶CSPã€‚</p>
<p>å› æ­¤ï¼Œè¿™æ˜¯ä¸€ä¸ª<strong>éå¸¸å¼ºå¤§çš„ç»•è¿‡</strong>ã€‚</p>
<p>æ­¤å¤–ï¼Œå¦‚æœå®¢æˆ·ç«¯å®‰è£…äº†ä¸€ä¸ªæ¶æ„æ‰©å±•ï¼Œå³ä½¿å®ƒä¸è¢«å…è®¸ä¸æ˜“å—æ”»å‡»çš„æ‰©å±•é€šä¿¡ï¼Œå®ƒä¹Ÿå¯ä»¥åœ¨<strong>å…è®¸çš„ç½‘é¡µä¸­æ³¨å…¥XSSæ•°æ®</strong>ï¼Œæˆ–æ»¥ç”¨**<code>WebRequest</code><strong>æˆ–</strong><code>DeclarativeNetRequest</code>** APIæ¥æ“çºµç›®æ ‡åŸŸä¸Šçš„è¯·æ±‚ï¼Œæ”¹å˜é¡µé¢å¯¹<strong>JavaScriptæ–‡ä»¶</strong>çš„è¯·æ±‚ã€‚ï¼ˆè¯·æ³¨æ„ï¼Œç›®æ ‡é¡µé¢ä¸Šçš„CSPå¯èƒ½ä¼šé˜»æ­¢è¿™äº›æ”»å‡»ï¼‰ã€‚è¿™ä¸ªæƒ³æ³•æ¥è‡ª<a href="https://www.darkrelay.com/post/opera-zero-day-rce-vulnerability"><strong>è¿™ç¯‡æ–‡ç« </strong></a>ã€‚
{% endhint %}</p>
<h2 id="é€šä¿¡æ€»ç»“"><a class="header" href="#é€šä¿¡æ€»ç»“">é€šä¿¡æ€»ç»“</a></h2>
<h3 id="æ‰©å±•----webapp"><a class="header" href="#æ‰©å±•----webapp">æ‰©å±• &lt;--&gt; WebApp</a></h3>
<p>åœ¨å†…å®¹è„šæœ¬å’Œç½‘é¡µä¹‹é—´ï¼Œé€šå¸¸ä½¿ç”¨åç»­æ¶ˆæ¯è¿›è¡Œé€šä¿¡ã€‚å› æ­¤ï¼Œåœ¨ç½‘é¡µåº”ç”¨ç¨‹åºä¸­ï¼Œæ‚¨é€šå¸¸ä¼šæ‰¾åˆ°å¯¹**<code>window.postMessage</code><strong>å‡½æ•°çš„è°ƒç”¨ï¼Œè€Œåœ¨å†…å®¹è„šæœ¬ä¸­åˆ™æœ‰åƒ</strong><code>window.addEventListener</code><strong>è¿™æ ·çš„ç›‘å¬å™¨ã€‚ç„¶è€Œï¼Œè¯·æ³¨æ„ï¼Œæ‰©å±•ä¹Ÿå¯ä»¥</strong>é€šè¿‡å‘é€Post Messageä¸ç½‘é¡µåº”ç”¨ç¨‹åºé€šä¿¡**ï¼ˆå› æ­¤ç½‘é¡µåº”è¯¥é¢„æœŸåˆ°è¿™ä¸€ç‚¹ï¼‰ï¼Œæˆ–è€…åªæ˜¯è®©ç½‘é¡µåŠ è½½ä¸€ä¸ªæ–°è„šæœ¬ã€‚</p>
<h3 id="åœ¨æ‰©å±•å†…éƒ¨"><a class="header" href="#åœ¨æ‰©å±•å†…éƒ¨">åœ¨æ‰©å±•å†…éƒ¨</a></h3>
<p>é€šå¸¸ä½¿ç”¨**<code>chrome.runtime.sendMessage</code><strong>åœ¨æ‰©å±•å†…éƒ¨å‘é€æ¶ˆæ¯ï¼ˆé€šå¸¸ç”±<code>background</code>è„šæœ¬å¤„ç†ï¼‰ï¼Œä¸ºäº†æ¥æ”¶å’Œå¤„ç†å®ƒï¼Œå£°æ˜ä¸€ä¸ªç›‘å¬å™¨è°ƒç”¨</strong><code>chrome.runtime.onMessage.addListener</code>**ã€‚</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨**<code>chrome.runtime.connect()</code><strong>æ¥å»ºç«‹æŒä¹…è¿æ¥ï¼Œè€Œä¸æ˜¯å‘é€å•ä¸ªæ¶ˆæ¯ï¼Œå¯ä»¥ç”¨å®ƒæ¥</strong>å‘é€<strong>å’Œ</strong>æ¥æ”¶****æ¶ˆæ¯**ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼š</p>
<details>
<summary><code>chrome.runtime.connect()</code> ç¤ºä¾‹</summary>
```javascript
var port = chrome.runtime.connect();
<p>// Listen for messages from the web page
window.addEventListener("message", (event) =&gt; {
// Only accept messages from the same window
if (event.source !== window) {
return;
}</p>
<p>// Check if the message type is "FROM_PAGE"
if (event.data.type &amp;&amp; (event.data.type === "FROM_PAGE")) {
console.log("Content script received: " + event.data.text);
// Forward the message to the background script
port.postMessage({ type: 'FROM_PAGE', text: event.data.text });
}
}, false);</p>
<p>// Listen for messages from the background script
port.onMessage.addListener(function(msg) {
console.log("Content script received message from background script:", msg);
// Handle the response message from the background script
});</p>
<pre><code>&lt;/details&gt;

ä¹Ÿå¯ä»¥ä»åå°è„šæœ¬å‘ä½äºç‰¹å®šæ ‡ç­¾é¡µä¸­çš„å†…å®¹è„šæœ¬å‘é€æ¶ˆæ¯ï¼Œè°ƒç”¨ **`chrome.tabs.sendMessage`**ï¼Œåœ¨æ­¤éœ€è¦æŒ‡æ˜è¦å‘é€æ¶ˆæ¯çš„ **æ ‡ç­¾é¡µID**ã€‚

### ä»å…è®¸çš„ `externally_connectable` åˆ°æ‰©å±•

åœ¨ `externally_connectable` é…ç½®ä¸­å…è®¸çš„ **Web åº”ç”¨å’Œå¤–éƒ¨æµè§ˆå™¨æ‰©å±•** å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å‘é€è¯·æ±‚ï¼š
```javascript
chrome.runtime.sendMessage(extensionId, ...
</code></pre>
<p>éœ€è¦æåˆ° <strong>extension ID</strong> çš„åœ°æ–¹ã€‚</p>
<h3 id="æœ¬åœ°æ¶ˆæ¯ä¼ é€’"><a class="header" href="#æœ¬åœ°æ¶ˆæ¯ä¼ é€’">æœ¬åœ°æ¶ˆæ¯ä¼ é€’</a></h3>
<p>åå°è„šæœ¬å¯ä»¥ä¸ç³»ç»Ÿå†…çš„äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œé€šä¿¡ï¼Œå¦‚æœè¿™ç§é€šä¿¡æ²¡æœ‰å¾—åˆ°å¦¥å–„ä¿æŠ¤ï¼Œå¯èƒ½ä¼š <strong>å®¹æ˜“å—åˆ°è¯¸å¦‚ RCEs çš„å…³é”®æ¼æ´</strong>ã€‚ <a href="./#native-messaging">ç¨åä¼šè¯¦ç»†ä»‹ç»</a>ã€‚</p>
<pre><code class="language-javascript">chrome.runtime.sendNativeMessage(
'com.my_company.my_application',
{text: 'Hello'},
function (response) {
console.log('Received ' + response);
}
);
</code></pre>
<h2 id="web--å†…å®¹è„šæœ¬é€šä¿¡"><a class="header" href="#web--å†…å®¹è„šæœ¬é€šä¿¡">Web <strong>â†”ï¸</strong> å†…å®¹è„šæœ¬é€šä¿¡</a></h2>
<p><strong>å†…å®¹è„šæœ¬</strong> æ“ä½œçš„ç¯å¢ƒä¸ä¸»æœºé¡µé¢å­˜åœ¨çš„ç¯å¢ƒæ˜¯ <strong>åˆ†å¼€çš„</strong>ï¼Œç¡®ä¿äº† <strong>éš”ç¦»</strong>ã€‚å°½ç®¡å­˜åœ¨è¿™ç§éš”ç¦»ï¼ŒåŒæ–¹éƒ½èƒ½å¤Ÿä¸é¡µé¢çš„ <strong>æ–‡æ¡£å¯¹è±¡æ¨¡å‹ (DOM)</strong> è¿›è¡Œäº¤äº’ï¼Œè¿™æ˜¯ä¸€ä¸ªå…±äº«èµ„æºã€‚ä¸ºäº†ä½¿ä¸»æœºé¡µé¢èƒ½å¤Ÿä¸ <strong>å†…å®¹è„šæœ¬</strong> è¿›è¡Œé€šä¿¡ï¼Œæˆ–é€šè¿‡å†…å®¹è„šæœ¬é—´æ¥ä¸æ‰©å±•è¿›è¡Œé€šä¿¡ï¼Œå¿…é¡»åˆ©ç”¨åŒæ–¹éƒ½å¯ä»¥è®¿é—®çš„ <strong>DOM</strong> ä½œä¸ºé€šä¿¡é€šé“ã€‚</p>
<h3 id="å‘é€æ¶ˆæ¯"><a class="header" href="#å‘é€æ¶ˆæ¯">å‘é€æ¶ˆæ¯</a></h3>
<p>{% code title="content-script.js" %}</p>
<pre><code class="language-javascript">// This is like "chrome.runtime.sendMessage" but to maintain the connection
var port = chrome.runtime.connect();

window.addEventListener("message", (event) =&gt; {
// We only accept messages from ourselves
if (event.source !== window) {
return;
}

if (event.data.type &amp;&amp; (event.data.type === "FROM_PAGE")) {
console.log("Content script received: " + event.data.text);
// Forward the message to the background script
port.postMessage(event.data.text);
}
}, false);
</code></pre>
<p>{% endcode %}</p>
<p>{% code title="example.js" %}</p>
<pre><code class="language-javascript">document.getElementById("theButton").addEventListener("click", () =&gt; {
window.postMessage(
{type : "FROM_PAGE", text : "Hello from the webpage!"}, "*");
}, false);
</code></pre>
<p>{% endcode %}</p>
<p>å®‰å…¨çš„ Post Message é€šä¿¡åº”æ£€æŸ¥æ¥æ”¶åˆ°çš„æ¶ˆæ¯çš„çœŸå®æ€§ï¼Œè¿™å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¿›è¡Œæ£€æŸ¥ï¼š</p>
<ul>
<li><strong><code>event.isTrusted</code></strong>ï¼šåªæœ‰å½“äº‹ä»¶æ˜¯ç”±ç”¨æˆ·æ“ä½œè§¦å‘æ—¶ï¼Œè¿™ä¸ªå€¼æ‰ä¸º True</li>
<li>å†…å®¹è„šæœ¬å¯èƒ½åªåœ¨ç”¨æˆ·æ‰§è¡ŒæŸäº›æ“ä½œæ—¶æ‰æœŸå¾…æ¥æ”¶åˆ°æ¶ˆæ¯</li>
<li><strong>æºåŸŸ</strong>ï¼šå¯èƒ½åªå…è®¸ç™½åå•ä¸­çš„åŸŸæ¥æ”¶æ¶ˆæ¯ã€‚</li>
<li>å¦‚æœä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¯·éå¸¸å°å¿ƒ</li>
<li><strong>æ¥æº</strong>ï¼š<code>received_message.source !== window</code> å¯ç”¨äºæ£€æŸ¥æ¶ˆæ¯æ˜¯å¦æ¥è‡ª <strong>åŒä¸€çª—å£</strong>ï¼Œå³å†…å®¹è„šæœ¬æ­£åœ¨ç›‘å¬çš„çª—å£ã€‚</li>
</ul>
<p>å³ä½¿æ‰§è¡Œäº†ä¸Šè¿°æ£€æŸ¥ï¼Œä»å¯èƒ½å­˜åœ¨æ¼æ´ï¼Œå› æ­¤è¯·æ£€æŸ¥ä»¥ä¸‹é¡µé¢ <strong>æ½œåœ¨çš„ Post Message ç»•è¿‡</strong>ï¼š</p>
<p>{% content-ref url="../postmessage-vulnerabilities/" %}
<a href="../postmessage-vulnerabilities/">postmessage-vulnerabilities</a>
{% endcontent-ref %}</p>
<h3 id="iframe"><a class="header" href="#iframe">Iframe</a></h3>
<p>å¦ä¸€ç§å¯èƒ½çš„é€šä¿¡æ–¹å¼å¯èƒ½æ˜¯é€šè¿‡ <strong>Iframe URLs</strong>ï¼Œæ‚¨å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°ç¤ºä¾‹ï¼š</p>
<p>{% content-ref url="browext-xss-example.md" %}
<a href="browext-xss-example.html">browext-xss-example.md</a>
{% endcontent-ref %}</p>
<h3 id="dom"><a class="header" href="#dom">DOM</a></h3>
<p>è¿™å¹¶ä¸æ˜¯â€œç¡®åˆ‡çš„â€é€šä¿¡æ–¹å¼ï¼Œä½† <strong>ç½‘é¡µå’Œå†…å®¹è„šæœ¬å°†å¯ä»¥è®¿é—®ç½‘é¡µ DOM</strong>ã€‚å› æ­¤ï¼Œå¦‚æœ <strong>å†…å®¹è„šæœ¬</strong> ä»ä¸­è¯»å–æŸäº›ä¿¡æ¯ï¼Œ<strong>ä¿¡ä»»ç½‘é¡µ DOM</strong>ï¼Œç½‘é¡µå¯èƒ½ä¼š <strong>ä¿®æ”¹è¿™äº›æ•°æ®</strong>ï¼ˆå› ä¸ºç½‘é¡µä¸åº”è¢«ä¿¡ä»»ï¼Œæˆ–è€…å› ä¸ºç½‘é¡µæ˜“å— XSS æ”»å‡»ï¼‰å¹¶ <strong>å±å®³å†…å®¹è„šæœ¬</strong>ã€‚</p>
<p>æ‚¨è¿˜å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ° <strong>åŸºäº DOM çš„ XSS ä»¥å±å®³æµè§ˆå™¨æ‰©å±•</strong> çš„ç¤ºä¾‹ï¼š</p>
<p>{% content-ref url="browext-xss-example.md" %}
<a href="browext-xss-example.html">browext-xss-example.md</a>
{% endcontent-ref %}</p>
<h2 id="å†…å®¹è„šæœ¬--åå°è„šæœ¬é€šä¿¡"><a class="header" href="#å†…å®¹è„šæœ¬--åå°è„šæœ¬é€šä¿¡">å†…å®¹è„šæœ¬ <strong>â†”ï¸</strong> åå°è„šæœ¬é€šä¿¡</a></h2>
<p>å†…å®¹è„šæœ¬å¯ä»¥ä½¿ç”¨ <a href="https://developer.chrome.com/docs/extensions/reference/runtime#method-sendMessage"><strong>runtime.sendMessage()</strong></a> <strong>æˆ–</strong> <a href="https://developer.chrome.com/docs/extensions/reference/tabs#method-sendMessage"><strong>tabs.sendMessage()</strong></a> å‘é€ <strong>ä¸€æ¬¡æ€§ JSON å¯åºåˆ—åŒ–</strong> æ¶ˆæ¯ã€‚</p>
<p>è¦å¤„ç† <strong>å“åº”</strong>ï¼Œè¯·ä½¿ç”¨è¿”å›çš„ <strong>Promise</strong>ã€‚å°½ç®¡ä¸ºäº†å‘åå…¼å®¹ï¼Œæ‚¨ä»ç„¶å¯ä»¥å°† <strong>å›è°ƒ</strong> ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ä¼ é€’ã€‚</p>
<p>ä» <strong>å†…å®¹è„šæœ¬</strong> å‘é€è¯·æ±‚çš„æ–¹å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-javascript">(async () =&gt; {
const response = await chrome.runtime.sendMessage({greeting: "hello"});
// do something with response here, not outside the function
console.log(response);
})();
</code></pre>
<p>ä»<strong>æ‰©å±•</strong>å‘é€è¯·æ±‚ï¼ˆé€šå¸¸æ˜¯<strong>åå°è„šæœ¬</strong>ï¼‰ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•å‘é€‰å®šæ ‡ç­¾é¡µä¸­çš„å†…å®¹è„šæœ¬å‘é€æ¶ˆæ¯çš„ç¤ºä¾‹ï¼š</p>
<pre><code class="language-javascript">// From https://stackoverflow.com/questions/36153999/how-to-send-a-message-between-chrome-extension-popup-and-content-script
(async () =&gt; {
const [tab] = await chrome.tabs.query({active: true, lastFocusedWindow: true});
const response = await chrome.tabs.sendMessage(tab.id, {greeting: "hello"});
// do something with response here, not outside the function
console.log(response);
})();
</code></pre>
<p>åœ¨<strong>æ¥æ”¶ç«¯</strong>ï¼Œæ‚¨éœ€è¦è®¾ç½®ä¸€ä¸ª <a href="https://developer.chrome.com/docs/extensions/reference/runtime#event-onMessage"><strong>runtime.onMessage</strong></a> <strong>äº‹ä»¶ç›‘å¬å™¨</strong> æ¥å¤„ç†æ¶ˆæ¯ã€‚è¿™åœ¨å†…å®¹è„šæœ¬æˆ–æ‰©å±•é¡µé¢ä¸­çœ‹èµ·æ¥æ˜¯ä¸€æ ·çš„ã€‚</p>
<pre><code class="language-javascript">// From https://stackoverflow.com/questions/70406787/javascript-send-message-from-content-js-to-background-js
chrome.runtime.onMessage.addListener(
function(request, sender, sendResponse) {
console.log(sender.tab ?
"from a content script:" + sender.tab.url :
"from the extension");
if (request.greeting === "hello")
sendResponse({farewell: "goodbye"});
}
);
</code></pre>
<p>åœ¨çªå‡ºæ˜¾ç¤ºçš„ç¤ºä¾‹ä¸­ï¼Œ<strong><code>sendResponse()</code></strong> æ˜¯ä»¥åŒæ­¥æ–¹å¼æ‰§è¡Œçš„ã€‚è¦ä¿®æ”¹ <code>onMessage</code> äº‹ä»¶å¤„ç†ç¨‹åºä»¥å¼‚æ­¥æ‰§è¡Œ <code>sendResponse()</code>ï¼Œå¿…é¡»åŠ å…¥ <code>return true;</code>ã€‚</p>
<p>ä¸€ä¸ªé‡è¦çš„è€ƒè™‘æ˜¯ï¼Œåœ¨å¤šä¸ªé¡µé¢è®¾ç½®ä¸ºæ¥æ”¶ <code>onMessage</code> äº‹ä»¶çš„æƒ…å†µä¸‹ï¼Œ<strong>ç¬¬ä¸€ä¸ªæ‰§è¡Œ <code>sendResponse()</code></strong> çš„é¡µé¢å°†æ˜¯å”¯ä¸€èƒ½å¤Ÿæœ‰æ•ˆä¼ é€’å“åº”çš„é¡µé¢ã€‚å¯¹åŒä¸€äº‹ä»¶çš„ä»»ä½•åç»­å“åº”å°†ä¸è¢«è€ƒè™‘ã€‚</p>
<p>åœ¨åˆ›å»ºæ–°æ‰©å±•æ—¶ï¼Œåº”è¯¥ä¼˜å…ˆä½¿ç”¨ promises è€Œä¸æ˜¯å›è°ƒã€‚å…³äºå›è°ƒçš„ä½¿ç”¨ï¼Œåªæœ‰åœ¨åŒæ­¥ä¸Šä¸‹æ–‡ä¸­ç›´æ¥æ‰§è¡Œ <code>sendResponse()</code> å‡½æ•°ï¼Œæˆ–è€…äº‹ä»¶å¤„ç†ç¨‹åºé€šè¿‡è¿”å› <code>true</code> è¡¨ç¤ºå¼‚æ­¥æ“ä½œæ—¶ï¼Œ<code>sendResponse()</code> å‡½æ•°æ‰è¢«è§†ä¸ºæœ‰æ•ˆã€‚å¦‚æœæ²¡æœ‰ä»»ä½•å¤„ç†ç¨‹åºè¿”å› <code>true</code>ï¼Œæˆ–è€… <code>sendResponse()</code> å‡½æ•°ä»å†…å­˜ä¸­ç§»é™¤ï¼ˆè¢«åƒåœ¾å›æ”¶ï¼‰ï¼Œåˆ™ä¸ <code>sendMessage()</code> å‡½æ•°å…³è”çš„å›è°ƒå°†é»˜è®¤è¢«è§¦å‘ã€‚</p>
<h2 id="native-messaging"><a class="header" href="#native-messaging">Native Messaging</a></h2>
<p>æµè§ˆå™¨æ‰©å±•è¿˜å…è®¸é€šè¿‡ <strong>stdin</strong> ä¸ç³»ç»Ÿä¸­çš„ <strong>äºŒè¿›åˆ¶æ–‡ä»¶</strong> è¿›è¡Œé€šä¿¡ã€‚åº”ç”¨ç¨‹åºå¿…é¡»å®‰è£…ä¸€ä¸ª json æ¥æŒ‡ç¤ºè¿™ä¸€ç‚¹ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p>
<pre><code class="language-json">{
"name": "com.my_company.my_application",
"description": "My Application",
"path": "C:\\Program Files\\My Application\\chrome_native_messaging_host.exe",
"type": "stdio",
"allowed_origins": ["chrome-extension://knldjmfmopnpolahpmmgbagdohdnhkik/"]
}
</code></pre>
<pre><code class="language-markdown">å…¶ä¸­ `name` æ˜¯ä¼ é€’ç»™ [`runtime.connectNative()`](https://developer.chrome.com/docs/extensions/reference/api/runtime#method-connectNative) æˆ– [`runtime.sendNativeMessage()`](https://developer.chrome.com/docs/extensions/reference/api/runtime#method-sendNativeMessage) çš„å­—ç¬¦ä¸²ï¼Œç”¨äºä»æµè§ˆå™¨æ‰©å±•çš„åå°è„šæœ¬ä¸åº”ç”¨ç¨‹åºè¿›è¡Œé€šä¿¡ã€‚`path` æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶çš„è·¯å¾„ï¼Œåªæœ‰ 1 ç§æœ‰æ•ˆçš„ `type`ï¼Œå³ stdioï¼ˆä½¿ç”¨ stdin å’Œ stdoutï¼‰ï¼Œè€Œ `allowed_origins` è¡¨ç¤ºå¯ä»¥è®¿é—®å®ƒçš„æ‰©å±•ï¼ˆä¸èƒ½ä½¿ç”¨é€šé…ç¬¦ï¼‰ã€‚

Chrome/Chromium ä¼šåœ¨æŸäº› Windows æ³¨å†Œè¡¨å’Œ macOS å’Œ Linux çš„æŸäº›è·¯å¾„ä¸­æœç´¢æ­¤ jsonï¼ˆæ›´å¤šä¿¡æ¯è¯·å‚è§ [**docs**](https://developer.chrome.com/docs/extensions/develop/concepts/native-messaging)ï¼‰ã€‚

{% hint style="success" %}
æµè§ˆå™¨æ‰©å±•è¿˜éœ€è¦å£°æ˜ `nativeMessaing` æƒé™ï¼Œä»¥ä¾¿èƒ½å¤Ÿä½¿ç”¨æ­¤é€šä¿¡ã€‚
{% endhint %}

è¿™å°±æ˜¯ä¸€äº›åå°è„šæœ¬ä»£ç å‘æœ¬åœ°åº”ç”¨ç¨‹åºå‘é€æ¶ˆæ¯çš„æ ·å­ï¼š
</code></pre>
<pre><code class="language-javascript">chrome.runtime.sendNativeMessage(
'com.my_company.my_application',
{text: 'Hello'},
function (response) {
console.log('Received ' + response);
}
);
</code></pre>
<p>åœ¨<a href="https://spaceraccoon.dev/universal-code-execution-browser-extensions/"><strong>è¿™ç¯‡åšå®¢æ–‡ç« </strong></a>ä¸­ï¼Œæå‡ºäº†ä¸€ç§åˆ©ç”¨æœ¬æœºæ¶ˆæ¯çš„è„†å¼±æ¨¡å¼ï¼š</p>
<ol>
<li>æµè§ˆå™¨æ‰©å±•å¯¹å†…å®¹è„šæœ¬æœ‰ä¸€ä¸ªé€šé…ç¬¦æ¨¡å¼ã€‚</li>
<li>å†…å®¹è„šæœ¬ä½¿ç”¨<code>sendMessage</code>å°†<code>postMessage</code>æ¶ˆæ¯ä¼ é€’ç»™åå°è„šæœ¬ã€‚</li>
<li>åå°è„šæœ¬ä½¿ç”¨<code>sendNativeMessage</code>å°†æ¶ˆæ¯ä¼ é€’ç»™æœ¬æœºåº”ç”¨ç¨‹åºã€‚</li>
<li>æœ¬æœºåº”ç”¨ç¨‹åºå±é™©åœ°å¤„ç†æ¶ˆæ¯ï¼Œå¯¼è‡´ä»£ç æ‰§è¡Œã€‚</li>
</ol>
<p>å…¶ä¸­è§£é‡Šäº†<strong>å¦‚ä½•ä»ä»»ä½•é¡µé¢åˆ©ç”¨æµè§ˆå™¨æ‰©å±•è¿›è¡ŒRCE</strong>çš„ç¤ºä¾‹ã€‚</p>
<h2 id="å†…å­˜ä»£ç å‰ªè´´æ¿ä¸­çš„æ•æ„Ÿä¿¡æ¯"><a class="header" href="#å†…å­˜ä»£ç å‰ªè´´æ¿ä¸­çš„æ•æ„Ÿä¿¡æ¯">å†…å­˜/ä»£ç /å‰ªè´´æ¿ä¸­çš„æ•æ„Ÿä¿¡æ¯</a></h2>
<p>å¦‚æœæµè§ˆå™¨æ‰©å±•å°†<strong>æ•æ„Ÿä¿¡æ¯å­˜å‚¨åœ¨å…¶å†…å­˜ä¸­</strong>ï¼Œåˆ™å¯èƒ½ä¼šè¢«<strong>è½¬å‚¨</strong>ï¼ˆç‰¹åˆ«æ˜¯åœ¨Windowsæœºå™¨ä¸Šï¼‰å¹¶<strong>æœç´¢</strong>è¿™äº›ä¿¡æ¯ã€‚</p>
<p>å› æ­¤ï¼Œæµè§ˆå™¨æ‰©å±•çš„å†…å­˜<strong>ä¸åº”è¢«è§†ä¸ºå®‰å…¨</strong>ï¼Œå¹¶ä¸”<strong>æ•æ„Ÿä¿¡æ¯</strong>å¦‚å‡­æ®æˆ–åŠ©è®°çŸ­è¯­<strong>ä¸åº”å­˜å‚¨</strong>ã€‚</p>
<p>å½“ç„¶ï¼Œ<strong>ä¸è¦å°†æ•æ„Ÿä¿¡æ¯æ”¾å…¥ä»£ç ä¸­</strong>ï¼Œå› ä¸ºå®ƒå°†æ˜¯<strong>å…¬å¼€çš„</strong>ã€‚</p>
<p>è¦ä»æµè§ˆå™¨è½¬å‚¨å†…å­˜ï¼Œå¯ä»¥<strong>è½¬å‚¨è¿›ç¨‹å†…å­˜</strong>ï¼Œæˆ–è€…è¦è¿›å…¥æµè§ˆå™¨æ‰©å±•çš„<strong>è®¾ç½®</strong>ï¼Œç‚¹å‡»**<code>Inspect pop-up</code>** -&gt; åœ¨**<code>Memory</code><strong>éƒ¨åˆ† -&gt; <strong><code>Take a snaphost</code></strong>ï¼Œç„¶åä½¿ç”¨</strong><code>CTRL+F</code>**åœ¨å¿«ç…§ä¸­æœç´¢æ•æ„Ÿä¿¡æ¯ã€‚</p>
<p>æ­¤å¤–ï¼ŒåƒåŠ©è®°å¯†é’¥æˆ–å¯†ç è¿™æ ·çš„é«˜åº¦æ•æ„Ÿä¿¡æ¯<strong>ä¸åº”å…è®¸å¤åˆ¶åˆ°å‰ªè´´æ¿</strong>ï¼ˆæˆ–è‡³å°‘åœ¨å‡ ç§’é’Ÿå†…å°†å…¶ä»å‰ªè´´æ¿ä¸­ç§»é™¤ï¼‰ï¼Œå› ä¸ºè¿™æ ·ç›‘æ§å‰ªè´´æ¿çš„è¿›ç¨‹å°†èƒ½å¤Ÿè·å–å®ƒä»¬ã€‚</p>
<h2 id="åœ¨æµè§ˆå™¨ä¸­åŠ è½½æ‰©å±•"><a class="header" href="#åœ¨æµè§ˆå™¨ä¸­åŠ è½½æ‰©å±•">åœ¨æµè§ˆå™¨ä¸­åŠ è½½æ‰©å±•</a></h2>
<ol>
<li><strong>ä¸‹è½½</strong>æµè§ˆå™¨æ‰©å±•å¹¶è§£å‹</li>
<li>è½¬åˆ°**<code>chrome://extensions/</code><strong>å¹¶</strong>å¯ç”¨**<code>å¼€å‘è€…æ¨¡å¼</code></li>
<li>ç‚¹å‡»**<code>åŠ è½½å·²è§£å‹çš„æ‰©å±•</code>**æŒ‰é’®</li>
</ol>
<p>åœ¨<strong>Firefox</strong>ä¸­ï¼Œè½¬åˆ°**<code>about:debugging#/runtime/this-firefox</code><strong>å¹¶ç‚¹å‡»</strong><code>åŠ è½½ä¸´æ—¶é™„åŠ ç»„ä»¶</code>**æŒ‰é’®ã€‚</p>
<h2 id="ä»å•†åº—è·å–æºä»£ç "><a class="header" href="#ä»å•†åº—è·å–æºä»£ç ">ä»å•†åº—è·å–æºä»£ç </a></h2>
<p>Chromeæ‰©å±•çš„æºä»£ç å¯ä»¥é€šè¿‡å¤šç§æ–¹æ³•è·å¾—ã€‚ä»¥ä¸‹æ˜¯æ¯ä¸ªé€‰é¡¹çš„è¯¦ç»†è¯´æ˜å’ŒæŒ‡ç¤ºã€‚</p>
<h3 id="é€šè¿‡å‘½ä»¤è¡Œå°†æ‰©å±•ä¸‹è½½ä¸ºzip"><a class="header" href="#é€šè¿‡å‘½ä»¤è¡Œå°†æ‰©å±•ä¸‹è½½ä¸ºzip">é€šè¿‡å‘½ä»¤è¡Œå°†æ‰©å±•ä¸‹è½½ä¸ºZIP</a></h3>
<p>Chromeæ‰©å±•çš„æºä»£ç å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œä¸‹è½½ä¸ºZIPæ–‡ä»¶ã€‚è¿™æ¶‰åŠä½¿ç”¨<code>curl</code>ä»ç‰¹å®šURLè·å–ZIPæ–‡ä»¶ï¼Œç„¶åå°†ZIPæ–‡ä»¶çš„å†…å®¹æå–åˆ°ä¸€ä¸ªç›®å½•ä¸­ã€‚ä»¥ä¸‹æ˜¯æ­¥éª¤ï¼š</p>
<ol>
<li>å°†<code>"extension_id"</code>æ›¿æ¢ä¸ºæ‰©å±•çš„å®é™…IDã€‚</li>
<li>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</li>
</ol>
<pre><code class="language-bash">extension_id=your_extension_id   # Replace with the actual extension ID
curl -L -o "$extension_id.zip" "https://clients2.google.com/service/update2/crx?response=redirect&amp;os=mac&amp;arch=x86-64&amp;nacl_arch=x86-64&amp;prod=chromecrx&amp;prodchannel=stable&amp;prodversion=44.0.2403.130&amp;x=id%3D$extension_id%26uc"
unzip -d "$extension_id-source" "$extension_id.zip"
</code></pre>
<h3 id="ä½¿ç”¨-crx-viewer-ç½‘ç«™"><a class="header" href="#ä½¿ç”¨-crx-viewer-ç½‘ç«™">ä½¿ç”¨ CRX Viewer ç½‘ç«™</a></h3>
<p><a href="https://robwu.nl/crxviewer/">https://robwu.nl/crxviewer/</a></p>
<h3 id="ä½¿ç”¨-crx-viewer-æ‰©å±•"><a class="header" href="#ä½¿ç”¨-crx-viewer-æ‰©å±•">ä½¿ç”¨ CRX Viewer æ‰©å±•</a></h3>
<p>å¦ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•æ˜¯ä½¿ç”¨ Chrome æ‰©å±•æºæŸ¥çœ‹å™¨ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ã€‚å¯ä»¥ä» <a href="https://chrome.google.com/webstore/detail/chrome-extension-source-v/jifpbeccnghkjeaalbbjmodiffmgedin?hl=en">Chrome Web Store</a> å®‰è£…ã€‚æŸ¥çœ‹å™¨çš„æºä»£ç å¯ä»¥åœ¨å…¶ <a href="https://github.com/Rob--W/crxviewer">GitHub ä»“åº“</a> ä¸­æ‰¾åˆ°ã€‚</p>
<h3 id="æŸ¥çœ‹æœ¬åœ°å®‰è£…çš„æ‰©å±•çš„æºä»£ç "><a class="header" href="#æŸ¥çœ‹æœ¬åœ°å®‰è£…çš„æ‰©å±•çš„æºä»£ç ">æŸ¥çœ‹æœ¬åœ°å®‰è£…çš„æ‰©å±•çš„æºä»£ç </a></h3>
<p>æœ¬åœ°å®‰è£…çš„ Chrome æ‰©å±•ä¹Ÿå¯ä»¥è¢«æ£€æŸ¥ã€‚æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<ol>
<li>é€šè¿‡è®¿é—® <code>chrome://version/</code> å¹¶æ‰¾åˆ°â€œProfile Pathâ€å­—æ®µæ¥è®¿é—®æ‚¨çš„ Chrome æœ¬åœ°é…ç½®æ–‡ä»¶ç›®å½•ã€‚</li>
<li>åœ¨é…ç½®æ–‡ä»¶ç›®å½•ä¸­å¯¼èˆªåˆ° <code>Extensions/</code> å­æ–‡ä»¶å¤¹ã€‚</li>
<li>è¯¥æ–‡ä»¶å¤¹åŒ…å«æ‰€æœ‰å·²å®‰è£…çš„æ‰©å±•ï¼Œé€šå¸¸å…¶æºä»£ç ä»¥å¯è¯»æ ¼å¼å­˜æ”¾ã€‚</li>
</ol>
<p>è¦è¯†åˆ«æ‰©å±•ï¼Œæ‚¨å¯ä»¥å°†å®ƒä»¬çš„ ID æ˜ å°„åˆ°åç§°ï¼š</p>
<ul>
<li>åœ¨ <code>about:extensions</code> é¡µé¢ä¸Šå¯ç”¨å¼€å‘è€…æ¨¡å¼ï¼Œä»¥æŸ¥çœ‹æ¯ä¸ªæ‰©å±•çš„ IDã€‚</li>
<li>åœ¨æ¯ä¸ªæ‰©å±•çš„æ–‡ä»¶å¤¹ä¸­ï¼Œ<code>manifest.json</code> æ–‡ä»¶åŒ…å«ä¸€ä¸ªå¯è¯»çš„ <code>name</code> å­—æ®µï¼Œå¸®åŠ©æ‚¨è¯†åˆ«æ‰©å±•ã€‚</li>
</ul>
<h3 id="ä½¿ç”¨æ–‡ä»¶å½’æ¡£ç¨‹åºæˆ–è§£å‹ç¼©å·¥å…·"><a class="header" href="#ä½¿ç”¨æ–‡ä»¶å½’æ¡£ç¨‹åºæˆ–è§£å‹ç¼©å·¥å…·">ä½¿ç”¨æ–‡ä»¶å½’æ¡£ç¨‹åºæˆ–è§£å‹ç¼©å·¥å…·</a></h3>
<p>å‰å¾€ Chrome Web Store ä¸‹è½½æ‰©å±•ã€‚æ–‡ä»¶å°†å…·æœ‰ <code>.crx</code> æ‰©å±•åã€‚å°†æ–‡ä»¶æ‰©å±•åä» <code>.crx</code> æ›´æ”¹ä¸º <code>.zip</code>ã€‚ä½¿ç”¨ä»»ä½•æ–‡ä»¶å½’æ¡£ç¨‹åºï¼ˆå¦‚ WinRARã€7-Zip ç­‰ï¼‰æå– ZIP æ–‡ä»¶çš„å†…å®¹ã€‚</p>
<h3 id="åœ¨-chrome-ä¸­ä½¿ç”¨å¼€å‘è€…æ¨¡å¼"><a class="header" href="#åœ¨-chrome-ä¸­ä½¿ç”¨å¼€å‘è€…æ¨¡å¼">åœ¨ Chrome ä¸­ä½¿ç”¨å¼€å‘è€…æ¨¡å¼</a></h3>
<p>æ‰“å¼€ Chrome å¹¶è½¬åˆ° <code>chrome://extensions/</code>ã€‚åœ¨å³ä¸Šè§’å¯ç”¨â€œå¼€å‘è€…æ¨¡å¼â€ã€‚ç‚¹å‡»â€œåŠ è½½å·²è§£å‹çš„æ‰©å±•...â€ã€‚å¯¼èˆªåˆ°æ‚¨çš„æ‰©å±•ç›®å½•ã€‚è¿™ä¸ä¼šä¸‹è½½æºä»£ç ï¼Œä½†å¯¹äºæŸ¥çœ‹å’Œä¿®æ”¹å·²ä¸‹è½½æˆ–å¼€å‘çš„æ‰©å±•çš„ä»£ç éå¸¸æœ‰ç”¨ã€‚</p>
<h2 id="chrome-æ‰©å±•æ¸…å•æ•°æ®é›†"><a class="header" href="#chrome-æ‰©å±•æ¸…å•æ•°æ®é›†">Chrome æ‰©å±•æ¸…å•æ•°æ®é›†</a></h2>
<p>ä¸ºäº†å°è¯•å‘ç°æ˜“å—æ”»å‡»çš„æµè§ˆå™¨æ‰©å±•ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <a href="https://github.com/palant/chrome-extension-manifests-dataset">https://github.com/palant/chrome-extension-manifests-dataset</a> å¹¶æ£€æŸ¥å®ƒä»¬çš„æ¸…å•æ–‡ä»¶ä»¥å¯»æ‰¾æ½œåœ¨çš„è„†å¼±è¿¹è±¡ã€‚ä¾‹å¦‚ï¼Œæ£€æŸ¥ç”¨æˆ·è¶…è¿‡ 25000 çš„æ‰©å±•ï¼Œ<code>content_scripts</code> å’Œæƒé™ <code>nativeMessaing</code>ï¼š</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash"># Query example from https://spaceraccoon.dev/universal-code-execution-browser-extensions/
node query.js -f "metadata.user_count &gt; 250000" "manifest.content_scripts?.length &gt; 0 &amp;&amp; manifest.permissions?.includes('nativeMessaging')"
</code></pre>
<p>{% endcode %}</p>
<h2 id="å®‰å…¨å®¡è®¡æ£€æŸ¥è¡¨"><a class="header" href="#å®‰å…¨å®¡è®¡æ£€æŸ¥è¡¨">å®‰å…¨å®¡è®¡æ£€æŸ¥è¡¨</a></h2>
<p>å°½ç®¡æµè§ˆå™¨æ‰©å±•å…·æœ‰<strong>æœ‰é™çš„æ”»å‡»é¢</strong>ï¼Œä½†å…¶ä¸­ä¸€äº›å¯èƒ½åŒ…å«<strong>æ¼æ´</strong>æˆ–<strong>æ½œåœ¨çš„åŠ å›ºæ”¹è¿›</strong>ã€‚ä»¥ä¸‹æ˜¯æœ€å¸¸è§çš„ï¼š</p>
<ul>
<li><input disabled="" type="checkbox"/>
å°½å¯èƒ½<strong>é™åˆ¶</strong>è¯·æ±‚çš„**<code>permissions</code>**</li>
<li><input disabled="" type="checkbox"/>
å°½å¯èƒ½<strong>é™åˆ¶****<code>host_permissions</code></strong></li>
<li><input disabled="" type="checkbox"/>
ä½¿ç”¨<strong>å¼º</strong>çš„**<code>content_security_policy</code>**</li>
<li><input disabled="" type="checkbox"/>
å°½å¯èƒ½<strong>é™åˆ¶****<code>externally_connectable</code></strong>ï¼Œå¦‚æœä¸éœ€è¦ä¸”å¯èƒ½ï¼Œè¯·ä¸è¦é»˜è®¤ç•™ç©ºï¼ŒæŒ‡å®š**<code>{}</code>**</li>
<li><input disabled="" type="checkbox"/>
å¦‚æœè¿™é‡Œæåˆ°çš„<strong>URLæ˜“å—XSSæˆ–æ¥ç®¡æ”»å‡»</strong>ï¼Œæ”»å‡»è€…å°†èƒ½å¤Ÿ<strong>ç›´æ¥å‘åå°è„šæœ¬å‘é€æ¶ˆæ¯</strong>ã€‚éå¸¸å¼ºå¤§çš„ç»•è¿‡æ–¹å¼ã€‚</li>
<li><input disabled="" type="checkbox"/>
å°½å¯èƒ½<strong>é™åˆ¶****<code>web_accessible_resources</code></strong>ï¼Œç”šè‡³å¦‚æœå¯èƒ½çš„è¯ç•™ç©ºã€‚</li>
<li><input disabled="" type="checkbox"/>
å¦‚æœ**<code>web_accessible_resources</code>**ä¸ä¸ºç©ºï¼Œè¯·æ£€æŸ¥<a href="browext-clickjacking.html"><strong>ClickJacking</strong></a></li>
<li><input disabled="" type="checkbox"/>
å¦‚æœ<strong>æ‰©å±•</strong>ä¸<strong>ç½‘é¡µ</strong>ä¹‹é—´å‘ç”Ÿä»»ä½•<strong>é€šä¿¡</strong>ï¼Œè¯·<a href="browext-xss-example.html"><strong>æ£€æŸ¥XSS</strong></a> <strong>æ¼æ´</strong>ã€‚</li>
<li><input disabled="" type="checkbox"/>
å¦‚æœä½¿ç”¨äº†Post Messagesï¼Œè¯·æ£€æŸ¥<a href="../postmessage-vulnerabilities/"><strong>Post Messageæ¼æ´</strong></a><strong>ã€‚</strong></li>
<li><input disabled="" type="checkbox"/>
å¦‚æœ<strong>å†…å®¹è„šæœ¬è®¿é—®DOMç»†èŠ‚</strong>ï¼Œè¯·æ£€æŸ¥å®ƒä»¬æ˜¯å¦åœ¨è¢«ç½‘é¡µ<strong>ä¿®æ”¹</strong>æ—¶<strong>å¼•å…¥XSS</strong>ã€‚</li>
<li><input disabled="" type="checkbox"/>
å¦‚æœæ­¤é€šä¿¡ä¹Ÿæ¶‰åŠ<strong>å†…å®¹è„šæœ¬ -&gt; åå°è„šæœ¬é€šä¿¡</strong>ï¼Œè¯·ç‰¹åˆ«å¼ºè°ƒã€‚</li>
<li><input disabled="" type="checkbox"/>
å¦‚æœåå°è„šæœ¬é€šè¿‡<strong>æœ¬æœºæ¶ˆæ¯ä¼ é€’</strong>è¿›è¡Œé€šä¿¡ï¼Œè¯·æ£€æŸ¥é€šä¿¡æ˜¯å¦å®‰å…¨ä¸”ç»è¿‡æ¸…ç†ã€‚</li>
<li><input disabled="" type="checkbox"/>
<strong>æ•æ„Ÿä¿¡æ¯ä¸åº”å­˜å‚¨</strong>åœ¨æµè§ˆå™¨æ‰©å±•<strong>ä»£ç </strong>ä¸­ã€‚</li>
<li><input disabled="" type="checkbox"/>
<strong>æ•æ„Ÿä¿¡æ¯ä¸åº”å­˜å‚¨</strong>åœ¨æµè§ˆå™¨æ‰©å±•<strong>å†…å­˜</strong>ä¸­ã€‚</li>
<li><input disabled="" type="checkbox"/>
<strong>æ•æ„Ÿä¿¡æ¯ä¸åº”å­˜å‚¨</strong>åœ¨<strong>æ–‡ä»¶ç³»ç»Ÿä¸­æœªåŠ ä¿æŠ¤</strong>ã€‚</li>
</ul>
<h2 id="æµè§ˆå™¨æ‰©å±•é£é™©"><a class="header" href="#æµè§ˆå™¨æ‰©å±•é£é™©">æµè§ˆå™¨æ‰©å±•é£é™©</a></h2>
<ul>
<li>åº”ç”¨ç¨‹åº<a href="https://crxaminer.tech/">https://crxaminer.tech/</a>åˆ†æä¸€äº›æ•°æ®ï¼Œä¾‹å¦‚æµè§ˆå™¨æ‰©å±•è¯·æ±‚çš„æƒé™ï¼Œä»¥æä¾›ä½¿ç”¨æµè§ˆå™¨æ‰©å±•çš„é£é™©çº§åˆ«ã€‚</li>
</ul>
<h2 id="å·¥å…·"><a class="header" href="#å·¥å…·">å·¥å…·</a></h2>
<h3 id="tarnish"><a class="header" href="#tarnish"><a href="https://thehackerblog.com/tarnish/"><strong>Tarnish</strong></a></a></h3>
<ul>
<li>ä»æä¾›çš„Chromeç½‘ä¸Šåº”ç”¨åº—é“¾æ¥æå–ä»»ä½•Chromeæ‰©å±•ã€‚</li>
<li><a href="https://developer.chrome.com/extensions/manifest"><strong>manifest.json</strong></a> <strong>æŸ¥çœ‹å™¨</strong>ï¼šç®€å•åœ°æ˜¾ç¤ºæ‰©å±•æ¸…å•çš„JSONç¾åŒ–ç‰ˆæœ¬ã€‚</li>
<li><strong>æŒ‡çº¹åˆ†æ</strong>ï¼šæ£€æµ‹<a href="https://developer.chrome.com/extensions/manifest/web_accessible_resources">web_accessible_resources</a>å¹¶è‡ªåŠ¨ç”ŸæˆChromeæ‰©å±•æŒ‡çº¹JavaScriptã€‚</li>
<li><strong>æ½œåœ¨çš„Clickjackingåˆ†æ</strong>ï¼šæ£€æµ‹è®¾ç½®äº†<a href="https://developer.chrome.com/extensions/manifest/web_accessible_resources">web_accessible_resources</a>æŒ‡ä»¤çš„æ‰©å±•HTMLé¡µé¢ã€‚è¿™äº›é¡µé¢å¯èƒ½ä¼šå—åˆ°Clickjackingçš„æ”»å‡»ï¼Œå…·ä½“å–å†³äºé¡µé¢çš„ç›®çš„ã€‚</li>
<li><strong>æƒé™è­¦å‘ŠæŸ¥çœ‹å™¨</strong>ï¼šæ˜¾ç¤ºç”¨æˆ·å°è¯•å®‰è£…æ‰©å±•æ—¶å°†æ˜¾ç¤ºçš„æ‰€æœ‰Chromeæƒé™æç¤ºè­¦å‘Šçš„åˆ—è¡¨ã€‚</li>
<li><strong>å±é™©å‡½æ•°</strong>ï¼šæ˜¾ç¤ºå¯èƒ½è¢«æ”»å‡»è€…åˆ©ç”¨çš„å±é™©å‡½æ•°çš„ä½ç½®ï¼ˆä¾‹å¦‚ï¼ŒinnerHTMLã€chrome.tabs.executeScriptç­‰å‡½æ•°ï¼‰ã€‚</li>
<li><strong>å…¥å£ç‚¹</strong>ï¼šæ˜¾ç¤ºæ‰©å±•æ¥æ”¶ç”¨æˆ·/å¤–éƒ¨è¾“å…¥çš„ä½ç½®ã€‚è¿™å¯¹äºç†è§£æ‰©å±•çš„è¡¨é¢åŒºåŸŸå’Œå¯»æ‰¾æ½œåœ¨çš„æ¶æ„æ•°æ®å‘é€ç‚¹éå¸¸æœ‰ç”¨ã€‚</li>
<li>å±é™©å‡½æ•°å’Œå…¥å£ç‚¹æ‰«æå™¨ç”Ÿæˆçš„è­¦æŠ¥åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</li>
<li>ç›¸å…³ä»£ç ç‰‡æ®µå’Œå¯¼è‡´è­¦æŠ¥çš„è¡Œã€‚</li>
<li>é—®é¢˜æè¿°ã€‚</li>
<li>â€œæŸ¥çœ‹æ–‡ä»¶â€æŒ‰é’®ä»¥æŸ¥çœ‹åŒ…å«ä»£ç çš„å®Œæ•´æºæ–‡ä»¶ã€‚</li>
<li>è­¦æŠ¥æ–‡ä»¶çš„è·¯å¾„ã€‚</li>
<li>è­¦æŠ¥æ–‡ä»¶çš„å®Œæ•´Chromeæ‰©å±•URIã€‚</li>
<li>æ–‡ä»¶ç±»å‹ï¼Œä¾‹å¦‚åå°é¡µé¢è„šæœ¬ã€å†…å®¹è„šæœ¬ã€æµè§ˆå™¨æ“ä½œç­‰ã€‚</li>
<li>å¦‚æœæ˜“å—æ”»å‡»çš„è¡Œåœ¨JavaScriptæ–‡ä»¶ä¸­ï¼Œåˆ™åŒ…æ‹¬æ‰€æœ‰åŒ…å«è¯¥è¡Œçš„é¡µé¢çš„è·¯å¾„ä»¥åŠè¿™äº›é¡µé¢çš„ç±»å‹å’Œ<a href="https://developer.chrome.com/extensions/manifest/web_accessible_resources">web_accessible_resource</a>çŠ¶æ€ã€‚</li>
<li><strong>å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰åˆ†æå™¨å’Œç»•è¿‡æ£€æŸ¥å™¨</strong>ï¼šè¿™å°†æŒ‡å‡ºæ‰©å±•CSPä¸­çš„å¼±ç‚¹ï¼Œå¹¶å°†æ­ç¤ºç”±äºç™½åå•CDNç­‰å¯èƒ½ç»•è¿‡CSPçš„ä»»ä½•æ½œåœ¨æ–¹å¼ã€‚</li>
<li><strong>å·²çŸ¥æ¼æ´åº“</strong>ï¼šä½¿ç”¨<a href="https://retirejs.github.io/retire.js/">Retire.js</a>æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†å·²çŸ¥æ¼æ´çš„JavaScriptåº“ã€‚</li>
<li>ä¸‹è½½æ‰©å±•å’Œæ ¼å¼åŒ–ç‰ˆæœ¬ã€‚</li>
<li>ä¸‹è½½åŸå§‹æ‰©å±•ã€‚</li>
<li>ä¸‹è½½ç¾åŒ–ç‰ˆæœ¬çš„æ‰©å±•ï¼ˆè‡ªåŠ¨ç¾åŒ–çš„HTMLå’ŒJavaScriptï¼‰ã€‚</li>
<li>æ‰«æç»“æœçš„è‡ªåŠ¨ç¼“å­˜ï¼Œç¬¬ä¸€æ¬¡è¿è¡Œæ‰©å±•æ‰«æå°†èŠ±è´¹ç›¸å½“å¤šçš„æ—¶é—´ã€‚ç„¶è€Œï¼Œç¬¬äºŒæ¬¡è¿è¡Œæ—¶ï¼Œå‡è®¾æ‰©å±•æ²¡æœ‰æ›´æ–°ï¼Œå°†å‡ ä¹æ˜¯ç¬æ—¶çš„ï¼Œå› ä¸ºç»“æœå·²è¢«ç¼“å­˜ã€‚</li>
<li>å¯é“¾æ¥çš„æŠ¥å‘ŠURLï¼Œè½»æ¾å°†å…¶ä»–äººé“¾æ¥åˆ°ç”±Tarnishç”Ÿæˆçš„æ‰©å±•æŠ¥å‘Šã€‚</li>
</ul>
<h3 id="neto"><a class="header" href="#neto"><a href="https://github.com/elevenpaths/neto">Neto</a></a></h3>
<p>é¡¹ç›®Netoæ˜¯ä¸€ä¸ªPython 3åŒ…ï¼Œæ—¨åœ¨åˆ†æå’Œæ­ç¤ºFirefoxå’ŒChromeç­‰çŸ¥åæµè§ˆå™¨çš„æµè§ˆå™¨æ’ä»¶å’Œæ‰©å±•çš„éšè—åŠŸèƒ½ã€‚å®ƒè‡ªåŠ¨è§£å‹æ‰“åŒ…æ–‡ä»¶ï¼Œä»¥ä»æ‰©å±•çš„ç›¸å…³èµ„æºä¸­æå–è¿™äº›åŠŸèƒ½ï¼Œå¦‚<code>manifest.json</code>ã€æœ¬åœ°åŒ–æ–‡ä»¶å¤¹æˆ–JavaScriptå’ŒHTMLæºæ–‡ä»¶ã€‚</p>
<h2 id="å‚è€ƒæ–‡çŒ®"><a class="header" href="#å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</a></h2>
<ul>
<li><strong>æ„Ÿè°¢</strong> <a href="https://twitter.com/naivenom"><strong>@naivenom</strong></a> <strong>å¯¹æœ¬æ–¹æ³•çš„å¸®åŠ©</strong></li>
<li><a href="https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing">https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing</a></li>
<li><a href="https://palant.info/2022/08/10/anatomy-of-a-basic-extension/">https://palant.info/2022/08/10/anatomy-of-a-basic-extension/</a></li>
<li><a href="https://palant.info/2022/08/24/attack-surface-of-extension-pages/">https://palant.info/2022/08/24/attack-surface-of-extension-pages/</a></li>
<li><a href="https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/">https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/</a></li>
<li><a href="https://help.passbolt.com/assets/files/PBL-02-report.pdf">https://help.passbolt.com/assets/files/PBL-02-report.pdf</a></li>
<li><a href="https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts">https://developer.chrome.com/docs/extensions/develop/concepts/content-scripts</a></li>
<li><a href="https://developer.chrome.com/docs/extensions/mv2/background-pages">https://developer.chrome.com/docs/extensions/mv2/background-pages</a></li>
<li><a href="https://thehackerblog.com/kicking-the-rims-a-guide-for-securely-writing-and-auditing-chrome-extensions/">https://thehackerblog.com/kicking-the-rims-a-guide-for-securely-writing-and-auditing-chrome-extensions/</a></li>
<li><a href="https://gist.github.com/LongJohnCoder/9ddf5735df3a4f2e9559665fb864eac0">https://gist.github.com/LongJohnCoder/9ddf5735df3a4f2e9559665fb864eac0</a></li>
</ul>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µAWSé»‘å®¢æ”»å‡»ï¼š<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricksåŸ¹è®­AWSçº¢é˜Ÿä¸“å®¶ï¼ˆARTEï¼‰</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µGCPé»‘å®¢æ”»å‡»ï¼š<img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricksåŸ¹è®­GCPçº¢é˜Ÿä¸“å®¶ï¼ˆGRTEï¼‰</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒHackTricks</summary>
<ul>
<li>æŸ¥çœ‹<a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discordå°ç»„</strong></a>æˆ–<a href="https://t.me/peass"><strong>ç”µæŠ¥å°ç»„</strong></a>æˆ–<strong>åœ¨Twitterä¸Šå…³æ³¨</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a>å’Œ<a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHubåº“æäº¤PRåˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../pentesting-web/account-takeover.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../pentesting-web/browser-extension-pentesting-methodology/browext-clickjacking.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../pentesting-web/account-takeover.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../pentesting-web/browser-extension-pentesting-methodology/browext-clickjacking.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
