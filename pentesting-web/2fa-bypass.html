<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>2FA/MFA/OTP Bypass</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="2famfaotp-绕过"><a class="header" href="#2famfaotp-绕过">2FA/MFA/OTP 绕过</a></h1>
<p>{% hint style="success" %}
学习和实践 AWS 黑客技术：<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习和实践 GCP 黑客技术：<img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>Telegram 群组</strong></a> 或 <strong>关注</strong> 我们的 <strong>Twitter</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub 仓库提交 PR 分享黑客技巧。</li>
</ul>
</details>
{% endhint %}
<h2 id="增强的双因素认证绕过技术"><a class="header" href="#增强的双因素认证绕过技术"><strong>增强的双因素认证绕过技术</strong></a></h2>
<h3 id="直接端点访问"><a class="header" href="#直接端点访问"><strong>直接端点访问</strong></a></h3>
<p>要绕过 2FA，直接访问后续端点，了解路径至关重要。如果不成功，修改 <strong>Referrer header</strong> 以模拟从 2FA 验证页面的导航。</p>
<h3 id="令牌重用"><a class="header" href="#令牌重用"><strong>令牌重用</strong></a></h3>
<p>在账户内重用先前使用的令牌进行身份验证可能有效。</p>
<h3 id="利用未使用的令牌"><a class="header" href="#利用未使用的令牌"><strong>利用未使用的令牌</strong></a></h3>
<p>尝试从自己的账户提取令牌以绕过另一个账户的 2FA。</p>
<h3 id="令牌泄露"><a class="header" href="#令牌泄露"><strong>令牌泄露</strong></a></h3>
<p>调查令牌是否在 Web 应用程序的响应中被泄露。</p>
<h3 id="验证链接利用"><a class="header" href="#验证链接利用"><strong>验证链接利用</strong></a></h3>
<p>使用 <strong>账户创建时发送的电子邮件验证链接</strong> 可以在没有 2FA 的情况下访问个人资料，如详细 <a href="https://srahulceh.medium.com/behind-the-scenes-of-a-security-bug-the-perils-of-2fa-cookie-generation-496d9519771b">帖子</a> 所述。</p>
<h3 id="会话操控"><a class="header" href="#会话操控"><strong>会话操控</strong></a></h3>
<p>为用户和受害者的账户启动会话，并在不继续的情况下完成用户账户的 2FA，尝试访问受害者账户流程中的下一步，利用后端会话管理的限制。</p>
<h3 id="密码重置机制"><a class="header" href="#密码重置机制"><strong>密码重置机制</strong></a></h3>
<p>调查密码重置功能，该功能在重置后将用户登录到应用程序，检查其是否允许使用相同链接进行多次重置。使用新重置的凭据登录可能绕过 2FA。</p>
<h3 id="oauth-平台妥协"><a class="header" href="#oauth-平台妥协"><strong>OAuth 平台妥协</strong></a></h3>
<p>妥协用户在受信任的 <strong>OAuth</strong> 平台（例如 Google、Facebook）上的账户可以提供绕过 2FA 的途径。</p>
<h3 id="暴力攻击"><a class="header" href="#暴力攻击"><strong>暴力攻击</strong></a></h3>
<h4 id="缺乏速率限制"><a class="header" href="#缺乏速率限制"><strong>缺乏速率限制</strong></a></h4>
<p>缺乏对代码尝试次数的限制允许进行暴力攻击，尽管应考虑潜在的静默速率限制。</p>
<p>请注意，即使存在速率限制，您也应该尝试查看在发送有效 OTP 时响应是否不同。在 <a href="https://mokhansec.medium.com/the-2-200-ato-most-bug-hunters-overlooked-by-closing-intruder-too-soon-505f21d56732"><strong>这篇帖子</strong></a> 中，漏洞猎人发现即使在 20 次不成功尝试后触发速率限制并以 401 响应，如果发送了有效的 OTP，则会收到 200 响应。</p>
<h4 id="慢速暴力攻击"><a class="header" href="#慢速暴力攻击"><strong>慢速暴力攻击</strong></a></h4>
<p>在存在流速限制而没有整体速率限制的情况下，慢速暴力攻击是可行的。</p>
<h4 id="代码重发限制重置"><a class="header" href="#代码重发限制重置"><strong>代码重发限制重置</strong></a></h4>
<p>重发代码会重置速率限制，便于继续进行暴力攻击。</p>
<h4 id="客户端速率限制规避"><a class="header" href="#客户端速率限制规避"><strong>客户端速率限制规避</strong></a></h4>
<p>文档详细说明了绕过客户端速率限制的技术。</p>
<h4 id="内部操作缺乏速率限制"><a class="header" href="#内部操作缺乏速率限制"><strong>内部操作缺乏速率限制</strong></a></h4>
<p>速率限制可能保护登录尝试，但不保护内部账户操作。</p>
<h4 id="短信代码重发成本"><a class="header" href="#短信代码重发成本"><strong>短信代码重发成本</strong></a></h4>
<p>通过 SMS 过度重发代码会给公司带来成本，尽管这并不绕过 2FA。</p>
<h4 id="无限-otp-生成"><a class="header" href="#无限-otp-生成"><strong>无限 OTP 生成</strong></a></h4>
<p>使用简单代码进行无限 OTP 生成允许通过重试一小组代码进行暴力攻击。</p>
<h3 id="竞争条件利用"><a class="header" href="#竞争条件利用"><strong>竞争条件利用</strong></a></h3>
<p>利用竞争条件进行 2FA 绕过的技术可以在特定文档中找到。</p>
<h3 id="csrf点击劫持漏洞"><a class="header" href="#csrf点击劫持漏洞"><strong>CSRF/点击劫持漏洞</strong></a></h3>
<p>探索 CSRF 或点击劫持漏洞以禁用 2FA 是一种可行的策略。</p>
<h3 id="记住我功能利用"><a class="header" href="#记住我功能利用"><strong>“记住我”功能利用</strong></a></h3>
<h4 id="可预测的-cookie-值"><a class="header" href="#可预测的-cookie-值"><strong>可预测的 Cookie 值</strong></a></h4>
<p>猜测“记住我” cookie 值可以绕过限制。</p>
<h4 id="ip-地址冒充"><a class="header" href="#ip-地址冒充"><strong>IP 地址冒充</strong></a></h4>
<p>通过 <strong>X-Forwarded-For</strong> header 冒充受害者的 IP 地址可以绕过限制。</p>
<h3 id="利用旧版本"><a class="header" href="#利用旧版本"><strong>利用旧版本</strong></a></h3>
<h4 id="子域名"><a class="header" href="#子域名"><strong>子域名</strong></a></h4>
<p>测试子域名可能使用缺乏 2FA 支持的过时版本或包含脆弱的 2FA 实现。</p>
<h4 id="api-端点"><a class="header" href="#api-端点"><strong>API 端点</strong></a></h4>
<p>旧的 API 版本，通过 /v*/ 目录路径指示，可能容易受到 2FA 绕过方法的攻击。</p>
<h3 id="处理先前会话"><a class="header" href="#处理先前会话"><strong>处理先前会话</strong></a></h3>
<p>在 2FA 激活时终止现有会话可以保护账户免受被妥协会话的未授权访问。</p>
<h3 id="备份代码的访问控制缺陷"><a class="header" href="#备份代码的访问控制缺陷"><strong>备份代码的访问控制缺陷</strong></a></h3>
<p>在 2FA 激活时立即生成和潜在未授权检索备份代码，尤其是在 CORS 错误配置/XSS 漏洞的情况下，构成风险。</p>
<h3 id="2fa-页面信息泄露"><a class="header" href="#2fa-页面信息泄露"><strong>2FA 页面信息泄露</strong></a></h3>
<p>在 2FA 验证页面上泄露敏感信息（例如，电话号码）是一个问题。</p>
<h3 id="密码重置禁用-2fa"><a class="header" href="#密码重置禁用-2fa"><strong>密码重置禁用 2FA</strong></a></h3>
<p>一个展示潜在绕过方法的过程涉及账户创建、2FA 激活、密码重置和随后在没有 2FA 要求的情况下登录。</p>
<h3 id="诱饵请求"><a class="header" href="#诱饵请求"><strong>诱饵请求</strong></a></h3>
<p>利用诱饵请求来掩盖暴力攻击尝试或误导速率限制机制为绕过策略增加了另一层。制作此类请求需要对应用程序的安全措施和速率限制行为有细致的理解。</p>
<h3 id="otp-构造错误"><a class="header" href="#otp-构造错误">OTP 构造错误</a></h3>
<p>如果 OTP 是基于用户已经拥有的数据或在创建 OTP 之前发送的数据生成的，用户也可能生成它并绕过它。</p>
<h2 id="参考文献"><a class="header" href="#参考文献">参考文献</a></h2>
<ul>
<li><a href="https://github.com/carlospolop/hacktricks/blob/master/pentesting-web/%22https:/medium.com/@iSecMax/two-factor-authentication-security-testing-and-possible-bypasses-f65650412b35%22/README.md">https://medium.com/@iSecMax/two-factor-authentication-security-testing-and-possible-bypasses-f65650412b35</a></li>
<li><a href="https://azwi.medium.com/2-factor-authentication-bypass-3b2bbd907718">https://azwi.medium.com/2-factor-authentication-bypass-3b2bbd907718</a></li>
<li><a href="https://getpocket.com/read/aM7dap2bTo21bg6fRDAV2c5thng5T48b3f0Pd1geW2u186eafibdXj7aA78Ip116_1d0f6ce59992222b0812b7cab19a4bce">https://getpocket.com/read/aM7dap2bTo21bg6fRDAV2c5thng5T48b3f0Pd1geW2u186eafibdXj7aA78Ip116_1d0f6ce59992222b0812b7cab19a4bce</a></li>
</ul>
<p>P</p>
<p>{% hint style="success" %}
学习和实践 AWS 黑客技术：<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习和实践 GCP 黑客技术：<img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>Telegram 群组</strong></a> 或 <strong>关注</strong> 我们的 <strong>Twitter</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub 仓库提交 PR 分享黑客技巧。</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../pentesting-web/pocs-and-polygloths-cheatsheet/web-vulns-list.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../pentesting-web/account-takeover.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../pentesting-web/pocs-and-polygloths-cheatsheet/web-vulns-list.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../pentesting-web/account-takeover.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
