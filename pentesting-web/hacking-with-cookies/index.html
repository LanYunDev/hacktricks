<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Cookies Hacking</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="cookies-hacking"><a class="header" href="#cookies-hacking">Cookies Hacking</a></h1>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS Hackingï¼š<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks Training AWS Red Team Expert (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µ GCP Hackingï¼š<img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks Training GCP Red Team Expert (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>å…³æ³¨</strong> æˆ‘ä»¬çš„ <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<h2 id="cookie-å±æ€§"><a class="header" href="#cookie-å±æ€§">Cookie å±æ€§</a></h2>
<p>Cookies å…·æœ‰å¤šä¸ªå±æ€§ï¼Œæ§åˆ¶å…¶åœ¨ç”¨æˆ·æµè§ˆå™¨ä¸­çš„è¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯è¿™äº›å±æ€§çš„ç®€è¦è¯´æ˜ï¼š</p>
<h3 id="expires-å’Œ-max-age"><a class="header" href="#expires-å’Œ-max-age">Expires å’Œ Max-Age</a></h3>
<p>Cookie çš„è¿‡æœŸæ—¥æœŸç”± <code>Expires</code> å±æ€§å†³å®šã€‚ç›¸åï¼Œ<code>Max-age</code> å±æ€§å®šä¹‰äº†åœ¨åˆ é™¤ Cookie ä¹‹å‰çš„ç§’æ•°ã€‚<strong>é€‰æ‹© <code>Max-age</code>ï¼Œå› ä¸ºå®ƒåæ˜ äº†æ›´ç°ä»£çš„åšæ³•ã€‚</strong></p>
<h3 id="domain"><a class="header" href="#domain">Domain</a></h3>
<p>æ¥æ”¶ Cookie çš„ä¸»æœºç”± <code>Domain</code> å±æ€§æŒ‡å®šã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™è®¾ç½®ä¸ºå‘å‡º Cookie çš„ä¸»æœºï¼Œä¸åŒ…æ‹¬å…¶å­åŸŸã€‚ç„¶è€Œï¼Œå½“ <code>Domain</code> å±æ€§è¢«æ˜¾å¼è®¾ç½®æ—¶ï¼Œå®ƒä¹ŸåŒ…æ‹¬å­åŸŸã€‚è¿™ä½¿å¾— <code>Domain</code> å±æ€§çš„æŒ‡å®šæˆä¸ºä¸€ä¸ªä¸é‚£ä¹ˆä¸¥æ ¼çš„é€‰é¡¹ï¼Œé€‚ç”¨äºéœ€è¦è·¨å­åŸŸå…±äº« Cookie çš„åœºæ™¯ã€‚ä¾‹å¦‚ï¼Œè®¾ç½® <code>Domain=mozilla.org</code> ä½¿å¾—å…¶å­åŸŸå¦‚ <code>developer.mozilla.org</code> ä¸Šçš„ Cookie å¯è®¿é—®ã€‚</p>
<h3 id="path"><a class="header" href="#path">Path</a></h3>
<p><code>Path</code> å±æ€§æŒ‡ç¤ºå¿…é¡»åœ¨è¯·æ±‚çš„ URL ä¸­å­˜åœ¨çš„ç‰¹å®š URL è·¯å¾„ï¼Œä»¥ä¾¿å‘é€ <code>Cookie</code> å¤´ã€‚æ­¤å±æ€§å°† <code>/</code> å­—ç¬¦è§†ä¸ºç›®å½•åˆ†éš”ç¬¦ï¼Œå…è®¸åœ¨å­ç›®å½•ä¸­åŒ¹é…ã€‚</p>
<h3 id="ordering-rules"><a class="header" href="#ordering-rules">Ordering Rules</a></h3>
<p>å½“ä¸¤ä¸ª Cookie å…·æœ‰ç›¸åŒçš„åç§°æ—¶ï¼Œé€‰æ‹©å‘é€çš„ Cookie åŸºäºï¼š</p>
<ul>
<li>ä¸è¯·æ±‚çš„ URL ä¸­æœ€é•¿è·¯å¾„åŒ¹é…çš„ Cookieã€‚</li>
<li>å¦‚æœè·¯å¾„ç›¸åŒï¼Œåˆ™é€‰æ‹©æœ€è¿‘è®¾ç½®çš„ Cookieã€‚</li>
</ul>
<h3 id="samesite"><a class="header" href="#samesite">SameSite</a></h3>
<ul>
<li><code>SameSite</code> å±æ€§å†³å®šæ˜¯å¦åœ¨æ¥è‡ªç¬¬ä¸‰æ–¹åŸŸçš„è¯·æ±‚ä¸­å‘é€ Cookieã€‚å®ƒæä¾›ä¸‰ç§è®¾ç½®ï¼š</li>
<li><strong>Strict</strong>ï¼šé™åˆ¶ Cookie åœ¨ç¬¬ä¸‰æ–¹è¯·æ±‚ä¸­å‘é€ã€‚</li>
<li><strong>Lax</strong>ï¼šå…è®¸ Cookie ä¸ç”±ç¬¬ä¸‰æ–¹ç½‘ç«™å‘èµ·çš„ GET è¯·æ±‚ä¸€èµ·å‘é€ã€‚</li>
<li><strong>None</strong>ï¼šå…è®¸ Cookie ä»ä»»ä½•ç¬¬ä¸‰æ–¹åŸŸå‘é€ã€‚</li>
</ul>
<p>è¯·è®°ä½ï¼Œåœ¨é…ç½® Cookie æ—¶ï¼Œç†è§£è¿™äº›å±æ€§å¯ä»¥å¸®åŠ©ç¡®ä¿å®ƒä»¬åœ¨ä¸åŒåœºæ™¯ä¸­æŒ‰é¢„æœŸè¡Œä¸ºã€‚</p>
<div class="table-wrapper"><table><thead><tr><th><strong>è¯·æ±‚ç±»å‹</strong></th><th><strong>ç¤ºä¾‹ä»£ç </strong></th><th><strong>å‘é€ Cookie çš„æ¡ä»¶</strong></th></tr></thead><tbody>
<tr><td>é“¾æ¥</td><td>&lt;a href="..."&gt;&lt;/a&gt;</td><td>NotSet*, Lax, None</td></tr>
<tr><td>é¢„æ¸²æŸ“</td><td>&lt;link rel="prerender" href=".."/&gt;</td><td>NotSet*, Lax, None</td></tr>
<tr><td>è¡¨å• GET</td><td>&lt;form method="GET" action="..."&gt;</td><td>NotSet*, Lax, None</td></tr>
<tr><td>è¡¨å• POST</td><td>&lt;form method="POST" action="..."&gt;</td><td>NotSet*, None</td></tr>
<tr><td>iframe</td><td>&lt;iframe src="..."&gt;&lt;/iframe&gt;</td><td>NotSet*, None</td></tr>
<tr><td>AJAX</td><td>$.get("...")</td><td>NotSet*, None</td></tr>
<tr><td>å›¾ç‰‡</td><td>&lt;img src="..."&gt;</td><td>NetSet*, None</td></tr>
</tbody></table>
</div>
<p>è¡¨æ ¼æ¥è‡ª <a href="https://www.netsparker.com/blog/web-security/same-site-cookie-attribute-prevent-cross-site-request-forgery/">Invicti</a> å¹¶ç¨ä½œä¿®æ”¹ã€‚<br />
å…·æœ‰ <em><strong>SameSite</strong></em> å±æ€§çš„ Cookie å°† <strong>å‡è½» CSRF æ”»å‡»</strong>ï¼Œå…¶ä¸­éœ€è¦ç™»å½•ä¼šè¯ã€‚</p>
<p><strong>*è¯·æ³¨æ„ï¼Œä» Chrome80ï¼ˆ2019å¹´2æœˆï¼‰å¼€å§‹ï¼Œæœªè®¾ç½® Cookie SameSite å±æ€§çš„ Cookie çš„é»˜è®¤è¡Œä¸ºå°†ä¸º Lax</strong> (<a href="https://www.troyhunt.com/promiscuous-cookies-and-their-impending-death-via-the-samesite-policy/">https://www.troyhunt.com/promiscuous-cookies-and-their-impending-death-via-the-samesite-policy/</a>).<br />
è¯·æ³¨æ„ï¼Œä¸´æ—¶æƒ…å†µä¸‹ï¼Œåœ¨åº”ç”¨æ­¤æ›´æ”¹åï¼Œ<strong>æ²¡æœ‰ SameSite</strong> **ç­–ç•¥çš„ Cookie åœ¨ Chrome ä¸­å°†è¢« <strong>è§†ä¸º None</strong>ï¼Œåœ¨ <strong>å‰ 2 åˆ†é’Ÿå†…ï¼Œç„¶ååœ¨é¡¶çº§è·¨ç«™ç‚¹ POST è¯·æ±‚ä¸­è§†ä¸º Lax</strong>ã€‚</p>
<h2 id="cookies-æ ‡å¿—"><a class="header" href="#cookies-æ ‡å¿—">Cookies æ ‡å¿—</a></h2>
<h3 id="httponly"><a class="header" href="#httponly">HttpOnly</a></h3>
<p>è¿™é¿å…äº† <strong>å®¢æˆ·ç«¯</strong> è®¿é—® Cookieï¼ˆä¾‹å¦‚é€šè¿‡ <strong>Javascript</strong>ï¼š<code>document.cookie</code>ï¼‰</p>
<h4 id="ç»•è¿‡"><a class="header" href="#ç»•è¿‡"><strong>ç»•è¿‡</strong></a></h4>
<ul>
<li>å¦‚æœé¡µé¢ <strong>å°† Cookie ä½œä¸ºè¯·æ±‚çš„å“åº”å‘é€</strong>ï¼ˆä¾‹å¦‚åœ¨ <strong>PHPinfo</strong> é¡µé¢ä¸­ï¼‰ï¼Œå¯ä»¥åˆ©ç”¨ XSS å‘é€è¯·æ±‚åˆ°æ­¤é¡µé¢å¹¶ <strong>çªƒå–å“åº”ä¸­çš„ Cookie</strong>ï¼ˆè¯·æŸ¥çœ‹ç¤ºä¾‹ <a href="https://hackcommander.github.io/posts/2022/11/12/bypass-httponly-via-php-info-page/">https://hackcommander.github.io/posts/2022/11/12/bypass-httponly-via-php-info-page/</a>ï¼‰ã€‚</li>
<li>è¿™å¯ä»¥é€šè¿‡ <strong>TRACE</strong> <strong>HTTP</strong> è¯·æ±‚ç»•è¿‡ï¼Œå› ä¸ºæœåŠ¡å™¨çš„å“åº”å°†åæ˜ å‘é€çš„ Cookieï¼ˆå¦‚æœæ­¤ HTTP æ–¹æ³•å¯ç”¨ï¼‰ã€‚æ­¤æŠ€æœ¯ç§°ä¸º <strong>è·¨ç«™ç‚¹è·Ÿè¸ª</strong>ã€‚</li>
<li>ç°ä»£æµè§ˆå™¨é€šè¿‡ä¸å…è®¸ä» JS å‘é€ TRACE è¯·æ±‚æ¥é¿å…æ­¤æŠ€æœ¯ã€‚ç„¶è€Œï¼Œåœ¨ç‰¹å®šè½¯ä»¶ä¸­å‘ç°äº†ä¸€äº›ç»•è¿‡æ–¹æ³•ï¼Œä¾‹å¦‚å‘ IE6.0 SP2 å‘é€ <code>\r\nTRACE</code> è€Œä¸æ˜¯ <code>TRACE</code>ã€‚</li>
<li>å¦ä¸€ç§æ–¹æ³•æ˜¯åˆ©ç”¨æµè§ˆå™¨çš„é›¶æ—¥æ¼æ´ã€‚</li>
<li>å¯ä»¥é€šè¿‡æ‰§è¡Œ Cookie Jar æº¢å‡ºæ”»å‡»æ¥ <strong>è¦†ç›– HttpOnly Cookie</strong>ï¼š</li>
</ul>
<p>{% content-ref url="cookie-jar-overflow.md" %}
<a href="cookie-jar-overflow.html">cookie-jar-overflow.md</a>
{% endcontent-ref %}</p>
<ul>
<li>å¯ä»¥ä½¿ç”¨ <a href="./#cookie-smuggling"><strong>Cookie Smuggling</strong></a> æ”»å‡»æ¥å¤–æ³„è¿™äº› Cookieã€‚</li>
</ul>
<h3 id="secure"><a class="header" href="#secure">Secure</a></h3>
<p>è¯·æ±‚å°† <strong>ä»…</strong> åœ¨é€šè¿‡å®‰å…¨é€šé“ï¼ˆé€šå¸¸æ˜¯ <strong>HTTPS</strong>ï¼‰ä¼ è¾“æ—¶å‘é€ Cookieã€‚</p>
<h2 id="cookies-å‰ç¼€"><a class="header" href="#cookies-å‰ç¼€">Cookies å‰ç¼€</a></h2>
<p>ä»¥ <code>__Secure-</code> å¼€å¤´çš„ Cookie å¿…é¡»ä¸é€šè¿‡ HTTPS ä¿æŠ¤çš„é¡µé¢çš„ <code>secure</code> æ ‡å¿—ä¸€èµ·è®¾ç½®ã€‚</p>
<p>å¯¹äºä»¥ <code>__Host-</code> å¼€å¤´çš„ Cookieï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li>å¿…é¡»è®¾ç½® <code>secure</code> æ ‡å¿—ã€‚</li>
<li>å¿…é¡»æ¥è‡ªé€šè¿‡ HTTPS ä¿æŠ¤çš„é¡µé¢ã€‚</li>
<li>ç¦æ­¢æŒ‡å®šåŸŸï¼Œé˜²æ­¢å…¶ä¼ è¾“åˆ°å­åŸŸã€‚</li>
<li>è¿™äº› Cookie çš„è·¯å¾„å¿…é¡»è®¾ç½®ä¸º <code>/</code>ã€‚</li>
</ul>
<p>é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œä»¥ <code>__Host-</code> å¼€å¤´çš„ Cookie ä¸å…è®¸å‘é€åˆ°è¶…çº§åŸŸæˆ–å­åŸŸã€‚æ­¤é™åˆ¶æœ‰åŠ©äºéš”ç¦»åº”ç”¨ç¨‹åº Cookieã€‚å› æ­¤ï¼Œä½¿ç”¨ <code>__Host-</code> å‰ç¼€ä¸ºæ‰€æœ‰åº”ç”¨ç¨‹åº Cookie æ˜¯å¢å¼ºå®‰å…¨æ€§å’Œéš”ç¦»æ€§çš„è‰¯å¥½åšæ³•ã€‚</p>
<h3 id="è¦†ç›–-cookie"><a class="header" href="#è¦†ç›–-cookie">è¦†ç›– Cookie</a></h3>
<p>å› æ­¤ï¼Œ<code>__Host-</code> å‰ç¼€ Cookie çš„ä¿æŠ¤ä¹‹ä¸€æ˜¯é˜²æ­¢å®ƒä»¬è¢«å­åŸŸè¦†ç›–ã€‚ä¾‹å¦‚ï¼Œé˜²æ­¢ <a href="cookie-tossing.html"><strong>Cookie Tossing æ”»å‡»</strong></a>ã€‚åœ¨æ¼”è®² <a href="https://www.youtube.com/watch?v=F_wAzF4a7Xg"><strong>Cookie Crumbles: Unveiling Web Session Integrity Vulnerabilities</strong></a> (<a href="https://www.usenix.org/system/files/usenixsecurity23-squarcina.pdf"><strong>è®ºæ–‡</strong></a>) ä¸­ï¼Œå±•ç¤ºäº†å¯ä»¥é€šè¿‡æ¬ºéª—è§£æå™¨ä»å­åŸŸè®¾ç½® __HOST- å‰ç¼€çš„ Cookieï¼Œä¾‹å¦‚ï¼Œåœ¨å¼€å¤´æˆ–ç»“å°¾æ·»åŠ  "="ï¼š</p>
<figure><img src="../../.gitbook/assets/image (6) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>
<p>æˆ–è€…åœ¨ PHP ä¸­ï¼Œå¯ä»¥åœ¨ Cookie åç§°çš„å¼€å¤´æ·»åŠ  <strong>å…¶ä»–å­—ç¬¦</strong>ï¼Œè¿™äº›å­—ç¬¦å°†è¢« <strong>æ›¿æ¢ä¸ºä¸‹åˆ’çº¿</strong> å­—ç¬¦ï¼Œä»è€Œå…è®¸è¦†ç›– <code>__HOST-</code> Cookieï¼š</p>
<figure><img src="../../.gitbook/assets/image (7) (1) (1) (1) (1).png" alt="" width="373"><figcaption></figcaption></figure>
<h2 id="cookies-æ”»å‡»"><a class="header" href="#cookies-æ”»å‡»">Cookies æ”»å‡»</a></h2>
<p>å¦‚æœè‡ªå®šä¹‰ Cookie åŒ…å«æ•æ„Ÿæ•°æ®ï¼Œè¯·æ£€æŸ¥å®ƒï¼ˆç‰¹åˆ«æ˜¯å¦‚æœæ‚¨æ­£åœ¨è¿›è¡Œ CTFï¼‰ï¼Œå› ä¸ºå®ƒå¯èƒ½å­˜åœ¨æ¼æ´ã€‚</p>
<h3 id="è§£ç å’Œæ“çºµ-cookies"><a class="header" href="#è§£ç å’Œæ“çºµ-cookies">è§£ç å’Œæ“çºµ Cookies</a></h3>
<p>åµŒå…¥ Cookie çš„æ•æ„Ÿæ•°æ®åº”å§‹ç»ˆå—åˆ°å®¡æŸ¥ã€‚ä»¥ Base64 æˆ–ç±»ä¼¼æ ¼å¼ç¼–ç çš„ Cookie é€šå¸¸å¯ä»¥è¢«è§£ç ã€‚è¿™ç§æ¼æ´å…è®¸æ”»å‡»è€…æ›´æ”¹ Cookie çš„å†…å®¹ï¼Œå¹¶é€šè¿‡å°†å…¶ä¿®æ”¹åçš„æ•°æ®é‡æ–°ç¼–ç å› Cookie æ¥å†’å……å…¶ä»–ç”¨æˆ·ã€‚</p>
<h3 id="ä¼šè¯åŠ«æŒ"><a class="header" href="#ä¼šè¯åŠ«æŒ">ä¼šè¯åŠ«æŒ</a></h3>
<p>æ­¤æ”»å‡»æ¶‰åŠçªƒå–ç”¨æˆ·çš„ Cookieï¼Œä»¥è·å¾—å¯¹å…¶åœ¨åº”ç”¨ç¨‹åºä¸­çš„å¸æˆ·çš„æœªç»æˆæƒè®¿é—®ã€‚é€šè¿‡ä½¿ç”¨è¢«ç›—çš„ Cookieï¼Œæ”»å‡»è€…å¯ä»¥å†’å……åˆæ³•ç”¨æˆ·ã€‚</p>
<h3 id="ä¼šè¯å›ºå®š"><a class="header" href="#ä¼šè¯å›ºå®š">ä¼šè¯å›ºå®š</a></h3>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…è¯±ä½¿å—å®³è€…ä½¿ç”¨ç‰¹å®šçš„ Cookie ç™»å½•ã€‚å¦‚æœåº”ç”¨ç¨‹åºåœ¨ç™»å½•æ—¶ä¸åˆ†é…æ–°çš„ Cookieï¼Œæ”»å‡»è€…å°±å¯ä»¥ä½¿ç”¨åŸå§‹ Cookie å†’å……å—å®³è€…ã€‚æ­¤æŠ€æœ¯ä¾èµ–äºå—å®³è€…ä½¿ç”¨æ”»å‡»è€…æä¾›çš„ Cookie ç™»å½•ã€‚</p>
<p>å¦‚æœæ‚¨åœ¨ <strong>å­åŸŸä¸­å‘ç°äº† XSS</strong> æˆ– <strong>æ§åˆ¶äº†å­åŸŸ</strong>ï¼Œè¯·é˜…è¯»ï¼š</p>
<p>{% content-ref url="cookie-tossing.md" %}
<a href="cookie-tossing.html">cookie-tossing.md</a>
{% endcontent-ref %}</p>
<h3 id="ä¼šè¯æèµ "><a class="header" href="#ä¼šè¯æèµ ">ä¼šè¯æèµ </a></h3>
<p>åœ¨è¿™é‡Œï¼Œæ”»å‡»è€…è¯´æœå—å®³è€…ä½¿ç”¨æ”»å‡»è€…çš„ä¼šè¯ Cookieã€‚å—å®³è€…ç›¸ä¿¡ä»–ä»¬å·²ç™»å½•è‡ªå·±çš„å¸æˆ·ï¼Œå°†æ— æ„ä¸­åœ¨æ”»å‡»è€…çš„å¸æˆ·ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œæ“ä½œã€‚</p>
<p>å¦‚æœæ‚¨åœ¨ <strong>å­åŸŸä¸­å‘ç°äº† XSS</strong> æˆ– <strong>æ§åˆ¶äº†å­åŸŸ</strong>ï¼Œè¯·é˜…è¯»ï¼š</p>
<p>{% content-ref url="cookie-tossing.md" %}
<a href="cookie-tossing.html">cookie-tossing.md</a>
{% endcontent-ref %}</p>
<h3 id="jwt-cookies"><a class="header" href="#jwt-cookies"><a href="../hacking-jwt-json-web-tokens.html">JWT Cookies</a></a></h3>
<p>ç‚¹å‡»ä¸Šé¢çš„é“¾æ¥è®¿é—®è§£é‡Š JWT å¯èƒ½å­˜åœ¨ç¼ºé™·çš„é¡µé¢ã€‚</p>
<p>ç”¨äº Cookie çš„ JSON Web Tokens (JWT) ä¹Ÿå¯èƒ½å­˜åœ¨æ¼æ´ã€‚æœ‰å…³æ½œåœ¨ç¼ºé™·åŠå…¶åˆ©ç”¨æ–¹å¼çš„æ·±å…¥ä¿¡æ¯ï¼Œå»ºè®®è®¿é—®æœ‰å…³é»‘å®¢ JWT çš„é“¾æ¥æ–‡æ¡£ã€‚</p>
<h3 id="è·¨ç«™è¯·æ±‚ä¼ªé€ -csrf"><a class="header" href="#è·¨ç«™è¯·æ±‚ä¼ªé€ -csrf">è·¨ç«™è¯·æ±‚ä¼ªé€  (CSRF)</a></h3>
<p>æ­¤æ”»å‡»è¿«ä½¿å·²ç™»å½•ç”¨æˆ·åœ¨å…¶å½“å‰èº«ä»½éªŒè¯çš„ Web åº”ç”¨ç¨‹åºä¸Šæ‰§è¡Œä¸å¿…è¦çš„æ“ä½œã€‚æ”»å‡»è€…å¯ä»¥åˆ©ç”¨è‡ªåŠ¨éšæ¯ä¸ªè¯·æ±‚å‘é€åˆ°æ˜“å—æ”»å‡»ç«™ç‚¹çš„ Cookieã€‚</p>
<h3 id="ç©º-cookie"><a class="header" href="#ç©º-cookie">ç©º Cookie</a></h3>
<p>ï¼ˆè¯·æŸ¥çœ‹<a href="https://blog.ankursundara.com/cookie-bugs/">åŸå§‹ç ”ç©¶</a>ä¸­çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼‰æµè§ˆå™¨å…è®¸åˆ›å»ºæ²¡æœ‰åç§°çš„ Cookieï¼Œè¿™å¯ä»¥é€šè¿‡ JavaScript è¿›è¡Œæ¼”ç¤ºï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="language-js">document.cookie = "a=v1"
document.cookie = "=test value;" // Setting an empty named cookie
document.cookie = "b=v2"
</code></pre>
<p>ç»“æœåœ¨å‘é€çš„ cookie å¤´ä¸­æ˜¯ <code>a=v1; test value; b=v2;</code>ã€‚æœ‰è¶£çš„æ˜¯ï¼Œå¦‚æœè®¾ç½®äº†ä¸€ä¸ªç©ºåç§°çš„ cookieï¼Œè¿™å…è®¸å¯¹ cookies è¿›è¡Œæ“æ§ï¼Œå¯èƒ½é€šè¿‡å°†ç©º cookie è®¾ç½®ä¸ºç‰¹å®šå€¼æ¥æ§åˆ¶å…¶ä»– cookiesï¼š</p>
<pre><code class="language-js">function setCookie(name, value) {
document.cookie = `${name}=${value}`;
}

setCookie("", "a=b"); // Setting the empty cookie modifies another cookie's value
</code></pre>
<p>è¿™å¯¼è‡´æµè§ˆå™¨å‘é€ä¸€ä¸ª cookie å¤´ï¼Œæ¯ä¸ª web æœåŠ¡å™¨å°†å…¶è§£é‡Šä¸ºåä¸º <code>a</code>ï¼Œå€¼ä¸º <code>b</code> çš„ cookieã€‚</p>
<h4 id="chrome-bug-unicode-surrogate-codepoint-issue"><a class="header" href="#chrome-bug-unicode-surrogate-codepoint-issue">Chrome Bug: Unicode Surrogate Codepoint Issue</a></h4>
<p>åœ¨ Chrome ä¸­ï¼Œå¦‚æœ Unicode ä»£ç†ä»£ç ç‚¹æ˜¯è®¾ç½®çš„ cookie çš„ä¸€éƒ¨åˆ†ï¼Œ<code>document.cookie</code> å°†å˜å¾—æŸåï¼Œéšåè¿”å›ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼š</p>
<pre><code class="language-js">document.cookie = "\ud800=meep";
</code></pre>
<p>è¿™å¯¼è‡´ <code>document.cookie</code> è¾“å‡ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼Œè¡¨æ˜æ°¸ä¹…æ€§æŸåã€‚</p>
<h4 id="ç”±äºè§£æé—®é¢˜å¯¼è‡´çš„-cookie-èµ°ç§"><a class="header" href="#ç”±äºè§£æé—®é¢˜å¯¼è‡´çš„-cookie-èµ°ç§">ç”±äºè§£æé—®é¢˜å¯¼è‡´çš„ Cookie èµ°ç§</a></h4>
<p>ï¼ˆæŸ¥çœ‹<a href="https://blog.ankursundara.com/cookie-bugs/">åŸå§‹ç ”ç©¶</a>çš„æ›´å¤šç»†èŠ‚ï¼‰åŒ…æ‹¬ Javaï¼ˆJettyã€TomCatã€Undertowï¼‰å’Œ Pythonï¼ˆZopeã€cherrypyã€web.pyã€aiohttpã€bottleã€webobï¼‰åœ¨å†…çš„å¤šä¸ªç½‘ç»œæœåŠ¡å™¨ï¼Œç”±äºå¯¹è¿‡æ—¶çš„ RFC2965 æ”¯æŒï¼Œé”™è¯¯å¤„ç† cookie å­—ç¬¦ä¸²ã€‚å®ƒä»¬å°†åŒå¼•å·çš„ cookie å€¼è§†ä¸ºå•ä¸ªå€¼ï¼Œå³ä½¿å®ƒåŒ…å«åˆ†å·ï¼Œè€Œåˆ†å·é€šå¸¸åº”åˆ†éš”é”®å€¼å¯¹ï¼š</p>
<pre><code>RENDER_TEXT="hello world; JSESSIONID=13371337; ASDF=end";
</code></pre>
<h4 id="cookie-injection-vulnerabilities"><a class="header" href="#cookie-injection-vulnerabilities">Cookie Injection Vulnerabilities</a></h4>
<p>(æŸ¥çœ‹<a href="https://blog.ankursundara.com/cookie-bugs/">åŸå§‹ç ”ç©¶</a>çš„æ›´å¤šç»†èŠ‚) æœåŠ¡å™¨å¯¹ cookies çš„é”™è¯¯è§£æï¼Œç‰¹åˆ«æ˜¯ Undertowã€Zope ä»¥åŠä½¿ç”¨ Python çš„ <code>http.cookie.SimpleCookie</code> å’Œ <code>http.cookie.BaseCookie</code> çš„æœåŠ¡å™¨ï¼Œåˆ›é€ äº† cookie æ³¨å…¥æ”»å‡»çš„æœºä¼šã€‚è¿™äº›æœåŠ¡å™¨æœªèƒ½æ­£ç¡®åˆ†éš”æ–° cookie çš„å¼€å§‹ï¼Œå…è®¸æ”»å‡»è€…ä¼ªé€  cookiesï¼š</p>
<ul>
<li>Undertow æœŸæœ›åœ¨å¸¦å¼•å·çš„å€¼åç«‹å³å‡ºç°æ–° cookieï¼Œè€Œä¸éœ€è¦åˆ†å·ã€‚</li>
<li>Zope å¯»æ‰¾é€—å·ä»¥å¼€å§‹è§£æä¸‹ä¸€ä¸ª cookieã€‚</li>
<li>Python çš„ cookie ç±»åœ¨ç©ºæ ¼å­—ç¬¦ä¸Šå¼€å§‹è§£æã€‚</li>
</ul>
<p>è¿™ç§æ¼æ´åœ¨ä¾èµ–åŸºäº cookie çš„ CSRF ä¿æŠ¤çš„ web åº”ç”¨ç¨‹åºä¸­å°¤å…¶å±é™©ï¼Œå› ä¸ºå®ƒå…è®¸æ”»å‡»è€…æ³¨å…¥ä¼ªé€ çš„ CSRF-token cookiesï¼Œå¯èƒ½ç»•è¿‡å®‰å…¨æªæ–½ã€‚è¿™ä¸ªé—®é¢˜å›  Python å¯¹é‡å¤ cookie åç§°çš„å¤„ç†è€ŒåŠ å‰§ï¼Œæœ€åä¸€ä¸ªå‡ºç°çš„åç§°ä¼šè¦†ç›–ä¹‹å‰çš„åç§°ã€‚å®ƒè¿˜å¼•å‘äº†å¯¹ä¸å®‰å…¨ä¸Šä¸‹æ–‡ä¸­ <code>__Secure-</code> å’Œ <code>__Host-</code> cookies çš„æ‹…å¿§ï¼Œå¹¶å¯èƒ½å¯¼è‡´åœ¨å°† cookies ä¼ é€’ç»™æ˜“å—ä¼ªé€ å½±å“çš„åç«¯æœåŠ¡å™¨æ—¶ç»•è¿‡æˆæƒã€‚</p>
<h3 id="cookies-version-and-waf-bypasses"><a class="header" href="#cookies-version-and-waf-bypasses">Cookies $version and WAF bypasses</a></h3>
<p>æ ¹æ®<a href="https://portswigger.net/research/bypassing-wafs-with-the-phantom-version-cookie"><strong>è¿™ç¯‡åšå®¢</strong></a>ï¼Œå¯èƒ½å¯ä»¥ä½¿ç”¨ cookie å±æ€§ <strong><code>$Version=1</code></strong> ä½¿åç«¯ä½¿ç”¨æ—§é€»è¾‘è§£æ cookieï¼ŒåŸå› æ˜¯ <strong>RFC2109</strong>ã€‚æ­¤å¤–ï¼Œå…¶ä»–å€¼å¦‚ <strong><code>$Domain</code></strong> å’Œ <strong><code>$Path</code></strong> å¯ä»¥ç”¨æ¥ä¿®æ”¹åç«¯å¯¹ cookie çš„è¡Œä¸ºã€‚</p>
<h4 id="bypassing-value-analysis-with-quoted-string-encoding"><a class="header" href="#bypassing-value-analysis-with-quoted-string-encoding">Bypassing value analysis with quoted-string encoding</a></h4>
<p>è¿™ç§è§£æè¡¨æ˜è¦å–æ¶ˆå¯¹ cookies å†…éƒ¨è½¬ä¹‰å€¼çš„è½¬ä¹‰ï¼Œå› æ­¤ "\a" å˜ä¸º "a"ã€‚è¿™å¯¹äºç»•è¿‡ WAFS å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºï¼š</p>
<ul>
<li><code>eval('test') =&gt; forbidden</code></li>
<li><code>"\e\v\a\l\(\'\t\e\s\t\'\)" =&gt; allowed</code></li>
</ul>
<h4 id="bypassing-cookie-name-blocklists"><a class="header" href="#bypassing-cookie-name-blocklists">Bypassing cookie-name blocklists</a></h4>
<p>åœ¨ RFC2109 ä¸­æŒ‡å‡º <strong>é€—å·å¯ä»¥ç”¨ä½œ cookie å€¼ä¹‹é—´çš„åˆ†éš”ç¬¦</strong>ã€‚è€Œä¸”åœ¨ç­‰å·å‰åä¹Ÿå¯ä»¥æ·»åŠ  <strong>ç©ºæ ¼å’Œåˆ¶è¡¨ç¬¦</strong>ã€‚å› æ­¤ï¼Œåƒ <code>$Version=1; foo=bar, abc = qux</code> çš„ cookie ä¸ä¼šç”Ÿæˆ cookie <code>"foo":"bar, admin = qux"</code>ï¼Œè€Œæ˜¯ç”Ÿæˆ cookies <code>foo":"bar"</code> å’Œ <code>"admin":"qux"</code>ã€‚æ³¨æ„ç”Ÿæˆäº† 2 ä¸ª cookiesï¼Œä»¥åŠ admin åœ¨ç­‰å·å‰åå»æ‰äº†ç©ºæ ¼ã€‚</p>
<h4 id="bypassing-value-analysis-with-cookie-splitting"><a class="header" href="#bypassing-value-analysis-with-cookie-splitting">Bypassing value analysis with cookie splitting</a></h4>
<p>æœ€åï¼Œä¸åŒçš„åé—¨ä¼šå°†ä¸åŒçš„ cookies è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™äº› cookies é€šè¿‡ä¸åŒçš„ cookie å¤´ä¼ é€’ï¼Œå¦‚ï¼š </p>
<pre><code>GET / HTTP/1.1
Host: example.com
Cookie: param1=value1;
Cookie: param2=value2;
</code></pre>
<p>è¿™å¯èƒ½å…è®¸ç»•è¿‡WAFï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š</p>
<pre><code>Cookie: name=eval('test//
Cookie: comment')

Resulting cookie: name=eval('test//, comment') =&gt; allowed
</code></pre>
<h3 id="é¢å¤–è„†å¼±çš„-cookies-æ£€æŸ¥"><a class="header" href="#é¢å¤–è„†å¼±çš„-cookies-æ£€æŸ¥">é¢å¤–è„†å¼±çš„ Cookies æ£€æŸ¥</a></h3>
<h4 id="åŸºæœ¬æ£€æŸ¥"><a class="header" href="#åŸºæœ¬æ£€æŸ¥"><strong>åŸºæœ¬æ£€æŸ¥</strong></a></h4>
<ul>
<li><strong>cookie</strong> æ¯æ¬¡ <strong>ç™»å½•</strong> æ—¶éƒ½æ˜¯ <strong>ç›¸åŒ</strong> çš„ã€‚</li>
<li>ç™»å‡ºå¹¶å°è¯•ä½¿ç”¨ç›¸åŒçš„ cookieã€‚</li>
<li>å°è¯•ç”¨ 2 ä¸ªè®¾å¤‡ï¼ˆæˆ–æµè§ˆå™¨ï¼‰ä½¿ç”¨ç›¸åŒçš„ cookie ç™»å½•åŒä¸€è´¦æˆ·ã€‚</li>
<li>æ£€æŸ¥ cookie ä¸­æ˜¯å¦æœ‰ä»»ä½•ä¿¡æ¯å¹¶å°è¯•ä¿®æ”¹å®ƒã€‚</li>
<li>å°è¯•åˆ›å»ºå¤šä¸ªå‡ ä¹ç›¸åŒç”¨æˆ·åçš„è´¦æˆ·ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦å¯ä»¥çœ‹åˆ°ç›¸ä¼¼ä¹‹å¤„ã€‚</li>
<li>æ£€æŸ¥æ˜¯å¦å­˜åœ¨ "<strong>è®°ä½æˆ‘</strong>" é€‰é¡¹ä»¥äº†è§£å…¶å·¥ä½œåŸç†ã€‚å¦‚æœå­˜åœ¨ä¸”å¯èƒ½å­˜åœ¨æ¼æ´ï¼Œå§‹ç»ˆä½¿ç”¨ "<strong>è®°ä½æˆ‘</strong>" çš„ cookieï¼Œè€Œä¸ä½¿ç”¨å…¶ä»– cookieã€‚</li>
<li>æ£€æŸ¥å³ä½¿åœ¨æ›´æ”¹å¯†ç åï¼Œä¹‹å‰çš„ cookie æ˜¯å¦ä»ç„¶æœ‰æ•ˆã€‚</li>
</ul>
<h4 id="é«˜çº§-cookies-æ”»å‡»"><a class="header" href="#é«˜çº§-cookies-æ”»å‡»"><strong>é«˜çº§ cookies æ”»å‡»</strong></a></h4>
<p>å¦‚æœåœ¨ç™»å½•æ—¶ cookie ä¿æŒä¸å˜ï¼ˆæˆ–å‡ ä¹ä¸å˜ï¼‰ï¼Œè¿™å¯èƒ½æ„å‘³ç€è¯¥ cookie ä¸æ‚¨è´¦æˆ·çš„æŸä¸ªå­—æ®µç›¸å…³ï¼ˆå¯èƒ½æ˜¯ç”¨æˆ·åï¼‰ã€‚ç„¶åæ‚¨å¯ä»¥ï¼š</p>
<ul>
<li>å°è¯•åˆ›å»ºè®¸å¤šç”¨æˆ·åéå¸¸ <strong>ç›¸ä¼¼</strong> çš„ <strong>è´¦æˆ·</strong>ï¼Œå¹¶å°è¯• <strong>çŒœæµ‹</strong> ç®—æ³•çš„å·¥ä½œåŸç†ã€‚</li>
<li>å°è¯• <strong>æš´åŠ›ç ´è§£ç”¨æˆ·å</strong>ã€‚å¦‚æœ cookie ä»…ä½œä¸ºæ‚¨ç”¨æˆ·åçš„èº«ä»½éªŒè¯æ–¹æ³•ä¿å­˜ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªç”¨æˆ·åä¸º "<strong>Bmin</strong>" çš„è´¦æˆ·ï¼Œå¹¶ <strong>æš´åŠ›ç ´è§£</strong> æ‚¨ cookie çš„æ¯ä¸€ä¸ª <strong>ä½</strong>ï¼Œå› ä¸ºæ‚¨å°è¯•çš„å…¶ä¸­ä¸€ä¸ª cookie å°†æ˜¯å±äº "<strong>admin</strong>" çš„ã€‚</li>
<li>å°è¯• <strong>å¡«å……</strong> <strong>Oracle</strong>ï¼ˆæ‚¨å¯ä»¥è§£å¯† cookie çš„å†…å®¹ï¼‰ã€‚ä½¿ç”¨ <strong>padbuster</strong>ã€‚</li>
</ul>
<p><strong>å¡«å…… Oracle - Padbuster ç¤ºä¾‹</strong></p>
<pre><code class="language-bash">padbuster &lt;URL/path/when/successfully/login/with/cookie&gt; &lt;COOKIE&gt; &lt;PAD[8-16]&gt;
# When cookies and regular Base64
padbuster http://web.com/index.php u7bvLewln6PJPSAbMb5pFfnCHSEd6olf 8 -cookies auth=u7bvLewln6PJPSAbMb5pFfnCHSEd6olf

# If Base64 urlsafe or hex-lowercase or hex-uppercase --encoding parameter is needed, for example:
padBuster http://web.com/home.jsp?UID=7B216A634951170FF851D6CC68FC9537858795A28ED4AAC6
7B216A634951170FF851D6CC68FC9537858795A28ED4AAC6 8 -encoding 2
</code></pre>
<p>Padbuster å°†è¿›è¡Œå¤šæ¬¡å°è¯•ï¼Œå¹¶ä¼šè¯¢é—®æ‚¨å“ªä¸ªæ¡ä»¶æ˜¯é”™è¯¯æ¡ä»¶ï¼ˆå³æ— æ•ˆçš„æ¡ä»¶ï¼‰ã€‚</p>
<p>ç„¶åå®ƒå°†å¼€å§‹è§£å¯† cookieï¼ˆå¯èƒ½éœ€è¦å‡ åˆ†é’Ÿï¼‰</p>
<p>å¦‚æœæ”»å‡»æˆåŠŸæ‰§è¡Œï¼Œåˆ™æ‚¨å¯ä»¥å°è¯•åŠ å¯†æ‚¨é€‰æ‹©çš„å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æƒ³è¦ <strong>encrypt</strong> <strong>user=administrator</strong></p>
<pre><code>padbuster http://web.com/index.php 1dMjA5hfXh0jenxJQ0iW6QXKkzAGIWsiDAKV3UwJPT2lBP+zAD0D0w== 8 -cookies thecookie=1dMjA5hfXh0jenxJQ0iW6QXKkzAGIWsiDAKV3UwJPT2lBP+zAD0D0w== -plaintext user=administrator
</code></pre>
<p>æ­¤æ‰§è¡Œå°†ä¸ºæ‚¨æä¾›æ­£ç¡®åŠ å¯†å’Œç¼–ç çš„ cookieï¼Œå…¶ä¸­åŒ…å«å­—ç¬¦ä¸² <strong>user=administrator</strong>ã€‚</p>
<p><strong>CBC-MAC</strong></p>
<p>ä¹Ÿè®¸ä¸€ä¸ª cookie å¯ä»¥å…·æœ‰æŸä¸ªå€¼ï¼Œå¹¶å¯ä»¥ä½¿ç”¨ CBC ç­¾åã€‚ç„¶åï¼Œå€¼çš„å®Œæ•´æ€§æ˜¯ä½¿ç”¨ç›¸åŒå€¼çš„ CBC åˆ›å»ºçš„ç­¾åã€‚ç”±äºå»ºè®®ä½¿ç”¨ç©ºå‘é‡ä½œä¸º IVï¼Œè¿™ç§å®Œæ•´æ€§æ£€æŸ¥å¯èƒ½ä¼šå—åˆ°æ”»å‡»ã€‚</p>
<p><strong>æ”»å‡»</strong></p>
<ol>
<li>è·å–ç”¨æˆ·å <strong>administ</strong> çš„ç­¾å = <strong>t</strong></li>
<li>è·å–ç”¨æˆ·å <strong>rator\x00\x00\x00 XOR t</strong> çš„ç­¾å = <strong>t'</strong></li>
<li>åœ¨ cookie ä¸­è®¾ç½®å€¼ <strong>administrator+t'</strong> ï¼ˆ<strong>t'</strong> å°†æ˜¯ <strong>(rator\x00\x00\x00 XOR t) XOR t</strong> = <strong>rator\x00\x00\x00</strong> çš„æœ‰æ•ˆç­¾åï¼‰</li>
</ol>
<p><strong>ECB</strong></p>
<p>å¦‚æœ cookie ä½¿ç”¨ ECB åŠ å¯†ï¼Œåˆ™å¯èƒ½ä¼šå—åˆ°æ”»å‡»ã€‚<br />
å½“æ‚¨ç™»å½•æ—¶ï¼Œæ‚¨æ”¶åˆ°çš„ cookie å¿…é¡»å§‹ç»ˆç›¸åŒã€‚</p>
<p><strong>å¦‚ä½•æ£€æµ‹å’Œæ”»å‡»ï¼š</strong></p>
<p>åˆ›å»º 2 ä¸ªå‡ ä¹ç›¸åŒæ•°æ®çš„ç”¨æˆ·ï¼ˆç”¨æˆ·åã€å¯†ç ã€ç”µå­é‚®ä»¶ç­‰ï¼‰ï¼Œå¹¶å°è¯•å‘ç°ç»™å®š cookie ä¸­çš„æŸäº›æ¨¡å¼ã€‚</p>
<p>åˆ›å»ºä¸€ä¸ªåä¸º "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa" çš„ç”¨æˆ·ï¼Œå¹¶æ£€æŸ¥ cookie ä¸­æ˜¯å¦å­˜åœ¨ä»»ä½•æ¨¡å¼ï¼ˆç”±äº ECB ä½¿ç”¨ç›¸åŒçš„å¯†é’¥åŠ å¯†æ¯ä¸ªå—ï¼Œå¦‚æœç”¨æˆ·åè¢«åŠ å¯†ï¼Œåˆ™ç›¸åŒçš„åŠ å¯†å­—èŠ‚å¯èƒ½ä¼šå‡ºç°ï¼‰ã€‚</p>
<p>åº”è¯¥æœ‰ä¸€ä¸ªæ¨¡å¼ï¼ˆä¸ä½¿ç”¨çš„å—çš„å¤§å°ç›¸åŒï¼‰ã€‚å› æ­¤ï¼ŒçŸ¥é“ä¸€å † "a" æ˜¯å¦‚ä½•åŠ å¯†çš„ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªç”¨æˆ·åï¼š"a"*(å—çš„å¤§å°)+"admin"ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥ä» cookie ä¸­åˆ é™¤ä¸€ä¸ªå—çš„ "a" çš„åŠ å¯†æ¨¡å¼ã€‚æ‚¨å°†æ‹¥æœ‰ç”¨æˆ·å "admin" çš„ cookieã€‚</p>
<h2 id="å‚è€ƒæ–‡çŒ®"><a class="header" href="#å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</a></h2>
<ul>
<li><a href="https://blog.ankursundara.com/cookie-bugs/">https://blog.ankursundara.com/cookie-bugs/</a></li>
<li><a href="https://www.linkedin.com/posts/rickey-martin-24533653_100daysofhacking-penetrationtester-ethicalhacking-activity-7016286424526180352-bwDd">https://www.linkedin.com/posts/rickey-martin-24533653_100daysofhacking-penetrationtester-ethicalhacking-activity-7016286424526180352-bwDd</a></li>
<li><a href="https://portswigger.net/research/bypassing-wafs-with-the-phantom-version-cookie">https://portswigger.net/research/bypassing-wafs-with-the-phantom-version-cookie</a></li>
</ul>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks Training AWS Red Team Expert (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µ GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks Training GCP Red Team Expert (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>ç”µæŠ¥ç¾¤ç»„</strong></a> æˆ– <strong>åœ¨</strong> <strong>Twitter</strong> ğŸ¦ <strong>ä¸Šå…³æ³¨æˆ‘ä»¬</strong> <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../pentesting-web/content-security-policy-csp-bypass/csp-bypass-self-+-unsafe-inline-with-iframes.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../pentesting-web/hacking-with-cookies/cookie-tossing.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../pentesting-web/content-security-policy-csp-bypass/csp-bypass-self-+-unsafe-inline-with-iframes.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../pentesting-web/hacking-with-cookies/cookie-tossing.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
