<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>External Recon Methodology</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="外部侦察方法论"><a class="header" href="#外部侦察方法论">外部侦察方法论</a></h1>
<p>{% hint style="success" %}
学习与实践 AWS 黑客技术：<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习与实践 GCP 黑客技术：<img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>Telegram 群组</strong></a> 或 <strong>关注</strong> 我们的 <strong>Twitter</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub 仓库提交 PR 分享黑客技巧。</li>
</ul>
</details>
{% endhint %}
<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>
<p>如果你对 <strong>黑客职业</strong> 感兴趣并想要攻克不可攻克的目标 - <strong>我们正在招聘！</strong> (<em>需要流利的波兰语书写和口语能力</em>).</p>
<p>{% embed url="https://www.stmcyber.com/careers" %}</p>
<h2 id="资产发现"><a class="header" href="#资产发现">资产发现</a></h2>
<blockquote>
<p>所以你被告知某家公司所有的东西都在范围内，你想弄清楚这家公司实际上拥有什么。</p>
</blockquote>
<p>这个阶段的目标是获取<strong>主要公司拥有的所有公司</strong>，然后获取这些公司的所有<strong>资产</strong>。为此，我们将：</p>
<ol>
<li>找到主要公司的收购，这将给我们提供范围内的公司。</li>
<li>找到每个公司的 ASN（如果有的话），这将给我们提供每个公司拥有的 IP 范围。</li>
<li>使用反向 whois 查询搜索与第一个相关的其他条目（组织名称、域名...）（这可以递归进行）。</li>
<li>使用其他技术，如 shodan <code>org</code> 和 <code>ssl</code> 过滤器搜索其他资产（<code>ssl</code> 技巧可以递归进行）。</li>
</ol>
<h3 id="收购"><a class="header" href="#收购"><strong>收购</strong></a></h3>
<p>首先，我们需要知道<strong>主要公司拥有的其他公司</strong>。<br />
一个选项是访问 <a href="https://www.crunchbase.com">https://www.crunchbase.com/</a>，<strong>搜索</strong> <strong>主要公司</strong>，并<strong>点击</strong>“<strong>收购</strong>”。在那里你将看到主要公司收购的其他公司。<br />
另一个选项是访问主要公司的 <strong>维基百科</strong> 页面并搜索 <strong>收购</strong>。</p>
<blockquote>
<p>好吧，在这一点上你应该知道范围内的所有公司。让我们弄清楚如何找到它们的资产。</p>
</blockquote>
<h3 id="asns"><a class="header" href="#asns"><strong>ASNs</strong></a></h3>
<p>自治系统编号（<strong>ASN</strong>）是由 <strong>互联网分配号码管理局（IANA）</strong> 分配给 <strong>自治系统</strong>（AS）的 <strong>唯一编号</strong>。<br />
一个 <strong>AS</strong> 由 <strong>IP 地址块</strong> 组成，这些地址块有明确的政策来访问外部网络，并由单一组织管理，但可能由多个运营商组成。</p>
<p>查找<strong>公司是否分配了任何 ASN</strong> 以找到其 <strong>IP 范围</strong> 是很有趣的。对所有<strong>范围内的主机</strong>进行 <strong>漏洞测试</strong> 并 <strong>查找这些 IP 内的域名</strong> 将是很有趣的。<br />
你可以在 <a href="https://bgp.he.net"><strong>https://bgp.he.net/</strong></a>** 中按公司 <strong>名称</strong>、<strong>IP</strong> 或 <strong>域名</strong> 进行 <strong>搜索</strong>。<br />
<strong>根据公司的地区，这些链接可能对收集更多数据有用：</strong> <a href="https://www.afrinic.net"><strong>AFRINIC</strong></a> <strong>（非洲），</strong> <a href="https://www.arin.net/about/welcome/region/"><strong>Arin</strong></a><strong>（北美），</strong> <a href="https://www.apnic.net"><strong>APNIC</strong></a> <strong>（亚洲），</strong> <a href="https://www.lacnic.net"><strong>LACNIC</strong></a> <strong>（拉丁美洲），</strong> <a href="https://www.ripe.net"><strong>RIPE NCC</strong></a> <strong>（欧洲）。无论如何，所有的</strong> 有用信息 <strong>（IP 范围和 Whois）</strong> 可能已经在第一个链接中出现。</p>
<pre><code class="language-bash">#You can try "automate" this with amass, but it's not very recommended
amass intel -org tesla
amass intel -asn 8911,50313,394161
</code></pre>
<p>此外，**<a href="https://github.com/blacklanternsecurity/bbot">BBOT</a>**的子域名枚举会在扫描结束时自动聚合和总结ASN。</p>
<pre><code class="language-bash">bbot -t tesla.com -f subdomain-enum
...
[INFO] bbot.modules.asn: +----------+---------------------+--------------+----------------+----------------------------+-----------+
[INFO] bbot.modules.asn: | AS394161 | 8.244.131.0/24      | 5            | TESLA          | Tesla Motors, Inc.         | US        |
[INFO] bbot.modules.asn: +----------+---------------------+--------------+----------------+----------------------------+-----------+
[INFO] bbot.modules.asn: | AS16509  | 54.148.0.0/15       | 4            | AMAZON-02      | Amazon.com, Inc.           | US        |
[INFO] bbot.modules.asn: +----------+---------------------+--------------+----------------+----------------------------+-----------+
[INFO] bbot.modules.asn: | AS394161 | 8.45.124.0/24       | 3            | TESLA          | Tesla Motors, Inc.         | US        |
[INFO] bbot.modules.asn: +----------+---------------------+--------------+----------------+----------------------------+-----------+
[INFO] bbot.modules.asn: | AS3356   | 8.32.0.0/12         | 1            | LEVEL3         | Level 3 Parent, LLC        | US        |
[INFO] bbot.modules.asn: +----------+---------------------+--------------+----------------+----------------------------+-----------+
[INFO] bbot.modules.asn: | AS3356   | 8.0.0.0/9           | 1            | LEVEL3         | Level 3 Parent, LLC        | US        |
[INFO] bbot.modules.asn: +----------+---------------------+--------------+----------------+----------------------------+-----------+

</code></pre>
<p>您还可以使用 <a href="http://asnlookup.com">http://asnlookup.com/</a> 查找组织的 IP 范围（它有免费的 API）。<br />
您可以使用 <a href="http://ipv4info.com">http://ipv4info.com/</a> 查找域名的 IP 和 ASN。</p>
<h3 id="寻找漏洞"><a class="header" href="#寻找漏洞"><strong>寻找漏洞</strong></a></h3>
<p>此时我们知道 <strong>范围内的所有资产</strong>，所以如果您被允许，可以对所有主机启动一些 <strong>漏洞扫描器</strong>（Nessus, OpenVAS）。<br />
此外，您还可以启动一些 <a href="../pentesting-network/#discovering-hosts-from-the-outside"><strong>端口扫描</strong></a> <strong>或使用像</strong> shodan <strong>这样的服务来查找</strong> 开放端口 <strong>，根据您发现的内容，您应该</strong> 查看本书以了解如何对多个可能运行的服务进行渗透测试。<br />
<strong>此外，值得一提的是，您还可以准备一些</strong> 默认用户名 <strong>和</strong> 密码 <strong>列表，并尝试使用 <a href="https://github.com/x90skysn3k/brutespray">https://github.com/x90skysn3k/brutespray</a> 进行</strong> 暴力破解服务。</p>
<h2 id="域名"><a class="header" href="#域名">域名</a></h2>
<blockquote>
<p>我们知道范围内的所有公司及其资产，现在是时候查找范围内的域名了。</p>
</blockquote>
<p><em>请注意，在以下提出的技术中，您还可以找到子域名，这些信息不应被低估。</em></p>
<p>首先，您应该查找每个公司的 <strong>主域名</strong>。例如，对于 <em>Tesla Inc.</em>，主域名将是 <em>tesla.com</em>。</p>
<h3 id="反向-dns"><a class="header" href="#反向-dns"><strong>反向 DNS</strong></a></h3>
<p>由于您已经找到了域名的所有 IP 范围，您可以尝试对这些 <strong>IP 执行反向 DNS 查找，以查找范围内的更多域名</strong>。尝试使用受害者的某些 DNS 服务器或一些知名的 DNS 服务器（1.1.1.1, 8.8.8.8）。</p>
<pre><code class="language-bash">dnsrecon -r &lt;DNS Range&gt; -n &lt;IP_DNS&gt;   #DNS reverse of all of the addresses
dnsrecon -d facebook.com -r 157.240.221.35/24 #Using facebooks dns
dnsrecon -r 157.240.221.35/24 -n 1.1.1.1 #Using cloudflares dns
dnsrecon -r 157.240.221.35/24 -n 8.8.8.8 #Using google dns
</code></pre>
<p>为了使其工作，管理员必须手动启用 PTR。<br />
您还可以使用在线工具获取此信息：<a href="http://ptrarchive.com">http://ptrarchive.com/</a></p>
<h3 id="反向-whois循环"><a class="header" href="#反向-whois循环"><strong>反向 Whois（循环）</strong></a></h3>
<p>在 <strong>whois</strong> 中，您可以找到很多有趣的 <strong>信息</strong>，如 <strong>组织名称</strong>、<strong>地址</strong>、<strong>电子邮件</strong>、电话号码……但更有趣的是，如果您通过这些字段中的任何一个执行 <strong>反向 whois 查询</strong>，您可以找到 <strong>与公司相关的更多资产</strong>（例如，其他 whois 注册处中出现相同电子邮件的情况）。<br />
您可以使用在线工具，如：</p>
<ul>
<li><a href="https://viewdns.info/reversewhois/">https://viewdns.info/reversewhois/</a> - <strong>免费</strong></li>
<li><a href="https://domaineye.com/reverse-whois">https://domaineye.com/reverse-whois</a> - <strong>免费</strong></li>
<li><a href="https://www.reversewhois.io">https://www.reversewhois.io/</a> - <strong>免费</strong></li>
<li><a href="https://www.whoxy.com">https://www.whoxy.com/</a> - <strong>免费</strong>网页，不免费API。</li>
<li><a href="http://reversewhois.domaintools.com">http://reversewhois.domaintools.com/</a> - 不免费</li>
<li><a href="https://drs.whoisxmlapi.com/reverse-whois-search">https://drs.whoisxmlapi.com/reverse-whois-search</a> - 不免费（仅 <strong>100 次免费</strong> 查询）</li>
<li><a href="https://www.domainiq.com">https://www.domainiq.com/</a> - 不免费</li>
</ul>
<p>您可以使用 <a href="https://github.com/vysecurity/DomLink"><strong>DomLink</strong> </a> 自动化此任务（需要 whoxy API 密钥）。<br />
您还可以使用 <a href="https://github.com/OWASP/Amass">amass</a> 执行一些自动反向 whois 发现：<code>amass intel -d tesla.com -whois</code></p>
<p><strong>请注意，每次找到新域名时，您可以使用此技术发现更多域名。</strong></p>
<h3 id="追踪器"><a class="header" href="#追踪器"><strong>追踪器</strong></a></h3>
<p>如果在两个不同页面中找到 <strong>相同的追踪器 ID</strong>，您可以推测 <strong>这两个页面</strong> 是 <strong>由同一团队管理</strong>。<br />
例如，如果您在多个页面上看到相同的 <strong>Google Analytics ID</strong> 或相同的 <strong>Adsense ID</strong>。</p>
<p>有一些页面和工具可以让您通过这些追踪器和更多内容进行搜索：</p>
<ul>
<li><a href="https://github.com/dhn/udon"><strong>Udon</strong></a></li>
<li><a href="https://builtwith.com"><strong>BuiltWith</strong></a></li>
<li><a href="https://www.sitesleuth.io"><strong>Sitesleuth</strong></a></li>
<li><a href="https://publicwww.com"><strong>Publicwww</strong></a></li>
<li><a href="http://spyonweb.com"><strong>SpyOnWeb</strong></a></li>
</ul>
<h3 id="favicon"><a class="header" href="#favicon"><strong>Favicon</strong></a></h3>
<p>您知道我们可以通过查找相同的 favicon 图标哈希来找到与目标相关的域名和子域名吗？这正是 <a href="https://github.com/m4ll0k/Bug-Bounty-Toolz/blob/master/favihash.py">favihash.py</a> 工具由 <a href="https://twitter.com/m4ll0k2">@m4ll0k2</a> 制作的功能。以下是如何使用它：</p>
<pre><code class="language-bash">cat my_targets.txt | xargs -I %% bash -c 'echo "http://%%/favicon.ico"' &gt; targets.txt
python3 favihash.py -f https://target/favicon.ico -t targets.txt -s
</code></pre>
<p><img src="https://www.infosecmatter.com/wp-content/uploads/2020/07/favihash.jpg" alt="favihash - 发现具有相同 favicon 图标哈希的域" /></p>
<p>简单来说，favihash 将允许我们发现与我们的目标具有相同 favicon 图标哈希的域。</p>
<p>此外，您还可以使用 favicon 哈希搜索技术，如 <a href="https://medium.com/@Asm0d3us/weaponizing-favicon-ico-for-bugbounties-osint-and-what-not-ace3c214e139"><strong>这篇博客文章</strong></a> 中所述。这意味着如果您知道 <strong>一个易受攻击的网络技术的 favicon 哈希</strong>，您可以在 shodan 中搜索并 <strong>找到更多易受攻击的地方</strong>：</p>
<pre><code class="language-bash">shodan search org:"Target" http.favicon.hash:116323821 --fields ip_str,port --separator " " | awk '{print $1":"$2}'
</code></pre>
<p>这是您如何<strong>计算网站的 favicon 哈希</strong>：</p>
<pre><code class="language-python">import mmh3
import requests
import codecs

def fav_hash(url):
response = requests.get(url)
favicon = codecs.encode(response.content,"base64")
fhash = mmh3.hash(favicon)
print(f"{url} : {fhash}")
return fhash
</code></pre>
<h3 id="版权--唯一字符串"><a class="header" href="#版权--唯一字符串"><strong>版权 / 唯一字符串</strong></a></h3>
<p>在网页中搜索<strong>可能在同一组织的不同网站之间共享的字符串</strong>。<strong>版权字符串</strong>可能是一个很好的例子。然后在<strong>谷歌</strong>、其他<strong>浏览器</strong>或甚至在<strong>shodan</strong>中搜索该字符串：<code>shodan search http.html:"Copyright string"</code></p>
<h3 id="crt-时间"><a class="header" href="#crt-时间"><strong>CRT 时间</strong></a></h3>
<p>通常会有一个 cron 作业，例如</p>
<pre><code class="language-bash"># /etc/crontab
37 13 */10 * * certbot renew --post-hook "systemctl reload nginx"
</code></pre>
<p>to renew the all the domain certificates on the server. This means that even if the CA used for this doesn't set the time it was generated in the Validity time, it's possible to <strong>find domains belonging to the same company in the certificate transparency logs</strong>.<br />
Check out this <a href="https://swarm.ptsecurity.com/discovering-domains-via-a-time-correlation-attack/"><strong>writeup for more information</strong></a>.</p>
<h3 id="mail-dmarc-information"><a class="header" href="#mail-dmarc-information">Mail DMARC information</a></h3>
<p>You can use a web such as <a href="https://dmarc.live/info/google.com">https://dmarc.live/info/google.com</a> or a tool such as <a href="https://github.com/Tedixx/dmarc-subdomains">https://github.com/Tedixx/dmarc-subdomains</a> to find <strong>domains and subdomain sharing the same dmarc information</strong>.</p>
<h3 id="passive-takeover"><a class="header" href="#passive-takeover"><strong>Passive Takeover</strong></a></h3>
<p>Apparently is common for people to assign subdomains to IPs that belongs to cloud providers and at some point <strong>lose that IP address but forget about removing the DNS record</strong>. Therefore, just <strong>spawning a VM</strong> in a cloud (like Digital Ocean) you will be actually <strong>taking over some subdomains(s)</strong>.</p>
<p><a href="https://kmsec.uk/blog/passive-takeover/"><strong>This post</strong></a> explains a store about it and propose a script that <strong>spawns a VM in DigitalOcean</strong>, <strong>gets</strong> the <strong>IPv4</strong> of the new machine, and <strong>searches in Virustotal for subdomain records</strong> pointing to it.</p>
<h3 id="other-ways"><a class="header" href="#other-ways"><strong>Other ways</strong></a></h3>
<p><strong>Note that you can use this technique to discover more domain names every time you find a new domain.</strong></p>
<p><strong>Shodan</strong></p>
<p>As you already know the name of the organisation owning the IP space. You can search by that data in shodan using: <code>org:"Tesla, Inc."</code> Check the found hosts for new unexpected domains in the TLS certificate.</p>
<p>You could access the <strong>TLS certificate</strong> of the main web page, obtain the <strong>Organisation name</strong> and then search for that name inside the <strong>TLS certificates</strong> of all the web pages known by <strong>shodan</strong> with the filter : <code>ssl:"Tesla Motors"</code> or use a tool like <a href="https://github.com/HarshVaragiya/sslsearch"><strong>sslsearch</strong></a>.</p>
<p><strong>Assetfinder</strong></p>
<p><a href="https://github.com/tomnomnom/assetfinder"><strong>Assetfinder</strong> </a>is a tool that look for <strong>domains related</strong> with a main domain and <strong>subdomains</strong> of them, pretty amazing.</p>
<h3 id="looking-for-vulnerabilities"><a class="header" href="#looking-for-vulnerabilities"><strong>Looking for vulnerabilities</strong></a></h3>
<p>Check for some <a href="../../pentesting-web/domain-subdomain-takeover.html#domain-takeover">domain takeover</a>. Maybe some company is <strong>using some a domain</strong> but they <strong>lost the ownership</strong>. Just register it (if cheap enough) and let know the company.</p>
<p>If you find any <strong>domain with an IP different</strong> from the ones you already found in the assets discovery, you should perform a <strong>basic vulnerability scan</strong> (using Nessus or OpenVAS) and some <a href="../pentesting-network/#discovering-hosts-from-the-outside"><strong>port scan</strong></a> with <strong>nmap/masscan/shodan</strong>. Depending on which services are running you can find in <strong>this book some tricks to "attack" them</strong>.<br />
&amp;#xNAN;<em>Note that sometimes the domain is hosted inside an IP that is not controlled by the client, so it's not in the scope, be careful.</em></p>
<p><img src="../../.gitbook/assets/i3.png" alt="" data-size="original"><br />
<strong>Bug bounty tip</strong>: <strong>sign up</strong> for <strong>Intigriti</strong>, a premium <strong>bug bounty platform created by hackers, for hackers</strong>! Join us at <a href="https://go.intigriti.com/hacktricks"><strong>https://go.intigriti.com/hacktricks</strong></a> today, and start earning bounties up to <strong>$100,000</strong>!</p>
<p>{% embed url="https://go.intigriti.com/hacktricks" %}</p>
<h2 id="subdomains"><a class="header" href="#subdomains">Subdomains</a></h2>
<blockquote>
<p>We know all the companies inside the scope, all the assets of each company and all the domains related to the companies.</p>
</blockquote>
<p>It's time to find all the possible subdomains of each found domain.</p>
<p>{% hint style="success" %}
Note that some of the tools and techniques to find domains can also help to find subdomains!
{% endhint %}</p>
<h3 id="dns"><a class="header" href="#dns"><strong>DNS</strong></a></h3>
<p>Let's try to get <strong>subdomains</strong> from the <strong>DNS</strong> records. We should also try for <strong>Zone Transfer</strong> (If vulnerable, you should report it).</p>
<pre><code class="language-bash">dnsrecon -a -d tesla.com
</code></pre>
<h3 id="osint"><a class="header" href="#osint"><strong>OSINT</strong></a></h3>
<p>获取大量子域名的最快方法是搜索外部来源。最常用的 <strong>tools</strong> 如下（为了获得更好的结果，请配置 API 密钥）：</p>
<ul>
<li><a href="https://github.com/blacklanternsecurity/bbot"><strong>BBOT</strong></a></li>
</ul>
<pre><code class="language-bash"># subdomains
bbot -t tesla.com -f subdomain-enum

# subdomains (passive only)
bbot -t tesla.com -f subdomain-enum -rf passive

# subdomains + port scan + web screenshots
bbot -t tesla.com -f subdomain-enum -m naabu gowitness -n my_scan -o .
</code></pre>
<ul>
<li><a href="https://github.com/OWASP/Amass"><strong>Amass</strong></a></li>
</ul>
<pre><code class="language-bash">amass enum [-active] [-ip] -d tesla.com
amass enum -d tesla.com | grep tesla.com # To just list subdomains
</code></pre>
<ul>
<li><a href="https://github.com/projectdiscovery/subfinder"><strong>subfinder</strong></a></li>
</ul>
<pre><code class="language-bash"># Subfinder, use -silent to only have subdomains in the output
./subfinder-linux-amd64 -d tesla.com [-silent]
</code></pre>
<ul>
<li><a href="https://github.com/Edu4rdSHL/findomain/"><strong>findomain</strong></a></li>
</ul>
<pre><code class="language-bash"># findomain, use -silent to only have subdomains in the output
./findomain-linux -t tesla.com [--quiet]
</code></pre>
<ul>
<li><a href="https://github.com/shmilylty/OneForAll/tree/master/docs/en-us"><strong>OneForAll</strong></a></li>
</ul>
<pre><code class="language-bash">python3 oneforall.py --target tesla.com [--dns False] [--req False] [--brute False] run
</code></pre>
<ul>
<li><a href="https://github.com/tomnomnom/assetfinder"><strong>assetfinder</strong></a></li>
</ul>
<pre><code class="language-bash">assetfinder --subs-only &lt;domain&gt;
</code></pre>
<ul>
<li><a href="https://github.com/Screetsec/Sudomy"><strong>Sudomy</strong></a></li>
</ul>
<pre><code class="language-bash"># It requires that you create a sudomy.api file with API keys
sudomy -d tesla.com
</code></pre>
<ul>
<li><a href="https://github.com/junnlikestea/vita"><strong>vita</strong></a></li>
</ul>
<pre><code>vita -d tesla.com
</code></pre>
<ul>
<li><a href="https://github.com/laramies/theHarvester"><strong>theHarvester</strong></a></li>
</ul>
<pre><code class="language-bash">theHarvester -d tesla.com -b "anubis, baidu, bing, binaryedge, bingapi, bufferoverun, censys, certspotter, crtsh, dnsdumpster, duckduckgo, fullhunt, github-code, google, hackertarget, hunter, intelx, linkedin, linkedin_links, n45ht, omnisint, otx, pentesttools, projectdiscovery, qwant, rapiddns, rocketreach, securityTrails, spyse, sublist3r, threatcrowd, threatminer, trello, twitter, urlscan, virustotal, yahoo, zoomeye"
</code></pre>
<p>还有一些<strong>其他有趣的工具/API</strong>，即使它们并不是专门用于查找子域名，也可能对查找子域名有用，例如：</p>
<ul>
<li><a href="https://github.com/cgboal/sonarsearch"><strong>Crobat</strong></a><strong>:</strong> 使用API <a href="https://sonar.omnisint.io">https://sonar.omnisint.io</a> 来获取子域名</li>
</ul>
<pre><code class="language-bash"># Get list of subdomains in output from the API
## This is the API the crobat tool will use
curl https://sonar.omnisint.io/subdomains/tesla.com | jq -r ".[]"
</code></pre>
<ul>
<li><a href="https://jldc.me/anubis/subdomains/google.com"><strong>JLDC 免费 API</strong></a></li>
</ul>
<pre><code class="language-bash">curl https://jldc.me/anubis/subdomains/tesla.com | jq -r ".[]"
</code></pre>
<ul>
<li><a href="https://rapiddns.io"><strong>RapidDNS</strong></a> 免费API</li>
</ul>
<pre><code class="language-bash"># Get Domains from rapiddns free API
rapiddns(){
curl -s "https://rapiddns.io/subdomain/$1?full=1" \
| grep -oE "[\.a-zA-Z0-9-]+\.$1" \
| sort -u
}
rapiddns tesla.com
</code></pre>
<ul>
<li><a href="https://crt.sh"><strong>https://crt.sh/</strong></a></li>
</ul>
<pre><code class="language-bash"># Get Domains from crt free API
crt(){
curl -s "https://crt.sh/?q=%25.$1" \
| grep -oE "[\.a-zA-Z0-9-]+\.$1" \
| sort -u
}
crt tesla.com
</code></pre>
<ul>
<li><a href="https://github.com/lc/gau"><strong>gau</strong></a><strong>:</strong> 从AlienVault的开放威胁交换、Wayback Machine和Common Crawl获取任何给定域的已知URL。</li>
</ul>
<pre><code class="language-bash"># Get subdomains from GAUs found URLs
gau --subs tesla.com | cut -d "/" -f 3 | sort -u
</code></pre>
<ul>
<li><a href="https://github.com/nsonaniya2010/SubDomainizer"><strong>SubDomainizer</strong></a> <strong>&amp;</strong> <a href="https://github.com/Cillian-Collins/subscraper"><strong>subscraper</strong></a>：它们在网上抓取JS文件并从中提取子域名。</li>
</ul>
<pre><code class="language-bash"># Get only subdomains from SubDomainizer
python3 SubDomainizer.py -u https://tesla.com | grep tesla.com

# Get only subdomains from subscraper, this already perform recursion over the found results
python subscraper.py -u tesla.com | grep tesla.com | cut -d " " -f
</code></pre>
<ul>
<li><a href="https://www.shodan.io/"><strong>Shodan</strong></a></li>
</ul>
<pre><code class="language-bash"># Get info about the domain
shodan domain &lt;domain&gt;
# Get other pages with links to subdomains
shodan search "http.html:help.domain.com"
</code></pre>
<ul>
<li><a href="https://github.com/christophetd/censys-subdomain-finder"><strong>Censys 子域名查找器</strong></a></li>
</ul>
<pre><code class="language-bash">export CENSYS_API_ID=...
export CENSYS_API_SECRET=...
python3 censys-subdomain-finder.py tesla.com
</code></pre>
<ul>
<li><a href="https://github.com/gatete/DomainTrail"><strong>DomainTrail.py</strong></a></li>
</ul>
<pre><code class="language-bash">python3 DomainTrail.py -d example.com
</code></pre>
<ul>
<li><a href="https://securitytrails.com/"><strong>securitytrails.com</strong></a> 提供免费的 API 用于搜索子域名和 IP 历史</li>
<li><a href="https://chaos.projectdiscovery.io/#/"><strong>chaos.projectdiscovery.io</strong></a></li>
</ul>
<p>该项目<strong>免费提供与漏洞赏金计划相关的所有子域名</strong>。您还可以使用 <a href="https://github.com/dr-0x0x/chaospy">chaospy</a> 访问这些数据，甚至可以访问该项目使用的范围 <a href="https://github.com/projectdiscovery/chaos-public-program-list">https://github.com/projectdiscovery/chaos-public-program-list</a></p>
<p>您可以在这里找到许多这些工具的<strong>比较</strong>: <a href="https://blog.blacklanternsecurity.com/p/subdomain-enumeration-tool-face-off">https://blog.blacklanternsecurity.com/p/subdomain-enumeration-tool-face-off</a></p>
<h3 id="dns-暴力破解"><a class="header" href="#dns-暴力破解"><strong>DNS 暴力破解</strong></a></h3>
<p>让我们尝试通过暴力破解 DNS 服务器来查找新的<strong>子域名</strong>，使用可能的子域名名称。</p>
<p>为此操作，您需要一些<strong>常见的子域名词汇表，如</strong>:</p>
<ul>
<li><a href="https://gist.github.com/jhaddix/86a06c5dc309d08580a018c66354a056">https://gist.github.com/jhaddix/86a06c5dc309d08580a018c66354a056</a></li>
<li><a href="https://wordlists-cdn.assetnote.io/data/manual/best-dns-wordlist.txt">https://wordlists-cdn.assetnote.io/data/manual/best-dns-wordlist.txt</a></li>
<li><a href="https://localdomain.pw/subdomain-bruteforce-list/all.txt.zip">https://localdomain.pw/subdomain-bruteforce-list/all.txt.zip</a></li>
<li><a href="https://github.com/pentester-io/commonspeak">https://github.com/pentester-io/commonspeak</a></li>
<li><a href="https://github.com/danielmiessler/SecLists/tree/master/Discovery/DNS">https://github.com/danielmiessler/SecLists/tree/master/Discovery/DNS</a></li>
</ul>
<p>还需要一些好的 DNS 解析器的 IP。为了生成可信 DNS 解析器的列表，您可以从 <a href="https://public-dns.info/nameservers-all.txt">https://public-dns.info/nameservers-all.txt</a> 下载解析器，并使用 <a href="https://github.com/vortexau/dnsvalidator"><strong>dnsvalidator</strong></a> 进行过滤。或者您可以使用: <a href="https://raw.githubusercontent.com/trickest/resolvers/main/resolvers-trusted.txt">https://raw.githubusercontent.com/trickest/resolvers/main/resolvers-trusted.txt</a></p>
<p>最推荐的 DNS 暴力破解工具是:</p>
<ul>
<li><a href="https://github.com/blechschmidt/massdns"><strong>massdns</strong></a>: 这是第一个执行有效 DNS 暴力破解的工具。它非常快速，但容易产生误报。</li>
</ul>
<pre><code class="language-bash">sed 's/$/.domain.com/' subdomains.txt &gt; bf-subdomains.txt
./massdns -r resolvers.txt -w /tmp/results.txt bf-subdomains.txt
grep -E "tesla.com. [0-9]+ IN A .+" /tmp/results.txt
</code></pre>
<ul>
<li><a href="https://github.com/OJ/gobuster"><strong>gobuster</strong></a>: 我认为这个只使用了一个解析器</li>
</ul>
<pre><code>gobuster dns -d mysite.com -t 50 -w subdomains.txt
</code></pre>
<ul>
<li><a href="https://github.com/projectdiscovery/shuffledns"><strong>shuffledns</strong></a> 是一个围绕 <code>massdns</code> 的封装，使用 Go 编写，允许您通过主动暴力破解枚举有效的子域名，并支持通配符处理和简单的输入输出。</li>
</ul>
<pre><code>shuffledns -d example.com -list example-subdomains.txt -r resolvers.txt
</code></pre>
<ul>
<li><a href="https://github.com/d3mondev/puredns"><strong>puredns</strong></a>：它也使用 <code>massdns</code>。</li>
</ul>
<pre><code>puredns bruteforce all.txt domain.com
</code></pre>
<ul>
<li><a href="https://github.com/blark/aiodnsbrute"><strong>aiodnsbrute</strong></a> 使用 asyncio 异步暴力破解域名。</li>
</ul>
<pre><code>aiodnsbrute -r resolvers -w wordlist.txt -vv -t 1024 domain.com
</code></pre>
<h3 id="第二轮-dns-暴力破解"><a class="header" href="#第二轮-dns-暴力破解">第二轮 DNS 暴力破解</a></h3>
<p>在使用开放源和暴力破解找到子域名后，您可以生成找到的子域名的变体，以尝试找到更多。以下工具对此目的非常有用：</p>
<ul>
<li><a href="https://github.com/ProjectAnte/dnsgen"><strong>dnsgen</strong></a><strong>:</strong> 给定域名和子域名生成排列。</li>
</ul>
<pre><code class="language-bash">cat subdomains.txt | dnsgen -
</code></pre>
<ul>
<li><a href="https://github.com/subfinder/goaltdns"><strong>goaltdns</strong></a>: 给定域名和子域名生成排列。</li>
<li>你可以在 <a href="https://github.com/subfinder/goaltdns/blob/master/words.txt"><strong>这里</strong></a> 获取 goaltdns 排列 <strong>字典</strong>。</li>
</ul>
<pre><code class="language-bash">goaltdns -l subdomains.txt -w /tmp/words-permutations.txt -o /tmp/final-words-s3.txt
</code></pre>
<ul>
<li><a href="https://github.com/Josue87/gotator"><strong>gotator</strong></a><strong>:</strong> 给定域名和子域名生成排列。如果没有指示排列文件，gotator 将使用自己的文件。</li>
</ul>
<pre><code>gotator -sub subdomains.txt -silent [-perm /tmp/words-permutations.txt]
</code></pre>
<ul>
<li><a href="https://github.com/infosec-au/altdns"><strong>altdns</strong></a>: 除了生成子域名排列，它还可以尝试解析它们（但最好使用之前提到的工具）。</li>
<li>你可以在 <a href="https://github.com/infosec-au/altdns/blob/master/words.txt"><strong>这里</strong></a> 获取 altdns 排列的 <strong>wordlist</strong>。</li>
</ul>
<pre><code>altdns -i subdomains.txt -w /tmp/words-permutations.txt -o /tmp/asd3
</code></pre>
<ul>
<li><a href="https://github.com/bp0lr/dmut"><strong>dmut</strong></a>: 另一个用于执行子域名的排列、变异和修改的工具。该工具将对结果进行暴力破解（不支持 DNS 通配符）。</li>
<li>你可以在 <a href="https://raw.githubusercontent.com/bp0lr/dmut/main/words.txt"><strong>这里</strong></a> 获取 dmut 排列词表。</li>
</ul>
<pre><code class="language-bash">cat subdomains.txt | dmut -d /tmp/words-permutations.txt -w 100 \
--dns-errorLimit 10 --use-pb --verbose -s /tmp/resolvers-trusted.txt
</code></pre>
<ul>
<li><a href="https://github.com/projectdiscovery/alterx"><strong>alterx</strong></a><strong>:</strong> 基于域名，它 <strong>生成新的潜在子域名</strong>，根据指示的模式尝试发现更多子域名。</li>
</ul>
<h4 id="智能排列生成"><a class="header" href="#智能排列生成">智能排列生成</a></h4>
<ul>
<li><a href="https://github.com/cramppet/regulator"><strong>regulator</strong></a>: 更多信息请阅读这篇 <a href="https://cramppet.github.io/regulator/index.html"><strong>文章</strong></a>，但它基本上会从 <strong>发现的子域名</strong> 中提取 <strong>主要部分</strong> 并进行混合，以找到更多子域名。</li>
</ul>
<pre><code class="language-bash">python3 main.py adobe.com adobe adobe.rules
make_brute_list.sh adobe.rules adobe.brute
puredns resolve adobe.brute --write adobe.valid
</code></pre>
<ul>
<li><a href="https://github.com/elceef/subzuf"><strong>subzuf</strong></a><strong>:</strong> <em>subzuf</em> 是一个子域名暴力破解模糊器，结合了一个极其简单但有效的DNS响应引导算法。它利用提供的一组输入数据，如定制的单词列表或历史DNS/TLS记录，准确合成更多相应的域名，并根据在DNS扫描过程中收集的信息进一步扩展它们。</li>
</ul>
<pre><code>echo www | subzuf facebook.com
</code></pre>
<h3 id="子域发现工作流程"><a class="header" href="#子域发现工作流程"><strong>子域发现工作流程</strong></a></h3>
<p>查看我写的这篇博客文章，关于如何使用 <strong>Trickest workflows</strong> <strong>自动化子域发现</strong>，这样我就不需要在我的电脑上手动启动一堆工具：</p>
<p>{% embed url="https://trickest.com/blog/full-subdomain-discovery-using-workflow/" %}</p>
<p>{% embed url="https://trickest.com/blog/full-subdomain-brute-force-discovery-using-workflow/" %}</p>
<h3 id="虚拟主机--vhosts"><a class="header" href="#虚拟主机--vhosts"><strong>虚拟主机 / VHosts</strong></a></h3>
<p>如果你发现一个IP地址包含属于子域的 <strong>一个或多个网页</strong>，你可以尝试通过在 <strong>OSINT来源</strong> 中查找该IP下的域名，或者通过 <strong>暴力破解该IP中的VHost域名</strong> 来 <strong>寻找其他子域</strong>。</p>
<h4 id="osint-1"><a class="header" href="#osint-1">OSINT</a></h4>
<p>你可以使用 <a href="https://github.com/SpiderLabs/HostHunter"><strong>HostHunter</strong></a> <strong>或其他API</strong> 在IP中找到一些 <strong>VHosts</strong>。</p>
<p><strong>暴力破解</strong></p>
<p>如果你怀疑某个子域可能隐藏在一个web服务器中，你可以尝试进行暴力破解：</p>
<pre><code class="language-bash">ffuf -c -w /path/to/wordlist -u http://victim.com -H "Host: FUZZ.victim.com"

gobuster vhost -u https://mysite.com -t 50 -w subdomains.txt

wfuzz -c -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-20000.txt --hc 400,404,403 -H "Host: FUZZ.example.com" -u http://example.com -t 100

#From https://github.com/allyshka/vhostbrute
vhostbrute.py --url="example.com" --remoteip="10.1.1.15" --base="www.example.com" --vhosts="vhosts_full.list"

#https://github.com/codingo/VHostScan
VHostScan -t example.com
</code></pre>
<p>{% hint style="info" %}
使用此技术，您甚至可能能够访问内部/隐藏的端点。
{% endhint %}</p>
<h3 id="cors-暴力破解"><a class="header" href="#cors-暴力破解"><strong>CORS 暴力破解</strong></a></h3>
<p>有时您会发现页面仅在有效的域/子域设置在 <em><strong>Origin</strong></em> 头时返回头部 <em><strong>Access-Control-Allow-Origin</strong></em>。在这些情况下，您可以利用这种行为来 <strong>发现</strong> 新的 <strong>子域</strong>。</p>
<pre><code class="language-bash">ffuf -w subdomains-top1million-5000.txt -u http://10.10.10.208 -H 'Origin: http://FUZZ.crossfit.htb' -mr "Access-Control-Allow-Origin" -ignore-body
</code></pre>
<h3 id="buckets-brute-force"><a class="header" href="#buckets-brute-force"><strong>Buckets Brute Force</strong></a></h3>
<p>在寻找 <strong>subdomains</strong> 时，注意是否指向任何类型的 <strong>bucket</strong>，在这种情况下 <a href="../../network-services-pentesting/pentesting-web/buckets/"><strong>检查权限</strong></a><strong>.</strong><br />
此外，既然你已经知道了所有在范围内的域名，尝试 <a href="../../network-services-pentesting/pentesting-web/buckets/"><strong>暴力破解可能的 bucket 名称并检查权限</strong></a>。</p>
<h3 id="monitorization"><a class="header" href="#monitorization"><strong>Monitorization</strong></a></h3>
<p>你可以通过监控 <strong>证书透明度</strong> 日志来 <strong>监控</strong> 是否创建了域的新 <strong>subdomains</strong>，<a href="https://github.com/yassineaboukir/sublert/blob/master/sublert.py"><strong>sublert</strong></a> 可以做到这一点。</p>
<h3 id="looking-for-vulnerabilities-1"><a class="header" href="#looking-for-vulnerabilities-1"><strong>Looking for vulnerabilities</strong></a></h3>
<p>检查可能的 <a href="../../pentesting-web/domain-subdomain-takeover.html#subdomain-takeover"><strong>subdomain 接管</strong></a>。<br />
如果 <strong>subdomain</strong> 指向某个 <strong>S3 bucket</strong>，<a href="../../network-services-pentesting/pentesting-web/buckets/"><strong>检查权限</strong></a>。</p>
<p>如果你发现任何 <strong>subdomain 的 IP 与你在资产发现中找到的不同</strong>，你应该进行 <strong>基本漏洞扫描</strong>（使用 Nessus 或 OpenVAS）和一些 <a href="../pentesting-network/#discovering-hosts-from-the-outside"><strong>端口扫描</strong></a> 使用 <strong>nmap/masscan/shodan</strong>。根据运行的服务，你可以在 <strong>这本书中找到一些“攻击”它们的技巧</strong>。<br />
&amp;#xNAN;<em>Note 有时 subdomain 托管在不受客户控制的 IP 内，因此不在范围内，请小心。</em></p>
<h2 id="ips"><a class="header" href="#ips">IPs</a></h2>
<p>在初始步骤中，你可能已经 <strong>找到了一些 IP 范围、域名和 subdomains</strong>。<br />
现在是 <strong>收集这些范围内的所有 IP</strong> 和 **域名/subdomains（DNS 查询）**的时候。</p>
<p>使用以下 <strong>免费 API</strong> 的服务，你还可以找到 <strong>域名和 subdomains 之前使用的 IP</strong>。这些 IP 可能仍然归客户所有（并可能让你找到 <a href="../../network-services-pentesting/pentesting-web/uncovering-cloudflare.html"><strong>CloudFlare 绕过</strong></a>）</p>
<ul>
<li><a href="https://securitytrails.com/"><strong>https://securitytrails.com/</strong></a></li>
</ul>
<p>你还可以使用工具 <a href="https://github.com/hakluke/hakip2host"><strong>hakip2host</strong></a> 检查指向特定 IP 地址的域名。</p>
<h3 id="looking-for-vulnerabilities-2"><a class="header" href="#looking-for-vulnerabilities-2"><strong>Looking for vulnerabilities</strong></a></h3>
<p><strong>对所有不属于 CDN 的 IP 进行端口扫描</strong>（因为你很可能不会在这里找到任何有趣的东西）。在发现的运行服务中，你可能 <strong>能够找到漏洞</strong>。</p>
<p><strong>查找一个</strong> <a href="../pentesting-network/"><strong>指南</strong></a> <strong>关于如何扫描主机。</strong></p>
<h2 id="web-servers-hunting"><a class="header" href="#web-servers-hunting">Web servers hunting</a></h2>
<blockquote>
<p>我们已经找到了所有公司及其资产，并且知道范围内的 IP 范围、域名和 subdomains。现在是搜索 web 服务器的时候。</p>
</blockquote>
<p>在之前的步骤中，你可能已经对发现的 <strong>IPs 和域名进行了某些侦查</strong>，所以你可能 <strong>已经找到了所有可能的 web 服务器</strong>。然而，如果你还没有，我们现在将看到一些 <strong>快速技巧来搜索范围内的 web 服务器</strong>。</p>
<p>请注意，这将是 <strong>面向 web 应用程序发现</strong>，因此你也应该 <strong>进行漏洞</strong> 和 <strong>端口扫描</strong>（<strong>如果范围允许</strong>）。</p>
<p>一种 <strong>快速方法</strong> 是使用 <a href="../pentesting-network/#http-port-discovery"><strong>masscan</strong></a> 来发现与 <strong>web</strong> 服务器相关的 <strong>开放端口</strong>。<br />
另一个友好的工具来查找 web 服务器是 <a href="https://github.com/tomnomnom/httprobe"><strong>httprobe</strong></a><strong>,</strong> <a href="https://github.com/theblackturtle/fprobe"><strong>fprobe</strong></a> 和 <a href="https://github.com/projectdiscovery/httpx"><strong>httpx</strong></a>。你只需传递一个域名列表，它将尝试连接到 80（http）和 443（https）端口。此外，你可以指示尝试其他端口：</p>
<pre><code class="language-bash">cat /tmp/domains.txt | httprobe #Test all domains inside the file for port 80 and 443
cat /tmp/domains.txt | httprobe -p http:8080 -p https:8443 #Check port 80, 443 and 8080 and 8443
</code></pre>
<h3 id="截图"><a class="header" href="#截图"><strong>截图</strong></a></h3>
<p>现在您已经发现了范围内的<strong>所有网络服务器</strong>（在公司的<strong>IP</strong>和所有<strong>域名</strong>及<strong>子域名</strong>中），您可能<strong>不知道从哪里开始</strong>。所以，让我们简单一点，先对它们进行截图。仅通过<strong>查看****主页</strong>，您就可以找到更<strong>容易</strong>被<strong>利用</strong>的<strong>奇怪</strong>端点。</p>
<p>要执行所提议的想法，您可以使用 <a href="https://github.com/FortyNorthSecurity/EyeWitness"><strong>EyeWitness</strong></a>、<a href="https://github.com/breenmachine/httpscreenshot"><strong>HttpScreenshot</strong></a>、<a href="https://github.com/michenriksen/aquatone"><strong>Aquatone</strong></a>、<a href="https://shutter-project.org/downloads/third-party-packages/"><strong>Shutter</strong></a>、<a href="https://github.com/sensepost/gowitness"><strong>Gowitness</strong></a> 或 <a href="https://github.com/maaaaz/webscreenshot"><strong>webscreenshot</strong></a><strong>.</strong></p>
<p>此外，您还可以使用 <a href="https://github.com/BishopFox/eyeballer"><strong>eyeballer</strong></a> 来分析所有的<strong>截图</strong>，告诉您<strong>哪些可能包含漏洞</strong>，哪些则不包含。</p>
<h2 id="公有云资产"><a class="header" href="#公有云资产">公有云资产</a></h2>
<p>为了找到属于公司的潜在云资产，您应该<strong>从一份识别该公司的关键词列表开始</strong>。例如，对于一家加密公司，您可以使用以下词汇：“<code>crypto</code>”、“<code>wallet</code>”、“<code>dao</code>”、“<code>&lt;domain_name&gt;</code>”、“<code>&lt;subdomain_names&gt;</code>”。</p>
<p>您还需要常用的<strong>桶</strong>中使用的单词列表：</p>
<ul>
<li><a href="https://raw.githubusercontent.com/cujanovic/goaltdns/master/words.txt">https://raw.githubusercontent.com/cujanovic/goaltdns/master/words.txt</a></li>
<li><a href="https://raw.githubusercontent.com/infosec-au/altdns/master/words.txt">https://raw.githubusercontent.com/infosec-au/altdns/master/words.txt</a></li>
<li><a href="https://raw.githubusercontent.com/jordanpotti/AWSBucketDump/master/BucketNames.txt">https://raw.githubusercontent.com/jordanpotti/AWSBucketDump/master/BucketNames.txt</a></li>
</ul>
<p>然后，使用这些单词生成<strong>排列</strong>（有关更多信息，请查看 <a href="./#second-dns-bruteforce-round"><strong>第二轮DNS暴力破解</strong></a>）。</p>
<p>使用生成的单词列表，您可以使用工具，如 <a href="https://github.com/initstring/cloud_enum"><strong>cloud_enum</strong></a><strong>,</strong> <a href="https://github.com/jordanpotti/CloudScraper"><strong>CloudScraper</strong></a><strong>,</strong> <a href="https://github.com/projectdiscovery/cloudlist"><strong>cloudlist</strong></a> <strong>或</strong> <a href="https://github.com/sa7mon/S3Scanner"><strong>S3Scanner</strong></a><strong>.</strong></p>
<p>请记住，在寻找云资产时，您应该<strong>寻找的不仅仅是AWS中的桶</strong>。</p>
<h3 id="寻找漏洞-1"><a class="header" href="#寻找漏洞-1"><strong>寻找漏洞</strong></a></h3>
<p>如果您发现<strong>开放的桶或暴露的云函数</strong>，您应该<strong>访问它们</strong>，看看它们提供了什么，以及您是否可以利用它们。</p>
<h2 id="电子邮件"><a class="header" href="#电子邮件">电子邮件</a></h2>
<p>通过范围内的<strong>域名</strong>和<strong>子域名</strong>，您基本上拥有了<strong>开始搜索电子邮件</strong>所需的所有信息。这些是我找到公司电子邮件时效果最好的<strong>API</strong>和<strong>工具</strong>：</p>
<ul>
<li><a href="https://github.com/laramies/theHarvester"><strong>theHarvester</strong></a> - 使用API</li>
<li><a href="https://hunter.io/"><strong>https://hunter.io/</strong></a> 的API（免费版）</li>
<li><a href="https://app.snov.io/"><strong>https://app.snov.io/</strong></a> 的API（免费版）</li>
<li><a href="https://minelead.io/"><strong>https://minelead.io/</strong></a> 的API（免费版）</li>
</ul>
<h3 id="寻找漏洞-2"><a class="header" href="#寻找漏洞-2"><strong>寻找漏洞</strong></a></h3>
<p>电子邮件在后续将对<strong>暴力破解网络登录和身份验证服务</strong>（如SSH）非常有用。此外，它们在<strong>钓鱼</strong>中也是必需的。此外，这些API还会提供有关电子邮件背后<strong>个人</strong>的更多<strong>信息</strong>，这对钓鱼活动非常有用。</p>
<h2 id="凭证泄露"><a class="header" href="#凭证泄露">凭证泄露</a></h2>
<p>通过<strong>域名</strong>、<strong>子域名</strong>和<strong>电子邮件</strong>，您可以开始寻找过去泄露的与这些电子邮件相关的凭证：</p>
<ul>
<li><a href="https://leak-lookup.com/account/login">https://leak-lookup.com</a></li>
<li><a href="https://www.dehashed.com/">https://www.dehashed.com/</a></li>
</ul>
<h3 id="寻找漏洞-3"><a class="header" href="#寻找漏洞-3"><strong>寻找漏洞</strong></a></h3>
<p>如果您发现<strong>有效的泄露</strong>凭证，这将是一个非常简单的胜利。</p>
<h2 id="秘密泄露"><a class="header" href="#秘密泄露">秘密泄露</a></h2>
<p>凭证泄露与公司被黑客攻击时<strong>敏感信息被泄露和出售</strong>有关。然而，公司可能还会受到<strong>其他泄露</strong>的影响，这些信息不在那些数据库中：</p>
<h3 id="github泄露"><a class="header" href="#github泄露">Github泄露</a></h3>
<p>凭证和API可能在<strong>公司</strong>或在该github公司工作的<strong>用户</strong>的<strong>公共仓库</strong>中泄露。<br />
您可以使用<strong>工具</strong> <a href="https://github.com/carlospolop/Leakos"><strong>Leakos</strong></a> 来<strong>下载</strong>一个<strong>组织</strong>及其<strong>开发者</strong>的所有<strong>公共仓库</strong>，并自动运行 <a href="https://github.com/zricethezav/gitleaks"><strong>gitleaks</strong></a>。</p>
<p><strong>Leakos</strong> 也可以用于对所有提供的<strong>URL</strong>进行<strong>gitleaks</strong>扫描，因为有时<strong>网页中也包含秘密</strong>。</p>
<h4 id="github-dorks"><a class="header" href="#github-dorks">Github Dorks</a></h4>
<p>还可以查看此<strong>页面</strong>，寻找您可以在攻击的组织中搜索的潜在<strong>github dorks</strong>：</p>
<p>{% content-ref url="github-leaked-secrets.md" %}
<a href="github-leaked-secrets.html">github-leaked-secrets.md</a>
{% endcontent-ref %}</p>
<h3 id="paste泄露"><a class="header" href="#paste泄露">Paste泄露</a></h3>
<p>有时攻击者或员工会在<strong>粘贴网站</strong>上<strong>发布公司内容</strong>。这可能包含或不包含<strong>敏感信息</strong>，但搜索它非常有趣。<br />
您可以使用工具 <a href="https://github.com/carlospolop/Pastos"><strong>Pastos</strong></a> 在80多个粘贴网站上同时搜索。</p>
<h3 id="google-dorks"><a class="header" href="#google-dorks">Google Dorks</a></h3>
<p>老而金贵的google dorks始终对查找<strong>不应存在的暴露信息</strong>非常有用。唯一的问题是 <a href="https://www.exploit-db.com/google-hacking-database"><strong>google-hacking-database</strong></a> 包含数千个您无法手动运行的可能查询。因此，您可以选择您最喜欢的10个，或者使用<strong>工具，如</strong> <a href="https://github.com/carlospolop/Gorks"><strong>Gorks</strong></a> <strong>来运行它们</strong>。</p>
<p><em>请注意，期望使用常规Google浏览器运行所有数据库的工具将永远无法完成，因为Google会很快阻止您。</em></p>
<h3 id="寻找漏洞-4"><a class="header" href="#寻找漏洞-4"><strong>寻找漏洞</strong></a></h3>
<p>如果您发现<strong>有效的泄露</strong>凭证或API令牌，这将是一个非常简单的胜利。</p>
<h2 id="公共代码漏洞"><a class="header" href="#公共代码漏洞">公共代码漏洞</a></h2>
<p>如果您发现公司有<strong>开源代码</strong>，您可以<strong>分析</strong>它并搜索其上的<strong>漏洞</strong>。</p>
<p><strong>根据语言</strong>的不同，您可以使用不同的<strong>工具</strong>：</p>
<p>{% content-ref url="../../network-services-pentesting/pentesting-web/code-review-tools.md" %}
<a href="../../network-services-pentesting/pentesting-web/code-review-tools.html">code-review-tools.md</a>
{% endcontent-ref %}</p>
<p>还有一些免费服务允许您<strong>扫描公共仓库</strong>，例如：</p>
<ul>
<li><a href="https://app.snyk.io/"><strong>Snyk</strong></a></li>
</ul>
<h2 id="网络渗透测试方法"><a class="header" href="#网络渗透测试方法"><a href="../../network-services-pentesting/pentesting-web/"><strong>网络渗透测试方法</strong></a></a></h2>
<p><strong>大多数漏洞</strong>都是由漏洞猎人发现的，存在于<strong>网络应用程序</strong>中，因此在这一点上，我想谈谈<strong>网络应用程序测试方法</strong>，您可以在 <a href="../../network-services-pentesting/pentesting-web/"><strong>这里找到此信息</strong></a>。</p>
<p>我还想特别提到 <a href="../../network-services-pentesting/pentesting-web/#automatic-scanners"><strong>Web自动扫描器开源工具</strong></a> 部分，因为如果您不应该期望它们找到非常敏感的漏洞，但它们在<strong>工作流程中实现一些初步网络信息</strong>时非常有用。</p>
<h2 id="综述"><a class="header" href="#综述">综述</a></h2>
<blockquote>
<p>恭喜！到目前为止，您已经完成了<strong>所有基本枚举</strong>。是的，这很基础，因为可以进行更多的枚举（稍后会看到更多技巧）。</p>
</blockquote>
<p>所以您已经：</p>
<ol>
<li>找到范围内的<strong>所有公司</strong></li>
<li>找到属于公司的<strong>所有资产</strong>（并在范围内进行一些漏洞扫描）</li>
<li>找到属于公司的<strong>所有域名</strong></li>
<li>找到域名的<strong>所有子域名</strong>（是否有子域名接管？）</li>
<li>找到范围内的<strong>所有IP</strong>（来自和<strong>不来自CDN</strong>的IP）。</li>
<li>找到所有的<strong>网络服务器</strong>并对它们进行了<strong>截图</strong>（是否有任何奇怪的地方值得深入研究？）</li>
<li>找到属于公司的<strong>所有潜在公共云资产</strong>。</li>
<li><strong>电子邮件</strong>、<strong>凭证泄露</strong>和<strong>秘密泄露</strong>，可能会给您带来<strong>非常轻松的重大胜利</strong>。</li>
<li><strong>渗透测试您找到的所有网站</strong></li>
</ol>
<h2 id="全面侦查自动工具"><a class="header" href="#全面侦查自动工具"><strong>全面侦查自动工具</strong></a></h2>
<p>有几种工具可以执行针对给定范围的部分提议操作。</p>
<ul>
<li><a href="https://github.com/yogeshojha/rengine"><strong>https://github.com/yogeshojha/rengine</strong></a></li>
<li><a href="https://github.com/j3ssie/Osmedeus"><strong>https://github.com/j3ssie/Osmedeus</strong></a></li>
<li><a href="https://github.com/six2dez/reconftw"><strong>https://github.com/six2dez/reconftw</strong></a></li>
<li><a href="https://github.com/hackerspider1/EchoPwn"><strong>https://github.com/hackerspider1/EchoPwn</strong></a> - 有点旧且未更新</li>
</ul>
<h2 id="参考文献"><a class="header" href="#参考文献"><strong>参考文献</strong></a></h2>
<ul>
<li>所有免费的 <a href="https://twitter.com/Jhaddix"><strong>@Jhaddix</strong></a> 课程，如 <a href="https://www.youtube.com/watch?v=p4JgIu1mceI"><strong>漏洞猎人的方法论 v4.0 - 侦查版</strong></a></li>
</ul>
<figure><img src="../../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>
<p>如果您对<strong>黑客职业</strong>感兴趣并想要攻克不可攻克的目标 - <strong>我们正在招聘！</strong>（<em>要求流利的波兰语书写和口语</em>）。</p>
<p>{% embed url="https://www.stmcyber.com/careers" %}</p>
<p>{% hint style="success" %}
学习和实践AWS黑客攻击：<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks培训AWS红队专家（ARTE）</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习和实践GCP黑客攻击： <img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks培训GCP红队专家（GRTE）</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord群组</strong></a> 或 <a href="https://t.me/peass"><strong>电报群组</strong></a> 或 <strong>在Twitter上关注</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github仓库提交PR来分享黑客技巧。</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../generic-methodologies-and-resources/pentesting-methodology.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../generic-methodologies-and-resources/external-recon-methodology/wide-source-code-search.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../generic-methodologies-and-resources/pentesting-methodology.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../generic-methodologies-and-resources/external-recon-methodology/wide-source-code-search.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
