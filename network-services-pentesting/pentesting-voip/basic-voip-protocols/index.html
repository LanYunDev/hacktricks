<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Basic VoIP Protocols</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="基本-voip-协议"><a class="header" href="#基本-voip-协议">基本 VoIP 协议</a></h1>
<p>{% hint style="success" %}
学习与实践 AWS 黑客技术：<img src="/.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="/.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习与实践 GCP 黑客技术：<img src="/.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="/.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>Telegram 群组</strong></a> 或 <strong>关注</strong> 我们的 <strong>Twitter</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub 仓库提交 PR 分享黑客技巧。</li>
</ul>
</details>
{% endhint %}
{% endhint %}
<h2 id="信令协议"><a class="header" href="#信令协议">信令协议</a></h2>
<h3 id="sip-会话发起协议"><a class="header" href="#sip-会话发起协议">SIP (会话发起协议)</a></h3>
<p>这是行业标准，更多信息请查看：</p>
<p>{% content-ref url="sip-session-initiation-protocol.md" %}
<a href="sip-session-initiation-protocol.html">sip-session-initiation-protocol.md</a>
{% endcontent-ref %}</p>
<h3 id="mgcp-媒体网关控制协议"><a class="header" href="#mgcp-媒体网关控制协议">MGCP (媒体网关控制协议)</a></h3>
<p>MGCP (媒体网关控制协议) 是一个 <strong>信令</strong> 和 <strong>呼叫</strong> <strong>控制协议</strong>，在 RFC 3435 中进行了概述。它在集中式架构中运行，主要由三个组件组成：</p>
<ol>
<li><strong>呼叫代理或媒体网关控制器 (MGC)</strong>：MGCP 架构中的主网关，负责 <strong>管理和控制媒体网关</strong>。它处理呼叫的建立、修改和终止过程。MGC 使用 MGCP 协议与媒体网关进行通信。</li>
<li><strong>媒体网关 (MGs) 或从属网关</strong>：这些设备 <strong>在不同网络之间转换数字媒体流</strong>，例如传统的电路交换电话和分组交换 IP 网络。它们由 MGC 管理，并执行从 MGC 接收到的命令。媒体网关可能包括转码、分组和回声消除等功能。</li>
<li><strong>信令网关 (SGs)</strong>：这些网关负责 <strong>在不同网络之间转换信令消息</strong>，使传统电话系统（例如 SS7）与基于 IP 的网络（例如 SIP 或 H.323）之间能够无缝通信。信令网关对于互操作性至关重要，确保呼叫控制信息在不同网络之间正确传达。</li>
</ol>
<p>总之，MGCP 将呼叫控制逻辑集中在呼叫代理中，简化了媒体和信令网关的管理，提高了电信网络的可扩展性、可靠性和效率。</p>
<h3 id="sccp-瘦客户端控制协议"><a class="header" href="#sccp-瘦客户端控制协议">SCCP (瘦客户端控制协议)</a></h3>
<p>瘦客户端控制协议 (SCCP) 是一个 <strong>专有的信令和呼叫控制协议</strong>，由思科系统公司拥有。它主要 <strong>用于</strong> 在 <strong>思科统一通信管理器</strong>（前称 CallManager）与思科 IP 电话或其他思科语音和视频终端之间的通信。</p>
<p>SCCP 是一个轻量级协议，简化了呼叫控制服务器与终端设备之间的通信。由于其简约的设计和相较于其他 VoIP 协议（如 H.323 或 SIP）减少的带宽需求，因此被称为“瘦”。</p>
<p>基于 SCCP 的系统的主要组件包括：</p>
<ol>
<li><strong>呼叫控制服务器</strong>：该服务器，通常是思科统一通信管理器，管理呼叫的建立、修改和终止过程，以及其他电话功能，如呼叫转移、呼叫转接和呼叫保持。</li>
<li><strong>SCCP 终端</strong>：这些设备如 IP 电话、视频会议单元或其他思科语音和视频终端，使用 SCCP 与呼叫控制服务器进行通信。它们向服务器注册，发送和接收信令消息，并遵循呼叫控制服务器提供的呼叫处理指令。</li>
<li><strong>网关</strong>：这些设备，如语音网关或媒体网关，负责在不同网络之间转换媒体流，例如传统的电路交换电话和分组交换 IP 网络。它们还可能包括额外的功能，如转码或回声消除。</li>
</ol>
<p>SCCP 提供了一种简单高效的通信方法，连接思科呼叫控制服务器和终端设备。然而，值得注意的是 <strong>SCCP 是一个专有协议</strong>，这可能限制与非思科系统的互操作性。在这种情况下，其他标准 VoIP 协议如 SIP 可能更为合适。</p>
<h3 id="h323"><a class="header" href="#h323">H.323</a></h3>
<p>H.323 是一套用于多媒体通信的 <strong>协议</strong>，包括语音、视频和数据会议，通过分组交换网络（如基于 IP 的网络）进行。它由 <strong>国际电信联盟</strong>（ITU-T）开发，提供了管理多媒体通信会话的全面框架。</p>
<p>H.323 套件的一些关键组件包括：</p>
<ol>
<li><strong>终端</strong>：这些是支持 H.323 的端点设备，如 IP 电话、视频会议系统或软件应用程序，可以参与多媒体通信会话。</li>
<li><strong>网关</strong>：这些设备在不同网络之间转换媒体流，如传统的电路交换电话和分组交换 IP 网络，使 H.323 与其他通信系统之间能够互操作。它们还可能包括额外的功能，如转码或回声消除。</li>
<li><strong>网关控制器</strong>：这些是可选组件，在 H.323 网络中提供呼叫控制和管理服务。它们执行地址转换、带宽管理和接入控制等功能，帮助管理和优化网络资源。</li>
<li><strong>多点控制单元 (MCUs)</strong>：这些设备通过管理和混合来自多个端点的媒体流来促进多点会议。MCUs 使得视频布局控制、语音激活切换和持续存在等功能成为可能，从而能够举办大规模的多方会议。</li>
</ol>
<p>H.323 支持多种音频和视频编解码器，以及其他补充服务，如呼叫转移、呼叫转接、呼叫保持和呼叫等待。尽管在 VoIP 的早期阶段被广泛采用，H.323 已逐渐被更现代和灵活的协议如 <strong>会话发起协议 (SIP)</strong> 所取代，后者提供了更好的互操作性和更容易的实现。然而，H.323 仍在许多遗留系统中使用，并继续得到各种设备供应商的支持。</p>
<h3 id="iax-inter-asterisk-exchange"><a class="header" href="#iax-inter-asterisk-exchange">IAX (Inter Asterisk eXchange)</a></h3>
<p>IAX (Inter-Asterisk eXchange) 是一个 <strong>信令和呼叫控制协议</strong>，主要用于 Asterisk PBX（私人分支交换机）服务器与其他 VoIP 设备之间的通信。它由 Asterisk 开源 PBX 软件的创建者 Mark Spencer 开发，作为其他 VoIP 协议（如 SIP 和 H.323）的替代方案。</p>
<p>IAX 以其 <strong>简单、高效和易于实现</strong> 而闻名。IAX 的一些关键特性包括：</p>
<ol>
<li><strong>单个 UDP 端口</strong>：IAX 使用单个 UDP 端口（4569）进行信令和媒体流量，这简化了防火墙和 NAT 穿越，使其在各种网络环境中更易于部署。</li>
<li><strong>二进制协议</strong>：与基于文本的协议（如 SIP）不同，IAX 是一种二进制协议，减少了带宽消耗，使其在传输信令和媒体数据时更高效。</li>
<li><strong>中继</strong>：IAX 支持中继，允许多个呼叫合并为单个网络连接，减少开销并提高带宽利用率。</li>
<li><strong>原生加密</strong>：IAX 内置对加密的支持，使用 RSA 进行密钥交换，使用 AES 进行媒体加密，提供端点之间的安全通信。</li>
<li><strong>点对点通信</strong>：IAX 可用于端点之间的直接通信，无需中央服务器，从而实现更简单和更高效的呼叫路由。</li>
</ol>
<p>尽管 IAX 有其优点，但也存在一些局限性，例如其主要关注于 Asterisk 生态系统，与更成熟的协议（如 SIP）相比，采用程度较低。因此，IAX 可能不是与非 Asterisk 系统或设备互操作的最佳选择。然而，对于在 Asterisk 环境中工作的人来说，IAX 提供了一个强大而高效的 VoIP 通信解决方案。</p>
<h2 id="传输与传输协议"><a class="header" href="#传输与传输协议">传输与传输协议</a></h2>
<h3 id="sdp-会话描述协议"><a class="header" href="#sdp-会话描述协议">SDP (会话描述协议)</a></h3>
<p>SDP (会话描述协议) 是一种 <strong>基于文本的格式</strong>，用于描述多媒体会话的特征，如语音、视频或数据会议，通过 IP 网络进行。它由 <strong>互联网工程任务组 (IETF)</strong> 开发，并在 <strong>RFC 4566</strong> 中定义。SDP 不处理实际的媒体传输或会话建立，而是与其他信令协议（如 <strong>SIP (会话发起协议)</strong>）结合使用，以协商和交换有关媒体流及其属性的信息。</p>
<p>SDP 的一些关键元素包括：</p>
<ol>
<li><strong>会话信息</strong>：SDP 描述多媒体会话的详细信息，包括会话名称、会话描述、开始时间和结束时间。</li>
<li><strong>媒体流</strong>：SDP 定义媒体流的特征，如媒体类型（音频、视频或文本）、传输协议（例如 RTP 或 SRTP）和媒体格式（例如编解码器信息）。</li>
<li><strong>连接信息</strong>：SDP 提供有关网络地址（IP 地址）和媒体应发送或接收的端口号的信息。</li>
<li><strong>属性</strong>：SDP 支持使用属性提供有关会话或媒体流的附加可选信息。属性可用于指定各种功能，如加密密钥、带宽要求或媒体控制机制。</li>
</ol>
<p>SDP 通常在以下过程中使用：</p>
<ol>
<li>发起方创建提议的多媒体会话的 SDP 描述，包括媒体流及其属性的详细信息。</li>
<li>SDP 描述被发送给接收方，通常嵌入在信令协议消息中，如 SIP 或 RTSP。</li>
<li>接收方处理 SDP 描述，并根据其能力，可能接受、拒绝或修改提议的会话。</li>
<li>最终的 SDP 描述作为信令协议消息的一部分发送回发起方，完成协商过程。</li>
</ol>
<p>SDP 的简单性和灵活性使其成为各种通信系统中描述多媒体会话的广泛采用标准，在通过 IP 网络建立和管理实时多媒体会话中发挥着关键作用。</p>
<h3 id="rtp--rtcp--srtp--zrtp"><a class="header" href="#rtp--rtcp--srtp--zrtp">RTP / RTCP / SRTP / ZRTP</a></h3>
<ol>
<li><strong>RTP (实时传输协议)</strong>：RTP 是一种网络协议，旨在通过 IP 网络传输音频和视频数据或其他实时媒体。由 <strong>IETF</strong> 开发，并在 <strong>RFC 3550</strong> 中定义，RTP 通常与信令协议（如 SIP 和 H.323）一起使用，以实现多媒体通信。RTP 提供 <strong>同步</strong>、<strong>排序</strong> 和 <strong>时间戳</strong> 媒体流的机制，帮助确保媒体播放的流畅和及时。</li>
<li><strong>RTCP (实时传输控制协议)</strong>：RTCP 是 RTP 的伴随协议，用于监控服务质量 (QoS) 并提供有关媒体流传输的反馈。在与 RTP 相同的 <strong>RFC 3550</strong> 中定义，RTCP <strong>定期在 RTP 会话的参与者之间交换控制数据包</strong>。它共享诸如丢包、抖动和往返时间等信息，有助于诊断和适应网络条件，提高整体媒体质量。</li>
<li><strong>SRTP (安全实时传输协议)</strong>：SRTP 是 RTP 的扩展，提供 <strong>加密</strong>、<strong>消息认证</strong> 和 <strong>重放保护</strong>，确保敏感音频和视频数据的安全传输。在 <strong>RFC 3711</strong> 中定义，SRTP 使用 AES 等加密算法进行加密，使用 HMAC-SHA1 进行消息认证。SRTP 通常与安全信令协议（如通过 TLS 的 SIP）结合使用，以提供多媒体通信的端到端安全性。</li>
<li><strong>ZRTP (Zimmermann 实时传输协议)</strong>：ZRTP 是一种加密密钥协商协议，为 RTP 媒体流提供 <strong>端到端加密</strong>。由 PGP 的创建者 Phil Zimmermann 开发，ZRTP 在 <strong>RFC 6189</strong> 中进行了描述。与依赖信令协议进行密钥交换的 SRTP 不同，ZRTP 旨在独立于信令协议工作。它使用 <strong>Diffie-Hellman 密钥交换</strong> 在通信方之间建立共享秘密，而无需事先信任或公共密钥基础设施 (PKI)。ZRTP 还包括 <strong>短认证字符串 (SAS)</strong> 等功能，以防止中间人攻击。</li>
</ol>
<p>这些协议在 <strong>通过 IP 网络传递和保护实时多媒体通信</strong> 中发挥着重要作用。虽然 RTP 和 RTCP 处理实际的媒体传输和质量监控，但 SRTP 和 ZRTP 确保传输的媒体免受窃听、篡改和重放攻击的保护。</p>
<p>{% hint style="success" %}
学习与实践 AWS 黑客技术：<img src="/.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="/.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习与实践 GCP 黑客技术：<img src="/.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="/.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>Telegram 群组</strong></a> 或 <strong>关注</strong> 我们的 <strong>Twitter</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub 仓库提交 PR 分享黑客技巧。</li>
</ul>
</details>
{% endhint %}
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../network-services-pentesting/pentesting-voip/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../network-services-pentesting/pentesting-voip/basic-voip-protocols/sip-session-initiation-protocol.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../network-services-pentesting/pentesting-voip/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../network-services-pentesting/pentesting-voip/basic-voip-protocols/sip-session-initiation-protocol.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
