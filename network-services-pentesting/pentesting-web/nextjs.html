<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>NextJS</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="nextjs"><a class="header" href="#nextjs">NextJS</a></h1>
<p>{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>å…³æ³¨</strong> æˆ‘ä»¬çš„ <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<h2 id="nextjs-åº”ç”¨ç¨‹åºçš„ä¸€èˆ¬æ¶æ„"><a class="header" href="#nextjs-åº”ç”¨ç¨‹åºçš„ä¸€èˆ¬æ¶æ„">Next.js åº”ç”¨ç¨‹åºçš„ä¸€èˆ¬æ¶æ„</a></h2>
<h3 id="å…¸å‹æ–‡ä»¶ç»“æ„"><a class="header" href="#å…¸å‹æ–‡ä»¶ç»“æ„">å…¸å‹æ–‡ä»¶ç»“æ„</a></h3>
<p>ä¸€ä¸ªæ ‡å‡†çš„ Next.js é¡¹ç›®éµå¾ªç‰¹å®šçš„æ–‡ä»¶å’Œç›®å½•ç»“æ„ï¼Œä»¥ä¾¿äºå…¶è·¯ç”±ã€API ç«¯ç‚¹å’Œé™æ€èµ„äº§ç®¡ç†ç­‰åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…¸å‹çš„å¸ƒå±€ï¼š</p>
<pre><code class="language-lua">my-nextjs-app/
â”œâ”€â”€ node_modules/
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â””â”€â”€ logo.png
â”‚   â””â”€â”€ favicon.ico
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ api/
â”‚   â”‚   â””â”€â”€ hello/
â”‚   â”‚       â””â”€â”€ route.ts
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”œâ”€â”€ page.tsx
â”‚   â”œâ”€â”€ about/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ layout.tsx
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ Header.tsx
â”‚   â”‚   â””â”€â”€ Footer.tsx
â”‚   â”œâ”€â”€ styles/
â”‚   â”‚   â”œâ”€â”€ globals.css
â”‚   â”‚   â””â”€â”€ Home.module.css
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ api.ts
â”œâ”€â”€ .env.local
â”œâ”€â”€ next.config.js
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ package.json
â”œâ”€â”€ README.md
â””â”€â”€ yarn.lock / package-lock.json

</code></pre>
<h3 id="æ ¸å¿ƒç›®å½•å’Œæ–‡ä»¶"><a class="header" href="#æ ¸å¿ƒç›®å½•å’Œæ–‡ä»¶">æ ¸å¿ƒç›®å½•å’Œæ–‡ä»¶</a></h3>
<ul>
<li><strong>public/:</strong> æ‰˜ç®¡é™æ€èµ„äº§ï¼Œå¦‚å›¾åƒã€å­—ä½“å’Œå…¶ä»–æ–‡ä»¶ã€‚è¿™é‡Œçš„æ–‡ä»¶å¯ä»¥åœ¨æ ¹è·¯å¾„ (<code>/</code>) è®¿é—®ã€‚</li>
<li><strong>app/:</strong> åº”ç”¨ç¨‹åºé¡µé¢ã€å¸ƒå±€ã€ç»„ä»¶å’Œ API è·¯ç”±çš„ä¸­å¤®ç›®å½•ã€‚é‡‡ç”¨ <strong>App Router</strong> èŒƒå¼ï¼Œæ”¯æŒé«˜çº§è·¯ç”±åŠŸèƒ½å’ŒæœåŠ¡å™¨-å®¢æˆ·ç«¯ç»„ä»¶åˆ†ç¦»ã€‚</li>
<li><strong>app/layout.tsx:</strong> å®šä¹‰åº”ç”¨ç¨‹åºçš„æ ¹å¸ƒå±€ï¼ŒåŒ…è£¹æ‰€æœ‰é¡µé¢å¹¶æä¾›ä¸€è‡´çš„ UI å…ƒç´ ï¼Œå¦‚é¡µçœ‰ã€é¡µè„šå’Œå¯¼èˆªæ ã€‚</li>
<li><strong>app/page.tsx:</strong> ä½œä¸ºæ ¹è·¯ç”± <code>/</code> çš„å…¥å£ç‚¹ï¼Œæ¸²æŸ“ä¸»é¡µã€‚</li>
<li><strong>app/[route]/page.tsx:</strong> å¤„ç†é™æ€å’ŒåŠ¨æ€è·¯ç”±ã€‚<code>app/</code> ä¸­çš„æ¯ä¸ªæ–‡ä»¶å¤¹ä»£è¡¨ä¸€ä¸ªè·¯ç”±æ®µï¼Œè€Œè¿™äº›æ–‡ä»¶å¤¹ä¸­çš„ <code>page.tsx</code> å¯¹åº”äºè¯¥è·¯ç”±çš„ç»„ä»¶ã€‚</li>
<li><strong>app/api/:</strong> åŒ…å« API è·¯ç”±ï¼Œå…è®¸æ‚¨åˆ›å»ºå¤„ç† HTTP è¯·æ±‚çš„æ— æœåŠ¡å™¨å‡½æ•°ã€‚è¿™äº›è·¯ç”±æ›¿ä»£äº†ä¼ ç»Ÿçš„ <code>pages/api</code> ç›®å½•ã€‚</li>
<li><strong>app/components/:</strong> å­˜æ”¾å¯é‡ç”¨çš„ React ç»„ä»¶ï¼Œå¯ä»¥åœ¨ä¸åŒé¡µé¢å’Œå¸ƒå±€ä¸­ä½¿ç”¨ã€‚</li>
<li><strong>app/styles/:</strong> åŒ…å«å…¨å±€ CSS æ–‡ä»¶å’Œç”¨äºç»„ä»¶èŒƒå›´æ ·å¼çš„ CSS æ¨¡å—ã€‚</li>
<li><strong>app/utils/:</strong> åŒ…å«å®ç”¨å‡½æ•°ã€è¾…åŠ©æ¨¡å—å’Œå…¶ä»–å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­å…±äº«çš„é UI é€»è¾‘ã€‚</li>
<li><strong>.env.local:</strong> å­˜å‚¨ç‰¹å®šäºæœ¬åœ°å¼€å‘ç¯å¢ƒçš„ç¯å¢ƒå˜é‡ã€‚è¿™äº›å˜é‡ <strong>ä¸</strong> ä¼šæäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ã€‚</li>
<li><strong>next.config.js:</strong> è‡ªå®šä¹‰ Next.js è¡Œä¸ºï¼ŒåŒ…æ‹¬ webpack é…ç½®ã€ç¯å¢ƒå˜é‡å’Œå®‰å…¨è®¾ç½®ã€‚</li>
<li><strong>tsconfig.json:</strong> é…ç½®é¡¹ç›®çš„ TypeScript è®¾ç½®ï¼Œå¯ç”¨ç±»å‹æ£€æŸ¥å’Œå…¶ä»– TypeScript åŠŸèƒ½ã€‚</li>
<li><strong>package.json:</strong> ç®¡ç†é¡¹ç›®ä¾èµ–ã€è„šæœ¬å’Œå…ƒæ•°æ®ã€‚</li>
<li><strong>README.md:</strong> æä¾›æœ‰å…³é¡¹ç›®çš„æ–‡æ¡£å’Œä¿¡æ¯ï¼ŒåŒ…æ‹¬è®¾ç½®è¯´æ˜ã€ä½¿ç”¨æŒ‡å—å’Œå…¶ä»–ç›¸å…³ç»†èŠ‚ã€‚</li>
<li><strong>yarn.lock / package-lock.json:</strong> å°†é¡¹ç›®çš„ä¾èµ–é”å®šåˆ°ç‰¹å®šç‰ˆæœ¬ï¼Œç¡®ä¿åœ¨ä¸åŒç¯å¢ƒä¸­çš„ä¸€è‡´å®‰è£…ã€‚</li>
</ul>
<h2 id="nextjs-ä¸­çš„å®¢æˆ·ç«¯"><a class="header" href="#nextjs-ä¸­çš„å®¢æˆ·ç«¯">Next.js ä¸­çš„å®¢æˆ·ç«¯</a></h2>
<h3 id="app-ç›®å½•ä¸­çš„åŸºäºæ–‡ä»¶çš„è·¯ç”±"><a class="header" href="#app-ç›®å½•ä¸­çš„åŸºäºæ–‡ä»¶çš„è·¯ç”±"><code>app</code> ç›®å½•ä¸­çš„åŸºäºæ–‡ä»¶çš„è·¯ç”±</a></h3>
<p><code>app</code> ç›®å½•æ˜¯æœ€æ–° Next.js ç‰ˆæœ¬ä¸­è·¯ç”±çš„åŸºçŸ³ã€‚å®ƒåˆ©ç”¨æ–‡ä»¶ç³»ç»Ÿæ¥å®šä¹‰è·¯ç”±ï¼Œä½¿è·¯ç”±ç®¡ç†ç›´è§‚ä¸”å¯æ‰©å±•ã€‚</p>
<details>
<summary>å¤„ç†æ ¹è·¯å¾„ /</summary>
<p><strong>æ–‡ä»¶ç»“æ„ï¼š</strong></p>
<pre><code class="language-arduino">my-nextjs-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ public/
â”œâ”€â”€ next.config.js
â””â”€â”€ ...
</code></pre>
<p><strong>å…³é”®æ–‡ä»¶ï¼š</strong></p>
<ul>
<li><strong><code>app/page.tsx</code></strong>ï¼šå¤„ç†å¯¹æ ¹è·¯å¾„ <code>/</code> çš„è¯·æ±‚ã€‚</li>
<li><strong><code>app/layout.tsx</code></strong>ï¼šå®šä¹‰åº”ç”¨ç¨‹åºçš„å¸ƒå±€ï¼ŒåŒ…è£¹æ‰€æœ‰é¡µé¢ã€‚</li>
</ul>
<p><strong>å®ç°ï¼š</strong></p>
<pre><code class="language-tsx">tsxCopy code// app/page.tsx

export default function HomePage() {
return (
&lt;div&gt;
&lt;h1&gt;Welcome to the Home Page!&lt;/h1&gt;
&lt;p&gt;This is the root route.&lt;/p&gt;
&lt;/div&gt;
);
}
</code></pre>
<p><strong>è§£é‡Šï¼š</strong></p>
<ul>
<li><strong>è·¯ç”±å®šä¹‰ï¼š</strong> <code>app</code> ç›®å½•ä¸‹çš„ <code>page.tsx</code> æ–‡ä»¶å¯¹åº”äº <code>/</code> è·¯ç”±ã€‚</li>
<li><strong>æ¸²æŸ“ï¼š</strong> è¯¥ç»„ä»¶æ¸²æŸ“ä¸»é¡µçš„å†…å®¹ã€‚</li>
<li><strong>å¸ƒå±€é›†æˆï¼š</strong> <code>HomePage</code> ç»„ä»¶è¢« <code>layout.tsx</code> åŒ…è£¹ï¼Œå¯ä»¥åŒ…å«å¤´éƒ¨ã€åº•éƒ¨å’Œå…¶ä»–å…¬å…±å…ƒç´ ã€‚</li>
</ul>
</details>
<details>
<summary>å¤„ç†å…¶ä»–é™æ€è·¯å¾„</summary>
<p><strong>ç¤ºä¾‹ï¼š<code>/about</code> è·¯ç”±</strong></p>
<p><strong>æ–‡ä»¶ç»“æ„ï¼š</strong></p>
<pre><code class="language-arduino">arduinoCopy codemy-nextjs-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ about/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ public/
â”œâ”€â”€ next.config.js
â””â”€â”€ ...
</code></pre>
<p><strong>å®ç°ï¼š</strong></p>
<pre><code class="language-tsx">// app/about/page.tsx

export default function AboutPage() {
return (
&lt;div&gt;
&lt;h1&gt;About Us&lt;/h1&gt;
&lt;p&gt;Learn more about our mission and values.&lt;/p&gt;
&lt;/div&gt;
);
}
</code></pre>
<p><strong>è§£é‡Šï¼š</strong></p>
<ul>
<li><strong>è·¯ç”±å®šä¹‰ï¼š</strong> <code>about</code> æ–‡ä»¶å¤¹ä¸­çš„ <code>page.tsx</code> æ–‡ä»¶å¯¹åº”äº <code>/about</code> è·¯ç”±ã€‚</li>
<li><strong>æ¸²æŸ“ï¼š</strong> è¯¥ç»„ä»¶æ¸²æŸ“å…³äºé¡µé¢çš„å†…å®¹ã€‚</li>
</ul>
</details>
<details>
<summary>åŠ¨æ€è·¯ç”±</summary>
<p>åŠ¨æ€è·¯ç”±å…è®¸å¤„ç†å…·æœ‰å¯å˜æ®µçš„è·¯å¾„ï¼Œä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿæ ¹æ®å‚æ•°ï¼ˆå¦‚ IDã€slug ç­‰ï¼‰æ˜¾ç¤ºå†…å®¹ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š<code>/posts/[id]</code> è·¯ç”±</strong></p>
<p><strong>æ–‡ä»¶ç»“æ„ï¼š</strong></p>
<pre><code class="language-arduino">arduinoCopy codemy-nextjs-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ posts/
â”‚   â”‚   â””â”€â”€ [id]/
â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ public/
â”œâ”€â”€ next.config.js
â””â”€â”€ ...
</code></pre>
<p><strong>å®ç°ï¼š</strong></p>
<pre><code class="language-tsx">tsxCopy code// app/posts/[id]/page.tsx

import { useRouter } from 'next/navigation';

interface PostProps {
params: { id: string };
}

export default function PostPage({ params }: PostProps) {
const { id } = params;
// Fetch post data based on 'id'

return (
&lt;div&gt;
&lt;h1&gt;Post #{id}&lt;/h1&gt;
&lt;p&gt;This is the content of post {id}.&lt;/p&gt;
&lt;/div&gt;
);
}
</code></pre>
<p><strong>è§£é‡Šï¼š</strong></p>
<ul>
<li><strong>åŠ¨æ€æ®µï¼š</strong> <code>[id]</code> è¡¨ç¤ºè·¯ç”±ä¸­çš„åŠ¨æ€æ®µï¼Œä» URL ä¸­æ•è· <code>id</code> å‚æ•°ã€‚</li>
<li><strong>è®¿é—®å‚æ•°ï¼š</strong> <code>params</code> å¯¹è±¡åŒ…å«åŠ¨æ€å‚æ•°ï¼Œå¯ä»¥åœ¨ç»„ä»¶å†…è®¿é—®ã€‚</li>
<li><strong>è·¯ç”±åŒ¹é…ï¼š</strong> ä»»ä½•åŒ¹é… <code>/posts/*</code> çš„è·¯å¾„ï¼Œä¾‹å¦‚ <code>/posts/1</code>ã€<code>/posts/abc</code> ç­‰ï¼Œå°†ç”±æ­¤ç»„ä»¶å¤„ç†ã€‚</li>
</ul>
</details>
<details>
<summary>åµŒå¥—è·¯ç”±</summary>
<p>Next.js æ”¯æŒåµŒå¥—è·¯ç”±ï¼Œå…è®¸åˆ›å»ºä¸ç›®å½•ç»“æ„ç›¸å¯¹åº”çš„å±‚æ¬¡åŒ–è·¯ç”±ç»“æ„ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š<code>/dashboard/settings/profile</code> è·¯ç”±</strong></p>
<p><strong>æ–‡ä»¶ç»“æ„ï¼š</strong></p>
<pre><code class="language-arduino">arduinoCopy codemy-nextjs-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”œâ”€â”€ settings/
â”‚   â”‚   â”‚   â””â”€â”€ profile/
â”‚   â”‚   â”‚       â””â”€â”€ page.tsx
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ public/
â”œâ”€â”€ next.config.js
â””â”€â”€ ...
</code></pre>
<p><strong>å®ç°ï¼š</strong></p>
<pre><code class="language-tsx">tsxCopy code// app/dashboard/settings/profile/page.tsx

export default function ProfileSettingsPage() {
return (
&lt;div&gt;
&lt;h1&gt;Profile Settings&lt;/h1&gt;
&lt;p&gt;Manage your profile information here.&lt;/p&gt;
&lt;/div&gt;
);
}
</code></pre>
<p><strong>è§£é‡Šï¼š</strong></p>
<ul>
<li><strong>æ·±å±‚åµŒå¥—ï¼š</strong> <code>dashboard/settings/profile/</code> ç›®å½•ä¸‹çš„ <code>page.tsx</code> æ–‡ä»¶å¯¹åº”äº <code>/dashboard/settings/profile</code> è·¯ç”±ã€‚</li>
<li><strong>å±‚æ¬¡åæ˜ ï¼š</strong> ç›®å½•ç»“æ„åæ˜ äº† URL è·¯å¾„ï¼Œå¢å¼ºäº†å¯ç»´æŠ¤æ€§å’Œæ¸…æ™°åº¦ã€‚</li>
</ul>
</details>
<details>
<summary>æ•è·æ‰€æœ‰è·¯ç”±</summary>
<p>æ•è·æ‰€æœ‰è·¯ç”±å¤„ç†å¤šä¸ªåµŒå¥—æ®µæˆ–æœªçŸ¥è·¯å¾„ï¼Œæä¾›è·¯ç”±å¤„ç†çš„çµæ´»æ€§ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š<code>/*</code> è·¯ç”±</strong></p>
<p><strong>æ–‡ä»¶ç»“æ„ï¼š</strong></p>
<pre><code class="language-arduino">my-nextjs-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ [..slug]/
â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”œâ”€â”€ layout.tsx
â”‚   â””â”€â”€ page.tsx
â”œâ”€â”€ public/
â”œâ”€â”€ next.config.js
â””â”€â”€ ...
</code></pre>
<p><strong>å®æ–½ï¼š</strong></p>
<pre><code class="language-tsx">// app/[...slug]/page.tsx

interface CatchAllProps {
params: { slug: string[] };
}

export default function CatchAllPage({ params }: CatchAllProps) {
const { slug } = params;
const fullPath = `/${slug.join('/')}`;

return (
&lt;div&gt;
&lt;h1&gt;Catch-All Route&lt;/h1&gt;
&lt;p&gt;You have navigated to: {fullPath}&lt;/p&gt;
&lt;/div&gt;
);
}
</code></pre>
<p><strong>è§£é‡Šï¼š</strong></p>
<ul>
<li><strong>Catch-All æ®µï¼š</strong> <code>[...slug]</code> æ•è·æ‰€æœ‰å‰©ä½™çš„è·¯å¾„æ®µä½œä¸ºæ•°ç»„ã€‚</li>
<li><strong>ç”¨æ³•ï¼š</strong> é€‚ç”¨äºå¤„ç†åŠ¨æ€è·¯ç”±åœºæ™¯ï¼Œå¦‚ç”¨æˆ·ç”Ÿæˆçš„è·¯å¾„ã€åµŒå¥—ç±»åˆ«ç­‰ã€‚</li>
<li><strong>è·¯ç”±åŒ¹é…ï¼š</strong> åƒ <code>/anything/here</code>ã€<code>/foo/bar/baz</code> ç­‰è·¯å¾„ç”±æ­¤ç»„ä»¶å¤„ç†ã€‚</li>
</ul>
</details>
<h3 id="æ½œåœ¨çš„å®¢æˆ·ç«¯æ¼æ´"><a class="header" href="#æ½œåœ¨çš„å®¢æˆ·ç«¯æ¼æ´">æ½œåœ¨çš„å®¢æˆ·ç«¯æ¼æ´</a></h3>
<p>è™½ç„¶ Next.js æä¾›äº†å®‰å…¨çš„åŸºç¡€ï¼Œä½†ä¸å½“çš„ç¼–ç å®è·µå¯èƒ½ä¼šå¼•å…¥æ¼æ´ã€‚å…³é”®çš„å®¢æˆ·ç«¯æ¼æ´åŒ…æ‹¬ï¼š</p>
<details>
<summary>è·¨ç«™è„šæœ¬æ”»å‡» (XSS)</summary>
<p>XSS æ”»å‡»å‘ç”Ÿåœ¨æ¶æ„è„šæœ¬è¢«æ³¨å…¥åˆ°å—ä¿¡ä»»çš„ç½‘ç«™æ—¶ã€‚æ”»å‡»è€…å¯ä»¥åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸­æ‰§è¡Œè„šæœ¬ï¼Œçªƒå–æ•°æ®æˆ–ä»£è¡¨ç”¨æˆ·æ‰§è¡Œæ“ä½œã€‚</p>
<p><strong>æ˜“å—æ”»å‡»ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-jsx">// Dangerous: Injecting user input directly into HTML
function Comment({ userInput }) {
return &lt;div dangerouslySetInnerHTML={{ __html: userInput }} /&gt;;
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆå®ƒå®¹æ˜“å—åˆ°æ”»å‡»ï¼š</strong> ä½¿ç”¨ <code>dangerouslySetInnerHTML</code> å¤„ç†ä¸å—ä¿¡ä»»çš„è¾“å…¥å…è®¸æ”»å‡»è€…æ³¨å…¥æ¶æ„è„šæœ¬ã€‚</p>
</details>
<details>
<summary>å®¢æˆ·ç«¯æ¨¡æ¿æ³¨å…¥</summary>
<p>å½“ç”¨æˆ·è¾“å…¥åœ¨æ¨¡æ¿ä¸­å¤„ç†ä¸å½“æ—¶å‘ç”Ÿï¼Œå…è®¸æ”»å‡»è€…æ³¨å…¥å’Œæ‰§è¡Œæ¨¡æ¿æˆ–è¡¨è¾¾å¼ã€‚</p>
<p><strong>æ˜“å—æ”»å‡»ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-jsx">import React from 'react';
import ejs from 'ejs';

function RenderTemplate({ template, data }) {
const html = ejs.render(template, data);
return &lt;div dangerouslySetInnerHTML={{ __html: html }} /&gt;;
}
</code></pre>
<p><strong>ä¸ºä»€ä¹ˆå®ƒå®¹æ˜“å—åˆ°æ”»å‡»ï¼š</strong> å¦‚æœ <code>template</code> æˆ– <code>data</code> åŒ…å«æ¶æ„å†…å®¹ï¼Œå¯èƒ½å¯¼è‡´æ„å¤–ä»£ç çš„æ‰§è¡Œã€‚</p>
</details>
<details>
<summary>å®¢æˆ·ç«¯è·¯å¾„éå†</summary>
<p>è¿™æ˜¯ä¸€ç§æ¼æ´ï¼Œå…è®¸æ”»å‡»è€…æ“çºµå®¢æˆ·ç«¯è·¯å¾„ä»¥æ‰§è¡Œæ„å¤–æ“ä½œï¼Œä¾‹å¦‚è·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰ã€‚ä¸é’ˆå¯¹æœåŠ¡å™¨æ–‡ä»¶ç³»ç»Ÿçš„æœåŠ¡å™¨ç«¯è·¯å¾„éå†ä¸åŒï¼ŒCSPT ä¾§é‡äºåˆ©ç”¨å®¢æˆ·ç«¯æœºåˆ¶å°†åˆæ³•çš„ API è¯·æ±‚é‡å®šå‘åˆ°æ¶æ„ç«¯ç‚¹ã€‚</p>
<p><strong>æ˜“å—æ”»å‡»ä»£ç ç¤ºä¾‹ï¼š</strong></p>
<p>ä¸€ä¸ª Next.js åº”ç”¨ç¨‹åºå…è®¸ç”¨æˆ·ä¸Šä¼ å’Œä¸‹è½½æ–‡ä»¶ã€‚ä¸‹è½½åŠŸèƒ½åœ¨å®¢æˆ·ç«¯å®ç°ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šè¦ä¸‹è½½çš„æ–‡ä»¶è·¯å¾„ã€‚</p>
<pre><code class="language-jsx">// pages/download.js
import { useState } from 'react';

export default function DownloadPage() {
const [filePath, setFilePath] = useState('');

const handleDownload = () =&gt; {
fetch(`/api/files/${filePath}`)
.then(response =&gt; response.blob())
.then(blob =&gt; {
const url = window.URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = filePath;
a.click();
});
};

return (
&lt;div&gt;
&lt;h1&gt;Download File&lt;/h1&gt;
&lt;input
type="text"
value={filePath}
onChange={(e) =&gt; setFilePath(e.target.value)}
placeholder="Enter file path"
/&gt;
&lt;button onClick={handleDownload}&gt;Download&lt;/button&gt;
&lt;/div&gt;
);
}
</code></pre>
<h4 id="æ”»å‡»åœºæ™¯"><a class="header" href="#æ”»å‡»åœºæ™¯">æ”»å‡»åœºæ™¯</a></h4>
<ol>
<li><strong>æ”»å‡»è€…çš„ç›®æ ‡</strong>ï¼šé€šè¿‡æ“çºµ <code>filePath</code> æ‰§è¡Œ CSRF æ”»å‡»ä»¥åˆ é™¤å…³é”®æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼Œ<code>admin/config.json</code>ï¼‰ã€‚</li>
<li><strong>åˆ©ç”¨ CSPT</strong>ï¼š</li>
</ol>
<ul>
<li><strong>æ¶æ„è¾“å…¥</strong>ï¼šæ”»å‡»è€…æ„é€ ä¸€ä¸ªå¸¦æœ‰æ“çºµçš„ <code>filePath</code> çš„ URLï¼Œä¾‹å¦‚ <code>../deleteFile/config.json</code>ã€‚</li>
<li><strong>ç»“æœ API è°ƒç”¨</strong>ï¼šå®¢æˆ·ç«¯ä»£ç å‘ <code>/api/files/../deleteFile/config.json</code> å‘å‡ºè¯·æ±‚ã€‚</li>
<li><strong>æœåŠ¡å™¨çš„å¤„ç†</strong>ï¼šå¦‚æœæœåŠ¡å™¨ä¸éªŒè¯ <code>filePath</code>ï¼Œåˆ™ä¼šå¤„ç†è¯¥è¯·æ±‚ï¼Œå¯èƒ½ä¼šåˆ é™¤æˆ–æš´éœ²æ•æ„Ÿæ–‡ä»¶ã€‚</li>
</ul>
<ol start="3">
<li><strong>æ‰§è¡Œ CSRF</strong>ï¼š</li>
</ol>
<ul>
<li><strong>æ„é€ çš„é“¾æ¥</strong>ï¼šæ”»å‡»è€…å‘å—å®³è€…å‘é€ä¸€ä¸ªé“¾æ¥æˆ–åµŒå…¥ä¸€ä¸ªæ¶æ„è„šæœ¬ï¼Œè§¦å‘å¸¦æœ‰æ“çºµçš„ <code>filePath</code> çš„ä¸‹è½½è¯·æ±‚ã€‚</li>
<li><strong>ç»“æœ</strong>ï¼šå—å®³è€…åœ¨ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹æ‰§è¡Œè¯¥æ“ä½œï¼Œå¯¼è‡´æœªç»æˆæƒçš„æ–‡ä»¶è®¿é—®æˆ–åˆ é™¤ã€‚</li>
</ul>
<h4 id="ä¸ºä»€ä¹ˆå®ƒæ˜¯è„†å¼±çš„"><a class="header" href="#ä¸ºä»€ä¹ˆå®ƒæ˜¯è„†å¼±çš„">ä¸ºä»€ä¹ˆå®ƒæ˜¯è„†å¼±çš„</a></h4>
<ul>
<li><strong>ç¼ºä¹è¾“å…¥éªŒè¯</strong>ï¼šå®¢æˆ·ç«¯å…è®¸ä»»æ„çš„ <code>filePath</code> è¾“å…¥ï¼Œä»è€Œå¯ç”¨è·¯å¾„éå†ã€‚</li>
<li><strong>ä¿¡ä»»å®¢æˆ·ç«¯è¾“å…¥</strong>ï¼šæœåŠ¡å™¨ç«¯ API ä¿¡ä»»å¹¶å¤„ç†æœªç»è¿‡æ¸…ç†çš„ <code>filePath</code>ã€‚</li>
<li><strong>æ½œåœ¨çš„ API æ“ä½œ</strong>ï¼šå¦‚æœ API ç«¯ç‚¹æ‰§è¡ŒçŠ¶æ€æ›´æ”¹æ“ä½œï¼ˆä¾‹å¦‚ï¼Œåˆ é™¤ã€ä¿®æ”¹æ–‡ä»¶ï¼‰ï¼Œåˆ™å¯èƒ½é€šè¿‡ CSPT è¢«åˆ©ç”¨ã€‚</li>
</ul>
</details>
<h2 id="nextjs-ä¸­çš„æœåŠ¡å™¨ç«¯"><a class="header" href="#nextjs-ä¸­çš„æœåŠ¡å™¨ç«¯">Next.js ä¸­çš„æœåŠ¡å™¨ç«¯</a></h2>
<h3 id="æœåŠ¡å™¨ç«¯æ¸²æŸ“-ssr"><a class="header" href="#æœåŠ¡å™¨ç«¯æ¸²æŸ“-ssr">æœåŠ¡å™¨ç«¯æ¸²æŸ“ (SSR)</a></h3>
<p>é¡µé¢åœ¨æ¯ä¸ªè¯·æ±‚æ—¶åœ¨æœåŠ¡å™¨ä¸Šæ¸²æŸ“ï¼Œç¡®ä¿ç”¨æˆ·æ¥æ”¶åˆ°å®Œå…¨æ¸²æŸ“çš„ HTMLã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨åº”è¯¥åˆ›å»ºè‡ªå·±çš„è‡ªå®šä¹‰æœåŠ¡å™¨æ¥å¤„ç†è¯·æ±‚ã€‚</p>
<p><strong>ç”¨ä¾‹ï¼š</strong></p>
<ul>
<li>ç»å¸¸å˜åŒ–çš„åŠ¨æ€å†…å®¹ã€‚</li>
<li>SEO ä¼˜åŒ–ï¼Œå› ä¸ºæœç´¢å¼•æ“å¯ä»¥æŠ“å–å®Œå…¨æ¸²æŸ“çš„é¡µé¢ã€‚</li>
</ul>
<p><strong>å®ç°ï¼š</strong></p>
<pre><code class="language-jsx">// pages/index.js
export async function getServerSideProps(context) {
const res = await fetch('https://api.example.com/data');
const data = await res.json();
return { props: { data } };
}

function HomePage({ data }) {
return &lt;div&gt;{data.title}&lt;/div&gt;;
}

export default HomePage;
</code></pre>
<h3 id="é™æ€ç½‘ç«™ç”Ÿæˆ-ssg"><a class="header" href="#é™æ€ç½‘ç«™ç”Ÿæˆ-ssg">é™æ€ç½‘ç«™ç”Ÿæˆ (SSG)</a></h3>
<p>é¡µé¢åœ¨æ„å»ºæ—¶é¢„æ¸²æŸ“ï¼Œä»è€Œå®ç°æ›´å¿«çš„åŠ è½½æ—¶é—´å’Œå‡å°‘æœåŠ¡å™¨è´Ÿè½½ã€‚</p>
<p><strong>ç”¨ä¾‹ï¼š</strong></p>
<ul>
<li>ä¸ç»å¸¸æ›´æ”¹çš„å†…å®¹ã€‚</li>
<li>åšå®¢ã€æ–‡æ¡£ã€è¥é”€é¡µé¢ã€‚</li>
</ul>
<p><strong>å®ç°ï¼š</strong></p>
<pre><code class="language-jsx">// pages/index.js
export async function getStaticProps() {
const res = await fetch('https://api.example.com/data');
const data = await res.json();
return { props: { data }, revalidate: 60 }; // Revalidate every 60 seconds
}

function HomePage({ data }) {
return &lt;div&gt;{data.title}&lt;/div&gt;;
}

export default HomePage;
</code></pre>
<h3 id="serverless-functions-api-routes"><a class="header" href="#serverless-functions-api-routes">Serverless Functions (API Routes)</a></h3>
<p>Next.js å…è®¸åˆ›å»ºä½œä¸ºæ— æœåŠ¡å™¨å‡½æ•°çš„ API ç«¯ç‚¹ã€‚è¿™äº›å‡½æ•°æŒ‰éœ€è¿è¡Œï¼Œæ— éœ€ä¸“ç”¨æœåŠ¡å™¨ã€‚</p>
<p><strong>ç”¨ä¾‹ï¼š</strong></p>
<ul>
<li>å¤„ç†è¡¨å•æäº¤ã€‚</li>
<li>ä¸æ•°æ®åº“äº¤äº’ã€‚</li>
<li>å¤„ç†æ•°æ®æˆ–ä¸ç¬¬ä¸‰æ–¹ API é›†æˆã€‚</li>
</ul>
<p><strong>å®ç°ï¼š</strong></p>
<p>éšç€ Next.js 13 ä¸­ <code>app</code> ç›®å½•çš„å¼•å…¥ï¼Œè·¯ç”±å’Œ API å¤„ç†å˜å¾—æ›´åŠ çµæ´»å’Œå¼ºå¤§ã€‚è¿™ç§ç°ä»£æ–¹æ³•ä¸åŸºäºæ–‡ä»¶çš„è·¯ç”±ç³»ç»Ÿç´§å¯†å¯¹é½ï¼Œä½†å¼•å…¥äº†å¢å¼ºçš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬å¯¹æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ç»„ä»¶çš„æ”¯æŒã€‚</p>
<h4 id="åŸºæœ¬è·¯ç”±å¤„ç†ç¨‹åº"><a class="header" href="#åŸºæœ¬è·¯ç”±å¤„ç†ç¨‹åº">åŸºæœ¬è·¯ç”±å¤„ç†ç¨‹åº</a></h4>
<p><strong>æ–‡ä»¶ç»“æ„ï¼š</strong></p>
<pre><code class="language-go">my-nextjs-app/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ hello/
â”‚           â””â”€â”€ route.js
â”œâ”€â”€ package.json
â””â”€â”€ ...
</code></pre>
<p><strong>å®ç°ï¼š</strong></p>
<pre><code class="language-javascript">// app/api/hello/route.js

export async function POST(request) {
return new Response(JSON.stringify({ message: 'Hello from App Router!' }), {
status: 200,
headers: { 'Content-Type': 'application/json' },
});
}

// Client-side fetch to access the API endpoint
fetch('/api/submit', {
method: 'POST',
headers: { 'Content-Type': 'application/json' },
body: JSON.stringify({ name: 'John Doe' }),
})
.then((res) =&gt; res.json())
.then((data) =&gt; console.log(data));
</code></pre>
<p><strong>è§£é‡Šï¼š</strong></p>
<ul>
<li><strong>ä½ç½®ï¼š</strong> API è·¯ç”±ä½äº <code>app/api/</code> ç›®å½•ä¸‹ã€‚</li>
<li><strong>æ–‡ä»¶å‘½åï¼š</strong> æ¯ä¸ª API ç«¯ç‚¹éƒ½æœ‰è‡ªå·±çš„æ–‡ä»¶å¤¹ï¼ŒåŒ…å«ä¸€ä¸ª <code>route.js</code> æˆ– <code>route.ts</code> æ–‡ä»¶ã€‚</li>
<li><strong>å¯¼å‡ºå‡½æ•°ï¼š</strong> ä¸å†æ˜¯å•ä¸€çš„é»˜è®¤å¯¼å‡ºï¼Œè€Œæ˜¯å¯¼å‡ºç‰¹å®šçš„ HTTP æ–¹æ³•å‡½æ•°ï¼ˆä¾‹å¦‚ï¼Œ<code>GET</code>ã€<code>POST</code>ï¼‰ã€‚</li>
<li><strong>å“åº”å¤„ç†ï¼š</strong> ä½¿ç”¨ <code>Response</code> æ„é€ å‡½æ•°è¿”å›å“åº”ï¼Œä»è€Œæ›´å¥½åœ°æ§åˆ¶å¤´éƒ¨å’ŒçŠ¶æ€ç ã€‚</li>
</ul>
<h4 id="å¦‚ä½•å¤„ç†å…¶ä»–è·¯å¾„å’Œæ–¹æ³•"><a class="header" href="#å¦‚ä½•å¤„ç†å…¶ä»–è·¯å¾„å’Œæ–¹æ³•">å¦‚ä½•å¤„ç†å…¶ä»–è·¯å¾„å’Œæ–¹æ³•ï¼š</a></h4>
<details>
<summary>å¤„ç†ç‰¹å®šçš„ HTTP æ–¹æ³•</summary>
<p>Next.js 13+ å…è®¸æ‚¨åœ¨åŒä¸€ä¸ª <code>route.js</code> æˆ– <code>route.ts</code> æ–‡ä»¶ä¸­å®šä¹‰ç‰¹å®š HTTP æ–¹æ³•çš„å¤„ç†ç¨‹åºï¼Œä»è€Œä¿ƒè¿›æ›´æ¸…æ™°å’Œæ›´æœ‰ç»„ç»‡çš„ä»£ç ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-javascript">// app/api/users/[id]/route.js

export async function GET(request, { params }) {
const { id } = params;
// Fetch user data based on 'id'
return new Response(JSON.stringify({ userId: id, name: 'Jane Doe' }), {
status: 200,
headers: { 'Content-Type': 'application/json' },
});
}

export async function PUT(request, { params }) {
const { id } = params;
// Update user data based on 'id'
return new Response(JSON.stringify({ message: `User ${id} updated.` }), {
status: 200,
headers: { 'Content-Type': 'application/json' },
});
}

export async function DELETE(request, { params }) {
const { id } = params;
// Delete user based on 'id'
return new Response(JSON.stringify({ message: `User ${id} deleted.` }), {
status: 200,
headers: { 'Content-Type': 'application/json' },
});
}
</code></pre>
<p><strong>è§£é‡Šï¼š</strong></p>
<ul>
<li><strong>å¤šä¸ªå¯¼å‡ºï¼š</strong> æ¯ä¸ª HTTP æ–¹æ³•ï¼ˆ<code>GET</code>ï¼Œ<code>PUT</code>ï¼Œ<code>DELETE</code>ï¼‰éƒ½æœ‰å…¶è‡ªå·±çš„å¯¼å‡ºå‡½æ•°ã€‚</li>
<li><strong>å‚æ•°ï¼š</strong> ç¬¬äºŒä¸ªå‚æ•°é€šè¿‡ <code>params</code> æä¾›å¯¹è·¯ç”±å‚æ•°çš„è®¿é—®ã€‚</li>
<li><strong>å¢å¼ºå“åº”ï¼š</strong> æ›´å¥½åœ°æ§åˆ¶å“åº”å¯¹è±¡ï¼Œå®ç°ç²¾ç¡®çš„å¤´éƒ¨å’ŒçŠ¶æ€ç ç®¡ç†ã€‚</li>
</ul>
</details>
<details>
<summary>æ•è·æ‰€æœ‰å’ŒåµŒå¥—è·¯ç”±</summary>
<p>Next.js 13+ æ”¯æŒé«˜çº§è·¯ç”±åŠŸèƒ½ï¼Œå¦‚æ•è·æ‰€æœ‰è·¯ç”±å’ŒåµŒå¥— API è·¯ç”±ï¼Œå…è®¸æ›´åŠ¨æ€å’Œå¯æ‰©å±•çš„ API ç»“æ„ã€‚</p>
<p><strong>æ•è·æ‰€æœ‰è·¯ç”±ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-javascript">// app/api/[...slug]/route.js

export async function GET(request, { params }) {
const { slug } = params;
// Handle dynamic nested routes
return new Response(JSON.stringify({ slug }), {
status: 200,
headers: { 'Content-Type': 'application/json' },
});
}
</code></pre>
<p><strong>è§£é‡Šï¼š</strong></p>
<ul>
<li><strong>è¯­æ³•ï¼š</strong> <code>[...]</code> è¡¨ç¤ºä¸€ä¸ªæ•è·æ‰€æœ‰æ®µçš„é€šç”¨éƒ¨åˆ†ï¼Œæ•è·æ‰€æœ‰åµŒå¥—è·¯å¾„ã€‚</li>
<li><strong>ç”¨æ³•ï¼š</strong> å¯¹äºéœ€è¦å¤„ç†ä¸åŒè·¯ç”±æ·±åº¦æˆ–åŠ¨æ€æ®µçš„ API å¾ˆæœ‰ç”¨ã€‚</li>
</ul>
<p><strong>åµŒå¥—è·¯ç”±ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-javascript">// app/api/posts/[postId]/comments/[commentId]/route.js

export async function GET(request, { params }) {
const { postId, commentId } = params;
// Fetch specific comment for a post
return new Response(JSON.stringify({ postId, commentId, comment: 'Great post!' }), {
status: 200,
headers: { 'Content-Type': 'application/json' },
});
}
</code></pre>
<p><strong>è§£é‡Šï¼š</strong></p>
<ul>
<li><strong>æ·±å±‚åµŒå¥—ï¼š</strong> å…è®¸å±‚æ¬¡åŒ–çš„APIç»“æ„ï¼Œåæ˜ èµ„æºå…³ç³»ã€‚</li>
<li><strong>å‚æ•°è®¿é—®ï¼š</strong> é€šè¿‡<code>params</code>å¯¹è±¡è½»æ¾è®¿é—®å¤šä¸ªè·¯ç”±å‚æ•°ã€‚</li>
</ul>
</details>
<details>
<summary>åœ¨Next.js 12åŠæ›´æ—©ç‰ˆæœ¬ä¸­å¤„ç†APIè·¯ç”±</summary>
<h2 id="pagesç›®å½•ä¸­çš„apiè·¯ç”±nextjs-12åŠæ›´æ—©ç‰ˆæœ¬"><a class="header" href="#pagesç›®å½•ä¸­çš„apiè·¯ç”±nextjs-12åŠæ›´æ—©ç‰ˆæœ¬"><code>pages</code>ç›®å½•ä¸­çš„APIè·¯ç”±ï¼ˆNext.js 12åŠæ›´æ—©ç‰ˆæœ¬ï¼‰</a></h2>
<p>åœ¨Next.js 13å¼•å…¥<code>app</code>ç›®å½•å¹¶å¢å¼ºè·¯ç”±åŠŸèƒ½ä¹‹å‰ï¼ŒAPIè·¯ç”±ä¸»è¦å®šä¹‰åœ¨<code>pages</code>ç›®å½•ä¸­ã€‚è¿™ç§æ–¹æ³•åœ¨Next.js 12åŠæ›´æ—©ç‰ˆæœ¬ä¸­ä»ç„¶å¹¿æ³›ä½¿ç”¨å’Œæ”¯æŒã€‚</p>
<h4 id="åŸºæœ¬apiè·¯ç”±"><a class="header" href="#åŸºæœ¬apiè·¯ç”±">åŸºæœ¬APIè·¯ç”±</a></h4>
<p><strong>æ–‡ä»¶ç»“æ„ï¼š</strong></p>
<pre><code class="language-go">goCopy codemy-nextjs-app/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ hello.js
â”œâ”€â”€ package.json
â””â”€â”€ ...
</code></pre>
<p><strong>å®æ–½ï¼š</strong></p>
<pre><code class="language-javascript">javascriptCopy code// pages/api/hello.js

export default function handler(req, res) {
res.status(200).json({ message: 'Hello, World!' });
}
</code></pre>
<p><strong>è§£é‡Šï¼š</strong></p>
<ul>
<li><strong>ä½ç½®ï¼š</strong> API è·¯ç”±ä½äº <code>pages/api/</code> ç›®å½•ä¸‹ã€‚</li>
<li><strong>å¯¼å‡ºï¼š</strong> ä½¿ç”¨ <code>export default</code> æ¥å®šä¹‰å¤„ç†å‡½æ•°ã€‚</li>
<li><strong>å‡½æ•°ç­¾åï¼š</strong> å¤„ç†å‡½æ•°æ¥æ”¶ <code>req</code>ï¼ˆHTTP è¯·æ±‚ï¼‰å’Œ <code>res</code>ï¼ˆHTTP å“åº”ï¼‰å¯¹è±¡ã€‚</li>
<li><strong>è·¯ç”±ï¼š</strong> æ–‡ä»¶åï¼ˆ<code>hello.js</code>ï¼‰æ˜ å°„åˆ°ç«¯ç‚¹ <code>/api/hello</code>ã€‚</li>
</ul>
<h4 id="åŠ¨æ€-api-è·¯ç”±"><a class="header" href="#åŠ¨æ€-api-è·¯ç”±">åŠ¨æ€ API è·¯ç”±</a></h4>
<p><strong>æ–‡ä»¶ç»“æ„ï¼š</strong></p>
<pre><code class="language-bash">bashCopy codemy-nextjs-app/
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ users/
â”‚           â””â”€â”€ [id].js
â”œâ”€â”€ package.json
â””â”€â”€ ...
</code></pre>
<p><strong>å®ç°ï¼š</strong></p>
<pre><code class="language-javascript">javascriptCopy code// pages/api/users/[id].js

export default function handler(req, res) {
const {
query: { id },
method,
} = req;

switch (method) {
case 'GET':
// Fetch user data based on 'id'
res.status(200).json({ userId: id, name: 'John Doe' });
break;
case 'PUT':
// Update user data based on 'id'
res.status(200).json({ message: `User ${id} updated.` });
break;
case 'DELETE':
// Delete user based on 'id'
res.status(200).json({ message: `User ${id} deleted.` });
break;
default:
res.setHeader('Allow', ['GET', 'PUT', 'DELETE']);
res.status(405).end(`Method ${method} Not Allowed`);
}
}
</code></pre>
<p><strong>è§£é‡Šï¼š</strong></p>
<ul>
<li><strong>åŠ¨æ€æ®µï¼š</strong> æ–¹æ‹¬å·ï¼ˆ<code>[id].js</code>ï¼‰è¡¨ç¤ºåŠ¨æ€è·¯ç”±æ®µã€‚</li>
<li><strong>è®¿é—®å‚æ•°ï¼š</strong> ä½¿ç”¨ <code>req.query.id</code> è®¿é—®åŠ¨æ€å‚æ•°ã€‚</li>
<li><strong>å¤„ç†æ–¹æ³•ï¼š</strong> åˆ©ç”¨æ¡ä»¶é€»è¾‘å¤„ç†ä¸åŒçš„ HTTP æ–¹æ³•ï¼ˆ<code>GET</code>ã€<code>PUT</code>ã€<code>DELETE</code> ç­‰ï¼‰ã€‚</li>
</ul>
<h4 id="å¤„ç†ä¸åŒçš„-http-æ–¹æ³•"><a class="header" href="#å¤„ç†ä¸åŒçš„-http-æ–¹æ³•">å¤„ç†ä¸åŒçš„ HTTP æ–¹æ³•</a></h4>
<p>è™½ç„¶åŸºæœ¬çš„ API è·¯ç”±ç¤ºä¾‹åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å¤„ç†æ‰€æœ‰ HTTP æ–¹æ³•ï¼Œä½†æ‚¨å¯ä»¥å°†ä»£ç ç»“æ„åŒ–ä¸ºæ˜ç¡®å¤„ç†æ¯ç§æ–¹æ³•ï¼Œä»¥æé«˜æ¸…æ™°åº¦å’Œå¯ç»´æŠ¤æ€§ã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-javascript">javascriptCopy code// pages/api/posts.js

export default async function handler(req, res) {
const { method } = req;

switch (method) {
case 'GET':
// Handle GET request
res.status(200).json({ message: 'Fetching posts.' });
break;
case 'POST':
// Handle POST request
res.status(201).json({ message: 'Post created.' });
break;
default:
res.setHeader('Allow', ['GET', 'POST']);
res.status(405).end(`Method ${method} Not Allowed`);
}
}
</code></pre>
<p><strong>æœ€ä½³å®è·µï¼š</strong></p>
<ul>
<li><strong>å…³æ³¨ç‚¹åˆ†ç¦»ï¼š</strong> æ¸…æ™°åœ°åˆ†ç¦»ä¸åŒHTTPæ–¹æ³•çš„é€»è¾‘ã€‚</li>
<li><strong>å“åº”ä¸€è‡´æ€§ï¼š</strong> ç¡®ä¿ä¸€è‡´çš„å“åº”ç»“æ„ï¼Œä»¥ä¾¿äºå®¢æˆ·ç«¯å¤„ç†ã€‚</li>
<li><strong>é”™è¯¯å¤„ç†ï¼š</strong> ä¼˜é›…åœ°å¤„ç†ä¸æ”¯æŒçš„æ–¹æ³•å’Œæ„å¤–é”™è¯¯ã€‚</li>
</ul>
</details>
<h3 id="corsé…ç½®"><a class="header" href="#corsé…ç½®">CORSé…ç½®</a></h3>
<p>æ§åˆ¶å“ªäº›æ¥æºå¯ä»¥è®¿é—®æ‚¨çš„APIè·¯ç”±ï¼Œä»¥å‡è½»è·¨æºèµ„æºå…±äº«ï¼ˆCORSï¼‰æ¼æ´ã€‚</p>
<p><strong>é”™è¯¯é…ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-javascript">// app/api/data/route.js

export async function GET(request) {
return new Response(JSON.stringify({ data: 'Public Data' }), {
status: 200,
headers: {
'Access-Control-Allow-Origin': '*', // Allows any origin
'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE',
},
});
}
</code></pre>
<p>æ³¨æ„ï¼Œ<strong>CORS ä¹Ÿå¯ä»¥åœ¨æ‰€æœ‰ API è·¯ç”±ä¸­é…ç½®</strong>ï¼Œä½äº <strong><code>middleware.ts</code></strong> æ–‡ä»¶å†…ï¼š</p>
<pre><code class="language-javascript">// app/middleware.ts

import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(request: NextRequest) {
const allowedOrigins = ['https://yourdomain.com', 'https://sub.yourdomain.com'];
const origin = request.headers.get('Origin');

const response = NextResponse.next();

if (allowedOrigins.includes(origin || '')) {
response.headers.set('Access-Control-Allow-Origin', origin || '');
response.headers.set('Access-Control-Allow-Methods', 'GET, POST, PUT, DELETE, OPTIONS');
response.headers.set('Access-Control-Allow-Headers', 'Content-Type, Authorization');
// If credentials are needed:
// response.headers.set('Access-Control-Allow-Credentials', 'true');
}

// Handle preflight requests
if (request.method === 'OPTIONS') {
return new Response(null, {
status: 204,
headers: response.headers,
});
}

return response;
}

export const config = {
matcher: '/api/:path*', // Apply to all API routes
};

</code></pre>
<p><strong>é—®é¢˜ï¼š</strong></p>
<ul>
<li><strong><code>Access-Control-Allow-Origin: '*'</code>ï¼š</strong> å…è®¸ä»»ä½•ç½‘ç«™è®¿é—®APIï¼Œå¯èƒ½å¯¼è‡´æ¶æ„ç½‘ç«™åœ¨æ²¡æœ‰é™åˆ¶çš„æƒ…å†µä¸‹ä¸æ‚¨çš„APIäº¤äº’ã€‚</li>
<li><strong>å¹¿æ³›çš„æ–¹æ³•å…è®¸ï¼š</strong> å…è®¸æ‰€æœ‰æ–¹æ³•å¯èƒ½ä½¿æ”»å‡»è€…æ‰§è¡Œä¸å¿…è¦çš„æ“ä½œã€‚</li>
</ul>
<p><strong>æ”»å‡»è€…å¦‚ä½•åˆ©ç”¨å®ƒï¼š</strong></p>
<p>æ”»å‡»è€…å¯ä»¥æ„å»ºæ¶æ„ç½‘ç«™ï¼Œå‘æ‚¨çš„APIå‘é€è¯·æ±‚ï¼Œå¯èƒ½æ»¥ç”¨è¯¸å¦‚æ•°æ®æ£€ç´¢ã€æ•°æ®æ“ä½œæˆ–ä»£è¡¨ç»è¿‡èº«ä»½éªŒè¯çš„ç”¨æˆ·è§¦å‘ä¸å¿…è¦çš„æ“ä½œç­‰åŠŸèƒ½ã€‚</p>
<p>{% content-ref url="../../pentesting-web/cors-bypass.md" %}
<a href="../../pentesting-web/cors-bypass.html">cors-bypass.md</a>
{% endcontent-ref %}</p>
<h3 id="å®¢æˆ·ç«¯çš„æœåŠ¡å™¨ä»£ç æš´éœ²"><a class="header" href="#å®¢æˆ·ç«¯çš„æœåŠ¡å™¨ä»£ç æš´éœ²">å®¢æˆ·ç«¯çš„æœåŠ¡å™¨ä»£ç æš´éœ²</a></h3>
<p><strong>åœ¨å®¢æˆ·ç«¯æš´éœ²å’Œä½¿ç”¨çš„ä»£ç ä¸­ä½¿ç”¨æœåŠ¡å™¨ä½¿ç”¨çš„ä»£ç æ˜¯å¾ˆå®¹æ˜“çš„</strong>ï¼Œç¡®ä¿ä»£ç æ–‡ä»¶åœ¨å®¢æˆ·ç«¯ä»æœªæš´éœ²çš„æœ€ä½³æ–¹æ³•æ˜¯åœ¨æ–‡ä»¶å¼€å¤´ä½¿ç”¨æ­¤å¯¼å…¥ï¼š</p>
<pre><code class="language-js">import "server-only";
</code></pre>
<h2 id="å…³é”®æ–‡ä»¶åŠå…¶è§’è‰²"><a class="header" href="#å…³é”®æ–‡ä»¶åŠå…¶è§’è‰²">å…³é”®æ–‡ä»¶åŠå…¶è§’è‰²</a></h2>
<h3 id="middlewarets--middlewarejs"><a class="header" href="#middlewarets--middlewarejs"><code>middleware.ts</code> / <code>middleware.js</code></a></h3>
<p><strong>ä½ç½®ï¼š</strong> é¡¹ç›®çš„æ ¹ç›®å½•æˆ– <code>src/</code> ä¸­ã€‚</p>
<p><strong>ç›®çš„ï¼š</strong> åœ¨è¯·æ±‚å¤„ç†ä¹‹å‰ï¼Œåœ¨æœåŠ¡å™¨ç«¯æ— æœåŠ¡å™¨å‡½æ•°ä¸­æ‰§è¡Œä»£ç ï¼Œå…è®¸è¿›è¡Œèº«ä»½éªŒè¯ã€é‡å®šå‘æˆ–ä¿®æ”¹å“åº”ç­‰ä»»åŠ¡ã€‚</p>
<p><strong>æ‰§è¡Œæµç¨‹ï¼š</strong></p>
<ol>
<li><strong>ä¼ å…¥è¯·æ±‚ï¼š</strong> ä¸­é—´ä»¶æ‹¦æˆªè¯·æ±‚ã€‚</li>
<li><strong>å¤„ç†ï¼š</strong> æ ¹æ®è¯·æ±‚æ‰§è¡Œæ“ä½œï¼ˆä¾‹å¦‚ï¼Œæ£€æŸ¥èº«ä»½éªŒè¯ï¼‰ã€‚</li>
<li><strong>å“åº”ä¿®æ”¹ï¼š</strong> å¯ä»¥æ›´æ”¹å“åº”æˆ–å°†æ§åˆ¶æƒä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†ç¨‹åºã€‚</li>
</ol>
<p><strong>ç¤ºä¾‹ç”¨ä¾‹ï¼š</strong></p>
<ul>
<li>é‡å®šå‘æœªè®¤è¯ç”¨æˆ·ã€‚</li>
<li>æ·»åŠ è‡ªå®šä¹‰å¤´éƒ¨ã€‚</li>
<li>è®°å½•è¯·æ±‚ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹é…ç½®ï¼š</strong></p>
<pre><code class="language-typescript">// middleware.ts
import { NextResponse } from 'next/server';
import type { NextRequest } from 'next/server';

export function middleware(req: NextRequest) {
const url = req.nextUrl.clone();
if (!req.cookies.has('token')) {
url.pathname = '/login';
return NextResponse.redirect(url);
}
return NextResponse.next();
}

export const config = {
matcher: ['/protected/:path*'],
};
</code></pre>
<h3 id="nextconfigjs"><a class="header" href="#nextconfigjs"><code>next.config.js</code></a></h3>
<p><strong>ä½ç½®ï¼š</strong> é¡¹ç›®çš„æ ¹ç›®å½•ã€‚</p>
<p><strong>ç›®çš„ï¼š</strong> é…ç½® Next.js çš„è¡Œä¸ºï¼Œå¯ç”¨æˆ–ç¦ç”¨åŠŸèƒ½ï¼Œè‡ªå®šä¹‰ webpack é…ç½®ï¼Œè®¾ç½®ç¯å¢ƒå˜é‡ï¼Œå¹¶é…ç½®å¤šä¸ªå®‰å…¨åŠŸèƒ½ã€‚</p>
<p><strong>å…³é”®å®‰å…¨é…ç½®ï¼š</strong></p>
<details>
<summary>å®‰å…¨å¤´éƒ¨</summary>
<p>å®‰å…¨å¤´éƒ¨é€šè¿‡æŒ‡ç¤ºæµè§ˆå™¨å¦‚ä½•å¤„ç†å†…å®¹æ¥å¢å¼ºåº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§ã€‚å®ƒä»¬æœ‰åŠ©äºå‡è½»å„ç§æ”»å‡»ï¼Œå¦‚è·¨ç«™è„šæœ¬ (XSS)ã€ç‚¹å‡»åŠ«æŒå’Œ MIME ç±»å‹å—…æ¢ï¼š</p>
<ul>
<li>å†…å®¹å®‰å…¨ç­–ç•¥ (CSP)</li>
<li>X-Frame-Options</li>
<li>X-Content-Type-Options</li>
<li>ä¸¥æ ¼ä¼ è¾“å®‰å…¨ (HSTS)</li>
<li>å¼•ç”¨æ”¿ç­–</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-javascript">// next.config.js

module.exports = {
async headers() {
return [
{
source: '/(.*)', // Apply to all routes
headers: [
{
key: 'X-Frame-Options',
value: 'DENY',
},
{
key: 'Content-Security-Policy',
value: "default-src *; script-src 'self' 'unsafe-inline' 'unsafe-eval';",
},
{
key: 'X-Content-Type-Options',
value: 'nosniff',
},
{
key: 'Strict-Transport-Security',
value: 'max-age=63072000; includeSubDomains; preload', // Enforces HTTPS
},
{
key: 'Referrer-Policy',
value: 'no-referrer', // Completely hides referrer
},
// Additional headers...
],
},
];
},
};
</code></pre>
</details>
<details>
<summary>å›¾åƒä¼˜åŒ–è®¾ç½®</summary>
<p>Next.js ä¸ºæ€§èƒ½ä¼˜åŒ–å›¾åƒï¼Œä½†é”™è¯¯é…ç½®å¯èƒ½å¯¼è‡´å®‰å…¨æ¼æ´ï¼Œä¾‹å¦‚å…è®¸ä¸å—ä¿¡ä»»çš„æ¥æºæ³¨å…¥æ¶æ„å†…å®¹ã€‚</p>
<p><strong>é”™è¯¯é…ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-javascript">// next.config.js

module.exports = {
images: {
domains: ['*'], // Allows images from any domain
},
};
</code></pre>
<p><strong>é—®é¢˜ï¼š</strong></p>
<ul>
<li><strong><code>'*'</code>ï¼š</strong> å…è®¸ä»ä»»ä½•å¤–éƒ¨æ¥æºåŠ è½½å›¾åƒï¼ŒåŒ…æ‹¬ä¸å—ä¿¡ä»»æˆ–æ¶æ„çš„åŸŸã€‚æ”»å‡»è€…å¯ä»¥æ‰˜ç®¡åŒ…å«æ¶æ„è´Ÿè½½æˆ–è¯¯å¯¼ç”¨æˆ·å†…å®¹çš„å›¾åƒã€‚</li>
<li>å¦ä¸€ä¸ªé—®é¢˜å¯èƒ½æ˜¯å…è®¸ä¸€ä¸ª<strong>ä»»ä½•äººéƒ½å¯ä»¥ä¸Šä¼ å›¾åƒçš„åŸŸ</strong>ï¼ˆå¦‚ <code>raw.githubusercontent.com</code>ï¼‰</li>
</ul>
<p><strong>æ”»å‡»è€…å¦‚ä½•åˆ©ç”¨å®ƒï¼š</strong></p>
<p>é€šè¿‡ä»æ¶æ„æ¥æºæ³¨å…¥å›¾åƒï¼Œæ”»å‡»è€…å¯ä»¥æ‰§è¡Œç½‘ç»œé’“é±¼æ”»å‡»ï¼Œæ˜¾ç¤ºè¯¯å¯¼æ€§ä¿¡æ¯ï¼Œæˆ–åˆ©ç”¨å›¾åƒæ¸²æŸ“åº“ä¸­çš„æ¼æ´ã€‚</p>
</details>
<details>
<summary>ç¯å¢ƒå˜é‡æ³„éœ²</summary>
<p>å®‰å…¨åœ°ç®¡ç†æ•æ„Ÿä¿¡æ¯ï¼Œå¦‚ API å¯†é’¥å’Œæ•°æ®åº“å‡­æ®ï¼Œè€Œä¸å°†å…¶æš´éœ²ç»™å®¢æˆ·ç«¯ã€‚</p>
<h4 id="a-æ³„éœ²æ•æ„Ÿå˜é‡"><a class="header" href="#a-æ³„éœ²æ•æ„Ÿå˜é‡">a. æ³„éœ²æ•æ„Ÿå˜é‡</a></h4>
<p><strong>é”™è¯¯é…ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-javascript">// next.config.js

module.exports = {
env: {
SECRET_API_KEY: process.env.SECRET_API_KEY, // Exposed to the client
NEXT_PUBLIC_API_URL: process.env.NEXT_PUBLIC_API_URL, // Correctly prefixed for client
},
};
</code></pre>
<p><strong>é—®é¢˜ï¼š</strong></p>
<ul>
<li><strong><code>SECRET_API_KEY</code>ï¼š</strong> å¦‚æœæ²¡æœ‰ <code>NEXT_PUBLIC_</code> å‰ç¼€ï¼ŒNext.js ä¸ä¼šå°†å˜é‡æš´éœ²ç»™å®¢æˆ·ç«¯ã€‚ç„¶è€Œï¼Œå¦‚æœé”™è¯¯åœ°æ·»åŠ äº†å‰ç¼€ï¼ˆä¾‹å¦‚ï¼Œ<code>NEXT_PUBLIC_SECRET_API_KEY</code>ï¼‰ï¼Œå®ƒå°†åœ¨å®¢æˆ·ç«¯å¯è®¿é—®ã€‚</li>
</ul>
<p><strong>æ”»å‡»è€…å¦‚ä½•åˆ©ç”¨å®ƒï¼š</strong></p>
<p>å¦‚æœæ•æ„Ÿå˜é‡æš´éœ²ç»™å®¢æˆ·ç«¯ï¼Œæ”»å‡»è€…å¯ä»¥é€šè¿‡æ£€æŸ¥å®¢æˆ·ç«¯ä»£ç æˆ–ç½‘ç»œè¯·æ±‚æ¥æ£€ç´¢å®ƒä»¬ï¼Œä»è€Œè·å¾—å¯¹ APIã€æ•°æ®åº“æˆ–å…¶ä»–æœåŠ¡çš„æœªæˆæƒè®¿é—®ã€‚</p>
</details>
<details>
<summary>é‡å®šå‘</summary>
<p>ç®¡ç†åº”ç”¨ç¨‹åºå†…çš„ URL é‡å®šå‘å’Œé‡å†™ï¼Œç¡®ä¿ç”¨æˆ·è¢«é€‚å½“åœ°å¼•å¯¼ï¼Œè€Œä¸ä¼šå¼•å…¥å¼€æ”¾é‡å®šå‘æ¼æ´ã€‚</p>
<h4 id="a-å¼€æ”¾é‡å®šå‘æ¼æ´"><a class="header" href="#a-å¼€æ”¾é‡å®šå‘æ¼æ´">a. å¼€æ”¾é‡å®šå‘æ¼æ´</a></h4>
<p><strong>é”™è¯¯é…ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-javascript">// next.config.js

module.exports = {
async redirects() {
return [
{
source: '/redirect',
destination: (req) =&gt; req.query.url, // Dynamically redirects based on query parameter
permanent: false,
},
];
},
};
</code></pre>
<p><strong>é—®é¢˜ï¼š</strong></p>
<ul>
<li><strong>åŠ¨æ€ç›®æ ‡ï¼š</strong> å…è®¸ç”¨æˆ·æŒ‡å®šä»»ä½• URLï¼Œä»è€Œå¯ç”¨å¼€æ”¾é‡å®šå‘æ”»å‡»ã€‚</li>
<li><strong>ä¿¡ä»»ç”¨æˆ·è¾“å…¥ï¼š</strong> åœ¨æ²¡æœ‰éªŒè¯çš„æƒ…å†µä¸‹é‡å®šå‘åˆ°ç”¨æˆ·æä¾›çš„ URL å¯èƒ½å¯¼è‡´ç½‘ç»œé’“é±¼ã€æ¶æ„è½¯ä»¶ä¼ æ’­æˆ–å‡­è¯ç›—çªƒã€‚</li>
</ul>
<p><strong>æ”»å‡»è€…å¦‚ä½•åˆ©ç”¨å®ƒï¼š</strong></p>
<p>æ”»å‡»è€…å¯ä»¥æ„é€ çœ‹ä¼¼æ¥è‡ªæ‚¨åŸŸçš„ URLï¼Œä½†å°†ç”¨æˆ·é‡å®šå‘åˆ°æ¶æ„ç½‘ç«™ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-bash">https://yourdomain.com/redirect?url=https://malicious-site.com
</code></pre>
<p>ç”¨æˆ·ä¿¡ä»»åŸå§‹åŸŸåå¯èƒ½ä¼šä¸çŸ¥æƒ…åœ°è®¿é—®æœ‰å®³ç½‘ç«™ã€‚</p>
</details>
<details>
<summary>Webpack é…ç½®</summary>
<p>è‡ªå®šä¹‰ Next.js åº”ç”¨ç¨‹åºçš„ Webpack é…ç½®ï¼Œå¦‚æœå¤„ç†ä¸å½“ï¼Œå¯èƒ½ä¼šæ— æ„ä¸­å¼•å…¥å®‰å…¨æ¼æ´ã€‚</p>
<h4 id="a-æš´éœ²æ•æ„Ÿæ¨¡å—"><a class="header" href="#a-æš´éœ²æ•æ„Ÿæ¨¡å—">a. æš´éœ²æ•æ„Ÿæ¨¡å—</a></h4>
<p><strong>é”™è¯¯é…ç½®ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-javascript">// next.config.js

module.exports = {
webpack: (config, { isServer }) =&gt; {
if (!isServer) {
config.resolve.alias['@sensitive'] = path.join(__dirname, 'secret-folder');
}
return config;
},
};
</code></pre>
<p><strong>é—®é¢˜ï¼š</strong></p>
<ul>
<li><strong>æš´éœ²æ•æ„Ÿè·¯å¾„ï¼š</strong> åˆ«åæ•æ„Ÿç›®å½•å¹¶å…è®¸å®¢æˆ·ç«¯è®¿é—®å¯èƒ½ä¼šæ³„éœ²æœºå¯†ä¿¡æ¯ã€‚</li>
<li><strong>æ†ç»‘ç§˜å¯†ï¼š</strong> å¦‚æœæ•æ„Ÿæ–‡ä»¶è¢«æ†ç»‘ç»™å®¢æˆ·ç«¯ï¼Œå…¶å†…å®¹å¯ä»¥é€šè¿‡æºæ˜ å°„æˆ–æ£€æŸ¥å®¢æˆ·ç«¯ä»£ç è®¿é—®ã€‚</li>
</ul>
<p><strong>æ”»å‡»è€…å¦‚ä½•åˆ©ç”¨å®ƒï¼š</strong></p>
<p>æ”»å‡»è€…å¯ä»¥è®¿é—®æˆ–é‡å»ºåº”ç”¨ç¨‹åºçš„ç›®å½•ç»“æ„ï¼Œå¯èƒ½æ‰¾åˆ°å¹¶åˆ©ç”¨æ•æ„Ÿæ–‡ä»¶æˆ–æ•°æ®ã€‚</p>
</details>
<h3 id="pages_appjs-å’Œ-pages_documentjs"><a class="header" href="#pages_appjs-å’Œ-pages_documentjs"><code>pages/_app.js</code> å’Œ <code>pages/_document.js</code></a></h3>
<h4 id="pages_appjs"><a class="header" href="#pages_appjs"><strong><code>pages/_app.js</code></strong></a></h4>
<p><strong>ç›®çš„ï¼š</strong> é‡å†™é»˜è®¤çš„ App ç»„ä»¶ï¼Œå…è®¸å…¨å±€çŠ¶æ€ã€æ ·å¼å’Œå¸ƒå±€ç»„ä»¶ã€‚</p>
<p><strong>ç”¨ä¾‹ï¼š</strong></p>
<ul>
<li>æ³¨å…¥å…¨å±€ CSSã€‚</li>
<li>æ·»åŠ å¸ƒå±€åŒ…è£…å™¨ã€‚</li>
<li>é›†æˆçŠ¶æ€ç®¡ç†åº“ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-jsx">// pages/_app.js
import '../styles/globals.css';

function MyApp({ Component, pageProps }) {
return &lt;Component {...pageProps} /&gt;;
}

export default MyApp;
</code></pre>
<h4 id="pages_documentjs"><a class="header" href="#pages_documentjs"><strong><code>pages/_document.js</code></strong></a></h4>
<p><strong>ç›®çš„ï¼š</strong> é‡å†™é»˜è®¤æ–‡æ¡£ï¼Œå…è®¸è‡ªå®šä¹‰ HTML å’Œ Body æ ‡ç­¾ã€‚</p>
<p><strong>ä½¿ç”¨æ¡ˆä¾‹ï¼š</strong></p>
<ul>
<li>ä¿®æ”¹ <code>&lt;html&gt;</code> æˆ– <code>&lt;body&gt;</code> æ ‡ç­¾ã€‚</li>
<li>æ·»åŠ å…ƒæ ‡ç­¾æˆ–è‡ªå®šä¹‰è„šæœ¬ã€‚</li>
<li>é›†æˆç¬¬ä¸‰æ–¹å­—ä½“ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-jsx">// pages/_document.js
import Document, { Html, Head, Main, NextScript } from 'next/document';

class MyDocument extends Document {
render() {
return (
&lt;Html lang="en"&gt;
&lt;Head&gt;
{/* Custom fonts or meta tags */}
&lt;/Head&gt;
&lt;body&gt;
&lt;Main /&gt;
&lt;NextScript /&gt;
&lt;/body&gt;
&lt;/Html&gt;
);
}
}

export default MyDocument;
</code></pre>
<h3 id="è‡ªå®šä¹‰æœåŠ¡å™¨å¯é€‰"><a class="header" href="#è‡ªå®šä¹‰æœåŠ¡å™¨å¯é€‰">è‡ªå®šä¹‰æœåŠ¡å™¨ï¼ˆå¯é€‰ï¼‰</a></h3>
<p><strong>ç›®çš„ï¼š</strong> è™½ç„¶ Next.js è‡ªå¸¦ä¸€ä¸ªå†…ç½®æœåŠ¡å™¨ï¼Œä½†æ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰æœåŠ¡å™¨ä»¥æ»¡è¶³é«˜çº§ç”¨ä¾‹ï¼Œä¾‹å¦‚è‡ªå®šä¹‰è·¯ç”±æˆ–ä¸ç°æœ‰åç«¯æœåŠ¡é›†æˆã€‚</p>
<p><strong>æ³¨æ„ï¼š</strong> ä½¿ç”¨è‡ªå®šä¹‰æœåŠ¡å™¨å¯èƒ½ä¼šé™åˆ¶éƒ¨ç½²é€‰é¡¹ï¼Œç‰¹åˆ«æ˜¯åœ¨åƒ Vercel è¿™æ ·ä¼˜åŒ– Next.js å†…ç½®æœåŠ¡å™¨çš„å¹³å°ä¸Šã€‚</p>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-javascript">// server.js
const express = require('express');
const next = require('next');

const dev = process.env.NODE_ENV !== 'production';
const app = next({ dev });
const handle = app.getRequestHandler();

app.prepare().then(() =&gt; {
const server = express();

// Custom route
server.get('/a', (req, res) =&gt; {
return app.render(req, res, '/a');
});

// Default handler
server.all('*', (req, res) =&gt; {
return handle(req, res);
});

server.listen(3000, (err) =&gt; {
if (err) throw err;
console.log('&gt; Ready on http://localhost:3000');
});
});
</code></pre>
<hr />
<h2 id="é¢å¤–çš„æ¶æ„å’Œå®‰å…¨è€ƒè™‘"><a class="header" href="#é¢å¤–çš„æ¶æ„å’Œå®‰å…¨è€ƒè™‘">é¢å¤–çš„æ¶æ„å’Œå®‰å…¨è€ƒè™‘</a></h2>
<h3 id="ç¯å¢ƒå˜é‡å’Œé…ç½®"><a class="header" href="#ç¯å¢ƒå˜é‡å’Œé…ç½®">ç¯å¢ƒå˜é‡å’Œé…ç½®</a></h3>
<p><strong>ç›®çš„ï¼š</strong> åœ¨ä»£ç åº“ä¹‹å¤–ç®¡ç†æ•æ„Ÿä¿¡æ¯å’Œé…ç½®è®¾ç½®ã€‚</p>
<p><strong>æœ€ä½³å®è·µï¼š</strong></p>
<ul>
<li><strong>ä½¿ç”¨ <code>.env</code> æ–‡ä»¶ï¼š</strong> å°† API å¯†é’¥ç­‰å˜é‡å­˜å‚¨åœ¨ <code>.env.local</code> ä¸­ï¼ˆä¸çº³å…¥ç‰ˆæœ¬æ§åˆ¶ï¼‰ã€‚</li>
<li><strong>å®‰å…¨è®¿é—®å˜é‡ï¼š</strong> ä½¿ç”¨ <code>process.env.VARIABLE_NAME</code> è®¿é—®ç¯å¢ƒå˜é‡ã€‚</li>
<li><strong>ç»ä¸è¦åœ¨å®¢æˆ·ç«¯æš´éœ²ç§˜å¯†ï¼š</strong> ç¡®ä¿æ•æ„Ÿå˜é‡ä»…åœ¨æœåŠ¡å™¨ç«¯ä½¿ç”¨ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-javascript">// next.config.js
module.exports = {
env: {
API_KEY: process.env.API_KEY, // Accessible on both client and server
SECRET_KEY: process.env.SECRET_KEY, // Be cautious if accessible on the client
},
};
</code></pre>
<p><strong>æ³¨æ„ï¼š</strong> è¦å°†å˜é‡é™åˆ¶ä¸ºä»…æœåŠ¡å™¨ç«¯ä½¿ç”¨ï¼Œè¯·å°†å®ƒä»¬ä» <code>env</code> å¯¹è±¡ä¸­çœç•¥æˆ–ä½¿ç”¨ <code>NEXT_PUBLIC_</code> å‰ç¼€ä»¥ä¾›å®¢æˆ·ç«¯ä½¿ç”¨ã€‚</p>
<h3 id="è®¤è¯å’Œæˆæƒ"><a class="header" href="#è®¤è¯å’Œæˆæƒ">è®¤è¯å’Œæˆæƒ</a></h3>
<p><strong>æ–¹æ³•ï¼š</strong></p>
<ul>
<li><strong>åŸºäºä¼šè¯çš„è®¤è¯ï¼š</strong> ä½¿ç”¨ cookies ç®¡ç†ç”¨æˆ·ä¼šè¯ã€‚</li>
<li><strong>åŸºäºä»¤ç‰Œçš„è®¤è¯ï¼š</strong> å®ç° JWT è¿›è¡Œæ— çŠ¶æ€è®¤è¯ã€‚</li>
<li><strong>ç¬¬ä¸‰æ–¹æä¾›è€…ï¼š</strong> ä½¿ç”¨ <code>next-auth</code> ç­‰åº“ä¸ OAuth æä¾›è€…ï¼ˆä¾‹å¦‚ï¼ŒGoogleã€GitHubï¼‰é›†æˆã€‚</li>
</ul>
<p><strong>å®‰å…¨å®è·µï¼š</strong></p>
<ul>
<li><strong>å®‰å…¨ Cookiesï¼š</strong> è®¾ç½® <code>HttpOnly</code>ã€<code>Secure</code> å’Œ <code>SameSite</code> å±æ€§ã€‚</li>
<li><strong>å¯†ç å“ˆå¸Œï¼š</strong> åœ¨å­˜å‚¨å¯†ç ä¹‹å‰å§‹ç»ˆè¿›è¡Œå“ˆå¸Œå¤„ç†ã€‚</li>
<li><strong>è¾“å…¥éªŒè¯ï¼š</strong> é€šè¿‡éªŒè¯å’Œæ¸…ç†è¾“å…¥æ¥é˜²æ­¢æ³¨å…¥æ”»å‡»ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-javascript">// pages/api/login.js
import { sign } from 'jsonwebtoken';
import { serialize } from 'cookie';

export default async function handler(req, res) {
const { username, password } = req.body;

// Validate user credentials
if (username === 'admin' &amp;&amp; password === 'password') {
const token = sign({ username }, process.env.JWT_SECRET, { expiresIn: '1h' });
res.setHeader('Set-Cookie', serialize('auth', token, { path: '/', httpOnly: true, secure: true, sameSite: 'strict' }));
res.status(200).json({ message: 'Logged in' });
} else {
res.status(401).json({ error: 'Invalid credentials' });
}
}
</code></pre>
<h3 id="æ€§èƒ½ä¼˜åŒ–"><a class="header" href="#æ€§èƒ½ä¼˜åŒ–">æ€§èƒ½ä¼˜åŒ–</a></h3>
<p><strong>ç­–ç•¥ï¼š</strong></p>
<ul>
<li><strong>å›¾åƒä¼˜åŒ–ï¼š</strong> ä½¿ç”¨ Next.js çš„ <code>next/image</code> ç»„ä»¶è¿›è¡Œè‡ªåŠ¨å›¾åƒä¼˜åŒ–ã€‚</li>
<li><strong>ä»£ç åˆ†å‰²ï¼š</strong> åˆ©ç”¨åŠ¨æ€å¯¼å…¥æ¥åˆ†å‰²ä»£ç å¹¶å‡å°‘åˆå§‹åŠ è½½æ—¶é—´ã€‚</li>
<li><strong>ç¼“å­˜ï¼š</strong> å®æ–½ API å“åº”å’Œé™æ€èµ„äº§çš„ç¼“å­˜ç­–ç•¥ã€‚</li>
<li><strong>æ‡’åŠ è½½ï¼š</strong> ä»…åœ¨éœ€è¦æ—¶åŠ è½½ç»„ä»¶æˆ–èµ„äº§ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹ï¼š</strong></p>
<pre><code class="language-jsx">// Dynamic Import with Code Splitting
import dynamic from 'next/dynamic';

const HeavyComponent = dynamic(() =&gt; import('../components/HeavyComponent'), {
loading: () =&gt; &lt;p&gt;Loading...&lt;/p&gt;,
});
</code></pre>
<p>{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>å…³æ³¨</strong> æˆ‘ä»¬çš„ <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../network-services-pentesting/pentesting-web/flask.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../network-services-pentesting/pentesting-web/nodejs-express.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../network-services-pentesting/pentesting-web/flask.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../network-services-pentesting/pentesting-web/nodejs-express.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
